(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();var ap=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function xC(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function f$(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if(typeof t=="function"){var i=function r(){var n=!1;try{n=this instanceof r}catch{}return n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(i,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}),i}var JT={exports:{}},j1={},$T={exports:{}},Gi={};var YN;function p$(){if(YN)return Gi;YN=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),n=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),a=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),c=Symbol.for("react.lazy"),h=Symbol.iterator;function d(F){return F===null||typeof F!="object"?null:(F=h&&F[h]||F["@@iterator"],typeof F=="function"?F:null)}var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,v={};function g(F,X,Y){this.props=F,this.context=X,this.refs=v,this.updater=Y||p}g.prototype.isReactComponent={},g.prototype.setState=function(F,X){if(typeof F!="object"&&typeof F!="function"&&F!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,F,X,"setState")},g.prototype.forceUpdate=function(F){this.updater.enqueueForceUpdate(this,F,"forceUpdate")};function w(){}w.prototype=g.prototype;function S(F,X,Y){this.props=F,this.context=X,this.refs=v,this.updater=Y||p}var _=S.prototype=new w;_.constructor=S,m(_,g.prototype),_.isPureReactComponent=!0;var A=Array.isArray,C=Object.prototype.hasOwnProperty,E={current:null},I={key:!0,ref:!0,__self:!0,__source:!0};function T(F,X,Y){var le,oe={},re=null,ue=null;if(X!=null)for(le in X.ref!==void 0&&(ue=X.ref),X.key!==void 0&&(re=""+X.key),X)C.call(X,le)&&!I.hasOwnProperty(le)&&(oe[le]=X[le]);var me=arguments.length-2;if(me===1)oe.children=Y;else if(1<me){for(var he=Array(me),Ce=0;Ce<me;Ce++)he[Ce]=arguments[Ce+2];oe.children=he}if(F&&F.defaultProps)for(le in me=F.defaultProps,me)oe[le]===void 0&&(oe[le]=me[le]);return{$$typeof:e,type:F,key:re,ref:ue,props:oe,_owner:E.current}}function D(F,X){return{$$typeof:e,type:F.type,key:X,ref:F.ref,props:F.props,_owner:F._owner}}function L(F){return typeof F=="object"&&F!==null&&F.$$typeof===e}function z(F){var X={"=":"=0",":":"=2"};return"$"+F.replace(/[=:]/g,function(Y){return X[Y]})}var G=/\/+/g;function V(F,X){return typeof F=="object"&&F!==null&&F.key!=null?z(""+F.key):X.toString(36)}function j(F,X,Y,le,oe){var re=typeof F;(re==="undefined"||re==="boolean")&&(F=null);var ue=!1;if(F===null)ue=!0;else switch(re){case"string":case"number":ue=!0;break;case"object":switch(F.$$typeof){case e:case t:ue=!0}}if(ue)return ue=F,oe=oe(ue),F=le===""?"."+V(ue,0):le,A(oe)?(Y="",F!=null&&(Y=F.replace(G,"$&/")+"/"),j(oe,X,Y,"",function(Ce){return Ce})):oe!=null&&(L(oe)&&(oe=D(oe,Y+(!oe.key||ue&&ue.key===oe.key?"":(""+oe.key).replace(G,"$&/")+"/")+F)),X.push(oe)),1;if(ue=0,le=le===""?".":le+":",A(F))for(var me=0;me<F.length;me++){re=F[me];var he=le+V(re,me);ue+=j(re,X,Y,he,oe)}else if(he=d(F),typeof he=="function")for(F=he.call(F),me=0;!(re=F.next()).done;)re=re.value,he=le+V(re,me++),ue+=j(re,X,Y,he,oe);else if(re==="object")throw X=String(F),Error("Objects are not valid as a React child (found: "+(X==="[object Object]"?"object with keys {"+Object.keys(F).join(", ")+"}":X)+"). If you meant to render a collection of children, use an array instead.");return ue}function J(F,X,Y){if(F==null)return F;var le=[],oe=0;return j(F,le,"","",function(re){return X.call(Y,re,oe++)}),le}function ne(F){if(F._status===-1){var X=F._result;X=X(),X.then(function(Y){(F._status===0||F._status===-1)&&(F._status=1,F._result=Y)},function(Y){(F._status===0||F._status===-1)&&(F._status=2,F._result=Y)}),F._status===-1&&(F._status=0,F._result=X)}if(F._status===1)return F._result.default;throw F._result}var K={current:null},B={transition:null},Z={ReactCurrentDispatcher:K,ReactCurrentBatchConfig:B,ReactCurrentOwner:E};return Gi.Children={map:J,forEach:function(F,X,Y){J(F,function(){X.apply(this,arguments)},Y)},count:function(F){var X=0;return J(F,function(){X++}),X},toArray:function(F){return J(F,function(X){return X})||[]},only:function(F){if(!L(F))throw Error("React.Children.only expected to receive a single React element child.");return F}},Gi.Component=g,Gi.Fragment=i,Gi.Profiler=n,Gi.PureComponent=S,Gi.StrictMode=r,Gi.Suspense=l,Gi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Z,Gi.cloneElement=function(F,X,Y){if(F==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+F+".");var le=m({},F.props),oe=F.key,re=F.ref,ue=F._owner;if(X!=null){if(X.ref!==void 0&&(re=X.ref,ue=E.current),X.key!==void 0&&(oe=""+X.key),F.type&&F.type.defaultProps)var me=F.type.defaultProps;for(he in X)C.call(X,he)&&!I.hasOwnProperty(he)&&(le[he]=X[he]===void 0&&me!==void 0?me[he]:X[he])}var he=arguments.length-2;if(he===1)le.children=Y;else if(1<he){me=Array(he);for(var Ce=0;Ce<he;Ce++)me[Ce]=arguments[Ce+2];le.children=me}return{$$typeof:e,type:F.type,key:oe,ref:re,props:le,_owner:ue}},Gi.createContext=function(F){return F={$$typeof:a,_currentValue:F,_currentValue2:F,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},F.Provider={$$typeof:s,_context:F},F.Consumer=F},Gi.createElement=T,Gi.createFactory=function(F){var X=T.bind(null,F);return X.type=F,X},Gi.createRef=function(){return{current:null}},Gi.forwardRef=function(F){return{$$typeof:o,render:F}},Gi.isValidElement=L,Gi.lazy=function(F){return{$$typeof:c,_payload:{_status:-1,_result:F},_init:ne}},Gi.memo=function(F,X){return{$$typeof:u,type:F,compare:X===void 0?null:X}},Gi.startTransition=function(F){var X=B.transition;B.transition={};try{F()}finally{B.transition=X}},Gi.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},Gi.useCallback=function(F,X){return K.current.useCallback(F,X)},Gi.useContext=function(F){return K.current.useContext(F)},Gi.useDebugValue=function(){},Gi.useDeferredValue=function(F){return K.current.useDeferredValue(F)},Gi.useEffect=function(F,X){return K.current.useEffect(F,X)},Gi.useId=function(){return K.current.useId()},Gi.useImperativeHandle=function(F,X,Y){return K.current.useImperativeHandle(F,X,Y)},Gi.useInsertionEffect=function(F,X){return K.current.useInsertionEffect(F,X)},Gi.useLayoutEffect=function(F,X){return K.current.useLayoutEffect(F,X)},Gi.useMemo=function(F,X){return K.current.useMemo(F,X)},Gi.useReducer=function(F,X,Y){return K.current.useReducer(F,X,Y)},Gi.useRef=function(F){return K.current.useRef(F)},Gi.useState=function(F){return K.current.useState(F)},Gi.useSyncExternalStore=function(F,X,Y){return K.current.useSyncExternalStore(F,X,Y)},Gi.useTransition=function(){return K.current.useTransition()},Gi.version="18.2.0",Gi}var QN;function Mx(){return QN||(QN=1,$T.exports=p$()),$T.exports}var KN;function m$(){if(KN)return j1;KN=1;var e=Mx(),t=Symbol.for("react.element"),i=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,n=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function a(o,l,u){var c,h={},d=null,p=null;u!==void 0&&(d=""+u),l.key!==void 0&&(d=""+l.key),l.ref!==void 0&&(p=l.ref);for(c in l)r.call(l,c)&&!s.hasOwnProperty(c)&&(h[c]=l[c]);if(o&&o.defaultProps)for(c in l=o.defaultProps,l)h[c]===void 0&&(h[c]=l[c]);return{$$typeof:t,type:o,key:d,ref:p,props:h,_owner:n.current}}return j1.Fragment=i,j1.jsx=a,j1.jsxs=a,j1}var ZN;function g$(){return ZN||(ZN=1,JT.exports=m$()),JT.exports}var at=g$(),xe=Mx();const v$=xC(xe);var $S={},eP={exports:{}},Do={},tP={exports:{}},iP={};var JN;function y$(){return JN||(JN=1,(function(e){function t(B,Z){var F=B.length;B.push(Z);e:for(;0<F;){var X=F-1>>>1,Y=B[X];if(0<n(Y,Z))B[X]=Z,B[F]=Y,F=X;else break e}}function i(B){return B.length===0?null:B[0]}function r(B){if(B.length===0)return null;var Z=B[0],F=B.pop();if(F!==Z){B[0]=F;e:for(var X=0,Y=B.length,le=Y>>>1;X<le;){var oe=2*(X+1)-1,re=B[oe],ue=oe+1,me=B[ue];if(0>n(re,F))ue<Y&&0>n(me,re)?(B[X]=me,B[ue]=F,X=ue):(B[X]=re,B[oe]=F,X=oe);else if(ue<Y&&0>n(me,F))B[X]=me,B[ue]=F,X=ue;else break e}}return Z}function n(B,Z){var F=B.sortIndex-Z.sortIndex;return F!==0?F:B.id-Z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],u=[],c=1,h=null,d=3,p=!1,m=!1,v=!1,g=typeof setTimeout=="function"?setTimeout:null,w=typeof clearTimeout=="function"?clearTimeout:null,S=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(B){for(var Z=i(u);Z!==null;){if(Z.callback===null)r(u);else if(Z.startTime<=B)r(u),Z.sortIndex=Z.expirationTime,t(l,Z);else break;Z=i(u)}}function A(B){if(v=!1,_(B),!m)if(i(l)!==null)m=!0,ne(C);else{var Z=i(u);Z!==null&&K(A,Z.startTime-B)}}function C(B,Z){m=!1,v&&(v=!1,w(T),T=-1),p=!0;var F=d;try{for(_(Z),h=i(l);h!==null&&(!(h.expirationTime>Z)||B&&!z());){var X=h.callback;if(typeof X=="function"){h.callback=null,d=h.priorityLevel;var Y=X(h.expirationTime<=Z);Z=e.unstable_now(),typeof Y=="function"?h.callback=Y:h===i(l)&&r(l),_(Z)}else r(l);h=i(l)}if(h!==null)var le=!0;else{var oe=i(u);oe!==null&&K(A,oe.startTime-Z),le=!1}return le}finally{h=null,d=F,p=!1}}var E=!1,I=null,T=-1,D=5,L=-1;function z(){return!(e.unstable_now()-L<D)}function G(){if(I!==null){var B=e.unstable_now();L=B;var Z=!0;try{Z=I(!0,B)}finally{Z?V():(E=!1,I=null)}}else E=!1}var V;if(typeof S=="function")V=function(){S(G)};else if(typeof MessageChannel<"u"){var j=new MessageChannel,J=j.port2;j.port1.onmessage=G,V=function(){J.postMessage(null)}}else V=function(){g(G,0)};function ne(B){I=B,E||(E=!0,V())}function K(B,Z){T=g(function(){B(e.unstable_now())},Z)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(B){B.callback=null},e.unstable_continueExecution=function(){m||p||(m=!0,ne(C))},e.unstable_forceFrameRate=function(B){0>B||125<B?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<B?Math.floor(1e3/B):5},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return i(l)},e.unstable_next=function(B){switch(d){case 1:case 2:case 3:var Z=3;break;default:Z=d}var F=d;d=Z;try{return B()}finally{d=F}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(B,Z){switch(B){case 1:case 2:case 3:case 4:case 5:break;default:B=3}var F=d;d=B;try{return Z()}finally{d=F}},e.unstable_scheduleCallback=function(B,Z,F){var X=e.unstable_now();switch(typeof F=="object"&&F!==null?(F=F.delay,F=typeof F=="number"&&0<F?X+F:X):F=X,B){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=F+Y,B={id:c++,callback:Z,priorityLevel:B,startTime:F,expirationTime:Y,sortIndex:-1},F>X?(B.sortIndex=F,t(u,B),i(l)===null&&B===i(u)&&(v?(w(T),T=-1):v=!0,K(A,F-X))):(B.sortIndex=Y,t(l,B),m||p||(m=!0,ne(C))),B},e.unstable_shouldYield=z,e.unstable_wrapCallback=function(B){var Z=d;return function(){var F=d;d=Z;try{return B.apply(this,arguments)}finally{d=F}}}})(iP)),iP}var $N;function x$(){return $N||($N=1,tP.exports=y$()),tP.exports}var eF;function w$(){if(eF)return Do;eF=1;var e=Mx(),t=x$();function i(f){for(var y="https://reactjs.org/docs/error-decoder.html?invariant="+f,M=1;M<arguments.length;M++)y+="&args[]="+encodeURIComponent(arguments[M]);return"Minified React error #"+f+"; visit "+y+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,n={};function s(f,y){a(f,y),a(f+"Capture",y)}function a(f,y){for(n[f]=y,f=0;f<y.length;f++)r.add(y[f])}var o=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,u=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,c={},h={};function d(f){return l.call(h,f)?!0:l.call(c,f)?!1:u.test(f)?h[f]=!0:(c[f]=!0,!1)}function p(f,y,M,R){if(M!==null&&M.type===0)return!1;switch(typeof y){case"function":case"symbol":return!0;case"boolean":return R?!1:M!==null?!M.acceptsBooleans:(f=f.toLowerCase().slice(0,5),f!=="data-"&&f!=="aria-");default:return!1}}function m(f,y,M,R){if(y===null||typeof y>"u"||p(f,y,M,R))return!0;if(R)return!1;if(M!==null)switch(M.type){case 3:return!y;case 4:return y===!1;case 5:return isNaN(y);case 6:return isNaN(y)||1>y}return!1}function v(f,y,M,R,k,W,se){this.acceptsBooleans=y===2||y===3||y===4,this.attributeName=R,this.attributeNamespace=k,this.mustUseProperty=M,this.propertyName=f,this.type=y,this.sanitizeURL=W,this.removeEmptyString=se}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(f){g[f]=new v(f,0,!1,f,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(f){var y=f[0];g[y]=new v(y,1,!1,f[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(f){g[f]=new v(f,2,!1,f.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(f){g[f]=new v(f,2,!1,f,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(f){g[f]=new v(f,3,!1,f.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(f){g[f]=new v(f,3,!0,f,null,!1,!1)}),["capture","download"].forEach(function(f){g[f]=new v(f,4,!1,f,null,!1,!1)}),["cols","rows","size","span"].forEach(function(f){g[f]=new v(f,6,!1,f,null,!1,!1)}),["rowSpan","start"].forEach(function(f){g[f]=new v(f,5,!1,f.toLowerCase(),null,!1,!1)});var w=/[\-:]([a-z])/g;function S(f){return f[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(f){var y=f.replace(w,S);g[y]=new v(y,1,!1,f,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(f){var y=f.replace(w,S);g[y]=new v(y,1,!1,f,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(f){var y=f.replace(w,S);g[y]=new v(y,1,!1,f,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(f){g[f]=new v(f,1,!1,f.toLowerCase(),null,!1,!1)}),g.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(f){g[f]=new v(f,1,!1,f.toLowerCase(),null,!0,!0)});function _(f,y,M,R){var k=g.hasOwnProperty(y)?g[y]:null;(k!==null?k.type!==0:R||!(2<y.length)||y[0]!=="o"&&y[0]!=="O"||y[1]!=="n"&&y[1]!=="N")&&(m(y,M,k,R)&&(M=null),R||k===null?d(y)&&(M===null?f.removeAttribute(y):f.setAttribute(y,""+M)):k.mustUseProperty?f[k.propertyName]=M===null?k.type===3?!1:"":M:(y=k.attributeName,R=k.attributeNamespace,M===null?f.removeAttribute(y):(k=k.type,M=k===3||k===4&&M===!0?"":""+M,R?f.setAttributeNS(R,y,M):f.setAttribute(y,M))))}var A=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,C=Symbol.for("react.element"),E=Symbol.for("react.portal"),I=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),D=Symbol.for("react.profiler"),L=Symbol.for("react.provider"),z=Symbol.for("react.context"),G=Symbol.for("react.forward_ref"),V=Symbol.for("react.suspense"),j=Symbol.for("react.suspense_list"),J=Symbol.for("react.memo"),ne=Symbol.for("react.lazy"),K=Symbol.for("react.offscreen"),B=Symbol.iterator;function Z(f){return f===null||typeof f!="object"?null:(f=B&&f[B]||f["@@iterator"],typeof f=="function"?f:null)}var F=Object.assign,X;function Y(f){if(X===void 0)try{throw Error()}catch(M){var y=M.stack.trim().match(/\n( *(at )?)/);X=y&&y[1]||""}return`
`+X+f}var le=!1;function oe(f,y){if(!f||le)return"";le=!0;var M=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(y)if(y=function(){throw Error()},Object.defineProperty(y.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(y,[])}catch(Ze){var R=Ze}Reflect.construct(f,[],y)}else{try{y.call()}catch(Ze){R=Ze}f.call(y.prototype)}else{try{throw Error()}catch(Ze){R=Ze}f()}}catch(Ze){if(Ze&&R&&typeof Ze.stack=="string"){for(var k=Ze.stack.split(`
`),W=R.stack.split(`
`),se=k.length-1,Te=W.length-1;1<=se&&0<=Te&&k[se]!==W[Te];)Te--;for(;1<=se&&0<=Te;se--,Te--)if(k[se]!==W[Te]){if(se!==1||Te!==1)do if(se--,Te--,0>Te||k[se]!==W[Te]){var Le=`
`+k[se].replace(" at new "," at ");return f.displayName&&Le.includes("<anonymous>")&&(Le=Le.replace("<anonymous>",f.displayName)),Le}while(1<=se&&0<=Te);break}}}finally{le=!1,Error.prepareStackTrace=M}return(f=f?f.displayName||f.name:"")?Y(f):""}function re(f){switch(f.tag){case 5:return Y(f.type);case 16:return Y("Lazy");case 13:return Y("Suspense");case 19:return Y("SuspenseList");case 0:case 2:case 15:return f=oe(f.type,!1),f;case 11:return f=oe(f.type.render,!1),f;case 1:return f=oe(f.type,!0),f;default:return""}}function ue(f){if(f==null)return null;if(typeof f=="function")return f.displayName||f.name||null;if(typeof f=="string")return f;switch(f){case I:return"Fragment";case E:return"Portal";case D:return"Profiler";case T:return"StrictMode";case V:return"Suspense";case j:return"SuspenseList"}if(typeof f=="object")switch(f.$$typeof){case z:return(f.displayName||"Context")+".Consumer";case L:return(f._context.displayName||"Context")+".Provider";case G:var y=f.render;return f=f.displayName,f||(f=y.displayName||y.name||"",f=f!==""?"ForwardRef("+f+")":"ForwardRef"),f;case J:return y=f.displayName||null,y!==null?y:ue(f.type)||"Memo";case ne:y=f._payload,f=f._init;try{return ue(f(y))}catch{}}return null}function me(f){var y=f.type;switch(f.tag){case 24:return"Cache";case 9:return(y.displayName||"Context")+".Consumer";case 10:return(y._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return f=y.render,f=f.displayName||f.name||"",y.displayName||(f!==""?"ForwardRef("+f+")":"ForwardRef");case 7:return"Fragment";case 5:return y;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ue(y);case 8:return y===T?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof y=="function")return y.displayName||y.name||null;if(typeof y=="string")return y}return null}function he(f){switch(typeof f){case"boolean":case"number":case"string":case"undefined":return f;case"object":return f;default:return""}}function Ce(f){var y=f.type;return(f=f.nodeName)&&f.toLowerCase()==="input"&&(y==="checkbox"||y==="radio")}function Ae(f){var y=Ce(f)?"checked":"value",M=Object.getOwnPropertyDescriptor(f.constructor.prototype,y),R=""+f[y];if(!f.hasOwnProperty(y)&&typeof M<"u"&&typeof M.get=="function"&&typeof M.set=="function"){var k=M.get,W=M.set;return Object.defineProperty(f,y,{configurable:!0,get:function(){return k.call(this)},set:function(se){R=""+se,W.call(this,se)}}),Object.defineProperty(f,y,{enumerable:M.enumerable}),{getValue:function(){return R},setValue:function(se){R=""+se},stopTracking:function(){f._valueTracker=null,delete f[y]}}}}function Ie(f){f._valueTracker||(f._valueTracker=Ae(f))}function Me(f){if(!f)return!1;var y=f._valueTracker;if(!y)return!0;var M=y.getValue(),R="";return f&&(R=Ce(f)?f.checked?"true":"false":f.value),f=R,f!==M?(y.setValue(f),!0):!1}function De(f){if(f=f||(typeof document<"u"?document:void 0),typeof f>"u")return null;try{return f.activeElement||f.body}catch{return f.body}}function Ve(f,y){var M=y.checked;return F({},y,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:M??f._wrapperState.initialChecked})}function Ge(f,y){var M=y.defaultValue==null?"":y.defaultValue,R=y.checked!=null?y.checked:y.defaultChecked;M=he(y.value!=null?y.value:M),f._wrapperState={initialChecked:R,initialValue:M,controlled:y.type==="checkbox"||y.type==="radio"?y.checked!=null:y.value!=null}}function Qe(f,y){y=y.checked,y!=null&&_(f,"checked",y,!1)}function ot(f,y){Qe(f,y);var M=he(y.value),R=y.type;if(M!=null)R==="number"?(M===0&&f.value===""||f.value!=M)&&(f.value=""+M):f.value!==""+M&&(f.value=""+M);else if(R==="submit"||R==="reset"){f.removeAttribute("value");return}y.hasOwnProperty("value")?Ke(f,y.type,M):y.hasOwnProperty("defaultValue")&&Ke(f,y.type,he(y.defaultValue)),y.checked==null&&y.defaultChecked!=null&&(f.defaultChecked=!!y.defaultChecked)}function $e(f,y,M){if(y.hasOwnProperty("value")||y.hasOwnProperty("defaultValue")){var R=y.type;if(!(R!=="submit"&&R!=="reset"||y.value!==void 0&&y.value!==null))return;y=""+f._wrapperState.initialValue,M||y===f.value||(f.value=y),f.defaultValue=y}M=f.name,M!==""&&(f.name=""),f.defaultChecked=!!f._wrapperState.initialChecked,M!==""&&(f.name=M)}function Ke(f,y,M){(y!=="number"||De(f.ownerDocument)!==f)&&(M==null?f.defaultValue=""+f._wrapperState.initialValue:f.defaultValue!==""+M&&(f.defaultValue=""+M))}var bt=Array.isArray;function xt(f,y,M,R){if(f=f.options,y){y={};for(var k=0;k<M.length;k++)y["$"+M[k]]=!0;for(M=0;M<f.length;M++)k=y.hasOwnProperty("$"+f[M].value),f[M].selected!==k&&(f[M].selected=k),k&&R&&(f[M].defaultSelected=!0)}else{for(M=""+he(M),y=null,k=0;k<f.length;k++){if(f[k].value===M){f[k].selected=!0,R&&(f[k].defaultSelected=!0);return}y!==null||f[k].disabled||(y=f[k])}y!==null&&(y.selected=!0)}}function q(f,y){if(y.dangerouslySetInnerHTML!=null)throw Error(i(91));return F({},y,{value:void 0,defaultValue:void 0,children:""+f._wrapperState.initialValue})}function N(f,y){var M=y.value;if(M==null){if(M=y.children,y=y.defaultValue,M!=null){if(y!=null)throw Error(i(92));if(bt(M)){if(1<M.length)throw Error(i(93));M=M[0]}y=M}y==null&&(y=""),M=y}f._wrapperState={initialValue:he(M)}}function de(f,y){var M=he(y.value),R=he(y.defaultValue);M!=null&&(M=""+M,M!==f.value&&(f.value=M),y.defaultValue==null&&f.defaultValue!==M&&(f.defaultValue=M)),R!=null&&(f.defaultValue=""+R)}function ze(f){var y=f.textContent;y===f._wrapperState.initialValue&&y!==""&&y!==null&&(f.value=y)}function $(f){switch(f){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ue(f,y){return f==null||f==="http://www.w3.org/1999/xhtml"?$(y):f==="http://www.w3.org/2000/svg"&&y==="foreignObject"?"http://www.w3.org/1999/xhtml":f}var rt,Ye=(function(f){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(y,M,R,k){MSApp.execUnsafeLocalFunction(function(){return f(y,M,R,k)})}:f})(function(f,y){if(f.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in f)f.innerHTML=y;else{for(rt=rt||document.createElement("div"),rt.innerHTML="<svg>"+y.valueOf().toString()+"</svg>",y=rt.firstChild;f.firstChild;)f.removeChild(f.firstChild);for(;y.firstChild;)f.appendChild(y.firstChild)}});function Ee(f,y){if(y){var M=f.firstChild;if(M&&M===f.lastChild&&M.nodeType===3){M.nodeValue=y;return}}f.textContent=y}var lt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},et=["Webkit","ms","Moz","O"];Object.keys(lt).forEach(function(f){et.forEach(function(y){y=y+f.charAt(0).toUpperCase()+f.substring(1),lt[y]=lt[f]})});function pt(f,y,M){return y==null||typeof y=="boolean"||y===""?"":M||typeof y!="number"||y===0||lt.hasOwnProperty(f)&&lt[f]?(""+y).trim():y+"px"}function mt(f,y){f=f.style;for(var M in y)if(y.hasOwnProperty(M)){var R=M.indexOf("--")===0,k=pt(M,y[M],R);M==="float"&&(M="cssFloat"),R?f.setProperty(M,k):f[M]=k}}var dt=F({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function _e(f,y){if(y){if(dt[f]&&(y.children!=null||y.dangerouslySetInnerHTML!=null))throw Error(i(137,f));if(y.dangerouslySetInnerHTML!=null){if(y.children!=null)throw Error(i(60));if(typeof y.dangerouslySetInnerHTML!="object"||!("__html"in y.dangerouslySetInnerHTML))throw Error(i(61))}if(y.style!=null&&typeof y.style!="object")throw Error(i(62))}}function it(f,y){if(f.indexOf("-")===-1)return typeof y.is=="string";switch(f){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var At=null;function ie(f){return f=f.target||f.srcElement||window,f.correspondingUseElement&&(f=f.correspondingUseElement),f.nodeType===3?f.parentNode:f}var we=null,Re=null,We=null;function ct(f){if(f=nu(f)){if(typeof we!="function")throw Error(i(280));var y=f.stateNode;y&&(y=Gv(y),we(f.stateNode,f.type,y))}}function Ut(f){Re?We?We.push(f):We=[f]:Re=f}function si(){if(Re){var f=Re,y=We;if(We=Re=null,ct(f),y)for(f=0;f<y.length;f++)ct(y[f])}}function Si(f,y){return f(y)}function ar(){}var ri=!1;function Yi(f,y,M){if(ri)return f(y,M);ri=!0;try{return Si(f,y,M)}finally{ri=!1,(Re!==null||We!==null)&&(ar(),si())}}function ji(f,y){var M=f.stateNode;if(M===null)return null;var R=Gv(M);if(R===null)return null;M=R[y];e:switch(y){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(R=!R.disabled)||(f=f.type,R=!(f==="button"||f==="input"||f==="select"||f==="textarea")),f=!R;break e;default:f=!1}if(f)return null;if(M&&typeof M!="function")throw Error(i(231,y,typeof M));return M}var po=!1;if(o)try{var Xo={};Object.defineProperty(Xo,"passive",{get:function(){po=!0}}),window.addEventListener("test",Xo,Xo),window.removeEventListener("test",Xo,Xo)}catch{po=!1}function Qu(f,y,M,R,k,W,se,Te,Le){var Ze=Array.prototype.slice.call(arguments,3);try{y.apply(M,Ze)}catch(_t){this.onError(_t)}}var ge=!1,te=null,ve=!1,fe=null,ye={onError:function(f){ge=!0,te=f}};function Ne(f,y,M,R,k,W,se,Te,Le){ge=!1,te=null,Qu.apply(ye,arguments)}function gt(f,y,M,R,k,W,se,Te,Le){if(Ne.apply(this,arguments),ge){if(ge){var Ze=te;ge=!1,te=null}else throw Error(i(198));ve||(ve=!0,fe=Ze)}}function St(f){var y=f,M=f;if(f.alternate)for(;y.return;)y=y.return;else{f=y;do y=f,(y.flags&4098)!==0&&(M=y.return),f=y.return;while(f)}return y.tag===3?M:null}function Tt(f){if(f.tag===13){var y=f.memoizedState;if(y===null&&(f=f.alternate,f!==null&&(y=f.memoizedState)),y!==null)return y.dehydrated}return null}function Et(f){if(St(f)!==f)throw Error(i(188))}function Vt(f){var y=f.alternate;if(!y){if(y=St(f),y===null)throw Error(i(188));return y!==f?null:f}for(var M=f,R=y;;){var k=M.return;if(k===null)break;var W=k.alternate;if(W===null){if(R=k.return,R!==null){M=R;continue}break}if(k.child===W.child){for(W=k.child;W;){if(W===M)return Et(k),f;if(W===R)return Et(k),y;W=W.sibling}throw Error(i(188))}if(M.return!==R.return)M=k,R=W;else{for(var se=!1,Te=k.child;Te;){if(Te===M){se=!0,M=k,R=W;break}if(Te===R){se=!0,R=k,M=W;break}Te=Te.sibling}if(!se){for(Te=W.child;Te;){if(Te===M){se=!0,M=W,R=k;break}if(Te===R){se=!0,R=W,M=k;break}Te=Te.sibling}if(!se)throw Error(i(189))}}if(M.alternate!==R)throw Error(i(190))}if(M.tag!==3)throw Error(i(188));return M.stateNode.current===M?f:y}function zt(f){return f=Vt(f),f!==null?Yt(f):null}function Yt(f){if(f.tag===5||f.tag===6)return f;for(f=f.child;f!==null;){var y=Yt(f);if(y!==null)return y;f=f.sibling}return null}var $t=t.unstable_scheduleCallback,tr=t.unstable_cancelCallback,Qr=t.unstable_shouldYield,ir=t.unstable_requestPaint,Rt=t.unstable_now,_i=t.unstable_getCurrentPriorityLevel,Hi=t.unstable_ImmediatePriority,ui=t.unstable_UserBlockingPriority,ls=t.unstable_NormalPriority,us=t.unstable_LowPriority,hn=t.unstable_IdlePriority,Ui=null,ee=null;function ae(f){if(ee&&typeof ee.onCommitFiberRoot=="function")try{ee.onCommitFiberRoot(Ui,f,void 0,(f.current.flags&128)===128)}catch{}}var Se=Math.clz32?Math.clz32:vt,ce=Math.log,Oe=Math.LN2;function vt(f){return f>>>=0,f===0?32:31-(ce(f)/Oe|0)|0}var Mn=64,rn=4194304;function ja(f){switch(f&-f){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return f&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return f}}function Ql(f,y){var M=f.pendingLanes;if(M===0)return 0;var R=0,k=f.suspendedLanes,W=f.pingedLanes,se=M&268435455;if(se!==0){var Te=se&~k;Te!==0?R=ja(Te):(W&=se,W!==0&&(R=ja(W)))}else se=M&~k,se!==0?R=ja(se):W!==0&&(R=ja(W));if(R===0)return 0;if(y!==0&&y!==R&&(y&k)===0&&(k=R&-R,W=y&-y,k>=W||k===16&&(W&4194240)!==0))return y;if((R&4)!==0&&(R|=M&16),y=f.entangledLanes,y!==0)for(f=f.entanglements,y&=R;0<y;)M=31-Se(y),k=1<<M,R|=f[M],y&=~k;return R}function ah(f,y){switch(f){case 1:case 2:case 4:return y+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return y+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ku(f,y){for(var M=f.suspendedLanes,R=f.pingedLanes,k=f.expirationTimes,W=f.pendingLanes;0<W;){var se=31-Se(W),Te=1<<se,Le=k[se];Le===-1?((Te&M)===0||(Te&R)!==0)&&(k[se]=ah(Te,y)):Le<=y&&(f.expiredLanes|=Te),W&=~Te}}function dv(f){return f=f.pendingLanes&-1073741825,f!==0?f:f&1073741824?1073741824:0}function mo(){var f=Mn;return Mn<<=1,(Mn&4194240)===0&&(Mn=64),f}function e1(f){for(var y=[],M=0;31>M;M++)y.push(f);return y}function Yp(f,y,M){f.pendingLanes|=y,y!==536870912&&(f.suspendedLanes=0,f.pingedLanes=0),f=f.eventTimes,y=31-Se(y),f[y]=M}function _T(f,y){var M=f.pendingLanes&~y;f.pendingLanes=y,f.suspendedLanes=0,f.pingedLanes=0,f.expiredLanes&=y,f.mutableReadLanes&=y,f.entangledLanes&=y,y=f.entanglements;var R=f.eventTimes;for(f=f.expirationTimes;0<M;){var k=31-Se(M),W=1<<k;y[k]=0,R[k]=-1,f[k]=-1,M&=~W}}function Wd(f,y){var M=f.entangledLanes|=y;for(f=f.entanglements;M;){var R=31-Se(M),k=1<<R;k&y|f[R]&y&&(f[R]|=y),M&=~k}}var rr=0;function Gd(f){return f&=-f,1<f?4<f?(f&268435455)!==0?16:536870912:4:1}var Qp,t1,sS,fv,pv,oh=!1,mv=[],ml=null,Bi=null,Kl=null,lh=new Map,qd=new Map,Zu=[],ST="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function An(f,y){switch(f){case"focusin":case"focusout":ml=null;break;case"dragenter":case"dragleave":Bi=null;break;case"mouseover":case"mouseout":Kl=null;break;case"pointerover":case"pointerout":lh.delete(y.pointerId);break;case"gotpointercapture":case"lostpointercapture":qd.delete(y.pointerId)}}function uh(f,y,M,R,k,W){return f===null||f.nativeEvent!==W?(f={blockedOn:y,domEventName:M,eventSystemFlags:R,nativeEvent:W,targetContainers:[k]},y!==null&&(y=nu(y),y!==null&&t1(y)),f):(f.eventSystemFlags|=R,y=f.targetContainers,k!==null&&y.indexOf(k)===-1&&y.push(k),f)}function MT(f,y,M,R,k){switch(y){case"focusin":return ml=uh(ml,f,y,M,R,k),!0;case"dragenter":return Bi=uh(Bi,f,y,M,R,k),!0;case"mouseover":return Kl=uh(Kl,f,y,M,R,k),!0;case"pointerover":var W=k.pointerId;return lh.set(W,uh(lh.get(W)||null,f,y,M,R,k)),!0;case"gotpointercapture":return W=k.pointerId,qd.set(W,uh(qd.get(W)||null,f,y,M,R,k)),!0}return!1}function gv(f){var y=nc(f.target);if(y!==null){var M=St(y);if(M!==null){if(y=M.tag,y===13){if(y=Tt(M),y!==null){f.blockedOn=y,pv(f.priority,function(){sS(M)});return}}else if(y===3&&M.stateNode.current.memoizedState.isDehydrated){f.blockedOn=M.tag===3?M.stateNode.containerInfo:null;return}}}f.blockedOn=null}function vv(f){if(f.blockedOn!==null)return!1;for(var y=f.targetContainers;0<y.length;){var M=vo(f.domEventName,f.eventSystemFlags,y[0],f.nativeEvent);if(M===null){M=f.nativeEvent;var R=new M.constructor(M.type,M);At=R,M.target.dispatchEvent(R),At=null}else return y=nu(M),y!==null&&t1(y),f.blockedOn=M,!1;y.shift()}return!0}function Kp(f,y,M){vv(f)&&M.delete(y)}function gl(){oh=!1,ml!==null&&vv(ml)&&(ml=null),Bi!==null&&vv(Bi)&&(Bi=null),Kl!==null&&vv(Kl)&&(Kl=null),lh.forEach(Kp),qd.forEach(Kp)}function Zp(f,y){f.blockedOn===y&&(f.blockedOn=null,oh||(oh=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,gl)))}function Jp(f){function y(k){return Zp(k,f)}if(0<mv.length){Zp(mv[0],f);for(var M=1;M<mv.length;M++){var R=mv[M];R.blockedOn===f&&(R.blockedOn=null)}}for(ml!==null&&Zp(ml,f),Bi!==null&&Zp(Bi,f),Kl!==null&&Zp(Kl,f),lh.forEach(y),qd.forEach(y),M=0;M<Zu.length;M++)R=Zu[M],R.blockedOn===f&&(R.blockedOn=null);for(;0<Zu.length&&(M=Zu[0],M.blockedOn===null);)gv(M),M.blockedOn===null&&Zu.shift()}var Qs=A.ReactCurrentBatchConfig,go=!0;function yv(f,y,M,R){var k=rr,W=Qs.transition;Qs.transition=null;try{rr=1,xv(f,y,M,R)}finally{rr=k,Qs.transition=W}}function i1(f,y,M,R){var k=rr,W=Qs.transition;Qs.transition=null;try{rr=4,xv(f,y,M,R)}finally{rr=k,Qs.transition=W}}function xv(f,y,M,R){if(go){var k=vo(f,y,M,R);if(k===null)Fv(f,y,R,wv,M),An(f,R);else if(MT(k,f,y,M,R))R.stopPropagation();else if(An(f,R),y&4&&-1<ST.indexOf(f)){for(;k!==null;){var W=nu(k);if(W!==null&&Qp(W),W=vo(f,y,M,R),W===null&&Fv(f,y,R,wv,M),W===k)break;k=W}k!==null&&R.stopPropagation()}else Fv(f,y,R,null,M)}}var wv=null;function vo(f,y,M,R){if(wv=null,f=ie(R),f=nc(f),f!==null)if(y=St(f),y===null)f=null;else if(M=y.tag,M===13){if(f=Tt(y),f!==null)return f;f=null}else if(M===3){if(y.stateNode.current.memoizedState.isDehydrated)return y.tag===3?y.stateNode.containerInfo:null;f=null}else y!==f&&(f=null);return wv=f,null}function aS(f){switch(f){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(_i()){case Hi:return 1;case ui:return 4;case ls:case us:return 16;case hn:return 536870912;default:return 16}default:return 16}}var Yo=null,r1=null,ba=null;function $p(){if(ba)return ba;var f,y=r1,M=y.length,R,k="value"in Yo?Yo.value:Yo.textContent,W=k.length;for(f=0;f<M&&y[f]===k[f];f++);var se=M-f;for(R=1;R<=se&&y[M-R]===k[W-R];R++);return ba=k.slice(f,1<R?1-R:void 0)}function ch(f){var y=f.keyCode;return"charCode"in f?(f=f.charCode,f===0&&y===13&&(f=13)):f=y,f===10&&(f=13),32<=f||f===13?f:0}function Zl(){return!0}function bv(){return!1}function Ks(f){function y(M,R,k,W,se){this._reactName=M,this._targetInst=k,this.type=R,this.nativeEvent=W,this.target=se,this.currentTarget=null;for(var Te in f)f.hasOwnProperty(Te)&&(M=f[Te],this[Te]=M?M(W):W[Te]);return this.isDefaultPrevented=(W.defaultPrevented!=null?W.defaultPrevented:W.returnValue===!1)?Zl:bv,this.isPropagationStopped=bv,this}return F(y.prototype,{preventDefault:function(){this.defaultPrevented=!0;var M=this.nativeEvent;M&&(M.preventDefault?M.preventDefault():typeof M.returnValue!="unknown"&&(M.returnValue=!1),this.isDefaultPrevented=Zl)},stopPropagation:function(){var M=this.nativeEvent;M&&(M.stopPropagation?M.stopPropagation():typeof M.cancelBubble!="unknown"&&(M.cancelBubble=!0),this.isPropagationStopped=Zl)},persist:function(){},isPersistent:Zl}),y}var hh={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(f){return f.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},em=Ks(hh),dh=F({},hh,{view:0,detail:0}),Xd=Ks(dh),_a,yo,xo,Yd=F({},dh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:$u,button:0,buttons:0,relatedTarget:function(f){return f.relatedTarget===void 0?f.fromElement===f.srcElement?f.toElement:f.fromElement:f.relatedTarget},movementX:function(f){return"movementX"in f?f.movementX:(f!==xo&&(xo&&f.type==="mousemove"?(_a=f.screenX-xo.screenX,yo=f.screenY-xo.screenY):yo=_a=0,xo=f),_a)},movementY:function(f){return"movementY"in f?f.movementY:yo}}),n1=Ks(Yd),Jl=F({},Yd,{dataTransfer:0}),Ju=Ks(Jl),_v=F({},dh,{relatedTarget:0}),Sv=Ks(_v),Mv=F({},hh,{animationName:0,elapsedTime:0,pseudoElement:0}),oS=Ks(Mv),lS=F({},hh,{clipboardData:function(f){return"clipboardData"in f?f.clipboardData:window.clipboardData}}),s1=Ks(lS),Av=F({},hh,{data:0}),a1=Ks(Av),uS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},cS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},o1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Qd(f){var y=this.nativeEvent;return y.getModifierState?y.getModifierState(f):(f=o1[f])?!!y[f]:!1}function $u(){return Qd}var Ev=F({},dh,{key:function(f){if(f.key){var y=uS[f.key]||f.key;if(y!=="Unidentified")return y}return f.type==="keypress"?(f=ch(f),f===13?"Enter":String.fromCharCode(f)):f.type==="keydown"||f.type==="keyup"?cS[f.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:$u,charCode:function(f){return f.type==="keypress"?ch(f):0},keyCode:function(f){return f.type==="keydown"||f.type==="keyup"?f.keyCode:0},which:function(f){return f.type==="keypress"?ch(f):f.type==="keydown"||f.type==="keyup"?f.keyCode:0}}),Cv=Ks(Ev),wo=F({},Yd,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ha=Ks(wo),fh=F({},dh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:$u}),$l=Ks(fh),eu=F({},hh,{propertyName:0,elapsedTime:0,pseudoElement:0}),ph=Ks(eu),hS=F({},Yd,{deltaX:function(f){return"deltaX"in f?f.deltaX:"wheelDeltaX"in f?-f.wheelDeltaX:0},deltaY:function(f){return"deltaY"in f?f.deltaY:"wheelDeltaY"in f?-f.wheelDeltaY:"wheelDelta"in f?-f.wheelDelta:0},deltaZ:0,deltaMode:0}),l1=Ks(hS),u1=[9,13,27,32],Zs=o&&"CompositionEvent"in window,cs=null;o&&"documentMode"in document&&(cs=document.documentMode);var Br=o&&"TextEvent"in window&&!cs,Kd=o&&(!Zs||cs&&8<cs&&11>=cs),bo=" ",c1=!1;function h1(f,y){switch(f){case"keyup":return u1.indexOf(y.keyCode)!==-1;case"keydown":return y.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Tv(f){return f=f.detail,typeof f=="object"&&"data"in f?f.data:null}var ec=!1;function dS(f,y){switch(f){case"compositionend":return Tv(y);case"keypress":return y.which!==32?null:(c1=!0,bo);case"textInput":return f=y.data,f===bo&&c1?null:f;default:return null}}function tm(f,y){if(ec)return f==="compositionend"||!Zs&&h1(f,y)?(f=$p(),ba=r1=Yo=null,ec=!1,f):null;switch(f){case"paste":return null;case"keypress":if(!(y.ctrlKey||y.altKey||y.metaKey)||y.ctrlKey&&y.altKey){if(y.char&&1<y.char.length)return y.char;if(y.which)return String.fromCharCode(y.which)}return null;case"compositionend":return Kd&&y.locale!=="ko"?null:y.data;default:return null}}var Zd={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Pv(f){var y=f&&f.nodeName&&f.nodeName.toLowerCase();return y==="input"?!!Zd[f.type]:y==="textarea"}function Jd(f,y,M,R){Ut(R),y=Uv(y,"onChange"),0<y.length&&(M=new em("onChange","change",null,M,R),f.push({event:M,listeners:y}))}var tc=null,$d=null;function fS(f){nf(f,0)}function tu(f){var y=nn(f);if(Me(y))return f}function pS(f,y){if(f==="change")return y}var ef=!1;if(o){var Sa;if(o){var mh="oninput"in document;if(!mh){var gh=document.createElement("div");gh.setAttribute("oninput","return;"),mh=typeof gh.oninput=="function"}Sa=mh}else Sa=!1;ef=Sa&&(!document.documentMode||9<document.documentMode)}function Qo(){tc&&(tc.detachEvent("onpropertychange",Dv),$d=tc=null)}function Dv(f){if(f.propertyName==="value"&&tu($d)){var y=[];Jd(y,$d,f,ie(f)),Yi(fS,y)}}function tf(f,y,M){f==="focusin"?(Qo(),tc=y,$d=M,tc.attachEvent("onpropertychange",Dv)):f==="focusout"&&Qo()}function mS(f){if(f==="selectionchange"||f==="keyup"||f==="keydown")return tu($d)}function d1(f,y){if(f==="click")return tu(y)}function Hr(f,y){if(f==="input"||f==="change")return tu(y)}function Rv(f,y){return f===y&&(f!==0||1/f===1/y)||f!==f&&y!==y}var Wa=typeof Object.is=="function"?Object.is:Rv;function vh(f,y){if(Wa(f,y))return!0;if(typeof f!="object"||f===null||typeof y!="object"||y===null)return!1;var M=Object.keys(f),R=Object.keys(y);if(M.length!==R.length)return!1;for(R=0;R<M.length;R++){var k=M[R];if(!l.call(y,k)||!Wa(f[k],y[k]))return!1}return!0}function im(f){for(;f&&f.firstChild;)f=f.firstChild;return f}function Ga(f,y){var M=im(f);f=0;for(var R;M;){if(M.nodeType===3){if(R=f+M.textContent.length,f<=y&&R>=y)return{node:M,offset:y-f};f=R}e:{for(;M;){if(M.nextSibling){M=M.nextSibling;break e}M=M.parentNode}M=void 0}M=im(M)}}function yh(f,y){return f&&y?f===y?!0:f&&f.nodeType===3?!1:y&&y.nodeType===3?yh(f,y.parentNode):"contains"in f?f.contains(y):f.compareDocumentPosition?!!(f.compareDocumentPosition(y)&16):!1:!1}function Wr(){for(var f=window,y=De();y instanceof f.HTMLIFrameElement;){try{var M=typeof y.contentWindow.location.href=="string"}catch{M=!1}if(M)f=y.contentWindow;else break;y=De(f.document)}return y}function Un(f){var y=f&&f.nodeName&&f.nodeName.toLowerCase();return y&&(y==="input"&&(f.type==="text"||f.type==="search"||f.type==="tel"||f.type==="url"||f.type==="password")||y==="textarea"||f.contentEditable==="true")}function Vn(f){var y=Wr(),M=f.focusedElem,R=f.selectionRange;if(y!==M&&M&&M.ownerDocument&&yh(M.ownerDocument.documentElement,M)){if(R!==null&&Un(M)){if(y=R.start,f=R.end,f===void 0&&(f=y),"selectionStart"in M)M.selectionStart=y,M.selectionEnd=Math.min(f,M.value.length);else if(f=(y=M.ownerDocument||document)&&y.defaultView||window,f.getSelection){f=f.getSelection();var k=M.textContent.length,W=Math.min(R.start,k);R=R.end===void 0?W:Math.min(R.end,k),!f.extend&&W>R&&(k=R,R=W,W=k),k=Ga(M,W);var se=Ga(M,R);k&&se&&(f.rangeCount!==1||f.anchorNode!==k.node||f.anchorOffset!==k.offset||f.focusNode!==se.node||f.focusOffset!==se.offset)&&(y=y.createRange(),y.setStart(k.node,k.offset),f.removeAllRanges(),W>R?(f.addRange(y),f.extend(se.node,se.offset)):(y.setEnd(se.node,se.offset),f.addRange(y)))}}for(y=[],f=M;f=f.parentNode;)f.nodeType===1&&y.push({element:f,left:f.scrollLeft,top:f.scrollTop});for(typeof M.focus=="function"&&M.focus(),M=0;M<y.length;M++)f=y[M],f.element.scrollLeft=f.left,f.element.scrollTop=f.top}}var Iv=o&&"documentMode"in document&&11>=document.documentMode,vl=null,xh=null,rm=null,jn=!1;function Lv(f,y,M){var R=M.window===M?M.document:M.nodeType===9?M:M.ownerDocument;jn||vl==null||vl!==De(R)||(R=vl,"selectionStart"in R&&Un(R)?R={start:R.selectionStart,end:R.selectionEnd}:(R=(R.ownerDocument&&R.ownerDocument.defaultView||window).getSelection(),R={anchorNode:R.anchorNode,anchorOffset:R.anchorOffset,focusNode:R.focusNode,focusOffset:R.focusOffset}),rm&&vh(rm,R)||(rm=R,R=Uv(xh,"onSelect"),0<R.length&&(y=new em("onSelect","select",null,y,M),f.push({event:y,listeners:R}),y.target=vl)))}function rf(f,y){var M={};return M[f.toLowerCase()]=y.toLowerCase(),M["Webkit"+f]="webkit"+y,M["Moz"+f]="moz"+y,M}var ic={animationend:rf("Animation","AnimationEnd"),animationiteration:rf("Animation","AnimationIteration"),animationstart:rf("Animation","AnimationStart"),transitionend:rf("Transition","TransitionEnd")},Ko={},Zo={};o&&(Zo=document.createElement("div").style,"AnimationEvent"in window||(delete ic.animationend.animation,delete ic.animationiteration.animation,delete ic.animationstart.animation),"TransitionEvent"in window||delete ic.transitionend.transition);function yl(f){if(Ko[f])return Ko[f];if(!ic[f])return f;var y=ic[f],M;for(M in y)if(y.hasOwnProperty(M)&&M in Zo)return Ko[f]=y[M];return f}var nm=yl("animationend"),sm=yl("animationiteration"),f1=yl("animationstart"),p1=yl("transitionend"),m1=new Map,g1="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function iu(f,y){m1.set(f,y),s(y,[f])}for(var Ov=0;Ov<g1.length;Ov++){var am=g1[Ov],om=am.toLowerCase(),gS=am[0].toUpperCase()+am.slice(1);iu(om,"on"+gS)}iu(nm,"onAnimationEnd"),iu(sm,"onAnimationIteration"),iu(f1,"onAnimationStart"),iu("dblclick","onDoubleClick"),iu("focusin","onFocus"),iu("focusout","onBlur"),iu(p1,"onTransitionEnd"),a("onMouseEnter",["mouseout","mouseover"]),a("onMouseLeave",["mouseout","mouseover"]),a("onPointerEnter",["pointerout","pointerover"]),a("onPointerLeave",["pointerout","pointerover"]),s("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),s("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),s("onBeforeInput",["compositionend","keypress","textInput","paste"]),s("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var rc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),zv=new Set("cancel close invalid load scroll toggle".split(" ").concat(rc));function kv(f,y,M){var R=f.type||"unknown-event";f.currentTarget=M,gt(R,y,void 0,f),f.currentTarget=null}function nf(f,y){y=(y&4)!==0;for(var M=0;M<f.length;M++){var R=f[M],k=R.event;R=R.listeners;e:{var W=void 0;if(y)for(var se=R.length-1;0<=se;se--){var Te=R[se],Le=Te.instance,Ze=Te.currentTarget;if(Te=Te.listener,Le!==W&&k.isPropagationStopped())break e;kv(k,Te,Ze),W=Le}else for(se=0;se<R.length;se++){if(Te=R[se],Le=Te.instance,Ze=Te.currentTarget,Te=Te.listener,Le!==W&&k.isPropagationStopped())break e;kv(k,Te,Ze),W=Le}}}if(ve)throw f=fe,ve=!1,fe=null,f}function Ar(f,y){var M=y[_h];M===void 0&&(M=y[_h]=new Set);var R=f+"__bubble";M.has(R)||(Nv(y,f,2,!1),M.add(R))}function Bv(f,y,M){var R=0;y&&(R|=4),Nv(M,f,R,y)}var lm="_reactListening"+Math.random().toString(36).slice(2);function sf(f){if(!f[lm]){f[lm]=!0,r.forEach(function(M){M!=="selectionchange"&&(zv.has(M)||Bv(M,!1,f),Bv(M,!0,f))});var y=f.nodeType===9?f:f.ownerDocument;y===null||y[lm]||(y[lm]=!0,Bv("selectionchange",!1,y))}}function Nv(f,y,M,R){switch(aS(y)){case 1:var k=yv;break;case 4:k=i1;break;default:k=xv}M=k.bind(null,y,M,f),k=void 0,!po||y!=="touchstart"&&y!=="touchmove"&&y!=="wheel"||(k=!0),R?k!==void 0?f.addEventListener(y,M,{capture:!0,passive:k}):f.addEventListener(y,M,!0):k!==void 0?f.addEventListener(y,M,{passive:k}):f.addEventListener(y,M,!1)}function Fv(f,y,M,R,k){var W=R;if((y&1)===0&&(y&2)===0&&R!==null)e:for(;;){if(R===null)return;var se=R.tag;if(se===3||se===4){var Te=R.stateNode.containerInfo;if(Te===k||Te.nodeType===8&&Te.parentNode===k)break;if(se===4)for(se=R.return;se!==null;){var Le=se.tag;if((Le===3||Le===4)&&(Le=se.stateNode.containerInfo,Le===k||Le.nodeType===8&&Le.parentNode===k))return;se=se.return}for(;Te!==null;){if(se=nc(Te),se===null)return;if(Le=se.tag,Le===5||Le===6){R=W=se;continue e}Te=Te.parentNode}}R=R.return}Yi(function(){var Ze=W,_t=ie(M),Mt=[];e:{var wt=m1.get(f);if(wt!==void 0){var Wt=em,Zt=f;switch(f){case"keypress":if(ch(M)===0)break e;case"keydown":case"keyup":Wt=Cv;break;case"focusin":Zt="focus",Wt=Sv;break;case"focusout":Zt="blur",Wt=Sv;break;case"beforeblur":case"afterblur":Wt=Sv;break;case"click":if(M.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Wt=n1;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Wt=Ju;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Wt=$l;break;case nm:case sm:case f1:Wt=oS;break;case p1:Wt=ph;break;case"scroll":Wt=Xd;break;case"wheel":Wt=l1;break;case"copy":case"cut":case"paste":Wt=s1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Wt=Ha}var ti=(y&4)!==0,Tn=!ti&&f==="scroll",je=ti?wt!==null?wt+"Capture":null:wt;ti=[];for(var ke=Ze,qe;ke!==null;){qe=ke;var Pt=qe.stateNode;if(qe.tag===5&&Pt!==null&&(qe=Pt,je!==null&&(Pt=ji(ke,je),Pt!=null&&ti.push(af(ke,Pt,qe)))),Tn)break;ke=ke.return}0<ti.length&&(wt=new Wt(wt,Zt,null,M,_t),Mt.push({event:wt,listeners:ti}))}}if((y&7)===0){e:{if(wt=f==="mouseover"||f==="pointerover",Wt=f==="mouseout"||f==="pointerout",wt&&M!==At&&(Zt=M.relatedTarget||M.fromElement)&&(nc(Zt)||Zt[qa]))break e;if((Wt||wt)&&(wt=_t.window===_t?_t:(wt=_t.ownerDocument)?wt.defaultView||wt.parentWindow:window,Wt?(Zt=M.relatedTarget||M.toElement,Wt=Ze,Zt=Zt?nc(Zt):null,Zt!==null&&(Tn=St(Zt),Zt!==Tn||Zt.tag!==5&&Zt.tag!==6)&&(Zt=null)):(Wt=null,Zt=Ze),Wt!==Zt)){if(ti=n1,Pt="onMouseLeave",je="onMouseEnter",ke="mouse",(f==="pointerout"||f==="pointerover")&&(ti=Ha,Pt="onPointerLeave",je="onPointerEnter",ke="pointer"),Tn=Wt==null?wt:nn(Wt),qe=Zt==null?wt:nn(Zt),wt=new ti(Pt,ke+"leave",Wt,M,_t),wt.target=Tn,wt.relatedTarget=qe,Pt=null,nc(_t)===Ze&&(ti=new ti(je,ke+"enter",Zt,M,_t),ti.target=qe,ti.relatedTarget=Tn,Pt=ti),Tn=Pt,Wt&&Zt)t:{for(ti=Wt,je=Zt,ke=0,qe=ti;qe;qe=wh(qe))ke++;for(qe=0,Pt=je;Pt;Pt=wh(Pt))qe++;for(;0<ke-qe;)ti=wh(ti),ke--;for(;0<qe-ke;)je=wh(je),qe--;for(;ke--;){if(ti===je||je!==null&&ti===je.alternate)break t;ti=wh(ti),je=wh(je)}ti=null}else ti=null;Wt!==null&&vS(Mt,wt,Wt,ti,!1),Zt!==null&&Tn!==null&&vS(Mt,Tn,Zt,ti,!0)}}e:{if(wt=Ze?nn(Ze):window,Wt=wt.nodeName&&wt.nodeName.toLowerCase(),Wt==="select"||Wt==="input"&&wt.type==="file")var ni=pS;else if(Pv(wt))if(ef)ni=Hr;else{ni=mS;var mi=tf}else(Wt=wt.nodeName)&&Wt.toLowerCase()==="input"&&(wt.type==="checkbox"||wt.type==="radio")&&(ni=d1);if(ni&&(ni=ni(f,Ze))){Jd(Mt,ni,M,_t);break e}mi&&mi(f,wt,Ze),f==="focusout"&&(mi=wt._wrapperState)&&mi.controlled&&wt.type==="number"&&Ke(wt,"number",wt.value)}switch(mi=Ze?nn(Ze):window,f){case"focusin":(Pv(mi)||mi.contentEditable==="true")&&(vl=mi,xh=Ze,rm=null);break;case"focusout":rm=xh=vl=null;break;case"mousedown":jn=!0;break;case"contextmenu":case"mouseup":case"dragend":jn=!1,Lv(Mt,M,_t);break;case"selectionchange":if(Iv)break;case"keydown":case"keyup":Lv(Mt,M,_t)}var gi;if(Zs)e:{switch(f){case"compositionstart":var Ci="onCompositionStart";break e;case"compositionend":Ci="onCompositionEnd";break e;case"compositionupdate":Ci="onCompositionUpdate";break e}Ci=void 0}else ec?h1(f,M)&&(Ci="onCompositionEnd"):f==="keydown"&&M.keyCode===229&&(Ci="onCompositionStart");Ci&&(Kd&&M.locale!=="ko"&&(ec||Ci!=="onCompositionStart"?Ci==="onCompositionEnd"&&ec&&(gi=$p()):(Yo=_t,r1="value"in Yo?Yo.value:Yo.textContent,ec=!0)),mi=Uv(Ze,Ci),0<mi.length&&(Ci=new a1(Ci,f,null,M,_t),Mt.push({event:Ci,listeners:mi}),gi?Ci.data=gi:(gi=Tv(M),gi!==null&&(Ci.data=gi)))),(gi=Br?dS(f,M):tm(f,M))&&(Ze=Uv(Ze,"onBeforeInput"),0<Ze.length&&(_t=new a1("onBeforeInput","beforeinput",null,M,_t),Mt.push({event:_t,listeners:Ze}),_t.data=gi))}nf(Mt,y)})}function af(f,y,M){return{instance:f,listener:y,currentTarget:M}}function Uv(f,y){for(var M=y+"Capture",R=[];f!==null;){var k=f,W=k.stateNode;k.tag===5&&W!==null&&(k=W,W=ji(f,M),W!=null&&R.unshift(af(f,W,k)),W=ji(f,y),W!=null&&R.push(af(f,W,k))),f=f.return}return R}function wh(f){if(f===null)return null;do f=f.return;while(f&&f.tag!==5);return f||null}function vS(f,y,M,R,k){for(var W=y._reactName,se=[];M!==null&&M!==R;){var Te=M,Le=Te.alternate,Ze=Te.stateNode;if(Le!==null&&Le===R)break;Te.tag===5&&Ze!==null&&(Te=Ze,k?(Le=ji(M,W),Le!=null&&se.unshift(af(M,Le,Te))):k||(Le=ji(M,W),Le!=null&&se.push(af(M,Le,Te)))),M=M.return}se.length!==0&&f.push({event:y,listeners:se})}var AT=/\r\n?/g,yS=/\u0000|\uFFFD/g;function v1(f){return(typeof f=="string"?f:""+f).replace(AT,`
`).replace(yS,"")}function um(f,y,M){if(y=v1(y),v1(f)!==y&&M)throw Error(i(425))}function cm(){}var of=null,y1=null;function x1(f,y){return f==="textarea"||f==="noscript"||typeof y.children=="string"||typeof y.children=="number"||typeof y.dangerouslySetInnerHTML=="object"&&y.dangerouslySetInnerHTML!==null&&y.dangerouslySetInnerHTML.__html!=null}var w1=typeof setTimeout=="function"?setTimeout:void 0,b1=typeof clearTimeout=="function"?clearTimeout:void 0,Vv=typeof Promise=="function"?Promise:void 0,ET=typeof queueMicrotask=="function"?queueMicrotask:typeof Vv<"u"?function(f){return Vv.resolve(null).then(f).catch(xS)}:w1;function xS(f){setTimeout(function(){throw f})}function jv(f,y){var M=y,R=0;do{var k=M.nextSibling;if(f.removeChild(M),k&&k.nodeType===8)if(M=k.data,M==="/$"){if(R===0){f.removeChild(k),Jp(y);return}R--}else M!=="$"&&M!=="$?"&&M!=="$!"||R++;M=k}while(M);Jp(y)}function ru(f){for(;f!=null;f=f.nextSibling){var y=f.nodeType;if(y===1||y===3)break;if(y===8){if(y=f.data,y==="$"||y==="$!"||y==="$?")break;if(y==="/$")return null}}return f}function _1(f){f=f.previousSibling;for(var y=0;f;){if(f.nodeType===8){var M=f.data;if(M==="$"||M==="$!"||M==="$?"){if(y===0)return f;y--}else M==="/$"&&y++}f=f.previousSibling}return null}var bh=Math.random().toString(36).slice(2),En="__reactFiber$"+bh,lf="__reactProps$"+bh,qa="__reactContainer$"+bh,_h="__reactEvents$"+bh,Hv="__reactListeners$"+bh,Wv="__reactHandles$"+bh;function nc(f){var y=f[En];if(y)return y;for(var M=f.parentNode;M;){if(y=M[qa]||M[En]){if(M=y.alternate,y.child!==null||M!==null&&M.child!==null)for(f=_1(f);f!==null;){if(M=f[En])return M;f=_1(f)}return y}f=M,M=f.parentNode}return null}function nu(f){return f=f[En]||f[qa],!f||f.tag!==5&&f.tag!==6&&f.tag!==13&&f.tag!==3?null:f}function nn(f){if(f.tag===5||f.tag===6)return f.stateNode;throw Error(i(33))}function Gv(f){return f[lf]||null}var S1=[],Hn=-1;function Kr(f){return{current:f}}function Er(f){0>Hn||(f.current=S1[Hn],S1[Hn]=null,Hn--)}function yr(f,y){Hn++,S1[Hn]=f.current,f.current=y}var su={},hs=Kr(su),Js=Kr(!1),au=su;function Sh(f,y){var M=f.type.contextTypes;if(!M)return su;var R=f.stateNode;if(R&&R.__reactInternalMemoizedUnmaskedChildContext===y)return R.__reactInternalMemoizedMaskedChildContext;var k={},W;for(W in M)k[W]=y[W];return R&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=y,f.__reactInternalMemoizedMaskedChildContext=k),k}function Ds(f){return f=f.childContextTypes,f!=null}function hm(){Er(Js),Er(hs)}function M1(f,y,M){if(hs.current!==su)throw Error(i(168));yr(hs,y),yr(Js,M)}function dm(f,y,M){var R=f.stateNode;if(y=y.childContextTypes,typeof R.getChildContext!="function")return M;R=R.getChildContext();for(var k in R)if(!(k in y))throw Error(i(108,me(f)||"Unknown",k));return F({},M,R)}function Mh(f){return f=(f=f.stateNode)&&f.__reactInternalMemoizedMergedChildContext||su,au=hs.current,yr(hs,f),yr(Js,Js.current),!0}function A1(f,y,M){var R=f.stateNode;if(!R)throw Error(i(169));M?(f=dm(f,y,au),R.__reactInternalMemoizedMergedChildContext=f,Er(Js),Er(hs),yr(hs,f)):Er(Js),yr(Js,M)}var Jo=null,fm=!1,qv=!1;function pm(f){Jo===null?Jo=[f]:Jo.push(f)}function wS(f){fm=!0,pm(f)}function xl(){if(!qv&&Jo!==null){qv=!0;var f=0,y=rr;try{var M=Jo;for(rr=1;f<M.length;f++){var R=M[f];do R=R(!0);while(R!==null)}Jo=null,fm=!1}catch(k){throw Jo!==null&&(Jo=Jo.slice(f+1)),$t(Hi,xl),k}finally{rr=y,qv=!1}}return null}var Ah=[],Ma=0,Xv=null,Yv=0,$s=[],Wn=0,Eh=null,It=1,_o="";function ou(f,y){Ah[Ma++]=Yv,Ah[Ma++]=Xv,Xv=f,Yv=y}function E1(f,y,M){$s[Wn++]=It,$s[Wn++]=_o,$s[Wn++]=Eh,Eh=f;var R=It;f=_o;var k=32-Se(R)-1;R&=~(1<<k),M+=1;var W=32-Se(y)+k;if(30<W){var se=k-k%5;W=(R&(1<<se)-1).toString(32),R>>=se,k-=se,It=1<<32-Se(y)+k|M<<k|R,_o=W+f}else It=1<<W|M<<k|R,_o=f}function C1(f){f.return!==null&&(ou(f,1),E1(f,1,0))}function lu(f){for(;f===Xv;)Xv=Ah[--Ma],Ah[Ma]=null,Yv=Ah[--Ma],Ah[Ma]=null;for(;f===Eh;)Eh=$s[--Wn],$s[Wn]=null,_o=$s[--Wn],$s[Wn]=null,It=$s[--Wn],$s[Wn]=null}var ds=null,ea=null,Rr=!1,So=null;function T1(f,y){var M=Al(5,null,null,0);M.elementType="DELETED",M.stateNode=y,M.return=f,y=f.deletions,y===null?(f.deletions=[M],f.flags|=16):y.push(M)}function P1(f,y){switch(f.tag){case 5:var M=f.type;return y=y.nodeType!==1||M.toLowerCase()!==y.nodeName.toLowerCase()?null:y,y!==null?(f.stateNode=y,ds=f,ea=ru(y.firstChild),!0):!1;case 6:return y=f.pendingProps===""||y.nodeType!==3?null:y,y!==null?(f.stateNode=y,ds=f,ea=null,!0):!1;case 13:return y=y.nodeType!==8?null:y,y!==null?(M=Eh!==null?{id:It,overflow:_o}:null,f.memoizedState={dehydrated:y,treeContext:M,retryLane:1073741824},M=Al(18,null,null,0),M.stateNode=y,M.return=f,f.child=M,ds=f,ea=null,!0):!1;default:return!1}}function Qv(f){return(f.mode&1)!==0&&(f.flags&128)===0}function Kv(f){if(Rr){var y=ea;if(y){var M=y;if(!P1(f,y)){if(Qv(f))throw Error(i(418));y=ru(M.nextSibling);var R=ds;y&&P1(f,y)?T1(R,M):(f.flags=f.flags&-4097|2,Rr=!1,ds=f)}}else{if(Qv(f))throw Error(i(418));f.flags=f.flags&-4097|2,Rr=!1,ds=f}}}function Zv(f){for(f=f.return;f!==null&&f.tag!==5&&f.tag!==3&&f.tag!==13;)f=f.return;ds=f}function uf(f){if(f!==ds)return!1;if(!Rr)return Zv(f),Rr=!0,!1;var y;if((y=f.tag!==3)&&!(y=f.tag!==5)&&(y=f.type,y=y!=="head"&&y!=="body"&&!x1(f.type,f.memoizedProps)),y&&(y=ea)){if(Qv(f))throw D1(),Error(i(418));for(;y;)T1(f,y),y=ru(y.nextSibling)}if(Zv(f),f.tag===13){if(f=f.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(i(317));e:{for(f=f.nextSibling,y=0;f;){if(f.nodeType===8){var M=f.data;if(M==="/$"){if(y===0){ea=ru(f.nextSibling);break e}y--}else M!=="$"&&M!=="$!"&&M!=="$?"||y++}f=f.nextSibling}ea=null}}else ea=ds?ru(f.stateNode.nextSibling):null;return!0}function D1(){for(var f=ea;f;)f=ru(f.nextSibling)}function sc(){ea=ds=null,Rr=!1}function cf(f){So===null?So=[f]:So.push(f)}var CT=A.ReactCurrentBatchConfig;function $o(f,y){if(f&&f.defaultProps){y=F({},y),f=f.defaultProps;for(var M in f)y[M]===void 0&&(y[M]=f[M]);return y}return y}var mm=Kr(null),gm=null,Ch=null,Jv=null;function hf(){Jv=Ch=gm=null}function df(f){var y=mm.current;Er(mm),f._currentValue=y}function ff(f,y,M){for(;f!==null;){var R=f.alternate;if((f.childLanes&y)!==y?(f.childLanes|=y,R!==null&&(R.childLanes|=y)):R!==null&&(R.childLanes&y)!==y&&(R.childLanes|=y),f===M)break;f=f.return}}function uu(f,y){gm=f,Jv=Ch=null,f=f.dependencies,f!==null&&f.firstContext!==null&&((f.lanes&y)!==0&&(jt=!0),f.firstContext=null)}function ta(f){var y=f._currentValue;if(Jv!==f)if(f={context:f,memoizedValue:y,next:null},Ch===null){if(gm===null)throw Error(i(308));Ch=f,gm.dependencies={lanes:0,firstContext:f}}else Ch=Ch.next=f;return y}var el=null;function vm(f){el===null?el=[f]:el.push(f)}function $v(f,y,M,R){var k=y.interleaved;return k===null?(M.next=M,vm(y)):(M.next=k.next,k.next=M),y.interleaved=M,tl(f,R)}function tl(f,y){f.lanes|=y;var M=f.alternate;for(M!==null&&(M.lanes|=y),M=f,f=f.return;f!==null;)f.childLanes|=y,M=f.alternate,M!==null&&(M.childLanes|=y),M=f,f=f.return;return M.tag===3?M.stateNode:null}var cu=!1;function ym(f){f.updateQueue={baseState:f.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function bS(f,y){f=f.updateQueue,y.updateQueue===f&&(y.updateQueue={baseState:f.baseState,firstBaseUpdate:f.firstBaseUpdate,lastBaseUpdate:f.lastBaseUpdate,shared:f.shared,effects:f.effects})}function Mo(f,y){return{eventTime:f,lane:y,tag:0,payload:null,callback:null,next:null}}function wl(f,y,M){var R=f.updateQueue;if(R===null)return null;if(R=R.shared,(or&2)!==0){var k=R.pending;return k===null?y.next=y:(y.next=k.next,k.next=y),R.pending=y,tl(f,M)}return k=R.interleaved,k===null?(y.next=y,vm(R)):(y.next=k.next,k.next=y),R.interleaved=y,tl(f,M)}function Nr(f,y,M){if(y=y.updateQueue,y!==null&&(y=y.shared,(M&4194240)!==0)){var R=y.lanes;R&=f.pendingLanes,M|=R,y.lanes=M,Wd(f,M)}}function ki(f,y){var M=f.updateQueue,R=f.alternate;if(R!==null&&(R=R.updateQueue,M===R)){var k=null,W=null;if(M=M.firstBaseUpdate,M!==null){do{var se={eventTime:M.eventTime,lane:M.lane,tag:M.tag,payload:M.payload,callback:M.callback,next:null};W===null?k=W=se:W=W.next=se,M=M.next}while(M!==null);W===null?k=W=y:W=W.next=y}else k=W=y;M={baseState:R.baseState,firstBaseUpdate:k,lastBaseUpdate:W,shared:R.shared,effects:R.effects},f.updateQueue=M;return}f=M.lastBaseUpdate,f===null?M.firstBaseUpdate=y:f.next=y,M.lastBaseUpdate=y}function Gr(f,y,M,R){var k=f.updateQueue;cu=!1;var W=k.firstBaseUpdate,se=k.lastBaseUpdate,Te=k.shared.pending;if(Te!==null){k.shared.pending=null;var Le=Te,Ze=Le.next;Le.next=null,se===null?W=Ze:se.next=Ze,se=Le;var _t=f.alternate;_t!==null&&(_t=_t.updateQueue,Te=_t.lastBaseUpdate,Te!==se&&(Te===null?_t.firstBaseUpdate=Ze:Te.next=Ze,_t.lastBaseUpdate=Le))}if(W!==null){var Mt=k.baseState;se=0,_t=Ze=Le=null,Te=W;do{var wt=Te.lane,Wt=Te.eventTime;if((R&wt)===wt){_t!==null&&(_t=_t.next={eventTime:Wt,lane:0,tag:Te.tag,payload:Te.payload,callback:Te.callback,next:null});e:{var Zt=f,ti=Te;switch(wt=y,Wt=M,ti.tag){case 1:if(Zt=ti.payload,typeof Zt=="function"){Mt=Zt.call(Wt,Mt,wt);break e}Mt=Zt;break e;case 3:Zt.flags=Zt.flags&-65537|128;case 0:if(Zt=ti.payload,wt=typeof Zt=="function"?Zt.call(Wt,Mt,wt):Zt,wt==null)break e;Mt=F({},Mt,wt);break e;case 2:cu=!0}}Te.callback!==null&&Te.lane!==0&&(f.flags|=64,wt=k.effects,wt===null?k.effects=[Te]:wt.push(Te))}else Wt={eventTime:Wt,lane:wt,tag:Te.tag,payload:Te.payload,callback:Te.callback,next:null},_t===null?(Ze=_t=Wt,Le=Mt):_t=_t.next=Wt,se|=wt;if(Te=Te.next,Te===null){if(Te=k.shared.pending,Te===null)break;wt=Te,Te=wt.next,wt.next=null,k.lastBaseUpdate=wt,k.shared.pending=null}}while(!0);if(_t===null&&(Le=Mt),k.baseState=Le,k.firstBaseUpdate=Ze,k.lastBaseUpdate=_t,y=k.shared.interleaved,y!==null){k=y;do se|=k.lane,k=k.next;while(k!==y)}else W===null&&(k.shared.lanes=0);Am|=se,f.lanes=se,f.memoizedState=Mt}}function sn(f,y,M){if(f=y.effects,y.effects=null,f!==null)for(y=0;y<f.length;y++){var R=f[y],k=R.callback;if(k!==null){if(R.callback=null,R=M,typeof k!="function")throw Error(i(191,k));k.call(R)}}}var Gn=new e.Component().refs;function ia(f,y,M,R){y=f.memoizedState,M=M(R,y),M=M==null?y:F({},y,M),f.memoizedState=M,f.lanes===0&&(f.updateQueue.baseState=M)}var hu={isMounted:function(f){return(f=f._reactInternals)?St(f)===f:!1},enqueueSetState:function(f,y,M){f=f._reactInternals;var R=Ka(),k=Mf(f),W=Mo(R,k);W.payload=y,M!=null&&(W.callback=M),y=wl(f,W,k),y!==null&&(mu(y,f,k,R),Nr(y,f,k))},enqueueReplaceState:function(f,y,M){f=f._reactInternals;var R=Ka(),k=Mf(f),W=Mo(R,k);W.tag=1,W.payload=y,M!=null&&(W.callback=M),y=wl(f,W,k),y!==null&&(mu(y,f,k,R),Nr(y,f,k))},enqueueForceUpdate:function(f,y){f=f._reactInternals;var M=Ka(),R=Mf(f),k=Mo(M,R);k.tag=2,y!=null&&(k.callback=y),y=wl(f,k,R),y!==null&&(mu(y,f,R,M),Nr(y,f,R))}};function dn(f,y,M,R,k,W,se){return f=f.stateNode,typeof f.shouldComponentUpdate=="function"?f.shouldComponentUpdate(R,W,se):y.prototype&&y.prototype.isPureReactComponent?!vh(M,R)||!vh(k,W):!0}function pf(f,y,M){var R=!1,k=su,W=y.contextType;return typeof W=="object"&&W!==null?W=ta(W):(k=Ds(y)?au:hs.current,R=y.contextTypes,W=(R=R!=null)?Sh(f,k):su),y=new y(M,W),f.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,y.updater=hu,f.stateNode=y,y._reactInternals=f,R&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=k,f.__reactInternalMemoizedMaskedChildContext=W),y}function Th(f,y,M,R){f=y.state,typeof y.componentWillReceiveProps=="function"&&y.componentWillReceiveProps(M,R),typeof y.UNSAFE_componentWillReceiveProps=="function"&&y.UNSAFE_componentWillReceiveProps(M,R),y.state!==f&&hu.enqueueReplaceState(y,y.state,null)}function mf(f,y,M,R){var k=f.stateNode;k.props=M,k.state=f.memoizedState,k.refs=Gn,ym(f);var W=y.contextType;typeof W=="object"&&W!==null?k.context=ta(W):(W=Ds(y)?au:hs.current,k.context=Sh(f,W)),k.state=f.memoizedState,W=y.getDerivedStateFromProps,typeof W=="function"&&(ia(f,y,W,M),k.state=f.memoizedState),typeof y.getDerivedStateFromProps=="function"||typeof k.getSnapshotBeforeUpdate=="function"||typeof k.UNSAFE_componentWillMount!="function"&&typeof k.componentWillMount!="function"||(y=k.state,typeof k.componentWillMount=="function"&&k.componentWillMount(),typeof k.UNSAFE_componentWillMount=="function"&&k.UNSAFE_componentWillMount(),y!==k.state&&hu.enqueueReplaceState(k,k.state,null),Gr(f,M,k,R),k.state=f.memoizedState),typeof k.componentDidMount=="function"&&(f.flags|=4194308)}function Ph(f,y,M){if(f=M.ref,f!==null&&typeof f!="function"&&typeof f!="object"){if(M._owner){if(M=M._owner,M){if(M.tag!==1)throw Error(i(309));var R=M.stateNode}if(!R)throw Error(i(147,f));var k=R,W=""+f;return y!==null&&y.ref!==null&&typeof y.ref=="function"&&y.ref._stringRef===W?y.ref:(y=function(se){var Te=k.refs;Te===Gn&&(Te=k.refs={}),se===null?delete Te[W]:Te[W]=se},y._stringRef=W,y)}if(typeof f!="string")throw Error(i(284));if(!M._owner)throw Error(i(290,f))}return f}function ac(f,y){throw f=Object.prototype.toString.call(y),Error(i(31,f==="[object Object]"?"object with keys {"+Object.keys(y).join(", ")+"}":f))}function ra(f){var y=f._init;return y(f._payload)}function e0(f){function y(je,ke){if(f){var qe=je.deletions;qe===null?(je.deletions=[ke],je.flags|=16):qe.push(ke)}}function M(je,ke){if(!f)return null;for(;ke!==null;)y(je,ke),ke=ke.sibling;return null}function R(je,ke){for(je=new Map;ke!==null;)ke.key!==null?je.set(ke.key,ke):je.set(ke.index,ke),ke=ke.sibling;return je}function k(je,ke){return je=Ef(je,ke),je.index=0,je.sibling=null,je}function W(je,ke,qe){return je.index=qe,f?(qe=je.alternate,qe!==null?(qe=qe.index,qe<ke?(je.flags|=2,ke):qe):(je.flags|=2,ke)):(je.flags|=1048576,ke)}function se(je){return f&&je.alternate===null&&(je.flags|=2),je}function Te(je,ke,qe,Pt){return ke===null||ke.tag!==6?(ke=qT(qe,je.mode,Pt),ke.return=je,ke):(ke=k(ke,qe),ke.return=je,ke)}function Le(je,ke,qe,Pt){var ni=qe.type;return ni===I?_t(je,ke,qe.props.children,Pt,qe.key):ke!==null&&(ke.elementType===ni||typeof ni=="object"&&ni!==null&&ni.$$typeof===ne&&ra(ni)===ke.type)?(Pt=k(ke,qe.props),Pt.ref=Ph(je,ke,qe),Pt.return=je,Pt):(Pt=GS(qe.type,qe.key,qe.props,null,je.mode,Pt),Pt.ref=Ph(je,ke,qe),Pt.return=je,Pt)}function Ze(je,ke,qe,Pt){return ke===null||ke.tag!==4||ke.stateNode.containerInfo!==qe.containerInfo||ke.stateNode.implementation!==qe.implementation?(ke=XT(qe,je.mode,Pt),ke.return=je,ke):(ke=k(ke,qe.children||[]),ke.return=je,ke)}function _t(je,ke,qe,Pt,ni){return ke===null||ke.tag!==7?(ke=Pm(qe,je.mode,Pt,ni),ke.return=je,ke):(ke=k(ke,qe),ke.return=je,ke)}function Mt(je,ke,qe){if(typeof ke=="string"&&ke!==""||typeof ke=="number")return ke=qT(""+ke,je.mode,qe),ke.return=je,ke;if(typeof ke=="object"&&ke!==null){switch(ke.$$typeof){case C:return qe=GS(ke.type,ke.key,ke.props,null,je.mode,qe),qe.ref=Ph(je,null,ke),qe.return=je,qe;case E:return ke=XT(ke,je.mode,qe),ke.return=je,ke;case ne:var Pt=ke._init;return Mt(je,Pt(ke._payload),qe)}if(bt(ke)||Z(ke))return ke=Pm(ke,je.mode,qe,null),ke.return=je,ke;ac(je,ke)}return null}function wt(je,ke,qe,Pt){var ni=ke!==null?ke.key:null;if(typeof qe=="string"&&qe!==""||typeof qe=="number")return ni!==null?null:Te(je,ke,""+qe,Pt);if(typeof qe=="object"&&qe!==null){switch(qe.$$typeof){case C:return qe.key===ni?Le(je,ke,qe,Pt):null;case E:return qe.key===ni?Ze(je,ke,qe,Pt):null;case ne:return ni=qe._init,wt(je,ke,ni(qe._payload),Pt)}if(bt(qe)||Z(qe))return ni!==null?null:_t(je,ke,qe,Pt,null);ac(je,qe)}return null}function Wt(je,ke,qe,Pt,ni){if(typeof Pt=="string"&&Pt!==""||typeof Pt=="number")return je=je.get(qe)||null,Te(ke,je,""+Pt,ni);if(typeof Pt=="object"&&Pt!==null){switch(Pt.$$typeof){case C:return je=je.get(Pt.key===null?qe:Pt.key)||null,Le(ke,je,Pt,ni);case E:return je=je.get(Pt.key===null?qe:Pt.key)||null,Ze(ke,je,Pt,ni);case ne:var mi=Pt._init;return Wt(je,ke,qe,mi(Pt._payload),ni)}if(bt(Pt)||Z(Pt))return je=je.get(qe)||null,_t(ke,je,Pt,ni,null);ac(ke,Pt)}return null}function Zt(je,ke,qe,Pt){for(var ni=null,mi=null,gi=ke,Ci=ke=0,Ls=null;gi!==null&&Ci<qe.length;Ci++){gi.index>Ci?(Ls=gi,gi=null):Ls=gi.sibling;var hr=wt(je,gi,qe[Ci],Pt);if(hr===null){gi===null&&(gi=Ls);break}f&&gi&&hr.alternate===null&&y(je,gi),ke=W(hr,ke,Ci),mi===null?ni=hr:mi.sibling=hr,mi=hr,gi=Ls}if(Ci===qe.length)return M(je,gi),Rr&&ou(je,Ci),ni;if(gi===null){for(;Ci<qe.length;Ci++)gi=Mt(je,qe[Ci],Pt),gi!==null&&(ke=W(gi,ke,Ci),mi===null?ni=gi:mi.sibling=gi,mi=gi);return Rr&&ou(je,Ci),ni}for(gi=R(je,gi);Ci<qe.length;Ci++)Ls=Wt(gi,je,Ci,qe[Ci],Pt),Ls!==null&&(f&&Ls.alternate!==null&&gi.delete(Ls.key===null?Ci:Ls.key),ke=W(Ls,ke,Ci),mi===null?ni=Ls:mi.sibling=Ls,mi=Ls);return f&&gi.forEach(function(Cf){return y(je,Cf)}),Rr&&ou(je,Ci),ni}function ti(je,ke,qe,Pt){var ni=Z(qe);if(typeof ni!="function")throw Error(i(150));if(qe=ni.call(qe),qe==null)throw Error(i(151));for(var mi=ni=null,gi=ke,Ci=ke=0,Ls=null,hr=qe.next();gi!==null&&!hr.done;Ci++,hr=qe.next()){gi.index>Ci?(Ls=gi,gi=null):Ls=gi.sibling;var Cf=wt(je,gi,hr.value,Pt);if(Cf===null){gi===null&&(gi=Ls);break}f&&gi&&Cf.alternate===null&&y(je,gi),ke=W(Cf,ke,Ci),mi===null?ni=Cf:mi.sibling=Cf,mi=Cf,gi=Ls}if(hr.done)return M(je,gi),Rr&&ou(je,Ci),ni;if(gi===null){for(;!hr.done;Ci++,hr=qe.next())hr=Mt(je,hr.value,Pt),hr!==null&&(ke=W(hr,ke,Ci),mi===null?ni=hr:mi.sibling=hr,mi=hr);return Rr&&ou(je,Ci),ni}for(gi=R(je,gi);!hr.done;Ci++,hr=qe.next())hr=Wt(gi,je,Ci,hr.value,Pt),hr!==null&&(f&&hr.alternate!==null&&gi.delete(hr.key===null?Ci:hr.key),ke=W(hr,ke,Ci),mi===null?ni=hr:mi.sibling=hr,mi=hr);return f&&gi.forEach(function(d$){return y(je,d$)}),Rr&&ou(je,Ci),ni}function Tn(je,ke,qe,Pt){if(typeof qe=="object"&&qe!==null&&qe.type===I&&qe.key===null&&(qe=qe.props.children),typeof qe=="object"&&qe!==null){switch(qe.$$typeof){case C:e:{for(var ni=qe.key,mi=ke;mi!==null;){if(mi.key===ni){if(ni=qe.type,ni===I){if(mi.tag===7){M(je,mi.sibling),ke=k(mi,qe.props.children),ke.return=je,je=ke;break e}}else if(mi.elementType===ni||typeof ni=="object"&&ni!==null&&ni.$$typeof===ne&&ra(ni)===mi.type){M(je,mi.sibling),ke=k(mi,qe.props),ke.ref=Ph(je,mi,qe),ke.return=je,je=ke;break e}M(je,mi);break}else y(je,mi);mi=mi.sibling}qe.type===I?(ke=Pm(qe.props.children,je.mode,Pt,qe.key),ke.return=je,je=ke):(Pt=GS(qe.type,qe.key,qe.props,null,je.mode,Pt),Pt.ref=Ph(je,ke,qe),Pt.return=je,je=Pt)}return se(je);case E:e:{for(mi=qe.key;ke!==null;){if(ke.key===mi)if(ke.tag===4&&ke.stateNode.containerInfo===qe.containerInfo&&ke.stateNode.implementation===qe.implementation){M(je,ke.sibling),ke=k(ke,qe.children||[]),ke.return=je,je=ke;break e}else{M(je,ke);break}else y(je,ke);ke=ke.sibling}ke=XT(qe,je.mode,Pt),ke.return=je,je=ke}return se(je);case ne:return mi=qe._init,Tn(je,ke,mi(qe._payload),Pt)}if(bt(qe))return Zt(je,ke,qe,Pt);if(Z(qe))return ti(je,ke,qe,Pt);ac(je,qe)}return typeof qe=="string"&&qe!==""||typeof qe=="number"?(qe=""+qe,ke!==null&&ke.tag===6?(M(je,ke.sibling),ke=k(ke,qe),ke.return=je,je=ke):(M(je,ke),ke=qT(qe,je.mode,Pt),ke.return=je,je=ke),se(je)):M(je,ke)}return Tn}var oc=e0(!0),Dh=e0(!1),lc={},Ao=Kr(lc),Eo=Kr(lc),uc=Kr(lc);function Aa(f){if(f===lc)throw Error(i(174));return f}function gf(f,y){switch(yr(uc,y),yr(Eo,f),yr(Ao,lc),f=y.nodeType,f){case 9:case 11:y=(y=y.documentElement)?y.namespaceURI:Ue(null,"");break;default:f=f===8?y.parentNode:y,y=f.namespaceURI||null,f=f.tagName,y=Ue(y,f)}Er(Ao),yr(Ao,y)}function bl(){Er(Ao),Er(Eo),Er(uc)}function t0(f){Aa(uc.current);var y=Aa(Ao.current),M=Ue(y,f.type);y!==M&&(yr(Eo,f),yr(Ao,M))}function vf(f){Eo.current===f&&(Er(Ao),Er(Eo))}var Cr=Kr(0);function qn(f){for(var y=f;y!==null;){if(y.tag===13){var M=y.memoizedState;if(M!==null&&(M=M.dehydrated,M===null||M.data==="$?"||M.data==="$!"))return y}else if(y.tag===19&&y.memoizedProps.revealOrder!==void 0){if((y.flags&128)!==0)return y}else if(y.child!==null){y.child.return=y,y=y.child;continue}if(y===f)break;for(;y.sibling===null;){if(y.return===null||y.return===f)return null;y=y.return}y.sibling.return=y.return,y=y.sibling}return null}var _l=[];function Ea(){for(var f=0;f<_l.length;f++)_l[f]._workInProgressVersionPrimary=null;_l.length=0}var Rh=A.ReactCurrentDispatcher,Rs=A.ReactCurrentBatchConfig,cc=0,Ir=null,an=null,Xn=null,il=!1,yf=!1,xf=0,R1=0;function Zr(){throw Error(i(321))}function i0(f,y){if(y===null)return!1;for(var M=0;M<y.length&&M<f.length;M++)if(!Wa(f[M],y[M]))return!1;return!0}function r0(f,y,M,R,k,W){if(cc=W,Ir=y,y.memoizedState=null,y.updateQueue=null,y.lanes=0,Rh.current=f===null||f.memoizedState===null?b:P,f=M(R,k),yf){W=0;do{if(yf=!1,xf=0,25<=W)throw Error(i(301));W+=1,Xn=an=null,y.updateQueue=null,Rh.current=O,f=M(R,k)}while(yf)}if(Rh.current=x,y=an!==null&&an.next!==null,cc=0,Xn=an=Ir=null,il=!1,y)throw Error(i(300));return f}function xm(){var f=xf!==0;return xf=0,f}function Xa(){var f={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Xn===null?Ir.memoizedState=Xn=f:Xn=Xn.next=f,Xn}function Co(){if(an===null){var f=Ir.alternate;f=f!==null?f.memoizedState:null}else f=an.next;var y=Xn===null?Ir.memoizedState:Xn.next;if(y!==null)Xn=y,an=f;else{if(f===null)throw Error(i(310));an=f,f={memoizedState:an.memoizedState,baseState:an.baseState,baseQueue:an.baseQueue,queue:an.queue,next:null},Xn===null?Ir.memoizedState=Xn=f:Xn=Xn.next=f}return Xn}function wm(f,y){return typeof y=="function"?y(f):y}function n0(f){var y=Co(),M=y.queue;if(M===null)throw Error(i(311));M.lastRenderedReducer=f;var R=an,k=R.baseQueue,W=M.pending;if(W!==null){if(k!==null){var se=k.next;k.next=W.next,W.next=se}R.baseQueue=k=W,M.pending=null}if(k!==null){W=k.next,R=R.baseState;var Te=se=null,Le=null,Ze=W;do{var _t=Ze.lane;if((cc&_t)===_t)Le!==null&&(Le=Le.next={lane:0,action:Ze.action,hasEagerState:Ze.hasEagerState,eagerState:Ze.eagerState,next:null}),R=Ze.hasEagerState?Ze.eagerState:f(R,Ze.action);else{var Mt={lane:_t,action:Ze.action,hasEagerState:Ze.hasEagerState,eagerState:Ze.eagerState,next:null};Le===null?(Te=Le=Mt,se=R):Le=Le.next=Mt,Ir.lanes|=_t,Am|=_t}Ze=Ze.next}while(Ze!==null&&Ze!==W);Le===null?se=R:Le.next=Te,Wa(R,y.memoizedState)||(jt=!0),y.memoizedState=R,y.baseState=se,y.baseQueue=Le,M.lastRenderedState=R}if(f=M.interleaved,f!==null){k=f;do W=k.lane,Ir.lanes|=W,Am|=W,k=k.next;while(k!==f)}else k===null&&(M.lanes=0);return[y.memoizedState,M.dispatch]}function s0(f){var y=Co(),M=y.queue;if(M===null)throw Error(i(311));M.lastRenderedReducer=f;var R=M.dispatch,k=M.pending,W=y.memoizedState;if(k!==null){M.pending=null;var se=k=k.next;do W=f(W,se.action),se=se.next;while(se!==k);Wa(W,y.memoizedState)||(jt=!0),y.memoizedState=W,y.baseQueue===null&&(y.baseState=W),M.lastRenderedState=W}return[W,R]}function hc(){}function _S(f,y){var M=Ir,R=Co(),k=y(),W=!Wa(R.memoizedState,k);if(W&&(R.memoizedState=k,jt=!0),R=R.queue,Sm(na.bind(null,M,R,f),[f]),R.getSnapshot!==y||W||Xn!==null&&Xn.memoizedState.tag&1){if(M.flags|=2048,bm(9,I1.bind(null,M,R,k,y),void 0,null),Is===null)throw Error(i(349));(cc&30)!==0||dc(M,y,k)}return k}function dc(f,y,M){f.flags|=16384,f={getSnapshot:y,value:M},y=Ir.updateQueue,y===null?(y={lastEffect:null,stores:null},Ir.updateQueue=y,y.stores=[f]):(M=y.stores,M===null?y.stores=[f]:M.push(f))}function I1(f,y,M,R){y.value=M,y.getSnapshot=R,SS(y)&&L1(f)}function na(f,y,M){return M(function(){SS(y)&&L1(f)})}function SS(f){var y=f.getSnapshot;f=f.value;try{var M=y();return!Wa(f,M)}catch{return!0}}function L1(f){var y=tl(f,1);y!==null&&mu(y,f,1,-1)}function MS(f){var y=Xa();return typeof f=="function"&&(f=f()),y.memoizedState=y.baseState=f,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:wm,lastRenderedState:f},y.queue=f,f=f.dispatch=PS.bind(null,Ir,f),[y.memoizedState,f]}function bm(f,y,M,R){return f={tag:f,create:y,destroy:M,deps:R,next:null},y=Ir.updateQueue,y===null?(y={lastEffect:null,stores:null},Ir.updateQueue=y,y.lastEffect=f.next=f):(M=y.lastEffect,M===null?y.lastEffect=f.next=f:(R=M.next,M.next=f,f.next=R,y.lastEffect=f)),f}function O1(){return Co().memoizedState}function _m(f,y,M,R){var k=Xa();Ir.flags|=f,k.memoizedState=bm(1|y,M,void 0,R===void 0?null:R)}function a0(f,y,M,R){var k=Co();R=R===void 0?null:R;var W=void 0;if(an!==null){var se=an.memoizedState;if(W=se.destroy,R!==null&&i0(R,se.deps)){k.memoizedState=bm(y,M,W,R);return}}Ir.flags|=f,k.memoizedState=bm(1|y,M,W,R)}function Ya(f,y){return _m(8390656,8,f,y)}function Sm(f,y){return a0(2048,8,f,y)}function AS(f,y){return a0(4,2,f,y)}function du(f,y){return a0(4,4,f,y)}function Mm(f,y){if(typeof y=="function")return f=f(),y(f),function(){y(null)};if(y!=null)return f=f(),y.current=f,function(){y.current=null}}function fc(f,y,M){return M=M!=null?M.concat([f]):null,a0(4,4,Mm.bind(null,y,f),M)}function wf(){}function o0(f,y){var M=Co();y=y===void 0?null:y;var R=M.memoizedState;return R!==null&&y!==null&&i0(y,R[1])?R[0]:(M.memoizedState=[f,y],f)}function l0(f,y){var M=Co();y=y===void 0?null:y;var R=M.memoizedState;return R!==null&&y!==null&&i0(y,R[1])?R[0]:(f=f(),M.memoizedState=[f,y],f)}function ES(f,y,M){return(cc&21)===0?(f.baseState&&(f.baseState=!1,jt=!0),f.memoizedState=M):(Wa(M,y)||(M=mo(),Ir.lanes|=M,Am|=M,f.baseState=!0),y)}function CS(f,y){var M=rr;rr=M!==0&&4>M?M:4,f(!0);var R=Rs.transition;Rs.transition={};try{f(!1),y()}finally{rr=M,Rs.transition=R}}function z1(){return Co().memoizedState}function TS(f,y,M){var R=Mf(f);if(M={lane:R,action:M,hasEagerState:!1,eagerState:null,next:null},u0(f))DS(y,M);else if(M=$v(f,y,M,R),M!==null){var k=Ka();mu(M,f,R,k),RS(M,y,R)}}function PS(f,y,M){var R=Mf(f),k={lane:R,action:M,hasEagerState:!1,eagerState:null,next:null};if(u0(f))DS(y,k);else{var W=f.alternate;if(f.lanes===0&&(W===null||W.lanes===0)&&(W=y.lastRenderedReducer,W!==null))try{var se=y.lastRenderedState,Te=W(se,M);if(k.hasEagerState=!0,k.eagerState=Te,Wa(Te,se)){var Le=y.interleaved;Le===null?(k.next=k,vm(y)):(k.next=Le.next,Le.next=k),y.interleaved=k;return}}catch{}finally{}M=$v(f,y,k,R),M!==null&&(k=Ka(),mu(M,f,R,k),RS(M,y,R))}}function u0(f){var y=f.alternate;return f===Ir||y!==null&&y===Ir}function DS(f,y){yf=il=!0;var M=f.pending;M===null?y.next=y:(y.next=M.next,M.next=y),f.pending=y}function RS(f,y,M){if((M&4194240)!==0){var R=y.lanes;R&=f.pendingLanes,M|=R,y.lanes=M,Wd(f,M)}}var x={readContext:ta,useCallback:Zr,useContext:Zr,useEffect:Zr,useImperativeHandle:Zr,useInsertionEffect:Zr,useLayoutEffect:Zr,useMemo:Zr,useReducer:Zr,useRef:Zr,useState:Zr,useDebugValue:Zr,useDeferredValue:Zr,useTransition:Zr,useMutableSource:Zr,useSyncExternalStore:Zr,useId:Zr,unstable_isNewReconciler:!1},b={readContext:ta,useCallback:function(f,y){return Xa().memoizedState=[f,y===void 0?null:y],f},useContext:ta,useEffect:Ya,useImperativeHandle:function(f,y,M){return M=M!=null?M.concat([f]):null,_m(4194308,4,Mm.bind(null,y,f),M)},useLayoutEffect:function(f,y){return _m(4194308,4,f,y)},useInsertionEffect:function(f,y){return _m(4,2,f,y)},useMemo:function(f,y){var M=Xa();return y=y===void 0?null:y,f=f(),M.memoizedState=[f,y],f},useReducer:function(f,y,M){var R=Xa();return y=M!==void 0?M(y):y,R.memoizedState=R.baseState=y,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:f,lastRenderedState:y},R.queue=f,f=f.dispatch=TS.bind(null,Ir,f),[R.memoizedState,f]},useRef:function(f){var y=Xa();return f={current:f},y.memoizedState=f},useState:MS,useDebugValue:wf,useDeferredValue:function(f){return Xa().memoizedState=f},useTransition:function(){var f=MS(!1),y=f[0];return f=CS.bind(null,f[1]),Xa().memoizedState=f,[y,f]},useMutableSource:function(){},useSyncExternalStore:function(f,y,M){var R=Ir,k=Xa();if(Rr){if(M===void 0)throw Error(i(407));M=M()}else{if(M=y(),Is===null)throw Error(i(349));(cc&30)!==0||dc(R,y,M)}k.memoizedState=M;var W={value:M,getSnapshot:y};return k.queue=W,Ya(na.bind(null,R,W,f),[f]),R.flags|=2048,bm(9,I1.bind(null,R,W,M,y),void 0,null),M},useId:function(){var f=Xa(),y=Is.identifierPrefix;if(Rr){var M=_o,R=It;M=(R&~(1<<32-Se(R)-1)).toString(32)+M,y=":"+y+"R"+M,M=xf++,0<M&&(y+="H"+M.toString(32)),y+=":"}else M=R1++,y=":"+y+"r"+M.toString(32)+":";return f.memoizedState=y},unstable_isNewReconciler:!1},P={readContext:ta,useCallback:o0,useContext:ta,useEffect:Sm,useImperativeHandle:fc,useInsertionEffect:AS,useLayoutEffect:du,useMemo:l0,useReducer:n0,useRef:O1,useState:function(){return n0(wm)},useDebugValue:wf,useDeferredValue:function(f){var y=Co();return ES(y,an.memoizedState,f)},useTransition:function(){var f=n0(wm)[0],y=Co().memoizedState;return[f,y]},useMutableSource:hc,useSyncExternalStore:_S,useId:z1,unstable_isNewReconciler:!1},O={readContext:ta,useCallback:o0,useContext:ta,useEffect:Sm,useImperativeHandle:fc,useInsertionEffect:AS,useLayoutEffect:du,useMemo:l0,useReducer:s0,useRef:O1,useState:function(){return s0(wm)},useDebugValue:wf,useDeferredValue:function(f){var y=Co();return an===null?y.memoizedState=f:ES(y,an.memoizedState,f)},useTransition:function(){var f=s0(wm)[0],y=Co().memoizedState;return[f,y]},useMutableSource:hc,useSyncExternalStore:_S,useId:z1,unstable_isNewReconciler:!1};function U(f,y){try{var M="",R=y;do M+=re(R),R=R.return;while(R);var k=M}catch(W){k=`
Error generating stack: `+W.message+`
`+W.stack}return{value:f,source:y,stack:k,digest:null}}function Q(f,y,M){return{value:f,source:null,stack:M??null,digest:y??null}}function be(f,y){try{console.error(y.value)}catch(M){setTimeout(function(){throw M})}}var Be=typeof WeakMap=="function"?WeakMap:Map;function st(f,y,M){M=Mo(-1,M),M.tag=3,M.payload={element:null};var R=y.value;return M.callback=function(){FS||(FS=!0,NT=R),be(f,y)},M}function Ct(f,y,M){M=Mo(-1,M),M.tag=3;var R=f.type.getDerivedStateFromError;if(typeof R=="function"){var k=y.value;M.payload=function(){return R(k)},M.callback=function(){be(f,y)}}var W=f.stateNode;return W!==null&&typeof W.componentDidCatch=="function"&&(M.callback=function(){be(f,y),typeof R!="function"&&(_f===null?_f=new Set([this]):_f.add(this));var se=y.stack;this.componentDidCatch(y.value,{componentStack:se!==null?se:""})}),M}function Gt(f,y,M){var R=f.pingCache;if(R===null){R=f.pingCache=new Be;var k=new Set;R.set(y,k)}else k=R.get(y),k===void 0&&(k=new Set,R.set(y,k));k.has(M)||(k.add(M),f=t$.bind(null,f,y,M),y.then(f,f))}function Ti(f){do{var y;if((y=f.tag===13)&&(y=f.memoizedState,y=y!==null?y.dehydrated!==null:!0),y)return f;f=f.return}while(f!==null);return null}function ci(f,y,M,R,k){return(f.mode&1)===0?(f===y?f.flags|=65536:(f.flags|=128,M.flags|=131072,M.flags&=-52805,M.tag===1&&(M.alternate===null?M.tag=17:(y=Mo(-1,1),y.tag=2,wl(M,y,1))),M.lanes|=1),f):(f.flags|=65536,f.lanes=k,f)}var xr=A.ReactCurrentOwner,jt=!1;function cr(f,y,M,R){y.child=f===null?Dh(y,null,M,R):oc(y,f.child,M,R)}function Qa(f,y,M,R,k){M=M.render;var W=y.ref;return uu(y,k),R=r0(f,y,M,R,W,k),M=xm(),f!==null&&!jt?(y.updateQueue=f.updateQueue,y.flags&=-2053,f.lanes&=~k,Ih(f,y,k)):(Rr&&M&&C1(y),y.flags|=1,cr(f,y,R,k),y.child)}function Xe(f,y,M,R,k){if(f===null){var W=M.type;return typeof W=="function"&&!GT(W)&&W.defaultProps===void 0&&M.compare===null&&M.defaultProps===void 0?(y.tag=15,y.type=W,Fe(f,y,W,R,k)):(f=GS(M.type,null,R,y,y.mode,k),f.ref=y.ref,f.return=y,y.child=f)}if(W=f.child,(f.lanes&k)===0){var se=W.memoizedProps;if(M=M.compare,M=M!==null?M:vh,M(se,R)&&f.ref===y.ref)return Ih(f,y,k)}return y.flags|=1,f=Ef(W,R),f.ref=y.ref,f.return=y,y.child=f}function Fe(f,y,M,R,k){if(f!==null){var W=f.memoizedProps;if(vh(W,R)&&f.ref===y.ref)if(jt=!1,y.pendingProps=R=W,(f.lanes&k)!==0)(f.flags&131072)!==0&&(jt=!0);else return y.lanes=f.lanes,Ih(f,y,k)}return ei(f,y,M,R,k)}function tt(f,y,M){var R=y.pendingProps,k=R.children,W=f!==null?f.memoizedState:null;if(R.mode==="hidden")if((y.mode&1)===0)y.memoizedState={baseLanes:0,cachePool:null,transitions:null},yr(h0,rl),rl|=M;else{if((M&1073741824)===0)return f=W!==null?W.baseLanes|M:M,y.lanes=y.childLanes=1073741824,y.memoizedState={baseLanes:f,cachePool:null,transitions:null},y.updateQueue=null,yr(h0,rl),rl|=f,null;y.memoizedState={baseLanes:0,cachePool:null,transitions:null},R=W!==null?W.baseLanes:M,yr(h0,rl),rl|=R}else W!==null?(R=W.baseLanes|M,y.memoizedState=null):R=M,yr(h0,rl),rl|=R;return cr(f,y,k,M),y.child}function Nt(f,y){var M=y.ref;(f===null&&M!==null||f!==null&&f.ref!==M)&&(y.flags|=512,y.flags|=2097152)}function ei(f,y,M,R,k){var W=Ds(M)?au:hs.current;return W=Sh(y,W),uu(y,k),M=r0(f,y,M,R,W,k),R=xm(),f!==null&&!jt?(y.updateQueue=f.updateQueue,y.flags&=-2053,f.lanes&=~k,Ih(f,y,k)):(Rr&&R&&C1(y),y.flags|=1,cr(f,y,M,k),y.child)}function zi(f,y,M,R,k){if(Ds(M)){var W=!0;Mh(y)}else W=!1;if(uu(y,k),y.stateNode===null)OS(f,y),pf(y,M,R),mf(y,M,R,k),R=!0;else if(f===null){var se=y.stateNode,Te=y.memoizedProps;se.props=Te;var Le=se.context,Ze=M.contextType;typeof Ze=="object"&&Ze!==null?Ze=ta(Ze):(Ze=Ds(M)?au:hs.current,Ze=Sh(y,Ze));var _t=M.getDerivedStateFromProps,Mt=typeof _t=="function"||typeof se.getSnapshotBeforeUpdate=="function";Mt||typeof se.UNSAFE_componentWillReceiveProps!="function"&&typeof se.componentWillReceiveProps!="function"||(Te!==R||Le!==Ze)&&Th(y,se,R,Ze),cu=!1;var wt=y.memoizedState;se.state=wt,Gr(y,R,se,k),Le=y.memoizedState,Te!==R||wt!==Le||Js.current||cu?(typeof _t=="function"&&(ia(y,M,_t,R),Le=y.memoizedState),(Te=cu||dn(y,M,Te,R,wt,Le,Ze))?(Mt||typeof se.UNSAFE_componentWillMount!="function"&&typeof se.componentWillMount!="function"||(typeof se.componentWillMount=="function"&&se.componentWillMount(),typeof se.UNSAFE_componentWillMount=="function"&&se.UNSAFE_componentWillMount()),typeof se.componentDidMount=="function"&&(y.flags|=4194308)):(typeof se.componentDidMount=="function"&&(y.flags|=4194308),y.memoizedProps=R,y.memoizedState=Le),se.props=R,se.state=Le,se.context=Ze,R=Te):(typeof se.componentDidMount=="function"&&(y.flags|=4194308),R=!1)}else{se=y.stateNode,bS(f,y),Te=y.memoizedProps,Ze=y.type===y.elementType?Te:$o(y.type,Te),se.props=Ze,Mt=y.pendingProps,wt=se.context,Le=M.contextType,typeof Le=="object"&&Le!==null?Le=ta(Le):(Le=Ds(M)?au:hs.current,Le=Sh(y,Le));var Wt=M.getDerivedStateFromProps;(_t=typeof Wt=="function"||typeof se.getSnapshotBeforeUpdate=="function")||typeof se.UNSAFE_componentWillReceiveProps!="function"&&typeof se.componentWillReceiveProps!="function"||(Te!==Mt||wt!==Le)&&Th(y,se,R,Le),cu=!1,wt=y.memoizedState,se.state=wt,Gr(y,R,se,k);var Zt=y.memoizedState;Te!==Mt||wt!==Zt||Js.current||cu?(typeof Wt=="function"&&(ia(y,M,Wt,R),Zt=y.memoizedState),(Ze=cu||dn(y,M,Ze,R,wt,Zt,Le)||!1)?(_t||typeof se.UNSAFE_componentWillUpdate!="function"&&typeof se.componentWillUpdate!="function"||(typeof se.componentWillUpdate=="function"&&se.componentWillUpdate(R,Zt,Le),typeof se.UNSAFE_componentWillUpdate=="function"&&se.UNSAFE_componentWillUpdate(R,Zt,Le)),typeof se.componentDidUpdate=="function"&&(y.flags|=4),typeof se.getSnapshotBeforeUpdate=="function"&&(y.flags|=1024)):(typeof se.componentDidUpdate!="function"||Te===f.memoizedProps&&wt===f.memoizedState||(y.flags|=4),typeof se.getSnapshotBeforeUpdate!="function"||Te===f.memoizedProps&&wt===f.memoizedState||(y.flags|=1024),y.memoizedProps=R,y.memoizedState=Zt),se.props=R,se.state=Zt,se.context=Le,R=Ze):(typeof se.componentDidUpdate!="function"||Te===f.memoizedProps&&wt===f.memoizedState||(y.flags|=4),typeof se.getSnapshotBeforeUpdate!="function"||Te===f.memoizedProps&&wt===f.memoizedState||(y.flags|=1024),R=!1)}return Ei(f,y,M,R,W,k)}function Ei(f,y,M,R,k,W){Nt(f,y);var se=(y.flags&128)!==0;if(!R&&!se)return k&&A1(y,M,!1),Ih(f,y,W);R=y.stateNode,xr.current=y;var Te=se&&typeof M.getDerivedStateFromError!="function"?null:R.render();return y.flags|=1,f!==null&&se?(y.child=oc(y,f.child,null,W),y.child=oc(y,null,Te,W)):cr(f,y,Te,W),y.memoizedState=R.state,k&&A1(y,M,!0),y.child}function Ji(f){var y=f.stateNode;y.pendingContext?M1(f,y.pendingContext,y.pendingContext!==y.context):y.context&&M1(f,y.context,!1),gf(f,y.containerInfo)}function Cn(f,y,M,R,k){return sc(),cf(k),y.flags|=256,cr(f,y,M,R),y.child}var Qi={dehydrated:null,treeContext:null,retryLane:0};function Sl(f){return{baseLanes:f,cachePool:null,transitions:null}}function IS(f,y,M){var R=y.pendingProps,k=Cr.current,W=!1,se=(y.flags&128)!==0,Te;if((Te=se)||(Te=f!==null&&f.memoizedState===null?!1:(k&2)!==0),Te?(W=!0,y.flags&=-129):(f===null||f.memoizedState!==null)&&(k|=1),yr(Cr,k&1),f===null)return Kv(y),f=y.memoizedState,f!==null&&(f=f.dehydrated,f!==null)?((y.mode&1)===0?y.lanes=1:f.data==="$!"?y.lanes=8:y.lanes=1073741824,null):(se=R.children,f=R.fallback,W?(R=y.mode,W=y.child,se={mode:"hidden",children:se},(R&1)===0&&W!==null?(W.childLanes=0,W.pendingProps=se):W=qS(se,R,0,null),f=Pm(f,R,M,null),W.return=y,f.return=y,W.sibling=f,y.child=W,y.child.memoizedState=Sl(M),y.memoizedState=Qi,f):TT(y,se));if(k=f.memoizedState,k!==null&&(Te=k.dehydrated,Te!==null))return HJ(f,y,se,R,Te,k,M);if(W){W=R.fallback,se=y.mode,k=f.child,Te=k.sibling;var Le={mode:"hidden",children:R.children};return(se&1)===0&&y.child!==k?(R=y.child,R.childLanes=0,R.pendingProps=Le,y.deletions=null):(R=Ef(k,Le),R.subtreeFlags=k.subtreeFlags&14680064),Te!==null?W=Ef(Te,W):(W=Pm(W,se,M,null),W.flags|=2),W.return=y,R.return=y,R.sibling=W,y.child=R,R=W,W=y.child,se=f.child.memoizedState,se=se===null?Sl(M):{baseLanes:se.baseLanes|M,cachePool:null,transitions:se.transitions},W.memoizedState=se,W.childLanes=f.childLanes&~M,y.memoizedState=Qi,R}return W=f.child,f=W.sibling,R=Ef(W,{mode:"visible",children:R.children}),(y.mode&1)===0&&(R.lanes=M),R.return=y,R.sibling=null,f!==null&&(M=y.deletions,M===null?(y.deletions=[f],y.flags|=16):M.push(f)),y.child=R,y.memoizedState=null,R}function TT(f,y){return y=qS({mode:"visible",children:y},f.mode,0,null),y.return=f,f.child=y}function LS(f,y,M,R){return R!==null&&cf(R),oc(y,f.child,null,M),f=TT(y,y.pendingProps.children),f.flags|=2,y.memoizedState=null,f}function HJ(f,y,M,R,k,W,se){if(M)return y.flags&256?(y.flags&=-257,R=Q(Error(i(422))),LS(f,y,se,R)):y.memoizedState!==null?(y.child=f.child,y.flags|=128,null):(W=R.fallback,k=y.mode,R=qS({mode:"visible",children:R.children},k,0,null),W=Pm(W,k,se,null),W.flags|=2,R.return=y,W.return=y,R.sibling=W,y.child=R,(y.mode&1)!==0&&oc(y,f.child,null,se),y.child.memoizedState=Sl(se),y.memoizedState=Qi,W);if((y.mode&1)===0)return LS(f,y,se,null);if(k.data==="$!"){if(R=k.nextSibling&&k.nextSibling.dataset,R)var Te=R.dgst;return R=Te,W=Error(i(419)),R=Q(W,R,void 0),LS(f,y,se,R)}if(Te=(se&f.childLanes)!==0,jt||Te){if(R=Is,R!==null){switch(se&-se){case 4:k=2;break;case 16:k=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:k=32;break;case 536870912:k=268435456;break;default:k=0}k=(k&(R.suspendedLanes|se))!==0?0:k,k!==0&&k!==W.retryLane&&(W.retryLane=k,tl(f,k),mu(R,f,k,-1))}return WT(),R=Q(Error(i(421))),LS(f,y,se,R)}return k.data==="$?"?(y.flags|=128,y.child=f.child,y=i$.bind(null,f),k._reactRetry=y,null):(f=W.treeContext,ea=ru(k.nextSibling),ds=y,Rr=!0,So=null,f!==null&&($s[Wn++]=It,$s[Wn++]=_o,$s[Wn++]=Eh,It=f.id,_o=f.overflow,Eh=y),y=TT(y,R.children),y.flags|=4096,y)}function vN(f,y,M){f.lanes|=y;var R=f.alternate;R!==null&&(R.lanes|=y),ff(f.return,y,M)}function PT(f,y,M,R,k){var W=f.memoizedState;W===null?f.memoizedState={isBackwards:y,rendering:null,renderingStartTime:0,last:R,tail:M,tailMode:k}:(W.isBackwards=y,W.rendering=null,W.renderingStartTime=0,W.last=R,W.tail=M,W.tailMode=k)}function yN(f,y,M){var R=y.pendingProps,k=R.revealOrder,W=R.tail;if(cr(f,y,R.children,M),R=Cr.current,(R&2)!==0)R=R&1|2,y.flags|=128;else{if(f!==null&&(f.flags&128)!==0)e:for(f=y.child;f!==null;){if(f.tag===13)f.memoizedState!==null&&vN(f,M,y);else if(f.tag===19)vN(f,M,y);else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===y)break e;for(;f.sibling===null;){if(f.return===null||f.return===y)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}R&=1}if(yr(Cr,R),(y.mode&1)===0)y.memoizedState=null;else switch(k){case"forwards":for(M=y.child,k=null;M!==null;)f=M.alternate,f!==null&&qn(f)===null&&(k=M),M=M.sibling;M=k,M===null?(k=y.child,y.child=null):(k=M.sibling,M.sibling=null),PT(y,!1,k,M,W);break;case"backwards":for(M=null,k=y.child,y.child=null;k!==null;){if(f=k.alternate,f!==null&&qn(f)===null){y.child=k;break}f=k.sibling,k.sibling=M,M=k,k=f}PT(y,!0,M,null,W);break;case"together":PT(y,!1,null,null,void 0);break;default:y.memoizedState=null}return y.child}function OS(f,y){(y.mode&1)===0&&f!==null&&(f.alternate=null,y.alternate=null,y.flags|=2)}function Ih(f,y,M){if(f!==null&&(y.dependencies=f.dependencies),Am|=y.lanes,(M&y.childLanes)===0)return null;if(f!==null&&y.child!==f.child)throw Error(i(153));if(y.child!==null){for(f=y.child,M=Ef(f,f.pendingProps),y.child=M,M.return=y;f.sibling!==null;)f=f.sibling,M=M.sibling=Ef(f,f.pendingProps),M.return=y;M.sibling=null}return y.child}function WJ(f,y,M){switch(y.tag){case 3:Ji(y),sc();break;case 5:t0(y);break;case 1:Ds(y.type)&&Mh(y);break;case 4:gf(y,y.stateNode.containerInfo);break;case 10:var R=y.type._context,k=y.memoizedProps.value;yr(mm,R._currentValue),R._currentValue=k;break;case 13:if(R=y.memoizedState,R!==null)return R.dehydrated!==null?(yr(Cr,Cr.current&1),y.flags|=128,null):(M&y.child.childLanes)!==0?IS(f,y,M):(yr(Cr,Cr.current&1),f=Ih(f,y,M),f!==null?f.sibling:null);yr(Cr,Cr.current&1);break;case 19:if(R=(M&y.childLanes)!==0,(f.flags&128)!==0){if(R)return yN(f,y,M);y.flags|=128}if(k=y.memoizedState,k!==null&&(k.rendering=null,k.tail=null,k.lastEffect=null),yr(Cr,Cr.current),R)break;return null;case 22:case 23:return y.lanes=0,tt(f,y,M)}return Ih(f,y,M)}var xN,DT,wN,bN;xN=function(f,y){for(var M=y.child;M!==null;){if(M.tag===5||M.tag===6)f.appendChild(M.stateNode);else if(M.tag!==4&&M.child!==null){M.child.return=M,M=M.child;continue}if(M===y)break;for(;M.sibling===null;){if(M.return===null||M.return===y)return;M=M.return}M.sibling.return=M.return,M=M.sibling}},DT=function(){},wN=function(f,y,M,R){var k=f.memoizedProps;if(k!==R){f=y.stateNode,Aa(Ao.current);var W=null;switch(M){case"input":k=Ve(f,k),R=Ve(f,R),W=[];break;case"select":k=F({},k,{value:void 0}),R=F({},R,{value:void 0}),W=[];break;case"textarea":k=q(f,k),R=q(f,R),W=[];break;default:typeof k.onClick!="function"&&typeof R.onClick=="function"&&(f.onclick=cm)}_e(M,R);var se;M=null;for(Ze in k)if(!R.hasOwnProperty(Ze)&&k.hasOwnProperty(Ze)&&k[Ze]!=null)if(Ze==="style"){var Te=k[Ze];for(se in Te)Te.hasOwnProperty(se)&&(M||(M={}),M[se]="")}else Ze!=="dangerouslySetInnerHTML"&&Ze!=="children"&&Ze!=="suppressContentEditableWarning"&&Ze!=="suppressHydrationWarning"&&Ze!=="autoFocus"&&(n.hasOwnProperty(Ze)?W||(W=[]):(W=W||[]).push(Ze,null));for(Ze in R){var Le=R[Ze];if(Te=k?.[Ze],R.hasOwnProperty(Ze)&&Le!==Te&&(Le!=null||Te!=null))if(Ze==="style")if(Te){for(se in Te)!Te.hasOwnProperty(se)||Le&&Le.hasOwnProperty(se)||(M||(M={}),M[se]="");for(se in Le)Le.hasOwnProperty(se)&&Te[se]!==Le[se]&&(M||(M={}),M[se]=Le[se])}else M||(W||(W=[]),W.push(Ze,M)),M=Le;else Ze==="dangerouslySetInnerHTML"?(Le=Le?Le.__html:void 0,Te=Te?Te.__html:void 0,Le!=null&&Te!==Le&&(W=W||[]).push(Ze,Le)):Ze==="children"?typeof Le!="string"&&typeof Le!="number"||(W=W||[]).push(Ze,""+Le):Ze!=="suppressContentEditableWarning"&&Ze!=="suppressHydrationWarning"&&(n.hasOwnProperty(Ze)?(Le!=null&&Ze==="onScroll"&&Ar("scroll",f),W||Te===Le||(W=[])):(W=W||[]).push(Ze,Le))}M&&(W=W||[]).push("style",M);var Ze=W;(y.updateQueue=Ze)&&(y.flags|=4)}},bN=function(f,y,M,R){M!==R&&(y.flags|=4)};function k1(f,y){if(!Rr)switch(f.tailMode){case"hidden":y=f.tail;for(var M=null;y!==null;)y.alternate!==null&&(M=y),y=y.sibling;M===null?f.tail=null:M.sibling=null;break;case"collapsed":M=f.tail;for(var R=null;M!==null;)M.alternate!==null&&(R=M),M=M.sibling;R===null?y||f.tail===null?f.tail=null:f.tail.sibling=null:R.sibling=null}}function Ca(f){var y=f.alternate!==null&&f.alternate.child===f.child,M=0,R=0;if(y)for(var k=f.child;k!==null;)M|=k.lanes|k.childLanes,R|=k.subtreeFlags&14680064,R|=k.flags&14680064,k.return=f,k=k.sibling;else for(k=f.child;k!==null;)M|=k.lanes|k.childLanes,R|=k.subtreeFlags,R|=k.flags,k.return=f,k=k.sibling;return f.subtreeFlags|=R,f.childLanes=M,y}function GJ(f,y,M){var R=y.pendingProps;switch(lu(y),y.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ca(y),null;case 1:return Ds(y.type)&&hm(),Ca(y),null;case 3:return R=y.stateNode,bl(),Er(Js),Er(hs),Ea(),R.pendingContext&&(R.context=R.pendingContext,R.pendingContext=null),(f===null||f.child===null)&&(uf(y)?y.flags|=4:f===null||f.memoizedState.isDehydrated&&(y.flags&256)===0||(y.flags|=1024,So!==null&&(VT(So),So=null))),DT(f,y),Ca(y),null;case 5:vf(y);var k=Aa(uc.current);if(M=y.type,f!==null&&y.stateNode!=null)wN(f,y,M,R,k),f.ref!==y.ref&&(y.flags|=512,y.flags|=2097152);else{if(!R){if(y.stateNode===null)throw Error(i(166));return Ca(y),null}if(f=Aa(Ao.current),uf(y)){R=y.stateNode,M=y.type;var W=y.memoizedProps;switch(R[En]=y,R[lf]=W,f=(y.mode&1)!==0,M){case"dialog":Ar("cancel",R),Ar("close",R);break;case"iframe":case"object":case"embed":Ar("load",R);break;case"video":case"audio":for(k=0;k<rc.length;k++)Ar(rc[k],R);break;case"source":Ar("error",R);break;case"img":case"image":case"link":Ar("error",R),Ar("load",R);break;case"details":Ar("toggle",R);break;case"input":Ge(R,W),Ar("invalid",R);break;case"select":R._wrapperState={wasMultiple:!!W.multiple},Ar("invalid",R);break;case"textarea":N(R,W),Ar("invalid",R)}_e(M,W),k=null;for(var se in W)if(W.hasOwnProperty(se)){var Te=W[se];se==="children"?typeof Te=="string"?R.textContent!==Te&&(W.suppressHydrationWarning!==!0&&um(R.textContent,Te,f),k=["children",Te]):typeof Te=="number"&&R.textContent!==""+Te&&(W.suppressHydrationWarning!==!0&&um(R.textContent,Te,f),k=["children",""+Te]):n.hasOwnProperty(se)&&Te!=null&&se==="onScroll"&&Ar("scroll",R)}switch(M){case"input":Ie(R),$e(R,W,!0);break;case"textarea":Ie(R),ze(R);break;case"select":case"option":break;default:typeof W.onClick=="function"&&(R.onclick=cm)}R=k,y.updateQueue=R,R!==null&&(y.flags|=4)}else{se=k.nodeType===9?k:k.ownerDocument,f==="http://www.w3.org/1999/xhtml"&&(f=$(M)),f==="http://www.w3.org/1999/xhtml"?M==="script"?(f=se.createElement("div"),f.innerHTML="<script><\/script>",f=f.removeChild(f.firstChild)):typeof R.is=="string"?f=se.createElement(M,{is:R.is}):(f=se.createElement(M),M==="select"&&(se=f,R.multiple?se.multiple=!0:R.size&&(se.size=R.size))):f=se.createElementNS(f,M),f[En]=y,f[lf]=R,xN(f,y,!1,!1),y.stateNode=f;e:{switch(se=it(M,R),M){case"dialog":Ar("cancel",f),Ar("close",f),k=R;break;case"iframe":case"object":case"embed":Ar("load",f),k=R;break;case"video":case"audio":for(k=0;k<rc.length;k++)Ar(rc[k],f);k=R;break;case"source":Ar("error",f),k=R;break;case"img":case"image":case"link":Ar("error",f),Ar("load",f),k=R;break;case"details":Ar("toggle",f),k=R;break;case"input":Ge(f,R),k=Ve(f,R),Ar("invalid",f);break;case"option":k=R;break;case"select":f._wrapperState={wasMultiple:!!R.multiple},k=F({},R,{value:void 0}),Ar("invalid",f);break;case"textarea":N(f,R),k=q(f,R),Ar("invalid",f);break;default:k=R}_e(M,k),Te=k;for(W in Te)if(Te.hasOwnProperty(W)){var Le=Te[W];W==="style"?mt(f,Le):W==="dangerouslySetInnerHTML"?(Le=Le?Le.__html:void 0,Le!=null&&Ye(f,Le)):W==="children"?typeof Le=="string"?(M!=="textarea"||Le!=="")&&Ee(f,Le):typeof Le=="number"&&Ee(f,""+Le):W!=="suppressContentEditableWarning"&&W!=="suppressHydrationWarning"&&W!=="autoFocus"&&(n.hasOwnProperty(W)?Le!=null&&W==="onScroll"&&Ar("scroll",f):Le!=null&&_(f,W,Le,se))}switch(M){case"input":Ie(f),$e(f,R,!1);break;case"textarea":Ie(f),ze(f);break;case"option":R.value!=null&&f.setAttribute("value",""+he(R.value));break;case"select":f.multiple=!!R.multiple,W=R.value,W!=null?xt(f,!!R.multiple,W,!1):R.defaultValue!=null&&xt(f,!!R.multiple,R.defaultValue,!0);break;default:typeof k.onClick=="function"&&(f.onclick=cm)}switch(M){case"button":case"input":case"select":case"textarea":R=!!R.autoFocus;break e;case"img":R=!0;break e;default:R=!1}}R&&(y.flags|=4)}y.ref!==null&&(y.flags|=512,y.flags|=2097152)}return Ca(y),null;case 6:if(f&&y.stateNode!=null)bN(f,y,f.memoizedProps,R);else{if(typeof R!="string"&&y.stateNode===null)throw Error(i(166));if(M=Aa(uc.current),Aa(Ao.current),uf(y)){if(R=y.stateNode,M=y.memoizedProps,R[En]=y,(W=R.nodeValue!==M)&&(f=ds,f!==null))switch(f.tag){case 3:um(R.nodeValue,M,(f.mode&1)!==0);break;case 5:f.memoizedProps.suppressHydrationWarning!==!0&&um(R.nodeValue,M,(f.mode&1)!==0)}W&&(y.flags|=4)}else R=(M.nodeType===9?M:M.ownerDocument).createTextNode(R),R[En]=y,y.stateNode=R}return Ca(y),null;case 13:if(Er(Cr),R=y.memoizedState,f===null||f.memoizedState!==null&&f.memoizedState.dehydrated!==null){if(Rr&&ea!==null&&(y.mode&1)!==0&&(y.flags&128)===0)D1(),sc(),y.flags|=98560,W=!1;else if(W=uf(y),R!==null&&R.dehydrated!==null){if(f===null){if(!W)throw Error(i(318));if(W=y.memoizedState,W=W!==null?W.dehydrated:null,!W)throw Error(i(317));W[En]=y}else sc(),(y.flags&128)===0&&(y.memoizedState=null),y.flags|=4;Ca(y),W=!1}else So!==null&&(VT(So),So=null),W=!0;if(!W)return y.flags&65536?y:null}return(y.flags&128)!==0?(y.lanes=M,y):(R=R!==null,R!==(f!==null&&f.memoizedState!==null)&&R&&(y.child.flags|=8192,(y.mode&1)!==0&&(f===null||(Cr.current&1)!==0?fs===0&&(fs=3):WT())),y.updateQueue!==null&&(y.flags|=4),Ca(y),null);case 4:return bl(),DT(f,y),f===null&&sf(y.stateNode.containerInfo),Ca(y),null;case 10:return df(y.type._context),Ca(y),null;case 17:return Ds(y.type)&&hm(),Ca(y),null;case 19:if(Er(Cr),W=y.memoizedState,W===null)return Ca(y),null;if(R=(y.flags&128)!==0,se=W.rendering,se===null)if(R)k1(W,!1);else{if(fs!==0||f!==null&&(f.flags&128)!==0)for(f=y.child;f!==null;){if(se=qn(f),se!==null){for(y.flags|=128,k1(W,!1),R=se.updateQueue,R!==null&&(y.updateQueue=R,y.flags|=4),y.subtreeFlags=0,R=M,M=y.child;M!==null;)W=M,f=R,W.flags&=14680066,se=W.alternate,se===null?(W.childLanes=0,W.lanes=f,W.child=null,W.subtreeFlags=0,W.memoizedProps=null,W.memoizedState=null,W.updateQueue=null,W.dependencies=null,W.stateNode=null):(W.childLanes=se.childLanes,W.lanes=se.lanes,W.child=se.child,W.subtreeFlags=0,W.deletions=null,W.memoizedProps=se.memoizedProps,W.memoizedState=se.memoizedState,W.updateQueue=se.updateQueue,W.type=se.type,f=se.dependencies,W.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),M=M.sibling;return yr(Cr,Cr.current&1|2),y.child}f=f.sibling}W.tail!==null&&Rt()>d0&&(y.flags|=128,R=!0,k1(W,!1),y.lanes=4194304)}else{if(!R)if(f=qn(se),f!==null){if(y.flags|=128,R=!0,M=f.updateQueue,M!==null&&(y.updateQueue=M,y.flags|=4),k1(W,!0),W.tail===null&&W.tailMode==="hidden"&&!se.alternate&&!Rr)return Ca(y),null}else 2*Rt()-W.renderingStartTime>d0&&M!==1073741824&&(y.flags|=128,R=!0,k1(W,!1),y.lanes=4194304);W.isBackwards?(se.sibling=y.child,y.child=se):(M=W.last,M!==null?M.sibling=se:y.child=se,W.last=se)}return W.tail!==null?(y=W.tail,W.rendering=y,W.tail=y.sibling,W.renderingStartTime=Rt(),y.sibling=null,M=Cr.current,yr(Cr,R?M&1|2:M&1),y):(Ca(y),null);case 22:case 23:return HT(),R=y.memoizedState!==null,f!==null&&f.memoizedState!==null!==R&&(y.flags|=8192),R&&(y.mode&1)!==0?(rl&1073741824)!==0&&(Ca(y),y.subtreeFlags&6&&(y.flags|=8192)):Ca(y),null;case 24:return null;case 25:return null}throw Error(i(156,y.tag))}function qJ(f,y){switch(lu(y),y.tag){case 1:return Ds(y.type)&&hm(),f=y.flags,f&65536?(y.flags=f&-65537|128,y):null;case 3:return bl(),Er(Js),Er(hs),Ea(),f=y.flags,(f&65536)!==0&&(f&128)===0?(y.flags=f&-65537|128,y):null;case 5:return vf(y),null;case 13:if(Er(Cr),f=y.memoizedState,f!==null&&f.dehydrated!==null){if(y.alternate===null)throw Error(i(340));sc()}return f=y.flags,f&65536?(y.flags=f&-65537|128,y):null;case 19:return Er(Cr),null;case 4:return bl(),null;case 10:return df(y.type._context),null;case 22:case 23:return HT(),null;case 24:return null;default:return null}}var zS=!1,Ta=!1,XJ=typeof WeakSet=="function"?WeakSet:Set,Qt=null;function c0(f,y){var M=f.ref;if(M!==null)if(typeof M=="function")try{M(null)}catch(R){fn(f,y,R)}else M.current=null}function RT(f,y,M){try{M()}catch(R){fn(f,y,R)}}var _N=!1;function YJ(f,y){if(of=go,f=Wr(),Un(f)){if("selectionStart"in f)var M={start:f.selectionStart,end:f.selectionEnd};else e:{M=(M=f.ownerDocument)&&M.defaultView||window;var R=M.getSelection&&M.getSelection();if(R&&R.rangeCount!==0){M=R.anchorNode;var k=R.anchorOffset,W=R.focusNode;R=R.focusOffset;try{M.nodeType,W.nodeType}catch{M=null;break e}var se=0,Te=-1,Le=-1,Ze=0,_t=0,Mt=f,wt=null;t:for(;;){for(var Wt;Mt!==M||k!==0&&Mt.nodeType!==3||(Te=se+k),Mt!==W||R!==0&&Mt.nodeType!==3||(Le=se+R),Mt.nodeType===3&&(se+=Mt.nodeValue.length),(Wt=Mt.firstChild)!==null;)wt=Mt,Mt=Wt;for(;;){if(Mt===f)break t;if(wt===M&&++Ze===k&&(Te=se),wt===W&&++_t===R&&(Le=se),(Wt=Mt.nextSibling)!==null)break;Mt=wt,wt=Mt.parentNode}Mt=Wt}M=Te===-1||Le===-1?null:{start:Te,end:Le}}else M=null}M=M||{start:0,end:0}}else M=null;for(y1={focusedElem:f,selectionRange:M},go=!1,Qt=y;Qt!==null;)if(y=Qt,f=y.child,(y.subtreeFlags&1028)!==0&&f!==null)f.return=y,Qt=f;else for(;Qt!==null;){y=Qt;try{var Zt=y.alternate;if((y.flags&1024)!==0)switch(y.tag){case 0:case 11:case 15:break;case 1:if(Zt!==null){var ti=Zt.memoizedProps,Tn=Zt.memoizedState,je=y.stateNode,ke=je.getSnapshotBeforeUpdate(y.elementType===y.type?ti:$o(y.type,ti),Tn);je.__reactInternalSnapshotBeforeUpdate=ke}break;case 3:var qe=y.stateNode.containerInfo;qe.nodeType===1?qe.textContent="":qe.nodeType===9&&qe.documentElement&&qe.removeChild(qe.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(i(163))}}catch(Pt){fn(y,y.return,Pt)}if(f=y.sibling,f!==null){f.return=y.return,Qt=f;break}Qt=y.return}return Zt=_N,_N=!1,Zt}function B1(f,y,M){var R=y.updateQueue;if(R=R!==null?R.lastEffect:null,R!==null){var k=R=R.next;do{if((k.tag&f)===f){var W=k.destroy;k.destroy=void 0,W!==void 0&&RT(y,M,W)}k=k.next}while(k!==R)}}function kS(f,y){if(y=y.updateQueue,y=y!==null?y.lastEffect:null,y!==null){var M=y=y.next;do{if((M.tag&f)===f){var R=M.create;M.destroy=R()}M=M.next}while(M!==y)}}function IT(f){var y=f.ref;if(y!==null){var M=f.stateNode;switch(f.tag){case 5:f=M;break;default:f=M}typeof y=="function"?y(f):y.current=f}}function SN(f){var y=f.alternate;y!==null&&(f.alternate=null,SN(y)),f.child=null,f.deletions=null,f.sibling=null,f.tag===5&&(y=f.stateNode,y!==null&&(delete y[En],delete y[lf],delete y[_h],delete y[Hv],delete y[Wv])),f.stateNode=null,f.return=null,f.dependencies=null,f.memoizedProps=null,f.memoizedState=null,f.pendingProps=null,f.stateNode=null,f.updateQueue=null}function MN(f){return f.tag===5||f.tag===3||f.tag===4}function AN(f){e:for(;;){for(;f.sibling===null;){if(f.return===null||MN(f.return))return null;f=f.return}for(f.sibling.return=f.return,f=f.sibling;f.tag!==5&&f.tag!==6&&f.tag!==18;){if(f.flags&2||f.child===null||f.tag===4)continue e;f.child.return=f,f=f.child}if(!(f.flags&2))return f.stateNode}}function LT(f,y,M){var R=f.tag;if(R===5||R===6)f=f.stateNode,y?M.nodeType===8?M.parentNode.insertBefore(f,y):M.insertBefore(f,y):(M.nodeType===8?(y=M.parentNode,y.insertBefore(f,M)):(y=M,y.appendChild(f)),M=M._reactRootContainer,M!=null||y.onclick!==null||(y.onclick=cm));else if(R!==4&&(f=f.child,f!==null))for(LT(f,y,M),f=f.sibling;f!==null;)LT(f,y,M),f=f.sibling}function OT(f,y,M){var R=f.tag;if(R===5||R===6)f=f.stateNode,y?M.insertBefore(f,y):M.appendChild(f);else if(R!==4&&(f=f.child,f!==null))for(OT(f,y,M),f=f.sibling;f!==null;)OT(f,y,M),f=f.sibling}var sa=null,fu=!1;function bf(f,y,M){for(M=M.child;M!==null;)EN(f,y,M),M=M.sibling}function EN(f,y,M){if(ee&&typeof ee.onCommitFiberUnmount=="function")try{ee.onCommitFiberUnmount(Ui,M)}catch{}switch(M.tag){case 5:Ta||c0(M,y);case 6:var R=sa,k=fu;sa=null,bf(f,y,M),sa=R,fu=k,sa!==null&&(fu?(f=sa,M=M.stateNode,f.nodeType===8?f.parentNode.removeChild(M):f.removeChild(M)):sa.removeChild(M.stateNode));break;case 18:sa!==null&&(fu?(f=sa,M=M.stateNode,f.nodeType===8?jv(f.parentNode,M):f.nodeType===1&&jv(f,M),Jp(f)):jv(sa,M.stateNode));break;case 4:R=sa,k=fu,sa=M.stateNode.containerInfo,fu=!0,bf(f,y,M),sa=R,fu=k;break;case 0:case 11:case 14:case 15:if(!Ta&&(R=M.updateQueue,R!==null&&(R=R.lastEffect,R!==null))){k=R=R.next;do{var W=k,se=W.destroy;W=W.tag,se!==void 0&&((W&2)!==0||(W&4)!==0)&&RT(M,y,se),k=k.next}while(k!==R)}bf(f,y,M);break;case 1:if(!Ta&&(c0(M,y),R=M.stateNode,typeof R.componentWillUnmount=="function"))try{R.props=M.memoizedProps,R.state=M.memoizedState,R.componentWillUnmount()}catch(Te){fn(M,y,Te)}bf(f,y,M);break;case 21:bf(f,y,M);break;case 22:M.mode&1?(Ta=(R=Ta)||M.memoizedState!==null,bf(f,y,M),Ta=R):bf(f,y,M);break;default:bf(f,y,M)}}function CN(f){var y=f.updateQueue;if(y!==null){f.updateQueue=null;var M=f.stateNode;M===null&&(M=f.stateNode=new XJ),y.forEach(function(R){var k=r$.bind(null,f,R);M.has(R)||(M.add(R),R.then(k,k))})}}function pu(f,y){var M=y.deletions;if(M!==null)for(var R=0;R<M.length;R++){var k=M[R];try{var W=f,se=y,Te=se;e:for(;Te!==null;){switch(Te.tag){case 5:sa=Te.stateNode,fu=!1;break e;case 3:sa=Te.stateNode.containerInfo,fu=!0;break e;case 4:sa=Te.stateNode.containerInfo,fu=!0;break e}Te=Te.return}if(sa===null)throw Error(i(160));EN(W,se,k),sa=null,fu=!1;var Le=k.alternate;Le!==null&&(Le.return=null),k.return=null}catch(Ze){fn(k,y,Ze)}}if(y.subtreeFlags&12854)for(y=y.child;y!==null;)TN(y,f),y=y.sibling}function TN(f,y){var M=f.alternate,R=f.flags;switch(f.tag){case 0:case 11:case 14:case 15:if(pu(y,f),pc(f),R&4){try{B1(3,f,f.return),kS(3,f)}catch(ti){fn(f,f.return,ti)}try{B1(5,f,f.return)}catch(ti){fn(f,f.return,ti)}}break;case 1:pu(y,f),pc(f),R&512&&M!==null&&c0(M,M.return);break;case 5:if(pu(y,f),pc(f),R&512&&M!==null&&c0(M,M.return),f.flags&32){var k=f.stateNode;try{Ee(k,"")}catch(ti){fn(f,f.return,ti)}}if(R&4&&(k=f.stateNode,k!=null)){var W=f.memoizedProps,se=M!==null?M.memoizedProps:W,Te=f.type,Le=f.updateQueue;if(f.updateQueue=null,Le!==null)try{Te==="input"&&W.type==="radio"&&W.name!=null&&Qe(k,W),it(Te,se);var Ze=it(Te,W);for(se=0;se<Le.length;se+=2){var _t=Le[se],Mt=Le[se+1];_t==="style"?mt(k,Mt):_t==="dangerouslySetInnerHTML"?Ye(k,Mt):_t==="children"?Ee(k,Mt):_(k,_t,Mt,Ze)}switch(Te){case"input":ot(k,W);break;case"textarea":de(k,W);break;case"select":var wt=k._wrapperState.wasMultiple;k._wrapperState.wasMultiple=!!W.multiple;var Wt=W.value;Wt!=null?xt(k,!!W.multiple,Wt,!1):wt!==!!W.multiple&&(W.defaultValue!=null?xt(k,!!W.multiple,W.defaultValue,!0):xt(k,!!W.multiple,W.multiple?[]:"",!1))}k[lf]=W}catch(ti){fn(f,f.return,ti)}}break;case 6:if(pu(y,f),pc(f),R&4){if(f.stateNode===null)throw Error(i(162));k=f.stateNode,W=f.memoizedProps;try{k.nodeValue=W}catch(ti){fn(f,f.return,ti)}}break;case 3:if(pu(y,f),pc(f),R&4&&M!==null&&M.memoizedState.isDehydrated)try{Jp(y.containerInfo)}catch(ti){fn(f,f.return,ti)}break;case 4:pu(y,f),pc(f);break;case 13:pu(y,f),pc(f),k=f.child,k.flags&8192&&(W=k.memoizedState!==null,k.stateNode.isHidden=W,!W||k.alternate!==null&&k.alternate.memoizedState!==null||(BT=Rt())),R&4&&CN(f);break;case 22:if(_t=M!==null&&M.memoizedState!==null,f.mode&1?(Ta=(Ze=Ta)||_t,pu(y,f),Ta=Ze):pu(y,f),pc(f),R&8192){if(Ze=f.memoizedState!==null,(f.stateNode.isHidden=Ze)&&!_t&&(f.mode&1)!==0)for(Qt=f,_t=f.child;_t!==null;){for(Mt=Qt=_t;Qt!==null;){switch(wt=Qt,Wt=wt.child,wt.tag){case 0:case 11:case 14:case 15:B1(4,wt,wt.return);break;case 1:c0(wt,wt.return);var Zt=wt.stateNode;if(typeof Zt.componentWillUnmount=="function"){R=wt,M=wt.return;try{y=R,Zt.props=y.memoizedProps,Zt.state=y.memoizedState,Zt.componentWillUnmount()}catch(ti){fn(R,M,ti)}}break;case 5:c0(wt,wt.return);break;case 22:if(wt.memoizedState!==null){RN(Mt);continue}}Wt!==null?(Wt.return=wt,Qt=Wt):RN(Mt)}_t=_t.sibling}e:for(_t=null,Mt=f;;){if(Mt.tag===5){if(_t===null){_t=Mt;try{k=Mt.stateNode,Ze?(W=k.style,typeof W.setProperty=="function"?W.setProperty("display","none","important"):W.display="none"):(Te=Mt.stateNode,Le=Mt.memoizedProps.style,se=Le!=null&&Le.hasOwnProperty("display")?Le.display:null,Te.style.display=pt("display",se))}catch(ti){fn(f,f.return,ti)}}}else if(Mt.tag===6){if(_t===null)try{Mt.stateNode.nodeValue=Ze?"":Mt.memoizedProps}catch(ti){fn(f,f.return,ti)}}else if((Mt.tag!==22&&Mt.tag!==23||Mt.memoizedState===null||Mt===f)&&Mt.child!==null){Mt.child.return=Mt,Mt=Mt.child;continue}if(Mt===f)break e;for(;Mt.sibling===null;){if(Mt.return===null||Mt.return===f)break e;_t===Mt&&(_t=null),Mt=Mt.return}_t===Mt&&(_t=null),Mt.sibling.return=Mt.return,Mt=Mt.sibling}}break;case 19:pu(y,f),pc(f),R&4&&CN(f);break;case 21:break;default:pu(y,f),pc(f)}}function pc(f){var y=f.flags;if(y&2){try{e:{for(var M=f.return;M!==null;){if(MN(M)){var R=M;break e}M=M.return}throw Error(i(160))}switch(R.tag){case 5:var k=R.stateNode;R.flags&32&&(Ee(k,""),R.flags&=-33);var W=AN(f);OT(f,W,k);break;case 3:case 4:var se=R.stateNode.containerInfo,Te=AN(f);LT(f,Te,se);break;default:throw Error(i(161))}}catch(Le){fn(f,f.return,Le)}f.flags&=-3}y&4096&&(f.flags&=-4097)}function QJ(f,y,M){Qt=f,PN(f)}function PN(f,y,M){for(var R=(f.mode&1)!==0;Qt!==null;){var k=Qt,W=k.child;if(k.tag===22&&R){var se=k.memoizedState!==null||zS;if(!se){var Te=k.alternate,Le=Te!==null&&Te.memoizedState!==null||Ta;Te=zS;var Ze=Ta;if(zS=se,(Ta=Le)&&!Ze)for(Qt=k;Qt!==null;)se=Qt,Le=se.child,se.tag===22&&se.memoizedState!==null?IN(k):Le!==null?(Le.return=se,Qt=Le):IN(k);for(;W!==null;)Qt=W,PN(W),W=W.sibling;Qt=k,zS=Te,Ta=Ze}DN(f)}else(k.subtreeFlags&8772)!==0&&W!==null?(W.return=k,Qt=W):DN(f)}}function DN(f){for(;Qt!==null;){var y=Qt;if((y.flags&8772)!==0){var M=y.alternate;try{if((y.flags&8772)!==0)switch(y.tag){case 0:case 11:case 15:Ta||kS(5,y);break;case 1:var R=y.stateNode;if(y.flags&4&&!Ta)if(M===null)R.componentDidMount();else{var k=y.elementType===y.type?M.memoizedProps:$o(y.type,M.memoizedProps);R.componentDidUpdate(k,M.memoizedState,R.__reactInternalSnapshotBeforeUpdate)}var W=y.updateQueue;W!==null&&sn(y,W,R);break;case 3:var se=y.updateQueue;if(se!==null){if(M=null,y.child!==null)switch(y.child.tag){case 5:M=y.child.stateNode;break;case 1:M=y.child.stateNode}sn(y,se,M)}break;case 5:var Te=y.stateNode;if(M===null&&y.flags&4){M=Te;var Le=y.memoizedProps;switch(y.type){case"button":case"input":case"select":case"textarea":Le.autoFocus&&M.focus();break;case"img":Le.src&&(M.src=Le.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(y.memoizedState===null){var Ze=y.alternate;if(Ze!==null){var _t=Ze.memoizedState;if(_t!==null){var Mt=_t.dehydrated;Mt!==null&&Jp(Mt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(i(163))}Ta||y.flags&512&&IT(y)}catch(wt){fn(y,y.return,wt)}}if(y===f){Qt=null;break}if(M=y.sibling,M!==null){M.return=y.return,Qt=M;break}Qt=y.return}}function RN(f){for(;Qt!==null;){var y=Qt;if(y===f){Qt=null;break}var M=y.sibling;if(M!==null){M.return=y.return,Qt=M;break}Qt=y.return}}function IN(f){for(;Qt!==null;){var y=Qt;try{switch(y.tag){case 0:case 11:case 15:var M=y.return;try{kS(4,y)}catch(Le){fn(y,M,Le)}break;case 1:var R=y.stateNode;if(typeof R.componentDidMount=="function"){var k=y.return;try{R.componentDidMount()}catch(Le){fn(y,k,Le)}}var W=y.return;try{IT(y)}catch(Le){fn(y,W,Le)}break;case 5:var se=y.return;try{IT(y)}catch(Le){fn(y,se,Le)}}}catch(Le){fn(y,y.return,Le)}if(y===f){Qt=null;break}var Te=y.sibling;if(Te!==null){Te.return=y.return,Qt=Te;break}Qt=y.return}}var KJ=Math.ceil,BS=A.ReactCurrentDispatcher,zT=A.ReactCurrentOwner,Ml=A.ReactCurrentBatchConfig,or=0,Is=null,Yn=null,aa=0,rl=0,h0=Kr(0),fs=0,N1=null,Am=0,NS=0,kT=0,F1=null,To=null,BT=0,d0=1/0,Lh=null,FS=!1,NT=null,_f=null,US=!1,Sf=null,VS=0,U1=0,FT=null,jS=-1,HS=0;function Ka(){return(or&6)!==0?Rt():jS!==-1?jS:jS=Rt()}function Mf(f){return(f.mode&1)===0?1:(or&2)!==0&&aa!==0?aa&-aa:CT.transition!==null?(HS===0&&(HS=mo()),HS):(f=rr,f!==0||(f=window.event,f=f===void 0?16:aS(f.type)),f)}function mu(f,y,M,R){if(50<U1)throw U1=0,FT=null,Error(i(185));Yp(f,M,R),((or&2)===0||f!==Is)&&(f===Is&&((or&2)===0&&(NS|=M),fs===4&&Af(f,aa)),Po(f,R),M===1&&or===0&&(y.mode&1)===0&&(d0=Rt()+500,fm&&xl()))}function Po(f,y){var M=f.callbackNode;Ku(f,y);var R=Ql(f,f===Is?aa:0);if(R===0)M!==null&&tr(M),f.callbackNode=null,f.callbackPriority=0;else if(y=R&-R,f.callbackPriority!==y){if(M!=null&&tr(M),y===1)f.tag===0?wS(ON.bind(null,f)):pm(ON.bind(null,f)),ET(function(){(or&6)===0&&xl()}),M=null;else{switch(Gd(R)){case 1:M=Hi;break;case 4:M=ui;break;case 16:M=ls;break;case 536870912:M=hn;break;default:M=ls}M=jN(M,LN.bind(null,f))}f.callbackPriority=y,f.callbackNode=M}}function LN(f,y){if(jS=-1,HS=0,(or&6)!==0)throw Error(i(327));var M=f.callbackNode;if(f0()&&f.callbackNode!==M)return null;var R=Ql(f,f===Is?aa:0);if(R===0)return null;if((R&30)!==0||(R&f.expiredLanes)!==0||y)y=WS(f,R);else{y=R;var k=or;or|=2;var W=kN();(Is!==f||aa!==y)&&(Lh=null,d0=Rt()+500,Cm(f,y));do try{$J();break}catch(Te){zN(f,Te)}while(!0);hf(),BS.current=W,or=k,Yn!==null?y=0:(Is=null,aa=0,y=fs)}if(y!==0){if(y===2&&(k=dv(f),k!==0&&(R=k,y=UT(f,k))),y===1)throw M=N1,Cm(f,0),Af(f,R),Po(f,Rt()),M;if(y===6)Af(f,R);else{if(k=f.current.alternate,(R&30)===0&&!ZJ(k)&&(y=WS(f,R),y===2&&(W=dv(f),W!==0&&(R=W,y=UT(f,W))),y===1))throw M=N1,Cm(f,0),Af(f,R),Po(f,Rt()),M;switch(f.finishedWork=k,f.finishedLanes=R,y){case 0:case 1:throw Error(i(345));case 2:Tm(f,To,Lh);break;case 3:if(Af(f,R),(R&130023424)===R&&(y=BT+500-Rt(),10<y)){if(Ql(f,0)!==0)break;if(k=f.suspendedLanes,(k&R)!==R){Ka(),f.pingedLanes|=f.suspendedLanes&k;break}f.timeoutHandle=w1(Tm.bind(null,f,To,Lh),y);break}Tm(f,To,Lh);break;case 4:if(Af(f,R),(R&4194240)===R)break;for(y=f.eventTimes,k=-1;0<R;){var se=31-Se(R);W=1<<se,se=y[se],se>k&&(k=se),R&=~W}if(R=k,R=Rt()-R,R=(120>R?120:480>R?480:1080>R?1080:1920>R?1920:3e3>R?3e3:4320>R?4320:1960*KJ(R/1960))-R,10<R){f.timeoutHandle=w1(Tm.bind(null,f,To,Lh),R);break}Tm(f,To,Lh);break;case 5:Tm(f,To,Lh);break;default:throw Error(i(329))}}}return Po(f,Rt()),f.callbackNode===M?LN.bind(null,f):null}function UT(f,y){var M=F1;return f.current.memoizedState.isDehydrated&&(Cm(f,y).flags|=256),f=WS(f,y),f!==2&&(y=To,To=M,y!==null&&VT(y)),f}function VT(f){To===null?To=f:To.push.apply(To,f)}function ZJ(f){for(var y=f;;){if(y.flags&16384){var M=y.updateQueue;if(M!==null&&(M=M.stores,M!==null))for(var R=0;R<M.length;R++){var k=M[R],W=k.getSnapshot;k=k.value;try{if(!Wa(W(),k))return!1}catch{return!1}}}if(M=y.child,y.subtreeFlags&16384&&M!==null)M.return=y,y=M;else{if(y===f)break;for(;y.sibling===null;){if(y.return===null||y.return===f)return!0;y=y.return}y.sibling.return=y.return,y=y.sibling}}return!0}function Af(f,y){for(y&=~kT,y&=~NS,f.suspendedLanes|=y,f.pingedLanes&=~y,f=f.expirationTimes;0<y;){var M=31-Se(y),R=1<<M;f[M]=-1,y&=~R}}function ON(f){if((or&6)!==0)throw Error(i(327));f0();var y=Ql(f,0);if((y&1)===0)return Po(f,Rt()),null;var M=WS(f,y);if(f.tag!==0&&M===2){var R=dv(f);R!==0&&(y=R,M=UT(f,R))}if(M===1)throw M=N1,Cm(f,0),Af(f,y),Po(f,Rt()),M;if(M===6)throw Error(i(345));return f.finishedWork=f.current.alternate,f.finishedLanes=y,Tm(f,To,Lh),Po(f,Rt()),null}function jT(f,y){var M=or;or|=1;try{return f(y)}finally{or=M,or===0&&(d0=Rt()+500,fm&&xl())}}function Em(f){Sf!==null&&Sf.tag===0&&(or&6)===0&&f0();var y=or;or|=1;var M=Ml.transition,R=rr;try{if(Ml.transition=null,rr=1,f)return f()}finally{rr=R,Ml.transition=M,or=y,(or&6)===0&&xl()}}function HT(){rl=h0.current,Er(h0)}function Cm(f,y){f.finishedWork=null,f.finishedLanes=0;var M=f.timeoutHandle;if(M!==-1&&(f.timeoutHandle=-1,b1(M)),Yn!==null)for(M=Yn.return;M!==null;){var R=M;switch(lu(R),R.tag){case 1:R=R.type.childContextTypes,R!=null&&hm();break;case 3:bl(),Er(Js),Er(hs),Ea();break;case 5:vf(R);break;case 4:bl();break;case 13:Er(Cr);break;case 19:Er(Cr);break;case 10:df(R.type._context);break;case 22:case 23:HT()}M=M.return}if(Is=f,Yn=f=Ef(f.current,null),aa=rl=y,fs=0,N1=null,kT=NS=Am=0,To=F1=null,el!==null){for(y=0;y<el.length;y++)if(M=el[y],R=M.interleaved,R!==null){M.interleaved=null;var k=R.next,W=M.pending;if(W!==null){var se=W.next;W.next=k,R.next=se}M.pending=R}el=null}return f}function zN(f,y){do{var M=Yn;try{if(hf(),Rh.current=x,il){for(var R=Ir.memoizedState;R!==null;){var k=R.queue;k!==null&&(k.pending=null),R=R.next}il=!1}if(cc=0,Xn=an=Ir=null,yf=!1,xf=0,zT.current=null,M===null||M.return===null){fs=1,N1=y,Yn=null;break}e:{var W=f,se=M.return,Te=M,Le=y;if(y=aa,Te.flags|=32768,Le!==null&&typeof Le=="object"&&typeof Le.then=="function"){var Ze=Le,_t=Te,Mt=_t.tag;if((_t.mode&1)===0&&(Mt===0||Mt===11||Mt===15)){var wt=_t.alternate;wt?(_t.updateQueue=wt.updateQueue,_t.memoizedState=wt.memoizedState,_t.lanes=wt.lanes):(_t.updateQueue=null,_t.memoizedState=null)}var Wt=Ti(se);if(Wt!==null){Wt.flags&=-257,ci(Wt,se,Te,W,y),Wt.mode&1&&Gt(W,Ze,y),y=Wt,Le=Ze;var Zt=y.updateQueue;if(Zt===null){var ti=new Set;ti.add(Le),y.updateQueue=ti}else Zt.add(Le);break e}else{if((y&1)===0){Gt(W,Ze,y),WT();break e}Le=Error(i(426))}}else if(Rr&&Te.mode&1){var Tn=Ti(se);if(Tn!==null){(Tn.flags&65536)===0&&(Tn.flags|=256),ci(Tn,se,Te,W,y),cf(U(Le,Te));break e}}W=Le=U(Le,Te),fs!==4&&(fs=2),F1===null?F1=[W]:F1.push(W),W=se;do{switch(W.tag){case 3:W.flags|=65536,y&=-y,W.lanes|=y;var je=st(W,Le,y);ki(W,je);break e;case 1:Te=Le;var ke=W.type,qe=W.stateNode;if((W.flags&128)===0&&(typeof ke.getDerivedStateFromError=="function"||qe!==null&&typeof qe.componentDidCatch=="function"&&(_f===null||!_f.has(qe)))){W.flags|=65536,y&=-y,W.lanes|=y;var Pt=Ct(W,Te,y);ki(W,Pt);break e}}W=W.return}while(W!==null)}NN(M)}catch(ni){y=ni,Yn===M&&M!==null&&(Yn=M=M.return);continue}break}while(!0)}function kN(){var f=BS.current;return BS.current=x,f===null?x:f}function WT(){(fs===0||fs===3||fs===2)&&(fs=4),Is===null||(Am&268435455)===0&&(NS&268435455)===0||Af(Is,aa)}function WS(f,y){var M=or;or|=2;var R=kN();(Is!==f||aa!==y)&&(Lh=null,Cm(f,y));do try{JJ();break}catch(k){zN(f,k)}while(!0);if(hf(),or=M,BS.current=R,Yn!==null)throw Error(i(261));return Is=null,aa=0,fs}function JJ(){for(;Yn!==null;)BN(Yn)}function $J(){for(;Yn!==null&&!Qr();)BN(Yn)}function BN(f){var y=VN(f.alternate,f,rl);f.memoizedProps=f.pendingProps,y===null?NN(f):Yn=y,zT.current=null}function NN(f){var y=f;do{var M=y.alternate;if(f=y.return,(y.flags&32768)===0){if(M=GJ(M,y,rl),M!==null){Yn=M;return}}else{if(M=qJ(M,y),M!==null){M.flags&=32767,Yn=M;return}if(f!==null)f.flags|=32768,f.subtreeFlags=0,f.deletions=null;else{fs=6,Yn=null;return}}if(y=y.sibling,y!==null){Yn=y;return}Yn=y=f}while(y!==null);fs===0&&(fs=5)}function Tm(f,y,M){var R=rr,k=Ml.transition;try{Ml.transition=null,rr=1,e$(f,y,M,R)}finally{Ml.transition=k,rr=R}return null}function e$(f,y,M,R){do f0();while(Sf!==null);if((or&6)!==0)throw Error(i(327));M=f.finishedWork;var k=f.finishedLanes;if(M===null)return null;if(f.finishedWork=null,f.finishedLanes=0,M===f.current)throw Error(i(177));f.callbackNode=null,f.callbackPriority=0;var W=M.lanes|M.childLanes;if(_T(f,W),f===Is&&(Yn=Is=null,aa=0),(M.subtreeFlags&2064)===0&&(M.flags&2064)===0||US||(US=!0,jN(ls,function(){return f0(),null})),W=(M.flags&15990)!==0,(M.subtreeFlags&15990)!==0||W){W=Ml.transition,Ml.transition=null;var se=rr;rr=1;var Te=or;or|=4,zT.current=null,YJ(f,M),TN(M,f),Vn(y1),go=!!of,y1=of=null,f.current=M,QJ(M),ir(),or=Te,rr=se,Ml.transition=W}else f.current=M;if(US&&(US=!1,Sf=f,VS=k),W=f.pendingLanes,W===0&&(_f=null),ae(M.stateNode),Po(f,Rt()),y!==null)for(R=f.onRecoverableError,M=0;M<y.length;M++)k=y[M],R(k.value,{componentStack:k.stack,digest:k.digest});if(FS)throw FS=!1,f=NT,NT=null,f;return(VS&1)!==0&&f.tag!==0&&f0(),W=f.pendingLanes,(W&1)!==0?f===FT?U1++:(U1=0,FT=f):U1=0,xl(),null}function f0(){if(Sf!==null){var f=Gd(VS),y=Ml.transition,M=rr;try{if(Ml.transition=null,rr=16>f?16:f,Sf===null)var R=!1;else{if(f=Sf,Sf=null,VS=0,(or&6)!==0)throw Error(i(331));var k=or;for(or|=4,Qt=f.current;Qt!==null;){var W=Qt,se=W.child;if((Qt.flags&16)!==0){var Te=W.deletions;if(Te!==null){for(var Le=0;Le<Te.length;Le++){var Ze=Te[Le];for(Qt=Ze;Qt!==null;){var _t=Qt;switch(_t.tag){case 0:case 11:case 15:B1(8,_t,W)}var Mt=_t.child;if(Mt!==null)Mt.return=_t,Qt=Mt;else for(;Qt!==null;){_t=Qt;var wt=_t.sibling,Wt=_t.return;if(SN(_t),_t===Ze){Qt=null;break}if(wt!==null){wt.return=Wt,Qt=wt;break}Qt=Wt}}}var Zt=W.alternate;if(Zt!==null){var ti=Zt.child;if(ti!==null){Zt.child=null;do{var Tn=ti.sibling;ti.sibling=null,ti=Tn}while(ti!==null)}}Qt=W}}if((W.subtreeFlags&2064)!==0&&se!==null)se.return=W,Qt=se;else e:for(;Qt!==null;){if(W=Qt,(W.flags&2048)!==0)switch(W.tag){case 0:case 11:case 15:B1(9,W,W.return)}var je=W.sibling;if(je!==null){je.return=W.return,Qt=je;break e}Qt=W.return}}var ke=f.current;for(Qt=ke;Qt!==null;){se=Qt;var qe=se.child;if((se.subtreeFlags&2064)!==0&&qe!==null)qe.return=se,Qt=qe;else e:for(se=ke;Qt!==null;){if(Te=Qt,(Te.flags&2048)!==0)try{switch(Te.tag){case 0:case 11:case 15:kS(9,Te)}}catch(ni){fn(Te,Te.return,ni)}if(Te===se){Qt=null;break e}var Pt=Te.sibling;if(Pt!==null){Pt.return=Te.return,Qt=Pt;break e}Qt=Te.return}}if(or=k,xl(),ee&&typeof ee.onPostCommitFiberRoot=="function")try{ee.onPostCommitFiberRoot(Ui,f)}catch{}R=!0}return R}finally{rr=M,Ml.transition=y}}return!1}function FN(f,y,M){y=U(M,y),y=st(f,y,1),f=wl(f,y,1),y=Ka(),f!==null&&(Yp(f,1,y),Po(f,y))}function fn(f,y,M){if(f.tag===3)FN(f,f,M);else for(;y!==null;){if(y.tag===3){FN(y,f,M);break}else if(y.tag===1){var R=y.stateNode;if(typeof y.type.getDerivedStateFromError=="function"||typeof R.componentDidCatch=="function"&&(_f===null||!_f.has(R))){f=U(M,f),f=Ct(y,f,1),y=wl(y,f,1),f=Ka(),y!==null&&(Yp(y,1,f),Po(y,f));break}}y=y.return}}function t$(f,y,M){var R=f.pingCache;R!==null&&R.delete(y),y=Ka(),f.pingedLanes|=f.suspendedLanes&M,Is===f&&(aa&M)===M&&(fs===4||fs===3&&(aa&130023424)===aa&&500>Rt()-BT?Cm(f,0):kT|=M),Po(f,y)}function UN(f,y){y===0&&((f.mode&1)===0?y=1:(y=rn,rn<<=1,(rn&130023424)===0&&(rn=4194304)));var M=Ka();f=tl(f,y),f!==null&&(Yp(f,y,M),Po(f,M))}function i$(f){var y=f.memoizedState,M=0;y!==null&&(M=y.retryLane),UN(f,M)}function r$(f,y){var M=0;switch(f.tag){case 13:var R=f.stateNode,k=f.memoizedState;k!==null&&(M=k.retryLane);break;case 19:R=f.stateNode;break;default:throw Error(i(314))}R!==null&&R.delete(y),UN(f,M)}var VN;VN=function(f,y,M){if(f!==null)if(f.memoizedProps!==y.pendingProps||Js.current)jt=!0;else{if((f.lanes&M)===0&&(y.flags&128)===0)return jt=!1,WJ(f,y,M);jt=(f.flags&131072)!==0}else jt=!1,Rr&&(y.flags&1048576)!==0&&E1(y,Yv,y.index);switch(y.lanes=0,y.tag){case 2:var R=y.type;OS(f,y),f=y.pendingProps;var k=Sh(y,hs.current);uu(y,M),k=r0(null,y,R,f,k,M);var W=xm();return y.flags|=1,typeof k=="object"&&k!==null&&typeof k.render=="function"&&k.$$typeof===void 0?(y.tag=1,y.memoizedState=null,y.updateQueue=null,Ds(R)?(W=!0,Mh(y)):W=!1,y.memoizedState=k.state!==null&&k.state!==void 0?k.state:null,ym(y),k.updater=hu,y.stateNode=k,k._reactInternals=y,mf(y,R,f,M),y=Ei(null,y,R,!0,W,M)):(y.tag=0,Rr&&W&&C1(y),cr(null,y,k,M),y=y.child),y;case 16:R=y.elementType;e:{switch(OS(f,y),f=y.pendingProps,k=R._init,R=k(R._payload),y.type=R,k=y.tag=s$(R),f=$o(R,f),k){case 0:y=ei(null,y,R,f,M);break e;case 1:y=zi(null,y,R,f,M);break e;case 11:y=Qa(null,y,R,f,M);break e;case 14:y=Xe(null,y,R,$o(R.type,f),M);break e}throw Error(i(306,R,""))}return y;case 0:return R=y.type,k=y.pendingProps,k=y.elementType===R?k:$o(R,k),ei(f,y,R,k,M);case 1:return R=y.type,k=y.pendingProps,k=y.elementType===R?k:$o(R,k),zi(f,y,R,k,M);case 3:e:{if(Ji(y),f===null)throw Error(i(387));R=y.pendingProps,W=y.memoizedState,k=W.element,bS(f,y),Gr(y,R,null,M);var se=y.memoizedState;if(R=se.element,W.isDehydrated)if(W={element:R,isDehydrated:!1,cache:se.cache,pendingSuspenseBoundaries:se.pendingSuspenseBoundaries,transitions:se.transitions},y.updateQueue.baseState=W,y.memoizedState=W,y.flags&256){k=U(Error(i(423)),y),y=Cn(f,y,R,M,k);break e}else if(R!==k){k=U(Error(i(424)),y),y=Cn(f,y,R,M,k);break e}else for(ea=ru(y.stateNode.containerInfo.firstChild),ds=y,Rr=!0,So=null,M=Dh(y,null,R,M),y.child=M;M;)M.flags=M.flags&-3|4096,M=M.sibling;else{if(sc(),R===k){y=Ih(f,y,M);break e}cr(f,y,R,M)}y=y.child}return y;case 5:return t0(y),f===null&&Kv(y),R=y.type,k=y.pendingProps,W=f!==null?f.memoizedProps:null,se=k.children,x1(R,k)?se=null:W!==null&&x1(R,W)&&(y.flags|=32),Nt(f,y),cr(f,y,se,M),y.child;case 6:return f===null&&Kv(y),null;case 13:return IS(f,y,M);case 4:return gf(y,y.stateNode.containerInfo),R=y.pendingProps,f===null?y.child=oc(y,null,R,M):cr(f,y,R,M),y.child;case 11:return R=y.type,k=y.pendingProps,k=y.elementType===R?k:$o(R,k),Qa(f,y,R,k,M);case 7:return cr(f,y,y.pendingProps,M),y.child;case 8:return cr(f,y,y.pendingProps.children,M),y.child;case 12:return cr(f,y,y.pendingProps.children,M),y.child;case 10:e:{if(R=y.type._context,k=y.pendingProps,W=y.memoizedProps,se=k.value,yr(mm,R._currentValue),R._currentValue=se,W!==null)if(Wa(W.value,se)){if(W.children===k.children&&!Js.current){y=Ih(f,y,M);break e}}else for(W=y.child,W!==null&&(W.return=y);W!==null;){var Te=W.dependencies;if(Te!==null){se=W.child;for(var Le=Te.firstContext;Le!==null;){if(Le.context===R){if(W.tag===1){Le=Mo(-1,M&-M),Le.tag=2;var Ze=W.updateQueue;if(Ze!==null){Ze=Ze.shared;var _t=Ze.pending;_t===null?Le.next=Le:(Le.next=_t.next,_t.next=Le),Ze.pending=Le}}W.lanes|=M,Le=W.alternate,Le!==null&&(Le.lanes|=M),ff(W.return,M,y),Te.lanes|=M;break}Le=Le.next}}else if(W.tag===10)se=W.type===y.type?null:W.child;else if(W.tag===18){if(se=W.return,se===null)throw Error(i(341));se.lanes|=M,Te=se.alternate,Te!==null&&(Te.lanes|=M),ff(se,M,y),se=W.sibling}else se=W.child;if(se!==null)se.return=W;else for(se=W;se!==null;){if(se===y){se=null;break}if(W=se.sibling,W!==null){W.return=se.return,se=W;break}se=se.return}W=se}cr(f,y,k.children,M),y=y.child}return y;case 9:return k=y.type,R=y.pendingProps.children,uu(y,M),k=ta(k),R=R(k),y.flags|=1,cr(f,y,R,M),y.child;case 14:return R=y.type,k=$o(R,y.pendingProps),k=$o(R.type,k),Xe(f,y,R,k,M);case 15:return Fe(f,y,y.type,y.pendingProps,M);case 17:return R=y.type,k=y.pendingProps,k=y.elementType===R?k:$o(R,k),OS(f,y),y.tag=1,Ds(R)?(f=!0,Mh(y)):f=!1,uu(y,M),pf(y,R,k),mf(y,R,k,M),Ei(null,y,R,!0,f,M);case 19:return yN(f,y,M);case 22:return tt(f,y,M)}throw Error(i(156,y.tag))};function jN(f,y){return $t(f,y)}function n$(f,y,M,R){this.tag=f,this.key=M,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=y,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=R,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Al(f,y,M,R){return new n$(f,y,M,R)}function GT(f){return f=f.prototype,!(!f||!f.isReactComponent)}function s$(f){if(typeof f=="function")return GT(f)?1:0;if(f!=null){if(f=f.$$typeof,f===G)return 11;if(f===J)return 14}return 2}function Ef(f,y){var M=f.alternate;return M===null?(M=Al(f.tag,y,f.key,f.mode),M.elementType=f.elementType,M.type=f.type,M.stateNode=f.stateNode,M.alternate=f,f.alternate=M):(M.pendingProps=y,M.type=f.type,M.flags=0,M.subtreeFlags=0,M.deletions=null),M.flags=f.flags&14680064,M.childLanes=f.childLanes,M.lanes=f.lanes,M.child=f.child,M.memoizedProps=f.memoizedProps,M.memoizedState=f.memoizedState,M.updateQueue=f.updateQueue,y=f.dependencies,M.dependencies=y===null?null:{lanes:y.lanes,firstContext:y.firstContext},M.sibling=f.sibling,M.index=f.index,M.ref=f.ref,M}function GS(f,y,M,R,k,W){var se=2;if(R=f,typeof f=="function")GT(f)&&(se=1);else if(typeof f=="string")se=5;else e:switch(f){case I:return Pm(M.children,k,W,y);case T:se=8,k|=8;break;case D:return f=Al(12,M,y,k|2),f.elementType=D,f.lanes=W,f;case V:return f=Al(13,M,y,k),f.elementType=V,f.lanes=W,f;case j:return f=Al(19,M,y,k),f.elementType=j,f.lanes=W,f;case K:return qS(M,k,W,y);default:if(typeof f=="object"&&f!==null)switch(f.$$typeof){case L:se=10;break e;case z:se=9;break e;case G:se=11;break e;case J:se=14;break e;case ne:se=16,R=null;break e}throw Error(i(130,f==null?f:typeof f,""))}return y=Al(se,M,y,k),y.elementType=f,y.type=R,y.lanes=W,y}function Pm(f,y,M,R){return f=Al(7,f,R,y),f.lanes=M,f}function qS(f,y,M,R){return f=Al(22,f,R,y),f.elementType=K,f.lanes=M,f.stateNode={isHidden:!1},f}function qT(f,y,M){return f=Al(6,f,null,y),f.lanes=M,f}function XT(f,y,M){return y=Al(4,f.children!==null?f.children:[],f.key,y),y.lanes=M,y.stateNode={containerInfo:f.containerInfo,pendingChildren:null,implementation:f.implementation},y}function a$(f,y,M,R,k){this.tag=y,this.containerInfo=f,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=e1(0),this.expirationTimes=e1(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=e1(0),this.identifierPrefix=R,this.onRecoverableError=k,this.mutableSourceEagerHydrationData=null}function YT(f,y,M,R,k,W,se,Te,Le){return f=new a$(f,y,M,Te,Le),y===1?(y=1,W===!0&&(y|=8)):y=0,W=Al(3,null,null,y),f.current=W,W.stateNode=f,W.memoizedState={element:R,isDehydrated:M,cache:null,transitions:null,pendingSuspenseBoundaries:null},ym(W),f}function o$(f,y,M){var R=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:E,key:R==null?null:""+R,children:f,containerInfo:y,implementation:M}}function HN(f){if(!f)return su;f=f._reactInternals;e:{if(St(f)!==f||f.tag!==1)throw Error(i(170));var y=f;do{switch(y.tag){case 3:y=y.stateNode.context;break e;case 1:if(Ds(y.type)){y=y.stateNode.__reactInternalMemoizedMergedChildContext;break e}}y=y.return}while(y!==null);throw Error(i(171))}if(f.tag===1){var M=f.type;if(Ds(M))return dm(f,M,y)}return y}function WN(f,y,M,R,k,W,se,Te,Le){return f=YT(M,R,!0,f,k,W,se,Te,Le),f.context=HN(null),M=f.current,R=Ka(),k=Mf(M),W=Mo(R,k),W.callback=y??null,wl(M,W,k),f.current.lanes=k,Yp(f,k,R),Po(f,R),f}function XS(f,y,M,R){var k=y.current,W=Ka(),se=Mf(k);return M=HN(M),y.context===null?y.context=M:y.pendingContext=M,y=Mo(W,se),y.payload={element:f},R=R===void 0?null:R,R!==null&&(y.callback=R),f=wl(k,y,se),f!==null&&(mu(f,k,se,W),Nr(f,k,se)),se}function YS(f){if(f=f.current,!f.child)return null;switch(f.child.tag){case 5:return f.child.stateNode;default:return f.child.stateNode}}function GN(f,y){if(f=f.memoizedState,f!==null&&f.dehydrated!==null){var M=f.retryLane;f.retryLane=M!==0&&M<y?M:y}}function QT(f,y){GN(f,y),(f=f.alternate)&&GN(f,y)}function l$(){return null}var qN=typeof reportError=="function"?reportError:function(f){console.error(f)};function KT(f){this._internalRoot=f}QS.prototype.render=KT.prototype.render=function(f){var y=this._internalRoot;if(y===null)throw Error(i(409));XS(f,y,null,null)},QS.prototype.unmount=KT.prototype.unmount=function(){var f=this._internalRoot;if(f!==null){this._internalRoot=null;var y=f.containerInfo;Em(function(){XS(null,f,null,null)}),y[qa]=null}};function QS(f){this._internalRoot=f}QS.prototype.unstable_scheduleHydration=function(f){if(f){var y=fv();f={blockedOn:null,target:f,priority:y};for(var M=0;M<Zu.length&&y!==0&&y<Zu[M].priority;M++);Zu.splice(M,0,f),M===0&&gv(f)}};function ZT(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)}function KS(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11&&(f.nodeType!==8||f.nodeValue!==" react-mount-point-unstable "))}function XN(){}function u$(f,y,M,R,k){if(k){if(typeof R=="function"){var W=R;R=function(){var Ze=YS(se);W.call(Ze)}}var se=WN(y,R,f,0,null,!1,!1,"",XN);return f._reactRootContainer=se,f[qa]=se.current,sf(f.nodeType===8?f.parentNode:f),Em(),se}for(;k=f.lastChild;)f.removeChild(k);if(typeof R=="function"){var Te=R;R=function(){var Ze=YS(Le);Te.call(Ze)}}var Le=YT(f,0,!1,null,null,!1,!1,"",XN);return f._reactRootContainer=Le,f[qa]=Le.current,sf(f.nodeType===8?f.parentNode:f),Em(function(){XS(y,Le,M,R)}),Le}function ZS(f,y,M,R,k){var W=M._reactRootContainer;if(W){var se=W;if(typeof k=="function"){var Te=k;k=function(){var Le=YS(se);Te.call(Le)}}XS(y,se,f,k)}else se=u$(M,y,f,k,R);return YS(se)}Qp=function(f){switch(f.tag){case 3:var y=f.stateNode;if(y.current.memoizedState.isDehydrated){var M=ja(y.pendingLanes);M!==0&&(Wd(y,M|1),Po(y,Rt()),(or&6)===0&&(d0=Rt()+500,xl()))}break;case 13:Em(function(){var R=tl(f,1);if(R!==null){var k=Ka();mu(R,f,1,k)}}),QT(f,1)}},t1=function(f){if(f.tag===13){var y=tl(f,134217728);if(y!==null){var M=Ka();mu(y,f,134217728,M)}QT(f,134217728)}},sS=function(f){if(f.tag===13){var y=Mf(f),M=tl(f,y);if(M!==null){var R=Ka();mu(M,f,y,R)}QT(f,y)}},fv=function(){return rr},pv=function(f,y){var M=rr;try{return rr=f,y()}finally{rr=M}},we=function(f,y,M){switch(y){case"input":if(ot(f,M),y=M.name,M.type==="radio"&&y!=null){for(M=f;M.parentNode;)M=M.parentNode;for(M=M.querySelectorAll("input[name="+JSON.stringify(""+y)+'][type="radio"]'),y=0;y<M.length;y++){var R=M[y];if(R!==f&&R.form===f.form){var k=Gv(R);if(!k)throw Error(i(90));Me(R),ot(R,k)}}}break;case"textarea":de(f,M);break;case"select":y=M.value,y!=null&&xt(f,!!M.multiple,y,!1)}},Si=jT,ar=Em;var c$={usingClientEntryPoint:!1,Events:[nu,nn,Gv,Ut,si,jT]},V1={findFiberByHostInstance:nc,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},h$={bundleType:V1.bundleType,version:V1.version,rendererPackageName:V1.rendererPackageName,rendererConfig:V1.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:A.ReactCurrentDispatcher,findHostInstanceByFiber:function(f){return f=zt(f),f===null?null:f.stateNode},findFiberByHostInstance:V1.findFiberByHostInstance||l$,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var JS=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!JS.isDisabled&&JS.supportsFiber)try{Ui=JS.inject(h$),ee=JS}catch{}}return Do.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=c$,Do.createPortal=function(f,y){var M=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ZT(y))throw Error(i(200));return o$(f,y,null,M)},Do.createRoot=function(f,y){if(!ZT(f))throw Error(i(299));var M=!1,R="",k=qN;return y!=null&&(y.unstable_strictMode===!0&&(M=!0),y.identifierPrefix!==void 0&&(R=y.identifierPrefix),y.onRecoverableError!==void 0&&(k=y.onRecoverableError)),y=YT(f,1,!1,null,null,M,!1,R,k),f[qa]=y.current,sf(f.nodeType===8?f.parentNode:f),new KT(y)},Do.findDOMNode=function(f){if(f==null)return null;if(f.nodeType===1)return f;var y=f._reactInternals;if(y===void 0)throw typeof f.render=="function"?Error(i(188)):(f=Object.keys(f).join(","),Error(i(268,f)));return f=zt(y),f=f===null?null:f.stateNode,f},Do.flushSync=function(f){return Em(f)},Do.hydrate=function(f,y,M){if(!KS(y))throw Error(i(200));return ZS(null,f,y,!0,M)},Do.hydrateRoot=function(f,y,M){if(!ZT(f))throw Error(i(405));var R=M!=null&&M.hydratedSources||null,k=!1,W="",se=qN;if(M!=null&&(M.unstable_strictMode===!0&&(k=!0),M.identifierPrefix!==void 0&&(W=M.identifierPrefix),M.onRecoverableError!==void 0&&(se=M.onRecoverableError)),y=WN(y,null,f,1,M??null,k,!1,W,se),f[qa]=y.current,sf(f),R)for(f=0;f<R.length;f++)M=R[f],k=M._getVersion,k=k(M._source),y.mutableSourceEagerHydrationData==null?y.mutableSourceEagerHydrationData=[M,k]:y.mutableSourceEagerHydrationData.push(M,k);return new QS(y)},Do.render=function(f,y,M){if(!KS(y))throw Error(i(200));return ZS(null,f,y,!1,M)},Do.unmountComponentAtNode=function(f){if(!KS(f))throw Error(i(40));return f._reactRootContainer?(Em(function(){ZS(null,null,f,!1,function(){f._reactRootContainer=null,f[qa]=null})}),!0):!1},Do.unstable_batchedUpdates=jT,Do.unstable_renderSubtreeIntoContainer=function(f,y,M,R){if(!KS(M))throw Error(i(200));if(f==null||f._reactInternals===void 0)throw Error(i(38));return ZS(f,y,M,!1,R)},Do.version="18.2.0-next-9e3b772b8-20220608",Do}var tF;function b$(){if(tF)return eP.exports;tF=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),eP.exports=w$(),eP.exports}var iF;function _$(){if(iF)return $S;iF=1;var e=b$();return $S.createRoot=e.createRoot,$S.hydrateRoot=e.hydrateRoot,$S}var YG=_$(),rP,rF;function S$(){if(rF)return rP;rF=1;var e="Expected a function",t=NaN,i="[object Symbol]",r=/^\s+|\s+$/g,n=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,a=/^0o[0-7]+$/i,o=parseInt,l=typeof ap=="object"&&ap&&ap.Object===Object&&ap,u=typeof self=="object"&&self&&self.Object===Object&&self,c=l||u||Function("return this")(),h=Object.prototype,d=h.toString,p=Math.max,m=Math.min,v=function(){return c.Date.now()};function g(E,I,T){var D,L,z,G,V,j,J=0,ne=!1,K=!1,B=!0;if(typeof E!="function")throw new TypeError(e);I=C(I)||0,S(T)&&(ne=!!T.leading,K="maxWait"in T,z=K?p(C(T.maxWait)||0,I):z,B="trailing"in T?!!T.trailing:B);function Z(he){var Ce=D,Ae=L;return D=L=void 0,J=he,G=E.apply(Ae,Ce),G}function F(he){return J=he,V=setTimeout(le,I),ne?Z(he):G}function X(he){var Ce=he-j,Ae=he-J,Ie=I-Ce;return K?m(Ie,z-Ae):Ie}function Y(he){var Ce=he-j,Ae=he-J;return j===void 0||Ce>=I||Ce<0||K&&Ae>=z}function le(){var he=v();if(Y(he))return oe(he);V=setTimeout(le,X(he))}function oe(he){return V=void 0,B&&D?Z(he):(D=L=void 0,G)}function re(){V!==void 0&&clearTimeout(V),J=0,D=j=L=V=void 0}function ue(){return V===void 0?G:oe(v())}function me(){var he=v(),Ce=Y(he);if(D=arguments,L=this,j=he,Ce){if(V===void 0)return F(j);if(K)return V=setTimeout(le,I),Z(j)}return V===void 0&&(V=setTimeout(le,I)),G}return me.cancel=re,me.flush=ue,me}function w(E,I,T){var D=!0,L=!0;if(typeof E!="function")throw new TypeError(e);return S(T)&&(D="leading"in T?!!T.leading:D,L="trailing"in T?!!T.trailing:L),g(E,I,{leading:D,maxWait:I,trailing:L})}function S(E){var I=typeof E;return!!E&&(I=="object"||I=="function")}function _(E){return!!E&&typeof E=="object"}function A(E){return typeof E=="symbol"||_(E)&&d.call(E)==i}function C(E){if(typeof E=="number")return E;if(A(E))return t;if(S(E)){var I=typeof E.valueOf=="function"?E.valueOf():E;E=S(I)?I+"":I}if(typeof E!="string")return E===0?E:+E;E=E.replace(r,"");var T=s.test(E);return T||a.test(E)?o(E.slice(2),T?2:8):n.test(E)?t:+E}return rP=w,rP}var M$=S$();const A$=xC(M$);var nP,nF;function E$(){if(nF)return nP;nF=1;var e="Expected a function",t=NaN,i="[object Symbol]",r=/^\s+|\s+$/g,n=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,a=/^0o[0-7]+$/i,o=parseInt,l=typeof ap=="object"&&ap&&ap.Object===Object&&ap,u=typeof self=="object"&&self&&self.Object===Object&&self,c=l||u||Function("return this")(),h=Object.prototype,d=h.toString,p=Math.max,m=Math.min,v=function(){return c.Date.now()};function g(C,E,I){var T,D,L,z,G,V,j=0,J=!1,ne=!1,K=!0;if(typeof C!="function")throw new TypeError(e);E=A(E)||0,w(I)&&(J=!!I.leading,ne="maxWait"in I,L=ne?p(A(I.maxWait)||0,E):L,K="trailing"in I?!!I.trailing:K);function B(me){var he=T,Ce=D;return T=D=void 0,j=me,z=C.apply(Ce,he),z}function Z(me){return j=me,G=setTimeout(Y,E),J?B(me):z}function F(me){var he=me-V,Ce=me-j,Ae=E-he;return ne?m(Ae,L-Ce):Ae}function X(me){var he=me-V,Ce=me-j;return V===void 0||he>=E||he<0||ne&&Ce>=L}function Y(){var me=v();if(X(me))return le(me);G=setTimeout(Y,F(me))}function le(me){return G=void 0,K&&T?B(me):(T=D=void 0,z)}function oe(){G!==void 0&&clearTimeout(G),j=0,T=V=D=G=void 0}function re(){return G===void 0?z:le(v())}function ue(){var me=v(),he=X(me);if(T=arguments,D=this,V=me,he){if(G===void 0)return Z(V);if(ne)return G=setTimeout(Y,E),B(V)}return G===void 0&&(G=setTimeout(Y,E)),z}return ue.cancel=oe,ue.flush=re,ue}function w(C){var E=typeof C;return!!C&&(E=="object"||E=="function")}function S(C){return!!C&&typeof C=="object"}function _(C){return typeof C=="symbol"||S(C)&&d.call(C)==i}function A(C){if(typeof C=="number")return C;if(_(C))return t;if(w(C)){var E=typeof C.valueOf=="function"?C.valueOf():C;C=w(E)?E+"":E}if(typeof C!="string")return C===0?C:+C;C=C.replace(r,"");var I=s.test(C);return I||a.test(C)?o(C.slice(2),I?2:8):n.test(C)?t:+C}return nP=g,nP}var C$=E$();const DR=xC(C$);var QG=function(){};function KG(e){var t=void 0,i=void 0,r=void 0;for(t=0;t<e.length;t+=1)if(i=e[t],i.dataset&&i.dataset.aos||(r=i.children&&KG(i.children),r))return!0;return!1}function T$(e){e&&e.forEach(function(t){var i=Array.prototype.slice.call(t.addedNodes),r=Array.prototype.slice.call(t.removedNodes),n=i.concat(r);if(KG(n))return QG()})}function ZG(){return window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver}function P$(){return!!ZG()}function D$(e,t){var i=window.document,r=ZG(),n=new r(T$);QG=t,n.observe(i.documentElement,{childList:!0,subtree:!0,removedNodes:!0})}var sF={isSupported:P$,ready:D$},R$=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},I$=(function(){function e(t,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}})(),L$=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},O$=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i,z$=/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i,k$=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i,B$=/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i;function aF(){return navigator.userAgent||navigator.vendor||window.opera||""}var N$=(function(){function e(){R$(this,e)}return I$(e,[{key:"phone",value:function(){var i=aF();return!!(O$.test(i)||z$.test(i.substr(0,4)))}},{key:"mobile",value:function(){var i=aF();return!!(k$.test(i)||B$.test(i.substr(0,4)))}},{key:"tablet",value:function(){return this.mobile()&&!this.phone()}},{key:"ie11",value:function(){return"-ms-scroll-limit"in document.documentElement.style&&"-ms-ime-align"in document.documentElement.style}}]),e})(),xE=new N$,F$=function(t,i){return i&&i.forEach(function(r){return t.classList.add(r)})},U$=function(t,i){return i&&i.forEach(function(r){return t.classList.remove(r)})},eM=function(t,i){var r=void 0;return xE.ie11()?(r=document.createEvent("CustomEvent"),r.initCustomEvent(t,!0,!0,{detail:i})):r=new CustomEvent(t,{detail:i}),document.dispatchEvent(r)},V$=function(t,i){var r=t.options,n=t.position,s=t.node;t.data;var a=function(){t.animated&&(U$(s,r.animatedClassNames),eM("aos:out",s),t.options.id&&eM("aos:in:"+t.options.id,s),t.animated=!1)},o=function(){t.animated||(F$(s,r.animatedClassNames),eM("aos:in",s),t.options.id&&eM("aos:in:"+t.options.id,s),t.animated=!0)};r.mirror&&i>=n.out&&!r.once?a():i>=n.in?o():t.animated&&!r.once&&a()},oF=function(t){return t.forEach(function(i,r){return V$(i,window.pageYOffset)})},JG=function(t){for(var i=0,r=0;t&&!isNaN(t.offsetLeft)&&!isNaN(t.offsetTop);)i+=t.offsetLeft-(t.tagName!="BODY"?t.scrollLeft:0),r+=t.offsetTop-(t.tagName!="BODY"?t.scrollTop:0),t=t.offsetParent;return{top:r,left:i}},xp=(function(e,t,i){var r=e.getAttribute("data-aos-"+t);if(typeof r<"u"){if(r==="true")return!0;if(r==="false")return!1}return r||i}),j$=function(t,i,r){var n=window.innerHeight,s=xp(t,"anchor"),a=xp(t,"anchor-placement"),o=Number(xp(t,"offset",a?0:i)),l=a||r,u=t;s&&document.querySelectorAll(s)&&(u=document.querySelectorAll(s)[0]);var c=JG(u).top-n;switch(l){case"top-bottom":break;case"center-bottom":c+=u.offsetHeight/2;break;case"bottom-bottom":c+=u.offsetHeight;break;case"top-center":c+=n/2;break;case"center-center":c+=n/2+u.offsetHeight/2;break;case"bottom-center":c+=n/2+u.offsetHeight;break;case"top-top":c+=n;break;case"bottom-top":c+=n+u.offsetHeight;break;case"center-top":c+=n+u.offsetHeight/2;break}return c+o},H$=function(t,i){var r=xp(t,"anchor"),n=xp(t,"offset",i),s=t;r&&document.querySelectorAll(r)&&(s=document.querySelectorAll(r)[0]);var a=JG(s).top;return a+s.offsetHeight-n},W$=function(t,i){return t.forEach(function(r,n){var s=xp(r.node,"mirror",i.mirror),a=xp(r.node,"once",i.once),o=xp(r.node,"id"),l=i.useClassNames&&r.node.getAttribute("data-aos"),u=[i.animatedClassName].concat(l?l.split(" "):[]).filter(function(c){return typeof c=="string"});i.initClassName&&r.node.classList.add(i.initClassName),r.position={in:j$(r.node,i.offset,i.anchorPlacement),out:s&&H$(r.node,i.offset)},r.options={once:a,mirror:s,animatedClassNames:u,id:o}}),t},$G=(function(){var e=document.querySelectorAll("[data-aos]");return Array.prototype.map.call(e,function(t){return{node:t}})}),ud=[],lF=!1,gn={offset:120,delay:0,easing:"ease",duration:400,disable:!1,once:!1,mirror:!1,anchorPlacement:"top-bottom",startEvent:"DOMContentLoaded",animatedClassName:"aos-animate",initClassName:"aos-init",useClassNames:!1,disableMutationObserver:!1,throttleDelay:99,debounceDelay:50},e8=function(){return document.all&&!window.atob},G$=function(){return ud=W$(ud,gn),oF(ud),window.addEventListener("scroll",A$(function(){oF(ud,gn.once)},gn.throttleDelay)),ud},eg=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;t&&(lF=!0),lF&&G$()},t8=function(){if(ud=$G(),r8(gn.disable)||e8())return i8();eg()},i8=function(){ud.forEach(function(t,i){t.node.removeAttribute("data-aos"),t.node.removeAttribute("data-aos-easing"),t.node.removeAttribute("data-aos-duration"),t.node.removeAttribute("data-aos-delay"),gn.initClassName&&t.node.classList.remove(gn.initClassName),gn.animatedClassName&&t.node.classList.remove(gn.animatedClassName)})},r8=function(t){return t===!0||t==="mobile"&&xE.mobile()||t==="phone"&&xE.phone()||t==="tablet"&&xE.tablet()||typeof t=="function"&&t()===!0},q$=function(t){return gn=L$(gn,t),ud=$G(),!gn.disableMutationObserver&&!sF.isSupported()&&(console.info(`
      aos: MutationObserver is not supported on this browser,
      code mutations observing has been disabled.
      You may have to call "refreshHard()" by yourself.
    `),gn.disableMutationObserver=!0),gn.disableMutationObserver||sF.ready("[data-aos]",t8),r8(gn.disable)||e8()?i8():(document.querySelector("body").setAttribute("data-aos-easing",gn.easing),document.querySelector("body").setAttribute("data-aos-duration",gn.duration),document.querySelector("body").setAttribute("data-aos-delay",gn.delay),["DOMContentLoaded","load"].indexOf(gn.startEvent)===-1?document.addEventListener(gn.startEvent,function(){eg(!0)}):window.addEventListener("load",function(){eg(!0)}),gn.startEvent==="DOMContentLoaded"&&["complete","interactive"].indexOf(document.readyState)>-1&&eg(!0),window.addEventListener("resize",DR(eg,gn.debounceDelay,!0)),window.addEventListener("orientationchange",DR(eg,gn.debounceDelay,!0)),ud)},X$={init:q$,refresh:eg,refreshHard:t8};var uF="popstate";function Y$(e={}){function t(r,n){let{pathname:s,search:a,hash:o}=r.location;return RR("",{pathname:s,search:a,hash:o},n.state&&n.state.usr||null,n.state&&n.state.key||"default")}function i(r,n){return typeof n=="string"?n:Sb(n)}return K$(t,i,null,e)}function Ss(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function Uu(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function Q$(){return Math.random().toString(36).substring(2,10)}function cF(e,t){return{usr:e.state,key:e.key,idx:t}}function RR(e,t,i=null,r){return{pathname:typeof e=="string"?e:e.pathname,search:"",hash:"",...typeof t=="string"?v_(t):t,state:i,key:t&&t.key||r||Q$()}}function Sb({pathname:e="/",search:t="",hash:i=""}){return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),i&&i!=="#"&&(e+=i.charAt(0)==="#"?i:"#"+i),e}function v_(e){let t={};if(e){let i=e.indexOf("#");i>=0&&(t.hash=e.substring(i),e=e.substring(0,i));let r=e.indexOf("?");r>=0&&(t.search=e.substring(r),e=e.substring(0,r)),e&&(t.pathname=e)}return t}function K$(e,t,i,r={}){let{window:n=document.defaultView,v5Compat:s=!1}=r,a=n.history,o="POP",l=null,u=c();u==null&&(u=0,a.replaceState({...a.state,idx:u},""));function c(){return(a.state||{idx:null}).idx}function h(){o="POP";let g=c(),w=g==null?null:g-u;u=g,l&&l({action:o,location:v.location,delta:w})}function d(g,w){o="PUSH";let S=RR(v.location,g,w);u=c()+1;let _=cF(S,u),A=v.createHref(S);try{a.pushState(_,"",A)}catch(C){if(C instanceof DOMException&&C.name==="DataCloneError")throw C;n.location.assign(A)}s&&l&&l({action:o,location:v.location,delta:1})}function p(g,w){o="REPLACE";let S=RR(v.location,g,w);u=c();let _=cF(S,u),A=v.createHref(S);a.replaceState(_,"",A),s&&l&&l({action:o,location:v.location,delta:0})}function m(g){return Z$(g)}let v={get action(){return o},get location(){return e(n,a)},listen(g){if(l)throw new Error("A history only accepts one active listener");return n.addEventListener(uF,h),l=g,()=>{n.removeEventListener(uF,h),l=null}},createHref(g){return t(n,g)},createURL:m,encodeLocation(g){let w=m(g);return{pathname:w.pathname,search:w.search,hash:w.hash}},push:d,replace:p,go(g){return a.go(g)}};return v}function Z$(e,t=!1){let i="http://localhost";typeof window<"u"&&(i=window.location.origin!=="null"?window.location.origin:window.location.href),Ss(i,"No window.location.(origin|href) available to create URL");let r=typeof e=="string"?e:Sb(e);return r=r.replace(/ $/,"%20"),!t&&r.startsWith("//")&&(r=i+r),new URL(r,i)}function n8(e,t,i="/"){return J$(e,t,i,!1)}function J$(e,t,i,r){let n=typeof t=="string"?v_(t):t,s=Ad(n.pathname||"/",i);if(s==null)return null;let a=s8(e);$$(a);let o=null;for(let l=0;o==null&&l<a.length;++l){let u=cee(s);o=lee(a[l],u,r)}return o}function s8(e,t=[],i=[],r="",n=!1){let s=(a,o,l=n,u)=>{let c={relativePath:u===void 0?a.path||"":u,caseSensitive:a.caseSensitive===!0,childrenIndex:o,route:a};if(c.relativePath.startsWith("/")){if(!c.relativePath.startsWith(r)&&l)return;Ss(c.relativePath.startsWith(r),`Absolute route path "${c.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),c.relativePath=c.relativePath.slice(r.length)}let h=bd([r,c.relativePath]),d=i.concat(c);a.children&&a.children.length>0&&(Ss(a.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${h}".`),s8(a.children,t,d,h,l)),!(a.path==null&&!a.index)&&t.push({path:h,score:aee(h,a.index),routesMeta:d})};return e.forEach((a,o)=>{if(a.path===""||!a.path?.includes("?"))s(a,o);else for(let l of a8(a.path))s(a,o,!0,l)}),t}function a8(e){let t=e.split("/");if(t.length===0)return[];let[i,...r]=t,n=i.endsWith("?"),s=i.replace(/\?$/,"");if(r.length===0)return n?[s,""]:[s];let a=a8(r.join("/")),o=[];return o.push(...a.map(l=>l===""?s:[s,l].join("/"))),n&&o.push(...a),o.map(l=>e.startsWith("/")&&l===""?"/":l)}function $$(e){e.sort((t,i)=>t.score!==i.score?i.score-t.score:oee(t.routesMeta.map(r=>r.childrenIndex),i.routesMeta.map(r=>r.childrenIndex)))}var eee=/^:[\w-]+$/,tee=3,iee=2,ree=1,nee=10,see=-2,hF=e=>e==="*";function aee(e,t){let i=e.split("/"),r=i.length;return i.some(hF)&&(r+=see),t&&(r+=iee),i.filter(n=>!hF(n)).reduce((n,s)=>n+(eee.test(s)?tee:s===""?ree:nee),r)}function oee(e,t){return e.length===t.length&&e.slice(0,-1).every((r,n)=>r===t[n])?e[e.length-1]-t[t.length-1]:0}function lee(e,t,i=!1){let{routesMeta:r}=e,n={},s="/",a=[];for(let o=0;o<r.length;++o){let l=r[o],u=o===r.length-1,c=s==="/"?t:t.slice(s.length)||"/",h=JE({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},c),d=l.route;if(!h&&u&&i&&!r[r.length-1].route.index&&(h=JE({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},c)),!h)return null;Object.assign(n,h.params),a.push({params:n,pathname:bd([s,h.pathname]),pathnameBase:mee(bd([s,h.pathnameBase])),route:d}),h.pathnameBase!=="/"&&(s=bd([s,h.pathnameBase]))}return a}function JE(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[i,r]=uee(e.path,e.caseSensitive,e.end),n=t.match(i);if(!n)return null;let s=n[0],a=s.replace(/(.)\/+$/,"$1"),o=n.slice(1);return{params:r.reduce((u,{paramName:c,isOptional:h},d)=>{if(c==="*"){let m=o[d]||"";a=s.slice(0,s.length-m.length).replace(/(.)\/+$/,"$1")}const p=o[d];return h&&!p?u[c]=void 0:u[c]=(p||"").replace(/%2F/g,"/"),u},{}),pathname:s,pathnameBase:a,pattern:e}}function uee(e,t=!1,i=!0){Uu(e==="*"||!e.endsWith("*")||e.endsWith("/*"),`Route path "${e}" will be treated as if it were "${e.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${e.replace(/\*$/,"/*")}".`);let r=[],n="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,o,l)=>(r.push({paramName:o,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return e.endsWith("*")?(r.push({paramName:"*"}),n+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?n+="\\/*$":e!==""&&e!=="/"&&(n+="(?:(?=\\/|$))"),[new RegExp(n,t?void 0:"i"),r]}function cee(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Uu(!1,`The URL path "${e}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),e}}function Ad(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let i=t.endsWith("/")?t.length-1:t.length,r=e.charAt(i);return r&&r!=="/"?null:e.slice(i)||"/"}var hee=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,dee=e=>hee.test(e);function fee(e,t="/"){let{pathname:i,search:r="",hash:n=""}=typeof e=="string"?v_(e):e,s;if(i)if(dee(i))s=i;else{if(i.includes("//")){let a=i;i=i.replace(/\/\/+/g,"/"),Uu(!1,`Pathnames cannot have embedded double slashes - normalizing ${a} -> ${i}`)}i.startsWith("/")?s=dF(i.substring(1),"/"):s=dF(i,t)}else s=t;return{pathname:s,search:gee(r),hash:vee(n)}}function dF(e,t){let i=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(n=>{n===".."?i.length>1&&i.pop():n!=="."&&i.push(n)}),i.length>1?i.join("/"):"/"}function sP(e,t,i,r){return`Cannot include a '${e}' character in a manually specified \`to.${t}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${i}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function pee(e){return e.filter((t,i)=>i===0||t.route.path&&t.route.path.length>0)}function o8(e){let t=pee(e);return t.map((i,r)=>r===t.length-1?i.pathname:i.pathnameBase)}function l8(e,t,i,r=!1){let n;typeof e=="string"?n=v_(e):(n={...e},Ss(!n.pathname||!n.pathname.includes("?"),sP("?","pathname","search",n)),Ss(!n.pathname||!n.pathname.includes("#"),sP("#","pathname","hash",n)),Ss(!n.search||!n.search.includes("#"),sP("#","search","hash",n)));let s=e===""||n.pathname==="",a=s?"/":n.pathname,o;if(a==null)o=i;else{let h=t.length-1;if(!r&&a.startsWith("..")){let d=a.split("/");for(;d[0]==="..";)d.shift(),h-=1;n.pathname=d.join("/")}o=h>=0?t[h]:"/"}let l=fee(n,o),u=a&&a!=="/"&&a.endsWith("/"),c=(s||a===".")&&i.endsWith("/");return!l.pathname.endsWith("/")&&(u||c)&&(l.pathname+="/"),l}var bd=e=>e.join("/").replace(/\/\/+/g,"/"),mee=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),gee=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,vee=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function yee(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var u8=["POST","PUT","PATCH","DELETE"];new Set(u8);var xee=["GET",...u8];new Set(xee);var Ax=xe.createContext(null);Ax.displayName="DataRouter";var wC=xe.createContext(null);wC.displayName="DataRouterState";xe.createContext(!1);var c8=xe.createContext({isTransitioning:!1});c8.displayName="ViewTransition";var wee=xe.createContext(new Map);wee.displayName="Fetchers";var bee=xe.createContext(null);bee.displayName="Await";var th=xe.createContext(null);th.displayName="Navigation";var bC=xe.createContext(null);bC.displayName="Location";var Nd=xe.createContext({outlet:null,matches:[],isDataRoute:!1});Nd.displayName="Route";var KO=xe.createContext(null);KO.displayName="RouteError";function _ee(e,{relative:t}={}){Ss(y_(),"useHref() may be used only in the context of a <Router> component.");let{basename:i,navigator:r}=xe.useContext(th),{hash:n,pathname:s,search:a}=x_(e,{relative:t}),o=s;return i!=="/"&&(o=s==="/"?i:bd([i,s])),r.createHref({pathname:o,search:a,hash:n})}function y_(){return xe.useContext(bC)!=null}function $g(){return Ss(y_(),"useLocation() may be used only in the context of a <Router> component."),xe.useContext(bC).location}var h8="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function d8(e){xe.useContext(th).static||xe.useLayoutEffect(e)}function See(){let{isDataRoute:e}=xe.useContext(Nd);return e?kee():Mee()}function Mee(){Ss(y_(),"useNavigate() may be used only in the context of a <Router> component.");let e=xe.useContext(Ax),{basename:t,navigator:i}=xe.useContext(th),{matches:r}=xe.useContext(Nd),{pathname:n}=$g(),s=JSON.stringify(o8(r)),a=xe.useRef(!1);return d8(()=>{a.current=!0}),xe.useCallback((l,u={})=>{if(Uu(a.current,h8),!a.current)return;if(typeof l=="number"){i.go(l);return}let c=l8(l,JSON.parse(s),n,u.relative==="path");e==null&&t!=="/"&&(c.pathname=c.pathname==="/"?t:bd([t,c.pathname])),(u.replace?i.replace:i.push)(c,u.state,u)},[t,i,s,n,e])}xe.createContext(null);function x_(e,{relative:t}={}){let{matches:i}=xe.useContext(Nd),{pathname:r}=$g(),n=JSON.stringify(o8(i));return xe.useMemo(()=>l8(e,JSON.parse(n),r,t==="path"),[e,n,r,t])}function Aee(e,t,i,r,n){Ss(y_(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:s}=xe.useContext(th),{matches:a}=xe.useContext(Nd),o=a[a.length-1],l=o?o.params:{},u=o?o.pathname:"/",c=o?o.pathnameBase:"/",h=o&&o.route;{let S=h&&h.path||"";f8(u,!h||S.endsWith("*")||S.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${u}" (under <Route path="${S}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${S}"> to <Route path="${S==="/"?"*":`${S}/*`}">.`)}let d=$g(),p;p=d;let m=p.pathname||"/",v=m;if(c!=="/"){let S=c.replace(/^\//,"").split("/");v="/"+m.replace(/^\//,"").split("/").slice(S.length).join("/")}let g=n8(e,{pathname:v});return Uu(h||g!=null,`No routes matched location "${p.pathname}${p.search}${p.hash}" `),Uu(g==null||g[g.length-1].route.element!==void 0||g[g.length-1].route.Component!==void 0||g[g.length-1].route.lazy!==void 0,`Matched leaf route at location "${p.pathname}${p.search}${p.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),Dee(g&&g.map(S=>Object.assign({},S,{params:Object.assign({},l,S.params),pathname:bd([c,s.encodeLocation?s.encodeLocation(S.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:S.pathname]),pathnameBase:S.pathnameBase==="/"?c:bd([c,s.encodeLocation?s.encodeLocation(S.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:S.pathnameBase])})),a,i,r,n)}function Eee(){let e=zee(),t=yee(e)?`${e.status} ${e.statusText}`:e instanceof Error?e.message:JSON.stringify(e),i=e instanceof Error?e.stack:null,r="rgba(200,200,200, 0.5)",n={padding:"0.5rem",backgroundColor:r},s={padding:"2px 4px",backgroundColor:r},a=null;return console.error("Error handled by React Router default ErrorBoundary:",e),a=xe.createElement(xe.Fragment,null,xe.createElement("p",null," Hey developer "),xe.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",xe.createElement("code",{style:s},"ErrorBoundary")," or"," ",xe.createElement("code",{style:s},"errorElement")," prop on your route.")),xe.createElement(xe.Fragment,null,xe.createElement("h2",null,"Unexpected Application Error!"),xe.createElement("h3",{style:{fontStyle:"italic"}},t),i?xe.createElement("pre",{style:n},i):null,a)}var Cee=xe.createElement(Eee,null),Tee=class extends xe.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){this.props.onError?this.props.onError(e,t):console.error("React Router caught the following error during render",e)}render(){return this.state.error!==void 0?xe.createElement(Nd.Provider,{value:this.props.routeContext},xe.createElement(KO.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function Pee({routeContext:e,match:t,children:i}){let r=xe.useContext(Ax);return r&&r.static&&r.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=t.route.id),xe.createElement(Nd.Provider,{value:e},i)}function Dee(e,t=[],i=null,r=null,n=null){if(e==null){if(!i)return null;if(i.errors)e=i.matches;else if(t.length===0&&!i.initialized&&i.matches.length>0)e=i.matches;else return null}let s=e,a=i?.errors;if(a!=null){let c=s.findIndex(h=>h.route.id&&a?.[h.route.id]!==void 0);Ss(c>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(a).join(",")}`),s=s.slice(0,Math.min(s.length,c+1))}let o=!1,l=-1;if(i)for(let c=0;c<s.length;c++){let h=s[c];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(l=c),h.route.id){let{loaderData:d,errors:p}=i,m=h.route.loader&&!d.hasOwnProperty(h.route.id)&&(!p||p[h.route.id]===void 0);if(h.route.lazy||m){o=!0,l>=0?s=s.slice(0,l+1):s=[s[0]];break}}}let u=i&&r?(c,h)=>{r(c,{location:i.location,params:i.matches?.[0]?.params??{},errorInfo:h})}:void 0;return s.reduceRight((c,h,d)=>{let p,m=!1,v=null,g=null;i&&(p=a&&h.route.id?a[h.route.id]:void 0,v=h.route.errorElement||Cee,o&&(l<0&&d===0?(f8("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),m=!0,g=null):l===d&&(m=!0,g=h.route.hydrateFallbackElement||null)));let w=t.concat(s.slice(0,d+1)),S=()=>{let _;return p?_=v:m?_=g:h.route.Component?_=xe.createElement(h.route.Component,null):h.route.element?_=h.route.element:_=c,xe.createElement(Pee,{match:h,routeContext:{outlet:c,matches:w,isDataRoute:i!=null},children:_})};return i&&(h.route.ErrorBoundary||h.route.errorElement||d===0)?xe.createElement(Tee,{location:i.location,revalidation:i.revalidation,component:v,error:p,children:S(),routeContext:{outlet:null,matches:w,isDataRoute:!0},onError:u}):S()},null)}function ZO(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Ree(e){let t=xe.useContext(Ax);return Ss(t,ZO(e)),t}function Iee(e){let t=xe.useContext(wC);return Ss(t,ZO(e)),t}function Lee(e){let t=xe.useContext(Nd);return Ss(t,ZO(e)),t}function JO(e){let t=Lee(e),i=t.matches[t.matches.length-1];return Ss(i.route.id,`${e} can only be used on routes that contain a unique "id"`),i.route.id}function Oee(){return JO("useRouteId")}function zee(){let e=xe.useContext(KO),t=Iee("useRouteError"),i=JO("useRouteError");return e!==void 0?e:t.errors?.[i]}function kee(){let{router:e}=Ree("useNavigate"),t=JO("useNavigate"),i=xe.useRef(!1);return d8(()=>{i.current=!0}),xe.useCallback(async(n,s={})=>{Uu(i.current,h8),i.current&&(typeof n=="number"?e.navigate(n):await e.navigate(n,{fromRouteId:t,...s}))},[e,t])}var fF={};function f8(e,t,i){!t&&!fF[e]&&(fF[e]=!0,Uu(!1,i))}xe.memo(Bee);function Bee({routes:e,future:t,state:i,unstable_onError:r}){return Aee(e,void 0,i,r,t)}function Nee({basename:e="/",children:t=null,location:i,navigationType:r="POP",navigator:n,static:s=!1}){Ss(!y_(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=e.replace(/^\/*/,"/"),o=xe.useMemo(()=>({basename:a,navigator:n,static:s,future:{}}),[a,n,s]);typeof i=="string"&&(i=v_(i));let{pathname:l="/",search:u="",hash:c="",state:h=null,key:d="default"}=i,p=xe.useMemo(()=>{let m=Ad(l,a);return m==null?null:{location:{pathname:m,search:u,hash:c,state:h,key:d},navigationType:r}},[a,l,u,c,h,d,r]);return Uu(p!=null,`<Router basename="${a}"> is not able to match the URL "${l}${u}${c}" because it does not start with the basename, so the <Router> won't render anything.`),p==null?null:xe.createElement(th.Provider,{value:o},xe.createElement(bC.Provider,{children:t,value:p}))}var wE="get",bE="application/x-www-form-urlencoded";function _C(e){return e!=null&&typeof e.tagName=="string"}function Fee(e){return _C(e)&&e.tagName.toLowerCase()==="button"}function Uee(e){return _C(e)&&e.tagName.toLowerCase()==="form"}function Vee(e){return _C(e)&&e.tagName.toLowerCase()==="input"}function jee(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function Hee(e,t){return e.button===0&&(!t||t==="_self")&&!jee(e)}var tM=null;function Wee(){if(tM===null)try{new FormData(document.createElement("form"),0),tM=!1}catch{tM=!0}return tM}var Gee=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function aP(e){return e!=null&&!Gee.has(e)?(Uu(!1,`"${e}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${bE}"`),null):e}function qee(e,t){let i,r,n,s,a;if(Uee(e)){let o=e.getAttribute("action");r=o?Ad(o,t):null,i=e.getAttribute("method")||wE,n=aP(e.getAttribute("enctype"))||bE,s=new FormData(e)}else if(Fee(e)||Vee(e)&&(e.type==="submit"||e.type==="image")){let o=e.form;if(o==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=e.getAttribute("formaction")||o.getAttribute("action");if(r=l?Ad(l,t):null,i=e.getAttribute("formmethod")||o.getAttribute("method")||wE,n=aP(e.getAttribute("formenctype"))||aP(o.getAttribute("enctype"))||bE,s=new FormData(o,e),!Wee()){let{name:u,type:c,value:h}=e;if(c==="image"){let d=u?`${u}.`:"";s.append(`${d}x`,"0"),s.append(`${d}y`,"0")}else u&&s.append(u,h)}}else{if(_C(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');i=wE,r=null,n=bE,a=e}return s&&n==="text/plain"&&(a=s,s=void 0),{action:r,method:i.toLowerCase(),encType:n,formData:s,body:a}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function $O(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function Xee(e,t,i){let r=typeof e=="string"?new URL(e,typeof window>"u"?"server://singlefetch/":window.location.origin):e;return r.pathname==="/"?r.pathname=`_root.${i}`:t&&Ad(r.pathname,t)==="/"?r.pathname=`${t.replace(/\/$/,"")}/_root.${i}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${i}`,r}async function Yee(e,t){if(e.id in t)return t[e.id];try{let i=await import(e.module);return t[e.id]=i,i}catch(i){return console.error(`Error loading route module \`${e.module}\`, reloading page...`),console.error(i),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Qee(e){return e==null?!1:e.href==null?e.rel==="preload"&&typeof e.imageSrcSet=="string"&&typeof e.imageSizes=="string":typeof e.rel=="string"&&typeof e.href=="string"}async function Kee(e,t,i){let r=await Promise.all(e.map(async n=>{let s=t.routes[n.route.id];if(s){let a=await Yee(s,i);return a.links?a.links():[]}return[]}));return ete(r.flat(1).filter(Qee).filter(n=>n.rel==="stylesheet"||n.rel==="preload").map(n=>n.rel==="stylesheet"?{...n,rel:"prefetch",as:"style"}:{...n,rel:"prefetch"}))}function pF(e,t,i,r,n,s){let a=(l,u)=>i[u]?l.route.id!==i[u].route.id:!0,o=(l,u)=>i[u].pathname!==l.pathname||i[u].route.path?.endsWith("*")&&i[u].params["*"]!==l.params["*"];return s==="assets"?t.filter((l,u)=>a(l,u)||o(l,u)):s==="data"?t.filter((l,u)=>{let c=r.routes[l.route.id];if(!c||!c.hasLoader)return!1;if(a(l,u)||o(l,u))return!0;if(l.route.shouldRevalidate){let h=l.route.shouldRevalidate({currentUrl:new URL(n.pathname+n.search+n.hash,window.origin),currentParams:i[0]?.params||{},nextUrl:new URL(e,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof h=="boolean")return h}return!0}):[]}function Zee(e,t,{includeHydrateFallback:i}={}){return Jee(e.map(r=>{let n=t.routes[r.route.id];if(!n)return[];let s=[n.module];return n.clientActionModule&&(s=s.concat(n.clientActionModule)),n.clientLoaderModule&&(s=s.concat(n.clientLoaderModule)),i&&n.hydrateFallbackModule&&(s=s.concat(n.hydrateFallbackModule)),n.imports&&(s=s.concat(n.imports)),s}).flat(1))}function Jee(e){return[...new Set(e)]}function $ee(e){let t={},i=Object.keys(e).sort();for(let r of i)t[r]=e[r];return t}function ete(e,t){let i=new Set;return new Set(t),e.reduce((r,n)=>{let s=JSON.stringify($ee(n));return i.has(s)||(i.add(s),r.push({key:s,link:n})),r},[])}function p8(){let e=xe.useContext(Ax);return $O(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function tte(){let e=xe.useContext(wC);return $O(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var ez=xe.createContext(void 0);ez.displayName="FrameworkContext";function m8(){let e=xe.useContext(ez);return $O(e,"You must render this element inside a <HydratedRouter> element"),e}function ite(e,t){let i=xe.useContext(ez),[r,n]=xe.useState(!1),[s,a]=xe.useState(!1),{onFocus:o,onBlur:l,onMouseEnter:u,onMouseLeave:c,onTouchStart:h}=t,d=xe.useRef(null);xe.useEffect(()=>{if(e==="render"&&a(!0),e==="viewport"){let v=w=>{w.forEach(S=>{a(S.isIntersecting)})},g=new IntersectionObserver(v,{threshold:.5});return d.current&&g.observe(d.current),()=>{g.disconnect()}}},[e]),xe.useEffect(()=>{if(r){let v=setTimeout(()=>{a(!0)},100);return()=>{clearTimeout(v)}}},[r]);let p=()=>{n(!0)},m=()=>{n(!1),a(!1)};return i?e!=="intent"?[s,d,{}]:[s,d,{onFocus:H1(o,p),onBlur:H1(l,m),onMouseEnter:H1(u,p),onMouseLeave:H1(c,m),onTouchStart:H1(h,p)}]:[!1,d,{}]}function H1(e,t){return i=>{e&&e(i),i.defaultPrevented||t(i)}}function rte({page:e,...t}){let{router:i}=p8(),r=xe.useMemo(()=>n8(i.routes,e,i.basename),[i.routes,e,i.basename]);return r?xe.createElement(ste,{page:e,matches:r,...t}):null}function nte(e){let{manifest:t,routeModules:i}=m8(),[r,n]=xe.useState([]);return xe.useEffect(()=>{let s=!1;return Kee(e,t,i).then(a=>{s||n(a)}),()=>{s=!0}},[e,t,i]),r}function ste({page:e,matches:t,...i}){let r=$g(),{manifest:n,routeModules:s}=m8(),{basename:a}=p8(),{loaderData:o,matches:l}=tte(),u=xe.useMemo(()=>pF(e,t,l,n,r,"data"),[e,t,l,n,r]),c=xe.useMemo(()=>pF(e,t,l,n,r,"assets"),[e,t,l,n,r]),h=xe.useMemo(()=>{if(e===r.pathname+r.search+r.hash)return[];let m=new Set,v=!1;if(t.forEach(w=>{let S=n.routes[w.route.id];!S||!S.hasLoader||(!u.some(_=>_.route.id===w.route.id)&&w.route.id in o&&s[w.route.id]?.shouldRevalidate||S.hasClientLoader?v=!0:m.add(w.route.id))}),m.size===0)return[];let g=Xee(e,a,"data");return v&&m.size>0&&g.searchParams.set("_routes",t.filter(w=>m.has(w.route.id)).map(w=>w.route.id).join(",")),[g.pathname+g.search]},[a,o,r,n,u,t,e,s]),d=xe.useMemo(()=>Zee(c,n),[c,n]),p=nte(c);return xe.createElement(xe.Fragment,null,h.map(m=>xe.createElement("link",{key:m,rel:"prefetch",as:"fetch",href:m,...i})),d.map(m=>xe.createElement("link",{key:m,rel:"modulepreload",href:m,...i})),p.map(({key:m,link:v})=>xe.createElement("link",{key:m,nonce:i.nonce,...v})))}function ate(...e){return t=>{e.forEach(i=>{typeof i=="function"?i(t):i!=null&&(i.current=t)})}}var g8=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{g8&&(window.__reactRouterVersion="7.9.6")}catch{}function ote({basename:e,children:t,window:i}){let r=xe.useRef();r.current==null&&(r.current=Y$({window:i,v5Compat:!0}));let n=r.current,[s,a]=xe.useState({action:n.action,location:n.location}),o=xe.useCallback(l=>{xe.startTransition(()=>a(l))},[a]);return xe.useLayoutEffect(()=>n.listen(o),[n,o]),xe.createElement(Nee,{basename:e,children:t,location:s.location,navigationType:s.action,navigator:n})}var v8=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,y8=xe.forwardRef(function({onClick:t,discover:i="render",prefetch:r="none",relative:n,reloadDocument:s,replace:a,state:o,target:l,to:u,preventScrollReset:c,viewTransition:h,...d},p){let{basename:m}=xe.useContext(th),v=typeof u=="string"&&v8.test(u),g,w=!1;if(typeof u=="string"&&v&&(g=u,g8))try{let D=new URL(window.location.href),L=u.startsWith("//")?new URL(D.protocol+u):new URL(u),z=Ad(L.pathname,m);L.origin===D.origin&&z!=null?u=z+L.search+L.hash:w=!0}catch{Uu(!1,`<Link to="${u}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let S=_ee(u,{relative:n}),[_,A,C]=ite(r,d),E=hte(u,{replace:a,state:o,target:l,preventScrollReset:c,relative:n,viewTransition:h});function I(D){t&&t(D),D.defaultPrevented||E(D)}let T=xe.createElement("a",{...d,...C,href:g||S,onClick:w||s?t:I,ref:ate(p,A),target:l,"data-discover":!v&&i==="render"?"true":void 0});return _&&!v?xe.createElement(xe.Fragment,null,T,xe.createElement(rte,{page:S})):T});y8.displayName="Link";var lte=xe.forwardRef(function({"aria-current":t="page",caseSensitive:i=!1,className:r="",end:n=!1,style:s,to:a,viewTransition:o,children:l,...u},c){let h=x_(a,{relative:u.relative}),d=$g(),p=xe.useContext(wC),{navigator:m,basename:v}=xe.useContext(th),g=p!=null&&gte(h)&&o===!0,w=m.encodeLocation?m.encodeLocation(h).pathname:h.pathname,S=d.pathname,_=p&&p.navigation&&p.navigation.location?p.navigation.location.pathname:null;i||(S=S.toLowerCase(),_=_?_.toLowerCase():null,w=w.toLowerCase()),_&&v&&(_=Ad(_,v)||_);const A=w!=="/"&&w.endsWith("/")?w.length-1:w.length;let C=S===w||!n&&S.startsWith(w)&&S.charAt(A)==="/",E=_!=null&&(_===w||!n&&_.startsWith(w)&&_.charAt(w.length)==="/"),I={isActive:C,isPending:E,isTransitioning:g},T=C?t:void 0,D;typeof r=="function"?D=r(I):D=[r,C?"active":null,E?"pending":null,g?"transitioning":null].filter(Boolean).join(" ");let L=typeof s=="function"?s(I):s;return xe.createElement(y8,{...u,"aria-current":T,className:D,ref:c,style:L,to:a,viewTransition:o},typeof l=="function"?l(I):l)});lte.displayName="NavLink";var ute=xe.forwardRef(({discover:e="render",fetcherKey:t,navigate:i,reloadDocument:r,replace:n,state:s,method:a=wE,action:o,onSubmit:l,relative:u,preventScrollReset:c,viewTransition:h,...d},p)=>{let m=pte(),v=mte(o,{relative:u}),g=a.toLowerCase()==="get"?"get":"post",w=typeof o=="string"&&v8.test(o),S=_=>{if(l&&l(_),_.defaultPrevented)return;_.preventDefault();let A=_.nativeEvent.submitter,C=A?.getAttribute("formmethod")||a;m(A||_.currentTarget,{fetcherKey:t,method:C,navigate:i,replace:n,state:s,relative:u,preventScrollReset:c,viewTransition:h})};return xe.createElement("form",{ref:p,method:g,action:v,onSubmit:r?l:S,...d,"data-discover":!w&&e==="render"?"true":void 0})});ute.displayName="Form";function cte(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function x8(e){let t=xe.useContext(Ax);return Ss(t,cte(e)),t}function hte(e,{target:t,replace:i,state:r,preventScrollReset:n,relative:s,viewTransition:a}={}){let o=See(),l=$g(),u=x_(e,{relative:s});return xe.useCallback(c=>{if(Hee(c,t)){c.preventDefault();let h=i!==void 0?i:Sb(l)===Sb(u);o(e,{replace:h,state:r,preventScrollReset:n,relative:s,viewTransition:a})}},[l,o,u,i,r,t,e,n,s,a])}var dte=0,fte=()=>`__${String(++dte)}__`;function pte(){let{router:e}=x8("useSubmit"),{basename:t}=xe.useContext(th),i=Oee();return xe.useCallback(async(r,n={})=>{let{action:s,method:a,encType:o,formData:l,body:u}=qee(r,t);if(n.navigate===!1){let c=n.fetcherKey||fte();await e.fetch(c,i,n.action||s,{preventScrollReset:n.preventScrollReset,formData:l,body:u,formMethod:n.method||a,formEncType:n.encType||o,flushSync:n.flushSync})}else await e.navigate(n.action||s,{preventScrollReset:n.preventScrollReset,formData:l,body:u,formMethod:n.method||a,formEncType:n.encType||o,replace:n.replace,state:n.state,fromRouteId:i,flushSync:n.flushSync,viewTransition:n.viewTransition})},[e,t,i])}function mte(e,{relative:t}={}){let{basename:i}=xe.useContext(th),r=xe.useContext(Nd);Ss(r,"useFormAction must be used inside a RouteContext");let[n]=r.matches.slice(-1),s={...x_(e||".",{relative:t})},a=$g();if(e==null){s.search=a.search;let o=new URLSearchParams(s.search),l=o.getAll("index");if(l.some(c=>c==="")){o.delete("index"),l.filter(h=>h).forEach(h=>o.append("index",h));let c=o.toString();s.search=c?`?${c}`:""}}return(!e||e===".")&&n.route.index&&(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index"),i!=="/"&&(s.pathname=s.pathname==="/"?i:bd([i,s.pathname])),Sb(s)}function gte(e,{relative:t}={}){let i=xe.useContext(c8);Ss(i!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=x8("useViewTransitionState"),n=x_(e,{relative:t});if(!i.isTransitioning)return!1;let s=Ad(i.currentLocation.pathname,r)||i.currentLocation.pathname,a=Ad(i.nextLocation.pathname,r)||i.nextLocation.pathname;return JE(n.pathname,a)!=null||JE(n.pathname,s)!=null}const SC="150",qm={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Xm={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},w8=0,IR=1,b8=2,vte=3,_8=0,MC=1,Zw=2,ug=3,Ed=0,jo=1,Nc=2,yte=2,_d=0,Mg=1,LR=2,OR=3,zR=4,S8=5,tg=100,M8=101,A8=102,kR=103,BR=104,E8=200,C8=201,T8=202,P8=203,tz=204,iz=205,D8=206,R8=207,I8=208,L8=209,O8=210,z8=0,k8=1,B8=2,$E=3,N8=4,F8=5,U8=6,V8=7,w_=0,j8=1,H8=2,Nu=0,W8=1,G8=2,q8=3,rz=4,X8=5,AC=300,Cp=301,Tp=302,Mb=303,Ab=304,Ex=306,Eb=1e3,Oa=1001,Cb=1002,Ln=1003,e2=1004,xte=1004,Jw=1005,wte=1005,On=1006,nz=1007,bte=1007,Pp=1008,_te=1008,Cd=1009,Y8=1010,Q8=1011,sz=1012,K8=1013,op=1014,fd=1015,ex=1016,Z8=1017,J8=1018,Ag=1020,$8=1021,ko=1023,e9=1024,t9=1025,wp=1026,Ng=1027,i9=1028,r9=1029,n9=1030,s9=1031,a9=1033,_E=33776,SE=33777,ME=33778,AE=33779,NR=35840,FR=35841,UR=35842,VR=35843,o9=36196,jR=37492,HR=37496,WR=37808,GR=37809,qR=37810,XR=37811,YR=37812,QR=37813,KR=37814,ZR=37815,JR=37816,$R=37817,eI=37818,tI=37819,iI=37820,rI=37821,EE=36492,l9=36283,nI=36284,sI=36285,aI=36286,u9=2200,c9=2201,h9=2202,Tb=2300,Pb=2301,CE=2302,cg=2400,hg=2401,Db=2402,EC=2500,az=2501,Ste=0,Mte=1,Ate=2,Dp=3e3,Ur=3001,d9=3200,f9=3201,Fp=0,p9=1,Ete="",Iu="srgb",tx="srgb-linear",oz="display-p3",Cte=0,TE=7680,Tte=7681,Pte=7682,Dte=7683,Rte=34055,Ite=34056,Lte=5386,Ote=512,zte=513,kte=514,Bte=515,Nte=516,Fte=517,Ute=518,m9=519,Rb=35044,Vte=35048,jte=35040,Hte=35045,Wte=35049,Gte=35041,qte=35046,Xte=35050,Yte=35042,Qte="100",oI="300 es",t2=1035;let Fd=class{addEventListener(t,i){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[t]===void 0&&(r[t]=[]),r[t].indexOf(i)===-1&&r[t].push(i)}hasEventListener(t,i){if(this._listeners===void 0)return!1;const r=this._listeners;return r[t]!==void 0&&r[t].indexOf(i)!==-1}removeEventListener(t,i){if(this._listeners===void 0)return;const n=this._listeners[t];if(n!==void 0){const s=n.indexOf(i);s!==-1&&n.splice(s,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const r=this._listeners[t.type];if(r!==void 0){t.target=this;const n=r.slice(0);for(let s=0,a=n.length;s<a;s++)n[s].call(this,t);t.target=null}}};const Pa=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let mF=1234567;const Eg=Math.PI/180,Ib=180/Math.PI;function hl(){const e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Pa[e&255]+Pa[e>>8&255]+Pa[e>>16&255]+Pa[e>>24&255]+"-"+Pa[t&255]+Pa[t>>8&255]+"-"+Pa[t>>16&15|64]+Pa[t>>24&255]+"-"+Pa[i&63|128]+Pa[i>>8&255]+"-"+Pa[i>>16&255]+Pa[i>>24&255]+Pa[r&255]+Pa[r>>8&255]+Pa[r>>16&255]+Pa[r>>24&255]).toLowerCase()}function zn(e,t,i){return Math.max(t,Math.min(i,e))}function lz(e,t){return(e%t+t)%t}function Kte(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)}function Zte(e,t,i){return e!==t?(i-e)/(t-e):0}function $w(e,t,i){return(1-i)*e+i*t}function Jte(e,t,i,r){return $w(e,t,1-Math.exp(-i*r))}function $te(e,t=1){return t-Math.abs(lz(e,t*2)-t)}function eie(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*(3-2*e))}function tie(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*e*(e*(e*6-15)+10))}function iie(e,t){return e+Math.floor(Math.random()*(t-e+1))}function rie(e,t){return e+Math.random()*(t-e)}function nie(e){return e*(.5-Math.random())}function sie(e){e!==void 0&&(mF=e);let t=mF+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function aie(e){return e*Eg}function oie(e){return e*Ib}function lI(e){return(e&e-1)===0&&e!==0}function g9(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function v9(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function lie(e,t,i,r,n){const s=Math.cos,a=Math.sin,o=s(i/2),l=a(i/2),u=s((t+r)/2),c=a((t+r)/2),h=s((t-r)/2),d=a((t-r)/2),p=s((r-t)/2),m=a((r-t)/2);switch(n){case"XYX":e.set(o*c,l*h,l*d,o*u);break;case"YZY":e.set(l*d,o*c,l*h,o*u);break;case"ZXZ":e.set(l*h,l*d,o*c,o*u);break;case"XZX":e.set(o*c,l*m,l*p,o*u);break;case"YXY":e.set(l*p,o*c,l*m,o*u);break;case"ZYZ":e.set(l*m,l*p,o*c,o*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function pd(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Lr(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(e*65535);case Uint8Array:return Math.round(e*255);case Int16Array:return Math.round(e*32767);case Int8Array:return Math.round(e*127);default:throw new Error("Invalid component type.")}}const y9={DEG2RAD:Eg,RAD2DEG:Ib,generateUUID:hl,clamp:zn,euclideanModulo:lz,mapLinear:Kte,inverseLerp:Zte,lerp:$w,damp:Jte,pingpong:$te,smoothstep:eie,smootherstep:tie,randInt:iie,randFloat:rie,randFloatSpread:nie,seededRandom:sie,degToRad:aie,radToDeg:oie,isPowerOfTwo:lI,ceilPowerOfTwo:g9,floorPowerOfTwo:v9,setQuaternionFromProperEuler:lie,normalize:Lr,denormalize:pd};class ft{constructor(t=0,i=0){ft.prototype.isVector2=!0,this.x=t,this.y=i}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,i){return this.x=t,this.y=i,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const i=this.x,r=this.y,n=t.elements;return this.x=n[0]*i+n[3]*r+n[6],this.y=n[1]*i+n[4]*r+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this}clampLength(t,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const i=this.x-t.x,r=this.y-t.y;return i*i+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this}lerpVectors(t,i,r){return this.x=t.x+(i.x-t.x)*r,this.y=t.y+(i.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this}rotateAround(t,i){const r=Math.cos(i),n=Math.sin(i),s=this.x-t.x,a=this.y-t.y;return this.x=s*r-a*n+t.x,this.y=s*n+a*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class ma{constructor(){ma.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(t,i,r,n,s,a,o,l,u){const c=this.elements;return c[0]=t,c[1]=n,c[2]=o,c[3]=i,c[4]=s,c[5]=l,c[6]=r,c[7]=a,c[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const i=this.elements,r=t.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],this}extractBasis(t,i,r){return t.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const i=t.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,i){const r=t.elements,n=i.elements,s=this.elements,a=r[0],o=r[3],l=r[6],u=r[1],c=r[4],h=r[7],d=r[2],p=r[5],m=r[8],v=n[0],g=n[3],w=n[6],S=n[1],_=n[4],A=n[7],C=n[2],E=n[5],I=n[8];return s[0]=a*v+o*S+l*C,s[3]=a*g+o*_+l*E,s[6]=a*w+o*A+l*I,s[1]=u*v+c*S+h*C,s[4]=u*g+c*_+h*E,s[7]=u*w+c*A+h*I,s[2]=d*v+p*S+m*C,s[5]=d*g+p*_+m*E,s[8]=d*w+p*A+m*I,this}multiplyScalar(t){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=t,i[4]*=t,i[7]*=t,i[2]*=t,i[5]*=t,i[8]*=t,this}determinant(){const t=this.elements,i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],u=t[7],c=t[8];return i*a*c-i*o*u-r*s*c+r*o*l+n*s*u-n*a*l}invert(){const t=this.elements,i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],u=t[7],c=t[8],h=c*a-o*u,d=o*l-c*s,p=u*s-a*l,m=i*h+r*d+n*p;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const v=1/m;return t[0]=h*v,t[1]=(n*u-c*r)*v,t[2]=(o*r-n*a)*v,t[3]=d*v,t[4]=(c*i-n*l)*v,t[5]=(n*s-o*i)*v,t[6]=p*v,t[7]=(r*l-u*i)*v,t[8]=(a*i-r*s)*v,this}transpose(){let t;const i=this.elements;return t=i[1],i[1]=i[3],i[3]=t,t=i[2],i[2]=i[6],i[6]=t,t=i[5],i[5]=i[7],i[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const i=this.elements;return t[0]=i[0],t[1]=i[3],t[2]=i[6],t[3]=i[1],t[4]=i[4],t[5]=i[7],t[6]=i[2],t[7]=i[5],t[8]=i[8],this}setUvTransform(t,i,r,n,s,a,o){const l=Math.cos(s),u=Math.sin(s);return this.set(r*l,r*u,-r*(l*a+u*o)+a+t,-n*u,n*l,-n*(-u*a+l*o)+o+i,0,0,1),this}scale(t,i){return this.premultiply(oP.makeScale(t,i)),this}rotate(t){return this.premultiply(oP.makeRotation(-t)),this}translate(t,i){return this.premultiply(oP.makeTranslation(t,i)),this}makeTranslation(t,i){return this.set(1,0,t,0,1,i,0,0,1),this}makeRotation(t){const i=Math.cos(t),r=Math.sin(t);return this.set(i,-r,0,r,i,0,0,0,1),this}makeScale(t,i){return this.set(t,0,0,0,i,0,0,0,1),this}equals(t){const i=this.elements,r=t.elements;for(let n=0;n<9;n++)if(i[n]!==r[n])return!1;return!0}fromArray(t,i=0){for(let r=0;r<9;r++)this.elements[r]=t[r+i];return this}toArray(t=[],i=0){const r=this.elements;return t[i]=r[0],t[i+1]=r[1],t[i+2]=r[2],t[i+3]=r[3],t[i+4]=r[4],t[i+5]=r[5],t[i+6]=r[6],t[i+7]=r[7],t[i+8]=r[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const oP=new ma;function x9(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}const uie={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function by(e,t){return new uie[e](t)}function Lb(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}class Fa{constructor(t=0,i=0,r=0,n=1){this.isQuaternion=!0,this._x=t,this._y=i,this._z=r,this._w=n}static slerpFlat(t,i,r,n,s,a,o){let l=r[n+0],u=r[n+1],c=r[n+2],h=r[n+3];const d=s[a+0],p=s[a+1],m=s[a+2],v=s[a+3];if(o===0){t[i+0]=l,t[i+1]=u,t[i+2]=c,t[i+3]=h;return}if(o===1){t[i+0]=d,t[i+1]=p,t[i+2]=m,t[i+3]=v;return}if(h!==v||l!==d||u!==p||c!==m){let g=1-o;const w=l*d+u*p+c*m+h*v,S=w>=0?1:-1,_=1-w*w;if(_>Number.EPSILON){const C=Math.sqrt(_),E=Math.atan2(C,w*S);g=Math.sin(g*E)/C,o=Math.sin(o*E)/C}const A=o*S;if(l=l*g+d*A,u=u*g+p*A,c=c*g+m*A,h=h*g+v*A,g===1-o){const C=1/Math.sqrt(l*l+u*u+c*c+h*h);l*=C,u*=C,c*=C,h*=C}}t[i]=l,t[i+1]=u,t[i+2]=c,t[i+3]=h}static multiplyQuaternionsFlat(t,i,r,n,s,a){const o=r[n],l=r[n+1],u=r[n+2],c=r[n+3],h=s[a],d=s[a+1],p=s[a+2],m=s[a+3];return t[i]=o*m+c*h+l*p-u*d,t[i+1]=l*m+c*d+u*h-o*p,t[i+2]=u*m+c*p+o*d-l*h,t[i+3]=c*m-o*h-l*d-u*p,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,i,r,n){return this._x=t,this._y=i,this._z=r,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,i){const r=t._x,n=t._y,s=t._z,a=t._order,o=Math.cos,l=Math.sin,u=o(r/2),c=o(n/2),h=o(s/2),d=l(r/2),p=l(n/2),m=l(s/2);switch(a){case"XYZ":this._x=d*c*h+u*p*m,this._y=u*p*h-d*c*m,this._z=u*c*m+d*p*h,this._w=u*c*h-d*p*m;break;case"YXZ":this._x=d*c*h+u*p*m,this._y=u*p*h-d*c*m,this._z=u*c*m-d*p*h,this._w=u*c*h+d*p*m;break;case"ZXY":this._x=d*c*h-u*p*m,this._y=u*p*h+d*c*m,this._z=u*c*m+d*p*h,this._w=u*c*h-d*p*m;break;case"ZYX":this._x=d*c*h-u*p*m,this._y=u*p*h+d*c*m,this._z=u*c*m-d*p*h,this._w=u*c*h+d*p*m;break;case"YZX":this._x=d*c*h+u*p*m,this._y=u*p*h+d*c*m,this._z=u*c*m-d*p*h,this._w=u*c*h-d*p*m;break;case"XZY":this._x=d*c*h-u*p*m,this._y=u*p*h-d*c*m,this._z=u*c*m+d*p*h,this._w=u*c*h+d*p*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return i!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,i){const r=i/2,n=Math.sin(r);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(t){const i=t.elements,r=i[0],n=i[4],s=i[8],a=i[1],o=i[5],l=i[9],u=i[2],c=i[6],h=i[10],d=r+o+h;if(d>0){const p=.5/Math.sqrt(d+1);this._w=.25/p,this._x=(c-l)*p,this._y=(s-u)*p,this._z=(a-n)*p}else if(r>o&&r>h){const p=2*Math.sqrt(1+r-o-h);this._w=(c-l)/p,this._x=.25*p,this._y=(n+a)/p,this._z=(s+u)/p}else if(o>h){const p=2*Math.sqrt(1+o-r-h);this._w=(s-u)/p,this._x=(n+a)/p,this._y=.25*p,this._z=(l+c)/p}else{const p=2*Math.sqrt(1+h-r-o);this._w=(a-n)/p,this._x=(s+u)/p,this._y=(l+c)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(t,i){let r=t.dot(i)+1;return r<Number.EPSILON?(r=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=r):(this._x=0,this._y=-t.z,this._z=t.y,this._w=r)):(this._x=t.y*i.z-t.z*i.y,this._y=t.z*i.x-t.x*i.z,this._z=t.x*i.y-t.y*i.x,this._w=r),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(zn(this.dot(t),-1,1)))}rotateTowards(t,i){const r=this.angleTo(t);if(r===0)return this;const n=Math.min(1,i/r);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,i){const r=t._x,n=t._y,s=t._z,a=t._w,o=i._x,l=i._y,u=i._z,c=i._w;return this._x=r*c+a*o+n*u-s*l,this._y=n*c+a*l+s*o-r*u,this._z=s*c+a*u+r*l-n*o,this._w=a*c-r*o-n*l-s*u,this._onChangeCallback(),this}slerp(t,i){if(i===0)return this;if(i===1)return this.copy(t);const r=this._x,n=this._y,s=this._z,a=this._w;let o=a*t._w+r*t._x+n*t._y+s*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=a,this._x=r,this._y=n,this._z=s,this;const l=1-o*o;if(l<=Number.EPSILON){const p=1-i;return this._w=p*a+i*this._w,this._x=p*r+i*this._x,this._y=p*n+i*this._y,this._z=p*s+i*this._z,this.normalize(),this._onChangeCallback(),this}const u=Math.sqrt(l),c=Math.atan2(u,o),h=Math.sin((1-i)*c)/u,d=Math.sin(i*c)/u;return this._w=a*h+this._w*d,this._x=r*h+this._x*d,this._y=n*h+this._y*d,this._z=s*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,i,r){return this.copy(t).slerp(i,r)}random(){const t=Math.random(),i=Math.sqrt(1-t),r=Math.sqrt(t),n=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(i*Math.cos(n),r*Math.sin(s),r*Math.cos(s),i*Math.sin(n))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,i=0){return this._x=t[i],this._y=t[i+1],this._z=t[i+2],this._w=t[i+3],this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._w,t}fromBufferAttribute(t,i){return this._x=t.getX(i),this._y=t.getY(i),this._z=t.getZ(i),this._w=t.getW(i),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class pe{constructor(t=0,i=0,r=0){pe.prototype.isVector3=!0,this.x=t,this.y=i,this.z=r}set(t,i,r){return r===void 0&&(r=this.z),this.x=t,this.y=i,this.z=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this}applyEuler(t){return this.applyQuaternion(gF.setFromEuler(t))}applyAxisAngle(t,i){return this.applyQuaternion(gF.setFromAxisAngle(t,i))}applyMatrix3(t){const i=this.x,r=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[3]*r+s[6]*n,this.y=s[1]*i+s[4]*r+s[7]*n,this.z=s[2]*i+s[5]*r+s[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const i=this.x,r=this.y,n=this.z,s=t.elements,a=1/(s[3]*i+s[7]*r+s[11]*n+s[15]);return this.x=(s[0]*i+s[4]*r+s[8]*n+s[12])*a,this.y=(s[1]*i+s[5]*r+s[9]*n+s[13])*a,this.z=(s[2]*i+s[6]*r+s[10]*n+s[14])*a,this}applyQuaternion(t){const i=this.x,r=this.y,n=this.z,s=t.x,a=t.y,o=t.z,l=t.w,u=l*i+a*n-o*r,c=l*r+o*i-s*n,h=l*n+s*r-a*i,d=-s*i-a*r-o*n;return this.x=u*l+d*-s+c*-o-h*-a,this.y=c*l+d*-a+h*-s-u*-o,this.z=h*l+d*-o+u*-a-c*-s,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const i=this.x,r=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[4]*r+s[8]*n,this.y=s[1]*i+s[5]*r+s[9]*n,this.z=s[2]*i+s[6]*r+s[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this}clampLength(t,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this}lerpVectors(t,i,r){return this.x=t.x+(i.x-t.x)*r,this.y=t.y+(i.y-t.y)*r,this.z=t.z+(i.z-t.z)*r,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,i){const r=t.x,n=t.y,s=t.z,a=i.x,o=i.y,l=i.z;return this.x=n*l-s*o,this.y=s*a-r*l,this.z=r*o-n*a,this}projectOnVector(t){const i=t.lengthSq();if(i===0)return this.set(0,0,0);const r=t.dot(this)/i;return this.copy(t).multiplyScalar(r)}projectOnPlane(t){return lP.copy(this).projectOnVector(t),this.sub(lP)}reflect(t){return this.sub(lP.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const i=Math.sqrt(this.lengthSq()*t.lengthSq());if(i===0)return Math.PI/2;const r=this.dot(t)/i;return Math.acos(zn(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const i=this.x-t.x,r=this.y-t.y,n=this.z-t.z;return i*i+r*r+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,i,r){const n=Math.sin(i)*t;return this.x=n*Math.sin(r),this.y=Math.cos(i)*t,this.z=n*Math.cos(r),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,i,r){return this.x=t*Math.sin(i),this.y=r,this.z=t*Math.cos(i),this}setFromMatrixPosition(t){const i=t.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(t){const i=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=r,this.z=n,this}setFromMatrixColumn(t,i){return this.fromArray(t.elements,i*4)}setFromMatrix3Column(t,i){return this.fromArray(t.elements,i*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=(Math.random()-.5)*2,i=Math.random()*Math.PI*2,r=Math.sqrt(1-t**2);return this.x=r*Math.cos(i),this.y=r*Math.sin(i),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const lP=new pe,gF=new Fa;function Fy(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function uP(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}const cie=new ma().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),hie=new ma().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]),lp=new pe;function die(e){return e.convertSRGBToLinear(),lp.set(e.r,e.g,e.b).applyMatrix3(hie),e.setRGB(lp.x,lp.y,lp.z)}function fie(e){return lp.set(e.r,e.g,e.b).applyMatrix3(cie),e.setRGB(lp.x,lp.y,lp.z).convertLinearToSRGB()}const pie={[tx]:e=>e,[Iu]:e=>e.convertSRGBToLinear(),[oz]:die},mie={[tx]:e=>e,[Iu]:e=>e.convertLinearToSRGB(),[oz]:fie},Ia={enabled:!1,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(e){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!e},get workingColorSpace(){return tx},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,i){if(this.enabled===!1||t===i||!t||!i)return e;const r=pie[t],n=mie[i];if(r===void 0||n===void 0)throw new Error(`Unsupported color space conversion, "${t}" to "${i}".`);return n(r(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}};let p0;class uz{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let i;if(t instanceof HTMLCanvasElement)i=t;else{p0===void 0&&(p0=Lb("canvas")),p0.width=t.width,p0.height=t.height;const r=p0.getContext("2d");t instanceof ImageData?r.putImageData(t,0,0):r.drawImage(t,0,0,t.width,t.height),i=p0}return i.width>2048||i.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),i.toDataURL("image/jpeg",.6)):i.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const i=Lb("canvas");i.width=t.width,i.height=t.height;const r=i.getContext("2d");r.drawImage(t,0,0,t.width,t.height);const n=r.getImageData(0,0,t.width,t.height),s=n.data;for(let a=0;a<s.length;a++)s[a]=Fy(s[a]/255)*255;return r.putImageData(n,0,0),i}else if(t.data){const i=t.data.slice(0);for(let r=0;r<i.length;r++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[r]=Math.floor(Fy(i[r]/255)*255):i[r]=Fy(i[r]);return{data:i,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}class dg{constructor(t=null){this.isSource=!0,this.uuid=hl(),this.data=t,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const i=t===void 0||typeof t=="string";if(!i&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const r={uuid:this.uuid,url:""},n=this.data;if(n!==null){let s;if(Array.isArray(n)){s=[];for(let a=0,o=n.length;a<o;a++)n[a].isDataTexture?s.push(cP(n[a].image)):s.push(cP(n[a]))}else s=cP(n);r.url=s}return i||(t.images[this.uuid]=r),r}}function cP(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?uz.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let gie=0;class _n extends Fd{constructor(t=_n.DEFAULT_IMAGE,i=_n.DEFAULT_MAPPING,r=Oa,n=Oa,s=On,a=Pp,o=ko,l=Cd,u=_n.DEFAULT_ANISOTROPY,c=Dp){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:gie++}),this.uuid=hl(),this.name="",this.source=new dg(t),this.mipmaps=[],this.mapping=i,this.wrapS=r,this.wrapT=n,this.magFilter=s,this.minFilter=a,this.anisotropy=u,this.format=o,this.internalFormat=null,this.type=l,this.offset=new ft(0,0),this.repeat=new ft(1,1),this.center=new ft(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ma,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const i=t===void 0||typeof t=="string";if(!i&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),i||(t.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==AC)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Eb:t.x=t.x-Math.floor(t.x);break;case Oa:t.x=t.x<0?0:1;break;case Cb:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case Eb:t.y=t.y-Math.floor(t.y);break;case Oa:t.y=t.y<0?0:1;break;case Cb:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}}_n.DEFAULT_IMAGE=null;_n.DEFAULT_MAPPING=AC;_n.DEFAULT_ANISOTROPY=1;class _r{constructor(t=0,i=0,r=0,n=1){_r.prototype.isVector4=!0,this.x=t,this.y=i,this.z=r,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,i,r,n){return this.x=t,this.y=i,this.z=r,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this.w+=t.w*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const i=this.x,r=this.y,n=this.z,s=this.w,a=t.elements;return this.x=a[0]*i+a[4]*r+a[8]*n+a[12]*s,this.y=a[1]*i+a[5]*r+a[9]*n+a[13]*s,this.z=a[2]*i+a[6]*r+a[10]*n+a[14]*s,this.w=a[3]*i+a[7]*r+a[11]*n+a[15]*s,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const i=Math.sqrt(1-t.w*t.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/i,this.y=t.y/i,this.z=t.z/i),this}setAxisAngleFromRotationMatrix(t){let i,r,n,s;const l=t.elements,u=l[0],c=l[4],h=l[8],d=l[1],p=l[5],m=l[9],v=l[2],g=l[6],w=l[10];if(Math.abs(c-d)<.01&&Math.abs(h-v)<.01&&Math.abs(m-g)<.01){if(Math.abs(c+d)<.1&&Math.abs(h+v)<.1&&Math.abs(m+g)<.1&&Math.abs(u+p+w-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const _=(u+1)/2,A=(p+1)/2,C=(w+1)/2,E=(c+d)/4,I=(h+v)/4,T=(m+g)/4;return _>A&&_>C?_<.01?(r=0,n=.707106781,s=.707106781):(r=Math.sqrt(_),n=E/r,s=I/r):A>C?A<.01?(r=.707106781,n=0,s=.707106781):(n=Math.sqrt(A),r=E/n,s=T/n):C<.01?(r=.707106781,n=.707106781,s=0):(s=Math.sqrt(C),r=I/s,n=T/s),this.set(r,n,s,i),this}let S=Math.sqrt((g-m)*(g-m)+(h-v)*(h-v)+(d-c)*(d-c));return Math.abs(S)<.001&&(S=1),this.x=(g-m)/S,this.y=(h-v)/S,this.z=(d-c)/S,this.w=Math.acos((u+p+w-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this.w=Math.max(t.w,Math.min(i.w,this.w)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this.w=Math.max(t,Math.min(i,this.w)),this}clampLength(t,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this.w+=(t.w-this.w)*i,this}lerpVectors(t,i,r){return this.x=t.x+(i.x-t.x)*r,this.y=t.y+(i.y-t.y)*r,this.z=t.z+(i.z-t.z)*r,this.w=t.w+(i.w-t.w)*r,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this.w=t.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Vu extends Fd{constructor(t=1,i=1,r={}){super(),this.isWebGLRenderTarget=!0,this.width=t,this.height=i,this.depth=1,this.scissor=new _r(0,0,t,i),this.scissorTest=!1,this.viewport=new _r(0,0,t,i);const n={width:t,height:i,depth:1};this.texture=new _n(n,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=r.generateMipmaps!==void 0?r.generateMipmaps:!1,this.texture.internalFormat=r.internalFormat!==void 0?r.internalFormat:null,this.texture.minFilter=r.minFilter!==void 0?r.minFilter:On,this.depthBuffer=r.depthBuffer!==void 0?r.depthBuffer:!0,this.stencilBuffer=r.stencilBuffer!==void 0?r.stencilBuffer:!1,this.depthTexture=r.depthTexture!==void 0?r.depthTexture:null,this.samples=r.samples!==void 0?r.samples:0}setSize(t,i,r=1){(this.width!==t||this.height!==i||this.depth!==r)&&(this.width=t,this.height=i,this.depth=r,this.texture.image.width=t,this.texture.image.height=i,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,t,i),this.scissor.set(0,0,t,i)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;const i=Object.assign({},t.texture.image);return this.texture.source=new dg(i),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class CC extends _n{constructor(t=null,i=1,r=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:i,height:r,depth:n},this.magFilter=Ln,this.minFilter=Ln,this.wrapR=Oa,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class vie extends Vu{constructor(t=1,i=1,r=1){super(t,i),this.isWebGLArrayRenderTarget=!0,this.depth=r,this.texture=new CC(null,t,i,r),this.texture.isRenderTargetTexture=!0}}class cz extends _n{constructor(t=null,i=1,r=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:i,height:r,depth:n},this.magFilter=Ln,this.minFilter=Ln,this.wrapR=Oa,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class yie extends Vu{constructor(t=1,i=1,r=1){super(t,i),this.isWebGL3DRenderTarget=!0,this.depth=r,this.texture=new cz(null,t,i,r),this.texture.isRenderTargetTexture=!0}}class xie extends Vu{constructor(t=1,i=1,r=1,n={}){super(t,i,n),this.isWebGLMultipleRenderTargets=!0;const s=this.texture;this.texture=[];for(let a=0;a<r;a++)this.texture[a]=s.clone(),this.texture[a].isRenderTargetTexture=!0}setSize(t,i,r=1){if(this.width!==t||this.height!==i||this.depth!==r){this.width=t,this.height=i,this.depth=r;for(let n=0,s=this.texture.length;n<s;n++)this.texture[n].image.width=t,this.texture[n].image.height=i,this.texture[n].image.depth=r;this.dispose()}return this.viewport.set(0,0,t,i),this.scissor.set(0,0,t,i),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.texture.length=0;for(let i=0,r=t.texture.length;i<r;i++)this.texture[i]=t.texture[i].clone(),this.texture[i].isRenderTargetTexture=!0;return this}}class ev{constructor(t=new pe(1/0,1/0,1/0),i=new pe(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=i}set(t,i){return this.min.copy(t),this.max.copy(i),this}setFromArray(t){let i=1/0,r=1/0,n=1/0,s=-1/0,a=-1/0,o=-1/0;for(let l=0,u=t.length;l<u;l+=3){const c=t[l],h=t[l+1],d=t[l+2];c<i&&(i=c),h<r&&(r=h),d<n&&(n=d),c>s&&(s=c),h>a&&(a=h),d>o&&(o=d)}return this.min.set(i,r,n),this.max.set(s,a,o),this}setFromBufferAttribute(t){let i=1/0,r=1/0,n=1/0,s=-1/0,a=-1/0,o=-1/0;for(let l=0,u=t.count;l<u;l++){const c=t.getX(l),h=t.getY(l),d=t.getZ(l);c<i&&(i=c),h<r&&(r=h),d<n&&(n=d),c>s&&(s=c),h>a&&(a=h),d>o&&(o=d)}return this.min.set(i,r,n),this.max.set(s,a,o),this}setFromPoints(t){this.makeEmpty();for(let i=0,r=t.length;i<r;i++)this.expandByPoint(t[i]);return this}setFromCenterAndSize(t,i){const r=Dm.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}setFromObject(t,i=!1){return this.makeEmpty(),this.expandByObject(t,i)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,i=!1){t.updateWorldMatrix(!1,!1);const r=t.geometry;if(r!==void 0)if(i&&r.attributes!=null&&r.attributes.position!==void 0){const s=r.attributes.position;for(let a=0,o=s.count;a<o;a++)Dm.fromBufferAttribute(s,a).applyMatrix4(t.matrixWorld),this.expandByPoint(Dm)}else r.boundingBox===null&&r.computeBoundingBox(),hP.copy(r.boundingBox),hP.applyMatrix4(t.matrixWorld),this.union(hP);const n=t.children;for(let s=0,a=n.length;s<a;s++)this.expandByObject(n[s],i);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,i){return i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,Dm),Dm.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let i,r;return t.normal.x>0?(i=t.normal.x*this.min.x,r=t.normal.x*this.max.x):(i=t.normal.x*this.max.x,r=t.normal.x*this.min.x),t.normal.y>0?(i+=t.normal.y*this.min.y,r+=t.normal.y*this.max.y):(i+=t.normal.y*this.max.y,r+=t.normal.y*this.min.y),t.normal.z>0?(i+=t.normal.z*this.min.z,r+=t.normal.z*this.max.z):(i+=t.normal.z*this.max.z,r+=t.normal.z*this.min.z),i<=-t.constant&&r>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(W1),iM.subVectors(this.max,W1),m0.subVectors(t.a,W1),g0.subVectors(t.b,W1),v0.subVectors(t.c,W1),Tf.subVectors(g0,m0),Pf.subVectors(v0,g0),Rm.subVectors(m0,v0);let i=[0,-Tf.z,Tf.y,0,-Pf.z,Pf.y,0,-Rm.z,Rm.y,Tf.z,0,-Tf.x,Pf.z,0,-Pf.x,Rm.z,0,-Rm.x,-Tf.y,Tf.x,0,-Pf.y,Pf.x,0,-Rm.y,Rm.x,0];return!dP(i,m0,g0,v0,iM)||(i=[1,0,0,0,1,0,0,0,1],!dP(i,m0,g0,v0,iM))?!1:(rM.crossVectors(Tf,Pf),i=[rM.x,rM.y,rM.z],dP(i,m0,g0,v0,iM))}clampPoint(t,i){return i.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Dm).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(Dm).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(Oh[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Oh[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Oh[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Oh[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Oh[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Oh[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Oh[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Oh[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Oh),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Oh=[new pe,new pe,new pe,new pe,new pe,new pe,new pe,new pe],Dm=new pe,hP=new ev,m0=new pe,g0=new pe,v0=new pe,Tf=new pe,Pf=new pe,Rm=new pe,W1=new pe,iM=new pe,rM=new pe,Im=new pe;function dP(e,t,i,r,n){for(let s=0,a=e.length-3;s<=a;s+=3){Im.fromArray(e,s);const o=n.x*Math.abs(Im.x)+n.y*Math.abs(Im.y)+n.z*Math.abs(Im.z),l=t.dot(Im),u=i.dot(Im),c=r.dot(Im);if(Math.max(-Math.max(l,u,c),Math.min(l,u,c))>o)return!1}return!0}const wie=new ev,G1=new pe,fP=new pe;class tv{constructor(t=new pe,i=-1){this.center=t,this.radius=i}set(t,i){return this.center.copy(t),this.radius=i,this}setFromPoints(t,i){const r=this.center;i!==void 0?r.copy(i):wie.setFromPoints(t).getCenter(r);let n=0;for(let s=0,a=t.length;s<a;s++)n=Math.max(n,r.distanceToSquared(t[s]));return this.radius=Math.sqrt(n),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const i=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=i*i}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,i){const r=this.center.distanceToSquared(t);return i.copy(t),r>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;G1.subVectors(t,this.center);const i=G1.lengthSq();if(i>this.radius*this.radius){const r=Math.sqrt(i),n=(r-this.radius)*.5;this.center.addScaledVector(G1,n/r),this.radius+=n}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(fP.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(G1.copy(t.center).add(fP)),this.expandByPoint(G1.copy(t.center).sub(fP))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}const zh=new pe,pP=new pe,nM=new pe,Df=new pe,mP=new pe,sM=new pe,gP=new pe;class Cx{constructor(t=new pe,i=new pe(0,0,-1)){this.origin=t,this.direction=i}set(t,i){return this.origin.copy(t),this.direction.copy(i),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,i){return i.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,zh)),this}closestPointToPoint(t,i){i.subVectors(t,this.origin);const r=i.dot(this.direction);return r<0?i.copy(this.origin):i.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const i=zh.subVectors(t,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(t):(zh.copy(this.origin).addScaledVector(this.direction,i),zh.distanceToSquared(t))}distanceSqToSegment(t,i,r,n){pP.copy(t).add(i).multiplyScalar(.5),nM.copy(i).sub(t).normalize(),Df.copy(this.origin).sub(pP);const s=t.distanceTo(i)*.5,a=-this.direction.dot(nM),o=Df.dot(this.direction),l=-Df.dot(nM),u=Df.lengthSq(),c=Math.abs(1-a*a);let h,d,p,m;if(c>0)if(h=a*l-o,d=a*o-l,m=s*c,h>=0)if(d>=-m)if(d<=m){const v=1/c;h*=v,d*=v,p=h*(h+a*d+2*o)+d*(a*h+d+2*l)+u}else d=s,h=Math.max(0,-(a*d+o)),p=-h*h+d*(d+2*l)+u;else d=-s,h=Math.max(0,-(a*d+o)),p=-h*h+d*(d+2*l)+u;else d<=-m?(h=Math.max(0,-(-a*s+o)),d=h>0?-s:Math.min(Math.max(-s,-l),s),p=-h*h+d*(d+2*l)+u):d<=m?(h=0,d=Math.min(Math.max(-s,-l),s),p=d*(d+2*l)+u):(h=Math.max(0,-(a*s+o)),d=h>0?s:Math.min(Math.max(-s,-l),s),p=-h*h+d*(d+2*l)+u);else d=a>0?-s:s,h=Math.max(0,-(a*d+o)),p=-h*h+d*(d+2*l)+u;return r&&r.copy(this.origin).addScaledVector(this.direction,h),n&&n.copy(pP).addScaledVector(nM,d),p}intersectSphere(t,i){zh.subVectors(t.center,this.origin);const r=zh.dot(this.direction),n=zh.dot(zh)-r*r,s=t.radius*t.radius;if(n>s)return null;const a=Math.sqrt(s-n),o=r-a,l=r+a;return l<0?null:o<0?this.at(l,i):this.at(o,i)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const i=t.normal.dot(this.direction);if(i===0)return t.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(t.normal)+t.constant)/i;return r>=0?r:null}intersectPlane(t,i){const r=this.distanceToPlane(t);return r===null?null:this.at(r,i)}intersectsPlane(t){const i=t.distanceToPoint(this.origin);return i===0||t.normal.dot(this.direction)*i<0}intersectBox(t,i){let r,n,s,a,o,l;const u=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,d=this.origin;return u>=0?(r=(t.min.x-d.x)*u,n=(t.max.x-d.x)*u):(r=(t.max.x-d.x)*u,n=(t.min.x-d.x)*u),c>=0?(s=(t.min.y-d.y)*c,a=(t.max.y-d.y)*c):(s=(t.max.y-d.y)*c,a=(t.min.y-d.y)*c),r>a||s>n||((s>r||isNaN(r))&&(r=s),(a<n||isNaN(n))&&(n=a),h>=0?(o=(t.min.z-d.z)*h,l=(t.max.z-d.z)*h):(o=(t.max.z-d.z)*h,l=(t.min.z-d.z)*h),r>l||o>n)||((o>r||r!==r)&&(r=o),(l<n||n!==n)&&(n=l),n<0)?null:this.at(r>=0?r:n,i)}intersectsBox(t){return this.intersectBox(t,zh)!==null}intersectTriangle(t,i,r,n,s){mP.subVectors(i,t),sM.subVectors(r,t),gP.crossVectors(mP,sM);let a=this.direction.dot(gP),o;if(a>0){if(n)return null;o=1}else if(a<0)o=-1,a=-a;else return null;Df.subVectors(this.origin,t);const l=o*this.direction.dot(sM.crossVectors(Df,sM));if(l<0)return null;const u=o*this.direction.dot(mP.cross(Df));if(u<0||l+u>a)return null;const c=-o*Df.dot(gP);return c<0?null:this.at(c/a,s)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Oi{constructor(){Oi.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(t,i,r,n,s,a,o,l,u,c,h,d,p,m,v,g){const w=this.elements;return w[0]=t,w[4]=i,w[8]=r,w[12]=n,w[1]=s,w[5]=a,w[9]=o,w[13]=l,w[2]=u,w[6]=c,w[10]=h,w[14]=d,w[3]=p,w[7]=m,w[11]=v,w[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Oi().fromArray(this.elements)}copy(t){const i=this.elements,r=t.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this}copyPosition(t){const i=this.elements,r=t.elements;return i[12]=r[12],i[13]=r[13],i[14]=r[14],this}setFromMatrix3(t){const i=t.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(t,i,r){return t.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(t,i,r){return this.set(t.x,i.x,r.x,0,t.y,i.y,r.y,0,t.z,i.z,r.z,0,0,0,0,1),this}extractRotation(t){const i=this.elements,r=t.elements,n=1/y0.setFromMatrixColumn(t,0).length(),s=1/y0.setFromMatrixColumn(t,1).length(),a=1/y0.setFromMatrixColumn(t,2).length();return i[0]=r[0]*n,i[1]=r[1]*n,i[2]=r[2]*n,i[3]=0,i[4]=r[4]*s,i[5]=r[5]*s,i[6]=r[6]*s,i[7]=0,i[8]=r[8]*a,i[9]=r[9]*a,i[10]=r[10]*a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(t){const i=this.elements,r=t.x,n=t.y,s=t.z,a=Math.cos(r),o=Math.sin(r),l=Math.cos(n),u=Math.sin(n),c=Math.cos(s),h=Math.sin(s);if(t.order==="XYZ"){const d=a*c,p=a*h,m=o*c,v=o*h;i[0]=l*c,i[4]=-l*h,i[8]=u,i[1]=p+m*u,i[5]=d-v*u,i[9]=-o*l,i[2]=v-d*u,i[6]=m+p*u,i[10]=a*l}else if(t.order==="YXZ"){const d=l*c,p=l*h,m=u*c,v=u*h;i[0]=d+v*o,i[4]=m*o-p,i[8]=a*u,i[1]=a*h,i[5]=a*c,i[9]=-o,i[2]=p*o-m,i[6]=v+d*o,i[10]=a*l}else if(t.order==="ZXY"){const d=l*c,p=l*h,m=u*c,v=u*h;i[0]=d-v*o,i[4]=-a*h,i[8]=m+p*o,i[1]=p+m*o,i[5]=a*c,i[9]=v-d*o,i[2]=-a*u,i[6]=o,i[10]=a*l}else if(t.order==="ZYX"){const d=a*c,p=a*h,m=o*c,v=o*h;i[0]=l*c,i[4]=m*u-p,i[8]=d*u+v,i[1]=l*h,i[5]=v*u+d,i[9]=p*u-m,i[2]=-u,i[6]=o*l,i[10]=a*l}else if(t.order==="YZX"){const d=a*l,p=a*u,m=o*l,v=o*u;i[0]=l*c,i[4]=v-d*h,i[8]=m*h+p,i[1]=h,i[5]=a*c,i[9]=-o*c,i[2]=-u*c,i[6]=p*h+m,i[10]=d-v*h}else if(t.order==="XZY"){const d=a*l,p=a*u,m=o*l,v=o*u;i[0]=l*c,i[4]=-h,i[8]=u*c,i[1]=d*h+v,i[5]=a*c,i[9]=p*h-m,i[2]=m*h-p,i[6]=o*c,i[10]=v*h+d}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(t){return this.compose(bie,t,_ie)}lookAt(t,i,r){const n=this.elements;return nl.subVectors(t,i),nl.lengthSq()===0&&(nl.z=1),nl.normalize(),Rf.crossVectors(r,nl),Rf.lengthSq()===0&&(Math.abs(r.z)===1?nl.x+=1e-4:nl.z+=1e-4,nl.normalize(),Rf.crossVectors(r,nl)),Rf.normalize(),aM.crossVectors(nl,Rf),n[0]=Rf.x,n[4]=aM.x,n[8]=nl.x,n[1]=Rf.y,n[5]=aM.y,n[9]=nl.y,n[2]=Rf.z,n[6]=aM.z,n[10]=nl.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,i){const r=t.elements,n=i.elements,s=this.elements,a=r[0],o=r[4],l=r[8],u=r[12],c=r[1],h=r[5],d=r[9],p=r[13],m=r[2],v=r[6],g=r[10],w=r[14],S=r[3],_=r[7],A=r[11],C=r[15],E=n[0],I=n[4],T=n[8],D=n[12],L=n[1],z=n[5],G=n[9],V=n[13],j=n[2],J=n[6],ne=n[10],K=n[14],B=n[3],Z=n[7],F=n[11],X=n[15];return s[0]=a*E+o*L+l*j+u*B,s[4]=a*I+o*z+l*J+u*Z,s[8]=a*T+o*G+l*ne+u*F,s[12]=a*D+o*V+l*K+u*X,s[1]=c*E+h*L+d*j+p*B,s[5]=c*I+h*z+d*J+p*Z,s[9]=c*T+h*G+d*ne+p*F,s[13]=c*D+h*V+d*K+p*X,s[2]=m*E+v*L+g*j+w*B,s[6]=m*I+v*z+g*J+w*Z,s[10]=m*T+v*G+g*ne+w*F,s[14]=m*D+v*V+g*K+w*X,s[3]=S*E+_*L+A*j+C*B,s[7]=S*I+_*z+A*J+C*Z,s[11]=S*T+_*G+A*ne+C*F,s[15]=S*D+_*V+A*K+C*X,this}multiplyScalar(t){const i=this.elements;return i[0]*=t,i[4]*=t,i[8]*=t,i[12]*=t,i[1]*=t,i[5]*=t,i[9]*=t,i[13]*=t,i[2]*=t,i[6]*=t,i[10]*=t,i[14]*=t,i[3]*=t,i[7]*=t,i[11]*=t,i[15]*=t,this}determinant(){const t=this.elements,i=t[0],r=t[4],n=t[8],s=t[12],a=t[1],o=t[5],l=t[9],u=t[13],c=t[2],h=t[6],d=t[10],p=t[14],m=t[3],v=t[7],g=t[11],w=t[15];return m*(+s*l*h-n*u*h-s*o*d+r*u*d+n*o*p-r*l*p)+v*(+i*l*p-i*u*d+s*a*d-n*a*p+n*u*c-s*l*c)+g*(+i*u*h-i*o*p-s*a*h+r*a*p+s*o*c-r*u*c)+w*(-n*o*c-i*l*h+i*o*d+n*a*h-r*a*d+r*l*c)}transpose(){const t=this.elements;let i;return i=t[1],t[1]=t[4],t[4]=i,i=t[2],t[2]=t[8],t[8]=i,i=t[6],t[6]=t[9],t[9]=i,i=t[3],t[3]=t[12],t[12]=i,i=t[7],t[7]=t[13],t[13]=i,i=t[11],t[11]=t[14],t[14]=i,this}setPosition(t,i,r){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=i,n[14]=r),this}invert(){const t=this.elements,i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],u=t[7],c=t[8],h=t[9],d=t[10],p=t[11],m=t[12],v=t[13],g=t[14],w=t[15],S=h*g*u-v*d*u+v*l*p-o*g*p-h*l*w+o*d*w,_=m*d*u-c*g*u-m*l*p+a*g*p+c*l*w-a*d*w,A=c*v*u-m*h*u+m*o*p-a*v*p-c*o*w+a*h*w,C=m*h*l-c*v*l-m*o*d+a*v*d+c*o*g-a*h*g,E=i*S+r*_+n*A+s*C;if(E===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const I=1/E;return t[0]=S*I,t[1]=(v*d*s-h*g*s-v*n*p+r*g*p+h*n*w-r*d*w)*I,t[2]=(o*g*s-v*l*s+v*n*u-r*g*u-o*n*w+r*l*w)*I,t[3]=(h*l*s-o*d*s-h*n*u+r*d*u+o*n*p-r*l*p)*I,t[4]=_*I,t[5]=(c*g*s-m*d*s+m*n*p-i*g*p-c*n*w+i*d*w)*I,t[6]=(m*l*s-a*g*s-m*n*u+i*g*u+a*n*w-i*l*w)*I,t[7]=(a*d*s-c*l*s+c*n*u-i*d*u-a*n*p+i*l*p)*I,t[8]=A*I,t[9]=(m*h*s-c*v*s-m*r*p+i*v*p+c*r*w-i*h*w)*I,t[10]=(a*v*s-m*o*s+m*r*u-i*v*u-a*r*w+i*o*w)*I,t[11]=(c*o*s-a*h*s-c*r*u+i*h*u+a*r*p-i*o*p)*I,t[12]=C*I,t[13]=(c*v*n-m*h*n+m*r*d-i*v*d-c*r*g+i*h*g)*I,t[14]=(m*o*n-a*v*n-m*r*l+i*v*l+a*r*g-i*o*g)*I,t[15]=(a*h*n-c*o*n+c*r*l-i*h*l-a*r*d+i*o*d)*I,this}scale(t){const i=this.elements,r=t.x,n=t.y,s=t.z;return i[0]*=r,i[4]*=n,i[8]*=s,i[1]*=r,i[5]*=n,i[9]*=s,i[2]*=r,i[6]*=n,i[10]*=s,i[3]*=r,i[7]*=n,i[11]*=s,this}getMaxScaleOnAxis(){const t=this.elements,i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(i,r,n))}makeTranslation(t,i,r){return this.set(1,0,0,t,0,1,0,i,0,0,1,r,0,0,0,1),this}makeRotationX(t){const i=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,i,-r,0,0,r,i,0,0,0,0,1),this}makeRotationY(t){const i=Math.cos(t),r=Math.sin(t);return this.set(i,0,r,0,0,1,0,0,-r,0,i,0,0,0,0,1),this}makeRotationZ(t){const i=Math.cos(t),r=Math.sin(t);return this.set(i,-r,0,0,r,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,i){const r=Math.cos(i),n=Math.sin(i),s=1-r,a=t.x,o=t.y,l=t.z,u=s*a,c=s*o;return this.set(u*a+r,u*o-n*l,u*l+n*o,0,u*o+n*l,c*o+r,c*l-n*a,0,u*l-n*o,c*l+n*a,s*l*l+r,0,0,0,0,1),this}makeScale(t,i,r){return this.set(t,0,0,0,0,i,0,0,0,0,r,0,0,0,0,1),this}makeShear(t,i,r,n,s,a){return this.set(1,r,s,0,t,1,a,0,i,n,1,0,0,0,0,1),this}compose(t,i,r){const n=this.elements,s=i._x,a=i._y,o=i._z,l=i._w,u=s+s,c=a+a,h=o+o,d=s*u,p=s*c,m=s*h,v=a*c,g=a*h,w=o*h,S=l*u,_=l*c,A=l*h,C=r.x,E=r.y,I=r.z;return n[0]=(1-(v+w))*C,n[1]=(p+A)*C,n[2]=(m-_)*C,n[3]=0,n[4]=(p-A)*E,n[5]=(1-(d+w))*E,n[6]=(g+S)*E,n[7]=0,n[8]=(m+_)*I,n[9]=(g-S)*I,n[10]=(1-(d+v))*I,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,i,r){const n=this.elements;let s=y0.set(n[0],n[1],n[2]).length();const a=y0.set(n[4],n[5],n[6]).length(),o=y0.set(n[8],n[9],n[10]).length();this.determinant()<0&&(s=-s),t.x=n[12],t.y=n[13],t.z=n[14],gu.copy(this);const u=1/s,c=1/a,h=1/o;return gu.elements[0]*=u,gu.elements[1]*=u,gu.elements[2]*=u,gu.elements[4]*=c,gu.elements[5]*=c,gu.elements[6]*=c,gu.elements[8]*=h,gu.elements[9]*=h,gu.elements[10]*=h,i.setFromRotationMatrix(gu),r.x=s,r.y=a,r.z=o,this}makePerspective(t,i,r,n,s,a){const o=this.elements,l=2*s/(i-t),u=2*s/(r-n),c=(i+t)/(i-t),h=(r+n)/(r-n),d=-(a+s)/(a-s),p=-2*a*s/(a-s);return o[0]=l,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=u,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,i,r,n,s,a){const o=this.elements,l=1/(i-t),u=1/(r-n),c=1/(a-s),h=(i+t)*l,d=(r+n)*u,p=(a+s)*c;return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*u,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){const i=this.elements,r=t.elements;for(let n=0;n<16;n++)if(i[n]!==r[n])return!1;return!0}fromArray(t,i=0){for(let r=0;r<16;r++)this.elements[r]=t[r+i];return this}toArray(t=[],i=0){const r=this.elements;return t[i]=r[0],t[i+1]=r[1],t[i+2]=r[2],t[i+3]=r[3],t[i+4]=r[4],t[i+5]=r[5],t[i+6]=r[6],t[i+7]=r[7],t[i+8]=r[8],t[i+9]=r[9],t[i+10]=r[10],t[i+11]=r[11],t[i+12]=r[12],t[i+13]=r[13],t[i+14]=r[14],t[i+15]=r[15],t}}const y0=new pe,gu=new Oi,bie=new pe(0,0,0),_ie=new pe(1,1,1),Rf=new pe,aM=new pe,nl=new pe,vF=new Oi,yF=new Fa;class iv{constructor(t=0,i=0,r=0,n=iv.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=i,this._z=r,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,i,r,n=this._order){return this._x=t,this._y=i,this._z=r,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,i=this._order,r=!0){const n=t.elements,s=n[0],a=n[4],o=n[8],l=n[1],u=n[5],c=n[9],h=n[2],d=n[6],p=n[10];switch(i){case"XYZ":this._y=Math.asin(zn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,p),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(d,u),this._z=0);break;case"YXZ":this._x=Math.asin(-zn(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,p),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(zn(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-zn(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(zn(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(o,p));break;case"XZY":this._z=Math.asin(-zn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,u),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-c,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,r===!0&&this._onChangeCallback(),this}setFromQuaternion(t,i,r){return vF.makeRotationFromQuaternion(t),this.setFromRotationMatrix(vF,i,r)}setFromVector3(t,i=this._order){return this.set(t.x,t.y,t.z,i)}reorder(t){return yF.setFromEuler(this),this.setFromQuaternion(yF,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}iv.DEFAULT_ORDER="XYZ";class Cg{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let Sie=0;const xF=new pe,x0=new Fa,kh=new Oi,oM=new pe,q1=new pe,Mie=new pe,Aie=new Fa,wF=new pe(1,0,0),bF=new pe(0,1,0),_F=new pe(0,0,1),Eie={type:"added"},SF={type:"removed"};class ur extends Fd{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Sie++}),this.uuid=hl(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ur.DEFAULT_UP.clone();const t=new pe,i=new iv,r=new Fa,n=new pe(1,1,1);function s(){r.setFromEuler(i,!1)}function a(){i.setFromQuaternion(r,void 0,!1)}i._onChange(s),r._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Oi},normalMatrix:{value:new ma}}),this.matrix=new Oi,this.matrixWorld=new Oi,this.matrixAutoUpdate=ur.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=ur.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Cg,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,i){this.quaternion.setFromAxisAngle(t,i)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,i){return x0.setFromAxisAngle(t,i),this.quaternion.multiply(x0),this}rotateOnWorldAxis(t,i){return x0.setFromAxisAngle(t,i),this.quaternion.premultiply(x0),this}rotateX(t){return this.rotateOnAxis(wF,t)}rotateY(t){return this.rotateOnAxis(bF,t)}rotateZ(t){return this.rotateOnAxis(_F,t)}translateOnAxis(t,i){return xF.copy(t).applyQuaternion(this.quaternion),this.position.add(xF.multiplyScalar(i)),this}translateX(t){return this.translateOnAxis(wF,t)}translateY(t){return this.translateOnAxis(bF,t)}translateZ(t){return this.translateOnAxis(_F,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(kh.copy(this.matrixWorld).invert())}lookAt(t,i,r){t.isVector3?oM.copy(t):oM.set(t,i,r);const n=this.parent;this.updateWorldMatrix(!0,!1),q1.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?kh.lookAt(q1,oM,this.up):kh.lookAt(oM,q1,this.up),this.quaternion.setFromRotationMatrix(kh),n&&(kh.extractRotation(n.matrixWorld),x0.setFromRotationMatrix(kh),this.quaternion.premultiply(x0.invert()))}add(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Eie)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const i=this.children.indexOf(t);return i!==-1&&(t.parent=null,this.children.splice(i,1),t.dispatchEvent(SF)),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const i=this.children[t];i.parent=null,i.dispatchEvent(SF)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),kh.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),kh.multiply(t.parent.matrixWorld)),t.applyMatrix4(kh),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,i){if(this[t]===i)return this;for(let r=0,n=this.children.length;r<n;r++){const a=this.children[r].getObjectByProperty(t,i);if(a!==void 0)return a}}getObjectsByProperty(t,i){let r=[];this[t]===i&&r.push(this);for(let n=0,s=this.children.length;n<s;n++){const a=this.children[n].getObjectsByProperty(t,i);a.length>0&&(r=r.concat(a))}return r}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(q1,t,Mie),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(q1,Aie,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return t.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(t){t(this);const i=this.children;for(let r=0,n=i.length;r<n;r++)i[r].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const i=this.children;for(let r=0,n=i.length;r<n;r++)i[r].traverseVisible(t)}traverseAncestors(t){const i=this.parent;i!==null&&(t(i),i.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const i=this.children;for(let r=0,n=i.length;r<n;r++){const s=i[r];(s.matrixWorldAutoUpdate===!0||t===!0)&&s.updateMatrixWorld(t)}}updateWorldMatrix(t,i){const r=this.parent;if(t===!0&&r!==null&&r.matrixWorldAutoUpdate===!0&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),i===!0){const n=this.children;for(let s=0,a=n.length;s<a;s++){const o=n[s];o.matrixWorldAutoUpdate===!0&&o.updateWorldMatrix(!1,!0)}}}toJSON(t){const i=t===void 0||typeof t=="string",r={};i&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(n.instanceColor=this.instanceColor.toJSON()));function s(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(t)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=s(t.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const l=o.shapes;if(Array.isArray(l))for(let u=0,c=l.length;u<c;u++){const h=l[u];s(t.shapes,h)}else s(t.shapes,l)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let l=0,u=this.material.length;l<u;l++)o.push(s(t.materials,this.material[l]));n.material=o}else n.material=s(t.materials,this.material);if(this.children.length>0){n.children=[];for(let o=0;o<this.children.length;o++)n.children.push(this.children[o].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let o=0;o<this.animations.length;o++){const l=this.animations[o];n.animations.push(s(t.animations,l))}}if(i){const o=a(t.geometries),l=a(t.materials),u=a(t.textures),c=a(t.images),h=a(t.shapes),d=a(t.skeletons),p=a(t.animations),m=a(t.nodes);o.length>0&&(r.geometries=o),l.length>0&&(r.materials=l),u.length>0&&(r.textures=u),c.length>0&&(r.images=c),h.length>0&&(r.shapes=h),d.length>0&&(r.skeletons=d),p.length>0&&(r.animations=p),m.length>0&&(r.nodes=m)}return r.object=n,r;function a(o){const l=[];for(const u in o){const c=o[u];delete c.metadata,l.push(c)}return l}}clone(t){return new this.constructor().copy(this,t)}copy(t,i=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),i===!0)for(let r=0;r<t.children.length;r++){const n=t.children[r];this.add(n.clone())}return this}}ur.DEFAULT_UP=new pe(0,1,0);ur.DEFAULT_MATRIX_AUTO_UPDATE=!0;ur.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const vu=new pe,Bh=new pe,vP=new pe,Nh=new pe,w0=new pe,b0=new pe,MF=new pe,yP=new pe,xP=new pe,wP=new pe;class Vl{constructor(t=new pe,i=new pe,r=new pe){this.a=t,this.b=i,this.c=r}static getNormal(t,i,r,n){n.subVectors(r,i),vu.subVectors(t,i),n.cross(vu);const s=n.lengthSq();return s>0?n.multiplyScalar(1/Math.sqrt(s)):n.set(0,0,0)}static getBarycoord(t,i,r,n,s){vu.subVectors(n,i),Bh.subVectors(r,i),vP.subVectors(t,i);const a=vu.dot(vu),o=vu.dot(Bh),l=vu.dot(vP),u=Bh.dot(Bh),c=Bh.dot(vP),h=a*u-o*o;if(h===0)return s.set(-2,-1,-1);const d=1/h,p=(u*l-o*c)*d,m=(a*c-o*l)*d;return s.set(1-p-m,m,p)}static containsPoint(t,i,r,n){return this.getBarycoord(t,i,r,n,Nh),Nh.x>=0&&Nh.y>=0&&Nh.x+Nh.y<=1}static getUV(t,i,r,n,s,a,o,l){return this.getBarycoord(t,i,r,n,Nh),l.set(0,0),l.addScaledVector(s,Nh.x),l.addScaledVector(a,Nh.y),l.addScaledVector(o,Nh.z),l}static isFrontFacing(t,i,r,n){return vu.subVectors(r,i),Bh.subVectors(t,i),vu.cross(Bh).dot(n)<0}set(t,i,r){return this.a.copy(t),this.b.copy(i),this.c.copy(r),this}setFromPointsAndIndices(t,i,r,n){return this.a.copy(t[i]),this.b.copy(t[r]),this.c.copy(t[n]),this}setFromAttributeAndIndices(t,i,r,n){return this.a.fromBufferAttribute(t,i),this.b.fromBufferAttribute(t,r),this.c.fromBufferAttribute(t,n),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return vu.subVectors(this.c,this.b),Bh.subVectors(this.a,this.b),vu.cross(Bh).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Vl.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,i){return Vl.getBarycoord(t,this.a,this.b,this.c,i)}getUV(t,i,r,n,s){return Vl.getUV(t,this.a,this.b,this.c,i,r,n,s)}containsPoint(t){return Vl.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Vl.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,i){const r=this.a,n=this.b,s=this.c;let a,o;w0.subVectors(n,r),b0.subVectors(s,r),yP.subVectors(t,r);const l=w0.dot(yP),u=b0.dot(yP);if(l<=0&&u<=0)return i.copy(r);xP.subVectors(t,n);const c=w0.dot(xP),h=b0.dot(xP);if(c>=0&&h<=c)return i.copy(n);const d=l*h-c*u;if(d<=0&&l>=0&&c<=0)return a=l/(l-c),i.copy(r).addScaledVector(w0,a);wP.subVectors(t,s);const p=w0.dot(wP),m=b0.dot(wP);if(m>=0&&p<=m)return i.copy(s);const v=p*u-l*m;if(v<=0&&u>=0&&m<=0)return o=u/(u-m),i.copy(r).addScaledVector(b0,o);const g=c*m-p*h;if(g<=0&&h-c>=0&&p-m>=0)return MF.subVectors(s,n),o=(h-c)/(h-c+(p-m)),i.copy(n).addScaledVector(MF,o);const w=1/(g+v+d);return a=v*w,o=d*w,i.copy(r).addScaledVector(w0,a).addScaledVector(b0,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let Cie=0;class wa extends Fd{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Cie++}),this.uuid=hl(),this.name="",this.type="Material",this.blending=Mg,this.side=Ed,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=tz,this.blendDst=iz,this.blendEquation=tg,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=$E,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=m9,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=TE,this.stencilZFail=TE,this.stencilZPass=TE,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const i in t){const r=t[i];if(r===void 0){console.warn("THREE.Material: '"+i+"' parameter is undefined.");continue}const n=this[i];if(n===void 0){console.warn("THREE."+this.type+": '"+i+"' is not a property of this material.");continue}n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[i]=r}}toJSON(t){const i=t===void 0||typeof t=="string";i&&(t={textures:{},images:{}});const r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(t).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(t).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(t).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(t).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(t).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==Mg&&(r.blending=this.blending),this.side!==Ed&&(r.side=this.side),this.vertexColors&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.colorWrite=this.colorWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(r.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(r.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=this.flatShading),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function n(s){const a=[];for(const o in s){const l=s[o];delete l.metadata,a.push(l)}return a}if(i){const s=n(t.textures),a=n(t.images);s.length>0&&(r.textures=s),a.length>0&&(r.images=a)}return r}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const i=t.clippingPlanes;let r=null;if(i!==null){const n=i.length;r=new Array(n);for(let s=0;s!==n;++s)r[s]=i[s].clone()}return this.clippingPlanes=r,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}}const w9={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},yu={h:0,s:0,l:0},lM={h:0,s:0,l:0};function bP(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*6*(2/3-i):e}class qt{constructor(t,i,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,i===void 0&&r===void 0?this.set(t):this.setRGB(t,i,r)}set(t){return t&&t.isColor?this.copy(t):typeof t=="number"?this.setHex(t):typeof t=="string"&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,i=Iu){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,Ia.toWorkingColorSpace(this,i),this}setRGB(t,i,r,n=Ia.workingColorSpace){return this.r=t,this.g=i,this.b=r,Ia.toWorkingColorSpace(this,n),this}setHSL(t,i,r,n=Ia.workingColorSpace){if(t=lz(t,1),i=zn(i,0,1),r=zn(r,0,1),i===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+i):r+i-r*i,a=2*r-s;this.r=bP(a,s,t+1/3),this.g=bP(a,s,t),this.b=bP(a,s,t-1/3)}return Ia.toWorkingColorSpace(this,n),this}setStyle(t,i=Iu){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const a=n[1],o=n[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(s[1],10))/255,this.g=Math.min(255,parseInt(s[2],10))/255,this.b=Math.min(255,parseInt(s[3],10))/255,Ia.toWorkingColorSpace(this,i),r(s[4]),this;if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(s[1],10))/100,this.g=Math.min(100,parseInt(s[2],10))/100,this.b=Math.min(100,parseInt(s[3],10))/100,Ia.toWorkingColorSpace(this,i),r(s[4]),this;break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){const l=parseFloat(s[1])/360,u=parseFloat(s[2])/100,c=parseFloat(s[3])/100;return r(s[4]),this.setHSL(l,u,c,i)}break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=n[1],a=s.length;if(a===3)return this.r=parseInt(s.charAt(0)+s.charAt(0),16)/255,this.g=parseInt(s.charAt(1)+s.charAt(1),16)/255,this.b=parseInt(s.charAt(2)+s.charAt(2),16)/255,Ia.toWorkingColorSpace(this,i),this;if(a===6)return this.r=parseInt(s.charAt(0)+s.charAt(1),16)/255,this.g=parseInt(s.charAt(2)+s.charAt(3),16)/255,this.b=parseInt(s.charAt(4)+s.charAt(5),16)/255,Ia.toWorkingColorSpace(this,i),this;console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,i);return this}setColorName(t,i=Iu){const r=w9[t.toLowerCase()];return r!==void 0?this.setHex(r,i):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Fy(t.r),this.g=Fy(t.g),this.b=Fy(t.b),this}copyLinearToSRGB(t){return this.r=uP(t.r),this.g=uP(t.g),this.b=uP(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Iu){return Ia.fromWorkingColorSpace(Da.copy(this),t),zn(Da.r*255,0,255)<<16^zn(Da.g*255,0,255)<<8^zn(Da.b*255,0,255)<<0}getHexString(t=Iu){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,i=Ia.workingColorSpace){Ia.fromWorkingColorSpace(Da.copy(this),i);const r=Da.r,n=Da.g,s=Da.b,a=Math.max(r,n,s),o=Math.min(r,n,s);let l,u;const c=(o+a)/2;if(o===a)l=0,u=0;else{const h=a-o;switch(u=c<=.5?h/(a+o):h/(2-a-o),a){case r:l=(n-s)/h+(n<s?6:0);break;case n:l=(s-r)/h+2;break;case s:l=(r-n)/h+4;break}l/=6}return t.h=l,t.s=u,t.l=c,t}getRGB(t,i=Ia.workingColorSpace){return Ia.fromWorkingColorSpace(Da.copy(this),i),t.r=Da.r,t.g=Da.g,t.b=Da.b,t}getStyle(t=Iu){Ia.fromWorkingColorSpace(Da.copy(this),t);const i=Da.r,r=Da.g,n=Da.b;return t!==Iu?`color(${t} ${i.toFixed(3)} ${r.toFixed(3)} ${n.toFixed(3)})`:`rgb(${i*255|0},${r*255|0},${n*255|0})`}offsetHSL(t,i,r){return this.getHSL(yu),yu.h+=t,yu.s+=i,yu.l+=r,this.setHSL(yu.h,yu.s,yu.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,i){return this.r=t.r+i.r,this.g=t.g+i.g,this.b=t.b+i.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,i){return this.r+=(t.r-this.r)*i,this.g+=(t.g-this.g)*i,this.b+=(t.b-this.b)*i,this}lerpColors(t,i,r){return this.r=t.r+(i.r-t.r)*r,this.g=t.g+(i.g-t.g)*r,this.b=t.b+(i.b-t.b)*r,this}lerpHSL(t,i){this.getHSL(yu),t.getHSL(lM);const r=$w(yu.h,lM.h,i),n=$w(yu.s,lM.s,i),s=$w(yu.l,lM.l,i);return this.setHSL(r,n,s),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,i=0){return this.r=t[i],this.g=t[i+1],this.b=t[i+2],this}toArray(t=[],i=0){return t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t}fromBufferAttribute(t,i){return this.r=t.getX(i),this.g=t.getY(i),this.b=t.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Da=new qt;qt.NAMES=w9;class Up extends wa{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new qt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=w_,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const Qn=new pe,uM=new ft;class kr{constructor(t,i,r=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=i,this.count=t!==void 0?t.length/i:0,this.normalized=r,this.usage=Rb,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,i,r){t*=this.itemSize,r*=i.itemSize;for(let n=0,s=this.itemSize;n<s;n++)this.array[t+n]=i.array[r+n];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let i=0,r=this.count;i<r;i++)uM.fromBufferAttribute(this,i),uM.applyMatrix3(t),this.setXY(i,uM.x,uM.y);else if(this.itemSize===3)for(let i=0,r=this.count;i<r;i++)Qn.fromBufferAttribute(this,i),Qn.applyMatrix3(t),this.setXYZ(i,Qn.x,Qn.y,Qn.z);return this}applyMatrix4(t){for(let i=0,r=this.count;i<r;i++)Qn.fromBufferAttribute(this,i),Qn.applyMatrix4(t),this.setXYZ(i,Qn.x,Qn.y,Qn.z);return this}applyNormalMatrix(t){for(let i=0,r=this.count;i<r;i++)Qn.fromBufferAttribute(this,i),Qn.applyNormalMatrix(t),this.setXYZ(i,Qn.x,Qn.y,Qn.z);return this}transformDirection(t){for(let i=0,r=this.count;i<r;i++)Qn.fromBufferAttribute(this,i),Qn.transformDirection(t),this.setXYZ(i,Qn.x,Qn.y,Qn.z);return this}set(t,i=0){return this.array.set(t,i),this}getX(t){let i=this.array[t*this.itemSize];return this.normalized&&(i=pd(i,this.array)),i}setX(t,i){return this.normalized&&(i=Lr(i,this.array)),this.array[t*this.itemSize]=i,this}getY(t){let i=this.array[t*this.itemSize+1];return this.normalized&&(i=pd(i,this.array)),i}setY(t,i){return this.normalized&&(i=Lr(i,this.array)),this.array[t*this.itemSize+1]=i,this}getZ(t){let i=this.array[t*this.itemSize+2];return this.normalized&&(i=pd(i,this.array)),i}setZ(t,i){return this.normalized&&(i=Lr(i,this.array)),this.array[t*this.itemSize+2]=i,this}getW(t){let i=this.array[t*this.itemSize+3];return this.normalized&&(i=pd(i,this.array)),i}setW(t,i){return this.normalized&&(i=Lr(i,this.array)),this.array[t*this.itemSize+3]=i,this}setXY(t,i,r){return t*=this.itemSize,this.normalized&&(i=Lr(i,this.array),r=Lr(r,this.array)),this.array[t+0]=i,this.array[t+1]=r,this}setXYZ(t,i,r,n){return t*=this.itemSize,this.normalized&&(i=Lr(i,this.array),r=Lr(r,this.array),n=Lr(n,this.array)),this.array[t+0]=i,this.array[t+1]=r,this.array[t+2]=n,this}setXYZW(t,i,r,n,s){return t*=this.itemSize,this.normalized&&(i=Lr(i,this.array),r=Lr(r,this.array),n=Lr(n,this.array),s=Lr(s,this.array)),this.array[t+0]=i,this.array[t+1]=r,this.array[t+2]=n,this.array[t+3]=s,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==Rb&&(t.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(t.updateRange=this.updateRange),t}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class Tie extends kr{constructor(t,i,r){super(new Int8Array(t),i,r)}}class Pie extends kr{constructor(t,i,r){super(new Uint8Array(t),i,r)}}class Die extends kr{constructor(t,i,r){super(new Uint8ClampedArray(t),i,r)}}class Rie extends kr{constructor(t,i,r){super(new Int16Array(t),i,r)}}class hz extends kr{constructor(t,i,r){super(new Uint16Array(t),i,r)}}class Iie extends kr{constructor(t,i,r){super(new Int32Array(t),i,r)}}class dz extends kr{constructor(t,i,r){super(new Uint32Array(t),i,r)}}class Lie extends kr{constructor(t,i,r){super(new Uint16Array(t),i,r),this.isFloat16BufferAttribute=!0}}class Jt extends kr{constructor(t,i,r){super(new Float32Array(t),i,r)}}class Oie extends kr{constructor(t,i,r){super(new Float64Array(t),i,r)}}let zie=0;const El=new Oi,_P=new ur,_0=new pe,sl=new ev,X1=new ev,Os=new pe;class Fi extends Fd{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:zie++}),this.uuid=hl(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(x9(t)?dz:hz)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,i){return this.attributes[t]=i,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,i,r=0){this.groups.push({start:t,count:i,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(t,i){this.drawRange.start=t,this.drawRange.count=i}applyMatrix4(t){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(t),i.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const s=new ma().getNormalMatrix(t);r.applyNormalMatrix(s),r.needsUpdate=!0}const n=this.attributes.tangent;return n!==void 0&&(n.transformDirection(t),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return El.makeRotationFromQuaternion(t),this.applyMatrix4(El),this}rotateX(t){return El.makeRotationX(t),this.applyMatrix4(El),this}rotateY(t){return El.makeRotationY(t),this.applyMatrix4(El),this}rotateZ(t){return El.makeRotationZ(t),this.applyMatrix4(El),this}translate(t,i,r){return El.makeTranslation(t,i,r),this.applyMatrix4(El),this}scale(t,i,r){return El.makeScale(t,i,r),this.applyMatrix4(El),this}lookAt(t){return _P.lookAt(t),_P.updateMatrix(),this.applyMatrix4(_P.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(_0).negate(),this.translate(_0.x,_0.y,_0.z),this}setFromPoints(t){const i=[];for(let r=0,n=t.length;r<n;r++){const s=t[r];i.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new Jt(i,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ev);const t=this.attributes.position,i=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new pe(-1/0,-1/0,-1/0),new pe(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),i)for(let r=0,n=i.length;r<n;r++){const s=i[r];sl.setFromBufferAttribute(s),this.morphTargetsRelative?(Os.addVectors(this.boundingBox.min,sl.min),this.boundingBox.expandByPoint(Os),Os.addVectors(this.boundingBox.max,sl.max),this.boundingBox.expandByPoint(Os)):(this.boundingBox.expandByPoint(sl.min),this.boundingBox.expandByPoint(sl.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new tv);const t=this.attributes.position,i=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new pe,1/0);return}if(t){const r=this.boundingSphere.center;if(sl.setFromBufferAttribute(t),i)for(let s=0,a=i.length;s<a;s++){const o=i[s];X1.setFromBufferAttribute(o),this.morphTargetsRelative?(Os.addVectors(sl.min,X1.min),sl.expandByPoint(Os),Os.addVectors(sl.max,X1.max),sl.expandByPoint(Os)):(sl.expandByPoint(X1.min),sl.expandByPoint(X1.max))}sl.getCenter(r);let n=0;for(let s=0,a=t.count;s<a;s++)Os.fromBufferAttribute(t,s),n=Math.max(n,r.distanceToSquared(Os));if(i)for(let s=0,a=i.length;s<a;s++){const o=i[s],l=this.morphTargetsRelative;for(let u=0,c=o.count;u<c;u++)Os.fromBufferAttribute(o,u),l&&(_0.fromBufferAttribute(t,u),Os.add(_0)),n=Math.max(n,r.distanceToSquared(Os))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,i=this.attributes;if(t===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=t.array,n=i.position.array,s=i.normal.array,a=i.uv.array,o=n.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new kr(new Float32Array(4*o),4));const l=this.getAttribute("tangent").array,u=[],c=[];for(let L=0;L<o;L++)u[L]=new pe,c[L]=new pe;const h=new pe,d=new pe,p=new pe,m=new ft,v=new ft,g=new ft,w=new pe,S=new pe;function _(L,z,G){h.fromArray(n,L*3),d.fromArray(n,z*3),p.fromArray(n,G*3),m.fromArray(a,L*2),v.fromArray(a,z*2),g.fromArray(a,G*2),d.sub(h),p.sub(h),v.sub(m),g.sub(m);const V=1/(v.x*g.y-g.x*v.y);isFinite(V)&&(w.copy(d).multiplyScalar(g.y).addScaledVector(p,-v.y).multiplyScalar(V),S.copy(p).multiplyScalar(v.x).addScaledVector(d,-g.x).multiplyScalar(V),u[L].add(w),u[z].add(w),u[G].add(w),c[L].add(S),c[z].add(S),c[G].add(S))}let A=this.groups;A.length===0&&(A=[{start:0,count:r.length}]);for(let L=0,z=A.length;L<z;++L){const G=A[L],V=G.start,j=G.count;for(let J=V,ne=V+j;J<ne;J+=3)_(r[J+0],r[J+1],r[J+2])}const C=new pe,E=new pe,I=new pe,T=new pe;function D(L){I.fromArray(s,L*3),T.copy(I);const z=u[L];C.copy(z),C.sub(I.multiplyScalar(I.dot(z))).normalize(),E.crossVectors(T,z);const V=E.dot(c[L])<0?-1:1;l[L*4]=C.x,l[L*4+1]=C.y,l[L*4+2]=C.z,l[L*4+3]=V}for(let L=0,z=A.length;L<z;++L){const G=A[L],V=G.start,j=G.count;for(let J=V,ne=V+j;J<ne;J+=3)D(r[J+0]),D(r[J+1]),D(r[J+2])}}computeVertexNormals(){const t=this.index,i=this.getAttribute("position");if(i!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new kr(new Float32Array(i.count*3),3),this.setAttribute("normal",r);else for(let d=0,p=r.count;d<p;d++)r.setXYZ(d,0,0,0);const n=new pe,s=new pe,a=new pe,o=new pe,l=new pe,u=new pe,c=new pe,h=new pe;if(t)for(let d=0,p=t.count;d<p;d+=3){const m=t.getX(d+0),v=t.getX(d+1),g=t.getX(d+2);n.fromBufferAttribute(i,m),s.fromBufferAttribute(i,v),a.fromBufferAttribute(i,g),c.subVectors(a,s),h.subVectors(n,s),c.cross(h),o.fromBufferAttribute(r,m),l.fromBufferAttribute(r,v),u.fromBufferAttribute(r,g),o.add(c),l.add(c),u.add(c),r.setXYZ(m,o.x,o.y,o.z),r.setXYZ(v,l.x,l.y,l.z),r.setXYZ(g,u.x,u.y,u.z)}else for(let d=0,p=i.count;d<p;d+=3)n.fromBufferAttribute(i,d+0),s.fromBufferAttribute(i,d+1),a.fromBufferAttribute(i,d+2),c.subVectors(a,s),h.subVectors(n,s),c.cross(h),r.setXYZ(d+0,c.x,c.y,c.z),r.setXYZ(d+1,c.x,c.y,c.z),r.setXYZ(d+2,c.x,c.y,c.z);this.normalizeNormals(),r.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const t=this.attributes.normal;for(let i=0,r=t.count;i<r;i++)Os.fromBufferAttribute(t,i),Os.normalize(),t.setXYZ(i,Os.x,Os.y,Os.z)}toNonIndexed(){function t(o,l){const u=o.array,c=o.itemSize,h=o.normalized,d=new u.constructor(l.length*c);let p=0,m=0;for(let v=0,g=l.length;v<g;v++){o.isInterleavedBufferAttribute?p=l[v]*o.data.stride+o.offset:p=l[v]*c;for(let w=0;w<c;w++)d[m++]=u[p++]}return new kr(d,c,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new Fi,r=this.index.array,n=this.attributes;for(const o in n){const l=n[o],u=t(l,r);i.setAttribute(o,u)}const s=this.morphAttributes;for(const o in s){const l=[],u=s[o];for(let c=0,h=u.length;c<h;c++){const d=u[c],p=t(d,r);l.push(p)}i.morphAttributes[o]=l}i.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,l=a.length;o<l;o++){const u=a[o];i.addGroup(u.start,u.count,u.materialIndex)}return i}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const u in l)l[u]!==void 0&&(t[u]=l[u]);return t}t.data={attributes:{}};const i=this.index;i!==null&&(t.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const r=this.attributes;for(const l in r){const u=r[l];t.data.attributes[l]=u.toJSON(t.data)}const n={};let s=!1;for(const l in this.morphAttributes){const u=this.morphAttributes[l],c=[];for(let h=0,d=u.length;h<d;h++){const p=u[h];c.push(p.toJSON(t.data))}c.length>0&&(n[l]=c,s=!0)}s&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=t.name;const r=t.index;r!==null&&this.setIndex(r.clone(i));const n=t.attributes;for(const u in n){const c=n[u];this.setAttribute(u,c.clone(i))}const s=t.morphAttributes;for(const u in s){const c=[],h=s[u];for(let d=0,p=h.length;d<p;d++)c.push(h[d].clone(i));this.morphAttributes[u]=c}this.morphTargetsRelative=t.morphTargetsRelative;const a=t.groups;for(let u=0,c=a.length;u<c;u++){const h=a[u];this.addGroup(h.start,h.count,h.materialIndex)}const o=t.boundingBox;o!==null&&(this.boundingBox=o.clone());const l=t.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const AF=new Oi,mc=new Cx,cM=new tv,EF=new pe,Y1=new pe,Q1=new pe,K1=new pe,SP=new pe,hM=new pe,dM=new ft,fM=new ft,pM=new ft,MP=new pe,mM=new pe;class js extends ur{constructor(t=new Fi,i=new Up){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=i,this.updateMorphTargets()}copy(t,i){return super.copy(t,i),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const i=this.geometry.morphAttributes,r=Object.keys(i);if(r.length>0){const n=i[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++){const o=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}getVertexPosition(t,i){const r=this.geometry,n=r.attributes.position,s=r.morphAttributes.position,a=r.morphTargetsRelative;i.fromBufferAttribute(n,t);const o=this.morphTargetInfluences;if(s&&o){hM.set(0,0,0);for(let l=0,u=s.length;l<u;l++){const c=o[l],h=s[l];c!==0&&(SP.fromBufferAttribute(h,t),a?hM.addScaledVector(SP,c):hM.addScaledVector(SP.sub(i),c))}i.add(hM)}return this.isSkinnedMesh&&this.boneTransform(t,i),i}raycast(t,i){const r=this.geometry,n=this.material,s=this.matrixWorld;if(n===void 0||(r.boundingSphere===null&&r.computeBoundingSphere(),cM.copy(r.boundingSphere),cM.applyMatrix4(s),mc.copy(t.ray).recast(t.near),cM.containsPoint(mc.origin)===!1&&(mc.intersectSphere(cM,EF)===null||mc.origin.distanceToSquared(EF)>(t.far-t.near)**2))||(AF.copy(s).invert(),mc.copy(t.ray).applyMatrix4(AF),r.boundingBox!==null&&mc.intersectsBox(r.boundingBox)===!1))return;let a;const o=r.index,l=r.attributes.position,u=r.attributes.uv,c=r.attributes.uv2,h=r.groups,d=r.drawRange;if(o!==null)if(Array.isArray(n))for(let p=0,m=h.length;p<m;p++){const v=h[p],g=n[v.materialIndex],w=Math.max(v.start,d.start),S=Math.min(o.count,Math.min(v.start+v.count,d.start+d.count));for(let _=w,A=S;_<A;_+=3){const C=o.getX(_),E=o.getX(_+1),I=o.getX(_+2);a=gM(this,g,t,mc,u,c,C,E,I),a&&(a.faceIndex=Math.floor(_/3),a.face.materialIndex=v.materialIndex,i.push(a))}}else{const p=Math.max(0,d.start),m=Math.min(o.count,d.start+d.count);for(let v=p,g=m;v<g;v+=3){const w=o.getX(v),S=o.getX(v+1),_=o.getX(v+2);a=gM(this,n,t,mc,u,c,w,S,_),a&&(a.faceIndex=Math.floor(v/3),i.push(a))}}else if(l!==void 0)if(Array.isArray(n))for(let p=0,m=h.length;p<m;p++){const v=h[p],g=n[v.materialIndex],w=Math.max(v.start,d.start),S=Math.min(l.count,Math.min(v.start+v.count,d.start+d.count));for(let _=w,A=S;_<A;_+=3){const C=_,E=_+1,I=_+2;a=gM(this,g,t,mc,u,c,C,E,I),a&&(a.faceIndex=Math.floor(_/3),a.face.materialIndex=v.materialIndex,i.push(a))}}else{const p=Math.max(0,d.start),m=Math.min(l.count,d.start+d.count);for(let v=p,g=m;v<g;v+=3){const w=v,S=v+1,_=v+2;a=gM(this,n,t,mc,u,c,w,S,_),a&&(a.faceIndex=Math.floor(v/3),i.push(a))}}}}function kie(e,t,i,r,n,s,a,o){let l;if(t.side===jo?l=r.intersectTriangle(a,s,n,!0,o):l=r.intersectTriangle(n,s,a,t.side===Ed,o),l===null)return null;mM.copy(o),mM.applyMatrix4(e.matrixWorld);const u=i.ray.origin.distanceTo(mM);return u<i.near||u>i.far?null:{distance:u,point:mM.clone(),object:e}}function gM(e,t,i,r,n,s,a,o,l){e.getVertexPosition(a,Y1),e.getVertexPosition(o,Q1),e.getVertexPosition(l,K1);const u=kie(e,t,i,r,Y1,Q1,K1,MP);if(u){n&&(dM.fromBufferAttribute(n,a),fM.fromBufferAttribute(n,o),pM.fromBufferAttribute(n,l),u.uv=Vl.getUV(MP,Y1,Q1,K1,dM,fM,pM,new ft)),s&&(dM.fromBufferAttribute(s,a),fM.fromBufferAttribute(s,o),pM.fromBufferAttribute(s,l),u.uv2=Vl.getUV(MP,Y1,Q1,K1,dM,fM,pM,new ft));const c={a,b:o,c:l,normal:new pe,materialIndex:0};Vl.getNormal(Y1,Q1,K1,c.normal),u.face=c}return u}class Vp extends Fi{constructor(t=1,i=1,r=1,n=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:i,depth:r,widthSegments:n,heightSegments:s,depthSegments:a};const o=this;n=Math.floor(n),s=Math.floor(s),a=Math.floor(a);const l=[],u=[],c=[],h=[];let d=0,p=0;m("z","y","x",-1,-1,r,i,t,a,s,0),m("z","y","x",1,-1,r,i,-t,a,s,1),m("x","z","y",1,1,t,r,i,n,a,2),m("x","z","y",1,-1,t,r,-i,n,a,3),m("x","y","z",1,-1,t,i,r,n,s,4),m("x","y","z",-1,-1,t,i,-r,n,s,5),this.setIndex(l),this.setAttribute("position",new Jt(u,3)),this.setAttribute("normal",new Jt(c,3)),this.setAttribute("uv",new Jt(h,2));function m(v,g,w,S,_,A,C,E,I,T,D){const L=A/I,z=C/T,G=A/2,V=C/2,j=E/2,J=I+1,ne=T+1;let K=0,B=0;const Z=new pe;for(let F=0;F<ne;F++){const X=F*z-V;for(let Y=0;Y<J;Y++){const le=Y*L-G;Z[v]=le*S,Z[g]=X*_,Z[w]=j,u.push(Z.x,Z.y,Z.z),Z[v]=0,Z[g]=0,Z[w]=E>0?1:-1,c.push(Z.x,Z.y,Z.z),h.push(Y/I),h.push(1-F/T),K+=1}}for(let F=0;F<T;F++)for(let X=0;X<I;X++){const Y=d+X+J*F,le=d+X+J*(F+1),oe=d+(X+1)+J*(F+1),re=d+(X+1)+J*F;l.push(Y,le,re),l.push(le,oe,re),B+=6}o.addGroup(p,B,D),p+=B,d+=K}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Vp(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function ix(e){const t={};for(const i in e){t[i]={};for(const r in e[i]){const n=e[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?t[i][r]=n.clone():Array.isArray(n)?t[i][r]=n.slice():t[i][r]=n}}return t}function io(e){const t={};for(let i=0;i<e.length;i++){const r=ix(e[i]);for(const n in r)t[n]=r[n]}return t}function Bie(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].clone());return t}function b9(e){return e.getRenderTarget()===null&&e.outputEncoding===Ur?Iu:tx}const _9={clone:ix,merge:io};var Nie=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Fie=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Kc extends wa{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Nie,this.fragmentShader=Fie,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=ix(t.uniforms),this.uniformsGroups=Bie(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const i=super.toJSON(t);i.glslVersion=this.glslVersion,i.uniforms={};for(const n in this.uniforms){const a=this.uniforms[n].value;a&&a.isTexture?i.uniforms[n]={type:"t",value:a.toJSON(t).uuid}:a&&a.isColor?i.uniforms[n]={type:"c",value:a.getHex()}:a&&a.isVector2?i.uniforms[n]={type:"v2",value:a.toArray()}:a&&a.isVector3?i.uniforms[n]={type:"v3",value:a.toArray()}:a&&a.isVector4?i.uniforms[n]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?i.uniforms[n]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?i.uniforms[n]={type:"m4",value:a.toArray()}:i.uniforms[n]={value:a}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader;const r={};for(const n in this.extensions)this.extensions[n]===!0&&(r[n]=!0);return Object.keys(r).length>0&&(i.extensions=r),i}}class b_ extends ur{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Oi,this.projectionMatrix=new Oi,this.projectionMatrixInverse=new Oi}copy(t,i){return super.copy(t,i),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return t.set(-i[8],-i[9],-i[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,i){super.updateWorldMatrix(t,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class on extends b_{constructor(t=50,i=1,r=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=r,this.far=n,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,i){return super.copy(t,i),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const i=.5*this.getFilmHeight()/t;this.fov=Ib*2*Math.atan(i),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(Eg*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return Ib*2*Math.atan(Math.tan(Eg*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,i,r,n,s,a){this.aspect=t/i,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=i,this.view.offsetX=r,this.view.offsetY=n,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let i=t*Math.tan(Eg*.5*this.fov)/this.zoom,r=2*i,n=this.aspect*r,s=-.5*n;const a=this.view;if(this.view!==null&&this.view.enabled){const l=a.fullWidth,u=a.fullHeight;s+=a.offsetX*n/l,i-=a.offsetY*r/u,n*=a.width/l,r*=a.height/u}const o=this.filmOffset;o!==0&&(s+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,i,i-r,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const i=super.toJSON(t);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,this.view!==null&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}}const S0=-90,M0=1;class fz extends ur{constructor(t,i,r){super(),this.type="CubeCamera",this.renderTarget=r;const n=new on(S0,M0,t,i);n.layers=this.layers,n.up.set(0,1,0),n.lookAt(1,0,0),this.add(n);const s=new on(S0,M0,t,i);s.layers=this.layers,s.up.set(0,1,0),s.lookAt(-1,0,0),this.add(s);const a=new on(S0,M0,t,i);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(0,1,0),this.add(a);const o=new on(S0,M0,t,i);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(0,-1,0),this.add(o);const l=new on(S0,M0,t,i);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,1),this.add(l);const u=new on(S0,M0,t,i);u.layers=this.layers,u.up.set(0,1,0),u.lookAt(0,0,-1),this.add(u)}update(t,i){this.parent===null&&this.updateMatrixWorld();const r=this.renderTarget,[n,s,a,o,l,u]=this.children,c=t.getRenderTarget(),h=t.toneMapping,d=t.xr.enabled;t.toneMapping=Nu,t.xr.enabled=!1;const p=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,t.setRenderTarget(r,0),t.render(i,n),t.setRenderTarget(r,1),t.render(i,s),t.setRenderTarget(r,2),t.render(i,a),t.setRenderTarget(r,3),t.render(i,o),t.setRenderTarget(r,4),t.render(i,l),r.texture.generateMipmaps=p,t.setRenderTarget(r,5),t.render(i,u),t.setRenderTarget(c),t.toneMapping=h,t.xr.enabled=d,r.texture.needsPMREMUpdate=!0}}class __ extends _n{constructor(t,i,r,n,s,a,o,l,u,c){t=t!==void 0?t:[],i=i!==void 0?i:Cp,super(t,i,r,n,s,a,o,l,u,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class pz extends Vu{constructor(t=1,i={}){super(t,t,i),this.isWebGLCubeRenderTarget=!0;const r={width:t,height:t,depth:1},n=[r,r,r,r,r,r];this.texture=new __(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:On}fromEquirectangularTexture(t,i){this.texture.type=i.type,this.texture.encoding=i.encoding,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},n=new Vp(5,5,5),s=new Kc({name:"CubemapFromEquirect",uniforms:ix(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:jo,blending:_d});s.uniforms.tEquirect.value=i;const a=new js(n,s),o=i.minFilter;return i.minFilter===Pp&&(i.minFilter=On),new fz(1,10,this).update(t,a),i.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(t,i,r,n){const s=t.getRenderTarget();for(let a=0;a<6;a++)t.setRenderTarget(this,a),t.clear(i,r,n);t.setRenderTarget(s)}}const AP=new pe,Uie=new pe,Vie=new ma;class rd{constructor(t=new pe(1,0,0),i=0){this.isPlane=!0,this.normal=t,this.constant=i}set(t,i){return this.normal.copy(t),this.constant=i,this}setComponents(t,i,r,n){return this.normal.set(t,i,r),this.constant=n,this}setFromNormalAndCoplanarPoint(t,i){return this.normal.copy(t),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(t,i,r){const n=AP.subVectors(r,i).cross(Uie.subVectors(t,i)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,i){return i.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,i){const r=t.delta(AP),n=this.normal.dot(r);if(n===0)return this.distanceToPoint(t.start)===0?i.copy(t.start):null;const s=-(t.start.dot(this.normal)+this.constant)/n;return s<0||s>1?null:i.copy(t.start).addScaledVector(r,s)}intersectsLine(t){const i=this.distanceToPoint(t.start),r=this.distanceToPoint(t.end);return i<0&&r>0||r<0&&i>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,i){const r=i||Vie.getNormalMatrix(t),n=this.coplanarPoint(AP).applyMatrix4(t),s=this.normal.applyMatrix3(r).normalize();return this.constant=-n.dot(s),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}const A0=new tv,vM=new pe;class TC{constructor(t=new rd,i=new rd,r=new rd,n=new rd,s=new rd,a=new rd){this.planes=[t,i,r,n,s,a]}set(t,i,r,n,s,a){const o=this.planes;return o[0].copy(t),o[1].copy(i),o[2].copy(r),o[3].copy(n),o[4].copy(s),o[5].copy(a),this}copy(t){const i=this.planes;for(let r=0;r<6;r++)i[r].copy(t.planes[r]);return this}setFromProjectionMatrix(t){const i=this.planes,r=t.elements,n=r[0],s=r[1],a=r[2],o=r[3],l=r[4],u=r[5],c=r[6],h=r[7],d=r[8],p=r[9],m=r[10],v=r[11],g=r[12],w=r[13],S=r[14],_=r[15];return i[0].setComponents(o-n,h-l,v-d,_-g).normalize(),i[1].setComponents(o+n,h+l,v+d,_+g).normalize(),i[2].setComponents(o+s,h+u,v+p,_+w).normalize(),i[3].setComponents(o-s,h-u,v-p,_-w).normalize(),i[4].setComponents(o-a,h-c,v-m,_-S).normalize(),i[5].setComponents(o+a,h+c,v+m,_+S).normalize(),this}intersectsObject(t){const i=t.geometry;return i.boundingSphere===null&&i.computeBoundingSphere(),A0.copy(i.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(A0)}intersectsSprite(t){return A0.center.set(0,0,0),A0.radius=.7071067811865476,A0.applyMatrix4(t.matrixWorld),this.intersectsSphere(A0)}intersectsSphere(t){const i=this.planes,r=t.center,n=-t.radius;for(let s=0;s<6;s++)if(i[s].distanceToPoint(r)<n)return!1;return!0}intersectsBox(t){const i=this.planes;for(let r=0;r<6;r++){const n=i[r];if(vM.x=n.normal.x>0?t.max.x:t.min.x,vM.y=n.normal.y>0?t.max.y:t.min.y,vM.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(vM)<0)return!1}return!0}containsPoint(t){const i=this.planes;for(let r=0;r<6;r++)if(i[r].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function S9(){let e=null,t=!1,i=null,r=null;function n(s,a){i(s,a),r=e.requestAnimationFrame(n)}return{start:function(){t!==!0&&i!==null&&(r=e.requestAnimationFrame(n),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(s){i=s},setContext:function(s){e=s}}}function jie(e,t){const i=t.isWebGL2,r=new WeakMap;function n(u,c){const h=u.array,d=u.usage,p=e.createBuffer();e.bindBuffer(c,p),e.bufferData(c,h,d),u.onUploadCallback();let m;if(h instanceof Float32Array)m=5126;else if(h instanceof Uint16Array)if(u.isFloat16BufferAttribute)if(i)m=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else m=5123;else if(h instanceof Int16Array)m=5122;else if(h instanceof Uint32Array)m=5125;else if(h instanceof Int32Array)m=5124;else if(h instanceof Int8Array)m=5120;else if(h instanceof Uint8Array)m=5121;else if(h instanceof Uint8ClampedArray)m=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:p,type:m,bytesPerElement:h.BYTES_PER_ELEMENT,version:u.version}}function s(u,c,h){const d=c.array,p=c.updateRange;e.bindBuffer(h,u),p.count===-1?e.bufferSubData(h,0,d):(i?e.bufferSubData(h,p.offset*d.BYTES_PER_ELEMENT,d,p.offset,p.count):e.bufferSubData(h,p.offset*d.BYTES_PER_ELEMENT,d.subarray(p.offset,p.offset+p.count)),p.count=-1),c.onUploadCallback()}function a(u){return u.isInterleavedBufferAttribute&&(u=u.data),r.get(u)}function o(u){u.isInterleavedBufferAttribute&&(u=u.data);const c=r.get(u);c&&(e.deleteBuffer(c.buffer),r.delete(u))}function l(u,c){if(u.isGLBufferAttribute){const d=r.get(u);(!d||d.version<u.version)&&r.set(u,{buffer:u.buffer,type:u.type,bytesPerElement:u.elementSize,version:u.version});return}u.isInterleavedBufferAttribute&&(u=u.data);const h=r.get(u);h===void 0?r.set(u,n(u,c)):h.version<u.version&&(s(h.buffer,u,c),h.version=u.version)}return{get:a,remove:o,update:l}}class Tx extends Fi{constructor(t=1,i=1,r=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:i,widthSegments:r,heightSegments:n};const s=t/2,a=i/2,o=Math.floor(r),l=Math.floor(n),u=o+1,c=l+1,h=t/o,d=i/l,p=[],m=[],v=[],g=[];for(let w=0;w<c;w++){const S=w*d-a;for(let _=0;_<u;_++){const A=_*h-s;m.push(A,-S,0),v.push(0,0,1),g.push(_/o),g.push(1-w/l)}}for(let w=0;w<l;w++)for(let S=0;S<o;S++){const _=S+u*w,A=S+u*(w+1),C=S+1+u*(w+1),E=S+1+u*w;p.push(_,A,E),p.push(A,C,E)}this.setIndex(p),this.setAttribute("position",new Jt(m,3)),this.setAttribute("normal",new Jt(v,3)),this.setAttribute("uv",new Jt(g,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Tx(t.width,t.height,t.widthSegments,t.heightSegments)}}var Hie=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,Wie=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Gie=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,qie=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Xie=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,Yie=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Qie="vec3 transformed = vec3( position );",Kie=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,Zie=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,Jie=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,$ie=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,ere=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,tre=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,ire=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,rre=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,nre=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,sre=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,are=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,ore=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,lre=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,ure=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,cre=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,hre=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,dre=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,fre=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,pre=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,mre="gl_FragColor = linearToOutputTexel( gl_FragColor );",gre=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,vre=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,yre=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,xre=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,wre=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,bre=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,_re=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Sre=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Mre=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Are=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Ere=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,Cre=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,Tre=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Pre=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Dre=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,Rre=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Ire=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,Lre=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Ore=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,zre=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,kre=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,Bre=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,Nre=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Fre=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Ure=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Vre=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,jre=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Hre=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Wre=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,Gre=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,qre=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,Xre=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,Yre=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,Qre=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Kre=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,Zre=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,Jre=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,$re=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,ene=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,tne=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,ine=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,rne=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,nne=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,sne=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,ane=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,one=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,lne=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,une=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,cne=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,hne=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,dne=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,fne=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,pne=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,mne=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,gne=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,vne=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,yne=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,xne=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,wne=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,bne=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,_ne=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,Sne=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Mne=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Ane=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,Ene=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Cne=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Tne=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Pne=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Dne=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Rne=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,Ine=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,Lne=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, vec2 fullSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		
		vec2 lodFudge = pow( 1.95, lod ) / fullSize;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec2 fullSize = vec2( textureSize( sampler, 0 ) );
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), fullSize, floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), fullSize, ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,One=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,zne=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,kne=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,Bne=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,Nne=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,Fne=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,Une=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const Vne=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,jne=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Hne=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Wne=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Gne=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,qne=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Xne=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,Yne=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,Qne=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,Kne=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,Zne=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,Jne=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,$ne=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,ese=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,tse=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,ise=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,rse=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,nse=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,sse=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,ase=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ose=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,lse=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,use=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,cse=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,hse=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,dse=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,fse=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,pse=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,mse=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,gse=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vse=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,yse=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,xse=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,wse=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Vi={alphamap_fragment:Hie,alphamap_pars_fragment:Wie,alphatest_fragment:Gie,alphatest_pars_fragment:qie,aomap_fragment:Xie,aomap_pars_fragment:Yie,begin_vertex:Qie,beginnormal_vertex:Kie,bsdfs:Zie,iridescence_fragment:Jie,bumpmap_pars_fragment:$ie,clipping_planes_fragment:ere,clipping_planes_pars_fragment:tre,clipping_planes_pars_vertex:ire,clipping_planes_vertex:rre,color_fragment:nre,color_pars_fragment:sre,color_pars_vertex:are,color_vertex:ore,common:lre,cube_uv_reflection_fragment:ure,defaultnormal_vertex:cre,displacementmap_pars_vertex:hre,displacementmap_vertex:dre,emissivemap_fragment:fre,emissivemap_pars_fragment:pre,encodings_fragment:mre,encodings_pars_fragment:gre,envmap_fragment:vre,envmap_common_pars_fragment:yre,envmap_pars_fragment:xre,envmap_pars_vertex:wre,envmap_physical_pars_fragment:Ire,envmap_vertex:bre,fog_vertex:_re,fog_pars_vertex:Sre,fog_fragment:Mre,fog_pars_fragment:Are,gradientmap_pars_fragment:Ere,lightmap_fragment:Cre,lightmap_pars_fragment:Tre,lights_lambert_fragment:Pre,lights_lambert_pars_fragment:Dre,lights_pars_begin:Rre,lights_toon_fragment:Lre,lights_toon_pars_fragment:Ore,lights_phong_fragment:zre,lights_phong_pars_fragment:kre,lights_physical_fragment:Bre,lights_physical_pars_fragment:Nre,lights_fragment_begin:Fre,lights_fragment_maps:Ure,lights_fragment_end:Vre,logdepthbuf_fragment:jre,logdepthbuf_pars_fragment:Hre,logdepthbuf_pars_vertex:Wre,logdepthbuf_vertex:Gre,map_fragment:qre,map_pars_fragment:Xre,map_particle_fragment:Yre,map_particle_pars_fragment:Qre,metalnessmap_fragment:Kre,metalnessmap_pars_fragment:Zre,morphcolor_vertex:Jre,morphnormal_vertex:$re,morphtarget_pars_vertex:ene,morphtarget_vertex:tne,normal_fragment_begin:ine,normal_fragment_maps:rne,normal_pars_fragment:nne,normal_pars_vertex:sne,normal_vertex:ane,normalmap_pars_fragment:one,clearcoat_normal_fragment_begin:lne,clearcoat_normal_fragment_maps:une,clearcoat_pars_fragment:cne,iridescence_pars_fragment:hne,output_fragment:dne,packing:fne,premultiplied_alpha_fragment:pne,project_vertex:mne,dithering_fragment:gne,dithering_pars_fragment:vne,roughnessmap_fragment:yne,roughnessmap_pars_fragment:xne,shadowmap_pars_fragment:wne,shadowmap_pars_vertex:bne,shadowmap_vertex:_ne,shadowmask_pars_fragment:Sne,skinbase_vertex:Mne,skinning_pars_vertex:Ane,skinning_vertex:Ene,skinnormal_vertex:Cne,specularmap_fragment:Tne,specularmap_pars_fragment:Pne,tonemapping_fragment:Dne,tonemapping_pars_fragment:Rne,transmission_fragment:Ine,transmission_pars_fragment:Lne,uv_pars_fragment:One,uv_pars_vertex:zne,uv_vertex:kne,uv2_pars_fragment:Bne,uv2_pars_vertex:Nne,uv2_vertex:Fne,worldpos_vertex:Une,background_vert:Vne,background_frag:jne,backgroundCube_vert:Hne,backgroundCube_frag:Wne,cube_vert:Gne,cube_frag:qne,depth_vert:Xne,depth_frag:Yne,distanceRGBA_vert:Qne,distanceRGBA_frag:Kne,equirect_vert:Zne,equirect_frag:Jne,linedashed_vert:$ne,linedashed_frag:ese,meshbasic_vert:tse,meshbasic_frag:ise,meshlambert_vert:rse,meshlambert_frag:nse,meshmatcap_vert:sse,meshmatcap_frag:ase,meshnormal_vert:ose,meshnormal_frag:lse,meshphong_vert:use,meshphong_frag:cse,meshphysical_vert:hse,meshphysical_frag:dse,meshtoon_vert:fse,meshtoon_frag:pse,points_vert:mse,points_frag:gse,shadow_vert:vse,shadow_frag:yse,sprite_vert:xse,sprite_frag:wse},Bt={common:{diffuse:{value:new qt(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new ma},uv2Transform:{value:new ma},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new ft(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new qt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new qt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ma}},sprite:{diffuse:{value:new qt(16777215)},opacity:{value:1},center:{value:new ft(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ma}}},Lu={basic:{uniforms:io([Bt.common,Bt.specularmap,Bt.envmap,Bt.aomap,Bt.lightmap,Bt.fog]),vertexShader:Vi.meshbasic_vert,fragmentShader:Vi.meshbasic_frag},lambert:{uniforms:io([Bt.common,Bt.specularmap,Bt.envmap,Bt.aomap,Bt.lightmap,Bt.emissivemap,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.fog,Bt.lights,{emissive:{value:new qt(0)}}]),vertexShader:Vi.meshlambert_vert,fragmentShader:Vi.meshlambert_frag},phong:{uniforms:io([Bt.common,Bt.specularmap,Bt.envmap,Bt.aomap,Bt.lightmap,Bt.emissivemap,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.fog,Bt.lights,{emissive:{value:new qt(0)},specular:{value:new qt(1118481)},shininess:{value:30}}]),vertexShader:Vi.meshphong_vert,fragmentShader:Vi.meshphong_frag},standard:{uniforms:io([Bt.common,Bt.envmap,Bt.aomap,Bt.lightmap,Bt.emissivemap,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.roughnessmap,Bt.metalnessmap,Bt.fog,Bt.lights,{emissive:{value:new qt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Vi.meshphysical_vert,fragmentShader:Vi.meshphysical_frag},toon:{uniforms:io([Bt.common,Bt.aomap,Bt.lightmap,Bt.emissivemap,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.gradientmap,Bt.fog,Bt.lights,{emissive:{value:new qt(0)}}]),vertexShader:Vi.meshtoon_vert,fragmentShader:Vi.meshtoon_frag},matcap:{uniforms:io([Bt.common,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.fog,{matcap:{value:null}}]),vertexShader:Vi.meshmatcap_vert,fragmentShader:Vi.meshmatcap_frag},points:{uniforms:io([Bt.points,Bt.fog]),vertexShader:Vi.points_vert,fragmentShader:Vi.points_frag},dashed:{uniforms:io([Bt.common,Bt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Vi.linedashed_vert,fragmentShader:Vi.linedashed_frag},depth:{uniforms:io([Bt.common,Bt.displacementmap]),vertexShader:Vi.depth_vert,fragmentShader:Vi.depth_frag},normal:{uniforms:io([Bt.common,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,{opacity:{value:1}}]),vertexShader:Vi.meshnormal_vert,fragmentShader:Vi.meshnormal_frag},sprite:{uniforms:io([Bt.sprite,Bt.fog]),vertexShader:Vi.sprite_vert,fragmentShader:Vi.sprite_frag},background:{uniforms:{uvTransform:{value:new ma},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Vi.background_vert,fragmentShader:Vi.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Vi.backgroundCube_vert,fragmentShader:Vi.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Vi.cube_vert,fragmentShader:Vi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Vi.equirect_vert,fragmentShader:Vi.equirect_frag},distanceRGBA:{uniforms:io([Bt.common,Bt.displacementmap,{referencePosition:{value:new pe},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Vi.distanceRGBA_vert,fragmentShader:Vi.distanceRGBA_frag},shadow:{uniforms:io([Bt.lights,Bt.fog,{color:{value:new qt(0)},opacity:{value:1}}]),vertexShader:Vi.shadow_vert,fragmentShader:Vi.shadow_frag}};Lu.physical={uniforms:io([Lu.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new ft(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new qt(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new ft},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new qt(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new qt(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Vi.meshphysical_vert,fragmentShader:Vi.meshphysical_frag};const yM={r:0,b:0,g:0};function bse(e,t,i,r,n,s,a){const o=new qt(0);let l=s===!0?0:1,u,c,h=null,d=0,p=null;function m(g,w){let S=!1,_=w.isScene===!0?w.background:null;_&&_.isTexture&&(_=(w.backgroundBlurriness>0?i:t).get(_));const A=e.xr,C=A.getSession&&A.getSession();C&&C.environmentBlendMode==="additive"&&(_=null),_===null?v(o,l):_&&_.isColor&&(v(_,1),S=!0),(e.autoClear||S)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),_&&(_.isCubeTexture||_.mapping===Ex)?(c===void 0&&(c=new js(new Vp(1,1,1),new Kc({name:"BackgroundCubeMaterial",uniforms:ix(Lu.backgroundCube.uniforms),vertexShader:Lu.backgroundCube.vertexShader,fragmentShader:Lu.backgroundCube.fragmentShader,side:jo,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(E,I,T){this.matrixWorld.copyPosition(T.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(c)),c.material.uniforms.envMap.value=_,c.material.uniforms.flipEnvMap.value=_.isCubeTexture&&_.isRenderTargetTexture===!1?-1:1,c.material.uniforms.backgroundBlurriness.value=w.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=w.backgroundIntensity,c.material.toneMapped=_.encoding!==Ur,(h!==_||d!==_.version||p!==e.toneMapping)&&(c.material.needsUpdate=!0,h=_,d=_.version,p=e.toneMapping),c.layers.enableAll(),g.unshift(c,c.geometry,c.material,0,0,null)):_&&_.isTexture&&(u===void 0&&(u=new js(new Tx(2,2),new Kc({name:"BackgroundMaterial",uniforms:ix(Lu.background.uniforms),vertexShader:Lu.background.vertexShader,fragmentShader:Lu.background.fragmentShader,side:Ed,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(u)),u.material.uniforms.t2D.value=_,u.material.uniforms.backgroundIntensity.value=w.backgroundIntensity,u.material.toneMapped=_.encoding!==Ur,_.matrixAutoUpdate===!0&&_.updateMatrix(),u.material.uniforms.uvTransform.value.copy(_.matrix),(h!==_||d!==_.version||p!==e.toneMapping)&&(u.material.needsUpdate=!0,h=_,d=_.version,p=e.toneMapping),u.layers.enableAll(),g.unshift(u,u.geometry,u.material,0,0,null))}function v(g,w){g.getRGB(yM,b9(e)),r.buffers.color.setClear(yM.r,yM.g,yM.b,w,a)}return{getClearColor:function(){return o},setClearColor:function(g,w=1){o.set(g),l=w,v(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(g){l=g,v(o,l)},render:m}}function _se(e,t,i,r){const n=e.getParameter(34921),s=r.isWebGL2?null:t.get("OES_vertex_array_object"),a=r.isWebGL2||s!==null,o={},l=g(null);let u=l,c=!1;function h(j,J,ne,K,B){let Z=!1;if(a){const F=v(K,ne,J);u!==F&&(u=F,p(u.object)),Z=w(j,K,ne,B),Z&&S(j,K,ne,B)}else{const F=J.wireframe===!0;(u.geometry!==K.id||u.program!==ne.id||u.wireframe!==F)&&(u.geometry=K.id,u.program=ne.id,u.wireframe=F,Z=!0)}B!==null&&i.update(B,34963),(Z||c)&&(c=!1,T(j,J,ne,K),B!==null&&e.bindBuffer(34963,i.get(B).buffer))}function d(){return r.isWebGL2?e.createVertexArray():s.createVertexArrayOES()}function p(j){return r.isWebGL2?e.bindVertexArray(j):s.bindVertexArrayOES(j)}function m(j){return r.isWebGL2?e.deleteVertexArray(j):s.deleteVertexArrayOES(j)}function v(j,J,ne){const K=ne.wireframe===!0;let B=o[j.id];B===void 0&&(B={},o[j.id]=B);let Z=B[J.id];Z===void 0&&(Z={},B[J.id]=Z);let F=Z[K];return F===void 0&&(F=g(d()),Z[K]=F),F}function g(j){const J=[],ne=[],K=[];for(let B=0;B<n;B++)J[B]=0,ne[B]=0,K[B]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:J,enabledAttributes:ne,attributeDivisors:K,object:j,attributes:{},index:null}}function w(j,J,ne,K){const B=u.attributes,Z=J.attributes;let F=0;const X=ne.getAttributes();for(const Y in X)if(X[Y].location>=0){const oe=B[Y];let re=Z[Y];if(re===void 0&&(Y==="instanceMatrix"&&j.instanceMatrix&&(re=j.instanceMatrix),Y==="instanceColor"&&j.instanceColor&&(re=j.instanceColor)),oe===void 0||oe.attribute!==re||re&&oe.data!==re.data)return!0;F++}return u.attributesNum!==F||u.index!==K}function S(j,J,ne,K){const B={},Z=J.attributes;let F=0;const X=ne.getAttributes();for(const Y in X)if(X[Y].location>=0){let oe=Z[Y];oe===void 0&&(Y==="instanceMatrix"&&j.instanceMatrix&&(oe=j.instanceMatrix),Y==="instanceColor"&&j.instanceColor&&(oe=j.instanceColor));const re={};re.attribute=oe,oe&&oe.data&&(re.data=oe.data),B[Y]=re,F++}u.attributes=B,u.attributesNum=F,u.index=K}function _(){const j=u.newAttributes;for(let J=0,ne=j.length;J<ne;J++)j[J]=0}function A(j){C(j,0)}function C(j,J){const ne=u.newAttributes,K=u.enabledAttributes,B=u.attributeDivisors;ne[j]=1,K[j]===0&&(e.enableVertexAttribArray(j),K[j]=1),B[j]!==J&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](j,J),B[j]=J)}function E(){const j=u.newAttributes,J=u.enabledAttributes;for(let ne=0,K=J.length;ne<K;ne++)J[ne]!==j[ne]&&(e.disableVertexAttribArray(ne),J[ne]=0)}function I(j,J,ne,K,B,Z){r.isWebGL2===!0&&(ne===5124||ne===5125)?e.vertexAttribIPointer(j,J,ne,B,Z):e.vertexAttribPointer(j,J,ne,K,B,Z)}function T(j,J,ne,K){if(r.isWebGL2===!1&&(j.isInstancedMesh||K.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;_();const B=K.attributes,Z=ne.getAttributes(),F=J.defaultAttributeValues;for(const X in Z){const Y=Z[X];if(Y.location>=0){let le=B[X];if(le===void 0&&(X==="instanceMatrix"&&j.instanceMatrix&&(le=j.instanceMatrix),X==="instanceColor"&&j.instanceColor&&(le=j.instanceColor)),le!==void 0){const oe=le.normalized,re=le.itemSize,ue=i.get(le);if(ue===void 0)continue;const me=ue.buffer,he=ue.type,Ce=ue.bytesPerElement;if(le.isInterleavedBufferAttribute){const Ae=le.data,Ie=Ae.stride,Me=le.offset;if(Ae.isInstancedInterleavedBuffer){for(let De=0;De<Y.locationSize;De++)C(Y.location+De,Ae.meshPerAttribute);j.isInstancedMesh!==!0&&K._maxInstanceCount===void 0&&(K._maxInstanceCount=Ae.meshPerAttribute*Ae.count)}else for(let De=0;De<Y.locationSize;De++)A(Y.location+De);e.bindBuffer(34962,me);for(let De=0;De<Y.locationSize;De++)I(Y.location+De,re/Y.locationSize,he,oe,Ie*Ce,(Me+re/Y.locationSize*De)*Ce)}else{if(le.isInstancedBufferAttribute){for(let Ae=0;Ae<Y.locationSize;Ae++)C(Y.location+Ae,le.meshPerAttribute);j.isInstancedMesh!==!0&&K._maxInstanceCount===void 0&&(K._maxInstanceCount=le.meshPerAttribute*le.count)}else for(let Ae=0;Ae<Y.locationSize;Ae++)A(Y.location+Ae);e.bindBuffer(34962,me);for(let Ae=0;Ae<Y.locationSize;Ae++)I(Y.location+Ae,re/Y.locationSize,he,oe,re*Ce,re/Y.locationSize*Ae*Ce)}}else if(F!==void 0){const oe=F[X];if(oe!==void 0)switch(oe.length){case 2:e.vertexAttrib2fv(Y.location,oe);break;case 3:e.vertexAttrib3fv(Y.location,oe);break;case 4:e.vertexAttrib4fv(Y.location,oe);break;default:e.vertexAttrib1fv(Y.location,oe)}}}}E()}function D(){G();for(const j in o){const J=o[j];for(const ne in J){const K=J[ne];for(const B in K)m(K[B].object),delete K[B];delete J[ne]}delete o[j]}}function L(j){if(o[j.id]===void 0)return;const J=o[j.id];for(const ne in J){const K=J[ne];for(const B in K)m(K[B].object),delete K[B];delete J[ne]}delete o[j.id]}function z(j){for(const J in o){const ne=o[J];if(ne[j.id]===void 0)continue;const K=ne[j.id];for(const B in K)m(K[B].object),delete K[B];delete ne[j.id]}}function G(){V(),c=!0,u!==l&&(u=l,p(u.object))}function V(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:h,reset:G,resetDefaultState:V,dispose:D,releaseStatesOfGeometry:L,releaseStatesOfProgram:z,initAttributes:_,enableAttribute:A,disableUnusedAttributes:E}}function Sse(e,t,i,r){const n=r.isWebGL2;let s;function a(u){s=u}function o(u,c){e.drawArrays(s,u,c),i.update(c,s,1)}function l(u,c,h){if(h===0)return;let d,p;if(n)d=e,p="drawArraysInstanced";else if(d=t.get("ANGLE_instanced_arrays"),p="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[p](s,u,c,h),i.update(c,s,h)}this.setMode=a,this.render=o,this.renderInstances=l}function Mse(e,t,i){let r;function n(){if(r!==void 0)return r;if(t.has("EXT_texture_filter_anisotropic")===!0){const I=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(I.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function s(I){if(I==="highp"){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";I="mediump"}return I==="mediump"&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const a=typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext;let o=i.precision!==void 0?i.precision:"highp";const l=s(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);const u=a||t.has("WEBGL_draw_buffers"),c=i.logarithmicDepthBuffer===!0,h=e.getParameter(34930),d=e.getParameter(35660),p=e.getParameter(3379),m=e.getParameter(34076),v=e.getParameter(34921),g=e.getParameter(36347),w=e.getParameter(36348),S=e.getParameter(36349),_=d>0,A=a||t.has("OES_texture_float"),C=_&&A,E=a?e.getParameter(36183):0;return{isWebGL2:a,drawBuffers:u,getMaxAnisotropy:n,getMaxPrecision:s,precision:o,logarithmicDepthBuffer:c,maxTextures:h,maxVertexTextures:d,maxTextureSize:p,maxCubemapSize:m,maxAttributes:v,maxVertexUniforms:g,maxVaryings:w,maxFragmentUniforms:S,vertexTextures:_,floatFragmentTextures:A,floatVertexTextures:C,maxSamples:E}}function Ase(e){const t=this;let i=null,r=0,n=!1,s=!1;const a=new rd,o=new ma,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){const p=h.length!==0||d||r!==0||n;return n=d,r=h.length,p},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){i=c(h,d,0)},this.setState=function(h,d,p){const m=h.clippingPlanes,v=h.clipIntersection,g=h.clipShadows,w=e.get(h);if(!n||m===null||m.length===0||s&&!g)s?c(null):u();else{const S=s?0:r,_=S*4;let A=w.clippingState||null;l.value=A,A=c(m,d,_,p);for(let C=0;C!==_;++C)A[C]=i[C];w.clippingState=A,this.numIntersection=v?this.numPlanes:0,this.numPlanes+=S}};function u(){l.value!==i&&(l.value=i,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function c(h,d,p,m){const v=h!==null?h.length:0;let g=null;if(v!==0){if(g=l.value,m!==!0||g===null){const w=p+v*4,S=d.matrixWorldInverse;o.getNormalMatrix(S),(g===null||g.length<w)&&(g=new Float32Array(w));for(let _=0,A=p;_!==v;++_,A+=4)a.copy(h[_]).applyMatrix4(S,o),a.normal.toArray(g,A),g[A+3]=a.constant}l.value=g,l.needsUpdate=!0}return t.numPlanes=v,t.numIntersection=0,g}}function Ese(e){let t=new WeakMap;function i(a,o){return o===Mb?a.mapping=Cp:o===Ab&&(a.mapping=Tp),a}function r(a){if(a&&a.isTexture&&a.isRenderTargetTexture===!1){const o=a.mapping;if(o===Mb||o===Ab)if(t.has(a)){const l=t.get(a).texture;return i(l,a.mapping)}else{const l=a.image;if(l&&l.height>0){const u=new pz(l.height/2);return u.fromEquirectangularTexture(e,a),t.set(a,u),a.addEventListener("dispose",n),i(u.texture,a.mapping)}else return null}}return a}function n(a){const o=a.target;o.removeEventListener("dispose",n);const l=t.get(o);l!==void 0&&(t.delete(o),l.dispose())}function s(){t=new WeakMap}return{get:r,dispose:s}}class jc extends b_{constructor(t=-1,i=1,r=1,n=-1,s=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=i,this.top=r,this.bottom=n,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(t,i){return super.copy(t,i),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,i,r,n,s,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=i,this.view.offsetX=r,this.view.offsetY=n,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let s=r-t,a=r+t,o=n+i,l=n-i;if(this.view!==null&&this.view.enabled){const u=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=u*this.view.offsetX,a=s+u*this.view.width,o-=c*this.view.offsetY,l=o-c*this.view.height}this.projectionMatrix.makeOrthographic(s,a,o,l,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const i=super.toJSON(t);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,this.view!==null&&(i.object.view=Object.assign({},this.view)),i}}const _y=4,CF=[.125,.215,.35,.446,.526,.582],ig=20,EP=new jc,TF=new qt;let CP=null;const Ym=(1+Math.sqrt(5))/2,E0=1/Ym,PF=[new pe(1,1,1),new pe(-1,1,1),new pe(1,1,-1),new pe(-1,1,-1),new pe(0,Ym,E0),new pe(0,Ym,-E0),new pe(E0,0,Ym),new pe(-E0,0,Ym),new pe(Ym,E0,0),new pe(-Ym,E0,0)];class uI{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,i=0,r=.1,n=100){CP=this._renderer.getRenderTarget(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(t,r,n,s),i>0&&this._blur(s,0,0,i),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(t,i=null){return this._fromTexture(t,i)}fromCubemap(t,i=null){return this._fromTexture(t,i)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=IF(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=RF(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(CP),t.scissorTest=!1,xM(t,0,0,t.width,t.height)}_fromTexture(t,i){t.mapping===Cp||t.mapping===Tp?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),CP=this._renderer.getRenderTarget();const r=i||this._allocateTargets();return this._textureToCubeUV(t,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),i=4*this._cubeSize,r={magFilter:On,minFilter:On,generateMipmaps:!1,type:ex,format:ko,encoding:Dp,depthBuffer:!1},n=DF(t,i,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==i){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=DF(t,i,r);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Cse(s)),this._blurMaterial=Tse(s,t,i)}return n}_compileMaterial(t){const i=new js(this._lodPlanes[0],t);this._renderer.compile(i,EP)}_sceneToCubeUV(t,i,r,n){const o=new on(90,1,i,r),l=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],c=this._renderer,h=c.autoClear,d=c.toneMapping;c.getClearColor(TF),c.toneMapping=Nu,c.autoClear=!1;const p=new Up({name:"PMREM.Background",side:jo,depthWrite:!1,depthTest:!1}),m=new js(new Vp,p);let v=!1;const g=t.background;g?g.isColor&&(p.color.copy(g),t.background=null,v=!0):(p.color.copy(TF),v=!0);for(let w=0;w<6;w++){const S=w%3;S===0?(o.up.set(0,l[w],0),o.lookAt(u[w],0,0)):S===1?(o.up.set(0,0,l[w]),o.lookAt(0,u[w],0)):(o.up.set(0,l[w],0),o.lookAt(0,0,u[w]));const _=this._cubeSize;xM(n,S*_,w>2?_:0,_,_),c.setRenderTarget(n),v&&c.render(m,o),c.render(t,o)}m.geometry.dispose(),m.material.dispose(),c.toneMapping=d,c.autoClear=h,t.background=g}_textureToCubeUV(t,i){const r=this._renderer,n=t.mapping===Cp||t.mapping===Tp;n?(this._cubemapMaterial===null&&(this._cubemapMaterial=IF()),this._cubemapMaterial.uniforms.flipEnvMap.value=t.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=RF());const s=n?this._cubemapMaterial:this._equirectMaterial,a=new js(this._lodPlanes[0],s),o=s.uniforms;o.envMap.value=t;const l=this._cubeSize;xM(i,0,0,3*l,2*l),r.setRenderTarget(i),r.render(a,EP)}_applyPMREM(t){const i=this._renderer,r=i.autoClear;i.autoClear=!1;for(let n=1;n<this._lodPlanes.length;n++){const s=Math.sqrt(this._sigmas[n]*this._sigmas[n]-this._sigmas[n-1]*this._sigmas[n-1]),a=PF[(n-1)%PF.length];this._blur(t,n-1,n,s,a)}i.autoClear=r}_blur(t,i,r,n,s){const a=this._pingPongRenderTarget;this._halfBlur(t,a,i,r,n,"latitudinal",s),this._halfBlur(a,t,r,r,n,"longitudinal",s)}_halfBlur(t,i,r,n,s,a,o){const l=this._renderer,u=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const c=3,h=new js(this._lodPlanes[n],u),d=u.uniforms,p=this._sizeLods[r]-1,m=isFinite(s)?Math.PI/(2*p):2*Math.PI/(2*ig-1),v=s/m,g=isFinite(s)?1+Math.floor(c*v):ig;g>ig&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${ig}`);const w=[];let S=0;for(let I=0;I<ig;++I){const T=I/v,D=Math.exp(-T*T/2);w.push(D),I===0?S+=D:I<g&&(S+=2*D)}for(let I=0;I<w.length;I++)w[I]=w[I]/S;d.envMap.value=t.texture,d.samples.value=g,d.weights.value=w,d.latitudinal.value=a==="latitudinal",o&&(d.poleAxis.value=o);const{_lodMax:_}=this;d.dTheta.value=m,d.mipInt.value=_-r;const A=this._sizeLods[n],C=3*A*(n>_-_y?n-_+_y:0),E=4*(this._cubeSize-A);xM(i,C,E,3*A,2*A),l.setRenderTarget(i),l.render(h,EP)}}function Cse(e){const t=[],i=[],r=[];let n=e;const s=e-_y+1+CF.length;for(let a=0;a<s;a++){const o=Math.pow(2,n);i.push(o);let l=1/o;a>e-_y?l=CF[a-e+_y-1]:a===0&&(l=0),r.push(l);const u=1/(o-2),c=-u,h=1+u,d=[c,c,h,c,h,h,c,c,h,h,c,h],p=6,m=6,v=3,g=2,w=1,S=new Float32Array(v*m*p),_=new Float32Array(g*m*p),A=new Float32Array(w*m*p);for(let E=0;E<p;E++){const I=E%3*2/3-1,T=E>2?0:-1,D=[I,T,0,I+2/3,T,0,I+2/3,T+1,0,I,T,0,I+2/3,T+1,0,I,T+1,0];S.set(D,v*m*E),_.set(d,g*m*E);const L=[E,E,E,E,E,E];A.set(L,w*m*E)}const C=new Fi;C.setAttribute("position",new kr(S,v)),C.setAttribute("uv",new kr(_,g)),C.setAttribute("faceIndex",new kr(A,w)),t.push(C),n>_y&&n--}return{lodPlanes:t,sizeLods:i,sigmas:r}}function DF(e,t,i){const r=new Vu(e,t,i);return r.texture.mapping=Ex,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function xM(e,t,i,r,n){e.viewport.set(t,i,r,n),e.scissor.set(t,i,r,n)}function Tse(e,t,i){const r=new Float32Array(ig),n=new pe(0,1,0);return new Kc({name:"SphericalGaussianBlur",defines:{n:ig,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:mz(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:_d,depthTest:!1,depthWrite:!1})}function RF(){return new Kc({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:mz(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:_d,depthTest:!1,depthWrite:!1})}function IF(){return new Kc({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:mz(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:_d,depthTest:!1,depthWrite:!1})}function mz(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Pse(e){let t=new WeakMap,i=null;function r(o){if(o&&o.isTexture){const l=o.mapping,u=l===Mb||l===Ab,c=l===Cp||l===Tp;if(u||c)if(o.isRenderTargetTexture&&o.needsPMREMUpdate===!0){o.needsPMREMUpdate=!1;let h=t.get(o);return i===null&&(i=new uI(e)),h=u?i.fromEquirectangular(o,h):i.fromCubemap(o,h),t.set(o,h),h.texture}else{if(t.has(o))return t.get(o).texture;{const h=o.image;if(u&&h&&h.height>0||c&&h&&n(h)){i===null&&(i=new uI(e));const d=u?i.fromEquirectangular(o):i.fromCubemap(o);return t.set(o,d),o.addEventListener("dispose",s),d.texture}else return null}}}return o}function n(o){let l=0;const u=6;for(let c=0;c<u;c++)o[c]!==void 0&&l++;return l===u}function s(o){const l=o.target;l.removeEventListener("dispose",s);const u=t.get(l);u!==void 0&&(t.delete(l),u.dispose())}function a(){t=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:r,dispose:a}}function Dse(e){const t={};function i(r){if(t[r]!==void 0)return t[r];let n;switch(r){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(r)}return t[r]=n,n}return{has:function(r){return i(r)!==null},init:function(r){r.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(r){const n=i(r);return n===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),n}}}function Rse(e,t,i,r){const n={},s=new WeakMap;function a(h){const d=h.target;d.index!==null&&t.remove(d.index);for(const m in d.attributes)t.remove(d.attributes[m]);d.removeEventListener("dispose",a),delete n[d.id];const p=s.get(d);p&&(t.remove(p),s.delete(d)),r.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,i.memory.geometries--}function o(h,d){return n[d.id]===!0||(d.addEventListener("dispose",a),n[d.id]=!0,i.memory.geometries++),d}function l(h){const d=h.attributes;for(const m in d)t.update(d[m],34962);const p=h.morphAttributes;for(const m in p){const v=p[m];for(let g=0,w=v.length;g<w;g++)t.update(v[g],34962)}}function u(h){const d=[],p=h.index,m=h.attributes.position;let v=0;if(p!==null){const S=p.array;v=p.version;for(let _=0,A=S.length;_<A;_+=3){const C=S[_+0],E=S[_+1],I=S[_+2];d.push(C,E,E,I,I,C)}}else{const S=m.array;v=m.version;for(let _=0,A=S.length/3-1;_<A;_+=3){const C=_+0,E=_+1,I=_+2;d.push(C,E,E,I,I,C)}}const g=new(x9(d)?dz:hz)(d,1);g.version=v;const w=s.get(h);w&&t.remove(w),s.set(h,g)}function c(h){const d=s.get(h);if(d){const p=h.index;p!==null&&d.version<p.version&&u(h)}else u(h);return s.get(h)}return{get:o,update:l,getWireframeAttribute:c}}function Ise(e,t,i,r){const n=r.isWebGL2;let s;function a(d){s=d}let o,l;function u(d){o=d.type,l=d.bytesPerElement}function c(d,p){e.drawElements(s,p,o,d*l),i.update(p,s,1)}function h(d,p,m){if(m===0)return;let v,g;if(n)v=e,g="drawElementsInstanced";else if(v=t.get("ANGLE_instanced_arrays"),g="drawElementsInstancedANGLE",v===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}v[g](s,p,o,d*l,m),i.update(p,s,m)}this.setMode=a,this.setIndex=u,this.render=c,this.renderInstances=h}function Lse(e){const t={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,a,o){switch(i.calls++,a){case 4:i.triangles+=o*(s/3);break;case 1:i.lines+=o*(s/2);break;case 3:i.lines+=o*(s-1);break;case 2:i.lines+=o*s;break;case 0:i.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function n(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:t,render:i,programs:null,autoReset:!0,reset:n,update:r}}function Ose(e,t){return e[0]-t[0]}function zse(e,t){return Math.abs(t[1])-Math.abs(e[1])}function kse(e,t,i){const r={},n=new Float32Array(8),s=new WeakMap,a=new _r,o=[];for(let u=0;u<8;u++)o[u]=[u,0];function l(u,c,h){const d=u.morphTargetInfluences;if(t.isWebGL2===!0){const p=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,m=p!==void 0?p.length:0;let v=s.get(c);if(v===void 0||v.count!==m){let j=function(){G.dispose(),s.delete(c),c.removeEventListener("dispose",j)};v!==void 0&&v.texture.dispose();const S=c.morphAttributes.position!==void 0,_=c.morphAttributes.normal!==void 0,A=c.morphAttributes.color!==void 0,C=c.morphAttributes.position||[],E=c.morphAttributes.normal||[],I=c.morphAttributes.color||[];let T=0;S===!0&&(T=1),_===!0&&(T=2),A===!0&&(T=3);let D=c.attributes.position.count*T,L=1;D>t.maxTextureSize&&(L=Math.ceil(D/t.maxTextureSize),D=t.maxTextureSize);const z=new Float32Array(D*L*4*m),G=new CC(z,D,L,m);G.type=fd,G.needsUpdate=!0;const V=T*4;for(let J=0;J<m;J++){const ne=C[J],K=E[J],B=I[J],Z=D*L*4*J;for(let F=0;F<ne.count;F++){const X=F*V;S===!0&&(a.fromBufferAttribute(ne,F),z[Z+X+0]=a.x,z[Z+X+1]=a.y,z[Z+X+2]=a.z,z[Z+X+3]=0),_===!0&&(a.fromBufferAttribute(K,F),z[Z+X+4]=a.x,z[Z+X+5]=a.y,z[Z+X+6]=a.z,z[Z+X+7]=0),A===!0&&(a.fromBufferAttribute(B,F),z[Z+X+8]=a.x,z[Z+X+9]=a.y,z[Z+X+10]=a.z,z[Z+X+11]=B.itemSize===4?a.w:1)}}v={count:m,texture:G,size:new ft(D,L)},s.set(c,v),c.addEventListener("dispose",j)}let g=0;for(let S=0;S<d.length;S++)g+=d[S];const w=c.morphTargetsRelative?1:1-g;h.getUniforms().setValue(e,"morphTargetBaseInfluence",w),h.getUniforms().setValue(e,"morphTargetInfluences",d),h.getUniforms().setValue(e,"morphTargetsTexture",v.texture,i),h.getUniforms().setValue(e,"morphTargetsTextureSize",v.size)}else{const p=d===void 0?0:d.length;let m=r[c.id];if(m===void 0||m.length!==p){m=[];for(let _=0;_<p;_++)m[_]=[_,0];r[c.id]=m}for(let _=0;_<p;_++){const A=m[_];A[0]=_,A[1]=d[_]}m.sort(zse);for(let _=0;_<8;_++)_<p&&m[_][1]?(o[_][0]=m[_][0],o[_][1]=m[_][1]):(o[_][0]=Number.MAX_SAFE_INTEGER,o[_][1]=0);o.sort(Ose);const v=c.morphAttributes.position,g=c.morphAttributes.normal;let w=0;for(let _=0;_<8;_++){const A=o[_],C=A[0],E=A[1];C!==Number.MAX_SAFE_INTEGER&&E?(v&&c.getAttribute("morphTarget"+_)!==v[C]&&c.setAttribute("morphTarget"+_,v[C]),g&&c.getAttribute("morphNormal"+_)!==g[C]&&c.setAttribute("morphNormal"+_,g[C]),n[_]=E,w+=E):(v&&c.hasAttribute("morphTarget"+_)===!0&&c.deleteAttribute("morphTarget"+_),g&&c.hasAttribute("morphNormal"+_)===!0&&c.deleteAttribute("morphNormal"+_),n[_]=0)}const S=c.morphTargetsRelative?1:1-w;h.getUniforms().setValue(e,"morphTargetBaseInfluence",S),h.getUniforms().setValue(e,"morphTargetInfluences",n)}}return{update:l}}function Bse(e,t,i,r){let n=new WeakMap;function s(l){const u=r.render.frame,c=l.geometry,h=t.get(l,c);return n.get(h)!==u&&(t.update(h),n.set(h,u)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),i.update(l.instanceMatrix,34962),l.instanceColor!==null&&i.update(l.instanceColor,34962)),h}function a(){n=new WeakMap}function o(l){const u=l.target;u.removeEventListener("dispose",o),i.remove(u.instanceMatrix),u.instanceColor!==null&&i.remove(u.instanceColor)}return{update:s,dispose:a}}const M9=new _n,A9=new CC,E9=new cz,C9=new __,LF=[],OF=[],zF=new Float32Array(16),kF=new Float32Array(9),BF=new Float32Array(4);function Px(e,t,i){const r=e[0];if(r<=0||r>0)return e;const n=t*i;let s=LF[n];if(s===void 0&&(s=new Float32Array(n),LF[n]=s),t!==0){r.toArray(s,0);for(let a=1,o=0;a!==t;++a)o+=i,e[a].toArray(s,o)}return s}function As(e,t){if(e.length!==t.length)return!1;for(let i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}function Es(e,t){for(let i=0,r=t.length;i<r;i++)e[i]=t[i]}function PC(e,t){let i=OF[t];i===void 0&&(i=new Int32Array(t),OF[t]=i);for(let r=0;r!==t;++r)i[r]=e.allocateTextureUnit();return i}function Nse(e,t){const i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function Fse(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(As(i,t))return;e.uniform2fv(this.addr,t),Es(i,t)}}function Use(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(t.r!==void 0)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(As(i,t))return;e.uniform3fv(this.addr,t),Es(i,t)}}function Vse(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(As(i,t))return;e.uniform4fv(this.addr,t),Es(i,t)}}function jse(e,t){const i=this.cache,r=t.elements;if(r===void 0){if(As(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),Es(i,t)}else{if(As(i,r))return;BF.set(r),e.uniformMatrix2fv(this.addr,!1,BF),Es(i,r)}}function Hse(e,t){const i=this.cache,r=t.elements;if(r===void 0){if(As(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),Es(i,t)}else{if(As(i,r))return;kF.set(r),e.uniformMatrix3fv(this.addr,!1,kF),Es(i,r)}}function Wse(e,t){const i=this.cache,r=t.elements;if(r===void 0){if(As(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),Es(i,t)}else{if(As(i,r))return;zF.set(r),e.uniformMatrix4fv(this.addr,!1,zF),Es(i,r)}}function Gse(e,t){const i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function qse(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2i(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(As(i,t))return;e.uniform2iv(this.addr,t),Es(i,t)}}function Xse(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3i(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(As(i,t))return;e.uniform3iv(this.addr,t),Es(i,t)}}function Yse(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(As(i,t))return;e.uniform4iv(this.addr,t),Es(i,t)}}function Qse(e,t){const i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function Kse(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2ui(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(As(i,t))return;e.uniform2uiv(this.addr,t),Es(i,t)}}function Zse(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3ui(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(As(i,t))return;e.uniform3uiv(this.addr,t),Es(i,t)}}function Jse(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(As(i,t))return;e.uniform4uiv(this.addr,t),Es(i,t)}}function $se(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2D(t||M9,n)}function eae(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(t||E9,n)}function tae(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTextureCube(t||C9,n)}function iae(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(t||A9,n)}function rae(e){switch(e){case 5126:return Nse;case 35664:return Fse;case 35665:return Use;case 35666:return Vse;case 35674:return jse;case 35675:return Hse;case 35676:return Wse;case 5124:case 35670:return Gse;case 35667:case 35671:return qse;case 35668:case 35672:return Xse;case 35669:case 35673:return Yse;case 5125:return Qse;case 36294:return Kse;case 36295:return Zse;case 36296:return Jse;case 35678:case 36198:case 36298:case 36306:case 35682:return $se;case 35679:case 36299:case 36307:return eae;case 35680:case 36300:case 36308:case 36293:return tae;case 36289:case 36303:case 36311:case 36292:return iae}}function nae(e,t){e.uniform1fv(this.addr,t)}function sae(e,t){const i=Px(t,this.size,2);e.uniform2fv(this.addr,i)}function aae(e,t){const i=Px(t,this.size,3);e.uniform3fv(this.addr,i)}function oae(e,t){const i=Px(t,this.size,4);e.uniform4fv(this.addr,i)}function lae(e,t){const i=Px(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function uae(e,t){const i=Px(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function cae(e,t){const i=Px(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function hae(e,t){e.uniform1iv(this.addr,t)}function dae(e,t){e.uniform2iv(this.addr,t)}function fae(e,t){e.uniform3iv(this.addr,t)}function pae(e,t){e.uniform4iv(this.addr,t)}function mae(e,t){e.uniform1uiv(this.addr,t)}function gae(e,t){e.uniform2uiv(this.addr,t)}function vae(e,t){e.uniform3uiv(this.addr,t)}function yae(e,t){e.uniform4uiv(this.addr,t)}function xae(e,t,i){const r=this.cache,n=t.length,s=PC(i,n);As(r,s)||(e.uniform1iv(this.addr,s),Es(r,s));for(let a=0;a!==n;++a)i.setTexture2D(t[a]||M9,s[a])}function wae(e,t,i){const r=this.cache,n=t.length,s=PC(i,n);As(r,s)||(e.uniform1iv(this.addr,s),Es(r,s));for(let a=0;a!==n;++a)i.setTexture3D(t[a]||E9,s[a])}function bae(e,t,i){const r=this.cache,n=t.length,s=PC(i,n);As(r,s)||(e.uniform1iv(this.addr,s),Es(r,s));for(let a=0;a!==n;++a)i.setTextureCube(t[a]||C9,s[a])}function _ae(e,t,i){const r=this.cache,n=t.length,s=PC(i,n);As(r,s)||(e.uniform1iv(this.addr,s),Es(r,s));for(let a=0;a!==n;++a)i.setTexture2DArray(t[a]||A9,s[a])}function Sae(e){switch(e){case 5126:return nae;case 35664:return sae;case 35665:return aae;case 35666:return oae;case 35674:return lae;case 35675:return uae;case 35676:return cae;case 5124:case 35670:return hae;case 35667:case 35671:return dae;case 35668:case 35672:return fae;case 35669:case 35673:return pae;case 5125:return mae;case 36294:return gae;case 36295:return vae;case 36296:return yae;case 35678:case 36198:case 36298:case 36306:case 35682:return xae;case 35679:case 36299:case 36307:return wae;case 35680:case 36300:case 36308:case 36293:return bae;case 36289:case 36303:case 36311:case 36292:return _ae}}class Mae{constructor(t,i,r){this.id=t,this.addr=r,this.cache=[],this.setValue=rae(i.type)}}class Aae{constructor(t,i,r){this.id=t,this.addr=r,this.cache=[],this.size=i.size,this.setValue=Sae(i.type)}}class Eae{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,i,r){const n=this.seq;for(let s=0,a=n.length;s!==a;++s){const o=n[s];o.setValue(t,i[o.id],r)}}}const TP=/(\w+)(\])?(\[|\.)?/g;function NF(e,t){e.seq.push(t),e.map[t.id]=t}function Cae(e,t,i){const r=e.name,n=r.length;for(TP.lastIndex=0;;){const s=TP.exec(r),a=TP.lastIndex;let o=s[1];const l=s[2]==="]",u=s[3];if(l&&(o=o|0),u===void 0||u==="["&&a+2===n){NF(i,u===void 0?new Mae(o,e,t):new Aae(o,e,t));break}else{let h=i.map[o];h===void 0&&(h=new Eae(o),NF(i,h)),i=h}}}class PE{constructor(t,i){this.seq=[],this.map={};const r=t.getProgramParameter(i,35718);for(let n=0;n<r;++n){const s=t.getActiveUniform(i,n),a=t.getUniformLocation(i,s.name);Cae(s,a,this)}}setValue(t,i,r,n){const s=this.map[i];s!==void 0&&s.setValue(t,r,n)}setOptional(t,i,r){const n=i[r];n!==void 0&&this.setValue(t,r,n)}static upload(t,i,r,n){for(let s=0,a=i.length;s!==a;++s){const o=i[s],l=r[o.id];l.needsUpdate!==!1&&o.setValue(t,l.value,n)}}static seqWithValue(t,i){const r=[];for(let n=0,s=t.length;n!==s;++n){const a=t[n];a.id in i&&r.push(a)}return r}}function FF(e,t,i){const r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),r}let Tae=0;function Pae(e,t){const i=e.split(`
`),r=[],n=Math.max(t-6,0),s=Math.min(t+6,i.length);for(let a=n;a<s;a++){const o=a+1;r.push(`${o===t?">":" "} ${o}: ${i[a]}`)}return r.join(`
`)}function Dae(e){switch(e){case Dp:return["Linear","( value )"];case Ur:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function UF(e,t,i){const r=e.getShaderParameter(t,35713),n=e.getShaderInfoLog(t).trim();if(r&&n==="")return"";const s=/ERROR: 0:(\d+)/.exec(n);if(s){const a=parseInt(s[1]);return i.toUpperCase()+`

`+n+`

`+Pae(e.getShaderSource(t),a)}else return n}function Rae(e,t){const i=Dae(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function Iae(e,t){let i;switch(t){case W8:i="Linear";break;case G8:i="Reinhard";break;case q8:i="OptimizedCineon";break;case rz:i="ACESFilmic";break;case X8:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function Lae(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||e.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Nw).join(`
`)}function Oae(e){const t=[];for(const i in e){const r=e[i];r!==!1&&t.push("#define "+i+" "+r)}return t.join(`
`)}function zae(e,t){const i={},r=e.getProgramParameter(t,35721);for(let n=0;n<r;n++){const s=e.getActiveAttrib(t,n),a=s.name;let o=1;s.type===35674&&(o=2),s.type===35675&&(o=3),s.type===35676&&(o=4),i[a]={type:s.type,location:e.getAttribLocation(t,a),locationSize:o}}return i}function Nw(e){return e!==""}function VF(e,t){const i=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function jF(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const kae=/^[ \t]*#include +<([\w\d./]+)>/gm;function cI(e){return e.replace(kae,Bae)}function Bae(e,t){const i=Vi[t];if(i===void 0)throw new Error("Can not resolve #include <"+t+">");return cI(i)}const Nae=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function HF(e){return e.replace(Nae,Fae)}function Fae(e,t,i,r){let n="";for(let s=parseInt(t);s<parseInt(i);s++)n+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return n}function WF(e){let t="precision "+e.precision+` float;
precision `+e.precision+" int;";return e.precision==="highp"?t+=`
#define HIGH_PRECISION`:e.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:e.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function Uae(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===MC?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===Zw?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===ug&&(t="SHADOWMAP_TYPE_VSM"),t}function Vae(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case Cp:case Tp:t="ENVMAP_TYPE_CUBE";break;case Ex:t="ENVMAP_TYPE_CUBE_UV";break}return t}function jae(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case Tp:t="ENVMAP_MODE_REFRACTION";break}return t}function Hae(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case w_:t="ENVMAP_BLENDING_MULTIPLY";break;case j8:t="ENVMAP_BLENDING_MIX";break;case H8:t="ENVMAP_BLENDING_ADD";break}return t}function Wae(e){const t=e.envMapCubeUVHeight;if(t===null)return null;const i=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:r,maxMip:i}}function Gae(e,t,i,r){const n=e.getContext(),s=i.defines;let a=i.vertexShader,o=i.fragmentShader;const l=Uae(i),u=Vae(i),c=jae(i),h=Hae(i),d=Wae(i),p=i.isWebGL2?"":Lae(i),m=Oae(s),v=n.createProgram();let g,w,S=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(g=[m].filter(Nw).join(`
`),g.length>0&&(g+=`
`),w=[p,m].filter(Nw).join(`
`),w.length>0&&(w+=`
`)):(g=[WF(i),"#define SHADER_NAME "+i.shaderName,m,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Nw).join(`
`),w=[p,WF(i),"#define SHADER_NAME "+i.shaderName,m,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.envMap?"#define "+c:"",i.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.useLegacyLights?"#define LEGACY_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Nu?"#define TONE_MAPPING":"",i.toneMapping!==Nu?Vi.tonemapping_pars_fragment:"",i.toneMapping!==Nu?Iae("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",Vi.encodings_pars_fragment,Rae("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(Nw).join(`
`)),a=cI(a),a=VF(a,i),a=jF(a,i),o=cI(o),o=VF(o,i),o=jF(o,i),a=HF(a),o=HF(o),i.isWebGL2&&i.isRawShaderMaterial!==!0&&(S=`#version 300 es
`,g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,w=["#define varying in",i.glslVersion===oI?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===oI?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+w);const _=S+g+a,A=S+w+o,C=FF(n,35633,_),E=FF(n,35632,A);if(n.attachShader(v,C),n.attachShader(v,E),i.index0AttributeName!==void 0?n.bindAttribLocation(v,0,i.index0AttributeName):i.morphTargets===!0&&n.bindAttribLocation(v,0,"position"),n.linkProgram(v),e.debug.checkShaderErrors){const D=n.getProgramInfoLog(v).trim(),L=n.getShaderInfoLog(C).trim(),z=n.getShaderInfoLog(E).trim();let G=!0,V=!0;if(n.getProgramParameter(v,35714)===!1){G=!1;const j=UF(n,C,"vertex"),J=UF(n,E,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(v,35715)+`

Program Info Log: `+D+`
`+j+`
`+J)}else D!==""?console.warn("THREE.WebGLProgram: Program Info Log:",D):(L===""||z==="")&&(V=!1);V&&(this.diagnostics={runnable:G,programLog:D,vertexShader:{log:L,prefix:g},fragmentShader:{log:z,prefix:w}})}n.deleteShader(C),n.deleteShader(E);let I;this.getUniforms=function(){return I===void 0&&(I=new PE(n,v)),I};let T;return this.getAttributes=function(){return T===void 0&&(T=zae(n,v)),T},this.destroy=function(){r.releaseStatesOfProgram(this),n.deleteProgram(v),this.program=void 0},this.name=i.shaderName,this.id=Tae++,this.cacheKey=t,this.usedTimes=1,this.program=v,this.vertexShader=C,this.fragmentShader=E,this}let qae=0;class Xae{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const i=t.vertexShader,r=t.fragmentShader,n=this._getShaderStage(i),s=this._getShaderStage(r),a=this._getShaderCacheForMaterial(t);return a.has(n)===!1&&(a.add(n),n.usedTimes++),a.has(s)===!1&&(a.add(s),s.usedTimes++),this}remove(t){const i=this.materialCache.get(t);for(const r of i)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const i=this.materialCache;let r=i.get(t);return r===void 0&&(r=new Set,i.set(t,r)),r}_getShaderStage(t){const i=this.shaderCache;let r=i.get(t);return r===void 0&&(r=new Yae(t),i.set(t,r)),r}}class Yae{constructor(t){this.id=qae++,this.code=t,this.usedTimes=0}}function Qae(e,t,i,r,n,s,a){const o=new Cg,l=new Xae,u=[],c=n.isWebGL2,h=n.logarithmicDepthBuffer,d=n.vertexTextures;let p=n.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function v(T,D,L,z,G){const V=z.fog,j=G.geometry,J=T.isMeshStandardMaterial?z.environment:null,ne=(T.isMeshStandardMaterial?i:t).get(T.envMap||J),K=ne&&ne.mapping===Ex?ne.image.height:null,B=m[T.type];T.precision!==null&&(p=n.getMaxPrecision(T.precision),p!==T.precision&&console.warn("THREE.WebGLProgram.getParameters:",T.precision,"not supported, using",p,"instead."));const Z=j.morphAttributes.position||j.morphAttributes.normal||j.morphAttributes.color,F=Z!==void 0?Z.length:0;let X=0;j.morphAttributes.position!==void 0&&(X=1),j.morphAttributes.normal!==void 0&&(X=2),j.morphAttributes.color!==void 0&&(X=3);let Y,le,oe,re;if(B){const Ie=Lu[B];Y=Ie.vertexShader,le=Ie.fragmentShader}else Y=T.vertexShader,le=T.fragmentShader,l.update(T),oe=l.getVertexShaderID(T),re=l.getFragmentShaderID(T);const ue=e.getRenderTarget(),me=T.alphaTest>0,he=T.clearcoat>0,Ce=T.iridescence>0;return{isWebGL2:c,shaderID:B,shaderName:T.type,vertexShader:Y,fragmentShader:le,defines:T.defines,customVertexShaderID:oe,customFragmentShaderID:re,isRawShaderMaterial:T.isRawShaderMaterial===!0,glslVersion:T.glslVersion,precision:p,instancing:G.isInstancedMesh===!0,instancingColor:G.isInstancedMesh===!0&&G.instanceColor!==null,supportsVertexTextures:d,outputEncoding:ue===null?e.outputEncoding:ue.isXRRenderTarget===!0?ue.texture.encoding:Dp,map:!!T.map,matcap:!!T.matcap,envMap:!!ne,envMapMode:ne&&ne.mapping,envMapCubeUVHeight:K,lightMap:!!T.lightMap,aoMap:!!T.aoMap,emissiveMap:!!T.emissiveMap,bumpMap:!!T.bumpMap,normalMap:!!T.normalMap,objectSpaceNormalMap:T.normalMapType===p9,tangentSpaceNormalMap:T.normalMapType===Fp,decodeVideoTexture:!!T.map&&T.map.isVideoTexture===!0&&T.map.encoding===Ur,clearcoat:he,clearcoatMap:he&&!!T.clearcoatMap,clearcoatRoughnessMap:he&&!!T.clearcoatRoughnessMap,clearcoatNormalMap:he&&!!T.clearcoatNormalMap,iridescence:Ce,iridescenceMap:Ce&&!!T.iridescenceMap,iridescenceThicknessMap:Ce&&!!T.iridescenceThicknessMap,displacementMap:!!T.displacementMap,roughnessMap:!!T.roughnessMap,metalnessMap:!!T.metalnessMap,specularMap:!!T.specularMap,specularIntensityMap:!!T.specularIntensityMap,specularColorMap:!!T.specularColorMap,opaque:T.transparent===!1&&T.blending===Mg,alphaMap:!!T.alphaMap,alphaTest:me,gradientMap:!!T.gradientMap,sheen:T.sheen>0,sheenColorMap:!!T.sheenColorMap,sheenRoughnessMap:!!T.sheenRoughnessMap,transmission:T.transmission>0,transmissionMap:!!T.transmissionMap,thicknessMap:!!T.thicknessMap,combine:T.combine,vertexTangents:!!T.normalMap&&!!j.attributes.tangent,vertexColors:T.vertexColors,vertexAlphas:T.vertexColors===!0&&!!j.attributes.color&&j.attributes.color.itemSize===4,vertexUvs:!!T.map||!!T.bumpMap||!!T.normalMap||!!T.specularMap||!!T.alphaMap||!!T.emissiveMap||!!T.roughnessMap||!!T.metalnessMap||!!T.clearcoatMap||!!T.clearcoatRoughnessMap||!!T.clearcoatNormalMap||!!T.iridescenceMap||!!T.iridescenceThicknessMap||!!T.displacementMap||!!T.transmissionMap||!!T.thicknessMap||!!T.specularIntensityMap||!!T.specularColorMap||!!T.sheenColorMap||!!T.sheenRoughnessMap,uvsVertexOnly:!(T.map||T.bumpMap||T.normalMap||T.specularMap||T.alphaMap||T.emissiveMap||T.roughnessMap||T.metalnessMap||T.clearcoatNormalMap||T.iridescenceMap||T.iridescenceThicknessMap||T.transmission>0||T.transmissionMap||T.thicknessMap||T.specularIntensityMap||T.specularColorMap||T.sheen>0||T.sheenColorMap||T.sheenRoughnessMap)&&!!T.displacementMap,fog:!!V,useFog:T.fog===!0,fogExp2:V&&V.isFogExp2,flatShading:!!T.flatShading,sizeAttenuation:T.sizeAttenuation,logarithmicDepthBuffer:h,skinning:G.isSkinnedMesh===!0,morphTargets:j.morphAttributes.position!==void 0,morphNormals:j.morphAttributes.normal!==void 0,morphColors:j.morphAttributes.color!==void 0,morphTargetsCount:F,morphTextureStride:X,numDirLights:D.directional.length,numPointLights:D.point.length,numSpotLights:D.spot.length,numSpotLightMaps:D.spotLightMap.length,numRectAreaLights:D.rectArea.length,numHemiLights:D.hemi.length,numDirLightShadows:D.directionalShadowMap.length,numPointLightShadows:D.pointShadowMap.length,numSpotLightShadows:D.spotShadowMap.length,numSpotLightShadowsWithMaps:D.numSpotLightShadowsWithMaps,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:T.dithering,shadowMapEnabled:e.shadowMap.enabled&&L.length>0,shadowMapType:e.shadowMap.type,toneMapping:T.toneMapped?e.toneMapping:Nu,useLegacyLights:e.useLegacyLights,premultipliedAlpha:T.premultipliedAlpha,doubleSided:T.side===Nc,flipSided:T.side===jo,useDepthPacking:!!T.depthPacking,depthPacking:T.depthPacking||0,index0AttributeName:T.index0AttributeName,extensionDerivatives:T.extensions&&T.extensions.derivatives,extensionFragDepth:T.extensions&&T.extensions.fragDepth,extensionDrawBuffers:T.extensions&&T.extensions.drawBuffers,extensionShaderTextureLOD:T.extensions&&T.extensions.shaderTextureLOD,rendererExtensionFragDepth:c||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:c||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:c||r.has("EXT_shader_texture_lod"),customProgramCacheKey:T.customProgramCacheKey()}}function g(T){const D=[];if(T.shaderID?D.push(T.shaderID):(D.push(T.customVertexShaderID),D.push(T.customFragmentShaderID)),T.defines!==void 0)for(const L in T.defines)D.push(L),D.push(T.defines[L]);return T.isRawShaderMaterial===!1&&(w(D,T),S(D,T),D.push(e.outputEncoding)),D.push(T.customProgramCacheKey),D.join()}function w(T,D){T.push(D.precision),T.push(D.outputEncoding),T.push(D.envMapMode),T.push(D.envMapCubeUVHeight),T.push(D.combine),T.push(D.vertexUvs),T.push(D.fogExp2),T.push(D.sizeAttenuation),T.push(D.morphTargetsCount),T.push(D.morphAttributeCount),T.push(D.numDirLights),T.push(D.numPointLights),T.push(D.numSpotLights),T.push(D.numSpotLightMaps),T.push(D.numHemiLights),T.push(D.numRectAreaLights),T.push(D.numDirLightShadows),T.push(D.numPointLightShadows),T.push(D.numSpotLightShadows),T.push(D.numSpotLightShadowsWithMaps),T.push(D.shadowMapType),T.push(D.toneMapping),T.push(D.numClippingPlanes),T.push(D.numClipIntersection),T.push(D.depthPacking)}function S(T,D){o.disableAll(),D.isWebGL2&&o.enable(0),D.supportsVertexTextures&&o.enable(1),D.instancing&&o.enable(2),D.instancingColor&&o.enable(3),D.map&&o.enable(4),D.matcap&&o.enable(5),D.envMap&&o.enable(6),D.lightMap&&o.enable(7),D.aoMap&&o.enable(8),D.emissiveMap&&o.enable(9),D.bumpMap&&o.enable(10),D.normalMap&&o.enable(11),D.objectSpaceNormalMap&&o.enable(12),D.tangentSpaceNormalMap&&o.enable(13),D.clearcoat&&o.enable(14),D.clearcoatMap&&o.enable(15),D.clearcoatRoughnessMap&&o.enable(16),D.clearcoatNormalMap&&o.enable(17),D.iridescence&&o.enable(18),D.iridescenceMap&&o.enable(19),D.iridescenceThicknessMap&&o.enable(20),D.displacementMap&&o.enable(21),D.specularMap&&o.enable(22),D.roughnessMap&&o.enable(23),D.metalnessMap&&o.enable(24),D.gradientMap&&o.enable(25),D.alphaMap&&o.enable(26),D.alphaTest&&o.enable(27),D.vertexColors&&o.enable(28),D.vertexAlphas&&o.enable(29),D.vertexUvs&&o.enable(30),D.vertexTangents&&o.enable(31),D.uvsVertexOnly&&o.enable(32),T.push(o.mask),o.disableAll(),D.fog&&o.enable(0),D.useFog&&o.enable(1),D.flatShading&&o.enable(2),D.logarithmicDepthBuffer&&o.enable(3),D.skinning&&o.enable(4),D.morphTargets&&o.enable(5),D.morphNormals&&o.enable(6),D.morphColors&&o.enable(7),D.premultipliedAlpha&&o.enable(8),D.shadowMapEnabled&&o.enable(9),D.useLegacyLights&&o.enable(10),D.doubleSided&&o.enable(11),D.flipSided&&o.enable(12),D.useDepthPacking&&o.enable(13),D.dithering&&o.enable(14),D.specularIntensityMap&&o.enable(15),D.specularColorMap&&o.enable(16),D.transmission&&o.enable(17),D.transmissionMap&&o.enable(18),D.thicknessMap&&o.enable(19),D.sheen&&o.enable(20),D.sheenColorMap&&o.enable(21),D.sheenRoughnessMap&&o.enable(22),D.decodeVideoTexture&&o.enable(23),D.opaque&&o.enable(24),T.push(o.mask)}function _(T){const D=m[T.type];let L;if(D){const z=Lu[D];L=_9.clone(z.uniforms)}else L=T.uniforms;return L}function A(T,D){let L;for(let z=0,G=u.length;z<G;z++){const V=u[z];if(V.cacheKey===D){L=V,++L.usedTimes;break}}return L===void 0&&(L=new Gae(e,D,T,s),u.push(L)),L}function C(T){if(--T.usedTimes===0){const D=u.indexOf(T);u[D]=u[u.length-1],u.pop(),T.destroy()}}function E(T){l.remove(T)}function I(){l.dispose()}return{getParameters:v,getProgramCacheKey:g,getUniforms:_,acquireProgram:A,releaseProgram:C,releaseShaderCache:E,programs:u,dispose:I}}function Kae(){let e=new WeakMap;function t(s){let a=e.get(s);return a===void 0&&(a={},e.set(s,a)),a}function i(s){e.delete(s)}function r(s,a,o){e.get(s)[a]=o}function n(){e=new WeakMap}return{get:t,remove:i,update:r,dispose:n}}function Zae(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function GF(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function qF(){const e=[];let t=0;const i=[],r=[],n=[];function s(){t=0,i.length=0,r.length=0,n.length=0}function a(h,d,p,m,v,g){let w=e[t];return w===void 0?(w={id:h.id,object:h,geometry:d,material:p,groupOrder:m,renderOrder:h.renderOrder,z:v,group:g},e[t]=w):(w.id=h.id,w.object=h,w.geometry=d,w.material=p,w.groupOrder=m,w.renderOrder=h.renderOrder,w.z=v,w.group=g),t++,w}function o(h,d,p,m,v,g){const w=a(h,d,p,m,v,g);p.transmission>0?r.push(w):p.transparent===!0?n.push(w):i.push(w)}function l(h,d,p,m,v,g){const w=a(h,d,p,m,v,g);p.transmission>0?r.unshift(w):p.transparent===!0?n.unshift(w):i.unshift(w)}function u(h,d){i.length>1&&i.sort(h||Zae),r.length>1&&r.sort(d||GF),n.length>1&&n.sort(d||GF)}function c(){for(let h=t,d=e.length;h<d;h++){const p=e[h];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:i,transmissive:r,transparent:n,init:s,push:o,unshift:l,finish:c,sort:u}}function Jae(){let e=new WeakMap;function t(r,n){const s=e.get(r);let a;return s===void 0?(a=new qF,e.set(r,[a])):n>=s.length?(a=new qF,s.push(a)):a=s[n],a}function i(){e=new WeakMap}return{get:t,dispose:i}}function $ae(){const e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new pe,color:new qt};break;case"SpotLight":i={position:new pe,direction:new pe,color:new qt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new pe,color:new qt,distance:0,decay:0};break;case"HemisphereLight":i={direction:new pe,skyColor:new qt,groundColor:new qt};break;case"RectAreaLight":i={color:new qt,position:new pe,halfWidth:new pe,halfHeight:new pe};break}return e[t.id]=i,i}}}function eoe(){const e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ft};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ft};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ft,shadowCameraNear:1,shadowCameraFar:1e3};break}return e[t.id]=i,i}}}let toe=0;function ioe(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function roe(e,t){const i=new $ae,r=eoe(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let c=0;c<9;c++)n.probe.push(new pe);const s=new pe,a=new Oi,o=new Oi;function l(c,h){let d=0,p=0,m=0;for(let z=0;z<9;z++)n.probe[z].set(0,0,0);let v=0,g=0,w=0,S=0,_=0,A=0,C=0,E=0,I=0,T=0;c.sort(ioe);const D=h===!0?Math.PI:1;for(let z=0,G=c.length;z<G;z++){const V=c[z],j=V.color,J=V.intensity,ne=V.distance,K=V.shadow&&V.shadow.map?V.shadow.map.texture:null;if(V.isAmbientLight)d+=j.r*J*D,p+=j.g*J*D,m+=j.b*J*D;else if(V.isLightProbe)for(let B=0;B<9;B++)n.probe[B].addScaledVector(V.sh.coefficients[B],J);else if(V.isDirectionalLight){const B=i.get(V);if(B.color.copy(V.color).multiplyScalar(V.intensity*D),V.castShadow){const Z=V.shadow,F=r.get(V);F.shadowBias=Z.bias,F.shadowNormalBias=Z.normalBias,F.shadowRadius=Z.radius,F.shadowMapSize=Z.mapSize,n.directionalShadow[v]=F,n.directionalShadowMap[v]=K,n.directionalShadowMatrix[v]=V.shadow.matrix,A++}n.directional[v]=B,v++}else if(V.isSpotLight){const B=i.get(V);B.position.setFromMatrixPosition(V.matrixWorld),B.color.copy(j).multiplyScalar(J*D),B.distance=ne,B.coneCos=Math.cos(V.angle),B.penumbraCos=Math.cos(V.angle*(1-V.penumbra)),B.decay=V.decay,n.spot[w]=B;const Z=V.shadow;if(V.map&&(n.spotLightMap[I]=V.map,I++,Z.updateMatrices(V),V.castShadow&&T++),n.spotLightMatrix[w]=Z.matrix,V.castShadow){const F=r.get(V);F.shadowBias=Z.bias,F.shadowNormalBias=Z.normalBias,F.shadowRadius=Z.radius,F.shadowMapSize=Z.mapSize,n.spotShadow[w]=F,n.spotShadowMap[w]=K,E++}w++}else if(V.isRectAreaLight){const B=i.get(V);B.color.copy(j).multiplyScalar(J),B.halfWidth.set(V.width*.5,0,0),B.halfHeight.set(0,V.height*.5,0),n.rectArea[S]=B,S++}else if(V.isPointLight){const B=i.get(V);if(B.color.copy(V.color).multiplyScalar(V.intensity*D),B.distance=V.distance,B.decay=V.decay,V.castShadow){const Z=V.shadow,F=r.get(V);F.shadowBias=Z.bias,F.shadowNormalBias=Z.normalBias,F.shadowRadius=Z.radius,F.shadowMapSize=Z.mapSize,F.shadowCameraNear=Z.camera.near,F.shadowCameraFar=Z.camera.far,n.pointShadow[g]=F,n.pointShadowMap[g]=K,n.pointShadowMatrix[g]=V.shadow.matrix,C++}n.point[g]=B,g++}else if(V.isHemisphereLight){const B=i.get(V);B.skyColor.copy(V.color).multiplyScalar(J*D),B.groundColor.copy(V.groundColor).multiplyScalar(J*D),n.hemi[_]=B,_++}}S>0&&(t.isWebGL2||e.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=Bt.LTC_FLOAT_1,n.rectAreaLTC2=Bt.LTC_FLOAT_2):e.has("OES_texture_half_float_linear")===!0?(n.rectAreaLTC1=Bt.LTC_HALF_1,n.rectAreaLTC2=Bt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=d,n.ambient[1]=p,n.ambient[2]=m;const L=n.hash;(L.directionalLength!==v||L.pointLength!==g||L.spotLength!==w||L.rectAreaLength!==S||L.hemiLength!==_||L.numDirectionalShadows!==A||L.numPointShadows!==C||L.numSpotShadows!==E||L.numSpotMaps!==I)&&(n.directional.length=v,n.spot.length=w,n.rectArea.length=S,n.point.length=g,n.hemi.length=_,n.directionalShadow.length=A,n.directionalShadowMap.length=A,n.pointShadow.length=C,n.pointShadowMap.length=C,n.spotShadow.length=E,n.spotShadowMap.length=E,n.directionalShadowMatrix.length=A,n.pointShadowMatrix.length=C,n.spotLightMatrix.length=E+I-T,n.spotLightMap.length=I,n.numSpotLightShadowsWithMaps=T,L.directionalLength=v,L.pointLength=g,L.spotLength=w,L.rectAreaLength=S,L.hemiLength=_,L.numDirectionalShadows=A,L.numPointShadows=C,L.numSpotShadows=E,L.numSpotMaps=I,n.version=toe++)}function u(c,h){let d=0,p=0,m=0,v=0,g=0;const w=h.matrixWorldInverse;for(let S=0,_=c.length;S<_;S++){const A=c[S];if(A.isDirectionalLight){const C=n.directional[d];C.direction.setFromMatrixPosition(A.matrixWorld),s.setFromMatrixPosition(A.target.matrixWorld),C.direction.sub(s),C.direction.transformDirection(w),d++}else if(A.isSpotLight){const C=n.spot[m];C.position.setFromMatrixPosition(A.matrixWorld),C.position.applyMatrix4(w),C.direction.setFromMatrixPosition(A.matrixWorld),s.setFromMatrixPosition(A.target.matrixWorld),C.direction.sub(s),C.direction.transformDirection(w),m++}else if(A.isRectAreaLight){const C=n.rectArea[v];C.position.setFromMatrixPosition(A.matrixWorld),C.position.applyMatrix4(w),o.identity(),a.copy(A.matrixWorld),a.premultiply(w),o.extractRotation(a),C.halfWidth.set(A.width*.5,0,0),C.halfHeight.set(0,A.height*.5,0),C.halfWidth.applyMatrix4(o),C.halfHeight.applyMatrix4(o),v++}else if(A.isPointLight){const C=n.point[p];C.position.setFromMatrixPosition(A.matrixWorld),C.position.applyMatrix4(w),p++}else if(A.isHemisphereLight){const C=n.hemi[g];C.direction.setFromMatrixPosition(A.matrixWorld),C.direction.transformDirection(w),g++}}}return{setup:l,setupView:u,state:n}}function XF(e,t){const i=new roe(e,t),r=[],n=[];function s(){r.length=0,n.length=0}function a(h){r.push(h)}function o(h){n.push(h)}function l(h){i.setup(r,h)}function u(h){i.setupView(r,h)}return{init:s,state:{lightsArray:r,shadowsArray:n,lights:i},setupLights:l,setupLightsView:u,pushLight:a,pushShadow:o}}function noe(e,t){let i=new WeakMap;function r(s,a=0){const o=i.get(s);let l;return o===void 0?(l=new XF(e,t),i.set(s,[l])):a>=o.length?(l=new XF(e,t),o.push(l)):l=o[a],l}function n(){i=new WeakMap}return{get:r,dispose:n}}class gz extends wa{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=d9,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class vz extends wa{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new pe,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}const soe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,aoe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function ooe(e,t,i){let r=new TC;const n=new ft,s=new ft,a=new _r,o=new gz({depthPacking:f9}),l=new vz,u={},c=i.maxTextureSize,h={[Ed]:jo,[jo]:Ed,[Nc]:Nc},d=new Kc({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ft},radius:{value:4}},vertexShader:soe,fragmentShader:aoe}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const m=new Fi;m.setAttribute("position",new kr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const v=new js(m,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=MC,this.render=function(A,C,E){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||A.length===0)return;const I=e.getRenderTarget(),T=e.getActiveCubeFace(),D=e.getActiveMipmapLevel(),L=e.state;L.setBlending(_d),L.buffers.color.setClear(1,1,1,1),L.buffers.depth.setTest(!0),L.setScissorTest(!1);for(let z=0,G=A.length;z<G;z++){const V=A[z],j=V.shadow;if(j===void 0){console.warn("THREE.WebGLShadowMap:",V,"has no shadow.");continue}if(j.autoUpdate===!1&&j.needsUpdate===!1)continue;n.copy(j.mapSize);const J=j.getFrameExtents();if(n.multiply(J),s.copy(j.mapSize),(n.x>c||n.y>c)&&(n.x>c&&(s.x=Math.floor(c/J.x),n.x=s.x*J.x,j.mapSize.x=s.x),n.y>c&&(s.y=Math.floor(c/J.y),n.y=s.y*J.y,j.mapSize.y=s.y)),j.map===null){const K=this.type!==ug?{minFilter:Ln,magFilter:Ln}:{};j.map=new Vu(n.x,n.y,K),j.map.texture.name=V.name+".shadowMap",j.camera.updateProjectionMatrix()}e.setRenderTarget(j.map),e.clear();const ne=j.getViewportCount();for(let K=0;K<ne;K++){const B=j.getViewport(K);a.set(s.x*B.x,s.y*B.y,s.x*B.z,s.y*B.w),L.viewport(a),j.updateMatrices(V,K),r=j.getFrustum(),_(C,E,j.camera,V,this.type)}j.isPointLightShadow!==!0&&this.type===ug&&w(j,E),j.needsUpdate=!1}g.needsUpdate=!1,e.setRenderTarget(I,T,D)};function w(A,C){const E=t.update(v);d.defines.VSM_SAMPLES!==A.blurSamples&&(d.defines.VSM_SAMPLES=A.blurSamples,p.defines.VSM_SAMPLES=A.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),A.mapPass===null&&(A.mapPass=new Vu(n.x,n.y)),d.uniforms.shadow_pass.value=A.map.texture,d.uniforms.resolution.value=A.mapSize,d.uniforms.radius.value=A.radius,e.setRenderTarget(A.mapPass),e.clear(),e.renderBufferDirect(C,null,E,d,v,null),p.uniforms.shadow_pass.value=A.mapPass.texture,p.uniforms.resolution.value=A.mapSize,p.uniforms.radius.value=A.radius,e.setRenderTarget(A.map),e.clear(),e.renderBufferDirect(C,null,E,p,v,null)}function S(A,C,E,I,T,D){let L=null;const z=E.isPointLight===!0?A.customDistanceMaterial:A.customDepthMaterial;if(z!==void 0)L=z;else if(L=E.isPointLight===!0?l:o,e.localClippingEnabled&&C.clipShadows===!0&&Array.isArray(C.clippingPlanes)&&C.clippingPlanes.length!==0||C.displacementMap&&C.displacementScale!==0||C.alphaMap&&C.alphaTest>0||C.map&&C.alphaTest>0){const G=L.uuid,V=C.uuid;let j=u[G];j===void 0&&(j={},u[G]=j);let J=j[V];J===void 0&&(J=L.clone(),j[V]=J),L=J}return L.visible=C.visible,L.wireframe=C.wireframe,D===ug?L.side=C.shadowSide!==null?C.shadowSide:C.side:L.side=C.shadowSide!==null?C.shadowSide:h[C.side],L.alphaMap=C.alphaMap,L.alphaTest=C.alphaTest,L.map=C.map,L.clipShadows=C.clipShadows,L.clippingPlanes=C.clippingPlanes,L.clipIntersection=C.clipIntersection,L.displacementMap=C.displacementMap,L.displacementScale=C.displacementScale,L.displacementBias=C.displacementBias,L.wireframeLinewidth=C.wireframeLinewidth,L.linewidth=C.linewidth,E.isPointLight===!0&&L.isMeshDistanceMaterial===!0&&(L.referencePosition.setFromMatrixPosition(E.matrixWorld),L.nearDistance=I,L.farDistance=T),L}function _(A,C,E,I,T){if(A.visible===!1)return;if(A.layers.test(C.layers)&&(A.isMesh||A.isLine||A.isPoints)&&(A.castShadow||A.receiveShadow&&T===ug)&&(!A.frustumCulled||r.intersectsObject(A))){A.modelViewMatrix.multiplyMatrices(E.matrixWorldInverse,A.matrixWorld);const z=t.update(A),G=A.material;if(Array.isArray(G)){const V=z.groups;for(let j=0,J=V.length;j<J;j++){const ne=V[j],K=G[ne.materialIndex];if(K&&K.visible){const B=S(A,K,I,E.near,E.far,T);e.renderBufferDirect(E,null,z,B,A,ne)}}}else if(G.visible){const V=S(A,G,I,E.near,E.far,T);e.renderBufferDirect(E,null,z,V,A,null)}}const L=A.children;for(let z=0,G=L.length;z<G;z++)_(L[z],C,E,I,T)}}function loe(e,t,i){const r=i.isWebGL2;function n(){let ie=!1;const we=new _r;let Re=null;const We=new _r(0,0,0,0);return{setMask:function(ct){Re!==ct&&!ie&&(e.colorMask(ct,ct,ct,ct),Re=ct)},setLocked:function(ct){ie=ct},setClear:function(ct,Ut,si,Si,ar){ar===!0&&(ct*=Si,Ut*=Si,si*=Si),we.set(ct,Ut,si,Si),We.equals(we)===!1&&(e.clearColor(ct,Ut,si,Si),We.copy(we))},reset:function(){ie=!1,Re=null,We.set(-1,0,0,0)}}}function s(){let ie=!1,we=null,Re=null,We=null;return{setTest:function(ct){ct?me(2929):he(2929)},setMask:function(ct){we!==ct&&!ie&&(e.depthMask(ct),we=ct)},setFunc:function(ct){if(Re!==ct){switch(ct){case z8:e.depthFunc(512);break;case k8:e.depthFunc(519);break;case B8:e.depthFunc(513);break;case $E:e.depthFunc(515);break;case N8:e.depthFunc(514);break;case F8:e.depthFunc(518);break;case U8:e.depthFunc(516);break;case V8:e.depthFunc(517);break;default:e.depthFunc(515)}Re=ct}},setLocked:function(ct){ie=ct},setClear:function(ct){We!==ct&&(e.clearDepth(ct),We=ct)},reset:function(){ie=!1,we=null,Re=null,We=null}}}function a(){let ie=!1,we=null,Re=null,We=null,ct=null,Ut=null,si=null,Si=null,ar=null;return{setTest:function(ri){ie||(ri?me(2960):he(2960))},setMask:function(ri){we!==ri&&!ie&&(e.stencilMask(ri),we=ri)},setFunc:function(ri,Yi,ji){(Re!==ri||We!==Yi||ct!==ji)&&(e.stencilFunc(ri,Yi,ji),Re=ri,We=Yi,ct=ji)},setOp:function(ri,Yi,ji){(Ut!==ri||si!==Yi||Si!==ji)&&(e.stencilOp(ri,Yi,ji),Ut=ri,si=Yi,Si=ji)},setLocked:function(ri){ie=ri},setClear:function(ri){ar!==ri&&(e.clearStencil(ri),ar=ri)},reset:function(){ie=!1,we=null,Re=null,We=null,ct=null,Ut=null,si=null,Si=null,ar=null}}}const o=new n,l=new s,u=new a,c=new WeakMap,h=new WeakMap;let d={},p={},m=new WeakMap,v=[],g=null,w=!1,S=null,_=null,A=null,C=null,E=null,I=null,T=null,D=!1,L=null,z=null,G=null,V=null,j=null;const J=e.getParameter(35661);let ne=!1,K=0;const B=e.getParameter(7938);B.indexOf("WebGL")!==-1?(K=parseFloat(/^WebGL (\d)/.exec(B)[1]),ne=K>=1):B.indexOf("OpenGL ES")!==-1&&(K=parseFloat(/^OpenGL ES (\d)/.exec(B)[1]),ne=K>=2);let Z=null,F={};const X=e.getParameter(3088),Y=e.getParameter(2978),le=new _r().fromArray(X),oe=new _r().fromArray(Y);function re(ie,we,Re){const We=new Uint8Array(4),ct=e.createTexture();e.bindTexture(ie,ct),e.texParameteri(ie,10241,9728),e.texParameteri(ie,10240,9728);for(let Ut=0;Ut<Re;Ut++)e.texImage2D(we+Ut,0,6408,1,1,0,6408,5121,We);return ct}const ue={};ue[3553]=re(3553,3553,1),ue[34067]=re(34067,34069,6),o.setClear(0,0,0,1),l.setClear(1),u.setClear(0),me(2929),l.setFunc($E),Qe(!1),ot(IR),me(2884),Ve(_d);function me(ie){d[ie]!==!0&&(e.enable(ie),d[ie]=!0)}function he(ie){d[ie]!==!1&&(e.disable(ie),d[ie]=!1)}function Ce(ie,we){return p[ie]!==we?(e.bindFramebuffer(ie,we),p[ie]=we,r&&(ie===36009&&(p[36160]=we),ie===36160&&(p[36009]=we)),!0):!1}function Ae(ie,we){let Re=v,We=!1;if(ie)if(Re=m.get(we),Re===void 0&&(Re=[],m.set(we,Re)),ie.isWebGLMultipleRenderTargets){const ct=ie.texture;if(Re.length!==ct.length||Re[0]!==36064){for(let Ut=0,si=ct.length;Ut<si;Ut++)Re[Ut]=36064+Ut;Re.length=ct.length,We=!0}}else Re[0]!==36064&&(Re[0]=36064,We=!0);else Re[0]!==1029&&(Re[0]=1029,We=!0);We&&(i.isWebGL2?e.drawBuffers(Re):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(Re))}function Ie(ie){return g!==ie?(e.useProgram(ie),g=ie,!0):!1}const Me={[tg]:32774,[M8]:32778,[A8]:32779};if(r)Me[kR]=32775,Me[BR]=32776;else{const ie=t.get("EXT_blend_minmax");ie!==null&&(Me[kR]=ie.MIN_EXT,Me[BR]=ie.MAX_EXT)}const De={[E8]:0,[C8]:1,[T8]:768,[tz]:770,[O8]:776,[I8]:774,[D8]:772,[P8]:769,[iz]:771,[L8]:775,[R8]:773};function Ve(ie,we,Re,We,ct,Ut,si,Si){if(ie===_d){w===!0&&(he(3042),w=!1);return}if(w===!1&&(me(3042),w=!0),ie!==S8){if(ie!==S||Si!==D){if((_!==tg||E!==tg)&&(e.blendEquation(32774),_=tg,E=tg),Si)switch(ie){case Mg:e.blendFuncSeparate(1,771,1,771);break;case LR:e.blendFunc(1,1);break;case OR:e.blendFuncSeparate(0,769,0,1);break;case zR:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",ie);break}else switch(ie){case Mg:e.blendFuncSeparate(770,771,1,771);break;case LR:e.blendFunc(770,1);break;case OR:e.blendFuncSeparate(0,769,0,1);break;case zR:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",ie);break}A=null,C=null,I=null,T=null,S=ie,D=Si}return}ct=ct||we,Ut=Ut||Re,si=si||We,(we!==_||ct!==E)&&(e.blendEquationSeparate(Me[we],Me[ct]),_=we,E=ct),(Re!==A||We!==C||Ut!==I||si!==T)&&(e.blendFuncSeparate(De[Re],De[We],De[Ut],De[si]),A=Re,C=We,I=Ut,T=si),S=ie,D=!1}function Ge(ie,we){ie.side===Nc?he(2884):me(2884);let Re=ie.side===jo;we&&(Re=!Re),Qe(Re),ie.blending===Mg&&ie.transparent===!1?Ve(_d):Ve(ie.blending,ie.blendEquation,ie.blendSrc,ie.blendDst,ie.blendEquationAlpha,ie.blendSrcAlpha,ie.blendDstAlpha,ie.premultipliedAlpha),l.setFunc(ie.depthFunc),l.setTest(ie.depthTest),l.setMask(ie.depthWrite),o.setMask(ie.colorWrite);const We=ie.stencilWrite;u.setTest(We),We&&(u.setMask(ie.stencilWriteMask),u.setFunc(ie.stencilFunc,ie.stencilRef,ie.stencilFuncMask),u.setOp(ie.stencilFail,ie.stencilZFail,ie.stencilZPass)),Ke(ie.polygonOffset,ie.polygonOffsetFactor,ie.polygonOffsetUnits),ie.alphaToCoverage===!0?me(32926):he(32926)}function Qe(ie){L!==ie&&(ie?e.frontFace(2304):e.frontFace(2305),L=ie)}function ot(ie){ie!==w8?(me(2884),ie!==z&&(ie===IR?e.cullFace(1029):ie===b8?e.cullFace(1028):e.cullFace(1032))):he(2884),z=ie}function $e(ie){ie!==G&&(ne&&e.lineWidth(ie),G=ie)}function Ke(ie,we,Re){ie?(me(32823),(V!==we||j!==Re)&&(e.polygonOffset(we,Re),V=we,j=Re)):he(32823)}function bt(ie){ie?me(3089):he(3089)}function xt(ie){ie===void 0&&(ie=33984+J-1),Z!==ie&&(e.activeTexture(ie),Z=ie)}function q(ie,we,Re){Re===void 0&&(Z===null?Re=33984+J-1:Re=Z);let We=F[Re];We===void 0&&(We={type:void 0,texture:void 0},F[Re]=We),(We.type!==ie||We.texture!==we)&&(Z!==Re&&(e.activeTexture(Re),Z=Re),e.bindTexture(ie,we||ue[ie]),We.type=ie,We.texture=we)}function N(){const ie=F[Z];ie!==void 0&&ie.type!==void 0&&(e.bindTexture(ie.type,null),ie.type=void 0,ie.texture=void 0)}function de(){try{e.compressedTexImage2D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function ze(){try{e.compressedTexImage3D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function $(){try{e.texSubImage2D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function Ue(){try{e.texSubImage3D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function rt(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function Ye(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function Ee(){try{e.texStorage2D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function lt(){try{e.texStorage3D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function et(){try{e.texImage2D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function pt(){try{e.texImage3D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function mt(ie){le.equals(ie)===!1&&(e.scissor(ie.x,ie.y,ie.z,ie.w),le.copy(ie))}function dt(ie){oe.equals(ie)===!1&&(e.viewport(ie.x,ie.y,ie.z,ie.w),oe.copy(ie))}function _e(ie,we){let Re=h.get(we);Re===void 0&&(Re=new WeakMap,h.set(we,Re));let We=Re.get(ie);We===void 0&&(We=e.getUniformBlockIndex(we,ie.name),Re.set(ie,We))}function it(ie,we){const We=h.get(we).get(ie);c.get(we)!==We&&(e.uniformBlockBinding(we,We,ie.__bindingPointIndex),c.set(we,We))}function At(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),r===!0&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),d={},Z=null,F={},p={},m=new WeakMap,v=[],g=null,w=!1,S=null,_=null,A=null,C=null,E=null,I=null,T=null,D=!1,L=null,z=null,G=null,V=null,j=null,le.set(0,0,e.canvas.width,e.canvas.height),oe.set(0,0,e.canvas.width,e.canvas.height),o.reset(),l.reset(),u.reset()}return{buffers:{color:o,depth:l,stencil:u},enable:me,disable:he,bindFramebuffer:Ce,drawBuffers:Ae,useProgram:Ie,setBlending:Ve,setMaterial:Ge,setFlipSided:Qe,setCullFace:ot,setLineWidth:$e,setPolygonOffset:Ke,setScissorTest:bt,activeTexture:xt,bindTexture:q,unbindTexture:N,compressedTexImage2D:de,compressedTexImage3D:ze,texImage2D:et,texImage3D:pt,updateUBOMapping:_e,uniformBlockBinding:it,texStorage2D:Ee,texStorage3D:lt,texSubImage2D:$,texSubImage3D:Ue,compressedTexSubImage2D:rt,compressedTexSubImage3D:Ye,scissor:mt,viewport:dt,reset:At}}function uoe(e,t,i,r,n,s,a){const o=n.isWebGL2,l=n.maxTextures,u=n.maxCubemapSize,c=n.maxTextureSize,h=n.maxSamples,d=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,p=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),m=new WeakMap;let v;const g=new WeakMap;let w=!1;try{w=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function S(q,N){return w?new OffscreenCanvas(q,N):Lb("canvas")}function _(q,N,de,ze){let $=1;if((q.width>ze||q.height>ze)&&($=ze/Math.max(q.width,q.height)),$<1||N===!0)if(typeof HTMLImageElement<"u"&&q instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&q instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&q instanceof ImageBitmap){const Ue=N?v9:Math.floor,rt=Ue($*q.width),Ye=Ue($*q.height);v===void 0&&(v=S(rt,Ye));const Ee=de?S(rt,Ye):v;return Ee.width=rt,Ee.height=Ye,Ee.getContext("2d").drawImage(q,0,0,rt,Ye),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+q.width+"x"+q.height+") to ("+rt+"x"+Ye+")."),Ee}else return"data"in q&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+q.width+"x"+q.height+")."),q;return q}function A(q){return lI(q.width)&&lI(q.height)}function C(q){return o?!1:q.wrapS!==Oa||q.wrapT!==Oa||q.minFilter!==Ln&&q.minFilter!==On}function E(q,N){return q.generateMipmaps&&N&&q.minFilter!==Ln&&q.minFilter!==On}function I(q){e.generateMipmap(q)}function T(q,N,de,ze,$=!1){if(o===!1)return N;if(q!==null){if(e[q]!==void 0)return e[q];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+q+"'")}let Ue=N;return N===6403&&(de===5126&&(Ue=33326),de===5131&&(Ue=33325),de===5121&&(Ue=33321)),N===33319&&(de===5126&&(Ue=33328),de===5131&&(Ue=33327),de===5121&&(Ue=33323)),N===6408&&(de===5126&&(Ue=34836),de===5131&&(Ue=34842),de===5121&&(Ue=ze===Ur&&$===!1?35907:32856),de===32819&&(Ue=32854),de===32820&&(Ue=32855)),(Ue===33325||Ue===33326||Ue===33327||Ue===33328||Ue===34842||Ue===34836)&&t.get("EXT_color_buffer_float"),Ue}function D(q,N,de){return E(q,de)===!0||q.isFramebufferTexture&&q.minFilter!==Ln&&q.minFilter!==On?Math.log2(Math.max(N.width,N.height))+1:q.mipmaps!==void 0&&q.mipmaps.length>0?q.mipmaps.length:q.isCompressedTexture&&Array.isArray(q.image)?N.mipmaps.length:1}function L(q){return q===Ln||q===e2||q===Jw?9728:9729}function z(q){const N=q.target;N.removeEventListener("dispose",z),V(N),N.isVideoTexture&&m.delete(N)}function G(q){const N=q.target;N.removeEventListener("dispose",G),J(N)}function V(q){const N=r.get(q);if(N.__webglInit===void 0)return;const de=q.source,ze=g.get(de);if(ze){const $=ze[N.__cacheKey];$.usedTimes--,$.usedTimes===0&&j(q),Object.keys(ze).length===0&&g.delete(de)}r.remove(q)}function j(q){const N=r.get(q);e.deleteTexture(N.__webglTexture);const de=q.source,ze=g.get(de);delete ze[N.__cacheKey],a.memory.textures--}function J(q){const N=q.texture,de=r.get(q),ze=r.get(N);if(ze.__webglTexture!==void 0&&(e.deleteTexture(ze.__webglTexture),a.memory.textures--),q.depthTexture&&q.depthTexture.dispose(),q.isWebGLCubeRenderTarget)for(let $=0;$<6;$++)e.deleteFramebuffer(de.__webglFramebuffer[$]),de.__webglDepthbuffer&&e.deleteRenderbuffer(de.__webglDepthbuffer[$]);else{if(e.deleteFramebuffer(de.__webglFramebuffer),de.__webglDepthbuffer&&e.deleteRenderbuffer(de.__webglDepthbuffer),de.__webglMultisampledFramebuffer&&e.deleteFramebuffer(de.__webglMultisampledFramebuffer),de.__webglColorRenderbuffer)for(let $=0;$<de.__webglColorRenderbuffer.length;$++)de.__webglColorRenderbuffer[$]&&e.deleteRenderbuffer(de.__webglColorRenderbuffer[$]);de.__webglDepthRenderbuffer&&e.deleteRenderbuffer(de.__webglDepthRenderbuffer)}if(q.isWebGLMultipleRenderTargets)for(let $=0,Ue=N.length;$<Ue;$++){const rt=r.get(N[$]);rt.__webglTexture&&(e.deleteTexture(rt.__webglTexture),a.memory.textures--),r.remove(N[$])}r.remove(N),r.remove(q)}let ne=0;function K(){ne=0}function B(){const q=ne;return q>=l&&console.warn("THREE.WebGLTextures: Trying to use "+q+" texture units while this GPU supports only "+l),ne+=1,q}function Z(q){const N=[];return N.push(q.wrapS),N.push(q.wrapT),N.push(q.wrapR||0),N.push(q.magFilter),N.push(q.minFilter),N.push(q.anisotropy),N.push(q.internalFormat),N.push(q.format),N.push(q.type),N.push(q.generateMipmaps),N.push(q.premultiplyAlpha),N.push(q.flipY),N.push(q.unpackAlignment),N.push(q.encoding),N.join()}function F(q,N){const de=r.get(q);if(q.isVideoTexture&&bt(q),q.isRenderTargetTexture===!1&&q.version>0&&de.__version!==q.version){const ze=q.image;if(ze===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(ze.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{he(de,q,N);return}}i.bindTexture(3553,de.__webglTexture,33984+N)}function X(q,N){const de=r.get(q);if(q.version>0&&de.__version!==q.version){he(de,q,N);return}i.bindTexture(35866,de.__webglTexture,33984+N)}function Y(q,N){const de=r.get(q);if(q.version>0&&de.__version!==q.version){he(de,q,N);return}i.bindTexture(32879,de.__webglTexture,33984+N)}function le(q,N){const de=r.get(q);if(q.version>0&&de.__version!==q.version){Ce(de,q,N);return}i.bindTexture(34067,de.__webglTexture,33984+N)}const oe={[Eb]:10497,[Oa]:33071,[Cb]:33648},re={[Ln]:9728,[e2]:9984,[Jw]:9986,[On]:9729,[nz]:9985,[Pp]:9987};function ue(q,N,de){if(de?(e.texParameteri(q,10242,oe[N.wrapS]),e.texParameteri(q,10243,oe[N.wrapT]),(q===32879||q===35866)&&e.texParameteri(q,32882,oe[N.wrapR]),e.texParameteri(q,10240,re[N.magFilter]),e.texParameteri(q,10241,re[N.minFilter])):(e.texParameteri(q,10242,33071),e.texParameteri(q,10243,33071),(q===32879||q===35866)&&e.texParameteri(q,32882,33071),(N.wrapS!==Oa||N.wrapT!==Oa)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(q,10240,L(N.magFilter)),e.texParameteri(q,10241,L(N.minFilter)),N.minFilter!==Ln&&N.minFilter!==On&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),t.has("EXT_texture_filter_anisotropic")===!0){const ze=t.get("EXT_texture_filter_anisotropic");if(N.magFilter===Ln||N.minFilter!==Jw&&N.minFilter!==Pp||N.type===fd&&t.has("OES_texture_float_linear")===!1||o===!1&&N.type===ex&&t.has("OES_texture_half_float_linear")===!1)return;(N.anisotropy>1||r.get(N).__currentAnisotropy)&&(e.texParameterf(q,ze.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(N.anisotropy,n.getMaxAnisotropy())),r.get(N).__currentAnisotropy=N.anisotropy)}}function me(q,N){let de=!1;q.__webglInit===void 0&&(q.__webglInit=!0,N.addEventListener("dispose",z));const ze=N.source;let $=g.get(ze);$===void 0&&($={},g.set(ze,$));const Ue=Z(N);if(Ue!==q.__cacheKey){$[Ue]===void 0&&($[Ue]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,de=!0),$[Ue].usedTimes++;const rt=$[q.__cacheKey];rt!==void 0&&($[q.__cacheKey].usedTimes--,rt.usedTimes===0&&j(N)),q.__cacheKey=Ue,q.__webglTexture=$[Ue].texture}return de}function he(q,N,de){let ze=3553;(N.isDataArrayTexture||N.isCompressedArrayTexture)&&(ze=35866),N.isData3DTexture&&(ze=32879);const $=me(q,N),Ue=N.source;i.bindTexture(ze,q.__webglTexture,33984+de);const rt=r.get(Ue);if(Ue.version!==rt.__version||$===!0){i.activeTexture(33984+de),e.pixelStorei(37440,N.flipY),e.pixelStorei(37441,N.premultiplyAlpha),e.pixelStorei(3317,N.unpackAlignment),e.pixelStorei(37443,0);const Ye=C(N)&&A(N.image)===!1;let Ee=_(N.image,Ye,!1,c);Ee=xt(N,Ee);const lt=A(Ee)||o,et=s.convert(N.format,N.encoding);let pt=s.convert(N.type),mt=T(N.internalFormat,et,pt,N.encoding,N.isVideoTexture);ue(ze,N,lt);let dt;const _e=N.mipmaps,it=o&&N.isVideoTexture!==!0,At=rt.__version===void 0||$===!0,ie=D(N,Ee,lt);if(N.isDepthTexture)mt=6402,o?N.type===fd?mt=36012:N.type===op?mt=33190:N.type===Ag?mt=35056:mt=33189:N.type===fd&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),N.format===wp&&mt===6402&&N.type!==sz&&N.type!==op&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),N.type=op,pt=s.convert(N.type)),N.format===Ng&&mt===6402&&(mt=34041,N.type!==Ag&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),N.type=Ag,pt=s.convert(N.type))),At&&(it?i.texStorage2D(3553,1,mt,Ee.width,Ee.height):i.texImage2D(3553,0,mt,Ee.width,Ee.height,0,et,pt,null));else if(N.isDataTexture)if(_e.length>0&&lt){it&&At&&i.texStorage2D(3553,ie,mt,_e[0].width,_e[0].height);for(let we=0,Re=_e.length;we<Re;we++)dt=_e[we],it?i.texSubImage2D(3553,we,0,0,dt.width,dt.height,et,pt,dt.data):i.texImage2D(3553,we,mt,dt.width,dt.height,0,et,pt,dt.data);N.generateMipmaps=!1}else it?(At&&i.texStorage2D(3553,ie,mt,Ee.width,Ee.height),i.texSubImage2D(3553,0,0,0,Ee.width,Ee.height,et,pt,Ee.data)):i.texImage2D(3553,0,mt,Ee.width,Ee.height,0,et,pt,Ee.data);else if(N.isCompressedTexture)if(N.isCompressedArrayTexture){it&&At&&i.texStorage3D(35866,ie,mt,_e[0].width,_e[0].height,Ee.depth);for(let we=0,Re=_e.length;we<Re;we++)dt=_e[we],N.format!==ko?et!==null?it?i.compressedTexSubImage3D(35866,we,0,0,0,dt.width,dt.height,Ee.depth,et,dt.data,0,0):i.compressedTexImage3D(35866,we,mt,dt.width,dt.height,Ee.depth,0,dt.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):it?i.texSubImage3D(35866,we,0,0,0,dt.width,dt.height,Ee.depth,et,pt,dt.data):i.texImage3D(35866,we,mt,dt.width,dt.height,Ee.depth,0,et,pt,dt.data)}else{it&&At&&i.texStorage2D(3553,ie,mt,_e[0].width,_e[0].height);for(let we=0,Re=_e.length;we<Re;we++)dt=_e[we],N.format!==ko?et!==null?it?i.compressedTexSubImage2D(3553,we,0,0,dt.width,dt.height,et,dt.data):i.compressedTexImage2D(3553,we,mt,dt.width,dt.height,0,dt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):it?i.texSubImage2D(3553,we,0,0,dt.width,dt.height,et,pt,dt.data):i.texImage2D(3553,we,mt,dt.width,dt.height,0,et,pt,dt.data)}else if(N.isDataArrayTexture)it?(At&&i.texStorage3D(35866,ie,mt,Ee.width,Ee.height,Ee.depth),i.texSubImage3D(35866,0,0,0,0,Ee.width,Ee.height,Ee.depth,et,pt,Ee.data)):i.texImage3D(35866,0,mt,Ee.width,Ee.height,Ee.depth,0,et,pt,Ee.data);else if(N.isData3DTexture)it?(At&&i.texStorage3D(32879,ie,mt,Ee.width,Ee.height,Ee.depth),i.texSubImage3D(32879,0,0,0,0,Ee.width,Ee.height,Ee.depth,et,pt,Ee.data)):i.texImage3D(32879,0,mt,Ee.width,Ee.height,Ee.depth,0,et,pt,Ee.data);else if(N.isFramebufferTexture){if(At)if(it)i.texStorage2D(3553,ie,mt,Ee.width,Ee.height);else{let we=Ee.width,Re=Ee.height;for(let We=0;We<ie;We++)i.texImage2D(3553,We,mt,we,Re,0,et,pt,null),we>>=1,Re>>=1}}else if(_e.length>0&&lt){it&&At&&i.texStorage2D(3553,ie,mt,_e[0].width,_e[0].height);for(let we=0,Re=_e.length;we<Re;we++)dt=_e[we],it?i.texSubImage2D(3553,we,0,0,et,pt,dt):i.texImage2D(3553,we,mt,et,pt,dt);N.generateMipmaps=!1}else it?(At&&i.texStorage2D(3553,ie,mt,Ee.width,Ee.height),i.texSubImage2D(3553,0,0,0,et,pt,Ee)):i.texImage2D(3553,0,mt,et,pt,Ee);E(N,lt)&&I(ze),rt.__version=Ue.version,N.onUpdate&&N.onUpdate(N)}q.__version=N.version}function Ce(q,N,de){if(N.image.length!==6)return;const ze=me(q,N),$=N.source;i.bindTexture(34067,q.__webglTexture,33984+de);const Ue=r.get($);if($.version!==Ue.__version||ze===!0){i.activeTexture(33984+de),e.pixelStorei(37440,N.flipY),e.pixelStorei(37441,N.premultiplyAlpha),e.pixelStorei(3317,N.unpackAlignment),e.pixelStorei(37443,0);const rt=N.isCompressedTexture||N.image[0].isCompressedTexture,Ye=N.image[0]&&N.image[0].isDataTexture,Ee=[];for(let we=0;we<6;we++)!rt&&!Ye?Ee[we]=_(N.image[we],!1,!0,u):Ee[we]=Ye?N.image[we].image:N.image[we],Ee[we]=xt(N,Ee[we]);const lt=Ee[0],et=A(lt)||o,pt=s.convert(N.format,N.encoding),mt=s.convert(N.type),dt=T(N.internalFormat,pt,mt,N.encoding),_e=o&&N.isVideoTexture!==!0,it=Ue.__version===void 0||ze===!0;let At=D(N,lt,et);ue(34067,N,et);let ie;if(rt){_e&&it&&i.texStorage2D(34067,At,dt,lt.width,lt.height);for(let we=0;we<6;we++){ie=Ee[we].mipmaps;for(let Re=0;Re<ie.length;Re++){const We=ie[Re];N.format!==ko?pt!==null?_e?i.compressedTexSubImage2D(34069+we,Re,0,0,We.width,We.height,pt,We.data):i.compressedTexImage2D(34069+we,Re,dt,We.width,We.height,0,We.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):_e?i.texSubImage2D(34069+we,Re,0,0,We.width,We.height,pt,mt,We.data):i.texImage2D(34069+we,Re,dt,We.width,We.height,0,pt,mt,We.data)}}}else{ie=N.mipmaps,_e&&it&&(ie.length>0&&At++,i.texStorage2D(34067,At,dt,Ee[0].width,Ee[0].height));for(let we=0;we<6;we++)if(Ye){_e?i.texSubImage2D(34069+we,0,0,0,Ee[we].width,Ee[we].height,pt,mt,Ee[we].data):i.texImage2D(34069+we,0,dt,Ee[we].width,Ee[we].height,0,pt,mt,Ee[we].data);for(let Re=0;Re<ie.length;Re++){const ct=ie[Re].image[we].image;_e?i.texSubImage2D(34069+we,Re+1,0,0,ct.width,ct.height,pt,mt,ct.data):i.texImage2D(34069+we,Re+1,dt,ct.width,ct.height,0,pt,mt,ct.data)}}else{_e?i.texSubImage2D(34069+we,0,0,0,pt,mt,Ee[we]):i.texImage2D(34069+we,0,dt,pt,mt,Ee[we]);for(let Re=0;Re<ie.length;Re++){const We=ie[Re];_e?i.texSubImage2D(34069+we,Re+1,0,0,pt,mt,We.image[we]):i.texImage2D(34069+we,Re+1,dt,pt,mt,We.image[we])}}}E(N,et)&&I(34067),Ue.__version=$.version,N.onUpdate&&N.onUpdate(N)}q.__version=N.version}function Ae(q,N,de,ze,$){const Ue=s.convert(de.format,de.encoding),rt=s.convert(de.type),Ye=T(de.internalFormat,Ue,rt,de.encoding);r.get(N).__hasExternalTextures||($===32879||$===35866?i.texImage3D($,0,Ye,N.width,N.height,N.depth,0,Ue,rt,null):i.texImage2D($,0,Ye,N.width,N.height,0,Ue,rt,null)),i.bindFramebuffer(36160,q),Ke(N)?d.framebufferTexture2DMultisampleEXT(36160,ze,$,r.get(de).__webglTexture,0,$e(N)):($===3553||$>=34069&&$<=34074)&&e.framebufferTexture2D(36160,ze,$,r.get(de).__webglTexture,0),i.bindFramebuffer(36160,null)}function Ie(q,N,de){if(e.bindRenderbuffer(36161,q),N.depthBuffer&&!N.stencilBuffer){let ze=33189;if(de||Ke(N)){const $=N.depthTexture;$&&$.isDepthTexture&&($.type===fd?ze=36012:$.type===op&&(ze=33190));const Ue=$e(N);Ke(N)?d.renderbufferStorageMultisampleEXT(36161,Ue,ze,N.width,N.height):e.renderbufferStorageMultisample(36161,Ue,ze,N.width,N.height)}else e.renderbufferStorage(36161,ze,N.width,N.height);e.framebufferRenderbuffer(36160,36096,36161,q)}else if(N.depthBuffer&&N.stencilBuffer){const ze=$e(N);de&&Ke(N)===!1?e.renderbufferStorageMultisample(36161,ze,35056,N.width,N.height):Ke(N)?d.renderbufferStorageMultisampleEXT(36161,ze,35056,N.width,N.height):e.renderbufferStorage(36161,34041,N.width,N.height),e.framebufferRenderbuffer(36160,33306,36161,q)}else{const ze=N.isWebGLMultipleRenderTargets===!0?N.texture:[N.texture];for(let $=0;$<ze.length;$++){const Ue=ze[$],rt=s.convert(Ue.format,Ue.encoding),Ye=s.convert(Ue.type),Ee=T(Ue.internalFormat,rt,Ye,Ue.encoding),lt=$e(N);de&&Ke(N)===!1?e.renderbufferStorageMultisample(36161,lt,Ee,N.width,N.height):Ke(N)?d.renderbufferStorageMultisampleEXT(36161,lt,Ee,N.width,N.height):e.renderbufferStorage(36161,Ee,N.width,N.height)}}e.bindRenderbuffer(36161,null)}function Me(q,N){if(N&&N.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,q),!(N.depthTexture&&N.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(N.depthTexture).__webglTexture||N.depthTexture.image.width!==N.width||N.depthTexture.image.height!==N.height)&&(N.depthTexture.image.width=N.width,N.depthTexture.image.height=N.height,N.depthTexture.needsUpdate=!0),F(N.depthTexture,0);const ze=r.get(N.depthTexture).__webglTexture,$=$e(N);if(N.depthTexture.format===wp)Ke(N)?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,ze,0,$):e.framebufferTexture2D(36160,36096,3553,ze,0);else if(N.depthTexture.format===Ng)Ke(N)?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,ze,0,$):e.framebufferTexture2D(36160,33306,3553,ze,0);else throw new Error("Unknown depthTexture format")}function De(q){const N=r.get(q),de=q.isWebGLCubeRenderTarget===!0;if(q.depthTexture&&!N.__autoAllocateDepthBuffer){if(de)throw new Error("target.depthTexture not supported in Cube render targets");Me(N.__webglFramebuffer,q)}else if(de){N.__webglDepthbuffer=[];for(let ze=0;ze<6;ze++)i.bindFramebuffer(36160,N.__webglFramebuffer[ze]),N.__webglDepthbuffer[ze]=e.createRenderbuffer(),Ie(N.__webglDepthbuffer[ze],q,!1)}else i.bindFramebuffer(36160,N.__webglFramebuffer),N.__webglDepthbuffer=e.createRenderbuffer(),Ie(N.__webglDepthbuffer,q,!1);i.bindFramebuffer(36160,null)}function Ve(q,N,de){const ze=r.get(q);N!==void 0&&Ae(ze.__webglFramebuffer,q,q.texture,36064,3553),de!==void 0&&De(q)}function Ge(q){const N=q.texture,de=r.get(q),ze=r.get(N);q.addEventListener("dispose",G),q.isWebGLMultipleRenderTargets!==!0&&(ze.__webglTexture===void 0&&(ze.__webglTexture=e.createTexture()),ze.__version=N.version,a.memory.textures++);const $=q.isWebGLCubeRenderTarget===!0,Ue=q.isWebGLMultipleRenderTargets===!0,rt=A(q)||o;if($){de.__webglFramebuffer=[];for(let Ye=0;Ye<6;Ye++)de.__webglFramebuffer[Ye]=e.createFramebuffer()}else{if(de.__webglFramebuffer=e.createFramebuffer(),Ue)if(n.drawBuffers){const Ye=q.texture;for(let Ee=0,lt=Ye.length;Ee<lt;Ee++){const et=r.get(Ye[Ee]);et.__webglTexture===void 0&&(et.__webglTexture=e.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&q.samples>0&&Ke(q)===!1){const Ye=Ue?N:[N];de.__webglMultisampledFramebuffer=e.createFramebuffer(),de.__webglColorRenderbuffer=[],i.bindFramebuffer(36160,de.__webglMultisampledFramebuffer);for(let Ee=0;Ee<Ye.length;Ee++){const lt=Ye[Ee];de.__webglColorRenderbuffer[Ee]=e.createRenderbuffer(),e.bindRenderbuffer(36161,de.__webglColorRenderbuffer[Ee]);const et=s.convert(lt.format,lt.encoding),pt=s.convert(lt.type),mt=T(lt.internalFormat,et,pt,lt.encoding,q.isXRRenderTarget===!0),dt=$e(q);e.renderbufferStorageMultisample(36161,dt,mt,q.width,q.height),e.framebufferRenderbuffer(36160,36064+Ee,36161,de.__webglColorRenderbuffer[Ee])}e.bindRenderbuffer(36161,null),q.depthBuffer&&(de.__webglDepthRenderbuffer=e.createRenderbuffer(),Ie(de.__webglDepthRenderbuffer,q,!0)),i.bindFramebuffer(36160,null)}}if($){i.bindTexture(34067,ze.__webglTexture),ue(34067,N,rt);for(let Ye=0;Ye<6;Ye++)Ae(de.__webglFramebuffer[Ye],q,N,36064,34069+Ye);E(N,rt)&&I(34067),i.unbindTexture()}else if(Ue){const Ye=q.texture;for(let Ee=0,lt=Ye.length;Ee<lt;Ee++){const et=Ye[Ee],pt=r.get(et);i.bindTexture(3553,pt.__webglTexture),ue(3553,et,rt),Ae(de.__webglFramebuffer,q,et,36064+Ee,3553),E(et,rt)&&I(3553)}i.unbindTexture()}else{let Ye=3553;(q.isWebGL3DRenderTarget||q.isWebGLArrayRenderTarget)&&(o?Ye=q.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(Ye,ze.__webglTexture),ue(Ye,N,rt),Ae(de.__webglFramebuffer,q,N,36064,Ye),E(N,rt)&&I(Ye),i.unbindTexture()}q.depthBuffer&&De(q)}function Qe(q){const N=A(q)||o,de=q.isWebGLMultipleRenderTargets===!0?q.texture:[q.texture];for(let ze=0,$=de.length;ze<$;ze++){const Ue=de[ze];if(E(Ue,N)){const rt=q.isWebGLCubeRenderTarget?34067:3553,Ye=r.get(Ue).__webglTexture;i.bindTexture(rt,Ye),I(rt),i.unbindTexture()}}}function ot(q){if(o&&q.samples>0&&Ke(q)===!1){const N=q.isWebGLMultipleRenderTargets?q.texture:[q.texture],de=q.width,ze=q.height;let $=16384;const Ue=[],rt=q.stencilBuffer?33306:36096,Ye=r.get(q),Ee=q.isWebGLMultipleRenderTargets===!0;if(Ee)for(let lt=0;lt<N.length;lt++)i.bindFramebuffer(36160,Ye.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+lt,36161,null),i.bindFramebuffer(36160,Ye.__webglFramebuffer),e.framebufferTexture2D(36009,36064+lt,3553,null,0);i.bindFramebuffer(36008,Ye.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,Ye.__webglFramebuffer);for(let lt=0;lt<N.length;lt++){Ue.push(36064+lt),q.depthBuffer&&Ue.push(rt);const et=Ye.__ignoreDepthValues!==void 0?Ye.__ignoreDepthValues:!1;if(et===!1&&(q.depthBuffer&&($|=256),q.stencilBuffer&&($|=1024)),Ee&&e.framebufferRenderbuffer(36008,36064,36161,Ye.__webglColorRenderbuffer[lt]),et===!0&&(e.invalidateFramebuffer(36008,[rt]),e.invalidateFramebuffer(36009,[rt])),Ee){const pt=r.get(N[lt]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,pt,0)}e.blitFramebuffer(0,0,de,ze,0,0,de,ze,$,9728),p&&e.invalidateFramebuffer(36008,Ue)}if(i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),Ee)for(let lt=0;lt<N.length;lt++){i.bindFramebuffer(36160,Ye.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+lt,36161,Ye.__webglColorRenderbuffer[lt]);const et=r.get(N[lt]).__webglTexture;i.bindFramebuffer(36160,Ye.__webglFramebuffer),e.framebufferTexture2D(36009,36064+lt,3553,et,0)}i.bindFramebuffer(36009,Ye.__webglMultisampledFramebuffer)}}function $e(q){return Math.min(h,q.samples)}function Ke(q){const N=r.get(q);return o&&q.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&N.__useRenderToTexture!==!1}function bt(q){const N=a.render.frame;m.get(q)!==N&&(m.set(q,N),q.update())}function xt(q,N){const de=q.encoding,ze=q.format,$=q.type;return q.isCompressedTexture===!0||q.isVideoTexture===!0||q.format===t2||de!==Dp&&(de===Ur?o===!1?t.has("EXT_sRGB")===!0&&ze===ko?(q.format=t2,q.minFilter=On,q.generateMipmaps=!1):N=uz.sRGBToLinear(N):(ze!==ko||$!==Cd)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",de)),N}this.allocateTextureUnit=B,this.resetTextureUnits=K,this.setTexture2D=F,this.setTexture2DArray=X,this.setTexture3D=Y,this.setTextureCube=le,this.rebindTextures=Ve,this.setupRenderTarget=Ge,this.updateRenderTargetMipmap=Qe,this.updateMultisampleRenderTarget=ot,this.setupDepthRenderbuffer=De,this.setupFrameBufferTexture=Ae,this.useMultisampledRTT=Ke}function T9(e,t,i){const r=i.isWebGL2;function n(s,a=null){let o;if(s===Cd)return 5121;if(s===Z8)return 32819;if(s===J8)return 32820;if(s===Y8)return 5120;if(s===Q8)return 5122;if(s===sz)return 5123;if(s===K8)return 5124;if(s===op)return 5125;if(s===fd)return 5126;if(s===ex)return r?5131:(o=t.get("OES_texture_half_float"),o!==null?o.HALF_FLOAT_OES:null);if(s===$8)return 6406;if(s===ko)return 6408;if(s===e9)return 6409;if(s===t9)return 6410;if(s===wp)return 6402;if(s===Ng)return 34041;if(s===t2)return o=t.get("EXT_sRGB"),o!==null?o.SRGB_ALPHA_EXT:null;if(s===i9)return 6403;if(s===r9)return 36244;if(s===n9)return 33319;if(s===s9)return 33320;if(s===a9)return 36249;if(s===_E||s===SE||s===ME||s===AE)if(a===Ur)if(o=t.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(s===_E)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===SE)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===ME)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===AE)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=t.get("WEBGL_compressed_texture_s3tc"),o!==null){if(s===_E)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===SE)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===ME)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===AE)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===NR||s===FR||s===UR||s===VR)if(o=t.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(s===NR)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===FR)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===UR)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===VR)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===o9)return o=t.get("WEBGL_compressed_texture_etc1"),o!==null?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===jR||s===HR)if(o=t.get("WEBGL_compressed_texture_etc"),o!==null){if(s===jR)return a===Ur?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(s===HR)return a===Ur?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===WR||s===GR||s===qR||s===XR||s===YR||s===QR||s===KR||s===ZR||s===JR||s===$R||s===eI||s===tI||s===iI||s===rI)if(o=t.get("WEBGL_compressed_texture_astc"),o!==null){if(s===WR)return a===Ur?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===GR)return a===Ur?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===qR)return a===Ur?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===XR)return a===Ur?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===YR)return a===Ur?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===QR)return a===Ur?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===KR)return a===Ur?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===ZR)return a===Ur?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===JR)return a===Ur?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===$R)return a===Ur?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===eI)return a===Ur?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===tI)return a===Ur?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===iI)return a===Ur?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===rI)return a===Ur?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===EE)if(o=t.get("EXT_texture_compression_bptc"),o!==null){if(s===EE)return a===Ur?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(s===l9||s===nI||s===sI||s===aI)if(o=t.get("EXT_texture_compression_rgtc"),o!==null){if(s===EE)return o.COMPRESSED_RED_RGTC1_EXT;if(s===nI)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===sI)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===aI)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===Ag?r?34042:(o=t.get("WEBGL_depth_texture"),o!==null?o.UNSIGNED_INT_24_8_WEBGL:null):e[s]!==void 0?e[s]:null}return{convert:n}}class P9 extends on{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class Sy extends ur{constructor(){super(),this.isGroup=!0,this.type="Group"}}const coe={type:"move"};class PP{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Sy,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Sy,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new pe,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new pe),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Sy,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new pe,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new pe),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const i=this._hand;if(i)for(const r of t.hand.values())this._getHandJoint(i,r)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,i,r){let n=null,s=null,a=null;const o=this._targetRay,l=this._grip,u=this._hand;if(t&&i.session.visibilityState!=="visible-blurred"){if(u&&t.hand){a=!0;for(const v of t.hand.values()){const g=i.getJointPose(v,r),w=this._getHandJoint(u,v);g!==null&&(w.matrix.fromArray(g.transform.matrix),w.matrix.decompose(w.position,w.rotation,w.scale),w.jointRadius=g.radius),w.visible=g!==null}const c=u.joints["index-finger-tip"],h=u.joints["thumb-tip"],d=c.position.distanceTo(h.position),p=.02,m=.005;u.inputState.pinching&&d>p+m?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!u.inputState.pinching&&d<=p-m&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else l!==null&&t.gripSpace&&(s=i.getPose(t.gripSpace,r),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));o!==null&&(n=i.getPose(t.targetRaySpace,r),n===null&&s!==null&&(n=s),n!==null&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(coe)))}return o!==null&&(o.visible=n!==null),l!==null&&(l.visible=s!==null),u!==null&&(u.visible=a!==null),this}_getHandJoint(t,i){if(t.joints[i.jointName]===void 0){const r=new Sy;r.matrixAutoUpdate=!1,r.visible=!1,t.joints[i.jointName]=r,t.add(r)}return t.joints[i.jointName]}}class D9 extends _n{constructor(t,i,r,n,s,a,o,l,u,c){if(c=c!==void 0?c:wp,c!==wp&&c!==Ng)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&c===wp&&(r=op),r===void 0&&c===Ng&&(r=Ag),super(null,n,s,a,o,l,c,r,u),this.isDepthTexture=!0,this.image={width:t,height:i},this.magFilter=o!==void 0?o:Ln,this.minFilter=l!==void 0?l:Ln,this.flipY=!1,this.generateMipmaps=!1}}class hoe extends Fd{constructor(t,i){super();const r=this;let n=null,s=1,a=null,o="local-floor",l=1,u=null,c=null,h=null,d=null,p=null,m=null;const v=i.getContextAttributes();let g=null,w=null;const S=[],_=[],A=new Set,C=new Map,E=new on;E.layers.enable(1),E.viewport=new _r;const I=new on;I.layers.enable(2),I.viewport=new _r;const T=[E,I],D=new P9;D.layers.enable(1),D.layers.enable(2);let L=null,z=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Y){let le=S[Y];return le===void 0&&(le=new PP,S[Y]=le),le.getTargetRaySpace()},this.getControllerGrip=function(Y){let le=S[Y];return le===void 0&&(le=new PP,S[Y]=le),le.getGripSpace()},this.getHand=function(Y){let le=S[Y];return le===void 0&&(le=new PP,S[Y]=le),le.getHandSpace()};function G(Y){const le=_.indexOf(Y.inputSource);if(le===-1)return;const oe=S[le];oe!==void 0&&oe.dispatchEvent({type:Y.type,data:Y.inputSource})}function V(){n.removeEventListener("select",G),n.removeEventListener("selectstart",G),n.removeEventListener("selectend",G),n.removeEventListener("squeeze",G),n.removeEventListener("squeezestart",G),n.removeEventListener("squeezeend",G),n.removeEventListener("end",V),n.removeEventListener("inputsourceschange",j);for(let Y=0;Y<S.length;Y++){const le=_[Y];le!==null&&(_[Y]=null,S[Y].disconnect(le))}L=null,z=null,t.setRenderTarget(g),p=null,d=null,h=null,n=null,w=null,X.stop(),r.isPresenting=!1,r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Y){s=Y,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Y){o=Y,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return u||a},this.setReferenceSpace=function(Y){u=Y},this.getBaseLayer=function(){return d!==null?d:p},this.getBinding=function(){return h},this.getFrame=function(){return m},this.getSession=function(){return n},this.setSession=async function(Y){if(n=Y,n!==null){if(g=t.getRenderTarget(),n.addEventListener("select",G),n.addEventListener("selectstart",G),n.addEventListener("selectend",G),n.addEventListener("squeeze",G),n.addEventListener("squeezestart",G),n.addEventListener("squeezeend",G),n.addEventListener("end",V),n.addEventListener("inputsourceschange",j),v.xrCompatible!==!0&&await i.makeXRCompatible(),n.renderState.layers===void 0||t.capabilities.isWebGL2===!1){const le={antialias:n.renderState.layers===void 0?v.antialias:!0,alpha:v.alpha,depth:v.depth,stencil:v.stencil,framebufferScaleFactor:s};p=new XRWebGLLayer(n,i,le),n.updateRenderState({baseLayer:p}),w=new Vu(p.framebufferWidth,p.framebufferHeight,{format:ko,type:Cd,encoding:t.outputEncoding,stencilBuffer:v.stencil})}else{let le=null,oe=null,re=null;v.depth&&(re=v.stencil?35056:33190,le=v.stencil?Ng:wp,oe=v.stencil?Ag:op);const ue={colorFormat:32856,depthFormat:re,scaleFactor:s};h=new XRWebGLBinding(n,i),d=h.createProjectionLayer(ue),n.updateRenderState({layers:[d]}),w=new Vu(d.textureWidth,d.textureHeight,{format:ko,type:Cd,depthTexture:new D9(d.textureWidth,d.textureHeight,oe,void 0,void 0,void 0,void 0,void 0,void 0,le),stencilBuffer:v.stencil,encoding:t.outputEncoding,samples:v.antialias?4:0});const me=t.properties.get(w);me.__ignoreDepthValues=d.ignoreDepthValues}w.isXRRenderTarget=!0,this.setFoveation(l),u=null,a=await n.requestReferenceSpace(o),X.setContext(n),X.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}};function j(Y){for(let le=0;le<Y.removed.length;le++){const oe=Y.removed[le],re=_.indexOf(oe);re>=0&&(_[re]=null,S[re].disconnect(oe))}for(let le=0;le<Y.added.length;le++){const oe=Y.added[le];let re=_.indexOf(oe);if(re===-1){for(let me=0;me<S.length;me++)if(me>=_.length){_.push(oe),re=me;break}else if(_[me]===null){_[me]=oe,re=me;break}if(re===-1)break}const ue=S[re];ue&&ue.connect(oe)}}const J=new pe,ne=new pe;function K(Y,le,oe){J.setFromMatrixPosition(le.matrixWorld),ne.setFromMatrixPosition(oe.matrixWorld);const re=J.distanceTo(ne),ue=le.projectionMatrix.elements,me=oe.projectionMatrix.elements,he=ue[14]/(ue[10]-1),Ce=ue[14]/(ue[10]+1),Ae=(ue[9]+1)/ue[5],Ie=(ue[9]-1)/ue[5],Me=(ue[8]-1)/ue[0],De=(me[8]+1)/me[0],Ve=he*Me,Ge=he*De,Qe=re/(-Me+De),ot=Qe*-Me;le.matrixWorld.decompose(Y.position,Y.quaternion,Y.scale),Y.translateX(ot),Y.translateZ(Qe),Y.matrixWorld.compose(Y.position,Y.quaternion,Y.scale),Y.matrixWorldInverse.copy(Y.matrixWorld).invert();const $e=he+Qe,Ke=Ce+Qe,bt=Ve-ot,xt=Ge+(re-ot),q=Ae*Ce/Ke*$e,N=Ie*Ce/Ke*$e;Y.projectionMatrix.makePerspective(bt,xt,q,N,$e,Ke)}function B(Y,le){le===null?Y.matrixWorld.copy(Y.matrix):Y.matrixWorld.multiplyMatrices(le.matrixWorld,Y.matrix),Y.matrixWorldInverse.copy(Y.matrixWorld).invert()}this.updateCamera=function(Y){if(n===null)return;D.near=I.near=E.near=Y.near,D.far=I.far=E.far=Y.far,(L!==D.near||z!==D.far)&&(n.updateRenderState({depthNear:D.near,depthFar:D.far}),L=D.near,z=D.far);const le=Y.parent,oe=D.cameras;B(D,le);for(let ue=0;ue<oe.length;ue++)B(oe[ue],le);D.matrixWorld.decompose(D.position,D.quaternion,D.scale),Y.matrix.copy(D.matrix),Y.matrix.decompose(Y.position,Y.quaternion,Y.scale);const re=Y.children;for(let ue=0,me=re.length;ue<me;ue++)re[ue].updateMatrixWorld(!0);oe.length===2?K(D,E,I):D.projectionMatrix.copy(E.projectionMatrix)},this.getCamera=function(){return D},this.getFoveation=function(){if(!(d===null&&p===null))return l},this.setFoveation=function(Y){l=Y,d!==null&&(d.fixedFoveation=Y),p!==null&&p.fixedFoveation!==void 0&&(p.fixedFoveation=Y)},this.getPlanes=function(){return A};let Z=null;function F(Y,le){if(c=le.getViewerPose(u||a),m=le,c!==null){const oe=c.views;p!==null&&(t.setRenderTargetFramebuffer(w,p.framebuffer),t.setRenderTarget(w));let re=!1;oe.length!==D.cameras.length&&(D.cameras.length=0,re=!0);for(let ue=0;ue<oe.length;ue++){const me=oe[ue];let he=null;if(p!==null)he=p.getViewport(me);else{const Ae=h.getViewSubImage(d,me);he=Ae.viewport,ue===0&&(t.setRenderTargetTextures(w,Ae.colorTexture,d.ignoreDepthValues?void 0:Ae.depthStencilTexture),t.setRenderTarget(w))}let Ce=T[ue];Ce===void 0&&(Ce=new on,Ce.layers.enable(ue),Ce.viewport=new _r,T[ue]=Ce),Ce.matrix.fromArray(me.transform.matrix),Ce.projectionMatrix.fromArray(me.projectionMatrix),Ce.viewport.set(he.x,he.y,he.width,he.height),ue===0&&D.matrix.copy(Ce.matrix),re===!0&&D.cameras.push(Ce)}}for(let oe=0;oe<S.length;oe++){const re=_[oe],ue=S[oe];re!==null&&ue!==void 0&&ue.update(re,le,u||a)}if(Z&&Z(Y,le),le.detectedPlanes){r.dispatchEvent({type:"planesdetected",data:le.detectedPlanes});let oe=null;for(const re of A)le.detectedPlanes.has(re)||(oe===null&&(oe=[]),oe.push(re));if(oe!==null)for(const re of oe)A.delete(re),C.delete(re),r.dispatchEvent({type:"planeremoved",data:re});for(const re of le.detectedPlanes)if(!A.has(re))A.add(re),C.set(re,le.lastChangedTime),r.dispatchEvent({type:"planeadded",data:re});else{const ue=C.get(re);re.lastChangedTime>ue&&(C.set(re,re.lastChangedTime),r.dispatchEvent({type:"planechanged",data:re}))}}m=null}const X=new S9;X.setAnimationLoop(F),this.setAnimationLoop=function(Y){Z=Y},this.dispose=function(){}}}function doe(e,t){function i(v,g){g.color.getRGB(v.fogColor.value,b9(e)),g.isFog?(v.fogNear.value=g.near,v.fogFar.value=g.far):g.isFogExp2&&(v.fogDensity.value=g.density)}function r(v,g,w,S,_){g.isMeshBasicMaterial||g.isMeshLambertMaterial?n(v,g):g.isMeshToonMaterial?(n(v,g),c(v,g)):g.isMeshPhongMaterial?(n(v,g),u(v,g)):g.isMeshStandardMaterial?(n(v,g),h(v,g),g.isMeshPhysicalMaterial&&d(v,g,_)):g.isMeshMatcapMaterial?(n(v,g),p(v,g)):g.isMeshDepthMaterial?n(v,g):g.isMeshDistanceMaterial?(n(v,g),m(v,g)):g.isMeshNormalMaterial?n(v,g):g.isLineBasicMaterial?(s(v,g),g.isLineDashedMaterial&&a(v,g)):g.isPointsMaterial?o(v,g,w,S):g.isSpriteMaterial?l(v,g):g.isShadowMaterial?(v.color.value.copy(g.color),v.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}function n(v,g){v.opacity.value=g.opacity,g.color&&v.diffuse.value.copy(g.color),g.emissive&&v.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(v.map.value=g.map),g.alphaMap&&(v.alphaMap.value=g.alphaMap),g.bumpMap&&(v.bumpMap.value=g.bumpMap,v.bumpScale.value=g.bumpScale,g.side===jo&&(v.bumpScale.value*=-1)),g.displacementMap&&(v.displacementMap.value=g.displacementMap,v.displacementScale.value=g.displacementScale,v.displacementBias.value=g.displacementBias),g.emissiveMap&&(v.emissiveMap.value=g.emissiveMap),g.normalMap&&(v.normalMap.value=g.normalMap,v.normalScale.value.copy(g.normalScale),g.side===jo&&v.normalScale.value.negate()),g.specularMap&&(v.specularMap.value=g.specularMap),g.alphaTest>0&&(v.alphaTest.value=g.alphaTest);const w=t.get(g).envMap;if(w&&(v.envMap.value=w,v.flipEnvMap.value=w.isCubeTexture&&w.isRenderTargetTexture===!1?-1:1,v.reflectivity.value=g.reflectivity,v.ior.value=g.ior,v.refractionRatio.value=g.refractionRatio),g.lightMap){v.lightMap.value=g.lightMap;const A=e.useLegacyLights===!0?Math.PI:1;v.lightMapIntensity.value=g.lightMapIntensity*A}g.aoMap&&(v.aoMap.value=g.aoMap,v.aoMapIntensity.value=g.aoMapIntensity);let S;g.map?S=g.map:g.specularMap?S=g.specularMap:g.displacementMap?S=g.displacementMap:g.normalMap?S=g.normalMap:g.bumpMap?S=g.bumpMap:g.roughnessMap?S=g.roughnessMap:g.metalnessMap?S=g.metalnessMap:g.alphaMap?S=g.alphaMap:g.emissiveMap?S=g.emissiveMap:g.clearcoatMap?S=g.clearcoatMap:g.clearcoatNormalMap?S=g.clearcoatNormalMap:g.clearcoatRoughnessMap?S=g.clearcoatRoughnessMap:g.iridescenceMap?S=g.iridescenceMap:g.iridescenceThicknessMap?S=g.iridescenceThicknessMap:g.specularIntensityMap?S=g.specularIntensityMap:g.specularColorMap?S=g.specularColorMap:g.transmissionMap?S=g.transmissionMap:g.thicknessMap?S=g.thicknessMap:g.sheenColorMap?S=g.sheenColorMap:g.sheenRoughnessMap&&(S=g.sheenRoughnessMap),S!==void 0&&(S.isWebGLRenderTarget&&(S=S.texture),S.matrixAutoUpdate===!0&&S.updateMatrix(),v.uvTransform.value.copy(S.matrix));let _;g.aoMap?_=g.aoMap:g.lightMap&&(_=g.lightMap),_!==void 0&&(_.isWebGLRenderTarget&&(_=_.texture),_.matrixAutoUpdate===!0&&_.updateMatrix(),v.uv2Transform.value.copy(_.matrix))}function s(v,g){v.diffuse.value.copy(g.color),v.opacity.value=g.opacity}function a(v,g){v.dashSize.value=g.dashSize,v.totalSize.value=g.dashSize+g.gapSize,v.scale.value=g.scale}function o(v,g,w,S){v.diffuse.value.copy(g.color),v.opacity.value=g.opacity,v.size.value=g.size*w,v.scale.value=S*.5,g.map&&(v.map.value=g.map),g.alphaMap&&(v.alphaMap.value=g.alphaMap),g.alphaTest>0&&(v.alphaTest.value=g.alphaTest);let _;g.map?_=g.map:g.alphaMap&&(_=g.alphaMap),_!==void 0&&(_.matrixAutoUpdate===!0&&_.updateMatrix(),v.uvTransform.value.copy(_.matrix))}function l(v,g){v.diffuse.value.copy(g.color),v.opacity.value=g.opacity,v.rotation.value=g.rotation,g.map&&(v.map.value=g.map),g.alphaMap&&(v.alphaMap.value=g.alphaMap),g.alphaTest>0&&(v.alphaTest.value=g.alphaTest);let w;g.map?w=g.map:g.alphaMap&&(w=g.alphaMap),w!==void 0&&(w.matrixAutoUpdate===!0&&w.updateMatrix(),v.uvTransform.value.copy(w.matrix))}function u(v,g){v.specular.value.copy(g.specular),v.shininess.value=Math.max(g.shininess,1e-4)}function c(v,g){g.gradientMap&&(v.gradientMap.value=g.gradientMap)}function h(v,g){v.roughness.value=g.roughness,v.metalness.value=g.metalness,g.roughnessMap&&(v.roughnessMap.value=g.roughnessMap),g.metalnessMap&&(v.metalnessMap.value=g.metalnessMap),t.get(g).envMap&&(v.envMapIntensity.value=g.envMapIntensity)}function d(v,g,w){v.ior.value=g.ior,g.sheen>0&&(v.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),v.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(v.sheenColorMap.value=g.sheenColorMap),g.sheenRoughnessMap&&(v.sheenRoughnessMap.value=g.sheenRoughnessMap)),g.clearcoat>0&&(v.clearcoat.value=g.clearcoat,v.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(v.clearcoatMap.value=g.clearcoatMap),g.clearcoatRoughnessMap&&(v.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap),g.clearcoatNormalMap&&(v.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),v.clearcoatNormalMap.value=g.clearcoatNormalMap,g.side===jo&&v.clearcoatNormalScale.value.negate())),g.iridescence>0&&(v.iridescence.value=g.iridescence,v.iridescenceIOR.value=g.iridescenceIOR,v.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],v.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&(v.iridescenceMap.value=g.iridescenceMap),g.iridescenceThicknessMap&&(v.iridescenceThicknessMap.value=g.iridescenceThicknessMap)),g.transmission>0&&(v.transmission.value=g.transmission,v.transmissionSamplerMap.value=w.texture,v.transmissionSamplerSize.value.set(w.width,w.height),g.transmissionMap&&(v.transmissionMap.value=g.transmissionMap),v.thickness.value=g.thickness,g.thicknessMap&&(v.thicknessMap.value=g.thicknessMap),v.attenuationDistance.value=g.attenuationDistance,v.attenuationColor.value.copy(g.attenuationColor)),v.specularIntensity.value=g.specularIntensity,v.specularColor.value.copy(g.specularColor),g.specularIntensityMap&&(v.specularIntensityMap.value=g.specularIntensityMap),g.specularColorMap&&(v.specularColorMap.value=g.specularColorMap)}function p(v,g){g.matcap&&(v.matcap.value=g.matcap)}function m(v,g){v.referencePosition.value.copy(g.referencePosition),v.nearDistance.value=g.nearDistance,v.farDistance.value=g.farDistance}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function foe(e,t,i,r){let n={},s={},a=[];const o=i.isWebGL2?e.getParameter(35375):0;function l(S,_){const A=_.program;r.uniformBlockBinding(S,A)}function u(S,_){let A=n[S.id];A===void 0&&(m(S),A=c(S),n[S.id]=A,S.addEventListener("dispose",g));const C=_.program;r.updateUBOMapping(S,C);const E=t.render.frame;s[S.id]!==E&&(d(S),s[S.id]=E)}function c(S){const _=h();S.__bindingPointIndex=_;const A=e.createBuffer(),C=S.__size,E=S.usage;return e.bindBuffer(35345,A),e.bufferData(35345,C,E),e.bindBuffer(35345,null),e.bindBufferBase(35345,_,A),A}function h(){for(let S=0;S<o;S++)if(a.indexOf(S)===-1)return a.push(S),S;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(S){const _=n[S.id],A=S.uniforms,C=S.__cache;e.bindBuffer(35345,_);for(let E=0,I=A.length;E<I;E++){const T=A[E];if(p(T,E,C)===!0){const D=T.__offset,L=Array.isArray(T.value)?T.value:[T.value];let z=0;for(let G=0;G<L.length;G++){const V=L[G],j=v(V);typeof V=="number"?(T.__data[0]=V,e.bufferSubData(35345,D+z,T.__data)):V.isMatrix3?(T.__data[0]=V.elements[0],T.__data[1]=V.elements[1],T.__data[2]=V.elements[2],T.__data[3]=V.elements[0],T.__data[4]=V.elements[3],T.__data[5]=V.elements[4],T.__data[6]=V.elements[5],T.__data[7]=V.elements[0],T.__data[8]=V.elements[6],T.__data[9]=V.elements[7],T.__data[10]=V.elements[8],T.__data[11]=V.elements[0]):(V.toArray(T.__data,z),z+=j.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(35345,D,T.__data)}}e.bindBuffer(35345,null)}function p(S,_,A){const C=S.value;if(A[_]===void 0){if(typeof C=="number")A[_]=C;else{const E=Array.isArray(C)?C:[C],I=[];for(let T=0;T<E.length;T++)I.push(E[T].clone());A[_]=I}return!0}else if(typeof C=="number"){if(A[_]!==C)return A[_]=C,!0}else{const E=Array.isArray(A[_])?A[_]:[A[_]],I=Array.isArray(C)?C:[C];for(let T=0;T<E.length;T++){const D=E[T];if(D.equals(I[T])===!1)return D.copy(I[T]),!0}}return!1}function m(S){const _=S.uniforms;let A=0;const C=16;let E=0;for(let I=0,T=_.length;I<T;I++){const D=_[I],L={boundary:0,storage:0},z=Array.isArray(D.value)?D.value:[D.value];for(let G=0,V=z.length;G<V;G++){const j=z[G],J=v(j);L.boundary+=J.boundary,L.storage+=J.storage}if(D.__data=new Float32Array(L.storage/Float32Array.BYTES_PER_ELEMENT),D.__offset=A,I>0){E=A%C;const G=C-E;E!==0&&G-L.boundary<0&&(A+=C-E,D.__offset=A)}A+=L.storage}return E=A%C,E>0&&(A+=C-E),S.__size=A,S.__cache={},this}function v(S){const _={boundary:0,storage:0};return typeof S=="number"?(_.boundary=4,_.storage=4):S.isVector2?(_.boundary=8,_.storage=8):S.isVector3||S.isColor?(_.boundary=16,_.storage=12):S.isVector4?(_.boundary=16,_.storage=16):S.isMatrix3?(_.boundary=48,_.storage=48):S.isMatrix4?(_.boundary=64,_.storage=64):S.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",S),_}function g(S){const _=S.target;_.removeEventListener("dispose",g);const A=a.indexOf(_.__bindingPointIndex);a.splice(A,1),e.deleteBuffer(n[_.id]),delete n[_.id],delete s[_.id]}function w(){for(const S in n)e.deleteBuffer(n[S]);a=[],n={},s={}}return{bind:l,update:u,dispose:w}}function poe(){const e=Lb("canvas");return e.style.display="block",e}function DC(e={}){this.isWebGLRenderer=!0;const t=e.canvas!==void 0?e.canvas:poe(),i=e.context!==void 0?e.context:null,r=e.depth!==void 0?e.depth:!0,n=e.stencil!==void 0?e.stencil:!0,s=e.antialias!==void 0?e.antialias:!1,a=e.premultipliedAlpha!==void 0?e.premultipliedAlpha:!0,o=e.preserveDrawingBuffer!==void 0?e.preserveDrawingBuffer:!1,l=e.powerPreference!==void 0?e.powerPreference:"default",u=e.failIfMajorPerformanceCaveat!==void 0?e.failIfMajorPerformanceCaveat:!1;let c;i!==null?c=i.getContextAttributes().alpha:c=e.alpha!==void 0?e.alpha:!1;let h=null,d=null;const p=[],m=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Dp,this.useLegacyLights=!0,this.toneMapping=Nu,this.toneMappingExposure=1;const v=this;let g=!1,w=0,S=0,_=null,A=-1,C=null;const E=new _r,I=new _r;let T=null,D=t.width,L=t.height,z=1,G=null,V=null;const j=new _r(0,0,D,L),J=new _r(0,0,D,L);let ne=!1;const K=new TC;let B=!1,Z=!1,F=null;const X=new Oi,Y=new pe,le={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function oe(){return _===null?z:1}let re=i;function ue(ge,te){for(let ve=0;ve<ge.length;ve++){const fe=ge[ve],ye=t.getContext(fe,te);if(ye!==null)return ye}return null}try{const ge={alpha:!0,depth:r,stencil:n,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:o,powerPreference:l,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${SC}`),t.addEventListener("webglcontextlost",pt,!1),t.addEventListener("webglcontextrestored",mt,!1),t.addEventListener("webglcontextcreationerror",dt,!1),re===null){const te=["webgl2","webgl","experimental-webgl"];if(v.isWebGL1Renderer===!0&&te.shift(),re=ue(te,ge),re===null)throw ue(te)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}re.getShaderPrecisionFormat===void 0&&(re.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(ge){throw console.error("THREE.WebGLRenderer: "+ge.message),ge}let me,he,Ce,Ae,Ie,Me,De,Ve,Ge,Qe,ot,$e,Ke,bt,xt,q,N,de,ze,$,Ue,rt,Ye,Ee;function lt(){me=new Dse(re),he=new Mse(re,me,e),me.init(he),rt=new T9(re,me,he),Ce=new loe(re,me,he),Ae=new Lse,Ie=new Kae,Me=new uoe(re,me,Ce,Ie,he,rt,Ae),De=new Ese(v),Ve=new Pse(v),Ge=new jie(re,he),Ye=new _se(re,me,Ge,he),Qe=new Rse(re,Ge,Ae,Ye),ot=new Bse(re,Qe,Ge,Ae),ze=new kse(re,he,Me),q=new Ase(Ie),$e=new Qae(v,De,Ve,me,he,Ye,q),Ke=new doe(v,Ie),bt=new Jae,xt=new noe(me,he),de=new bse(v,De,Ve,Ce,ot,c,a),N=new ooe(v,ot,he),Ee=new foe(re,Ae,he,Ce),$=new Sse(re,me,Ae,he),Ue=new Ise(re,me,Ae,he),Ae.programs=$e.programs,v.capabilities=he,v.extensions=me,v.properties=Ie,v.renderLists=bt,v.shadowMap=N,v.state=Ce,v.info=Ae}lt();const et=new hoe(v,re);this.xr=et,this.getContext=function(){return re},this.getContextAttributes=function(){return re.getContextAttributes()},this.forceContextLoss=function(){const ge=me.get("WEBGL_lose_context");ge&&ge.loseContext()},this.forceContextRestore=function(){const ge=me.get("WEBGL_lose_context");ge&&ge.restoreContext()},this.getPixelRatio=function(){return z},this.setPixelRatio=function(ge){ge!==void 0&&(z=ge,this.setSize(D,L,!1))},this.getSize=function(ge){return ge.set(D,L)},this.setSize=function(ge,te,ve=!0){if(et.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}D=ge,L=te,t.width=Math.floor(ge*z),t.height=Math.floor(te*z),ve===!0&&(t.style.width=ge+"px",t.style.height=te+"px"),this.setViewport(0,0,ge,te)},this.getDrawingBufferSize=function(ge){return ge.set(D*z,L*z).floor()},this.setDrawingBufferSize=function(ge,te,ve){D=ge,L=te,z=ve,t.width=Math.floor(ge*ve),t.height=Math.floor(te*ve),this.setViewport(0,0,ge,te)},this.getCurrentViewport=function(ge){return ge.copy(E)},this.getViewport=function(ge){return ge.copy(j)},this.setViewport=function(ge,te,ve,fe){ge.isVector4?j.set(ge.x,ge.y,ge.z,ge.w):j.set(ge,te,ve,fe),Ce.viewport(E.copy(j).multiplyScalar(z).floor())},this.getScissor=function(ge){return ge.copy(J)},this.setScissor=function(ge,te,ve,fe){ge.isVector4?J.set(ge.x,ge.y,ge.z,ge.w):J.set(ge,te,ve,fe),Ce.scissor(I.copy(J).multiplyScalar(z).floor())},this.getScissorTest=function(){return ne},this.setScissorTest=function(ge){Ce.setScissorTest(ne=ge)},this.setOpaqueSort=function(ge){G=ge},this.setTransparentSort=function(ge){V=ge},this.getClearColor=function(ge){return ge.copy(de.getClearColor())},this.setClearColor=function(){de.setClearColor.apply(de,arguments)},this.getClearAlpha=function(){return de.getClearAlpha()},this.setClearAlpha=function(){de.setClearAlpha.apply(de,arguments)},this.clear=function(ge=!0,te=!0,ve=!0){let fe=0;ge&&(fe|=16384),te&&(fe|=256),ve&&(fe|=1024),re.clear(fe)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",pt,!1),t.removeEventListener("webglcontextrestored",mt,!1),t.removeEventListener("webglcontextcreationerror",dt,!1),bt.dispose(),xt.dispose(),Ie.dispose(),De.dispose(),Ve.dispose(),ot.dispose(),Ye.dispose(),Ee.dispose(),$e.dispose(),et.dispose(),et.removeEventListener("sessionstart",Re),et.removeEventListener("sessionend",We),F&&(F.dispose(),F=null),ct.stop()};function pt(ge){ge.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function mt(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;const ge=Ae.autoReset,te=N.enabled,ve=N.autoUpdate,fe=N.needsUpdate,ye=N.type;lt(),Ae.autoReset=ge,N.enabled=te,N.autoUpdate=ve,N.needsUpdate=fe,N.type=ye}function dt(ge){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",ge.statusMessage)}function _e(ge){const te=ge.target;te.removeEventListener("dispose",_e),it(te)}function it(ge){At(ge),Ie.remove(ge)}function At(ge){const te=Ie.get(ge).programs;te!==void 0&&(te.forEach(function(ve){$e.releaseProgram(ve)}),ge.isShaderMaterial&&$e.releaseShaderCache(ge))}this.renderBufferDirect=function(ge,te,ve,fe,ye,Ne){te===null&&(te=le);const gt=ye.isMesh&&ye.matrixWorld.determinant()<0,St=po(ge,te,ve,fe,ye);Ce.setMaterial(fe,gt);let Tt=ve.index,Et=1;fe.wireframe===!0&&(Tt=Qe.getWireframeAttribute(ve),Et=2);const Vt=ve.drawRange,zt=ve.attributes.position;let Yt=Vt.start*Et,$t=(Vt.start+Vt.count)*Et;Ne!==null&&(Yt=Math.max(Yt,Ne.start*Et),$t=Math.min($t,(Ne.start+Ne.count)*Et)),Tt!==null?(Yt=Math.max(Yt,0),$t=Math.min($t,Tt.count)):zt!=null&&(Yt=Math.max(Yt,0),$t=Math.min($t,zt.count));const tr=$t-Yt;if(tr<0||tr===1/0)return;Ye.setup(ye,fe,St,ve,Tt);let Qr,ir=$;if(Tt!==null&&(Qr=Ge.get(Tt),ir=Ue,ir.setIndex(Qr)),ye.isMesh)fe.wireframe===!0?(Ce.setLineWidth(fe.wireframeLinewidth*oe()),ir.setMode(1)):ir.setMode(4);else if(ye.isLine){let Rt=fe.linewidth;Rt===void 0&&(Rt=1),Ce.setLineWidth(Rt*oe()),ye.isLineSegments?ir.setMode(1):ye.isLineLoop?ir.setMode(2):ir.setMode(3)}else ye.isPoints?ir.setMode(0):ye.isSprite&&ir.setMode(4);if(ye.isInstancedMesh)ir.renderInstances(Yt,tr,ye.count);else if(ve.isInstancedBufferGeometry){const Rt=ve._maxInstanceCount!==void 0?ve._maxInstanceCount:1/0,_i=Math.min(ve.instanceCount,Rt);ir.renderInstances(Yt,tr,_i)}else ir.render(Yt,tr)},this.compile=function(ge,te){function ve(fe,ye,Ne){fe.transparent===!0&&fe.side===Nc&&fe.forceSinglePass===!1?(fe.side=jo,fe.needsUpdate=!0,Yi(fe,ye,Ne),fe.side=Ed,fe.needsUpdate=!0,Yi(fe,ye,Ne),fe.side=Nc):Yi(fe,ye,Ne)}d=xt.get(ge),d.init(),m.push(d),ge.traverseVisible(function(fe){fe.isLight&&fe.layers.test(te.layers)&&(d.pushLight(fe),fe.castShadow&&d.pushShadow(fe))}),d.setupLights(v.useLegacyLights),ge.traverse(function(fe){const ye=fe.material;if(ye)if(Array.isArray(ye))for(let Ne=0;Ne<ye.length;Ne++){const gt=ye[Ne];ve(gt,ge,fe)}else ve(ye,ge,fe)}),m.pop(),d=null};let ie=null;function we(ge){ie&&ie(ge)}function Re(){ct.stop()}function We(){ct.start()}const ct=new S9;ct.setAnimationLoop(we),typeof self<"u"&&ct.setContext(self),this.setAnimationLoop=function(ge){ie=ge,et.setAnimationLoop(ge),ge===null?ct.stop():ct.start()},et.addEventListener("sessionstart",Re),et.addEventListener("sessionend",We),this.render=function(ge,te){if(te!==void 0&&te.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(g===!0)return;ge.matrixWorldAutoUpdate===!0&&ge.updateMatrixWorld(),te.parent===null&&te.matrixWorldAutoUpdate===!0&&te.updateMatrixWorld(),et.enabled===!0&&et.isPresenting===!0&&(et.cameraAutoUpdate===!0&&et.updateCamera(te),te=et.getCamera()),ge.isScene===!0&&ge.onBeforeRender(v,ge,te,_),d=xt.get(ge,m.length),d.init(),m.push(d),X.multiplyMatrices(te.projectionMatrix,te.matrixWorldInverse),K.setFromProjectionMatrix(X),Z=this.localClippingEnabled,B=q.init(this.clippingPlanes,Z),h=bt.get(ge,p.length),h.init(),p.push(h),Ut(ge,te,0,v.sortObjects),h.finish(),v.sortObjects===!0&&h.sort(G,V),B===!0&&q.beginShadows();const ve=d.state.shadowsArray;if(N.render(ve,ge,te),B===!0&&q.endShadows(),this.info.autoReset===!0&&this.info.reset(),de.render(h,ge),d.setupLights(v.useLegacyLights),te.isArrayCamera){const fe=te.cameras;for(let ye=0,Ne=fe.length;ye<Ne;ye++){const gt=fe[ye];si(h,ge,gt,gt.viewport)}}else si(h,ge,te);_!==null&&(Me.updateMultisampleRenderTarget(_),Me.updateRenderTargetMipmap(_)),ge.isScene===!0&&ge.onAfterRender(v,ge,te),Ye.resetDefaultState(),A=-1,C=null,m.pop(),m.length>0?d=m[m.length-1]:d=null,p.pop(),p.length>0?h=p[p.length-1]:h=null};function Ut(ge,te,ve,fe){if(ge.visible===!1)return;if(ge.layers.test(te.layers)){if(ge.isGroup)ve=ge.renderOrder;else if(ge.isLOD)ge.autoUpdate===!0&&ge.update(te);else if(ge.isLight)d.pushLight(ge),ge.castShadow&&d.pushShadow(ge);else if(ge.isSprite){if(!ge.frustumCulled||K.intersectsSprite(ge)){fe&&Y.setFromMatrixPosition(ge.matrixWorld).applyMatrix4(X);const gt=ot.update(ge),St=ge.material;St.visible&&h.push(ge,gt,St,ve,Y.z,null)}}else if((ge.isMesh||ge.isLine||ge.isPoints)&&(ge.isSkinnedMesh&&ge.skeleton.frame!==Ae.render.frame&&(ge.skeleton.update(),ge.skeleton.frame=Ae.render.frame),!ge.frustumCulled||K.intersectsObject(ge))){fe&&Y.setFromMatrixPosition(ge.matrixWorld).applyMatrix4(X);const gt=ot.update(ge),St=ge.material;if(Array.isArray(St)){const Tt=gt.groups;for(let Et=0,Vt=Tt.length;Et<Vt;Et++){const zt=Tt[Et],Yt=St[zt.materialIndex];Yt&&Yt.visible&&h.push(ge,gt,Yt,ve,Y.z,zt)}}else St.visible&&h.push(ge,gt,St,ve,Y.z,null)}}const Ne=ge.children;for(let gt=0,St=Ne.length;gt<St;gt++)Ut(Ne[gt],te,ve,fe)}function si(ge,te,ve,fe){const ye=ge.opaque,Ne=ge.transmissive,gt=ge.transparent;d.setupLightsView(ve),B===!0&&q.setGlobalState(v.clippingPlanes,ve),Ne.length>0&&Si(ye,te,ve),fe&&Ce.viewport(E.copy(fe)),ye.length>0&&ar(ye,te,ve),Ne.length>0&&ar(Ne,te,ve),gt.length>0&&ar(gt,te,ve),Ce.buffers.depth.setTest(!0),Ce.buffers.depth.setMask(!0),Ce.buffers.color.setMask(!0),Ce.setPolygonOffset(!1)}function Si(ge,te,ve){const fe=he.isWebGL2;F===null&&(F=new Vu(1024,1024,{generateMipmaps:!0,type:me.has("EXT_color_buffer_half_float")?ex:Cd,minFilter:Pp,samples:fe&&s===!0?4:0}));const ye=v.getRenderTarget();v.setRenderTarget(F),v.clear();const Ne=v.toneMapping;v.toneMapping=Nu,ar(ge,te,ve),v.toneMapping=Ne,Me.updateMultisampleRenderTarget(F),Me.updateRenderTargetMipmap(F),v.setRenderTarget(ye)}function ar(ge,te,ve){const fe=te.isScene===!0?te.overrideMaterial:null;for(let ye=0,Ne=ge.length;ye<Ne;ye++){const gt=ge[ye],St=gt.object,Tt=gt.geometry,Et=fe===null?gt.material:fe,Vt=gt.group;St.layers.test(ve.layers)&&ri(St,te,ve,Tt,Et,Vt)}}function ri(ge,te,ve,fe,ye,Ne){ge.onBeforeRender(v,te,ve,fe,ye,Ne),ge.modelViewMatrix.multiplyMatrices(ve.matrixWorldInverse,ge.matrixWorld),ge.normalMatrix.getNormalMatrix(ge.modelViewMatrix),ye.onBeforeRender(v,te,ve,fe,ge,Ne),ye.transparent===!0&&ye.side===Nc&&ye.forceSinglePass===!1?(ye.side=jo,ye.needsUpdate=!0,v.renderBufferDirect(ve,te,fe,ye,ge,Ne),ye.side=Ed,ye.needsUpdate=!0,v.renderBufferDirect(ve,te,fe,ye,ge,Ne),ye.side=Nc):v.renderBufferDirect(ve,te,fe,ye,ge,Ne),ge.onAfterRender(v,te,ve,fe,ye,Ne)}function Yi(ge,te,ve){te.isScene!==!0&&(te=le);const fe=Ie.get(ge),ye=d.state.lights,Ne=d.state.shadowsArray,gt=ye.state.version,St=$e.getParameters(ge,ye.state,Ne,te,ve),Tt=$e.getProgramCacheKey(St);let Et=fe.programs;fe.environment=ge.isMeshStandardMaterial?te.environment:null,fe.fog=te.fog,fe.envMap=(ge.isMeshStandardMaterial?Ve:De).get(ge.envMap||fe.environment),Et===void 0&&(ge.addEventListener("dispose",_e),Et=new Map,fe.programs=Et);let Vt=Et.get(Tt);if(Vt!==void 0){if(fe.currentProgram===Vt&&fe.lightsStateVersion===gt)return ji(ge,St),Vt}else St.uniforms=$e.getUniforms(ge),ge.onBuild(ve,St,v),ge.onBeforeCompile(St,v),Vt=$e.acquireProgram(St,Tt),Et.set(Tt,Vt),fe.uniforms=St.uniforms;const zt=fe.uniforms;(!ge.isShaderMaterial&&!ge.isRawShaderMaterial||ge.clipping===!0)&&(zt.clippingPlanes=q.uniform),ji(ge,St),fe.needsLights=Qu(ge),fe.lightsStateVersion=gt,fe.needsLights&&(zt.ambientLightColor.value=ye.state.ambient,zt.lightProbe.value=ye.state.probe,zt.directionalLights.value=ye.state.directional,zt.directionalLightShadows.value=ye.state.directionalShadow,zt.spotLights.value=ye.state.spot,zt.spotLightShadows.value=ye.state.spotShadow,zt.rectAreaLights.value=ye.state.rectArea,zt.ltc_1.value=ye.state.rectAreaLTC1,zt.ltc_2.value=ye.state.rectAreaLTC2,zt.pointLights.value=ye.state.point,zt.pointLightShadows.value=ye.state.pointShadow,zt.hemisphereLights.value=ye.state.hemi,zt.directionalShadowMap.value=ye.state.directionalShadowMap,zt.directionalShadowMatrix.value=ye.state.directionalShadowMatrix,zt.spotShadowMap.value=ye.state.spotShadowMap,zt.spotLightMatrix.value=ye.state.spotLightMatrix,zt.spotLightMap.value=ye.state.spotLightMap,zt.pointShadowMap.value=ye.state.pointShadowMap,zt.pointShadowMatrix.value=ye.state.pointShadowMatrix);const Yt=Vt.getUniforms(),$t=PE.seqWithValue(Yt.seq,zt);return fe.currentProgram=Vt,fe.uniformsList=$t,Vt}function ji(ge,te){const ve=Ie.get(ge);ve.outputEncoding=te.outputEncoding,ve.instancing=te.instancing,ve.skinning=te.skinning,ve.morphTargets=te.morphTargets,ve.morphNormals=te.morphNormals,ve.morphColors=te.morphColors,ve.morphTargetsCount=te.morphTargetsCount,ve.numClippingPlanes=te.numClippingPlanes,ve.numIntersection=te.numClipIntersection,ve.vertexAlphas=te.vertexAlphas,ve.vertexTangents=te.vertexTangents,ve.toneMapping=te.toneMapping}function po(ge,te,ve,fe,ye){te.isScene!==!0&&(te=le),Me.resetTextureUnits();const Ne=te.fog,gt=fe.isMeshStandardMaterial?te.environment:null,St=_===null?v.outputEncoding:_.isXRRenderTarget===!0?_.texture.encoding:Dp,Tt=(fe.isMeshStandardMaterial?Ve:De).get(fe.envMap||gt),Et=fe.vertexColors===!0&&!!ve.attributes.color&&ve.attributes.color.itemSize===4,Vt=!!fe.normalMap&&!!ve.attributes.tangent,zt=!!ve.morphAttributes.position,Yt=!!ve.morphAttributes.normal,$t=!!ve.morphAttributes.color,tr=fe.toneMapped?v.toneMapping:Nu,Qr=ve.morphAttributes.position||ve.morphAttributes.normal||ve.morphAttributes.color,ir=Qr!==void 0?Qr.length:0,Rt=Ie.get(fe),_i=d.state.lights;if(B===!0&&(Z===!0||ge!==C)){const Se=ge===C&&fe.id===A;q.setState(fe,ge,Se)}let Hi=!1;fe.version===Rt.__version?(Rt.needsLights&&Rt.lightsStateVersion!==_i.state.version||Rt.outputEncoding!==St||ye.isInstancedMesh&&Rt.instancing===!1||!ye.isInstancedMesh&&Rt.instancing===!0||ye.isSkinnedMesh&&Rt.skinning===!1||!ye.isSkinnedMesh&&Rt.skinning===!0||Rt.envMap!==Tt||fe.fog===!0&&Rt.fog!==Ne||Rt.numClippingPlanes!==void 0&&(Rt.numClippingPlanes!==q.numPlanes||Rt.numIntersection!==q.numIntersection)||Rt.vertexAlphas!==Et||Rt.vertexTangents!==Vt||Rt.morphTargets!==zt||Rt.morphNormals!==Yt||Rt.morphColors!==$t||Rt.toneMapping!==tr||he.isWebGL2===!0&&Rt.morphTargetsCount!==ir)&&(Hi=!0):(Hi=!0,Rt.__version=fe.version);let ui=Rt.currentProgram;Hi===!0&&(ui=Yi(fe,te,ye));let ls=!1,us=!1,hn=!1;const Ui=ui.getUniforms(),ee=Rt.uniforms;if(Ce.useProgram(ui.program)&&(ls=!0,us=!0,hn=!0),fe.id!==A&&(A=fe.id,us=!0),ls||C!==ge){if(Ui.setValue(re,"projectionMatrix",ge.projectionMatrix),he.logarithmicDepthBuffer&&Ui.setValue(re,"logDepthBufFC",2/(Math.log(ge.far+1)/Math.LN2)),C!==ge&&(C=ge,us=!0,hn=!0),fe.isShaderMaterial||fe.isMeshPhongMaterial||fe.isMeshToonMaterial||fe.isMeshStandardMaterial||fe.envMap){const Se=Ui.map.cameraPosition;Se!==void 0&&Se.setValue(re,Y.setFromMatrixPosition(ge.matrixWorld))}(fe.isMeshPhongMaterial||fe.isMeshToonMaterial||fe.isMeshLambertMaterial||fe.isMeshBasicMaterial||fe.isMeshStandardMaterial||fe.isShaderMaterial)&&Ui.setValue(re,"isOrthographic",ge.isOrthographicCamera===!0),(fe.isMeshPhongMaterial||fe.isMeshToonMaterial||fe.isMeshLambertMaterial||fe.isMeshBasicMaterial||fe.isMeshStandardMaterial||fe.isShaderMaterial||fe.isShadowMaterial||ye.isSkinnedMesh)&&Ui.setValue(re,"viewMatrix",ge.matrixWorldInverse)}if(ye.isSkinnedMesh){Ui.setOptional(re,ye,"bindMatrix"),Ui.setOptional(re,ye,"bindMatrixInverse");const Se=ye.skeleton;Se&&(he.floatVertexTextures?(Se.boneTexture===null&&Se.computeBoneTexture(),Ui.setValue(re,"boneTexture",Se.boneTexture,Me),Ui.setValue(re,"boneTextureSize",Se.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const ae=ve.morphAttributes;if((ae.position!==void 0||ae.normal!==void 0||ae.color!==void 0&&he.isWebGL2===!0)&&ze.update(ye,ve,ui),(us||Rt.receiveShadow!==ye.receiveShadow)&&(Rt.receiveShadow=ye.receiveShadow,Ui.setValue(re,"receiveShadow",ye.receiveShadow)),fe.isMeshGouraudMaterial&&fe.envMap!==null&&(ee.envMap.value=Tt,ee.flipEnvMap.value=Tt.isCubeTexture&&Tt.isRenderTargetTexture===!1?-1:1),us&&(Ui.setValue(re,"toneMappingExposure",v.toneMappingExposure),Rt.needsLights&&Xo(ee,hn),Ne&&fe.fog===!0&&Ke.refreshFogUniforms(ee,Ne),Ke.refreshMaterialUniforms(ee,fe,z,L,F),PE.upload(re,Rt.uniformsList,ee,Me)),fe.isShaderMaterial&&fe.uniformsNeedUpdate===!0&&(PE.upload(re,Rt.uniformsList,ee,Me),fe.uniformsNeedUpdate=!1),fe.isSpriteMaterial&&Ui.setValue(re,"center",ye.center),Ui.setValue(re,"modelViewMatrix",ye.modelViewMatrix),Ui.setValue(re,"normalMatrix",ye.normalMatrix),Ui.setValue(re,"modelMatrix",ye.matrixWorld),fe.isShaderMaterial||fe.isRawShaderMaterial){const Se=fe.uniformsGroups;for(let ce=0,Oe=Se.length;ce<Oe;ce++)if(he.isWebGL2){const vt=Se[ce];Ee.update(vt,ui),Ee.bind(vt,ui)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return ui}function Xo(ge,te){ge.ambientLightColor.needsUpdate=te,ge.lightProbe.needsUpdate=te,ge.directionalLights.needsUpdate=te,ge.directionalLightShadows.needsUpdate=te,ge.pointLights.needsUpdate=te,ge.pointLightShadows.needsUpdate=te,ge.spotLights.needsUpdate=te,ge.spotLightShadows.needsUpdate=te,ge.rectAreaLights.needsUpdate=te,ge.hemisphereLights.needsUpdate=te}function Qu(ge){return ge.isMeshLambertMaterial||ge.isMeshToonMaterial||ge.isMeshPhongMaterial||ge.isMeshStandardMaterial||ge.isShadowMaterial||ge.isShaderMaterial&&ge.lights===!0}this.getActiveCubeFace=function(){return w},this.getActiveMipmapLevel=function(){return S},this.getRenderTarget=function(){return _},this.setRenderTargetTextures=function(ge,te,ve){Ie.get(ge.texture).__webglTexture=te,Ie.get(ge.depthTexture).__webglTexture=ve;const fe=Ie.get(ge);fe.__hasExternalTextures=!0,fe.__hasExternalTextures&&(fe.__autoAllocateDepthBuffer=ve===void 0,fe.__autoAllocateDepthBuffer||me.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),fe.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(ge,te){const ve=Ie.get(ge);ve.__webglFramebuffer=te,ve.__useDefaultFramebuffer=te===void 0},this.setRenderTarget=function(ge,te=0,ve=0){_=ge,w=te,S=ve;let fe=!0,ye=null,Ne=!1,gt=!1;if(ge){const Tt=Ie.get(ge);Tt.__useDefaultFramebuffer!==void 0?(Ce.bindFramebuffer(36160,null),fe=!1):Tt.__webglFramebuffer===void 0?Me.setupRenderTarget(ge):Tt.__hasExternalTextures&&Me.rebindTextures(ge,Ie.get(ge.texture).__webglTexture,Ie.get(ge.depthTexture).__webglTexture);const Et=ge.texture;(Et.isData3DTexture||Et.isDataArrayTexture||Et.isCompressedArrayTexture)&&(gt=!0);const Vt=Ie.get(ge).__webglFramebuffer;ge.isWebGLCubeRenderTarget?(ye=Vt[te],Ne=!0):he.isWebGL2&&ge.samples>0&&Me.useMultisampledRTT(ge)===!1?ye=Ie.get(ge).__webglMultisampledFramebuffer:ye=Vt,E.copy(ge.viewport),I.copy(ge.scissor),T=ge.scissorTest}else E.copy(j).multiplyScalar(z).floor(),I.copy(J).multiplyScalar(z).floor(),T=ne;if(Ce.bindFramebuffer(36160,ye)&&he.drawBuffers&&fe&&Ce.drawBuffers(ge,ye),Ce.viewport(E),Ce.scissor(I),Ce.setScissorTest(T),Ne){const Tt=Ie.get(ge.texture);re.framebufferTexture2D(36160,36064,34069+te,Tt.__webglTexture,ve)}else if(gt){const Tt=Ie.get(ge.texture),Et=te||0;re.framebufferTextureLayer(36160,36064,Tt.__webglTexture,ve||0,Et)}A=-1},this.readRenderTargetPixels=function(ge,te,ve,fe,ye,Ne,gt){if(!(ge&&ge.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let St=Ie.get(ge).__webglFramebuffer;if(ge.isWebGLCubeRenderTarget&&gt!==void 0&&(St=St[gt]),St){Ce.bindFramebuffer(36160,St);try{const Tt=ge.texture,Et=Tt.format,Vt=Tt.type;if(Et!==ko&&rt.convert(Et)!==re.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const zt=Vt===ex&&(me.has("EXT_color_buffer_half_float")||he.isWebGL2&&me.has("EXT_color_buffer_float"));if(Vt!==Cd&&rt.convert(Vt)!==re.getParameter(35738)&&!(Vt===fd&&(he.isWebGL2||me.has("OES_texture_float")||me.has("WEBGL_color_buffer_float")))&&!zt){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}te>=0&&te<=ge.width-fe&&ve>=0&&ve<=ge.height-ye&&re.readPixels(te,ve,fe,ye,rt.convert(Et),rt.convert(Vt),Ne)}finally{const Tt=_!==null?Ie.get(_).__webglFramebuffer:null;Ce.bindFramebuffer(36160,Tt)}}},this.copyFramebufferToTexture=function(ge,te,ve=0){const fe=Math.pow(2,-ve),ye=Math.floor(te.image.width*fe),Ne=Math.floor(te.image.height*fe);Me.setTexture2D(te,0),re.copyTexSubImage2D(3553,ve,0,0,ge.x,ge.y,ye,Ne),Ce.unbindTexture()},this.copyTextureToTexture=function(ge,te,ve,fe=0){const ye=te.image.width,Ne=te.image.height,gt=rt.convert(ve.format),St=rt.convert(ve.type);Me.setTexture2D(ve,0),re.pixelStorei(37440,ve.flipY),re.pixelStorei(37441,ve.premultiplyAlpha),re.pixelStorei(3317,ve.unpackAlignment),te.isDataTexture?re.texSubImage2D(3553,fe,ge.x,ge.y,ye,Ne,gt,St,te.image.data):te.isCompressedTexture?re.compressedTexSubImage2D(3553,fe,ge.x,ge.y,te.mipmaps[0].width,te.mipmaps[0].height,gt,te.mipmaps[0].data):re.texSubImage2D(3553,fe,ge.x,ge.y,gt,St,te.image),fe===0&&ve.generateMipmaps&&re.generateMipmap(3553),Ce.unbindTexture()},this.copyTextureToTexture3D=function(ge,te,ve,fe,ye=0){if(v.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const Ne=ge.max.x-ge.min.x+1,gt=ge.max.y-ge.min.y+1,St=ge.max.z-ge.min.z+1,Tt=rt.convert(fe.format),Et=rt.convert(fe.type);let Vt;if(fe.isData3DTexture)Me.setTexture3D(fe,0),Vt=32879;else if(fe.isDataArrayTexture)Me.setTexture2DArray(fe,0),Vt=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}re.pixelStorei(37440,fe.flipY),re.pixelStorei(37441,fe.premultiplyAlpha),re.pixelStorei(3317,fe.unpackAlignment);const zt=re.getParameter(3314),Yt=re.getParameter(32878),$t=re.getParameter(3316),tr=re.getParameter(3315),Qr=re.getParameter(32877),ir=ve.isCompressedTexture?ve.mipmaps[0]:ve.image;re.pixelStorei(3314,ir.width),re.pixelStorei(32878,ir.height),re.pixelStorei(3316,ge.min.x),re.pixelStorei(3315,ge.min.y),re.pixelStorei(32877,ge.min.z),ve.isDataTexture||ve.isData3DTexture?re.texSubImage3D(Vt,ye,te.x,te.y,te.z,Ne,gt,St,Tt,Et,ir.data):ve.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),re.compressedTexSubImage3D(Vt,ye,te.x,te.y,te.z,Ne,gt,St,Tt,ir.data)):re.texSubImage3D(Vt,ye,te.x,te.y,te.z,Ne,gt,St,Tt,Et,ir),re.pixelStorei(3314,zt),re.pixelStorei(32878,Yt),re.pixelStorei(3316,$t),re.pixelStorei(3315,tr),re.pixelStorei(32877,Qr),ye===0&&fe.generateMipmaps&&re.generateMipmap(Vt),Ce.unbindTexture()},this.initTexture=function(ge){ge.isCubeTexture?Me.setTextureCube(ge,0):ge.isData3DTexture?Me.setTexture3D(ge,0):ge.isDataArrayTexture||ge.isCompressedArrayTexture?Me.setTexture2DArray(ge,0):Me.setTexture2D(ge,0),Ce.unbindTexture()},this.resetState=function(){w=0,S=0,_=null,Ce.reset(),Ye.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Object.defineProperties(DC.prototype,{physicallyCorrectLights:{get:function(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights},set:function(e){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}}});class R9 extends DC{}R9.prototype.isWebGL1Renderer=!0;class RC{constructor(t,i=25e-5){this.isFogExp2=!0,this.name="",this.color=new qt(t),this.density=i}clone(){return new RC(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class IC{constructor(t,i=1,r=1e3){this.isFog=!0,this.name="",this.color=new qt(t),this.near=i,this.far=r}clone(){return new IC(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class i2 extends ur{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,i){return super.copy(t,i),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const i=super.toJSON(t);return this.fog!==null&&(i.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(i.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(i.object.backgroundIntensity=this.backgroundIntensity),i}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(t){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=t}}class LC{constructor(t,i){this.isInterleavedBuffer=!0,this.array=t,this.stride=i,this.count=t!==void 0?t.length/i:0,this.usage=Rb,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=hl()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,i,r){t*=this.stride,r*=i.stride;for(let n=0,s=this.stride;n<s;n++)this.array[t+n]=i.array[r+n];return this}set(t,i=0){return this.array.set(t,i),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=hl()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const i=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(i,this.stride);return r.setUsage(this.usage),r}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=hl()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Za=new pe;class Fg{constructor(t,i,r,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=i,this.offset=r,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let i=0,r=this.data.count;i<r;i++)Za.fromBufferAttribute(this,i),Za.applyMatrix4(t),this.setXYZ(i,Za.x,Za.y,Za.z);return this}applyNormalMatrix(t){for(let i=0,r=this.count;i<r;i++)Za.fromBufferAttribute(this,i),Za.applyNormalMatrix(t),this.setXYZ(i,Za.x,Za.y,Za.z);return this}transformDirection(t){for(let i=0,r=this.count;i<r;i++)Za.fromBufferAttribute(this,i),Za.transformDirection(t),this.setXYZ(i,Za.x,Za.y,Za.z);return this}setX(t,i){return this.normalized&&(i=Lr(i,this.array)),this.data.array[t*this.data.stride+this.offset]=i,this}setY(t,i){return this.normalized&&(i=Lr(i,this.array)),this.data.array[t*this.data.stride+this.offset+1]=i,this}setZ(t,i){return this.normalized&&(i=Lr(i,this.array)),this.data.array[t*this.data.stride+this.offset+2]=i,this}setW(t,i){return this.normalized&&(i=Lr(i,this.array)),this.data.array[t*this.data.stride+this.offset+3]=i,this}getX(t){let i=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(i=pd(i,this.array)),i}getY(t){let i=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(i=pd(i,this.array)),i}getZ(t){let i=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(i=pd(i,this.array)),i}getW(t){let i=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(i=pd(i,this.array)),i}setXY(t,i,r){return t=t*this.data.stride+this.offset,this.normalized&&(i=Lr(i,this.array),r=Lr(r,this.array)),this.data.array[t+0]=i,this.data.array[t+1]=r,this}setXYZ(t,i,r,n){return t=t*this.data.stride+this.offset,this.normalized&&(i=Lr(i,this.array),r=Lr(r,this.array),n=Lr(n,this.array)),this.data.array[t+0]=i,this.data.array[t+1]=r,this.data.array[t+2]=n,this}setXYZW(t,i,r,n,s){return t=t*this.data.stride+this.offset,this.normalized&&(i=Lr(i,this.array),r=Lr(r,this.array),n=Lr(n,this.array),s=Lr(s,this.array)),this.data.array[t+0]=i,this.data.array[t+1]=r,this.data.array[t+2]=n,this.data.array[t+3]=s,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let r=0;r<this.count;r++){const n=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)i.push(this.data.array[n+s])}return new kr(new this.array.constructor(i),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Fg(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let r=0;r<this.count;r++){const n=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)i.push(this.data.array[n+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class yz extends wa{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new qt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let C0;const Z1=new pe,T0=new pe,P0=new pe,D0=new ft,J1=new ft,I9=new Oi,wM=new pe,$1=new pe,bM=new pe,YF=new ft,DP=new ft,QF=new ft;class L9 extends ur{constructor(t){if(super(),this.isSprite=!0,this.type="Sprite",C0===void 0){C0=new Fi;const i=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),r=new LC(i,5);C0.setIndex([0,1,2,0,2,3]),C0.setAttribute("position",new Fg(r,3,0,!1)),C0.setAttribute("uv",new Fg(r,2,3,!1))}this.geometry=C0,this.material=t!==void 0?t:new yz,this.center=new ft(.5,.5)}raycast(t,i){t.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),T0.setFromMatrixScale(this.matrixWorld),I9.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),P0.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&T0.multiplyScalar(-P0.z);const r=this.material.rotation;let n,s;r!==0&&(s=Math.cos(r),n=Math.sin(r));const a=this.center;_M(wM.set(-.5,-.5,0),P0,a,T0,n,s),_M($1.set(.5,-.5,0),P0,a,T0,n,s),_M(bM.set(.5,.5,0),P0,a,T0,n,s),YF.set(0,0),DP.set(1,0),QF.set(1,1);let o=t.ray.intersectTriangle(wM,$1,bM,!1,Z1);if(o===null&&(_M($1.set(-.5,.5,0),P0,a,T0,n,s),DP.set(0,1),o=t.ray.intersectTriangle(wM,bM,$1,!1,Z1),o===null))return;const l=t.ray.origin.distanceTo(Z1);l<t.near||l>t.far||i.push({distance:l,point:Z1.clone(),uv:Vl.getUV(Z1,wM,$1,bM,YF,DP,QF,new ft),face:null,object:this})}copy(t,i){return super.copy(t,i),t.center!==void 0&&this.center.copy(t.center),this.material=t.material,this}}function _M(e,t,i,r,n,s){D0.subVectors(e,i).addScalar(.5).multiply(r),n!==void 0?(J1.x=s*D0.x-n*D0.y,J1.y=n*D0.x+s*D0.y):J1.copy(D0),e.copy(t),e.x+=J1.x,e.y+=J1.y,e.applyMatrix4(I9)}const SM=new pe,KF=new pe;class O9 extends ur{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const i=t.levels;for(let r=0,n=i.length;r<n;r++){const s=i[r];this.addLevel(s.object.clone(),s.distance,s.hysteresis)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,i=0,r=0){i=Math.abs(i);const n=this.levels;let s;for(s=0;s<n.length&&!(i<n[s].distance);s++);return n.splice(s,0,{distance:i,hysteresis:r,object:t}),this.add(t),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const i=this.levels;if(i.length>0){let r,n;for(r=1,n=i.length;r<n;r++){let s=i[r].distance;if(i[r].object.visible&&(s-=s*i[r].hysteresis),t<s)break}return i[r-1].object}return null}raycast(t,i){if(this.levels.length>0){SM.setFromMatrixPosition(this.matrixWorld);const n=t.ray.origin.distanceTo(SM);this.getObjectForDistance(n).raycast(t,i)}}update(t){const i=this.levels;if(i.length>1){SM.setFromMatrixPosition(t.matrixWorld),KF.setFromMatrixPosition(this.matrixWorld);const r=SM.distanceTo(KF)/t.zoom;i[0].object.visible=!0;let n,s;for(n=1,s=i.length;n<s;n++){let a=i[n].distance;if(i[n].object.visible&&(a-=a*i[n].hysteresis),r>=a)i[n-1].object.visible=!1,i[n].object.visible=!0;else break}for(this._currentLevel=n-1;n<s;n++)i[n].object.visible=!1}}toJSON(t){const i=super.toJSON(t);this.autoUpdate===!1&&(i.object.autoUpdate=!1),i.object.levels=[];const r=this.levels;for(let n=0,s=r.length;n<s;n++){const a=r[n];i.object.levels.push({object:a.object.uuid,distance:a.distance,hysteresis:a.hysteresis})}return i}}const ZF=new pe,JF=new _r,$F=new _r,moe=new pe,e4=new Oi;class z9 extends js{constructor(t,i){super(t,i),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Oi,this.bindMatrixInverse=new Oi}copy(t,i){return super.copy(t,i),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,i){this.skeleton=t,i===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),i=this.matrixWorld),this.bindMatrix.copy(i),this.bindMatrixInverse.copy(i).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new _r,i=this.geometry.attributes.skinWeight;for(let r=0,n=i.count;r<n;r++){t.fromBufferAttribute(i,r);const s=1/t.manhattanLength();s!==1/0?t.multiplyScalar(s):t.set(1,0,0,0),i.setXYZW(r,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(t,i){const r=this.skeleton,n=this.geometry;JF.fromBufferAttribute(n.attributes.skinIndex,t),$F.fromBufferAttribute(n.attributes.skinWeight,t),ZF.copy(i).applyMatrix4(this.bindMatrix),i.set(0,0,0);for(let s=0;s<4;s++){const a=$F.getComponent(s);if(a!==0){const o=JF.getComponent(s);e4.multiplyMatrices(r.bones[o].matrixWorld,r.boneInverses[o]),i.addScaledVector(moe.copy(ZF).applyMatrix4(e4),a)}}return i.applyMatrix4(this.bindMatrixInverse)}}class xz extends ur{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Uy extends _n{constructor(t=null,i=1,r=1,n,s,a,o,l,u=Ln,c=Ln,h,d){super(null,a,o,l,u,c,n,s,h,d),this.isDataTexture=!0,this.image={data:t,width:i,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const t4=new Oi,goe=new Oi;class OC{constructor(t=[],i=[]){this.uuid=hl(),this.bones=t.slice(0),this.boneInverses=i,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const t=this.bones,i=this.boneInverses;if(this.boneMatrices=new Float32Array(t.length*16),i.length===0)this.calculateInverses();else if(t.length!==i.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let r=0,n=this.bones.length;r<n;r++)this.boneInverses.push(new Oi)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,i=this.bones.length;t<i;t++){const r=new Oi;this.bones[t]&&r.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let t=0,i=this.bones.length;t<i;t++){const r=this.bones[t];r&&r.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,i=this.bones.length;t<i;t++){const r=this.bones[t];r&&(r.parent&&r.parent.isBone?(r.matrix.copy(r.parent.matrixWorld).invert(),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}}update(){const t=this.bones,i=this.boneInverses,r=this.boneMatrices,n=this.boneTexture;for(let s=0,a=t.length;s<a;s++){const o=t[s]?t[s].matrixWorld:goe;t4.multiplyMatrices(o,i[s]),t4.toArray(r,s*16)}n!==null&&(n.needsUpdate=!0)}clone(){return new OC(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(this.bones.length*4);t=g9(t),t=Math.max(t,4);const i=new Float32Array(t*t*4);i.set(this.boneMatrices);const r=new Uy(i,t,t,ko,fd);return r.needsUpdate=!0,this.boneMatrices=i,this.boneTexture=r,this.boneTextureSize=t,this}getBoneByName(t){for(let i=0,r=this.bones.length;i<r;i++){const n=this.bones[i];if(n.name===t)return n}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,i){this.uuid=t.uuid;for(let r=0,n=t.bones.length;r<n;r++){const s=t.bones[r];let a=i[s];a===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),a=new xz),this.bones.push(a),this.boneInverses.push(new Oi().fromArray(t.boneInverses[r]))}return this.init(),this}toJSON(){const t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const i=this.bones,r=this.boneInverses;for(let n=0,s=i.length;n<s;n++){const a=i[n];t.bones.push(a.uuid);const o=r[n];t.boneInverses.push(o.toArray())}return t}}class rx extends kr{constructor(t,i,r,n=1){super(t,i,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const i4=new Oi,r4=new Oi,MM=[],voe=new Oi,ew=new js;class k9 extends js{constructor(t,i,r){super(t,i),this.isInstancedMesh=!0,this.instanceMatrix=new rx(new Float32Array(r*16),16),this.instanceColor=null,this.count=r,this.frustumCulled=!1;for(let n=0;n<r;n++)this.setMatrixAt(n,voe)}copy(t,i){return super.copy(t,i),this.instanceMatrix.copy(t.instanceMatrix),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,i){i.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,i){i.fromArray(this.instanceMatrix.array,t*16)}raycast(t,i){const r=this.matrixWorld,n=this.count;if(ew.geometry=this.geometry,ew.material=this.material,ew.material!==void 0)for(let s=0;s<n;s++){this.getMatrixAt(s,i4),r4.multiplyMatrices(r,i4),ew.matrixWorld=r4,ew.raycast(t,MM);for(let a=0,o=MM.length;a<o;a++){const l=MM[a];l.instanceId=s,l.object=this,i.push(l)}MM.length=0}}setColorAt(t,i){this.instanceColor===null&&(this.instanceColor=new rx(new Float32Array(this.instanceMatrix.count*3),3)),i.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,i){i.toArray(this.instanceMatrix.array,t*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class ho extends wa{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new qt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const n4=new pe,s4=new pe,a4=new Oi,RP=new Cx,AM=new tv;class Rp extends ur{constructor(t=new Fi,i=new ho){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=i,this.updateMorphTargets()}copy(t,i){return super.copy(t,i),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.index===null){const i=t.attributes.position,r=[0];for(let n=1,s=i.count;n<s;n++)n4.fromBufferAttribute(i,n-1),s4.fromBufferAttribute(i,n),r[n]=r[n-1],r[n]+=n4.distanceTo(s4);t.setAttribute("lineDistance",new Jt(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,i){const r=this.geometry,n=this.matrixWorld,s=t.params.Line.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),AM.copy(r.boundingSphere),AM.applyMatrix4(n),AM.radius+=s,t.ray.intersectsSphere(AM)===!1)return;a4.copy(n).invert(),RP.copy(t.ray).applyMatrix4(a4);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,u=new pe,c=new pe,h=new pe,d=new pe,p=this.isLineSegments?2:1,m=r.index,g=r.attributes.position;if(m!==null){const w=Math.max(0,a.start),S=Math.min(m.count,a.start+a.count);for(let _=w,A=S-1;_<A;_+=p){const C=m.getX(_),E=m.getX(_+1);if(u.fromBufferAttribute(g,C),c.fromBufferAttribute(g,E),RP.distanceSqToSegment(u,c,d,h)>l)continue;d.applyMatrix4(this.matrixWorld);const T=t.ray.origin.distanceTo(d);T<t.near||T>t.far||i.push({distance:T,point:h.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}else{const w=Math.max(0,a.start),S=Math.min(g.count,a.start+a.count);for(let _=w,A=S-1;_<A;_+=p){if(u.fromBufferAttribute(g,_),c.fromBufferAttribute(g,_+1),RP.distanceSqToSegment(u,c,d,h)>l)continue;d.applyMatrix4(this.matrixWorld);const E=t.ray.origin.distanceTo(d);E<t.near||E>t.far||i.push({distance:E,point:h.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const i=this.geometry.morphAttributes,r=Object.keys(i);if(r.length>0){const n=i[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++){const o=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}const o4=new pe,l4=new pe;class ih extends Rp{constructor(t,i){super(t,i),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.index===null){const i=t.attributes.position,r=[];for(let n=0,s=i.count;n<s;n+=2)o4.fromBufferAttribute(i,n),l4.fromBufferAttribute(i,n+1),r[n]=n===0?0:r[n-1],r[n+1]=r[n]+o4.distanceTo(l4);t.setAttribute("lineDistance",new Jt(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class B9 extends Rp{constructor(t,i){super(t,i),this.isLineLoop=!0,this.type="LineLoop"}}class wz extends wa{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new qt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const u4=new Oi,hI=new Cx,EM=new tv,CM=new pe;class N9 extends ur{constructor(t=new Fi,i=new wz){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=i,this.updateMorphTargets()}copy(t,i){return super.copy(t,i),this.material=t.material,this.geometry=t.geometry,this}raycast(t,i){const r=this.geometry,n=this.matrixWorld,s=t.params.Points.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),EM.copy(r.boundingSphere),EM.applyMatrix4(n),EM.radius+=s,t.ray.intersectsSphere(EM)===!1)return;u4.copy(n).invert(),hI.copy(t.ray).applyMatrix4(u4);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,u=r.index,h=r.attributes.position;if(u!==null){const d=Math.max(0,a.start),p=Math.min(u.count,a.start+a.count);for(let m=d,v=p;m<v;m++){const g=u.getX(m);CM.fromBufferAttribute(h,g),c4(CM,g,l,n,t,i,this)}}else{const d=Math.max(0,a.start),p=Math.min(h.count,a.start+a.count);for(let m=d,v=p;m<v;m++)CM.fromBufferAttribute(h,m),c4(CM,m,l,n,t,i,this)}}updateMorphTargets(){const i=this.geometry.morphAttributes,r=Object.keys(i);if(r.length>0){const n=i[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++){const o=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}function c4(e,t,i,r,n,s,a){const o=hI.distanceSqToPoint(e);if(o<i){const l=new pe;hI.closestPointToPoint(e,l),l.applyMatrix4(r);const u=n.ray.origin.distanceTo(l);if(u<n.near||u>n.far)return;s.push({distance:u,distanceToRay:Math.sqrt(o),point:l,index:t,face:null,object:a})}}class yoe extends _n{constructor(t,i,r,n,s,a,o,l,u){super(t,i,r,n,s,a,o,l,u),this.isVideoTexture=!0,this.minFilter=a!==void 0?a:On,this.magFilter=s!==void 0?s:On,this.generateMipmaps=!1;const c=this;function h(){c.needsUpdate=!0,t.requestVideoFrameCallback(h)}"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(h)}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;"requestVideoFrameCallback"in t===!1&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class xoe extends _n{constructor(t,i,r){super({width:t,height:i}),this.isFramebufferTexture=!0,this.format=r,this.magFilter=Ln,this.minFilter=Ln,this.generateMipmaps=!1,this.needsUpdate=!0}}class bz extends _n{constructor(t,i,r,n,s,a,o,l,u,c,h,d){super(null,a,o,l,u,c,n,s,h,d),this.isCompressedTexture=!0,this.image={width:i,height:r},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}class woe extends bz{constructor(t,i,r,n,s,a){super(t,i,r,s,a),this.isCompressedArrayTexture=!0,this.image.depth=n,this.wrapR=Oa}}class boe extends _n{constructor(t,i,r,n,s,a,o,l,u){super(t,i,r,n,s,a,o,l,u),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Gu{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,i){const r=this.getUtoTmapping(t);return this.getPoint(r,i)}getPoints(t=5){const i=[];for(let r=0;r<=t;r++)i.push(this.getPoint(r/t));return i}getSpacedPoints(t=5){const i=[];for(let r=0;r<=t;r++)i.push(this.getPointAt(r/t));return i}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const i=[];let r,n=this.getPoint(0),s=0;i.push(0);for(let a=1;a<=t;a++)r=this.getPoint(a/t),s+=r.distanceTo(n),i.push(s),n=r;return this.cacheArcLengths=i,i}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,i){const r=this.getLengths();let n=0;const s=r.length;let a;i?a=i:a=t*r[s-1];let o=0,l=s-1,u;for(;o<=l;)if(n=Math.floor(o+(l-o)/2),u=r[n]-a,u<0)o=n+1;else if(u>0)l=n-1;else{l=n;break}if(n=l,r[n]===a)return n/(s-1);const c=r[n],d=r[n+1]-c,p=(a-c)/d;return(n+p)/(s-1)}getTangent(t,i){let n=t-1e-4,s=t+1e-4;n<0&&(n=0),s>1&&(s=1);const a=this.getPoint(n),o=this.getPoint(s),l=i||(a.isVector2?new ft:new pe);return l.copy(o).sub(a).normalize(),l}getTangentAt(t,i){const r=this.getUtoTmapping(t);return this.getTangent(r,i)}computeFrenetFrames(t,i){const r=new pe,n=[],s=[],a=[],o=new pe,l=new Oi;for(let p=0;p<=t;p++){const m=p/t;n[p]=this.getTangentAt(m,new pe)}s[0]=new pe,a[0]=new pe;let u=Number.MAX_VALUE;const c=Math.abs(n[0].x),h=Math.abs(n[0].y),d=Math.abs(n[0].z);c<=u&&(u=c,r.set(1,0,0)),h<=u&&(u=h,r.set(0,1,0)),d<=u&&r.set(0,0,1),o.crossVectors(n[0],r).normalize(),s[0].crossVectors(n[0],o),a[0].crossVectors(n[0],s[0]);for(let p=1;p<=t;p++){if(s[p]=s[p-1].clone(),a[p]=a[p-1].clone(),o.crossVectors(n[p-1],n[p]),o.length()>Number.EPSILON){o.normalize();const m=Math.acos(zn(n[p-1].dot(n[p]),-1,1));s[p].applyMatrix4(l.makeRotationAxis(o,m))}a[p].crossVectors(n[p],s[p])}if(i===!0){let p=Math.acos(zn(s[0].dot(s[t]),-1,1));p/=t,n[0].dot(o.crossVectors(s[0],s[t]))>0&&(p=-p);for(let m=1;m<=t;m++)s[m].applyMatrix4(l.makeRotationAxis(n[m],p*m)),a[m].crossVectors(n[m],s[m])}return{tangents:n,normals:s,binormals:a}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class zC extends Gu{constructor(t=0,i=0,r=1,n=1,s=0,a=Math.PI*2,o=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=i,this.xRadius=r,this.yRadius=n,this.aStartAngle=s,this.aEndAngle=a,this.aClockwise=o,this.aRotation=l}getPoint(t,i){const r=i||new ft,n=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const a=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=n;for(;s>n;)s-=n;s<Number.EPSILON&&(a?s=0:s=n),this.aClockwise===!0&&!a&&(s===n?s=-n:s=s-n);const o=this.aStartAngle+t*s;let l=this.aX+this.xRadius*Math.cos(o),u=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const c=Math.cos(this.aRotation),h=Math.sin(this.aRotation),d=l-this.aX,p=u-this.aY;l=d*c-p*h+this.aX,u=d*h+p*c+this.aY}return r.set(l,u)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class F9 extends zC{constructor(t,i,r,n,s,a){super(t,i,r,r,n,s,a),this.isArcCurve=!0,this.type="ArcCurve"}}function _z(){let e=0,t=0,i=0,r=0;function n(s,a,o,l){e=s,t=o,i=-3*s+3*a-2*o-l,r=2*s-2*a+o+l}return{initCatmullRom:function(s,a,o,l,u){n(a,o,u*(o-s),u*(l-a))},initNonuniformCatmullRom:function(s,a,o,l,u,c,h){let d=(a-s)/u-(o-s)/(u+c)+(o-a)/c,p=(o-a)/c-(l-a)/(c+h)+(l-o)/h;d*=c,p*=c,n(a,o,d,p)},calc:function(s){const a=s*s,o=a*s;return e+t*s+i*a+r*o}}}const TM=new pe,IP=new _z,LP=new _z,OP=new _z;class U9 extends Gu{constructor(t=[],i=!1,r="centripetal",n=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=i,this.curveType=r,this.tension=n}getPoint(t,i=new pe){const r=i,n=this.points,s=n.length,a=(s-(this.closed?0:1))*t;let o=Math.floor(a),l=a-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/s)+1)*s:l===0&&o===s-1&&(o=s-2,l=1);let u,c;this.closed||o>0?u=n[(o-1)%s]:(TM.subVectors(n[0],n[1]).add(n[0]),u=TM);const h=n[o%s],d=n[(o+1)%s];if(this.closed||o+2<s?c=n[(o+2)%s]:(TM.subVectors(n[s-1],n[s-2]).add(n[s-1]),c=TM),this.curveType==="centripetal"||this.curveType==="chordal"){const p=this.curveType==="chordal"?.5:.25;let m=Math.pow(u.distanceToSquared(h),p),v=Math.pow(h.distanceToSquared(d),p),g=Math.pow(d.distanceToSquared(c),p);v<1e-4&&(v=1),m<1e-4&&(m=v),g<1e-4&&(g=v),IP.initNonuniformCatmullRom(u.x,h.x,d.x,c.x,m,v,g),LP.initNonuniformCatmullRom(u.y,h.y,d.y,c.y,m,v,g),OP.initNonuniformCatmullRom(u.z,h.z,d.z,c.z,m,v,g)}else this.curveType==="catmullrom"&&(IP.initCatmullRom(u.x,h.x,d.x,c.x,this.tension),LP.initCatmullRom(u.y,h.y,d.y,c.y,this.tension),OP.initCatmullRom(u.z,h.z,d.z,c.z,this.tension));return r.set(IP.calc(l),LP.calc(l),OP.calc(l)),r}copy(t){super.copy(t),this.points=[];for(let i=0,r=t.points.length;i<r;i++){const n=t.points[i];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let i=0,r=this.points.length;i<r;i++){const n=this.points[i];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let i=0,r=t.points.length;i<r;i++){const n=t.points[i];this.points.push(new pe().fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function h4(e,t,i,r,n){const s=(r-t)*.5,a=(n-i)*.5,o=e*e,l=e*o;return(2*i-2*r+s+a)*l+(-3*i+3*r-2*s-a)*o+s*e+i}function _oe(e,t){const i=1-e;return i*i*t}function Soe(e,t){return 2*(1-e)*e*t}function Moe(e,t){return e*e*t}function eb(e,t,i,r){return _oe(e,t)+Soe(e,i)+Moe(e,r)}function Aoe(e,t){const i=1-e;return i*i*i*t}function Eoe(e,t){const i=1-e;return 3*i*i*e*t}function Coe(e,t){return 3*(1-e)*e*e*t}function Toe(e,t){return e*e*e*t}function tb(e,t,i,r,n){return Aoe(e,t)+Eoe(e,i)+Coe(e,r)+Toe(e,n)}class Sz extends Gu{constructor(t=new ft,i=new ft,r=new ft,n=new ft){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=i,this.v2=r,this.v3=n}getPoint(t,i=new ft){const r=i,n=this.v0,s=this.v1,a=this.v2,o=this.v3;return r.set(tb(t,n.x,s.x,a.x,o.x),tb(t,n.y,s.y,a.y,o.y)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class V9 extends Gu{constructor(t=new pe,i=new pe,r=new pe,n=new pe){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=i,this.v2=r,this.v3=n}getPoint(t,i=new pe){const r=i,n=this.v0,s=this.v1,a=this.v2,o=this.v3;return r.set(tb(t,n.x,s.x,a.x,o.x),tb(t,n.y,s.y,a.y,o.y),tb(t,n.z,s.z,a.z,o.z)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class kC extends Gu{constructor(t=new ft,i=new ft){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=i}getPoint(t,i=new ft){const r=i;return t===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r}getPointAt(t,i){return this.getPoint(t,i)}getTangent(t,i=new ft){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,i){return this.getTangent(t,i)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class j9 extends Gu{constructor(t=new pe,i=new pe){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=i}getPoint(t,i=new pe){const r=i;return t===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r}getPointAt(t,i){return this.getPoint(t,i)}getTangent(t,i=new pe){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,i){return this.getTangent(t,i)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Mz extends Gu{constructor(t=new ft,i=new ft,r=new ft){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=i,this.v2=r}getPoint(t,i=new ft){const r=i,n=this.v0,s=this.v1,a=this.v2;return r.set(eb(t,n.x,s.x,a.x),eb(t,n.y,s.y,a.y)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Az extends Gu{constructor(t=new pe,i=new pe,r=new pe){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=i,this.v2=r}getPoint(t,i=new pe){const r=i,n=this.v0,s=this.v1,a=this.v2;return r.set(eb(t,n.x,s.x,a.x),eb(t,n.y,s.y,a.y),eb(t,n.z,s.z,a.z)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Ez extends Gu{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,i=new ft){const r=i,n=this.points,s=(n.length-1)*t,a=Math.floor(s),o=s-a,l=n[a===0?a:a-1],u=n[a],c=n[a>n.length-2?n.length-1:a+1],h=n[a>n.length-3?n.length-1:a+2];return r.set(h4(o,l.x,u.x,c.x,h.x),h4(o,l.y,u.y,c.y,h.y)),r}copy(t){super.copy(t),this.points=[];for(let i=0,r=t.points.length;i<r;i++){const n=t.points[i];this.points.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let i=0,r=this.points.length;i<r;i++){const n=this.points[i];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let i=0,r=t.points.length;i<r;i++){const n=t.points[i];this.points.push(new ft().fromArray(n))}return this}}var Cz=Object.freeze({__proto__:null,ArcCurve:F9,CatmullRomCurve3:U9,CubicBezierCurve:Sz,CubicBezierCurve3:V9,EllipseCurve:zC,LineCurve:kC,LineCurve3:j9,QuadraticBezierCurve:Mz,QuadraticBezierCurve3:Az,SplineCurve:Ez});class H9 extends Gu{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),i=this.curves[this.curves.length-1].getPoint(1);t.equals(i)||this.curves.push(new kC(i,t))}getPoint(t,i){const r=t*this.getLength(),n=this.getCurveLengths();let s=0;for(;s<n.length;){if(n[s]>=r){const a=n[s]-r,o=this.curves[s],l=o.getLength(),u=l===0?0:1-a/l;return o.getPointAt(u,i)}s++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let i=0;for(let r=0,n=this.curves.length;r<n;r++)i+=this.curves[r].getLength(),t.push(i);return this.cacheLengths=t,t}getSpacedPoints(t=40){const i=[];for(let r=0;r<=t;r++)i.push(this.getPoint(r/t));return this.autoClose&&i.push(i[0]),i}getPoints(t=12){const i=[];let r;for(let n=0,s=this.curves;n<s.length;n++){const a=s[n],o=a.isEllipseCurve?t*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?t*a.points.length:t,l=a.getPoints(o);for(let u=0;u<l.length;u++){const c=l[u];r&&r.equals(c)||(i.push(c),r=c)}}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}copy(t){super.copy(t),this.curves=[];for(let i=0,r=t.curves.length;i<r;i++){const n=t.curves[i];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let i=0,r=this.curves.length;i<r;i++){const n=this.curves[i];t.curves.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let i=0,r=t.curves.length;i<r;i++){const n=t.curves[i];this.curves.push(new Cz[n.type]().fromJSON(n))}return this}}class Ob extends H9{constructor(t){super(),this.type="Path",this.currentPoint=new ft,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let i=1,r=t.length;i<r;i++)this.lineTo(t[i].x,t[i].y);return this}moveTo(t,i){return this.currentPoint.set(t,i),this}lineTo(t,i){const r=new kC(this.currentPoint.clone(),new ft(t,i));return this.curves.push(r),this.currentPoint.set(t,i),this}quadraticCurveTo(t,i,r,n){const s=new Mz(this.currentPoint.clone(),new ft(t,i),new ft(r,n));return this.curves.push(s),this.currentPoint.set(r,n),this}bezierCurveTo(t,i,r,n,s,a){const o=new Sz(this.currentPoint.clone(),new ft(t,i),new ft(r,n),new ft(s,a));return this.curves.push(o),this.currentPoint.set(s,a),this}splineThru(t){const i=[this.currentPoint.clone()].concat(t),r=new Ez(i);return this.curves.push(r),this.currentPoint.copy(t[t.length-1]),this}arc(t,i,r,n,s,a){const o=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(t+o,i+l,r,n,s,a),this}absarc(t,i,r,n,s,a){return this.absellipse(t,i,r,r,n,s,a),this}ellipse(t,i,r,n,s,a,o,l){const u=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+u,i+c,r,n,s,a,o,l),this}absellipse(t,i,r,n,s,a,o,l){const u=new zC(t,i,r,n,s,a,o,l);if(this.curves.length>0){const h=u.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(u);const c=u.getPoint(1);return this.currentPoint.copy(c),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class Dx extends Fi{constructor(t=[new ft(0,-.5),new ft(.5,0),new ft(0,.5)],i=12,r=0,n=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:t,segments:i,phiStart:r,phiLength:n},i=Math.floor(i),n=zn(n,0,Math.PI*2);const s=[],a=[],o=[],l=[],u=[],c=1/i,h=new pe,d=new ft,p=new pe,m=new pe,v=new pe;let g=0,w=0;for(let S=0;S<=t.length-1;S++)switch(S){case 0:g=t[S+1].x-t[S].x,w=t[S+1].y-t[S].y,p.x=w*1,p.y=-g,p.z=w*0,v.copy(p),p.normalize(),l.push(p.x,p.y,p.z);break;case t.length-1:l.push(v.x,v.y,v.z);break;default:g=t[S+1].x-t[S].x,w=t[S+1].y-t[S].y,p.x=w*1,p.y=-g,p.z=w*0,m.copy(p),p.x+=v.x,p.y+=v.y,p.z+=v.z,p.normalize(),l.push(p.x,p.y,p.z),v.copy(m)}for(let S=0;S<=i;S++){const _=r+S*c*n,A=Math.sin(_),C=Math.cos(_);for(let E=0;E<=t.length-1;E++){h.x=t[E].x*A,h.y=t[E].y,h.z=t[E].x*C,a.push(h.x,h.y,h.z),d.x=S/i,d.y=E/(t.length-1),o.push(d.x,d.y);const I=l[3*E+0]*A,T=l[3*E+1],D=l[3*E+0]*C;u.push(I,T,D)}}for(let S=0;S<i;S++)for(let _=0;_<t.length-1;_++){const A=_+S*t.length,C=A,E=A+t.length,I=A+t.length+1,T=A+1;s.push(C,E,T),s.push(I,T,E)}this.setIndex(s),this.setAttribute("position",new Jt(a,3)),this.setAttribute("uv",new Jt(o,2)),this.setAttribute("normal",new Jt(u,3))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Dx(t.points,t.segments,t.phiStart,t.phiLength)}}class S_ extends Dx{constructor(t=1,i=1,r=4,n=8){const s=new Ob;s.absarc(0,-i/2,t,Math.PI*1.5,0),s.absarc(0,i/2,t,0,Math.PI*.5),super(s.getPoints(r),n),this.type="CapsuleGeometry",this.parameters={radius:t,height:i,capSegments:r,radialSegments:n}}static fromJSON(t){return new S_(t.radius,t.length,t.capSegments,t.radialSegments)}}class M_ extends Fi{constructor(t=1,i=32,r=0,n=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:i,thetaStart:r,thetaLength:n},i=Math.max(3,i);const s=[],a=[],o=[],l=[],u=new pe,c=new ft;a.push(0,0,0),o.push(0,0,1),l.push(.5,.5);for(let h=0,d=3;h<=i;h++,d+=3){const p=r+h/i*n;u.x=t*Math.cos(p),u.y=t*Math.sin(p),a.push(u.x,u.y,u.z),o.push(0,0,1),c.x=(a[d]/t+1)/2,c.y=(a[d+1]/t+1)/2,l.push(c.x,c.y)}for(let h=1;h<=i;h++)s.push(h,h+1,0);this.setIndex(s),this.setAttribute("position",new Jt(a,3)),this.setAttribute("normal",new Jt(o,3)),this.setAttribute("uv",new Jt(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new M_(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class rv extends Fi{constructor(t=1,i=1,r=1,n=32,s=1,a=!1,o=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:i,height:r,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l};const u=this;n=Math.floor(n),s=Math.floor(s);const c=[],h=[],d=[],p=[];let m=0;const v=[],g=r/2;let w=0;S(),a===!1&&(t>0&&_(!0),i>0&&_(!1)),this.setIndex(c),this.setAttribute("position",new Jt(h,3)),this.setAttribute("normal",new Jt(d,3)),this.setAttribute("uv",new Jt(p,2));function S(){const A=new pe,C=new pe;let E=0;const I=(i-t)/r;for(let T=0;T<=s;T++){const D=[],L=T/s,z=L*(i-t)+t;for(let G=0;G<=n;G++){const V=G/n,j=V*l+o,J=Math.sin(j),ne=Math.cos(j);C.x=z*J,C.y=-L*r+g,C.z=z*ne,h.push(C.x,C.y,C.z),A.set(J,I,ne).normalize(),d.push(A.x,A.y,A.z),p.push(V,1-L),D.push(m++)}v.push(D)}for(let T=0;T<n;T++)for(let D=0;D<s;D++){const L=v[D][T],z=v[D+1][T],G=v[D+1][T+1],V=v[D][T+1];c.push(L,z,V),c.push(z,G,V),E+=6}u.addGroup(w,E,0),w+=E}function _(A){const C=m,E=new ft,I=new pe;let T=0;const D=A===!0?t:i,L=A===!0?1:-1;for(let G=1;G<=n;G++)h.push(0,g*L,0),d.push(0,L,0),p.push(.5,.5),m++;const z=m;for(let G=0;G<=n;G++){const j=G/n*l+o,J=Math.cos(j),ne=Math.sin(j);I.x=D*ne,I.y=g*L,I.z=D*J,h.push(I.x,I.y,I.z),d.push(0,L,0),E.x=J*.5+.5,E.y=ne*.5*L+.5,p.push(E.x,E.y),m++}for(let G=0;G<n;G++){const V=C+G,j=z+G;A===!0?c.push(j,j+1,V):c.push(j+1,j,V),T+=3}u.addGroup(w,T,A===!0?1:2),w+=T}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new rv(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class A_ extends rv{constructor(t=1,i=1,r=32,n=1,s=!1,a=0,o=Math.PI*2){super(0,t,i,r,n,s,a,o),this.type="ConeGeometry",this.parameters={radius:t,height:i,radialSegments:r,heightSegments:n,openEnded:s,thetaStart:a,thetaLength:o}}static fromJSON(t){return new A_(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class Ud extends Fi{constructor(t=[],i=[],r=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:i,radius:r,detail:n};const s=[],a=[];o(n),u(r),c(),this.setAttribute("position",new Jt(s,3)),this.setAttribute("normal",new Jt(s.slice(),3)),this.setAttribute("uv",new Jt(a,2)),n===0?this.computeVertexNormals():this.normalizeNormals();function o(S){const _=new pe,A=new pe,C=new pe;for(let E=0;E<i.length;E+=3)p(i[E+0],_),p(i[E+1],A),p(i[E+2],C),l(_,A,C,S)}function l(S,_,A,C){const E=C+1,I=[];for(let T=0;T<=E;T++){I[T]=[];const D=S.clone().lerp(A,T/E),L=_.clone().lerp(A,T/E),z=E-T;for(let G=0;G<=z;G++)G===0&&T===E?I[T][G]=D:I[T][G]=D.clone().lerp(L,G/z)}for(let T=0;T<E;T++)for(let D=0;D<2*(E-T)-1;D++){const L=Math.floor(D/2);D%2===0?(d(I[T][L+1]),d(I[T+1][L]),d(I[T][L])):(d(I[T][L+1]),d(I[T+1][L+1]),d(I[T+1][L]))}}function u(S){const _=new pe;for(let A=0;A<s.length;A+=3)_.x=s[A+0],_.y=s[A+1],_.z=s[A+2],_.normalize().multiplyScalar(S),s[A+0]=_.x,s[A+1]=_.y,s[A+2]=_.z}function c(){const S=new pe;for(let _=0;_<s.length;_+=3){S.x=s[_+0],S.y=s[_+1],S.z=s[_+2];const A=g(S)/2/Math.PI+.5,C=w(S)/Math.PI+.5;a.push(A,1-C)}m(),h()}function h(){for(let S=0;S<a.length;S+=6){const _=a[S+0],A=a[S+2],C=a[S+4],E=Math.max(_,A,C),I=Math.min(_,A,C);E>.9&&I<.1&&(_<.2&&(a[S+0]+=1),A<.2&&(a[S+2]+=1),C<.2&&(a[S+4]+=1))}}function d(S){s.push(S.x,S.y,S.z)}function p(S,_){const A=S*3;_.x=t[A+0],_.y=t[A+1],_.z=t[A+2]}function m(){const S=new pe,_=new pe,A=new pe,C=new pe,E=new ft,I=new ft,T=new ft;for(let D=0,L=0;D<s.length;D+=9,L+=6){S.set(s[D+0],s[D+1],s[D+2]),_.set(s[D+3],s[D+4],s[D+5]),A.set(s[D+6],s[D+7],s[D+8]),E.set(a[L+0],a[L+1]),I.set(a[L+2],a[L+3]),T.set(a[L+4],a[L+5]),C.copy(S).add(_).add(A).divideScalar(3);const z=g(C);v(E,L+0,S,z),v(I,L+2,_,z),v(T,L+4,A,z)}}function v(S,_,A,C){C<0&&S.x===1&&(a[_]=S.x-1),A.x===0&&A.z===0&&(a[_]=C/2/Math.PI+.5)}function g(S){return Math.atan2(S.z,-S.x)}function w(S){return Math.atan2(-S.y,Math.sqrt(S.x*S.x+S.z*S.z))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Ud(t.vertices,t.indices,t.radius,t.details)}}class E_ extends Ud{constructor(t=1,i=0){const r=(1+Math.sqrt(5))/2,n=1/r,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,a,t,i),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new E_(t.radius,t.detail)}}const PM=new pe,DM=new pe,zP=new pe,RM=new Vl;class W9 extends Fi{constructor(t=null,i=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:i},t!==null){const n=Math.pow(10,4),s=Math.cos(Eg*i),a=t.getIndex(),o=t.getAttribute("position"),l=a?a.count:o.count,u=[0,0,0],c=["a","b","c"],h=new Array(3),d={},p=[];for(let m=0;m<l;m+=3){a?(u[0]=a.getX(m),u[1]=a.getX(m+1),u[2]=a.getX(m+2)):(u[0]=m,u[1]=m+1,u[2]=m+2);const{a:v,b:g,c:w}=RM;if(v.fromBufferAttribute(o,u[0]),g.fromBufferAttribute(o,u[1]),w.fromBufferAttribute(o,u[2]),RM.getNormal(zP),h[0]=`${Math.round(v.x*n)},${Math.round(v.y*n)},${Math.round(v.z*n)}`,h[1]=`${Math.round(g.x*n)},${Math.round(g.y*n)},${Math.round(g.z*n)}`,h[2]=`${Math.round(w.x*n)},${Math.round(w.y*n)},${Math.round(w.z*n)}`,!(h[0]===h[1]||h[1]===h[2]||h[2]===h[0]))for(let S=0;S<3;S++){const _=(S+1)%3,A=h[S],C=h[_],E=RM[c[S]],I=RM[c[_]],T=`${A}_${C}`,D=`${C}_${A}`;D in d&&d[D]?(zP.dot(d[D].normal)<=s&&(p.push(E.x,E.y,E.z),p.push(I.x,I.y,I.z)),d[D]=null):T in d||(d[T]={index0:u[S],index1:u[_],normal:zP.clone()})}}for(const m in d)if(d[m]){const{index0:v,index1:g}=d[m];PM.fromBufferAttribute(o,v),DM.fromBufferAttribute(o,g),p.push(PM.x,PM.y,PM.z),p.push(DM.x,DM.y,DM.z)}this.setAttribute("position",new Jt(p,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}class Tg extends Ob{constructor(t){super(t),this.uuid=hl(),this.type="Shape",this.holes=[]}getPointsHoles(t){const i=[];for(let r=0,n=this.holes.length;r<n;r++)i[r]=this.holes[r].getPoints(t);return i}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let i=0,r=t.holes.length;i<r;i++){const n=t.holes[i];this.holes.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let i=0,r=this.holes.length;i<r;i++){const n=this.holes[i];t.holes.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let i=0,r=t.holes.length;i<r;i++){const n=t.holes[i];this.holes.push(new Ob().fromJSON(n))}return this}}const Poe={triangulate:function(e,t,i=2){const r=t&&t.length,n=r?t[0]*i:e.length;let s=G9(e,0,n,i,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,u,c,h,d,p;if(r&&(s=Ooe(e,t,s,i)),e.length>80*i){o=u=e[0],l=c=e[1];for(let m=i;m<n;m+=i)h=e[m],d=e[m+1],h<o&&(o=h),d<l&&(l=d),h>u&&(u=h),d>c&&(c=d);p=Math.max(u-o,c-l),p=p!==0?32767/p:0}return zb(s,a,i,o,l,p,0),a}};function G9(e,t,i,r,n){let s,a;if(n===Goe(e,t,i,r)>0)for(s=t;s<i;s+=r)a=d4(s,e[s],e[s+1],a);else for(s=i-r;s>=t;s-=r)a=d4(s,e[s],e[s+1],a);return a&&BC(a,a.next)&&(Bb(a),a=a.next),a}function Ug(e,t){if(!e)return e;t||(t=e);let i=e,r;do if(r=!1,!i.steiner&&(BC(i,i.next)||ln(i.prev,i,i.next)===0)){if(Bb(i),i=t=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==t);return t}function zb(e,t,i,r,n,s,a){if(!e)return;!a&&s&&Foe(e,r,n,s);let o=e,l,u;for(;e.prev!==e.next;){if(l=e.prev,u=e.next,s?Roe(e,r,n,s):Doe(e)){t.push(l.i/i|0),t.push(e.i/i|0),t.push(u.i/i|0),Bb(e),e=u.next,o=u.next;continue}if(e=u,e===o){a?a===1?(e=Ioe(Ug(e),t,i),zb(e,t,i,r,n,s,2)):a===2&&Loe(e,t,i,r,n,s):zb(Ug(e),t,i,r,n,s,1);break}}}function Doe(e){const t=e.prev,i=e,r=e.next;if(ln(t,i,r)>=0)return!1;const n=t.x,s=i.x,a=r.x,o=t.y,l=i.y,u=r.y,c=n<s?n<a?n:a:s<a?s:a,h=o<l?o<u?o:u:l<u?l:u,d=n>s?n>a?n:a:s>a?s:a,p=o>l?o>u?o:u:l>u?l:u;let m=r.next;for(;m!==t;){if(m.x>=c&&m.x<=d&&m.y>=h&&m.y<=p&&My(n,o,s,l,a,u,m.x,m.y)&&ln(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function Roe(e,t,i,r){const n=e.prev,s=e,a=e.next;if(ln(n,s,a)>=0)return!1;const o=n.x,l=s.x,u=a.x,c=n.y,h=s.y,d=a.y,p=o<l?o<u?o:u:l<u?l:u,m=c<h?c<d?c:d:h<d?h:d,v=o>l?o>u?o:u:l>u?l:u,g=c>h?c>d?c:d:h>d?h:d,w=dI(p,m,t,i,r),S=dI(v,g,t,i,r);let _=e.prevZ,A=e.nextZ;for(;_&&_.z>=w&&A&&A.z<=S;){if(_.x>=p&&_.x<=v&&_.y>=m&&_.y<=g&&_!==n&&_!==a&&My(o,c,l,h,u,d,_.x,_.y)&&ln(_.prev,_,_.next)>=0||(_=_.prevZ,A.x>=p&&A.x<=v&&A.y>=m&&A.y<=g&&A!==n&&A!==a&&My(o,c,l,h,u,d,A.x,A.y)&&ln(A.prev,A,A.next)>=0))return!1;A=A.nextZ}for(;_&&_.z>=w;){if(_.x>=p&&_.x<=v&&_.y>=m&&_.y<=g&&_!==n&&_!==a&&My(o,c,l,h,u,d,_.x,_.y)&&ln(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;A&&A.z<=S;){if(A.x>=p&&A.x<=v&&A.y>=m&&A.y<=g&&A!==n&&A!==a&&My(o,c,l,h,u,d,A.x,A.y)&&ln(A.prev,A,A.next)>=0)return!1;A=A.nextZ}return!0}function Ioe(e,t,i){let r=e;do{const n=r.prev,s=r.next.next;!BC(n,s)&&q9(n,r,r.next,s)&&kb(n,s)&&kb(s,n)&&(t.push(n.i/i|0),t.push(r.i/i|0),t.push(s.i/i|0),Bb(r),Bb(r.next),r=e=s),r=r.next}while(r!==e);return Ug(r)}function Loe(e,t,i,r,n,s){let a=e;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&joe(a,o)){let l=X9(a,o);a=Ug(a,a.next),l=Ug(l,l.next),zb(a,t,i,r,n,s,0),zb(l,t,i,r,n,s,0);return}o=o.next}a=a.next}while(a!==e)}function Ooe(e,t,i,r){const n=[];let s,a,o,l,u;for(s=0,a=t.length;s<a;s++)o=t[s]*r,l=s<a-1?t[s+1]*r:e.length,u=G9(e,o,l,r,!1),u===u.next&&(u.steiner=!0),n.push(Voe(u));for(n.sort(zoe),s=0;s<n.length;s++)i=koe(n[s],i);return i}function zoe(e,t){return e.x-t.x}function koe(e,t){const i=Boe(e,t);if(!i)return t;const r=X9(i,e);return Ug(r,r.next),Ug(i,i.next)}function Boe(e,t){let i=t,r=-1/0,n;const s=e.x,a=e.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){const d=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(d<=s&&d>r&&(r=d,n=i.x<i.next.x?i:i.next,d===s))return n}i=i.next}while(i!==t);if(!n)return null;const o=n,l=n.x,u=n.y;let c=1/0,h;i=n;do s>=i.x&&i.x>=l&&s!==i.x&&My(a<u?s:r,a,l,u,a<u?r:s,a,i.x,i.y)&&(h=Math.abs(a-i.y)/(s-i.x),kb(i,e)&&(h<c||h===c&&(i.x>n.x||i.x===n.x&&Noe(n,i)))&&(n=i,c=h)),i=i.next;while(i!==o);return n}function Noe(e,t){return ln(e.prev,e,t.prev)<0&&ln(t.next,e,e.next)<0}function Foe(e,t,i,r){let n=e;do n.z===0&&(n.z=dI(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,Uoe(n)}function Uoe(e){let t,i,r,n,s,a,o,l,u=1;do{for(i=e,e=null,s=null,a=0;i;){for(a++,r=i,o=0,t=0;t<u&&(o++,r=r.nextZ,!!r);t++);for(l=u;o>0||l>0&&r;)o!==0&&(l===0||!r||i.z<=r.z)?(n=i,i=i.nextZ,o--):(n=r,r=r.nextZ,l--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;i=r}s.nextZ=null,u*=2}while(a>1);return e}function dI(e,t,i,r,n){return e=(e-i)*n|0,t=(t-r)*n|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function Voe(e){let t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function My(e,t,i,r,n,s,a,o){return(n-a)*(t-o)>=(e-a)*(s-o)&&(e-a)*(r-o)>=(i-a)*(t-o)&&(i-a)*(s-o)>=(n-a)*(r-o)}function joe(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!Hoe(e,t)&&(kb(e,t)&&kb(t,e)&&Woe(e,t)&&(ln(e.prev,e,t.prev)||ln(e,t.prev,t))||BC(e,t)&&ln(e.prev,e,e.next)>0&&ln(t.prev,t,t.next)>0)}function ln(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function BC(e,t){return e.x===t.x&&e.y===t.y}function q9(e,t,i,r){const n=LM(ln(e,t,i)),s=LM(ln(e,t,r)),a=LM(ln(i,r,e)),o=LM(ln(i,r,t));return!!(n!==s&&a!==o||n===0&&IM(e,i,t)||s===0&&IM(e,r,t)||a===0&&IM(i,e,r)||o===0&&IM(i,t,r))}function IM(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function LM(e){return e>0?1:e<0?-1:0}function Hoe(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&q9(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function kb(e,t){return ln(e.prev,e,e.next)<0?ln(e,t,e.next)>=0&&ln(e,e.prev,t)>=0:ln(e,t,e.prev)<0||ln(e,e.next,t)<0}function Woe(e,t){let i=e,r=!1;const n=(e.x+t.x)/2,s=(e.y+t.y)/2;do i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==e);return r}function X9(e,t){const i=new fI(e.i,e.x,e.y),r=new fI(t.i,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function d4(e,t,i,r){const n=new fI(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function Bb(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function fI(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Goe(e,t,i,r){let n=0;for(let s=t,a=i-r;s<i;s+=r)n+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return n}class Hc{static area(t){const i=t.length;let r=0;for(let n=i-1,s=0;s<i;n=s++)r+=t[n].x*t[s].y-t[s].x*t[n].y;return r*.5}static isClockWise(t){return Hc.area(t)<0}static triangulateShape(t,i){const r=[],n=[],s=[];f4(t),p4(r,t);let a=t.length;i.forEach(f4);for(let l=0;l<i.length;l++)n.push(a),a+=i[l].length,p4(r,i[l]);const o=Poe.triangulate(r,n);for(let l=0;l<o.length;l+=3)s.push(o.slice(l,l+3));return s}}function f4(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function p4(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}class C_ extends Fi{constructor(t=new Tg([new ft(.5,.5),new ft(-.5,.5),new ft(-.5,-.5),new ft(.5,-.5)]),i={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:i},t=Array.isArray(t)?t:[t];const r=this,n=[],s=[];for(let o=0,l=t.length;o<l;o++){const u=t[o];a(u)}this.setAttribute("position",new Jt(n,3)),this.setAttribute("uv",new Jt(s,2)),this.computeVertexNormals();function a(o){const l=[],u=i.curveSegments!==void 0?i.curveSegments:12,c=i.steps!==void 0?i.steps:1,h=i.depth!==void 0?i.depth:1;let d=i.bevelEnabled!==void 0?i.bevelEnabled:!0,p=i.bevelThickness!==void 0?i.bevelThickness:.2,m=i.bevelSize!==void 0?i.bevelSize:p-.1,v=i.bevelOffset!==void 0?i.bevelOffset:0,g=i.bevelSegments!==void 0?i.bevelSegments:3;const w=i.extrudePath,S=i.UVGenerator!==void 0?i.UVGenerator:qoe;let _,A=!1,C,E,I,T;w&&(_=w.getSpacedPoints(c),A=!0,d=!1,C=w.computeFrenetFrames(c,!1),E=new pe,I=new pe,T=new pe),d||(g=0,p=0,m=0,v=0);const D=o.extractPoints(u);let L=D.shape;const z=D.holes;if(!Hc.isClockWise(L)){L=L.reverse();for(let Me=0,De=z.length;Me<De;Me++){const Ve=z[Me];Hc.isClockWise(Ve)&&(z[Me]=Ve.reverse())}}const V=Hc.triangulateShape(L,z),j=L;for(let Me=0,De=z.length;Me<De;Me++){const Ve=z[Me];L=L.concat(Ve)}function J(Me,De,Ve){return De||console.error("THREE.ExtrudeGeometry: vec does not exist"),Me.clone().addScaledVector(De,Ve)}const ne=L.length,K=V.length;function B(Me,De,Ve){let Ge,Qe,ot;const $e=Me.x-De.x,Ke=Me.y-De.y,bt=Ve.x-Me.x,xt=Ve.y-Me.y,q=$e*$e+Ke*Ke,N=$e*xt-Ke*bt;if(Math.abs(N)>Number.EPSILON){const de=Math.sqrt(q),ze=Math.sqrt(bt*bt+xt*xt),$=De.x-Ke/de,Ue=De.y+$e/de,rt=Ve.x-xt/ze,Ye=Ve.y+bt/ze,Ee=((rt-$)*xt-(Ye-Ue)*bt)/($e*xt-Ke*bt);Ge=$+$e*Ee-Me.x,Qe=Ue+Ke*Ee-Me.y;const lt=Ge*Ge+Qe*Qe;if(lt<=2)return new ft(Ge,Qe);ot=Math.sqrt(lt/2)}else{let de=!1;$e>Number.EPSILON?bt>Number.EPSILON&&(de=!0):$e<-Number.EPSILON?bt<-Number.EPSILON&&(de=!0):Math.sign(Ke)===Math.sign(xt)&&(de=!0),de?(Ge=-Ke,Qe=$e,ot=Math.sqrt(q)):(Ge=$e,Qe=Ke,ot=Math.sqrt(q/2))}return new ft(Ge/ot,Qe/ot)}const Z=[];for(let Me=0,De=j.length,Ve=De-1,Ge=Me+1;Me<De;Me++,Ve++,Ge++)Ve===De&&(Ve=0),Ge===De&&(Ge=0),Z[Me]=B(j[Me],j[Ve],j[Ge]);const F=[];let X,Y=Z.concat();for(let Me=0,De=z.length;Me<De;Me++){const Ve=z[Me];X=[];for(let Ge=0,Qe=Ve.length,ot=Qe-1,$e=Ge+1;Ge<Qe;Ge++,ot++,$e++)ot===Qe&&(ot=0),$e===Qe&&($e=0),X[Ge]=B(Ve[Ge],Ve[ot],Ve[$e]);F.push(X),Y=Y.concat(X)}for(let Me=0;Me<g;Me++){const De=Me/g,Ve=p*Math.cos(De*Math.PI/2),Ge=m*Math.sin(De*Math.PI/2)+v;for(let Qe=0,ot=j.length;Qe<ot;Qe++){const $e=J(j[Qe],Z[Qe],Ge);me($e.x,$e.y,-Ve)}for(let Qe=0,ot=z.length;Qe<ot;Qe++){const $e=z[Qe];X=F[Qe];for(let Ke=0,bt=$e.length;Ke<bt;Ke++){const xt=J($e[Ke],X[Ke],Ge);me(xt.x,xt.y,-Ve)}}}const le=m+v;for(let Me=0;Me<ne;Me++){const De=d?J(L[Me],Y[Me],le):L[Me];A?(I.copy(C.normals[0]).multiplyScalar(De.x),E.copy(C.binormals[0]).multiplyScalar(De.y),T.copy(_[0]).add(I).add(E),me(T.x,T.y,T.z)):me(De.x,De.y,0)}for(let Me=1;Me<=c;Me++)for(let De=0;De<ne;De++){const Ve=d?J(L[De],Y[De],le):L[De];A?(I.copy(C.normals[Me]).multiplyScalar(Ve.x),E.copy(C.binormals[Me]).multiplyScalar(Ve.y),T.copy(_[Me]).add(I).add(E),me(T.x,T.y,T.z)):me(Ve.x,Ve.y,h/c*Me)}for(let Me=g-1;Me>=0;Me--){const De=Me/g,Ve=p*Math.cos(De*Math.PI/2),Ge=m*Math.sin(De*Math.PI/2)+v;for(let Qe=0,ot=j.length;Qe<ot;Qe++){const $e=J(j[Qe],Z[Qe],Ge);me($e.x,$e.y,h+Ve)}for(let Qe=0,ot=z.length;Qe<ot;Qe++){const $e=z[Qe];X=F[Qe];for(let Ke=0,bt=$e.length;Ke<bt;Ke++){const xt=J($e[Ke],X[Ke],Ge);A?me(xt.x,xt.y+_[c-1].y,_[c-1].x+Ve):me(xt.x,xt.y,h+Ve)}}}oe(),re();function oe(){const Me=n.length/3;if(d){let De=0,Ve=ne*De;for(let Ge=0;Ge<K;Ge++){const Qe=V[Ge];he(Qe[2]+Ve,Qe[1]+Ve,Qe[0]+Ve)}De=c+g*2,Ve=ne*De;for(let Ge=0;Ge<K;Ge++){const Qe=V[Ge];he(Qe[0]+Ve,Qe[1]+Ve,Qe[2]+Ve)}}else{for(let De=0;De<K;De++){const Ve=V[De];he(Ve[2],Ve[1],Ve[0])}for(let De=0;De<K;De++){const Ve=V[De];he(Ve[0]+ne*c,Ve[1]+ne*c,Ve[2]+ne*c)}}r.addGroup(Me,n.length/3-Me,0)}function re(){const Me=n.length/3;let De=0;ue(j,De),De+=j.length;for(let Ve=0,Ge=z.length;Ve<Ge;Ve++){const Qe=z[Ve];ue(Qe,De),De+=Qe.length}r.addGroup(Me,n.length/3-Me,1)}function ue(Me,De){let Ve=Me.length;for(;--Ve>=0;){const Ge=Ve;let Qe=Ve-1;Qe<0&&(Qe=Me.length-1);for(let ot=0,$e=c+g*2;ot<$e;ot++){const Ke=ne*ot,bt=ne*(ot+1),xt=De+Ge+Ke,q=De+Qe+Ke,N=De+Qe+bt,de=De+Ge+bt;Ce(xt,q,N,de)}}}function me(Me,De,Ve){l.push(Me),l.push(De),l.push(Ve)}function he(Me,De,Ve){Ae(Me),Ae(De),Ae(Ve);const Ge=n.length/3,Qe=S.generateTopUV(r,n,Ge-3,Ge-2,Ge-1);Ie(Qe[0]),Ie(Qe[1]),Ie(Qe[2])}function Ce(Me,De,Ve,Ge){Ae(Me),Ae(De),Ae(Ge),Ae(De),Ae(Ve),Ae(Ge);const Qe=n.length/3,ot=S.generateSideWallUV(r,n,Qe-6,Qe-3,Qe-2,Qe-1);Ie(ot[0]),Ie(ot[1]),Ie(ot[3]),Ie(ot[1]),Ie(ot[2]),Ie(ot[3])}function Ae(Me){n.push(l[Me*3+0]),n.push(l[Me*3+1]),n.push(l[Me*3+2])}function Ie(Me){s.push(Me.x),s.push(Me.y)}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),i=this.parameters.shapes,r=this.parameters.options;return Xoe(i,r,t)}static fromJSON(t,i){const r=[];for(let s=0,a=t.shapes.length;s<a;s++){const o=i[t.shapes[s]];r.push(o)}const n=t.options.extrudePath;return n!==void 0&&(t.options.extrudePath=new Cz[n.type]().fromJSON(n)),new C_(r,t.options)}}const qoe={generateTopUV:function(e,t,i,r,n){const s=t[i*3],a=t[i*3+1],o=t[r*3],l=t[r*3+1],u=t[n*3],c=t[n*3+1];return[new ft(s,a),new ft(o,l),new ft(u,c)]},generateSideWallUV:function(e,t,i,r,n,s){const a=t[i*3],o=t[i*3+1],l=t[i*3+2],u=t[r*3],c=t[r*3+1],h=t[r*3+2],d=t[n*3],p=t[n*3+1],m=t[n*3+2],v=t[s*3],g=t[s*3+1],w=t[s*3+2];return Math.abs(o-c)<Math.abs(a-u)?[new ft(a,1-l),new ft(u,1-h),new ft(d,1-m),new ft(v,1-w)]:[new ft(o,1-l),new ft(c,1-h),new ft(p,1-m),new ft(g,1-w)]}};function Xoe(e,t,i){if(i.shapes=[],Array.isArray(e))for(let r=0,n=e.length;r<n;r++){const s=e[r];i.shapes.push(s.uuid)}else i.shapes.push(e.uuid);return i.options=Object.assign({},t),t.extrudePath!==void 0&&(i.options.extrudePath=t.extrudePath.toJSON()),i}class T_ extends Ud{constructor(t=1,i=0){const r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(n,s,t,i),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new T_(t.radius,t.detail)}}class Rx extends Ud{constructor(t=1,i=0){const r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],n=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(r,n,t,i),this.type="OctahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new Rx(t.radius,t.detail)}}class P_ extends Fi{constructor(t=.5,i=1,r=32,n=1,s=0,a=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:i,thetaSegments:r,phiSegments:n,thetaStart:s,thetaLength:a},r=Math.max(3,r),n=Math.max(1,n);const o=[],l=[],u=[],c=[];let h=t;const d=(i-t)/n,p=new pe,m=new ft;for(let v=0;v<=n;v++){for(let g=0;g<=r;g++){const w=s+g/r*a;p.x=h*Math.cos(w),p.y=h*Math.sin(w),l.push(p.x,p.y,p.z),u.push(0,0,1),m.x=(p.x/i+1)/2,m.y=(p.y/i+1)/2,c.push(m.x,m.y)}h+=d}for(let v=0;v<n;v++){const g=v*(r+1);for(let w=0;w<r;w++){const S=w+g,_=S,A=S+r+1,C=S+r+2,E=S+1;o.push(_,A,E),o.push(A,C,E)}}this.setIndex(o),this.setAttribute("position",new Jt(l,3)),this.setAttribute("normal",new Jt(u,3)),this.setAttribute("uv",new Jt(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new P_(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class D_ extends Fi{constructor(t=new Tg([new ft(0,.5),new ft(-.5,-.5),new ft(.5,-.5)]),i=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:i};const r=[],n=[],s=[],a=[];let o=0,l=0;if(Array.isArray(t)===!1)u(t);else for(let c=0;c<t.length;c++)u(t[c]),this.addGroup(o,l,c),o+=l,l=0;this.setIndex(r),this.setAttribute("position",new Jt(n,3)),this.setAttribute("normal",new Jt(s,3)),this.setAttribute("uv",new Jt(a,2));function u(c){const h=n.length/3,d=c.extractPoints(i);let p=d.shape;const m=d.holes;Hc.isClockWise(p)===!1&&(p=p.reverse());for(let g=0,w=m.length;g<w;g++){const S=m[g];Hc.isClockWise(S)===!0&&(m[g]=S.reverse())}const v=Hc.triangulateShape(p,m);for(let g=0,w=m.length;g<w;g++){const S=m[g];p=p.concat(S)}for(let g=0,w=p.length;g<w;g++){const S=p[g];n.push(S.x,S.y,0),s.push(0,0,1),a.push(S.x,S.y)}for(let g=0,w=v.length;g<w;g++){const S=v[g],_=S[0]+h,A=S[1]+h,C=S[2]+h;r.push(_,A,C),l+=3}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),i=this.parameters.shapes;return Yoe(i,t)}static fromJSON(t,i){const r=[];for(let n=0,s=t.shapes.length;n<s;n++){const a=i[t.shapes[n]];r.push(a)}return new D_(r,t.curveSegments)}}function Yoe(e,t){if(t.shapes=[],Array.isArray(e))for(let i=0,r=e.length;i<r;i++){const n=e[i];t.shapes.push(n.uuid)}else t.shapes.push(e.uuid);return t}class Ix extends Fi{constructor(t=1,i=32,r=16,n=0,s=Math.PI*2,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:i,heightSegments:r,phiStart:n,phiLength:s,thetaStart:a,thetaLength:o},i=Math.max(3,Math.floor(i)),r=Math.max(2,Math.floor(r));const l=Math.min(a+o,Math.PI);let u=0;const c=[],h=new pe,d=new pe,p=[],m=[],v=[],g=[];for(let w=0;w<=r;w++){const S=[],_=w/r;let A=0;w==0&&a==0?A=.5/i:w==r&&l==Math.PI&&(A=-.5/i);for(let C=0;C<=i;C++){const E=C/i;h.x=-t*Math.cos(n+E*s)*Math.sin(a+_*o),h.y=t*Math.cos(a+_*o),h.z=t*Math.sin(n+E*s)*Math.sin(a+_*o),m.push(h.x,h.y,h.z),d.copy(h).normalize(),v.push(d.x,d.y,d.z),g.push(E+A,1-_),S.push(u++)}c.push(S)}for(let w=0;w<r;w++)for(let S=0;S<i;S++){const _=c[w][S+1],A=c[w][S],C=c[w+1][S],E=c[w+1][S+1];(w!==0||a>0)&&p.push(_,A,E),(w!==r-1||l<Math.PI)&&p.push(A,C,E)}this.setIndex(p),this.setAttribute("position",new Jt(m,3)),this.setAttribute("normal",new Jt(v,3)),this.setAttribute("uv",new Jt(g,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Ix(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class R_ extends Ud{constructor(t=1,i=0){const r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],n=[2,1,0,0,3,2,1,3,0,2,3,1];super(r,n,t,i),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new R_(t.radius,t.detail)}}class I_ extends Fi{constructor(t=1,i=.4,r=12,n=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:i,radialSegments:r,tubularSegments:n,arc:s},r=Math.floor(r),n=Math.floor(n);const a=[],o=[],l=[],u=[],c=new pe,h=new pe,d=new pe;for(let p=0;p<=r;p++)for(let m=0;m<=n;m++){const v=m/n*s,g=p/r*Math.PI*2;h.x=(t+i*Math.cos(g))*Math.cos(v),h.y=(t+i*Math.cos(g))*Math.sin(v),h.z=i*Math.sin(g),o.push(h.x,h.y,h.z),c.x=t*Math.cos(v),c.y=t*Math.sin(v),d.subVectors(h,c).normalize(),l.push(d.x,d.y,d.z),u.push(m/n),u.push(p/r)}for(let p=1;p<=r;p++)for(let m=1;m<=n;m++){const v=(n+1)*p+m-1,g=(n+1)*(p-1)+m-1,w=(n+1)*(p-1)+m,S=(n+1)*p+m;a.push(v,g,S),a.push(g,w,S)}this.setIndex(a),this.setAttribute("position",new Jt(o,3)),this.setAttribute("normal",new Jt(l,3)),this.setAttribute("uv",new Jt(u,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new I_(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class L_ extends Fi{constructor(t=1,i=.4,r=64,n=8,s=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:i,tubularSegments:r,radialSegments:n,p:s,q:a},r=Math.floor(r),n=Math.floor(n);const o=[],l=[],u=[],c=[],h=new pe,d=new pe,p=new pe,m=new pe,v=new pe,g=new pe,w=new pe;for(let _=0;_<=r;++_){const A=_/r*s*Math.PI*2;S(A,s,a,t,p),S(A+.01,s,a,t,m),g.subVectors(m,p),w.addVectors(m,p),v.crossVectors(g,w),w.crossVectors(v,g),v.normalize(),w.normalize();for(let C=0;C<=n;++C){const E=C/n*Math.PI*2,I=-i*Math.cos(E),T=i*Math.sin(E);h.x=p.x+(I*w.x+T*v.x),h.y=p.y+(I*w.y+T*v.y),h.z=p.z+(I*w.z+T*v.z),l.push(h.x,h.y,h.z),d.subVectors(h,p).normalize(),u.push(d.x,d.y,d.z),c.push(_/r),c.push(C/n)}}for(let _=1;_<=r;_++)for(let A=1;A<=n;A++){const C=(n+1)*(_-1)+(A-1),E=(n+1)*_+(A-1),I=(n+1)*_+A,T=(n+1)*(_-1)+A;o.push(C,E,T),o.push(E,I,T)}this.setIndex(o),this.setAttribute("position",new Jt(l,3)),this.setAttribute("normal",new Jt(u,3)),this.setAttribute("uv",new Jt(c,2));function S(_,A,C,E,I){const T=Math.cos(_),D=Math.sin(_),L=C/A*_,z=Math.cos(L);I.x=E*(2+z)*.5*T,I.y=E*(2+z)*D*.5,I.z=E*Math.sin(L)*.5}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new L_(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class O_ extends Fi{constructor(t=new Az(new pe(-1,-1,0),new pe(-1,1,0),new pe(1,1,0)),i=64,r=1,n=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:i,radius:r,radialSegments:n,closed:s};const a=t.computeFrenetFrames(i,s);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new pe,l=new pe,u=new ft;let c=new pe;const h=[],d=[],p=[],m=[];v(),this.setIndex(m),this.setAttribute("position",new Jt(h,3)),this.setAttribute("normal",new Jt(d,3)),this.setAttribute("uv",new Jt(p,2));function v(){for(let _=0;_<i;_++)g(_);g(s===!1?i:0),S(),w()}function g(_){c=t.getPointAt(_/i,c);const A=a.normals[_],C=a.binormals[_];for(let E=0;E<=n;E++){const I=E/n*Math.PI*2,T=Math.sin(I),D=-Math.cos(I);l.x=D*A.x+T*C.x,l.y=D*A.y+T*C.y,l.z=D*A.z+T*C.z,l.normalize(),d.push(l.x,l.y,l.z),o.x=c.x+r*l.x,o.y=c.y+r*l.y,o.z=c.z+r*l.z,h.push(o.x,o.y,o.z)}}function w(){for(let _=1;_<=i;_++)for(let A=1;A<=n;A++){const C=(n+1)*(_-1)+(A-1),E=(n+1)*_+(A-1),I=(n+1)*_+A,T=(n+1)*(_-1)+A;m.push(C,E,T),m.push(E,I,T)}}function S(){for(let _=0;_<=i;_++)for(let A=0;A<=n;A++)u.x=_/i,u.y=A/n,p.push(u.x,u.y)}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new O_(new Cz[t.path.type]().fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class Y9 extends Fi{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},t!==null){const i=[],r=new Set,n=new pe,s=new pe;if(t.index!==null){const a=t.attributes.position,o=t.index;let l=t.groups;l.length===0&&(l=[{start:0,count:o.count,materialIndex:0}]);for(let u=0,c=l.length;u<c;++u){const h=l[u],d=h.start,p=h.count;for(let m=d,v=d+p;m<v;m+=3)for(let g=0;g<3;g++){const w=o.getX(m+g),S=o.getX(m+(g+1)%3);n.fromBufferAttribute(a,w),s.fromBufferAttribute(a,S),m4(n,s,r)===!0&&(i.push(n.x,n.y,n.z),i.push(s.x,s.y,s.z))}}}else{const a=t.attributes.position;for(let o=0,l=a.count/3;o<l;o++)for(let u=0;u<3;u++){const c=3*o+u,h=3*o+(u+1)%3;n.fromBufferAttribute(a,c),s.fromBufferAttribute(a,h),m4(n,s,r)===!0&&(i.push(n.x,n.y,n.z),i.push(s.x,s.y,s.z))}}this.setAttribute("position",new Jt(i,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}function m4(e,t,i){const r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,n=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return i.has(r)===!0||i.has(n)===!0?!1:(i.add(r),i.add(n),!0)}var g4=Object.freeze({__proto__:null,BoxGeometry:Vp,CapsuleGeometry:S_,CircleGeometry:M_,ConeGeometry:A_,CylinderGeometry:rv,DodecahedronGeometry:E_,EdgesGeometry:W9,ExtrudeGeometry:C_,IcosahedronGeometry:T_,LatheGeometry:Dx,OctahedronGeometry:Rx,PlaneGeometry:Tx,PolyhedronGeometry:Ud,RingGeometry:P_,ShapeGeometry:D_,SphereGeometry:Ix,TetrahedronGeometry:R_,TorusGeometry:I_,TorusKnotGeometry:L_,TubeGeometry:O_,WireframeGeometry:Y9});class Q9 extends wa{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new qt(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class K9 extends Kc{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Tz extends wa{constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new qt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new qt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fp,this.normalScale=new ft(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Z9 extends Tz{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ft(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return zn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(i){this.ior=(1+.4*i)/(1-.4*i)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new qt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new qt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new qt(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class J9 extends wa{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new qt(16777215),this.specular=new qt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new qt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fp,this.normalScale=new ft(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=w_,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class $9 extends wa{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new qt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new qt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fp,this.normalScale=new ft(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class e7 extends wa{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fp,this.normalScale=new ft(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class t7 extends wa{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new qt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new qt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fp,this.normalScale=new ft(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=w_,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class i7 extends wa{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new qt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fp,this.normalScale=new ft(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class r7 extends ho{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}function zl(e,t,i){return Pz(e)?new e.constructor(e.subarray(t,i!==void 0?i:e.length)):e.slice(t,i)}function fg(e,t,i){return!e||!i&&e.constructor===t?e:typeof t.BYTES_PER_ELEMENT=="number"?new t(e):Array.prototype.slice.call(e)}function Pz(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function n7(e){function t(n,s){return e[n]-e[s]}const i=e.length,r=new Array(i);for(let n=0;n!==i;++n)r[n]=n;return r.sort(t),r}function pI(e,t,i){const r=e.length,n=new e.constructor(r);for(let s=0,a=0;a!==r;++s){const o=i[s]*t;for(let l=0;l!==t;++l)n[a++]=e[o+l]}return n}function Dz(e,t,i,r){let n=1,s=e[0];for(;s!==void 0&&s[r]===void 0;)s=e[n++];if(s===void 0)return;let a=s[r];if(a!==void 0)if(Array.isArray(a))do a=s[r],a!==void 0&&(t.push(s.time),i.push.apply(i,a)),s=e[n++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[r],a!==void 0&&(t.push(s.time),a.toArray(i,i.length)),s=e[n++];while(s!==void 0);else do a=s[r],a!==void 0&&(t.push(s.time),i.push(a)),s=e[n++];while(s!==void 0)}function Qoe(e,t,i,r,n=30){const s=e.clone();s.name=t;const a=[];for(let l=0;l<s.tracks.length;++l){const u=s.tracks[l],c=u.getValueSize(),h=[],d=[];for(let p=0;p<u.times.length;++p){const m=u.times[p]*n;if(!(m<i||m>=r)){h.push(u.times[p]);for(let v=0;v<c;++v)d.push(u.values[p*c+v])}}h.length!==0&&(u.times=fg(h,u.times.constructor),u.values=fg(d,u.values.constructor),a.push(u))}s.tracks=a;let o=1/0;for(let l=0;l<s.tracks.length;++l)o>s.tracks[l].times[0]&&(o=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*o);return s.resetDuration(),s}function Koe(e,t=0,i=e,r=30){r<=0&&(r=30);const n=i.tracks.length,s=t/r;for(let a=0;a<n;++a){const o=i.tracks[a],l=o.ValueTypeName;if(l==="bool"||l==="string")continue;const u=e.tracks.find(function(w){return w.name===o.name&&w.ValueTypeName===l});if(u===void 0)continue;let c=0;const h=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=h/3);let d=0;const p=u.getValueSize();u.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(d=p/3);const m=o.times.length-1;let v;if(s<=o.times[0]){const w=c,S=h-c;v=zl(o.values,w,S)}else if(s>=o.times[m]){const w=m*h+c,S=w+h-c;v=zl(o.values,w,S)}else{const w=o.createInterpolant(),S=c,_=h-c;w.evaluate(s),v=zl(w.resultBuffer,S,_)}l==="quaternion"&&new Fa().fromArray(v).normalize().conjugate().toArray(v);const g=u.times.length;for(let w=0;w<g;++w){const S=w*p+d;if(l==="quaternion")Fa.multiplyQuaternionsFlat(u.values,S,v,0,u.values,S);else{const _=p-d*2;for(let A=0;A<_;++A)u.values[S+A]-=v[A]}}}return e.blendMode=az,e}const Zoe={arraySlice:zl,convertArray:fg,isTypedArray:Pz,getKeyframeOrder:n7,sortedArray:pI,flattenJSON:Dz,subclip:Qoe,makeClipAdditive:Koe};class z_{constructor(t,i,r,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=n!==void 0?n:new i.constructor(r),this.sampleValues=i,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(t){const i=this.parameterPositions;let r=this._cachedIndex,n=i[r],s=i[r-1];e:{t:{let a;i:{r:if(!(t<n)){for(let o=r+2;;){if(n===void 0){if(t<s)break r;return r=i.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===o)break;if(s=n,n=i[++r],t<n)break t}a=i.length;break i}if(!(t>=s)){const o=i[1];t<o&&(r=2,s=o);for(let l=r-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===l)break;if(n=s,s=i[--r-1],t>=s)break t}a=r,r=0;break i}break e}for(;r<a;){const o=r+a>>>1;t<i[o]?a=o:r=o+1}if(n=i[r],s=i[r-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===void 0)return r=i.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,s,n)}return this.interpolate_(r,s,t,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const i=this.resultBuffer,r=this.sampleValues,n=this.valueSize,s=t*n;for(let a=0;a!==n;++a)i[a]=r[s+a];return i}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class s7 extends z_{constructor(t,i,r,n){super(t,i,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:cg,endingEnd:cg}}intervalChanged_(t,i,r){const n=this.parameterPositions;let s=t-2,a=t+1,o=n[s],l=n[a];if(o===void 0)switch(this.getSettings_().endingStart){case hg:s=t,o=2*i-r;break;case Db:s=n.length-2,o=i+n[s]-n[s+1];break;default:s=t,o=r}if(l===void 0)switch(this.getSettings_().endingEnd){case hg:a=t,l=2*r-i;break;case Db:a=1,l=r+n[1]-n[0];break;default:a=t-1,l=i}const u=(r-i)*.5,c=this.valueSize;this._weightPrev=u/(i-o),this._weightNext=u/(l-r),this._offsetPrev=s*c,this._offsetNext=a*c}interpolate_(t,i,r,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=t*o,u=l-o,c=this._offsetPrev,h=this._offsetNext,d=this._weightPrev,p=this._weightNext,m=(r-i)/(n-i),v=m*m,g=v*m,w=-d*g+2*d*v-d*m,S=(1+d)*g+(-1.5-2*d)*v+(-.5+d)*m+1,_=(-1-p)*g+(1.5+p)*v+.5*m,A=p*g-p*v;for(let C=0;C!==o;++C)s[C]=w*a[c+C]+S*a[u+C]+_*a[l+C]+A*a[h+C];return s}}class Rz extends z_{constructor(t,i,r,n){super(t,i,r,n)}interpolate_(t,i,r,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=t*o,u=l-o,c=(r-i)/(n-i),h=1-c;for(let d=0;d!==o;++d)s[d]=a[u+d]*h+a[l+d]*c;return s}}class a7 extends z_{constructor(t,i,r,n){super(t,i,r,n)}interpolate_(t){return this.copySampleValue_(t-1)}}class qu{constructor(t,i,r,n){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(i===void 0||i.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=fg(i,this.TimeBufferType),this.values=fg(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(t){const i=t.constructor;let r;if(i.toJSON!==this.toJSON)r=i.toJSON(t);else{r={name:t.name,times:fg(t.times,Array),values:fg(t.values,Array)};const n=t.getInterpolation();n!==t.DefaultInterpolation&&(r.interpolation=n)}return r.type=t.ValueTypeName,r}InterpolantFactoryMethodDiscrete(t){return new a7(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Rz(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new s7(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let i;switch(t){case Tb:i=this.InterpolantFactoryMethodDiscrete;break;case Pb:i=this.InterpolantFactoryMethodLinear;break;case CE:i=this.InterpolantFactoryMethodSmooth;break}if(i===void 0){const r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(r);return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=i,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Tb;case this.InterpolantFactoryMethodLinear:return Pb;case this.InterpolantFactoryMethodSmooth:return CE}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){const i=this.times;for(let r=0,n=i.length;r!==n;++r)i[r]+=t}return this}scale(t){if(t!==1){const i=this.times;for(let r=0,n=i.length;r!==n;++r)i[r]*=t}return this}trim(t,i){const r=this.times,n=r.length;let s=0,a=n-1;for(;s!==n&&r[s]<t;)++s;for(;a!==-1&&r[a]>i;)--a;if(++a,s!==0||a!==n){s>=a&&(a=Math.max(a,1),s=a-1);const o=this.getValueSize();this.times=zl(r,s,a),this.values=zl(this.values,s*o,a*o)}return this}validate(){let t=!0;const i=this.getValueSize();i-Math.floor(i)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const r=this.times,n=this.values,s=r.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let a=null;for(let o=0;o!==s;o++){const l=r[o];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,l),t=!1;break}if(a!==null&&a>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,l,a),t=!1;break}a=l}if(n!==void 0&&Pz(n))for(let o=0,l=n.length;o!==l;++o){const u=n[o];if(isNaN(u)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,u),t=!1;break}}return t}optimize(){const t=zl(this.times),i=zl(this.values),r=this.getValueSize(),n=this.getInterpolation()===CE,s=t.length-1;let a=1;for(let o=1;o<s;++o){let l=!1;const u=t[o],c=t[o+1];if(u!==c&&(o!==1||u!==t[0]))if(n)l=!0;else{const h=o*r,d=h-r,p=h+r;for(let m=0;m!==r;++m){const v=i[h+m];if(v!==i[d+m]||v!==i[p+m]){l=!0;break}}}if(l){if(o!==a){t[a]=t[o];const h=o*r,d=a*r;for(let p=0;p!==r;++p)i[d+p]=i[h+p]}++a}}if(s>0){t[a]=t[s];for(let o=s*r,l=a*r,u=0;u!==r;++u)i[l+u]=i[o+u];++a}return a!==t.length?(this.times=zl(t,0,a),this.values=zl(i,0,a*r)):(this.times=t,this.values=i),this}clone(){const t=zl(this.times,0),i=zl(this.values,0),r=this.constructor,n=new r(this.name,t,i);return n.createInterpolant=this.createInterpolant,n}}qu.prototype.TimeBufferType=Float32Array;qu.prototype.ValueBufferType=Float32Array;qu.prototype.DefaultInterpolation=Pb;class nv extends qu{}nv.prototype.ValueTypeName="bool";nv.prototype.ValueBufferType=Array;nv.prototype.DefaultInterpolation=Tb;nv.prototype.InterpolantFactoryMethodLinear=void 0;nv.prototype.InterpolantFactoryMethodSmooth=void 0;class Iz extends qu{}Iz.prototype.ValueTypeName="color";class Nb extends qu{}Nb.prototype.ValueTypeName="number";class o7 extends z_{constructor(t,i,r,n){super(t,i,r,n)}interpolate_(t,i,r,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=(r-i)/(n-i);let u=t*o;for(let c=u+o;u!==c;u+=4)Fa.slerpFlat(s,0,a,u-o,a,u,l);return s}}class Lx extends qu{InterpolantFactoryMethodLinear(t){return new o7(this.times,this.values,this.getValueSize(),t)}}Lx.prototype.ValueTypeName="quaternion";Lx.prototype.DefaultInterpolation=Pb;Lx.prototype.InterpolantFactoryMethodSmooth=void 0;class sv extends qu{}sv.prototype.ValueTypeName="string";sv.prototype.ValueBufferType=Array;sv.prototype.DefaultInterpolation=Tb;sv.prototype.InterpolantFactoryMethodLinear=void 0;sv.prototype.InterpolantFactoryMethodSmooth=void 0;class Fb extends qu{}Fb.prototype.ValueTypeName="vector";class Ub{constructor(t,i=-1,r,n=EC){this.name=t,this.tracks=r,this.duration=i,this.blendMode=n,this.uuid=hl(),this.duration<0&&this.resetDuration()}static parse(t){const i=[],r=t.tracks,n=1/(t.fps||1);for(let a=0,o=r.length;a!==o;++a)i.push($oe(r[a]).scale(n));const s=new this(t.name,t.duration,i,t.blendMode);return s.uuid=t.uuid,s}static toJSON(t){const i=[],r=t.tracks,n={name:t.name,duration:t.duration,tracks:i,uuid:t.uuid,blendMode:t.blendMode};for(let s=0,a=r.length;s!==a;++s)i.push(qu.toJSON(r[s]));return n}static CreateFromMorphTargetSequence(t,i,r,n){const s=i.length,a=[];for(let o=0;o<s;o++){let l=[],u=[];l.push((o+s-1)%s,o,(o+1)%s),u.push(0,1,0);const c=n7(l);l=pI(l,1,c),u=pI(u,1,c),!n&&l[0]===0&&(l.push(s),u.push(u[0])),a.push(new Nb(".morphTargetInfluences["+i[o].name+"]",l,u).scale(1/r))}return new this(t,-1,a)}static findByName(t,i){let r=t;if(!Array.isArray(t)){const n=t;r=n.geometry&&n.geometry.animations||n.animations}for(let n=0;n<r.length;n++)if(r[n].name===i)return r[n];return null}static CreateClipsFromMorphTargetSequences(t,i,r){const n={},s=/^([\w-]*?)([\d]+)$/;for(let o=0,l=t.length;o<l;o++){const u=t[o],c=u.name.match(s);if(c&&c.length>1){const h=c[1];let d=n[h];d||(n[h]=d=[]),d.push(u)}}const a=[];for(const o in n)a.push(this.CreateFromMorphTargetSequence(o,n[o],i,r));return a}static parseAnimation(t,i){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const r=function(h,d,p,m,v){if(p.length!==0){const g=[],w=[];Dz(p,g,w,m),g.length!==0&&v.push(new h(d,g,w))}},n=[],s=t.name||"default",a=t.fps||30,o=t.blendMode;let l=t.length||-1;const u=t.hierarchy||[];for(let h=0;h<u.length;h++){const d=u[h].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const p={};let m;for(m=0;m<d.length;m++)if(d[m].morphTargets)for(let v=0;v<d[m].morphTargets.length;v++)p[d[m].morphTargets[v]]=-1;for(const v in p){const g=[],w=[];for(let S=0;S!==d[m].morphTargets.length;++S){const _=d[m];g.push(_.time),w.push(_.morphTarget===v?1:0)}n.push(new Nb(".morphTargetInfluence["+v+"]",g,w))}l=p.length*a}else{const p=".bones["+i[h].name+"]";r(Fb,p+".position",d,"pos",n),r(Lx,p+".quaternion",d,"rot",n),r(Fb,p+".scale",d,"scl",n)}}return n.length===0?null:new this(s,l,n,o)}resetDuration(){const t=this.tracks;let i=0;for(let r=0,n=t.length;r!==n;++r){const s=this.tracks[r];i=Math.max(i,s.times[s.times.length-1])}return this.duration=i,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let i=0;i<this.tracks.length;i++)t=t&&this.tracks[i].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let i=0;i<this.tracks.length;i++)t.push(this.tracks[i].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Joe(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Nb;case"vector":case"vector2":case"vector3":case"vector4":return Fb;case"color":return Iz;case"quaternion":return Lx;case"bool":case"boolean":return nv;case"string":return sv}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function $oe(e){if(e.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=Joe(e.type);if(e.times===void 0){const i=[],r=[];Dz(e.keys,i,r,"value"),e.times=i,e.values=r}return t.parse!==void 0?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const Vg={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class Lz{constructor(t,i,r){const n=this;let s=!1,a=0,o=0,l;const u=[];this.onStart=void 0,this.onLoad=t,this.onProgress=i,this.onError=r,this.itemStart=function(c){o++,s===!1&&n.onStart!==void 0&&n.onStart(c,a,o),s=!0},this.itemEnd=function(c){a++,n.onProgress!==void 0&&n.onProgress(c,a,o),a===o&&(s=!1,n.onLoad!==void 0&&n.onLoad())},this.itemError=function(c){n.onError!==void 0&&n.onError(c)},this.resolveURL=function(c){return l?l(c):c},this.setURLModifier=function(c){return l=c,this},this.addHandler=function(c,h){return u.push(c,h),this},this.removeHandler=function(c){const h=u.indexOf(c);return h!==-1&&u.splice(h,2),this},this.getHandler=function(c){for(let h=0,d=u.length;h<d;h+=2){const p=u[h],m=u[h+1];if(p.global&&(p.lastIndex=0),p.test(c))return m}return null}}}const Ay=new Lz;class pl{constructor(t){this.manager=t!==void 0?t:Ay,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,i){const r=this;return new Promise(function(n,s){r.load(t,n,i,s)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const Fh={};class ele extends Error{constructor(t,i){super(t),this.response=i}}class Td extends pl{constructor(t){super(t)}load(t,i,r,n){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=Vg.get(t);if(s!==void 0)return this.manager.itemStart(t),setTimeout(()=>{i&&i(s),this.manager.itemEnd(t)},0),s;if(Fh[t]!==void 0){Fh[t].push({onLoad:i,onProgress:r,onError:n});return}Fh[t]=[],Fh[t].push({onLoad:i,onProgress:r,onError:n});const a=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,l=this.responseType;fetch(a).then(u=>{if(u.status===200||u.status===0){if(u.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||u.body===void 0||u.body.getReader===void 0)return u;const c=Fh[t],h=u.body.getReader(),d=u.headers.get("Content-Length")||u.headers.get("X-File-Size"),p=d?parseInt(d):0,m=p!==0;let v=0;const g=new ReadableStream({start(w){S();function S(){h.read().then(({done:_,value:A})=>{if(_)w.close();else{v+=A.byteLength;const C=new ProgressEvent("progress",{lengthComputable:m,loaded:v,total:p});for(let E=0,I=c.length;E<I;E++){const T=c[E];T.onProgress&&T.onProgress(C)}w.enqueue(A),S()}})}}});return new Response(g)}else throw new ele(`fetch for "${u.url}" responded with ${u.status}: ${u.statusText}`,u)}).then(u=>{switch(l){case"arraybuffer":return u.arrayBuffer();case"blob":return u.blob();case"document":return u.text().then(c=>new DOMParser().parseFromString(c,o));case"json":return u.json();default:if(o===void 0)return u.text();{const h=/charset="?([^;"\s]*)"?/i.exec(o),d=h&&h[1]?h[1].toLowerCase():void 0,p=new TextDecoder(d);return u.arrayBuffer().then(m=>p.decode(m))}}}).then(u=>{Vg.add(t,u);const c=Fh[t];delete Fh[t];for(let h=0,d=c.length;h<d;h++){const p=c[h];p.onLoad&&p.onLoad(u)}}).catch(u=>{const c=Fh[t];if(c===void 0)throw this.manager.itemError(t),u;delete Fh[t];for(let h=0,d=c.length;h<d;h++){const p=c[h];p.onError&&p.onError(u)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class tle extends pl{constructor(t){super(t)}load(t,i,r,n){const s=this,a=new Td(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(o){try{i(s.parse(JSON.parse(o)))}catch(l){n?n(l):console.error(l),s.manager.itemError(t)}},r,n)}parse(t){const i=[];for(let r=0;r<t.length;r++){const n=Ub.parse(t[r]);i.push(n)}return i}}class ile extends pl{constructor(t){super(t)}load(t,i,r,n){const s=this,a=[],o=new bz,l=new Td(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(s.withCredentials);let u=0;function c(h){l.load(t[h],function(d){const p=s.parse(d,!0);a[h]={width:p.width,height:p.height,format:p.format,mipmaps:p.mipmaps},u+=1,u===6&&(p.mipmapCount===1&&(o.minFilter=On),o.image=a,o.format=p.format,o.needsUpdate=!0,i&&i(o))},r,n)}if(Array.isArray(t))for(let h=0,d=t.length;h<d;++h)c(h);else l.load(t,function(h){const d=s.parse(h,!0);if(d.isCubemap){const p=d.mipmaps.length/d.mipmapCount;for(let m=0;m<p;m++){a[m]={mipmaps:[]};for(let v=0;v<d.mipmapCount;v++)a[m].mipmaps.push(d.mipmaps[m*d.mipmapCount+v]),a[m].format=d.format,a[m].width=d.width,a[m].height=d.height}o.image=a}else o.image.width=d.width,o.image.height=d.height,o.mipmaps=d.mipmaps;d.mipmapCount===1&&(o.minFilter=On),o.format=d.format,o.needsUpdate=!0,i&&i(o)},r,n);return o}}class Vb extends pl{constructor(t){super(t)}load(t,i,r,n){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,a=Vg.get(t);if(a!==void 0)return s.manager.itemStart(t),setTimeout(function(){i&&i(a),s.manager.itemEnd(t)},0),a;const o=Lb("img");function l(){c(),Vg.add(t,this),i&&i(this),s.manager.itemEnd(t)}function u(h){c(),n&&n(h),s.manager.itemError(t),s.manager.itemEnd(t)}function c(){o.removeEventListener("load",l,!1),o.removeEventListener("error",u,!1)}return o.addEventListener("load",l,!1),o.addEventListener("error",u,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),s.manager.itemStart(t),o.src=t,o}}class rle extends pl{constructor(t){super(t)}load(t,i,r,n){const s=new __,a=new Vb(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let o=0;function l(u){a.load(t[u],function(c){s.images[u]=c,o++,o===6&&(s.needsUpdate=!0,i&&i(s))},void 0,n)}for(let u=0;u<t.length;++u)l(u);return s}}class nle extends pl{constructor(t){super(t)}load(t,i,r,n){const s=this,a=new Uy,o=new Td(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(s.withCredentials),o.load(t,function(l){const u=s.parse(l);u&&(u.image!==void 0?a.image=u.image:u.data!==void 0&&(a.image.width=u.width,a.image.height=u.height,a.image.data=u.data),a.wrapS=u.wrapS!==void 0?u.wrapS:Oa,a.wrapT=u.wrapT!==void 0?u.wrapT:Oa,a.magFilter=u.magFilter!==void 0?u.magFilter:On,a.minFilter=u.minFilter!==void 0?u.minFilter:On,a.anisotropy=u.anisotropy!==void 0?u.anisotropy:1,u.encoding!==void 0&&(a.encoding=u.encoding),u.flipY!==void 0&&(a.flipY=u.flipY),u.format!==void 0&&(a.format=u.format),u.type!==void 0&&(a.type=u.type),u.mipmaps!==void 0&&(a.mipmaps=u.mipmaps,a.minFilter=Pp),u.mipmapCount===1&&(a.minFilter=On),u.generateMipmaps!==void 0&&(a.generateMipmaps=u.generateMipmaps),a.needsUpdate=!0,i&&i(a,u))},r,n),a}}class NC extends pl{constructor(t){super(t)}load(t,i,r,n){const s=new _n,a=new Vb(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,function(o){s.image=o,s.needsUpdate=!0,i!==void 0&&i(s)},r,n),s}}class jp extends ur{constructor(t,i=1){super(),this.isLight=!0,this.type="Light",this.color=new qt(t),this.intensity=i}dispose(){}copy(t,i){return super.copy(t,i),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const i=super.toJSON(t);return i.object.color=this.color.getHex(),i.object.intensity=this.intensity,this.groundColor!==void 0&&(i.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(i.object.distance=this.distance),this.angle!==void 0&&(i.object.angle=this.angle),this.decay!==void 0&&(i.object.decay=this.decay),this.penumbra!==void 0&&(i.object.penumbra=this.penumbra),this.shadow!==void 0&&(i.object.shadow=this.shadow.toJSON()),i}}class l7 extends jp{constructor(t,i,r){super(t,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(ur.DEFAULT_UP),this.updateMatrix(),this.groundColor=new qt(i)}copy(t,i){return super.copy(t,i),this.groundColor.copy(t.groundColor),this}}const kP=new Oi,v4=new pe,y4=new pe;class Oz{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ft(512,512),this.map=null,this.mapPass=null,this.matrix=new Oi,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new TC,this._frameExtents=new ft(1,1),this._viewportCount=1,this._viewports=[new _r(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const i=this.camera,r=this.matrix;v4.setFromMatrixPosition(t.matrixWorld),i.position.copy(v4),y4.setFromMatrixPosition(t.target.matrixWorld),i.lookAt(y4),i.updateMatrixWorld(),kP.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(kP),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(kP)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class sle extends Oz{constructor(){super(new on(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const i=this.camera,r=Ib*2*t.angle*this.focus,n=this.mapSize.width/this.mapSize.height,s=t.distance||i.far;(r!==i.fov||n!==i.aspect||s!==i.far)&&(i.fov=r,i.aspect=n,i.far=s,i.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class u7 extends jp{constructor(t,i,r=0,n=Math.PI/3,s=0,a=2){super(t,i),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(ur.DEFAULT_UP),this.updateMatrix(),this.target=new ur,this.distance=r,this.angle=n,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new sle}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,i){return super.copy(t,i),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const x4=new Oi,tw=new pe,BP=new pe;class ale extends Oz{constructor(){super(new on(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ft(4,2),this._viewportCount=6,this._viewports=[new _r(2,1,1,1),new _r(0,1,1,1),new _r(3,1,1,1),new _r(1,1,1,1),new _r(3,0,1,1),new _r(1,0,1,1)],this._cubeDirections=[new pe(1,0,0),new pe(-1,0,0),new pe(0,0,1),new pe(0,0,-1),new pe(0,1,0),new pe(0,-1,0)],this._cubeUps=[new pe(0,1,0),new pe(0,1,0),new pe(0,1,0),new pe(0,1,0),new pe(0,0,1),new pe(0,0,-1)]}updateMatrices(t,i=0){const r=this.camera,n=this.matrix,s=t.distance||r.far;s!==r.far&&(r.far=s,r.updateProjectionMatrix()),tw.setFromMatrixPosition(t.matrixWorld),r.position.copy(tw),BP.copy(r.position),BP.add(this._cubeDirections[i]),r.up.copy(this._cubeUps[i]),r.lookAt(BP),r.updateMatrixWorld(),n.makeTranslation(-tw.x,-tw.y,-tw.z),x4.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(x4)}}class c7 extends jp{constructor(t,i,r=0,n=2){super(t,i),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=n,this.shadow=new ale}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,i){return super.copy(t,i),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class ole extends Oz{constructor(){super(new jc(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class h7 extends jp{constructor(t,i){super(t,i),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(ur.DEFAULT_UP),this.updateMatrix(),this.target=new ur,this.shadow=new ole}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class d7 extends jp{constructor(t,i){super(t,i),this.isAmbientLight=!0,this.type="AmbientLight"}}class f7 extends jp{constructor(t,i,r=10,n=10){super(t,i),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=r,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const i=super.toJSON(t);return i.object.width=this.width,i.object.height=this.height,i}}class p7{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new pe)}set(t){for(let i=0;i<9;i++)this.coefficients[i].copy(t[i]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,i){const r=t.x,n=t.y,s=t.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.282095),i.addScaledVector(a[1],.488603*n),i.addScaledVector(a[2],.488603*s),i.addScaledVector(a[3],.488603*r),i.addScaledVector(a[4],1.092548*(r*n)),i.addScaledVector(a[5],1.092548*(n*s)),i.addScaledVector(a[6],.315392*(3*s*s-1)),i.addScaledVector(a[7],1.092548*(r*s)),i.addScaledVector(a[8],.546274*(r*r-n*n)),i}getIrradianceAt(t,i){const r=t.x,n=t.y,s=t.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.886227),i.addScaledVector(a[1],2*.511664*n),i.addScaledVector(a[2],2*.511664*s),i.addScaledVector(a[3],2*.511664*r),i.addScaledVector(a[4],2*.429043*r*n),i.addScaledVector(a[5],2*.429043*n*s),i.addScaledVector(a[6],.743125*s*s-.247708),i.addScaledVector(a[7],2*.429043*r*s),i.addScaledVector(a[8],.429043*(r*r-n*n)),i}add(t){for(let i=0;i<9;i++)this.coefficients[i].add(t.coefficients[i]);return this}addScaledSH(t,i){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(t.coefficients[r],i);return this}scale(t){for(let i=0;i<9;i++)this.coefficients[i].multiplyScalar(t);return this}lerp(t,i){for(let r=0;r<9;r++)this.coefficients[r].lerp(t.coefficients[r],i);return this}equals(t){for(let i=0;i<9;i++)if(!this.coefficients[i].equals(t.coefficients[i]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(t,i=0){const r=this.coefficients;for(let n=0;n<9;n++)r[n].fromArray(t,i+n*3);return this}toArray(t=[],i=0){const r=this.coefficients;for(let n=0;n<9;n++)r[n].toArray(t,i+n*3);return t}static getBasisAt(t,i){const r=t.x,n=t.y,s=t.z;i[0]=.282095,i[1]=.488603*n,i[2]=.488603*s,i[3]=.488603*r,i[4]=1.092548*r*n,i[5]=1.092548*n*s,i[6]=.315392*(3*s*s-1),i[7]=1.092548*r*s,i[8]=.546274*(r*r-n*n)}}class FC extends jp{constructor(t=new p7,i=1){super(void 0,i),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const i=super.toJSON(t);return i.object.sh=this.sh.toArray(),i}}class UC extends pl{constructor(t){super(t),this.textures={}}load(t,i,r,n){const s=this,a=new Td(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(t,function(o){try{i(s.parse(JSON.parse(o)))}catch(l){n?n(l):console.error(l),s.manager.itemError(t)}},r,n)}parse(t){const i=this.textures;function r(s){return i[s]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",s),i[s]}const n=UC.createMaterialFromType(t.type);if(t.uuid!==void 0&&(n.uuid=t.uuid),t.name!==void 0&&(n.name=t.name),t.color!==void 0&&n.color!==void 0&&n.color.setHex(t.color),t.roughness!==void 0&&(n.roughness=t.roughness),t.metalness!==void 0&&(n.metalness=t.metalness),t.sheen!==void 0&&(n.sheen=t.sheen),t.sheenColor!==void 0&&(n.sheenColor=new qt().setHex(t.sheenColor)),t.sheenRoughness!==void 0&&(n.sheenRoughness=t.sheenRoughness),t.emissive!==void 0&&n.emissive!==void 0&&n.emissive.setHex(t.emissive),t.specular!==void 0&&n.specular!==void 0&&n.specular.setHex(t.specular),t.specularIntensity!==void 0&&(n.specularIntensity=t.specularIntensity),t.specularColor!==void 0&&n.specularColor!==void 0&&n.specularColor.setHex(t.specularColor),t.shininess!==void 0&&(n.shininess=t.shininess),t.clearcoat!==void 0&&(n.clearcoat=t.clearcoat),t.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=t.clearcoatRoughness),t.iridescence!==void 0&&(n.iridescence=t.iridescence),t.iridescenceIOR!==void 0&&(n.iridescenceIOR=t.iridescenceIOR),t.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=t.iridescenceThicknessRange),t.transmission!==void 0&&(n.transmission=t.transmission),t.thickness!==void 0&&(n.thickness=t.thickness),t.attenuationDistance!==void 0&&(n.attenuationDistance=t.attenuationDistance),t.attenuationColor!==void 0&&n.attenuationColor!==void 0&&n.attenuationColor.setHex(t.attenuationColor),t.fog!==void 0&&(n.fog=t.fog),t.flatShading!==void 0&&(n.flatShading=t.flatShading),t.blending!==void 0&&(n.blending=t.blending),t.combine!==void 0&&(n.combine=t.combine),t.side!==void 0&&(n.side=t.side),t.shadowSide!==void 0&&(n.shadowSide=t.shadowSide),t.opacity!==void 0&&(n.opacity=t.opacity),t.transparent!==void 0&&(n.transparent=t.transparent),t.alphaTest!==void 0&&(n.alphaTest=t.alphaTest),t.depthTest!==void 0&&(n.depthTest=t.depthTest),t.depthWrite!==void 0&&(n.depthWrite=t.depthWrite),t.colorWrite!==void 0&&(n.colorWrite=t.colorWrite),t.stencilWrite!==void 0&&(n.stencilWrite=t.stencilWrite),t.stencilWriteMask!==void 0&&(n.stencilWriteMask=t.stencilWriteMask),t.stencilFunc!==void 0&&(n.stencilFunc=t.stencilFunc),t.stencilRef!==void 0&&(n.stencilRef=t.stencilRef),t.stencilFuncMask!==void 0&&(n.stencilFuncMask=t.stencilFuncMask),t.stencilFail!==void 0&&(n.stencilFail=t.stencilFail),t.stencilZFail!==void 0&&(n.stencilZFail=t.stencilZFail),t.stencilZPass!==void 0&&(n.stencilZPass=t.stencilZPass),t.wireframe!==void 0&&(n.wireframe=t.wireframe),t.wireframeLinewidth!==void 0&&(n.wireframeLinewidth=t.wireframeLinewidth),t.wireframeLinecap!==void 0&&(n.wireframeLinecap=t.wireframeLinecap),t.wireframeLinejoin!==void 0&&(n.wireframeLinejoin=t.wireframeLinejoin),t.rotation!==void 0&&(n.rotation=t.rotation),t.linewidth!==1&&(n.linewidth=t.linewidth),t.dashSize!==void 0&&(n.dashSize=t.dashSize),t.gapSize!==void 0&&(n.gapSize=t.gapSize),t.scale!==void 0&&(n.scale=t.scale),t.polygonOffset!==void 0&&(n.polygonOffset=t.polygonOffset),t.polygonOffsetFactor!==void 0&&(n.polygonOffsetFactor=t.polygonOffsetFactor),t.polygonOffsetUnits!==void 0&&(n.polygonOffsetUnits=t.polygonOffsetUnits),t.dithering!==void 0&&(n.dithering=t.dithering),t.alphaToCoverage!==void 0&&(n.alphaToCoverage=t.alphaToCoverage),t.premultipliedAlpha!==void 0&&(n.premultipliedAlpha=t.premultipliedAlpha),t.forceSinglePass!==void 0&&(n.forceSinglePass=t.forceSinglePass),t.visible!==void 0&&(n.visible=t.visible),t.toneMapped!==void 0&&(n.toneMapped=t.toneMapped),t.userData!==void 0&&(n.userData=t.userData),t.vertexColors!==void 0&&(typeof t.vertexColors=="number"?n.vertexColors=t.vertexColors>0:n.vertexColors=t.vertexColors),t.uniforms!==void 0)for(const s in t.uniforms){const a=t.uniforms[s];switch(n.uniforms[s]={},a.type){case"t":n.uniforms[s].value=r(a.value);break;case"c":n.uniforms[s].value=new qt().setHex(a.value);break;case"v2":n.uniforms[s].value=new ft().fromArray(a.value);break;case"v3":n.uniforms[s].value=new pe().fromArray(a.value);break;case"v4":n.uniforms[s].value=new _r().fromArray(a.value);break;case"m3":n.uniforms[s].value=new ma().fromArray(a.value);break;case"m4":n.uniforms[s].value=new Oi().fromArray(a.value);break;default:n.uniforms[s].value=a.value}}if(t.defines!==void 0&&(n.defines=t.defines),t.vertexShader!==void 0&&(n.vertexShader=t.vertexShader),t.fragmentShader!==void 0&&(n.fragmentShader=t.fragmentShader),t.glslVersion!==void 0&&(n.glslVersion=t.glslVersion),t.extensions!==void 0)for(const s in t.extensions)n.extensions[s]=t.extensions[s];if(t.size!==void 0&&(n.size=t.size),t.sizeAttenuation!==void 0&&(n.sizeAttenuation=t.sizeAttenuation),t.map!==void 0&&(n.map=r(t.map)),t.matcap!==void 0&&(n.matcap=r(t.matcap)),t.alphaMap!==void 0&&(n.alphaMap=r(t.alphaMap)),t.bumpMap!==void 0&&(n.bumpMap=r(t.bumpMap)),t.bumpScale!==void 0&&(n.bumpScale=t.bumpScale),t.normalMap!==void 0&&(n.normalMap=r(t.normalMap)),t.normalMapType!==void 0&&(n.normalMapType=t.normalMapType),t.normalScale!==void 0){let s=t.normalScale;Array.isArray(s)===!1&&(s=[s,s]),n.normalScale=new ft().fromArray(s)}return t.displacementMap!==void 0&&(n.displacementMap=r(t.displacementMap)),t.displacementScale!==void 0&&(n.displacementScale=t.displacementScale),t.displacementBias!==void 0&&(n.displacementBias=t.displacementBias),t.roughnessMap!==void 0&&(n.roughnessMap=r(t.roughnessMap)),t.metalnessMap!==void 0&&(n.metalnessMap=r(t.metalnessMap)),t.emissiveMap!==void 0&&(n.emissiveMap=r(t.emissiveMap)),t.emissiveIntensity!==void 0&&(n.emissiveIntensity=t.emissiveIntensity),t.specularMap!==void 0&&(n.specularMap=r(t.specularMap)),t.specularIntensityMap!==void 0&&(n.specularIntensityMap=r(t.specularIntensityMap)),t.specularColorMap!==void 0&&(n.specularColorMap=r(t.specularColorMap)),t.envMap!==void 0&&(n.envMap=r(t.envMap)),t.envMapIntensity!==void 0&&(n.envMapIntensity=t.envMapIntensity),t.reflectivity!==void 0&&(n.reflectivity=t.reflectivity),t.refractionRatio!==void 0&&(n.refractionRatio=t.refractionRatio),t.lightMap!==void 0&&(n.lightMap=r(t.lightMap)),t.lightMapIntensity!==void 0&&(n.lightMapIntensity=t.lightMapIntensity),t.aoMap!==void 0&&(n.aoMap=r(t.aoMap)),t.aoMapIntensity!==void 0&&(n.aoMapIntensity=t.aoMapIntensity),t.gradientMap!==void 0&&(n.gradientMap=r(t.gradientMap)),t.clearcoatMap!==void 0&&(n.clearcoatMap=r(t.clearcoatMap)),t.clearcoatRoughnessMap!==void 0&&(n.clearcoatRoughnessMap=r(t.clearcoatRoughnessMap)),t.clearcoatNormalMap!==void 0&&(n.clearcoatNormalMap=r(t.clearcoatNormalMap)),t.clearcoatNormalScale!==void 0&&(n.clearcoatNormalScale=new ft().fromArray(t.clearcoatNormalScale)),t.iridescenceMap!==void 0&&(n.iridescenceMap=r(t.iridescenceMap)),t.iridescenceThicknessMap!==void 0&&(n.iridescenceThicknessMap=r(t.iridescenceThicknessMap)),t.transmissionMap!==void 0&&(n.transmissionMap=r(t.transmissionMap)),t.thicknessMap!==void 0&&(n.thicknessMap=r(t.thicknessMap)),t.sheenColorMap!==void 0&&(n.sheenColorMap=r(t.sheenColorMap)),t.sheenRoughnessMap!==void 0&&(n.sheenRoughnessMap=r(t.sheenRoughnessMap)),n}setTextures(t){return this.textures=t,this}static createMaterialFromType(t){const i={ShadowMaterial:Q9,SpriteMaterial:yz,RawShaderMaterial:K9,ShaderMaterial:Kc,PointsMaterial:wz,MeshPhysicalMaterial:Z9,MeshStandardMaterial:Tz,MeshPhongMaterial:J9,MeshToonMaterial:$9,MeshNormalMaterial:e7,MeshLambertMaterial:t7,MeshDepthMaterial:gz,MeshDistanceMaterial:vz,MeshBasicMaterial:Up,MeshMatcapMaterial:i7,LineDashedMaterial:r7,LineBasicMaterial:ho,Material:wa};return new i[t]}}class mI{static decodeText(t){if(typeof TextDecoder<"u")return new TextDecoder().decode(t);let i="";for(let r=0,n=t.length;r<n;r++)i+=String.fromCharCode(t[r]);try{return decodeURIComponent(escape(i))}catch{return i}}static extractUrlBase(t){const i=t.lastIndexOf("/");return i===-1?"./":t.slice(0,i+1)}static resolveURL(t,i){return typeof t!="string"||t===""?"":(/^https?:\/\//i.test(i)&&/^\//.test(t)&&(i=i.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:i+t)}}class m7 extends Fi{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}toJSON(){const t=super.toJSON();return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}class g7 extends pl{constructor(t){super(t)}load(t,i,r,n){const s=this,a=new Td(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(t,function(o){try{i(s.parse(JSON.parse(o)))}catch(l){n?n(l):console.error(l),s.manager.itemError(t)}},r,n)}parse(t){const i={},r={};function n(p,m){if(i[m]!==void 0)return i[m];const g=p.interleavedBuffers[m],w=s(p,g.buffer),S=by(g.type,w),_=new LC(S,g.stride);return _.uuid=g.uuid,i[m]=_,_}function s(p,m){if(r[m]!==void 0)return r[m];const g=p.arrayBuffers[m],w=new Uint32Array(g).buffer;return r[m]=w,w}const a=t.isInstancedBufferGeometry?new m7:new Fi,o=t.data.index;if(o!==void 0){const p=by(o.type,o.array);a.setIndex(new kr(p,1))}const l=t.data.attributes;for(const p in l){const m=l[p];let v;if(m.isInterleavedBufferAttribute){const g=n(t.data,m.data);v=new Fg(g,m.itemSize,m.offset,m.normalized)}else{const g=by(m.type,m.array),w=m.isInstancedBufferAttribute?rx:kr;v=new w(g,m.itemSize,m.normalized)}m.name!==void 0&&(v.name=m.name),m.usage!==void 0&&v.setUsage(m.usage),m.updateRange!==void 0&&(v.updateRange.offset=m.updateRange.offset,v.updateRange.count=m.updateRange.count),a.setAttribute(p,v)}const u=t.data.morphAttributes;if(u)for(const p in u){const m=u[p],v=[];for(let g=0,w=m.length;g<w;g++){const S=m[g];let _;if(S.isInterleavedBufferAttribute){const A=n(t.data,S.data);_=new Fg(A,S.itemSize,S.offset,S.normalized)}else{const A=by(S.type,S.array);_=new kr(A,S.itemSize,S.normalized)}S.name!==void 0&&(_.name=S.name),v.push(_)}a.morphAttributes[p]=v}t.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const h=t.data.groups||t.data.drawcalls||t.data.offsets;if(h!==void 0)for(let p=0,m=h.length;p!==m;++p){const v=h[p];a.addGroup(v.start,v.count,v.materialIndex)}const d=t.data.boundingSphere;if(d!==void 0){const p=new pe;d.center!==void 0&&p.fromArray(d.center),a.boundingSphere=new tv(p,d.radius)}return t.name&&(a.name=t.name),t.userData&&(a.userData=t.userData),a}}class lle extends pl{constructor(t){super(t)}load(t,i,r,n){const s=this,a=this.path===""?mI.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||a;const o=new Td(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,function(l){let u=null;try{u=JSON.parse(l)}catch(h){n!==void 0&&n(h),console.error("THREE:ObjectLoader: Can't parse "+t+".",h.message);return}const c=u.metadata;if(c===void 0||c.type===void 0||c.type.toLowerCase()==="geometry"){n!==void 0&&n(new Error("THREE.ObjectLoader: Can't load "+t)),console.error("THREE.ObjectLoader: Can't load "+t);return}s.parse(u,i)},r,n)}async loadAsync(t,i){const r=this,n=this.path===""?mI.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||n;const s=new Td(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const a=await s.loadAsync(t,i),o=JSON.parse(a),l=o.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+t);return await r.parseAsync(o)}parse(t,i){const r=this.parseAnimations(t.animations),n=this.parseShapes(t.shapes),s=this.parseGeometries(t.geometries,n),a=this.parseImages(t.images,function(){i!==void 0&&i(u)}),o=this.parseTextures(t.textures,a),l=this.parseMaterials(t.materials,o),u=this.parseObject(t.object,s,l,o,r),c=this.parseSkeletons(t.skeletons,u);if(this.bindSkeletons(u,c),i!==void 0){let h=!1;for(const d in a)if(a[d].data instanceof HTMLImageElement){h=!0;break}h===!1&&i(u)}return u}async parseAsync(t){const i=this.parseAnimations(t.animations),r=this.parseShapes(t.shapes),n=this.parseGeometries(t.geometries,r),s=await this.parseImagesAsync(t.images),a=this.parseTextures(t.textures,s),o=this.parseMaterials(t.materials,a),l=this.parseObject(t.object,n,o,a,i),u=this.parseSkeletons(t.skeletons,l);return this.bindSkeletons(l,u),l}parseShapes(t){const i={};if(t!==void 0)for(let r=0,n=t.length;r<n;r++){const s=new Tg().fromJSON(t[r]);i[s.uuid]=s}return i}parseSkeletons(t,i){const r={},n={};if(i.traverse(function(s){s.isBone&&(n[s.uuid]=s)}),t!==void 0)for(let s=0,a=t.length;s<a;s++){const o=new OC().fromJSON(t[s],n);r[o.uuid]=o}return r}parseGeometries(t,i){const r={};if(t!==void 0){const n=new g7;for(let s=0,a=t.length;s<a;s++){let o;const l=t[s];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":o=n.parse(l);break;default:l.type in g4?o=g4[l.type].fromJSON(l,i):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}o.uuid=l.uuid,l.name!==void 0&&(o.name=l.name),l.userData!==void 0&&(o.userData=l.userData),r[l.uuid]=o}}return r}parseMaterials(t,i){const r={},n={};if(t!==void 0){const s=new UC;s.setTextures(i);for(let a=0,o=t.length;a<o;a++){const l=t[a];r[l.uuid]===void 0&&(r[l.uuid]=s.parse(l)),n[l.uuid]=r[l.uuid]}}return n}parseAnimations(t){const i={};if(t!==void 0)for(let r=0;r<t.length;r++){const n=t[r],s=Ub.parse(n);i[s.uuid]=s}return i}parseImages(t,i){const r=this,n={};let s;function a(l){return r.manager.itemStart(l),s.load(l,function(){r.manager.itemEnd(l)},void 0,function(){r.manager.itemError(l),r.manager.itemEnd(l)})}function o(l){if(typeof l=="string"){const u=l,c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(u)?u:r.resourcePath+u;return a(c)}else return l.data?{data:by(l.type,l.data),width:l.width,height:l.height}:null}if(t!==void 0&&t.length>0){const l=new Lz(i);s=new Vb(l),s.setCrossOrigin(this.crossOrigin);for(let u=0,c=t.length;u<c;u++){const h=t[u],d=h.url;if(Array.isArray(d)){const p=[];for(let m=0,v=d.length;m<v;m++){const g=d[m],w=o(g);w!==null&&(w instanceof HTMLImageElement?p.push(w):p.push(new Uy(w.data,w.width,w.height)))}n[h.uuid]=new dg(p)}else{const p=o(h.url);n[h.uuid]=new dg(p)}}}return n}async parseImagesAsync(t){const i=this,r={};let n;async function s(a){if(typeof a=="string"){const o=a,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(o)?o:i.resourcePath+o;return await n.loadAsync(l)}else return a.data?{data:by(a.type,a.data),width:a.width,height:a.height}:null}if(t!==void 0&&t.length>0){n=new Vb(this.manager),n.setCrossOrigin(this.crossOrigin);for(let a=0,o=t.length;a<o;a++){const l=t[a],u=l.url;if(Array.isArray(u)){const c=[];for(let h=0,d=u.length;h<d;h++){const p=u[h],m=await s(p);m!==null&&(m instanceof HTMLImageElement?c.push(m):c.push(new Uy(m.data,m.width,m.height)))}r[l.uuid]=new dg(c)}else{const c=await s(l.url);r[l.uuid]=new dg(c)}}}return r}parseTextures(t,i){function r(s,a){return typeof s=="number"?s:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",s),a[s])}const n={};if(t!==void 0)for(let s=0,a=t.length;s<a;s++){const o=t[s];o.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),i[o.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",o.image);const l=i[o.image],u=l.data;let c;Array.isArray(u)?(c=new __,u.length===6&&(c.needsUpdate=!0)):(u&&u.data?c=new Uy:c=new _n,u&&(c.needsUpdate=!0)),c.source=l,c.uuid=o.uuid,o.name!==void 0&&(c.name=o.name),o.mapping!==void 0&&(c.mapping=r(o.mapping,ule)),o.offset!==void 0&&c.offset.fromArray(o.offset),o.repeat!==void 0&&c.repeat.fromArray(o.repeat),o.center!==void 0&&c.center.fromArray(o.center),o.rotation!==void 0&&(c.rotation=o.rotation),o.wrap!==void 0&&(c.wrapS=r(o.wrap[0],w4),c.wrapT=r(o.wrap[1],w4)),o.format!==void 0&&(c.format=o.format),o.internalFormat!==void 0&&(c.internalFormat=o.internalFormat),o.type!==void 0&&(c.type=o.type),o.encoding!==void 0&&(c.encoding=o.encoding),o.minFilter!==void 0&&(c.minFilter=r(o.minFilter,b4)),o.magFilter!==void 0&&(c.magFilter=r(o.magFilter,b4)),o.anisotropy!==void 0&&(c.anisotropy=o.anisotropy),o.flipY!==void 0&&(c.flipY=o.flipY),o.generateMipmaps!==void 0&&(c.generateMipmaps=o.generateMipmaps),o.premultiplyAlpha!==void 0&&(c.premultiplyAlpha=o.premultiplyAlpha),o.unpackAlignment!==void 0&&(c.unpackAlignment=o.unpackAlignment),o.userData!==void 0&&(c.userData=o.userData),n[o.uuid]=c}return n}parseObject(t,i,r,n,s){let a;function o(d){return i[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",d),i[d]}function l(d){if(d!==void 0){if(Array.isArray(d)){const p=[];for(let m=0,v=d.length;m<v;m++){const g=d[m];r[g]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",g),p.push(r[g])}return p}return r[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",d),r[d]}}function u(d){return n[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",d),n[d]}let c,h;switch(t.type){case"Scene":a=new i2,t.background!==void 0&&(Number.isInteger(t.background)?a.background=new qt(t.background):a.background=u(t.background)),t.environment!==void 0&&(a.environment=u(t.environment)),t.fog!==void 0&&(t.fog.type==="Fog"?a.fog=new IC(t.fog.color,t.fog.near,t.fog.far):t.fog.type==="FogExp2"&&(a.fog=new RC(t.fog.color,t.fog.density))),t.backgroundBlurriness!==void 0&&(a.backgroundBlurriness=t.backgroundBlurriness),t.backgroundIntensity!==void 0&&(a.backgroundIntensity=t.backgroundIntensity);break;case"PerspectiveCamera":a=new on(t.fov,t.aspect,t.near,t.far),t.focus!==void 0&&(a.focus=t.focus),t.zoom!==void 0&&(a.zoom=t.zoom),t.filmGauge!==void 0&&(a.filmGauge=t.filmGauge),t.filmOffset!==void 0&&(a.filmOffset=t.filmOffset),t.view!==void 0&&(a.view=Object.assign({},t.view));break;case"OrthographicCamera":a=new jc(t.left,t.right,t.top,t.bottom,t.near,t.far),t.zoom!==void 0&&(a.zoom=t.zoom),t.view!==void 0&&(a.view=Object.assign({},t.view));break;case"AmbientLight":a=new d7(t.color,t.intensity);break;case"DirectionalLight":a=new h7(t.color,t.intensity);break;case"PointLight":a=new c7(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":a=new f7(t.color,t.intensity,t.width,t.height);break;case"SpotLight":a=new u7(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":a=new l7(t.color,t.groundColor,t.intensity);break;case"LightProbe":a=new FC().fromJSON(t);break;case"SkinnedMesh":c=o(t.geometry),h=l(t.material),a=new z9(c,h),t.bindMode!==void 0&&(a.bindMode=t.bindMode),t.bindMatrix!==void 0&&a.bindMatrix.fromArray(t.bindMatrix),t.skeleton!==void 0&&(a.skeleton=t.skeleton);break;case"Mesh":c=o(t.geometry),h=l(t.material),a=new js(c,h);break;case"InstancedMesh":c=o(t.geometry),h=l(t.material);const d=t.count,p=t.instanceMatrix,m=t.instanceColor;a=new k9(c,h,d),a.instanceMatrix=new rx(new Float32Array(p.array),16),m!==void 0&&(a.instanceColor=new rx(new Float32Array(m.array),m.itemSize));break;case"LOD":a=new O9;break;case"Line":a=new Rp(o(t.geometry),l(t.material));break;case"LineLoop":a=new B9(o(t.geometry),l(t.material));break;case"LineSegments":a=new ih(o(t.geometry),l(t.material));break;case"PointCloud":case"Points":a=new N9(o(t.geometry),l(t.material));break;case"Sprite":a=new L9(l(t.material));break;case"Group":a=new Sy;break;case"Bone":a=new xz;break;default:a=new ur}if(a.uuid=t.uuid,t.name!==void 0&&(a.name=t.name),t.matrix!==void 0?(a.matrix.fromArray(t.matrix),t.matrixAutoUpdate!==void 0&&(a.matrixAutoUpdate=t.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(t.position!==void 0&&a.position.fromArray(t.position),t.rotation!==void 0&&a.rotation.fromArray(t.rotation),t.quaternion!==void 0&&a.quaternion.fromArray(t.quaternion),t.scale!==void 0&&a.scale.fromArray(t.scale)),t.castShadow!==void 0&&(a.castShadow=t.castShadow),t.receiveShadow!==void 0&&(a.receiveShadow=t.receiveShadow),t.shadow&&(t.shadow.bias!==void 0&&(a.shadow.bias=t.shadow.bias),t.shadow.normalBias!==void 0&&(a.shadow.normalBias=t.shadow.normalBias),t.shadow.radius!==void 0&&(a.shadow.radius=t.shadow.radius),t.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(t.shadow.mapSize),t.shadow.camera!==void 0&&(a.shadow.camera=this.parseObject(t.shadow.camera))),t.visible!==void 0&&(a.visible=t.visible),t.frustumCulled!==void 0&&(a.frustumCulled=t.frustumCulled),t.renderOrder!==void 0&&(a.renderOrder=t.renderOrder),t.userData!==void 0&&(a.userData=t.userData),t.layers!==void 0&&(a.layers.mask=t.layers),t.children!==void 0){const d=t.children;for(let p=0;p<d.length;p++)a.add(this.parseObject(d[p],i,r,n,s))}if(t.animations!==void 0){const d=t.animations;for(let p=0;p<d.length;p++){const m=d[p];a.animations.push(s[m])}}if(t.type==="LOD"){t.autoUpdate!==void 0&&(a.autoUpdate=t.autoUpdate);const d=t.levels;for(let p=0;p<d.length;p++){const m=d[p],v=a.getObjectByProperty("uuid",m.object);v!==void 0&&a.addLevel(v,m.distance,m.hysteresis)}}return a}bindSkeletons(t,i){Object.keys(i).length!==0&&t.traverse(function(r){if(r.isSkinnedMesh===!0&&r.skeleton!==void 0){const n=i[r.skeleton];n===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",r.skeleton):r.bind(n,r.bindMatrix)}})}}const ule={UVMapping:AC,CubeReflectionMapping:Cp,CubeRefractionMapping:Tp,EquirectangularReflectionMapping:Mb,EquirectangularRefractionMapping:Ab,CubeUVReflectionMapping:Ex},w4={RepeatWrapping:Eb,ClampToEdgeWrapping:Oa,MirroredRepeatWrapping:Cb},b4={NearestFilter:Ln,NearestMipmapNearestFilter:e2,NearestMipmapLinearFilter:Jw,LinearFilter:On,LinearMipmapNearestFilter:nz,LinearMipmapLinearFilter:Pp};class cle extends pl{constructor(t){super(t),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,i,r,n){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,a=Vg.get(t);if(a!==void 0)return s.manager.itemStart(t),setTimeout(function(){i&&i(a),s.manager.itemEnd(t)},0),a;const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader,fetch(t,o).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(l){Vg.add(t,l),i&&i(l),s.manager.itemEnd(t)}).catch(function(l){n&&n(l),s.manager.itemError(t),s.manager.itemEnd(t)}),s.manager.itemStart(t)}}let OM,zz=class{static getContext(){return OM===void 0&&(OM=new(window.AudioContext||window.webkitAudioContext)),OM}static setContext(t){OM=t}};class hle extends pl{constructor(t){super(t)}load(t,i,r,n){const s=this,a=new Td(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(o){try{const l=o.slice(0);zz.getContext().decodeAudioData(l,function(c){i(c)})}catch(l){n?n(l):console.error(l),s.manager.itemError(t)}},r,n)}}class dle extends FC{constructor(t,i,r=1){super(void 0,r),this.isHemisphereLightProbe=!0;const n=new qt().set(t),s=new qt().set(i),a=new pe(n.r,n.g,n.b),o=new pe(s.r,s.g,s.b),l=Math.sqrt(Math.PI),u=l*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(o).multiplyScalar(l),this.sh.coefficients[1].copy(a).sub(o).multiplyScalar(u)}}class fle extends FC{constructor(t,i=1){super(void 0,i),this.isAmbientLightProbe=!0;const r=new qt().set(t);this.sh.coefficients[0].set(r.r,r.g,r.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const _4=new Oi,S4=new Oi,Lm=new Oi;class ple{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new on,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new on,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const i=this._cache;if(i.focus!==t.focus||i.fov!==t.fov||i.aspect!==t.aspect*this.aspect||i.near!==t.near||i.far!==t.far||i.zoom!==t.zoom||i.eyeSep!==this.eyeSep){i.focus=t.focus,i.fov=t.fov,i.aspect=t.aspect*this.aspect,i.near=t.near,i.far=t.far,i.zoom=t.zoom,i.eyeSep=this.eyeSep,Lm.copy(t.projectionMatrix);const n=i.eyeSep/2,s=n*i.near/i.focus,a=i.near*Math.tan(Eg*i.fov*.5)/i.zoom;let o,l;S4.elements[12]=-n,_4.elements[12]=n,o=-a*i.aspect+s,l=a*i.aspect+s,Lm.elements[0]=2*i.near/(l-o),Lm.elements[8]=(l+o)/(l-o),this.cameraL.projectionMatrix.copy(Lm),o=-a*i.aspect-s,l=a*i.aspect-s,Lm.elements[0]=2*i.near/(l-o),Lm.elements[8]=(l+o)/(l-o),this.cameraR.projectionMatrix.copy(Lm)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(S4),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(_4)}}class kz{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=M4(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const i=M4();t=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=t}return t}}function M4(){return(typeof performance>"u"?Date:performance).now()}const Om=new pe,A4=new Fa,mle=new pe,zm=new pe;class gle extends ur{constructor(){super(),this.type="AudioListener",this.context=zz.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new kz}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const i=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Om,A4,mle),zm.set(0,0,-1).applyQuaternion(A4),i.positionX){const n=this.context.currentTime+this.timeDelta;i.positionX.linearRampToValueAtTime(Om.x,n),i.positionY.linearRampToValueAtTime(Om.y,n),i.positionZ.linearRampToValueAtTime(Om.z,n),i.forwardX.linearRampToValueAtTime(zm.x,n),i.forwardY.linearRampToValueAtTime(zm.y,n),i.forwardZ.linearRampToValueAtTime(zm.z,n),i.upX.linearRampToValueAtTime(r.x,n),i.upY.linearRampToValueAtTime(r.y,n),i.upZ.linearRampToValueAtTime(r.z,n)}else i.setPosition(Om.x,Om.y,Om.z),i.setOrientation(zm.x,zm.y,zm.z,r.x,r.y,r.z)}}class v7 extends ur{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+t;const i=this.context.createBufferSource();return i.buffer=this.buffer,i.loop=this.loop,i.loopStart=this.loopStart,i.loopEnd=this.loopEnd,i.onended=this.onEnded.bind(this),i.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=i,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,i=this.filters.length;t<i;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,i=this.filters.length;t<i;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),this._connected===!0?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=t,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=t,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const km=new pe,E4=new Fa,vle=new pe,Bm=new pe;class yle extends v7{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,i,r){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=i,this.panner.coneOuterGain=r,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(km,E4,vle),Bm.set(0,0,1).applyQuaternion(E4);const i=this.panner;if(i.positionX){const r=this.context.currentTime+this.listener.timeDelta;i.positionX.linearRampToValueAtTime(km.x,r),i.positionY.linearRampToValueAtTime(km.y,r),i.positionZ.linearRampToValueAtTime(km.z,r),i.orientationX.linearRampToValueAtTime(Bm.x,r),i.orientationY.linearRampToValueAtTime(Bm.y,r),i.orientationZ.linearRampToValueAtTime(Bm.z,r)}else i.setPosition(km.x,km.y,km.z),i.setOrientation(Bm.x,Bm.y,Bm.z)}}class xle{constructor(t,i=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=i,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const i=this.getFrequencyData();for(let r=0;r<i.length;r++)t+=i[r];return t/i.length}}class y7{constructor(t,i,r){this.binding=t,this.valueSize=r;let n,s,a;switch(i){case"quaternion":n=this._slerp,s=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(r*6),this._workIndex=5;break;case"string":case"bool":n=this._select,s=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(r*5);break;default:n=this._lerp,s=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(r*5)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=s,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,i){const r=this.buffer,n=this.valueSize,s=t*n+n;let a=this.cumulativeWeight;if(a===0){for(let o=0;o!==n;++o)r[s+o]=r[o];a=i}else{a+=i;const o=i/a;this._mixBufferRegion(r,s,0,o,n)}this.cumulativeWeight=a}accumulateAdditive(t){const i=this.buffer,r=this.valueSize,n=r*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(i,n,0,t,r),this.cumulativeWeightAdditive+=t}apply(t){const i=this.valueSize,r=this.buffer,n=t*i+i,s=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const l=i*this._origIndex;this._mixBufferRegion(r,n,l,1-s,i)}a>0&&this._mixBufferRegionAdditive(r,n,this._addIndex*i,1,i);for(let l=i,u=i+i;l!==u;++l)if(r[l]!==r[l+i]){o.setValue(r,n);break}}saveOriginalState(){const t=this.binding,i=this.buffer,r=this.valueSize,n=r*this._origIndex;t.getValue(i,n);for(let s=r,a=n;s!==a;++s)i[s]=i[n+s%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=this.valueSize*3;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,i=t+this.valueSize;for(let r=t;r<i;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,i=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[i+r]=this.buffer[t+r]}_select(t,i,r,n,s){if(n>=.5)for(let a=0;a!==s;++a)t[i+a]=t[r+a]}_slerp(t,i,r,n){Fa.slerpFlat(t,i,t,i,t,r,n)}_slerpAdditive(t,i,r,n,s){const a=this._workIndex*s;Fa.multiplyQuaternionsFlat(t,a,t,i,t,r),Fa.slerpFlat(t,i,t,i,t,a,n)}_lerp(t,i,r,n,s){const a=1-n;for(let o=0;o!==s;++o){const l=i+o;t[l]=t[l]*a+t[r+o]*n}}_lerpAdditive(t,i,r,n,s){for(let a=0;a!==s;++a){const o=i+a;t[o]=t[o]+t[r+a]*n}}}const Bz="\\[\\]\\.:\\/",wle=new RegExp("["+Bz+"]","g"),Nz="[^"+Bz+"]",ble="[^"+Bz.replace("\\.","")+"]",_le=/((?:WC+[\/:])*)/.source.replace("WC",Nz),Sle=/(WCOD+)?/.source.replace("WCOD",ble),Mle=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Nz),Ale=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Nz),Ele=new RegExp("^"+_le+Sle+Mle+Ale+"$"),Cle=["material","materials","bones","map"];class Tle{constructor(t,i,r){const n=r||lr.parseTrackName(i);this._targetGroup=t,this._bindings=t.subscribe_(i,n)}getValue(t,i){this.bind();const r=this._targetGroup.nCachedObjects_,n=this._bindings[r];n!==void 0&&n.getValue(t,i)}setValue(t,i){const r=this._bindings;for(let n=this._targetGroup.nCachedObjects_,s=r.length;n!==s;++n)r[n].setValue(t,i)}bind(){const t=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=t.length;i!==r;++i)t[i].bind()}unbind(){const t=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=t.length;i!==r;++i)t[i].unbind()}}class lr{constructor(t,i,r){this.path=i,this.parsedPath=r||lr.parseTrackName(i),this.node=lr.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,i,r){return t&&t.isAnimationObjectGroup?new lr.Composite(t,i,r):new lr(t,i,r)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(wle,"")}static parseTrackName(t){const i=Ele.exec(t);if(i===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const r={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(n!==void 0&&n!==-1){const s=r.nodeName.substring(n+1);Cle.indexOf(s)!==-1&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=s)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r}static findNode(t,i){if(i===void 0||i===""||i==="."||i===-1||i===t.name||i===t.uuid)return t;if(t.skeleton){const r=t.skeleton.getBoneByName(i);if(r!==void 0)return r}if(t.children){const r=function(s){for(let a=0;a<s.length;a++){const o=s[a];if(o.name===i||o.uuid===i)return o;const l=r(o.children);if(l)return l}return null},n=r(t.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,i){t[i]=this.targetObject[this.propertyName]}_getValue_array(t,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)t[i++]=r[n]}_getValue_arrayElement(t,i){t[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,i){this.resolvedProperty.toArray(t,i)}_setValue_direct(t,i){this.targetObject[this.propertyName]=t[i]}_setValue_direct_setNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)r[n]=t[i++]}_setValue_array_setNeedsUpdate(t,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)r[n]=t[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)r[n]=t[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,i){this.resolvedProperty[this.propertyIndex]=t[i]}_setValue_arrayElement_setNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,i){this.resolvedProperty.fromArray(t,i)}_setValue_fromArray_setNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,i){this.bind(),this.getValue(t,i)}_setValue_unbound(t,i){this.bind(),this.setValue(t,i)}bind(){let t=this.node;const i=this.parsedPath,r=i.objectName,n=i.propertyName;let s=i.propertyIndex;if(t||(t=lr.findNode(this.rootNode,i.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(r){let u=i.objectIndex;switch(r){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let c=0;c<t.length;c++)if(t[c].name===u){u=c;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}t=t.material.map;break;default:if(t[r]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[r]}if(u!==void 0){if(t[u]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[u]}}const a=t[n];if(a===void 0){const u=i.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+u+"."+n+" but it wasn't found.",t);return}let o=this.Versioning.None;this.targetObject=t,t.needsUpdate!==void 0?o=this.Versioning.NeedsUpdate:t.matrixWorldNeedsUpdate!==void 0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(s!==void 0){if(n==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[s]!==void 0&&(s=t.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=s}else a.fromArray!==void 0&&a.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=n;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}lr.Composite=Tle;lr.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};lr.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};lr.prototype.GetterByBindingType=[lr.prototype._getValue_direct,lr.prototype._getValue_array,lr.prototype._getValue_arrayElement,lr.prototype._getValue_toArray];lr.prototype.SetterByBindingTypeAndVersioning=[[lr.prototype._setValue_direct,lr.prototype._setValue_direct_setNeedsUpdate,lr.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[lr.prototype._setValue_array,lr.prototype._setValue_array_setNeedsUpdate,lr.prototype._setValue_array_setMatrixWorldNeedsUpdate],[lr.prototype._setValue_arrayElement,lr.prototype._setValue_arrayElement_setNeedsUpdate,lr.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[lr.prototype._setValue_fromArray,lr.prototype._setValue_fromArray_setNeedsUpdate,lr.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Ple{constructor(){this.isAnimationObjectGroup=!0,this.uuid=hl(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let r=0,n=arguments.length;r!==n;++r)t[arguments[r].uuid]=r;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}add(){const t=this._objects,i=this._indicesByUUID,r=this._paths,n=this._parsedPaths,s=this._bindings,a=s.length;let o,l=t.length,u=this.nCachedObjects_;for(let c=0,h=arguments.length;c!==h;++c){const d=arguments[c],p=d.uuid;let m=i[p];if(m===void 0){m=l++,i[p]=m,t.push(d);for(let v=0,g=a;v!==g;++v)s[v].push(new lr(d,r[v],n[v]))}else if(m<u){o=t[m];const v=--u,g=t[v];i[g.uuid]=m,t[m]=g,i[p]=v,t[v]=d;for(let w=0,S=a;w!==S;++w){const _=s[w],A=_[v];let C=_[m];_[m]=A,C===void 0&&(C=new lr(d,r[w],n[w])),_[v]=C}}else t[m]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=u}remove(){const t=this._objects,i=this._indicesByUUID,r=this._bindings,n=r.length;let s=this.nCachedObjects_;for(let a=0,o=arguments.length;a!==o;++a){const l=arguments[a],u=l.uuid,c=i[u];if(c!==void 0&&c>=s){const h=s++,d=t[h];i[d.uuid]=c,t[c]=d,i[u]=h,t[h]=l;for(let p=0,m=n;p!==m;++p){const v=r[p],g=v[h],w=v[c];v[c]=g,v[h]=w}}}this.nCachedObjects_=s}uncache(){const t=this._objects,i=this._indicesByUUID,r=this._bindings,n=r.length;let s=this.nCachedObjects_,a=t.length;for(let o=0,l=arguments.length;o!==l;++o){const u=arguments[o],c=u.uuid,h=i[c];if(h!==void 0)if(delete i[c],h<s){const d=--s,p=t[d],m=--a,v=t[m];i[p.uuid]=h,t[h]=p,i[v.uuid]=d,t[d]=v,t.pop();for(let g=0,w=n;g!==w;++g){const S=r[g],_=S[d],A=S[m];S[h]=_,S[d]=A,S.pop()}}else{const d=--a,p=t[d];d>0&&(i[p.uuid]=h),t[h]=p,t.pop();for(let m=0,v=n;m!==v;++m){const g=r[m];g[h]=g[d],g.pop()}}}this.nCachedObjects_=s}subscribe_(t,i){const r=this._bindingsIndicesByPath;let n=r[t];const s=this._bindings;if(n!==void 0)return s[n];const a=this._paths,o=this._parsedPaths,l=this._objects,u=l.length,c=this.nCachedObjects_,h=new Array(u);n=s.length,r[t]=n,a.push(t),o.push(i),s.push(h);for(let d=c,p=l.length;d!==p;++d){const m=l[d];h[d]=new lr(m,t,i)}return h}unsubscribe_(t){const i=this._bindingsIndicesByPath,r=i[t];if(r!==void 0){const n=this._paths,s=this._parsedPaths,a=this._bindings,o=a.length-1,l=a[o],u=t[o];i[u]=r,a[r]=l,a.pop(),s[r]=s[o],s.pop(),n[r]=n[o],n.pop()}}}class Dle{constructor(t,i,r=null,n=i.blendMode){this._mixer=t,this._clip=i,this._localRoot=r,this.blendMode=n;const s=i.tracks,a=s.length,o=new Array(a),l={endingStart:cg,endingEnd:cg};for(let u=0;u!==a;++u){const c=s[u].createInterpolant(null);o[u]=c,c.settings=l}this._interpolantSettings=l,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=c9,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,i){return this.loop=t,this.repetitions=i,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,i,r){if(t.fadeOut(i),this.fadeIn(i),r){const n=this._clip.duration,s=t._clip.duration,a=s/n,o=n/s;t.warp(1,a,i),this.warp(o,1,i)}return this}crossFadeTo(t,i,r){return t.crossFadeFrom(this,i,r)}stopFading(){const t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,i,r){const n=this._mixer,s=n.time,a=this.timeScale;let o=this._timeScaleInterpolant;o===null&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);const l=o.parameterPositions,u=o.sampleValues;return l[0]=s,l[1]=s+r,u[0]=t/a,u[1]=i/a,this}stopWarping(){const t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,i,r,n){if(!this.enabled){this._updateWeight(t);return}const s=this._startTime;if(s!==null){const l=(t-s)*r;l<0||r===0?i=0:(this._startTime=null,i=r*l)}i*=this._updateTimeScale(t);const a=this._updateTime(i),o=this._updateWeight(t);if(o>0){const l=this._interpolants,u=this._propertyBindings;switch(this.blendMode){case az:for(let c=0,h=l.length;c!==h;++c)l[c].evaluate(a),u[c].accumulateAdditive(o);break;case EC:default:for(let c=0,h=l.length;c!==h;++c)l[c].evaluate(a),u[c].accumulate(n,o)}}}_updateWeight(t){let i=0;if(this.enabled){i=this.weight;const r=this._weightInterpolant;if(r!==null){const n=r.evaluate(t)[0];i*=n,t>r.parameterPositions[1]&&(this.stopFading(),n===0&&(this.enabled=!1))}}return this._effectiveWeight=i,i}_updateTimeScale(t){let i=0;if(!this.paused){i=this.timeScale;const r=this._timeScaleInterpolant;if(r!==null){const n=r.evaluate(t)[0];i*=n,t>r.parameterPositions[1]&&(this.stopWarping(),i===0?this.paused=!0:this.timeScale=i)}}return this._effectiveTimeScale=i,i}_updateTime(t){const i=this._clip.duration,r=this.loop;let n=this.time+t,s=this._loopCount;const a=r===h9;if(t===0)return s===-1?n:a&&(s&1)===1?i-n:n;if(r===u9){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=i)n=i;else if(n<0)n=0;else{this.time=n;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(s===-1&&(t>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),n>=i||n<0){const o=Math.floor(n/i);n-=i*o,s+=Math.abs(o);const l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=t>0?i:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(l===1){const u=t<0;this._setEndings(u,!u,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=n;if(a&&(s&1)===1)return i-n}return n}_setEndings(t,i,r){const n=this._interpolantSettings;r?(n.endingStart=hg,n.endingEnd=hg):(t?n.endingStart=this.zeroSlopeAtStart?hg:cg:n.endingStart=Db,i?n.endingEnd=this.zeroSlopeAtEnd?hg:cg:n.endingEnd=Db)}_scheduleFading(t,i,r){const n=this._mixer,s=n.time;let a=this._weightInterpolant;a===null&&(a=n._lendControlInterpolant(),this._weightInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=s,l[0]=i,o[1]=s+t,l[1]=r,this}}const Rle=new Float32Array(1);class Ile extends Fd{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,i){const r=t._localRoot||this._root,n=t._clip.tracks,s=n.length,a=t._propertyBindings,o=t._interpolants,l=r.uuid,u=this._bindingsByRootAndName;let c=u[l];c===void 0&&(c={},u[l]=c);for(let h=0;h!==s;++h){const d=n[h],p=d.name;let m=c[p];if(m!==void 0)++m.referenceCount,a[h]=m;else{if(m=a[h],m!==void 0){m._cacheIndex===null&&(++m.referenceCount,this._addInactiveBinding(m,l,p));continue}const v=i&&i._propertyBindings[h].binding.parsedPath;m=new y7(lr.create(r,p,v),d.ValueTypeName,d.getValueSize()),++m.referenceCount,this._addInactiveBinding(m,l,p),a[h]=m}o[h].resultBuffer=m.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(t._cacheIndex===null){const r=(t._localRoot||this._root).uuid,n=t._clip.uuid,s=this._actionsByClip[n];this._bindAction(t,s&&s.knownActions[0]),this._addInactiveAction(t,n,r)}const i=t._propertyBindings;for(let r=0,n=i.length;r!==n;++r){const s=i[r];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const i=t._propertyBindings;for(let r=0,n=i.length;r!==n;++r){const s=i[r];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const i=t._cacheIndex;return i!==null&&i<this._nActiveActions}_addInactiveAction(t,i,r){const n=this._actions,s=this._actionsByClip;let a=s[i];if(a===void 0)a={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,s[i]=a;else{const o=a.knownActions;t._byClipCacheIndex=o.length,o.push(t)}t._cacheIndex=n.length,n.push(t),a.actionByRoot[r]=t}_removeInactiveAction(t){const i=this._actions,r=i[i.length-1],n=t._cacheIndex;r._cacheIndex=n,i[n]=r,i.pop(),t._cacheIndex=null;const s=t._clip.uuid,a=this._actionsByClip,o=a[s],l=o.knownActions,u=l[l.length-1],c=t._byClipCacheIndex;u._byClipCacheIndex=c,l[c]=u,l.pop(),t._byClipCacheIndex=null;const h=o.actionByRoot,d=(t._localRoot||this._root).uuid;delete h[d],l.length===0&&delete a[s],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const i=t._propertyBindings;for(let r=0,n=i.length;r!==n;++r){const s=i[r];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(t){const i=this._actions,r=t._cacheIndex,n=this._nActiveActions++,s=i[n];t._cacheIndex=n,i[n]=t,s._cacheIndex=r,i[r]=s}_takeBackAction(t){const i=this._actions,r=t._cacheIndex,n=--this._nActiveActions,s=i[n];t._cacheIndex=n,i[n]=t,s._cacheIndex=r,i[r]=s}_addInactiveBinding(t,i,r){const n=this._bindingsByRootAndName,s=this._bindings;let a=n[i];a===void 0&&(a={},n[i]=a),a[r]=t,t._cacheIndex=s.length,s.push(t)}_removeInactiveBinding(t){const i=this._bindings,r=t.binding,n=r.rootNode.uuid,s=r.path,a=this._bindingsByRootAndName,o=a[n],l=i[i.length-1],u=t._cacheIndex;l._cacheIndex=u,i[u]=l,i.pop(),delete o[s],Object.keys(o).length===0&&delete a[n]}_lendBinding(t){const i=this._bindings,r=t._cacheIndex,n=this._nActiveBindings++,s=i[n];t._cacheIndex=n,i[n]=t,s._cacheIndex=r,i[r]=s}_takeBackBinding(t){const i=this._bindings,r=t._cacheIndex,n=--this._nActiveBindings,s=i[n];t._cacheIndex=n,i[n]=t,s._cacheIndex=r,i[r]=s}_lendControlInterpolant(){const t=this._controlInterpolants,i=this._nActiveControlInterpolants++;let r=t[i];return r===void 0&&(r=new Rz(new Float32Array(2),new Float32Array(2),1,Rle),r.__cacheIndex=i,t[i]=r),r}_takeBackControlInterpolant(t){const i=this._controlInterpolants,r=t.__cacheIndex,n=--this._nActiveControlInterpolants,s=i[n];t.__cacheIndex=n,i[n]=t,s.__cacheIndex=r,i[r]=s}clipAction(t,i,r){const n=i||this._root,s=n.uuid;let a=typeof t=="string"?Ub.findByName(n,t):t;const o=a!==null?a.uuid:t,l=this._actionsByClip[o];let u=null;if(r===void 0&&(a!==null?r=a.blendMode:r=EC),l!==void 0){const h=l.actionByRoot[s];if(h!==void 0&&h.blendMode===r)return h;u=l.knownActions[0],a===null&&(a=u._clip)}if(a===null)return null;const c=new Dle(this,a,i,r);return this._bindAction(c,u),this._addInactiveAction(c,o,s),c}existingAction(t,i){const r=i||this._root,n=r.uuid,s=typeof t=="string"?Ub.findByName(r,t):t,a=s?s.uuid:t,o=this._actionsByClip[a];return o!==void 0&&o.actionByRoot[n]||null}stopAllAction(){const t=this._actions,i=this._nActiveActions;for(let r=i-1;r>=0;--r)t[r].stop();return this}update(t){t*=this.timeScale;const i=this._actions,r=this._nActiveActions,n=this.time+=t,s=Math.sign(t),a=this._accuIndex^=1;for(let u=0;u!==r;++u)i[u]._update(n,t,s,a);const o=this._bindings,l=this._nActiveBindings;for(let u=0;u!==l;++u)o[u].apply(a);return this}setTime(t){this.time=0;for(let i=0;i<this._actions.length;i++)this._actions[i].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const i=this._actions,r=t.uuid,n=this._actionsByClip,s=n[r];if(s!==void 0){const a=s.knownActions;for(let o=0,l=a.length;o!==l;++o){const u=a[o];this._deactivateAction(u);const c=u._cacheIndex,h=i[i.length-1];u._cacheIndex=null,u._byClipCacheIndex=null,h._cacheIndex=c,i[c]=h,i.pop(),this._removeInactiveBindingsForAction(u)}delete n[r]}}uncacheRoot(t){const i=t.uuid,r=this._actionsByClip;for(const a in r){const o=r[a].actionByRoot,l=o[i];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const n=this._bindingsByRootAndName,s=n[i];if(s!==void 0)for(const a in s){const o=s[a];o.restoreOriginalState(),this._removeInactiveBinding(o)}}uncacheAction(t,i){const r=this.existingAction(t,i);r!==null&&(this._deactivateAction(r),this._removeInactiveAction(r))}}class Fz{constructor(t){this.value=t}clone(){return new Fz(this.value.clone===void 0?this.value:this.value.clone())}}let Lle=0;class Ole extends Fd{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Lle++}),this.name="",this.usage=Rb,this.uniforms=[]}add(t){return this.uniforms.push(t),this}remove(t){const i=this.uniforms.indexOf(t);return i!==-1&&this.uniforms.splice(i,1),this}setName(t){return this.name=t,this}setUsage(t){return this.usage=t,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(t){this.name=t.name,this.usage=t.usage;const i=t.uniforms;this.uniforms.length=0;for(let r=0,n=i.length;r<n;r++)this.uniforms.push(i[r].clone());return this}clone(){return new this.constructor().copy(this)}}class zle extends LC{constructor(t,i,r=1){super(t,i),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=r}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const i=super.clone(t);return i.meshPerAttribute=this.meshPerAttribute,i}toJSON(t){const i=super.toJSON(t);return i.isInstancedInterleavedBuffer=!0,i.meshPerAttribute=this.meshPerAttribute,i}}class kle{constructor(t,i,r,n,s){this.isGLBufferAttribute=!0,this.name="",this.buffer=t,this.type=i,this.itemSize=r,this.elementSize=n,this.count=s,this.version=0}set needsUpdate(t){t===!0&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,i){return this.type=t,this.elementSize=i,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}}class x7{constructor(t,i,r=0,n=1/0){this.ray=new Cx(t,i),this.near=r,this.far=n,this.camera=null,this.layers=new Cg,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,i){this.ray.set(t,i)}setFromCamera(t,i){i.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(i.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(i).sub(this.ray.origin).normalize(),this.camera=i):i.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(i.near+i.far)/(i.near-i.far)).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld),this.camera=i):console.error("THREE.Raycaster: Unsupported camera type: "+i.type)}intersectObject(t,i=!0,r=[]){return gI(t,this,r,i),r.sort(C4),r}intersectObjects(t,i=!0,r=[]){for(let n=0,s=t.length;n<s;n++)gI(t[n],this,r,i);return r.sort(C4),r}}function C4(e,t){return e.distance-t.distance}function gI(e,t,i,r){if(e.layers.test(t.layers)&&e.raycast(t,i),r===!0){const n=e.children;for(let s=0,a=n.length;s<a;s++)gI(n[s],t,i,!0)}}class vI{constructor(t=1,i=0,r=0){return this.radius=t,this.phi=i,this.theta=r,this}set(t,i,r){return this.radius=t,this.phi=i,this.theta=r,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,i,r){return this.radius=Math.sqrt(t*t+i*i+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,r),this.phi=Math.acos(zn(i/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Ble{constructor(t=1,i=0,r=0){return this.radius=t,this.theta=i,this.y=r,this}set(t,i,r){return this.radius=t,this.theta=i,this.y=r,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,i,r){return this.radius=Math.sqrt(t*t+r*r),this.theta=Math.atan2(t,r),this.y=i,this}clone(){return new this.constructor().copy(this)}}const T4=new ft;class Nle{constructor(t=new ft(1/0,1/0),i=new ft(-1/0,-1/0)){this.isBox2=!0,this.min=t,this.max=i}set(t,i){return this.min.copy(t),this.max.copy(i),this}setFromPoints(t){this.makeEmpty();for(let i=0,r=t.length;i<r;i++)this.expandByPoint(t[i]);return this}setFromCenterAndSize(t,i){const r=T4.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,i){return i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,i){return i.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,T4).distanceTo(t)}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const P4=new pe,zM=new pe;class Fle{constructor(t=new pe,i=new pe){this.start=t,this.end=i}set(t,i){return this.start.copy(t),this.end.copy(i),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,i){return this.delta(i).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,i){P4.subVectors(t,this.start),zM.subVectors(this.end,this.start);const r=zM.dot(zM);let s=zM.dot(P4)/r;return i&&(s=zn(s,0,1)),s}closestPointToPoint(t,i,r){const n=this.closestPointToPointParameter(t,i);return this.delta(r).multiplyScalar(n).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const D4=new pe;class Ule extends ur{constructor(t,i){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="SpotLightHelper";const r=new Fi,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,o=1,l=32;a<l;a++,o++){const u=a/l*Math.PI*2,c=o/l*Math.PI*2;n.push(Math.cos(u),Math.sin(u),1,Math.cos(c),Math.sin(c),1)}r.setAttribute("position",new Jt(n,3));const s=new ho({fog:!1,toneMapped:!1});this.cone=new ih(r,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const t=this.light.distance?this.light.distance:1e3,i=t*Math.tan(this.light.angle);this.cone.scale.set(i,i,t),D4.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(D4),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const If=new pe,kM=new Oi,NP=new Oi;class Vle extends ih{constructor(t){const i=w7(t),r=new Fi,n=[],s=[],a=new qt(0,0,1),o=new qt(0,1,0);for(let u=0;u<i.length;u++){const c=i[u];c.parent&&c.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),s.push(a.r,a.g,a.b),s.push(o.r,o.g,o.b))}r.setAttribute("position",new Jt(n,3)),r.setAttribute("color",new Jt(s,3));const l=new ho({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(r,l),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=t,this.bones=i,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const i=this.bones,r=this.geometry,n=r.getAttribute("position");NP.copy(this.root.matrixWorld).invert();for(let s=0,a=0;s<i.length;s++){const o=i[s];o.parent&&o.parent.isBone&&(kM.multiplyMatrices(NP,o.matrixWorld),If.setFromMatrixPosition(kM),n.setXYZ(a,If.x,If.y,If.z),kM.multiplyMatrices(NP,o.parent.matrixWorld),If.setFromMatrixPosition(kM),n.setXYZ(a+1,If.x,If.y,If.z),a+=2)}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose()}}function w7(e){const t=[];e.isBone===!0&&t.push(e);for(let i=0;i<e.children.length;i++)t.push.apply(t,w7(e.children[i]));return t}class jle extends js{constructor(t,i,r){const n=new Ix(i,4,2),s=new Up({wireframe:!0,fog:!1,toneMapped:!1});super(n,s),this.light=t,this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Hle=new pe,R4=new qt,I4=new qt;class Wle extends ur{constructor(t,i,r){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="HemisphereLightHelper";const n=new Rx(i);n.rotateY(Math.PI*.5),this.material=new Up({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=n.getAttribute("position"),a=new Float32Array(s.count*3);n.setAttribute("color",new kr(a,3)),this.add(new js(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const i=t.geometry.getAttribute("color");R4.copy(this.light.color),I4.copy(this.light.groundColor);for(let r=0,n=i.count;r<n;r++){const s=r<n/2?R4:I4;i.setXYZ(r,s.r,s.g,s.b)}i.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),t.lookAt(Hle.setFromMatrixPosition(this.light.matrixWorld).negate())}}class Gle extends ih{constructor(t=10,i=10,r=4473924,n=8947848){r=new qt(r),n=new qt(n);const s=i/2,a=t/i,o=t/2,l=[],u=[];for(let d=0,p=0,m=-o;d<=i;d++,m+=a){l.push(-o,0,m,o,0,m),l.push(m,0,-o,m,0,o);const v=d===s?r:n;v.toArray(u,p),p+=3,v.toArray(u,p),p+=3,v.toArray(u,p),p+=3,v.toArray(u,p),p+=3}const c=new Fi;c.setAttribute("position",new Jt(l,3)),c.setAttribute("color",new Jt(u,3));const h=new ho({vertexColors:!0,toneMapped:!1});super(c,h),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class qle extends ih{constructor(t=10,i=16,r=8,n=64,s=4473924,a=8947848){s=new qt(s),a=new qt(a);const o=[],l=[];if(i>1)for(let h=0;h<i;h++){const d=h/i*(Math.PI*2),p=Math.sin(d)*t,m=Math.cos(d)*t;o.push(0,0,0),o.push(p,0,m);const v=h&1?s:a;l.push(v.r,v.g,v.b),l.push(v.r,v.g,v.b)}for(let h=0;h<r;h++){const d=h&1?s:a,p=t-t/r*h;for(let m=0;m<n;m++){let v=m/n*(Math.PI*2),g=Math.sin(v)*p,w=Math.cos(v)*p;o.push(g,0,w),l.push(d.r,d.g,d.b),v=(m+1)/n*(Math.PI*2),g=Math.sin(v)*p,w=Math.cos(v)*p,o.push(g,0,w),l.push(d.r,d.g,d.b)}}const u=new Fi;u.setAttribute("position",new Jt(o,3)),u.setAttribute("color",new Jt(l,3));const c=new ho({vertexColors:!0,toneMapped:!1});super(u,c),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const L4=new pe,BM=new pe,O4=new pe;class Xle extends ur{constructor(t,i,r){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="DirectionalLightHelper",i===void 0&&(i=1);let n=new Fi;n.setAttribute("position",new Jt([-i,i,0,i,i,0,i,-i,0,-i,-i,0,-i,i,0],3));const s=new ho({fog:!1,toneMapped:!1});this.lightPlane=new Rp(n,s),this.add(this.lightPlane),n=new Fi,n.setAttribute("position",new Jt([0,0,0,0,0,1],3)),this.targetLine=new Rp(n,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),L4.setFromMatrixPosition(this.light.matrixWorld),BM.setFromMatrixPosition(this.light.target.matrixWorld),O4.subVectors(BM,L4),this.lightPlane.lookAt(BM),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(BM),this.targetLine.scale.z=O4.length()}}const NM=new pe,pn=new b_;class Yle extends ih{constructor(t){const i=new Fi,r=new ho({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],s=[],a={};o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4");function o(m,v){l(m),l(v)}function l(m){n.push(0,0,0),s.push(0,0,0),a[m]===void 0&&(a[m]=[]),a[m].push(n.length/3-1)}i.setAttribute("position",new Jt(n,3)),i.setAttribute("color",new Jt(s,3)),super(i,r),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const u=new qt(16755200),c=new qt(16711680),h=new qt(43775),d=new qt(16777215),p=new qt(3355443);this.setColors(u,c,h,d,p)}setColors(t,i,r,n,s){const o=this.geometry.getAttribute("color");o.setXYZ(0,t.r,t.g,t.b),o.setXYZ(1,t.r,t.g,t.b),o.setXYZ(2,t.r,t.g,t.b),o.setXYZ(3,t.r,t.g,t.b),o.setXYZ(4,t.r,t.g,t.b),o.setXYZ(5,t.r,t.g,t.b),o.setXYZ(6,t.r,t.g,t.b),o.setXYZ(7,t.r,t.g,t.b),o.setXYZ(8,t.r,t.g,t.b),o.setXYZ(9,t.r,t.g,t.b),o.setXYZ(10,t.r,t.g,t.b),o.setXYZ(11,t.r,t.g,t.b),o.setXYZ(12,t.r,t.g,t.b),o.setXYZ(13,t.r,t.g,t.b),o.setXYZ(14,t.r,t.g,t.b),o.setXYZ(15,t.r,t.g,t.b),o.setXYZ(16,t.r,t.g,t.b),o.setXYZ(17,t.r,t.g,t.b),o.setXYZ(18,t.r,t.g,t.b),o.setXYZ(19,t.r,t.g,t.b),o.setXYZ(20,t.r,t.g,t.b),o.setXYZ(21,t.r,t.g,t.b),o.setXYZ(22,t.r,t.g,t.b),o.setXYZ(23,t.r,t.g,t.b),o.setXYZ(24,i.r,i.g,i.b),o.setXYZ(25,i.r,i.g,i.b),o.setXYZ(26,i.r,i.g,i.b),o.setXYZ(27,i.r,i.g,i.b),o.setXYZ(28,i.r,i.g,i.b),o.setXYZ(29,i.r,i.g,i.b),o.setXYZ(30,i.r,i.g,i.b),o.setXYZ(31,i.r,i.g,i.b),o.setXYZ(32,r.r,r.g,r.b),o.setXYZ(33,r.r,r.g,r.b),o.setXYZ(34,r.r,r.g,r.b),o.setXYZ(35,r.r,r.g,r.b),o.setXYZ(36,r.r,r.g,r.b),o.setXYZ(37,r.r,r.g,r.b),o.setXYZ(38,n.r,n.g,n.b),o.setXYZ(39,n.r,n.g,n.b),o.setXYZ(40,s.r,s.g,s.b),o.setXYZ(41,s.r,s.g,s.b),o.setXYZ(42,s.r,s.g,s.b),o.setXYZ(43,s.r,s.g,s.b),o.setXYZ(44,s.r,s.g,s.b),o.setXYZ(45,s.r,s.g,s.b),o.setXYZ(46,s.r,s.g,s.b),o.setXYZ(47,s.r,s.g,s.b),o.setXYZ(48,s.r,s.g,s.b),o.setXYZ(49,s.r,s.g,s.b),o.needsUpdate=!0}update(){const t=this.geometry,i=this.pointMap,r=1,n=1;pn.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Pn("c",i,t,pn,0,0,-1),Pn("t",i,t,pn,0,0,1),Pn("n1",i,t,pn,-r,-n,-1),Pn("n2",i,t,pn,r,-n,-1),Pn("n3",i,t,pn,-r,n,-1),Pn("n4",i,t,pn,r,n,-1),Pn("f1",i,t,pn,-r,-n,1),Pn("f2",i,t,pn,r,-n,1),Pn("f3",i,t,pn,-r,n,1),Pn("f4",i,t,pn,r,n,1),Pn("u1",i,t,pn,r*.7,n*1.1,-1),Pn("u2",i,t,pn,-r*.7,n*1.1,-1),Pn("u3",i,t,pn,0,n*2,-1),Pn("cf1",i,t,pn,-r,0,1),Pn("cf2",i,t,pn,r,0,1),Pn("cf3",i,t,pn,0,-n,1),Pn("cf4",i,t,pn,0,n,1),Pn("cn1",i,t,pn,-r,0,-1),Pn("cn2",i,t,pn,r,0,-1),Pn("cn3",i,t,pn,0,-n,-1),Pn("cn4",i,t,pn,0,n,-1),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Pn(e,t,i,r,n,s,a){NM.set(n,s,a).unproject(r);const o=t[e];if(o!==void 0){const l=i.getAttribute("position");for(let u=0,c=o.length;u<c;u++)l.setXYZ(o[u],NM.x,NM.y,NM.z)}}const FM=new ev;class Qle extends ih{constructor(t,i=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),s=new Fi;s.setIndex(new kr(r,1)),s.setAttribute("position",new kr(n,3)),super(s,new ho({color:i,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(t!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&FM.setFromObject(this.object),FM.isEmpty())return;const i=FM.min,r=FM.max,n=this.geometry.attributes.position,s=n.array;s[0]=r.x,s[1]=r.y,s[2]=r.z,s[3]=i.x,s[4]=r.y,s[5]=r.z,s[6]=i.x,s[7]=i.y,s[8]=r.z,s[9]=r.x,s[10]=i.y,s[11]=r.z,s[12]=r.x,s[13]=r.y,s[14]=i.z,s[15]=i.x,s[16]=r.y,s[17]=i.z,s[18]=i.x,s[19]=i.y,s[20]=i.z,s[21]=r.x,s[22]=i.y,s[23]=i.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t,i){return super.copy(t,i),this.object=t.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Kle extends ih{constructor(t,i=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new Fi;s.setIndex(new kr(r,1)),s.setAttribute("position",new Jt(n,3)),super(s,new ho({color:i,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const i=this.box;i.isEmpty()||(i.getCenter(this.position),i.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}dispose(){this.geometry.dispose(),this.material.dispose()}}class Zle extends Rp{constructor(t,i=1,r=16776960){const n=r,s=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],a=new Fi;a.setAttribute("position",new Jt(s,3)),a.computeBoundingSphere(),super(a,new ho({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=i;const o=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new Fi;l.setAttribute("position",new Jt(o,3)),l.computeBoundingSphere(),this.add(new js(l,new Up({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const z4=new pe;let UM,FP;class Jle extends ur{constructor(t=new pe(0,0,1),i=new pe(0,0,0),r=1,n=16776960,s=r*.2,a=s*.2){super(),this.type="ArrowHelper",UM===void 0&&(UM=new Fi,UM.setAttribute("position",new Jt([0,0,0,0,1,0],3)),FP=new rv(0,.5,1,5,1),FP.translate(0,-.5,0)),this.position.copy(i),this.line=new Rp(UM,new ho({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new js(FP,new Up({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(r,s,a)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{z4.set(t.z,0,-t.x).normalize();const i=Math.acos(t.y);this.quaternion.setFromAxisAngle(z4,i)}}setLength(t,i=t*.2,r=i*.2){this.line.scale.set(1,Math.max(1e-4,t-i),1),this.line.updateMatrix(),this.cone.scale.set(r,i,r),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class $le extends ih{constructor(t=1){const i=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],r=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],n=new Fi;n.setAttribute("position",new Jt(i,3)),n.setAttribute("color",new Jt(r,3));const s=new ho({vertexColors:!0,toneMapped:!1});super(n,s),this.type="AxesHelper"}setColors(t,i,r){const n=new qt,s=this.geometry.attributes.color.array;return n.set(t),n.toArray(s,0),n.toArray(s,3),n.set(i),n.toArray(s,6),n.toArray(s,9),n.set(r),n.toArray(s,12),n.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class eue{constructor(){this.type="ShapePath",this.color=new qt,this.subPaths=[],this.currentPath=null}moveTo(t,i){return this.currentPath=new Ob,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,i),this}lineTo(t,i){return this.currentPath.lineTo(t,i),this}quadraticCurveTo(t,i,r,n){return this.currentPath.quadraticCurveTo(t,i,r,n),this}bezierCurveTo(t,i,r,n,s,a){return this.currentPath.bezierCurveTo(t,i,r,n,s,a),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t){function i(w){const S=[];for(let _=0,A=w.length;_<A;_++){const C=w[_],E=new Tg;E.curves=C.curves,S.push(E)}return S}function r(w,S){const _=S.length;let A=!1;for(let C=_-1,E=0;E<_;C=E++){let I=S[C],T=S[E],D=T.x-I.x,L=T.y-I.y;if(Math.abs(L)>Number.EPSILON){if(L<0&&(I=S[E],D=-D,T=S[C],L=-L),w.y<I.y||w.y>T.y)continue;if(w.y===I.y){if(w.x===I.x)return!0}else{const z=L*(w.x-I.x)-D*(w.y-I.y);if(z===0)return!0;if(z<0)continue;A=!A}}else{if(w.y!==I.y)continue;if(T.x<=w.x&&w.x<=I.x||I.x<=w.x&&w.x<=T.x)return!0}}return A}const n=Hc.isClockWise,s=this.subPaths;if(s.length===0)return[];let a,o,l;const u=[];if(s.length===1)return o=s[0],l=new Tg,l.curves=o.curves,u.push(l),u;let c=!n(s[0].getPoints());c=t?!c:c;const h=[],d=[];let p=[],m=0,v;d[m]=void 0,p[m]=[];for(let w=0,S=s.length;w<S;w++)o=s[w],v=o.getPoints(),a=n(v),a=t?!a:a,a?(!c&&d[m]&&m++,d[m]={s:new Tg,p:v},d[m].s.curves=o.curves,c&&m++,p[m]=[]):p[m].push({h:o,p:v[0]});if(!d[0])return i(s);if(d.length>1){let w=!1,S=0;for(let _=0,A=d.length;_<A;_++)h[_]=[];for(let _=0,A=d.length;_<A;_++){const C=p[_];for(let E=0;E<C.length;E++){const I=C[E];let T=!0;for(let D=0;D<d.length;D++)r(I.p,d[D].p)&&(_!==D&&S++,T?(T=!1,h[D].push(I)):w=!0);T&&h[_].push(I)}}S>0&&w===!1&&(p=h)}let g;for(let w=0,S=d.length;w<S;w++){l=d[w].s,u.push(l),g=p[w];for(let _=0,A=g.length;_<A;_++)l.holes.push(g[_].h)}return u}}const cd=tue();function tue(){const e=new ArrayBuffer(4),t=new Float32Array(e),i=new Uint32Array(e),r=new Uint32Array(512),n=new Uint32Array(512);for(let l=0;l<256;++l){const u=l-127;u<-27?(r[l]=0,r[l|256]=32768,n[l]=24,n[l|256]=24):u<-14?(r[l]=1024>>-u-14,r[l|256]=1024>>-u-14|32768,n[l]=-u-1,n[l|256]=-u-1):u<=15?(r[l]=u+15<<10,r[l|256]=u+15<<10|32768,n[l]=13,n[l|256]=13):u<128?(r[l]=31744,r[l|256]=64512,n[l]=24,n[l|256]=24):(r[l]=31744,r[l|256]=64512,n[l]=13,n[l|256]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let u=l<<13,c=0;for(;(u&8388608)===0;)u<<=1,c-=8388608;u&=-8388609,c+=947912704,s[l]=u|c}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:t,uint32View:i,baseTable:r,shiftTable:n,mantissaTable:s,exponentTable:a,offsetTable:o}}function iue(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=zn(e,-65504,65504),cd.floatView[0]=e;const t=cd.uint32View[0],i=t>>23&511;return cd.baseTable[i]+((t&8388607)>>cd.shiftTable[i])}function rue(e){const t=e>>10;return cd.uint32View[0]=cd.mantissaTable[cd.offsetTable[t]+(e&1023)]+cd.exponentTable[t],cd.floatView[0]}const nue={toHalfFloat:iue,fromHalfFloat:rue};class sue extends Vp{constructor(t,i,r,n,s,a){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(t,i,r,n,s,a)}}class aue extends S_{constructor(t,i,r,n){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(t,i,r,n)}}class oue extends M_{constructor(t,i,r,n){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(t,i,r,n)}}class lue extends A_{constructor(t,i,r,n,s,a,o){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(t,i,r,n,s,a,o)}}class uue extends rv{constructor(t,i,r,n,s,a,o,l){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(t,i,r,n,s,a,o,l)}}class cue extends E_{constructor(t,i){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(t,i)}}class hue extends C_{constructor(t,i){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(t,i)}}class due extends T_{constructor(t,i){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(t,i)}}class fue extends Dx{constructor(t,i,r,n){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(t,i,r,n)}}class pue extends Rx{constructor(t,i){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(t,i)}}class mue extends Tx{constructor(t,i,r,n){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(t,i,r,n)}}class gue extends Ud{constructor(t,i,r,n){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(t,i,r,n)}}class vue extends P_{constructor(t,i,r,n,s,a){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(t,i,r,n,s,a)}}class yue extends D_{constructor(t,i){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(t,i)}}class xue extends Ix{constructor(t,i,r,n,s,a,o){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(t,i,r,n,s,a,o)}}class wue extends R_{constructor(t,i){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(t,i)}}class bue extends I_{constructor(t,i,r,n,s){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(t,i,r,n,s)}}class _ue extends L_{constructor(t,i,r,n,s,a){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(t,i,r,n,s,a)}}class Sue extends O_{constructor(t,i,r,n,s){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(t,i,r,n,s)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:SC}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=SC);const Mue=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:rz,AddEquation:tg,AddOperation:H8,AdditiveAnimationBlendMode:az,AdditiveBlending:LR,AlphaFormat:$8,AlwaysDepth:k8,AlwaysStencilFunc:m9,AmbientLight:d7,AmbientLightProbe:fle,AnimationClip:Ub,AnimationLoader:tle,AnimationMixer:Ile,AnimationObjectGroup:Ple,AnimationUtils:Zoe,ArcCurve:F9,ArrayCamera:P9,ArrowHelper:Jle,Audio:v7,AudioAnalyser:xle,AudioContext:zz,AudioListener:gle,AudioLoader:hle,AxesHelper:$le,BackSide:jo,BasicDepthPacking:d9,BasicShadowMap:_8,Bone:xz,BooleanKeyframeTrack:nv,Box2:Nle,Box3:ev,Box3Helper:Kle,BoxBufferGeometry:sue,BoxGeometry:Vp,BoxHelper:Qle,BufferAttribute:kr,BufferGeometry:Fi,BufferGeometryLoader:g7,ByteType:Y8,Cache:Vg,Camera:b_,CameraHelper:Yle,CanvasTexture:boe,CapsuleBufferGeometry:aue,CapsuleGeometry:S_,CatmullRomCurve3:U9,CineonToneMapping:q8,CircleBufferGeometry:oue,CircleGeometry:M_,ClampToEdgeWrapping:Oa,Clock:kz,Color:qt,ColorKeyframeTrack:Iz,ColorManagement:Ia,CompressedArrayTexture:woe,CompressedTexture:bz,CompressedTextureLoader:ile,ConeBufferGeometry:lue,ConeGeometry:A_,CubeCamera:fz,CubeReflectionMapping:Cp,CubeRefractionMapping:Tp,CubeTexture:__,CubeTextureLoader:rle,CubeUVReflectionMapping:Ex,CubicBezierCurve:Sz,CubicBezierCurve3:V9,CubicInterpolant:s7,CullFaceBack:IR,CullFaceFront:b8,CullFaceFrontBack:vte,CullFaceNone:w8,Curve:Gu,CurvePath:H9,CustomBlending:S8,CustomToneMapping:X8,CylinderBufferGeometry:uue,CylinderGeometry:rv,Cylindrical:Ble,Data3DTexture:cz,DataArrayTexture:CC,DataTexture:Uy,DataTextureLoader:nle,DataUtils:nue,DecrementStencilOp:Dte,DecrementWrapStencilOp:Ite,DefaultLoadingManager:Ay,DepthFormat:wp,DepthStencilFormat:Ng,DepthTexture:D9,DirectionalLight:h7,DirectionalLightHelper:Xle,DiscreteInterpolant:a7,DisplayP3ColorSpace:oz,DodecahedronBufferGeometry:cue,DodecahedronGeometry:E_,DoubleSide:Nc,DstAlphaFactor:D8,DstColorFactor:I8,DynamicCopyUsage:Xte,DynamicDrawUsage:Vte,DynamicReadUsage:Wte,EdgesGeometry:W9,EllipseCurve:zC,EqualDepth:N8,EqualStencilFunc:kte,EquirectangularReflectionMapping:Mb,EquirectangularRefractionMapping:Ab,Euler:iv,EventDispatcher:Fd,ExtrudeBufferGeometry:hue,ExtrudeGeometry:C_,FileLoader:Td,Float16BufferAttribute:Lie,Float32BufferAttribute:Jt,Float64BufferAttribute:Oie,FloatType:fd,Fog:IC,FogExp2:RC,FramebufferTexture:xoe,FrontSide:Ed,Frustum:TC,GLBufferAttribute:kle,GLSL1:Qte,GLSL3:oI,GreaterDepth:U8,GreaterEqualDepth:F8,GreaterEqualStencilFunc:Ute,GreaterStencilFunc:Nte,GridHelper:Gle,Group:Sy,HalfFloatType:ex,HemisphereLight:l7,HemisphereLightHelper:Wle,HemisphereLightProbe:dle,IcosahedronBufferGeometry:due,IcosahedronGeometry:T_,ImageBitmapLoader:cle,ImageLoader:Vb,ImageUtils:uz,IncrementStencilOp:Pte,IncrementWrapStencilOp:Rte,InstancedBufferAttribute:rx,InstancedBufferGeometry:m7,InstancedInterleavedBuffer:zle,InstancedMesh:k9,Int16BufferAttribute:Rie,Int32BufferAttribute:Iie,Int8BufferAttribute:Tie,IntType:K8,InterleavedBuffer:LC,InterleavedBufferAttribute:Fg,Interpolant:z_,InterpolateDiscrete:Tb,InterpolateLinear:Pb,InterpolateSmooth:CE,InvertStencilOp:Lte,KeepStencilOp:TE,KeyframeTrack:qu,LOD:O9,LatheBufferGeometry:fue,LatheGeometry:Dx,Layers:Cg,LessDepth:B8,LessEqualDepth:$E,LessEqualStencilFunc:Bte,LessStencilFunc:zte,Light:jp,LightProbe:FC,Line:Rp,Line3:Fle,LineBasicMaterial:ho,LineCurve:kC,LineCurve3:j9,LineDashedMaterial:r7,LineLoop:B9,LineSegments:ih,LinearEncoding:Dp,LinearFilter:On,LinearInterpolant:Rz,LinearMipMapLinearFilter:_te,LinearMipMapNearestFilter:bte,LinearMipmapLinearFilter:Pp,LinearMipmapNearestFilter:nz,LinearSRGBColorSpace:tx,LinearToneMapping:W8,Loader:pl,LoaderUtils:mI,LoadingManager:Lz,LoopOnce:u9,LoopPingPong:h9,LoopRepeat:c9,LuminanceAlphaFormat:t9,LuminanceFormat:e9,MOUSE:qm,Material:wa,MaterialLoader:UC,MathUtils:y9,Matrix3:ma,Matrix4:Oi,MaxEquation:BR,Mesh:js,MeshBasicMaterial:Up,MeshDepthMaterial:gz,MeshDistanceMaterial:vz,MeshLambertMaterial:t7,MeshMatcapMaterial:i7,MeshNormalMaterial:e7,MeshPhongMaterial:J9,MeshPhysicalMaterial:Z9,MeshStandardMaterial:Tz,MeshToonMaterial:$9,MinEquation:kR,MirroredRepeatWrapping:Cb,MixOperation:j8,MultiplyBlending:zR,MultiplyOperation:w_,NearestFilter:Ln,NearestMipMapLinearFilter:wte,NearestMipMapNearestFilter:xte,NearestMipmapLinearFilter:Jw,NearestMipmapNearestFilter:e2,NeverDepth:z8,NeverStencilFunc:Ote,NoBlending:_d,NoColorSpace:Ete,NoToneMapping:Nu,NormalAnimationBlendMode:EC,NormalBlending:Mg,NotEqualDepth:V8,NotEqualStencilFunc:Fte,NumberKeyframeTrack:Nb,Object3D:ur,ObjectLoader:lle,ObjectSpaceNormalMap:p9,OctahedronBufferGeometry:pue,OctahedronGeometry:Rx,OneFactor:C8,OneMinusDstAlphaFactor:R8,OneMinusDstColorFactor:L8,OneMinusSrcAlphaFactor:iz,OneMinusSrcColorFactor:P8,OrthographicCamera:jc,PCFShadowMap:MC,PCFSoftShadowMap:Zw,PMREMGenerator:uI,Path:Ob,PerspectiveCamera:on,Plane:rd,PlaneBufferGeometry:mue,PlaneGeometry:Tx,PlaneHelper:Zle,PointLight:c7,PointLightHelper:jle,Points:N9,PointsMaterial:wz,PolarGridHelper:qle,PolyhedronBufferGeometry:gue,PolyhedronGeometry:Ud,PositionalAudio:yle,PropertyBinding:lr,PropertyMixer:y7,QuadraticBezierCurve:Mz,QuadraticBezierCurve3:Az,Quaternion:Fa,QuaternionKeyframeTrack:Lx,QuaternionLinearInterpolant:o7,RED_GREEN_RGTC2_Format:sI,RED_RGTC1_Format:l9,REVISION:SC,RGBADepthPacking:f9,RGBAFormat:ko,RGBAIntegerFormat:a9,RGBA_ASTC_10x10_Format:tI,RGBA_ASTC_10x5_Format:JR,RGBA_ASTC_10x6_Format:$R,RGBA_ASTC_10x8_Format:eI,RGBA_ASTC_12x10_Format:iI,RGBA_ASTC_12x12_Format:rI,RGBA_ASTC_4x4_Format:WR,RGBA_ASTC_5x4_Format:GR,RGBA_ASTC_5x5_Format:qR,RGBA_ASTC_6x5_Format:XR,RGBA_ASTC_6x6_Format:YR,RGBA_ASTC_8x5_Format:QR,RGBA_ASTC_8x6_Format:KR,RGBA_ASTC_8x8_Format:ZR,RGBA_BPTC_Format:EE,RGBA_ETC2_EAC_Format:HR,RGBA_PVRTC_2BPPV1_Format:VR,RGBA_PVRTC_4BPPV1_Format:UR,RGBA_S3TC_DXT1_Format:SE,RGBA_S3TC_DXT3_Format:ME,RGBA_S3TC_DXT5_Format:AE,RGB_ETC1_Format:o9,RGB_ETC2_Format:jR,RGB_PVRTC_2BPPV1_Format:FR,RGB_PVRTC_4BPPV1_Format:NR,RGB_S3TC_DXT1_Format:_E,RGFormat:n9,RGIntegerFormat:s9,RawShaderMaterial:K9,Ray:Cx,Raycaster:x7,RectAreaLight:f7,RedFormat:i9,RedIntegerFormat:r9,ReinhardToneMapping:G8,RepeatWrapping:Eb,ReplaceStencilOp:Tte,ReverseSubtractEquation:A8,RingBufferGeometry:vue,RingGeometry:P_,SIGNED_RED_GREEN_RGTC2_Format:aI,SIGNED_RED_RGTC1_Format:nI,SRGBColorSpace:Iu,Scene:i2,ShaderChunk:Vi,ShaderLib:Lu,ShaderMaterial:Kc,ShadowMaterial:Q9,Shape:Tg,ShapeBufferGeometry:yue,ShapeGeometry:D_,ShapePath:eue,ShapeUtils:Hc,ShortType:Q8,Skeleton:OC,SkeletonHelper:Vle,SkinnedMesh:z9,Source:dg,Sphere:tv,SphereBufferGeometry:xue,SphereGeometry:Ix,Spherical:vI,SphericalHarmonics3:p7,SplineCurve:Ez,SpotLight:u7,SpotLightHelper:Ule,Sprite:L9,SpriteMaterial:yz,SrcAlphaFactor:tz,SrcAlphaSaturateFactor:O8,SrcColorFactor:T8,StaticCopyUsage:qte,StaticDrawUsage:Rb,StaticReadUsage:Hte,StereoCamera:ple,StreamCopyUsage:Yte,StreamDrawUsage:jte,StreamReadUsage:Gte,StringKeyframeTrack:sv,SubtractEquation:M8,SubtractiveBlending:OR,TOUCH:Xm,TangentSpaceNormalMap:Fp,TetrahedronBufferGeometry:wue,TetrahedronGeometry:R_,Texture:_n,TextureLoader:NC,TorusBufferGeometry:bue,TorusGeometry:I_,TorusKnotBufferGeometry:_ue,TorusKnotGeometry:L_,Triangle:Vl,TriangleFanDrawMode:Ate,TriangleStripDrawMode:Mte,TrianglesDrawMode:Ste,TubeBufferGeometry:Sue,TubeGeometry:O_,TwoPassDoubleSide:yte,UVMapping:AC,Uint16BufferAttribute:hz,Uint32BufferAttribute:dz,Uint8BufferAttribute:Pie,Uint8ClampedBufferAttribute:Die,Uniform:Fz,UniformsGroup:Ole,UniformsLib:Bt,UniformsUtils:_9,UnsignedByteType:Cd,UnsignedInt248Type:Ag,UnsignedIntType:op,UnsignedShort4444Type:Z8,UnsignedShort5551Type:J8,UnsignedShortType:sz,VSMShadowMap:ug,Vector2:ft,Vector3:pe,Vector4:_r,VectorKeyframeTrack:Fb,VideoTexture:yoe,WebGL1Renderer:R9,WebGL3DRenderTarget:yie,WebGLArrayRenderTarget:vie,WebGLCubeRenderTarget:pz,WebGLMultipleRenderTargets:xie,WebGLRenderTarget:Vu,WebGLRenderer:DC,WebGLUtils:T9,WireframeGeometry:Y9,WrapAroundEnding:Db,ZeroCurvatureEnding:cg,ZeroFactor:E8,ZeroSlopeEnding:hg,ZeroStencilOp:Cte,_SRGBAFormat:t2,sRGBEncoding:Ur},Symbol.toStringTag,{value:"Module"}));var UP={exports:{}},Lf={};var k4;function Aue(){return k4||(k4=1,Lf.ConcurrentRoot=1,Lf.ContinuousEventPriority=4,Lf.DefaultEventPriority=16,Lf.DiscreteEventPriority=1,Lf.IdleEventPriority=536870912,Lf.LegacyRoot=0),Lf}var B4;function Eue(){return B4||(B4=1,UP.exports=Aue()),UP.exports}var Ey=Eue();function Cue(e){let t;const i=new Set,r=(u,c)=>{const h=typeof u=="function"?u(t):u;if(h!==t){const d=t;t=c?h:Object.assign({},t,h),i.forEach(p=>p(t,d))}},n=()=>t,s=(u,c=n,h=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let d=c(t);function p(){const m=c(t);if(!h(d,m)){const v=d;u(d=m,v)}}return i.add(p),()=>i.delete(p)},l={setState:r,getState:n,subscribe:(u,c,h)=>c||h?s(u,c,h):(i.add(u),()=>i.delete(u)),destroy:()=>i.clear()};return t=e(r,n,l),l}const Tue=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),N4=Tue?xe.useEffect:xe.useLayoutEffect;function b7(e){const t=typeof e=="function"?Cue(e):e,i=(r=t.getState,n=Object.is)=>{const[,s]=xe.useReducer(g=>g+1,0),a=t.getState(),o=xe.useRef(a),l=xe.useRef(r),u=xe.useRef(n),c=xe.useRef(!1),h=xe.useRef();h.current===void 0&&(h.current=r(a));let d,p=!1;(o.current!==a||l.current!==r||u.current!==n||c.current)&&(d=r(a),p=!n(h.current,d)),N4(()=>{p&&(h.current=d),o.current=a,l.current=r,u.current=n,c.current=!1});const m=xe.useRef(a);N4(()=>{const g=()=>{try{const S=t.getState(),_=l.current(S);u.current(h.current,_)||(o.current=S,h.current=_,s())}catch{c.current=!0,s()}},w=t.subscribe(g);return t.getState()!==m.current&&g(),w},[]);const v=p?d:h.current;return xe.useDebugValue(v),v};return Object.assign(i,t),i[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const r=[i,t];return{next(){const n=r.length<=0;return{value:r.shift(),done:n}}}},i}var VP={exports:{}},jP={exports:{}},HP={};var F4;function Pue(){return F4||(F4=1,(function(e){function t(B,Z){var F=B.length;B.push(Z);e:for(;0<F;){var X=F-1>>>1,Y=B[X];if(0<n(Y,Z))B[X]=Z,B[F]=Y,F=X;else break e}}function i(B){return B.length===0?null:B[0]}function r(B){if(B.length===0)return null;var Z=B[0],F=B.pop();if(F!==Z){B[0]=F;e:for(var X=0,Y=B.length,le=Y>>>1;X<le;){var oe=2*(X+1)-1,re=B[oe],ue=oe+1,me=B[ue];if(0>n(re,F))ue<Y&&0>n(me,re)?(B[X]=me,B[ue]=F,X=ue):(B[X]=re,B[oe]=F,X=oe);else if(ue<Y&&0>n(me,F))B[X]=me,B[ue]=F,X=ue;else break e}}return Z}function n(B,Z){var F=B.sortIndex-Z.sortIndex;return F!==0?F:B.id-Z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],u=[],c=1,h=null,d=3,p=!1,m=!1,v=!1,g=typeof setTimeout=="function"?setTimeout:null,w=typeof clearTimeout=="function"?clearTimeout:null,S=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(B){for(var Z=i(u);Z!==null;){if(Z.callback===null)r(u);else if(Z.startTime<=B)r(u),Z.sortIndex=Z.expirationTime,t(l,Z);else break;Z=i(u)}}function A(B){if(v=!1,_(B),!m)if(i(l)!==null)m=!0,ne(C);else{var Z=i(u);Z!==null&&K(A,Z.startTime-B)}}function C(B,Z){m=!1,v&&(v=!1,w(T),T=-1),p=!0;var F=d;try{for(_(Z),h=i(l);h!==null&&(!(h.expirationTime>Z)||B&&!z());){var X=h.callback;if(typeof X=="function"){h.callback=null,d=h.priorityLevel;var Y=X(h.expirationTime<=Z);Z=e.unstable_now(),typeof Y=="function"?h.callback=Y:h===i(l)&&r(l),_(Z)}else r(l);h=i(l)}if(h!==null)var le=!0;else{var oe=i(u);oe!==null&&K(A,oe.startTime-Z),le=!1}return le}finally{h=null,d=F,p=!1}}var E=!1,I=null,T=-1,D=5,L=-1;function z(){return!(e.unstable_now()-L<D)}function G(){if(I!==null){var B=e.unstable_now();L=B;var Z=!0;try{Z=I(!0,B)}finally{Z?V():(E=!1,I=null)}}else E=!1}var V;if(typeof S=="function")V=function(){S(G)};else if(typeof MessageChannel<"u"){var j=new MessageChannel,J=j.port2;j.port1.onmessage=G,V=function(){J.postMessage(null)}}else V=function(){g(G,0)};function ne(B){I=B,E||(E=!0,V())}function K(B,Z){T=g(function(){B(e.unstable_now())},Z)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(B){B.callback=null},e.unstable_continueExecution=function(){m||p||(m=!0,ne(C))},e.unstable_forceFrameRate=function(B){0>B||125<B?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<B?Math.floor(1e3/B):5},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return i(l)},e.unstable_next=function(B){switch(d){case 1:case 2:case 3:var Z=3;break;default:Z=d}var F=d;d=Z;try{return B()}finally{d=F}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(B,Z){switch(B){case 1:case 2:case 3:case 4:case 5:break;default:B=3}var F=d;d=B;try{return Z()}finally{d=F}},e.unstable_scheduleCallback=function(B,Z,F){var X=e.unstable_now();switch(typeof F=="object"&&F!==null?(F=F.delay,F=typeof F=="number"&&0<F?X+F:X):F=X,B){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=F+Y,B={id:c++,callback:Z,priorityLevel:B,startTime:F,expirationTime:Y,sortIndex:-1},F>X?(B.sortIndex=F,t(u,B),i(l)===null&&B===i(u)&&(v?(w(T),T=-1):v=!0,K(A,F-X))):(B.sortIndex=Y,t(l,B),m||p||(m=!0,ne(C))),B},e.unstable_shouldYield=z,e.unstable_wrapCallback=function(B){var Z=d;return function(){var F=d;d=Z;try{return B.apply(this,arguments)}finally{d=F}}}})(HP)),HP}var U4;function Due(){return U4||(U4=1,jP.exports=Pue()),jP.exports}var WP,V4;function Rue(){return V4||(V4=1,WP=function(t){var i={},r=Mx(),n=Due(),s=Object.assign;function a(x){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+x,P=1;P<arguments.length;P++)b+="&args[]="+encodeURIComponent(arguments[P]);return"Minified React error #"+x+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),u=Symbol.for("react.portal"),c=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),p=Symbol.for("react.provider"),m=Symbol.for("react.context"),v=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),w=Symbol.for("react.suspense_list"),S=Symbol.for("react.memo"),_=Symbol.for("react.lazy"),A=Symbol.for("react.offscreen"),C=Symbol.iterator;function E(x){return x===null||typeof x!="object"?null:(x=C&&x[C]||x["@@iterator"],typeof x=="function"?x:null)}function I(x){if(x==null)return null;if(typeof x=="function")return x.displayName||x.name||null;if(typeof x=="string")return x;switch(x){case c:return"Fragment";case u:return"Portal";case d:return"Profiler";case h:return"StrictMode";case g:return"Suspense";case w:return"SuspenseList"}if(typeof x=="object")switch(x.$$typeof){case m:return(x.displayName||"Context")+".Consumer";case p:return(x._context.displayName||"Context")+".Provider";case v:var b=x.render;return x=x.displayName,x||(x=b.displayName||b.name||"",x=x!==""?"ForwardRef("+x+")":"ForwardRef"),x;case S:return b=x.displayName||null,b!==null?b:I(x.type)||"Memo";case _:b=x._payload,x=x._init;try{return I(x(b))}catch{}}return null}function T(x){var b=x.type;switch(x.tag){case 24:return"Cache";case 9:return(b.displayName||"Context")+".Consumer";case 10:return(b._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return x=b.render,x=x.displayName||x.name||"",b.displayName||(x!==""?"ForwardRef("+x+")":"ForwardRef");case 7:return"Fragment";case 5:return b;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return I(b);case 8:return b===h?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof b=="function")return b.displayName||b.name||null;if(typeof b=="string")return b}return null}function D(x){var b=x,P=x;if(x.alternate)for(;b.return;)b=b.return;else{x=b;do b=x,(b.flags&4098)!==0&&(P=b.return),x=b.return;while(x)}return b.tag===3?P:null}function L(x){if(D(x)!==x)throw Error(a(188))}function z(x){var b=x.alternate;if(!b){if(b=D(x),b===null)throw Error(a(188));return b!==x?null:x}for(var P=x,O=b;;){var U=P.return;if(U===null)break;var Q=U.alternate;if(Q===null){if(O=U.return,O!==null){P=O;continue}break}if(U.child===Q.child){for(Q=U.child;Q;){if(Q===P)return L(U),x;if(Q===O)return L(U),b;Q=Q.sibling}throw Error(a(188))}if(P.return!==O.return)P=U,O=Q;else{for(var be=!1,Be=U.child;Be;){if(Be===P){be=!0,P=U,O=Q;break}if(Be===O){be=!0,O=U,P=Q;break}Be=Be.sibling}if(!be){for(Be=Q.child;Be;){if(Be===P){be=!0,P=Q,O=U;break}if(Be===O){be=!0,O=Q,P=U;break}Be=Be.sibling}if(!be)throw Error(a(189))}}if(P.alternate!==O)throw Error(a(190))}if(P.tag!==3)throw Error(a(188));return P.stateNode.current===P?x:b}function G(x){return x=z(x),x!==null?V(x):null}function V(x){if(x.tag===5||x.tag===6)return x;for(x=x.child;x!==null;){var b=V(x);if(b!==null)return b;x=x.sibling}return null}function j(x){if(x.tag===5||x.tag===6)return x;for(x=x.child;x!==null;){if(x.tag!==4){var b=j(x);if(b!==null)return b}x=x.sibling}return null}var J=Array.isArray,ne=t.getPublicInstance,K=t.getRootHostContext,B=t.getChildHostContext,Z=t.prepareForCommit,F=t.resetAfterCommit,X=t.createInstance,Y=t.appendInitialChild,le=t.finalizeInitialChildren,oe=t.prepareUpdate,re=t.shouldSetTextContent,ue=t.createTextInstance,me=t.scheduleTimeout,he=t.cancelTimeout,Ce=t.noTimeout,Ae=t.isPrimaryRenderer,Ie=t.supportsMutation,Me=t.supportsPersistence,De=t.supportsHydration,Ve=t.getInstanceFromNode,Ge=t.preparePortalMount,Qe=t.getCurrentEventPriority,ot=t.detachDeletedInstance,$e=t.supportsMicrotasks,Ke=t.scheduleMicrotask,bt=t.supportsTestSelectors,xt=t.findFiberRoot,q=t.getBoundingRect,N=t.getTextContent,de=t.isHiddenSubtree,ze=t.matchAccessibilityRole,$=t.setFocusIfFocusable,Ue=t.setupIntersectionObserver,rt=t.appendChild,Ye=t.appendChildToContainer,Ee=t.commitTextUpdate,lt=t.commitMount,et=t.commitUpdate,pt=t.insertBefore,mt=t.insertInContainerBefore,dt=t.removeChild,_e=t.removeChildFromContainer,it=t.resetTextContent,At=t.hideInstance,ie=t.hideTextInstance,we=t.unhideInstance,Re=t.unhideTextInstance,We=t.clearContainer,ct=t.cloneInstance,Ut=t.createContainerChildSet,si=t.appendChildToContainerChildSet,Si=t.finalizeContainerChildren,ar=t.replaceContainerChildren,ri=t.cloneHiddenInstance,Yi=t.cloneHiddenTextInstance,ji=t.canHydrateInstance,po=t.canHydrateTextInstance,Xo=t.canHydrateSuspenseInstance,Qu=t.isSuspenseInstancePending,ge=t.isSuspenseInstanceFallback,te=t.registerSuspenseInstanceRetry,ve=t.getNextHydratableSibling,fe=t.getFirstHydratableChild,ye=t.getFirstHydratableChildWithinContainer,Ne=t.getFirstHydratableChildWithinSuspenseInstance,gt=t.hydrateInstance,St=t.hydrateTextInstance,Tt=t.hydrateSuspenseInstance,Et=t.getNextHydratableInstanceAfterSuspenseInstance,Vt=t.commitHydratedContainer,zt=t.commitHydratedSuspenseInstance,Yt=t.clearSuspenseBoundary,$t=t.clearSuspenseBoundaryFromContainer,tr=t.shouldDeleteUnhydratedTailInstances,Qr=t.didNotMatchHydratedContainerTextInstance,ir=t.didNotMatchHydratedTextInstance,Rt;function _i(x){if(Rt===void 0)try{throw Error()}catch(P){var b=P.stack.trim().match(/\n( *(at )?)/);Rt=b&&b[1]||""}return`
`+Rt+x}var Hi=!1;function ui(x,b){if(!x||Hi)return"";Hi=!0;var P=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(b)if(b=function(){throw Error()},Object.defineProperty(b.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(b,[])}catch(Ct){var O=Ct}Reflect.construct(x,[],b)}else{try{b.call()}catch(Ct){O=Ct}x.call(b.prototype)}else{try{throw Error()}catch(Ct){O=Ct}x()}}catch(Ct){if(Ct&&O&&typeof Ct.stack=="string"){for(var U=Ct.stack.split(`
`),Q=O.stack.split(`
`),be=U.length-1,Be=Q.length-1;1<=be&&0<=Be&&U[be]!==Q[Be];)Be--;for(;1<=be&&0<=Be;be--,Be--)if(U[be]!==Q[Be]){if(be!==1||Be!==1)do if(be--,Be--,0>Be||U[be]!==Q[Be]){var st=`
`+U[be].replace(" at new "," at ");return x.displayName&&st.includes("<anonymous>")&&(st=st.replace("<anonymous>",x.displayName)),st}while(1<=be&&0<=Be);break}}}finally{Hi=!1,Error.prepareStackTrace=P}return(x=x?x.displayName||x.name:"")?_i(x):""}var ls=Object.prototype.hasOwnProperty,us=[],hn=-1;function Ui(x){return{current:x}}function ee(x){0>hn||(x.current=us[hn],us[hn]=null,hn--)}function ae(x,b){hn++,us[hn]=x.current,x.current=b}var Se={},ce=Ui(Se),Oe=Ui(!1),vt=Se;function Mn(x,b){var P=x.type.contextTypes;if(!P)return Se;var O=x.stateNode;if(O&&O.__reactInternalMemoizedUnmaskedChildContext===b)return O.__reactInternalMemoizedMaskedChildContext;var U={},Q;for(Q in P)U[Q]=b[Q];return O&&(x=x.stateNode,x.__reactInternalMemoizedUnmaskedChildContext=b,x.__reactInternalMemoizedMaskedChildContext=U),U}function rn(x){return x=x.childContextTypes,x!=null}function ja(){ee(Oe),ee(ce)}function Ql(x,b,P){if(ce.current!==Se)throw Error(a(168));ae(ce,b),ae(Oe,P)}function ah(x,b,P){var O=x.stateNode;if(b=b.childContextTypes,typeof O.getChildContext!="function")return P;O=O.getChildContext();for(var U in O)if(!(U in b))throw Error(a(108,T(x)||"Unknown",U));return s({},P,O)}function Ku(x){return x=(x=x.stateNode)&&x.__reactInternalMemoizedMergedChildContext||Se,vt=ce.current,ae(ce,x),ae(Oe,Oe.current),!0}function dv(x,b,P){var O=x.stateNode;if(!O)throw Error(a(169));P?(x=ah(x,b,vt),O.__reactInternalMemoizedMergedChildContext=x,ee(Oe),ee(ce),ae(ce,x)):ee(Oe),ae(Oe,P)}var mo=Math.clz32?Math.clz32:_T,e1=Math.log,Yp=Math.LN2;function _T(x){return x>>>=0,x===0?32:31-(e1(x)/Yp|0)|0}var Wd=64,rr=4194304;function Gd(x){switch(x&-x){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return x&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return x&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return x}}function Qp(x,b){var P=x.pendingLanes;if(P===0)return 0;var O=0,U=x.suspendedLanes,Q=x.pingedLanes,be=P&268435455;if(be!==0){var Be=be&~U;Be!==0?O=Gd(Be):(Q&=be,Q!==0&&(O=Gd(Q)))}else be=P&~U,be!==0?O=Gd(be):Q!==0&&(O=Gd(Q));if(O===0)return 0;if(b!==0&&b!==O&&(b&U)===0&&(U=O&-O,Q=b&-b,U>=Q||U===16&&(Q&4194240)!==0))return b;if((O&4)!==0&&(O|=P&16),b=x.entangledLanes,b!==0)for(x=x.entanglements,b&=O;0<b;)P=31-mo(b),U=1<<P,O|=x[P],b&=~U;return O}function t1(x,b){switch(x){case 1:case 2:case 4:return b+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return b+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function sS(x,b){for(var P=x.suspendedLanes,O=x.pingedLanes,U=x.expirationTimes,Q=x.pendingLanes;0<Q;){var be=31-mo(Q),Be=1<<be,st=U[be];st===-1?((Be&P)===0||(Be&O)!==0)&&(U[be]=t1(Be,b)):st<=b&&(x.expiredLanes|=Be),Q&=~Be}}function fv(x){return x=x.pendingLanes&-1073741825,x!==0?x:x&1073741824?1073741824:0}function pv(x){for(var b=[],P=0;31>P;P++)b.push(x);return b}function oh(x,b,P){x.pendingLanes|=b,b!==536870912&&(x.suspendedLanes=0,x.pingedLanes=0),x=x.eventTimes,b=31-mo(b),x[b]=P}function mv(x,b){var P=x.pendingLanes&~b;x.pendingLanes=b,x.suspendedLanes=0,x.pingedLanes=0,x.expiredLanes&=b,x.mutableReadLanes&=b,x.entangledLanes&=b,b=x.entanglements;var O=x.eventTimes;for(x=x.expirationTimes;0<P;){var U=31-mo(P),Q=1<<U;b[U]=0,O[U]=-1,x[U]=-1,P&=~Q}}function ml(x,b){var P=x.entangledLanes|=b;for(x=x.entanglements;P;){var O=31-mo(P),U=1<<O;U&b|x[O]&b&&(x[O]|=b),P&=~U}}var Bi=0;function Kl(x){return x&=-x,1<x?4<x?(x&268435455)!==0?16:536870912:4:1}var lh=n.unstable_scheduleCallback,qd=n.unstable_cancelCallback,Zu=n.unstable_shouldYield,ST=n.unstable_requestPaint,An=n.unstable_now,uh=n.unstable_ImmediatePriority,MT=n.unstable_UserBlockingPriority,gv=n.unstable_NormalPriority,vv=n.unstable_IdlePriority,Kp=null,gl=null;function Zp(x){if(gl&&typeof gl.onCommitFiberRoot=="function")try{gl.onCommitFiberRoot(Kp,x,void 0,(x.current.flags&128)===128)}catch{}}function Jp(x,b){return x===b&&(x!==0||1/x===1/b)||x!==x&&b!==b}var Qs=typeof Object.is=="function"?Object.is:Jp,go=null,yv=!1,i1=!1;function xv(x){go===null?go=[x]:go.push(x)}function wv(x){yv=!0,xv(x)}function vo(){if(!i1&&go!==null){i1=!0;var x=0,b=Bi;try{var P=go;for(Bi=1;x<P.length;x++){var O=P[x];do O=O(!0);while(O!==null)}go=null,yv=!1}catch(U){throw go!==null&&(go=go.slice(x+1)),lh(uh,vo),U}finally{Bi=b,i1=!1}}return null}var aS=o.ReactCurrentBatchConfig;function Yo(x,b){if(Qs(x,b))return!0;if(typeof x!="object"||x===null||typeof b!="object"||b===null)return!1;var P=Object.keys(x),O=Object.keys(b);if(P.length!==O.length)return!1;for(O=0;O<P.length;O++){var U=P[O];if(!ls.call(b,U)||!Qs(x[U],b[U]))return!1}return!0}function r1(x){switch(x.tag){case 5:return _i(x.type);case 16:return _i("Lazy");case 13:return _i("Suspense");case 19:return _i("SuspenseList");case 0:case 2:case 15:return x=ui(x.type,!1),x;case 11:return x=ui(x.type.render,!1),x;case 1:return x=ui(x.type,!0),x;default:return""}}function ba(x,b){if(x&&x.defaultProps){b=s({},b),x=x.defaultProps;for(var P in x)b[P]===void 0&&(b[P]=x[P]);return b}return b}var $p=Ui(null),ch=null,Zl=null,bv=null;function Ks(){bv=Zl=ch=null}function hh(x,b,P){Ae?(ae($p,b._currentValue),b._currentValue=P):(ae($p,b._currentValue2),b._currentValue2=P)}function em(x){var b=$p.current;ee($p),Ae?x._currentValue=b:x._currentValue2=b}function dh(x,b,P){for(;x!==null;){var O=x.alternate;if((x.childLanes&b)!==b?(x.childLanes|=b,O!==null&&(O.childLanes|=b)):O!==null&&(O.childLanes&b)!==b&&(O.childLanes|=b),x===P)break;x=x.return}}function Xd(x,b){ch=x,bv=Zl=null,x=x.dependencies,x!==null&&x.firstContext!==null&&((x.lanes&b)!==0&&(Hn=!0),x.firstContext=null)}function _a(x){var b=Ae?x._currentValue:x._currentValue2;if(bv!==x)if(x={context:x,memoizedValue:b,next:null},Zl===null){if(ch===null)throw Error(a(308));Zl=x,ch.dependencies={lanes:0,firstContext:x}}else Zl=Zl.next=x;return b}var yo=null,xo=!1;function Yd(x){x.updateQueue={baseState:x.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function n1(x,b){x=x.updateQueue,b.updateQueue===x&&(b.updateQueue={baseState:x.baseState,firstBaseUpdate:x.firstBaseUpdate,lastBaseUpdate:x.lastBaseUpdate,shared:x.shared,effects:x.effects})}function Jl(x,b){return{eventTime:x,lane:b,tag:0,payload:null,callback:null,next:null}}function Ju(x,b){var P=x.updateQueue;P!==null&&(P=P.shared,Gr!==null&&(x.mode&1)!==0&&(ki&2)===0?(x=P.interleaved,x===null?(b.next=b,yo===null?yo=[P]:yo.push(P)):(b.next=x.next,x.next=b),P.interleaved=b):(x=P.pending,x===null?b.next=b:(b.next=x.next,x.next=b),P.pending=b))}function _v(x,b,P){if(b=b.updateQueue,b!==null&&(b=b.shared,(P&4194240)!==0)){var O=b.lanes;O&=x.pendingLanes,P|=O,b.lanes=P,ml(x,P)}}function Sv(x,b){var P=x.updateQueue,O=x.alternate;if(O!==null&&(O=O.updateQueue,P===O)){var U=null,Q=null;if(P=P.firstBaseUpdate,P!==null){do{var be={eventTime:P.eventTime,lane:P.lane,tag:P.tag,payload:P.payload,callback:P.callback,next:null};Q===null?U=Q=be:Q=Q.next=be,P=P.next}while(P!==null);Q===null?U=Q=b:Q=Q.next=b}else U=Q=b;P={baseState:O.baseState,firstBaseUpdate:U,lastBaseUpdate:Q,shared:O.shared,effects:O.effects},x.updateQueue=P;return}x=P.lastBaseUpdate,x===null?P.firstBaseUpdate=b:x.next=b,P.lastBaseUpdate=b}function Mv(x,b,P,O){var U=x.updateQueue;xo=!1;var Q=U.firstBaseUpdate,be=U.lastBaseUpdate,Be=U.shared.pending;if(Be!==null){U.shared.pending=null;var st=Be,Ct=st.next;st.next=null,be===null?Q=Ct:be.next=Ct,be=st;var Gt=x.alternate;Gt!==null&&(Gt=Gt.updateQueue,Be=Gt.lastBaseUpdate,Be!==be&&(Be===null?Gt.firstBaseUpdate=Ct:Be.next=Ct,Gt.lastBaseUpdate=st))}if(Q!==null){var Ti=U.baseState;be=0,Gt=Ct=st=null,Be=Q;do{var ci=Be.lane,xr=Be.eventTime;if((O&ci)===ci){Gt!==null&&(Gt=Gt.next={eventTime:xr,lane:0,tag:Be.tag,payload:Be.payload,callback:Be.callback,next:null});e:{var jt=x,cr=Be;switch(ci=b,xr=P,cr.tag){case 1:if(jt=cr.payload,typeof jt=="function"){Ti=jt.call(xr,Ti,ci);break e}Ti=jt;break e;case 3:jt.flags=jt.flags&-65537|128;case 0:if(jt=cr.payload,ci=typeof jt=="function"?jt.call(xr,Ti,ci):jt,ci==null)break e;Ti=s({},Ti,ci);break e;case 2:xo=!0}}Be.callback!==null&&Be.lane!==0&&(x.flags|=64,ci=U.effects,ci===null?U.effects=[Be]:ci.push(Be))}else xr={eventTime:xr,lane:ci,tag:Be.tag,payload:Be.payload,callback:Be.callback,next:null},Gt===null?(Ct=Gt=xr,st=Ti):Gt=Gt.next=xr,be|=ci;if(Be=Be.next,Be===null){if(Be=U.shared.pending,Be===null)break;ci=Be,Be=ci.next,ci.next=null,U.lastBaseUpdate=ci,U.shared.pending=null}}while(!0);if(Gt===null&&(st=Ti),U.baseState=st,U.firstBaseUpdate=Ct,U.lastBaseUpdate=Gt,b=U.shared.interleaved,b!==null){U=b;do be|=U.lane,U=U.next;while(U!==b)}else Q===null&&(U.shared.lanes=0);Th|=be,x.lanes=be,x.memoizedState=Ti}}function oS(x,b,P){if(x=b.effects,b.effects=null,x!==null)for(b=0;b<x.length;b++){var O=x[b],U=O.callback;if(U!==null){if(O.callback=null,O=P,typeof U!="function")throw Error(a(191,U));U.call(O)}}}var lS=new r.Component().refs;function s1(x,b,P,O){b=x.memoizedState,P=P(O,b),P=P==null?b:s({},b,P),x.memoizedState=P,x.lanes===0&&(x.updateQueue.baseState=P)}var Av={isMounted:function(x){return(x=x._reactInternals)?D(x)===x:!1},enqueueSetState:function(x,b,P){x=x._reactInternals;var O=qn(),U=_l(x),Q=Jl(O,U);Q.payload=b,P!=null&&(Q.callback=P),Ju(x,Q),b=Ea(x,U,O),b!==null&&_v(b,x,U)},enqueueReplaceState:function(x,b,P){x=x._reactInternals;var O=qn(),U=_l(x),Q=Jl(O,U);Q.tag=1,Q.payload=b,P!=null&&(Q.callback=P),Ju(x,Q),b=Ea(x,U,O),b!==null&&_v(b,x,U)},enqueueForceUpdate:function(x,b){x=x._reactInternals;var P=qn(),O=_l(x),U=Jl(P,O);U.tag=2,b!=null&&(U.callback=b),Ju(x,U),b=Ea(x,O,P),b!==null&&_v(b,x,O)}};function a1(x,b,P,O,U,Q,be){return x=x.stateNode,typeof x.shouldComponentUpdate=="function"?x.shouldComponentUpdate(O,Q,be):b.prototype&&b.prototype.isPureReactComponent?!Yo(P,O)||!Yo(U,Q):!0}function uS(x,b,P){var O=!1,U=Se,Q=b.contextType;return typeof Q=="object"&&Q!==null?Q=_a(Q):(U=rn(b)?vt:ce.current,O=b.contextTypes,Q=(O=O!=null)?Mn(x,U):Se),b=new b(P,Q),x.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=Av,x.stateNode=b,b._reactInternals=x,O&&(x=x.stateNode,x.__reactInternalMemoizedUnmaskedChildContext=U,x.__reactInternalMemoizedMaskedChildContext=Q),b}function cS(x,b,P,O){x=b.state,typeof b.componentWillReceiveProps=="function"&&b.componentWillReceiveProps(P,O),typeof b.UNSAFE_componentWillReceiveProps=="function"&&b.UNSAFE_componentWillReceiveProps(P,O),b.state!==x&&Av.enqueueReplaceState(b,b.state,null)}function o1(x,b,P,O){var U=x.stateNode;U.props=P,U.state=x.memoizedState,U.refs=lS,Yd(x);var Q=b.contextType;typeof Q=="object"&&Q!==null?U.context=_a(Q):(Q=rn(b)?vt:ce.current,U.context=Mn(x,Q)),U.state=x.memoizedState,Q=b.getDerivedStateFromProps,typeof Q=="function"&&(s1(x,b,Q,P),U.state=x.memoizedState),typeof b.getDerivedStateFromProps=="function"||typeof U.getSnapshotBeforeUpdate=="function"||typeof U.UNSAFE_componentWillMount!="function"&&typeof U.componentWillMount!="function"||(b=U.state,typeof U.componentWillMount=="function"&&U.componentWillMount(),typeof U.UNSAFE_componentWillMount=="function"&&U.UNSAFE_componentWillMount(),b!==U.state&&Av.enqueueReplaceState(U,U.state,null),Mv(x,P,U,O),U.state=x.memoizedState),typeof U.componentDidMount=="function"&&(x.flags|=4194308)}var Qd=[],$u=0,Ev=null,Cv=0,wo=[],Ha=0,fh=null,$l=1,eu="";function ph(x,b){Qd[$u++]=Cv,Qd[$u++]=Ev,Ev=x,Cv=b}function hS(x,b,P){wo[Ha++]=$l,wo[Ha++]=eu,wo[Ha++]=fh,fh=x;var O=$l;x=eu;var U=32-mo(O)-1;O&=~(1<<U),P+=1;var Q=32-mo(b)+U;if(30<Q){var be=U-U%5;Q=(O&(1<<be)-1).toString(32),O>>=be,U-=be,$l=1<<32-mo(b)+U|P<<U|O,eu=Q+x}else $l=1<<Q|P<<U|O,eu=x}function l1(x){x.return!==null&&(ph(x,1),hS(x,1,0))}function u1(x){for(;x===Ev;)Ev=Qd[--$u],Qd[$u]=null,Cv=Qd[--$u],Qd[$u]=null;for(;x===fh;)fh=wo[--Ha],wo[Ha]=null,eu=wo[--Ha],wo[Ha]=null,$l=wo[--Ha],wo[Ha]=null}var Zs=null,cs=null,Br=!1,Kd=!1,bo=null;function c1(x,b){var P=Ya(5,null,null,0);P.elementType="DELETED",P.stateNode=b,P.return=x,b=x.deletions,b===null?(x.deletions=[P],x.flags|=16):b.push(P)}function h1(x,b){switch(x.tag){case 5:return b=ji(b,x.type,x.pendingProps),b!==null?(x.stateNode=b,Zs=x,cs=fe(b),!0):!1;case 6:return b=po(b,x.pendingProps),b!==null?(x.stateNode=b,Zs=x,cs=null,!0):!1;case 13:if(b=Xo(b),b!==null){var P=fh!==null?{id:$l,overflow:eu}:null;return x.memoizedState={dehydrated:b,treeContext:P,retryLane:1073741824},P=Ya(18,null,null,0),P.stateNode=b,P.return=x,x.child=P,Zs=x,cs=null,!0}return!1;default:return!1}}function Tv(x){return(x.mode&1)!==0&&(x.flags&128)===0}function ec(x){if(Br){var b=cs;if(b){var P=b;if(!h1(x,b)){if(Tv(x))throw Error(a(418));b=ve(P);var O=Zs;b&&h1(x,b)?c1(O,P):(x.flags=x.flags&-4097|2,Br=!1,Zs=x)}}else{if(Tv(x))throw Error(a(418));x.flags=x.flags&-4097|2,Br=!1,Zs=x}}}function dS(x){for(x=x.return;x!==null&&x.tag!==5&&x.tag!==3&&x.tag!==13;)x=x.return;Zs=x}function tm(x){if(!De||x!==Zs)return!1;if(!Br)return dS(x),Br=!0,!1;if(x.tag!==3&&(x.tag!==5||tr(x.type)&&!re(x.type,x.memoizedProps))){var b=cs;if(b){if(Tv(x)){for(x=cs;x;)x=ve(x);throw Error(a(418))}for(;b;)c1(x,b),b=ve(b)}}if(dS(x),x.tag===13){if(!De)throw Error(a(316));if(x=x.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(a(317));cs=Et(x)}else cs=Zs?ve(x.stateNode):null;return!0}function Zd(){De&&(cs=Zs=null,Kd=Br=!1)}function Pv(x){bo===null?bo=[x]:bo.push(x)}function Jd(x,b,P){if(x=P.ref,x!==null&&typeof x!="function"&&typeof x!="object"){if(P._owner){if(P=P._owner,P){if(P.tag!==1)throw Error(a(309));var O=P.stateNode}if(!O)throw Error(a(147,x));var U=O,Q=""+x;return b!==null&&b.ref!==null&&typeof b.ref=="function"&&b.ref._stringRef===Q?b.ref:(b=function(be){var Be=U.refs;Be===lS&&(Be=U.refs={}),be===null?delete Be[Q]:Be[Q]=be},b._stringRef=Q,b)}if(typeof x!="string")throw Error(a(284));if(!P._owner)throw Error(a(290,x))}return x}function tc(x,b){throw x=Object.prototype.toString.call(b),Error(a(31,x==="[object Object]"?"object with keys {"+Object.keys(b).join(", ")+"}":x))}function $d(x){var b=x._init;return b(x._payload)}function fS(x){function b(Xe,Fe){if(x){var tt=Xe.deletions;tt===null?(Xe.deletions=[Fe],Xe.flags|=16):tt.push(Fe)}}function P(Xe,Fe){if(!x)return null;for(;Fe!==null;)b(Xe,Fe),Fe=Fe.sibling;return null}function O(Xe,Fe){for(Xe=new Map;Fe!==null;)Fe.key!==null?Xe.set(Fe.key,Fe):Xe.set(Fe.index,Fe),Fe=Fe.sibling;return Xe}function U(Xe,Fe){return Xe=du(Xe,Fe),Xe.index=0,Xe.sibling=null,Xe}function Q(Xe,Fe,tt){return Xe.index=tt,x?(tt=Xe.alternate,tt!==null?(tt=tt.index,tt<Fe?(Xe.flags|=2,Fe):tt):(Xe.flags|=2,Fe)):(Xe.flags|=1048576,Fe)}function be(Xe){return x&&Xe.alternate===null&&(Xe.flags|=2),Xe}function Be(Xe,Fe,tt,Nt){return Fe===null||Fe.tag!==6?(Fe=o0(tt,Xe.mode,Nt),Fe.return=Xe,Fe):(Fe=U(Fe,tt),Fe.return=Xe,Fe)}function st(Xe,Fe,tt,Nt){var ei=tt.type;return ei===c?Gt(Xe,Fe,tt.props.children,Nt,tt.key):Fe!==null&&(Fe.elementType===ei||typeof ei=="object"&&ei!==null&&ei.$$typeof===_&&$d(ei)===Fe.type)?(Nt=U(Fe,tt.props),Nt.ref=Jd(Xe,Fe,tt),Nt.return=Xe,Nt):(Nt=Mm(tt.type,tt.key,tt.props,null,Xe.mode,Nt),Nt.ref=Jd(Xe,Fe,tt),Nt.return=Xe,Nt)}function Ct(Xe,Fe,tt,Nt){return Fe===null||Fe.tag!==4||Fe.stateNode.containerInfo!==tt.containerInfo||Fe.stateNode.implementation!==tt.implementation?(Fe=l0(tt,Xe.mode,Nt),Fe.return=Xe,Fe):(Fe=U(Fe,tt.children||[]),Fe.return=Xe,Fe)}function Gt(Xe,Fe,tt,Nt,ei){return Fe===null||Fe.tag!==7?(Fe=fc(tt,Xe.mode,Nt,ei),Fe.return=Xe,Fe):(Fe=U(Fe,tt),Fe.return=Xe,Fe)}function Ti(Xe,Fe,tt){if(typeof Fe=="string"&&Fe!==""||typeof Fe=="number")return Fe=o0(""+Fe,Xe.mode,tt),Fe.return=Xe,Fe;if(typeof Fe=="object"&&Fe!==null){switch(Fe.$$typeof){case l:return tt=Mm(Fe.type,Fe.key,Fe.props,null,Xe.mode,tt),tt.ref=Jd(Xe,null,Fe),tt.return=Xe,tt;case u:return Fe=l0(Fe,Xe.mode,tt),Fe.return=Xe,Fe;case _:var Nt=Fe._init;return Ti(Xe,Nt(Fe._payload),tt)}if(J(Fe)||E(Fe))return Fe=fc(Fe,Xe.mode,tt,null),Fe.return=Xe,Fe;tc(Xe,Fe)}return null}function ci(Xe,Fe,tt,Nt){var ei=Fe!==null?Fe.key:null;if(typeof tt=="string"&&tt!==""||typeof tt=="number")return ei!==null?null:Be(Xe,Fe,""+tt,Nt);if(typeof tt=="object"&&tt!==null){switch(tt.$$typeof){case l:return tt.key===ei?st(Xe,Fe,tt,Nt):null;case u:return tt.key===ei?Ct(Xe,Fe,tt,Nt):null;case _:return ei=tt._init,ci(Xe,Fe,ei(tt._payload),Nt)}if(J(tt)||E(tt))return ei!==null?null:Gt(Xe,Fe,tt,Nt,null);tc(Xe,tt)}return null}function xr(Xe,Fe,tt,Nt,ei){if(typeof Nt=="string"&&Nt!==""||typeof Nt=="number")return Xe=Xe.get(tt)||null,Be(Fe,Xe,""+Nt,ei);if(typeof Nt=="object"&&Nt!==null){switch(Nt.$$typeof){case l:return Xe=Xe.get(Nt.key===null?tt:Nt.key)||null,st(Fe,Xe,Nt,ei);case u:return Xe=Xe.get(Nt.key===null?tt:Nt.key)||null,Ct(Fe,Xe,Nt,ei);case _:var zi=Nt._init;return xr(Xe,Fe,tt,zi(Nt._payload),ei)}if(J(Nt)||E(Nt))return Xe=Xe.get(tt)||null,Gt(Fe,Xe,Nt,ei,null);tc(Fe,Nt)}return null}function jt(Xe,Fe,tt,Nt){for(var ei=null,zi=null,Ei=Fe,Ji=Fe=0,Cn=null;Ei!==null&&Ji<tt.length;Ji++){Ei.index>Ji?(Cn=Ei,Ei=null):Cn=Ei.sibling;var Qi=ci(Xe,Ei,tt[Ji],Nt);if(Qi===null){Ei===null&&(Ei=Cn);break}x&&Ei&&Qi.alternate===null&&b(Xe,Ei),Fe=Q(Qi,Fe,Ji),zi===null?ei=Qi:zi.sibling=Qi,zi=Qi,Ei=Cn}if(Ji===tt.length)return P(Xe,Ei),Br&&ph(Xe,Ji),ei;if(Ei===null){for(;Ji<tt.length;Ji++)Ei=Ti(Xe,tt[Ji],Nt),Ei!==null&&(Fe=Q(Ei,Fe,Ji),zi===null?ei=Ei:zi.sibling=Ei,zi=Ei);return Br&&ph(Xe,Ji),ei}for(Ei=O(Xe,Ei);Ji<tt.length;Ji++)Cn=xr(Ei,Xe,Ji,tt[Ji],Nt),Cn!==null&&(x&&Cn.alternate!==null&&Ei.delete(Cn.key===null?Ji:Cn.key),Fe=Q(Cn,Fe,Ji),zi===null?ei=Cn:zi.sibling=Cn,zi=Cn);return x&&Ei.forEach(function(Sl){return b(Xe,Sl)}),Br&&ph(Xe,Ji),ei}function cr(Xe,Fe,tt,Nt){var ei=E(tt);if(typeof ei!="function")throw Error(a(150));if(tt=ei.call(tt),tt==null)throw Error(a(151));for(var zi=ei=null,Ei=Fe,Ji=Fe=0,Cn=null,Qi=tt.next();Ei!==null&&!Qi.done;Ji++,Qi=tt.next()){Ei.index>Ji?(Cn=Ei,Ei=null):Cn=Ei.sibling;var Sl=ci(Xe,Ei,Qi.value,Nt);if(Sl===null){Ei===null&&(Ei=Cn);break}x&&Ei&&Sl.alternate===null&&b(Xe,Ei),Fe=Q(Sl,Fe,Ji),zi===null?ei=Sl:zi.sibling=Sl,zi=Sl,Ei=Cn}if(Qi.done)return P(Xe,Ei),Br&&ph(Xe,Ji),ei;if(Ei===null){for(;!Qi.done;Ji++,Qi=tt.next())Qi=Ti(Xe,Qi.value,Nt),Qi!==null&&(Fe=Q(Qi,Fe,Ji),zi===null?ei=Qi:zi.sibling=Qi,zi=Qi);return Br&&ph(Xe,Ji),ei}for(Ei=O(Xe,Ei);!Qi.done;Ji++,Qi=tt.next())Qi=xr(Ei,Xe,Ji,Qi.value,Nt),Qi!==null&&(x&&Qi.alternate!==null&&Ei.delete(Qi.key===null?Ji:Qi.key),Fe=Q(Qi,Fe,Ji),zi===null?ei=Qi:zi.sibling=Qi,zi=Qi);return x&&Ei.forEach(function(IS){return b(Xe,IS)}),Br&&ph(Xe,Ji),ei}function Qa(Xe,Fe,tt,Nt){if(typeof tt=="object"&&tt!==null&&tt.type===c&&tt.key===null&&(tt=tt.props.children),typeof tt=="object"&&tt!==null){switch(tt.$$typeof){case l:e:{for(var ei=tt.key,zi=Fe;zi!==null;){if(zi.key===ei){if(ei=tt.type,ei===c){if(zi.tag===7){P(Xe,zi.sibling),Fe=U(zi,tt.props.children),Fe.return=Xe,Xe=Fe;break e}}else if(zi.elementType===ei||typeof ei=="object"&&ei!==null&&ei.$$typeof===_&&$d(ei)===zi.type){P(Xe,zi.sibling),Fe=U(zi,tt.props),Fe.ref=Jd(Xe,zi,tt),Fe.return=Xe,Xe=Fe;break e}P(Xe,zi);break}else b(Xe,zi);zi=zi.sibling}tt.type===c?(Fe=fc(tt.props.children,Xe.mode,Nt,tt.key),Fe.return=Xe,Xe=Fe):(Nt=Mm(tt.type,tt.key,tt.props,null,Xe.mode,Nt),Nt.ref=Jd(Xe,Fe,tt),Nt.return=Xe,Xe=Nt)}return be(Xe);case u:e:{for(zi=tt.key;Fe!==null;){if(Fe.key===zi)if(Fe.tag===4&&Fe.stateNode.containerInfo===tt.containerInfo&&Fe.stateNode.implementation===tt.implementation){P(Xe,Fe.sibling),Fe=U(Fe,tt.children||[]),Fe.return=Xe,Xe=Fe;break e}else{P(Xe,Fe);break}else b(Xe,Fe);Fe=Fe.sibling}Fe=l0(tt,Xe.mode,Nt),Fe.return=Xe,Xe=Fe}return be(Xe);case _:return zi=tt._init,Qa(Xe,Fe,zi(tt._payload),Nt)}if(J(tt))return jt(Xe,Fe,tt,Nt);if(E(tt))return cr(Xe,Fe,tt,Nt);tc(Xe,tt)}return typeof tt=="string"&&tt!==""||typeof tt=="number"?(tt=""+tt,Fe!==null&&Fe.tag===6?(P(Xe,Fe.sibling),Fe=U(Fe,tt),Fe.return=Xe,Xe=Fe):(P(Xe,Fe),Fe=o0(tt,Xe.mode,Nt),Fe.return=Xe,Xe=Fe),be(Xe)):P(Xe,Fe)}return Qa}var tu=fS(!0),pS=fS(!1),ef={},Sa=Ui(ef),mh=Ui(ef),gh=Ui(ef);function Qo(x){if(x===ef)throw Error(a(174));return x}function Dv(x,b){ae(gh,b),ae(mh,x),ae(Sa,ef),x=K(b),ee(Sa),ae(Sa,x)}function tf(){ee(Sa),ee(mh),ee(gh)}function mS(x){var b=Qo(gh.current),P=Qo(Sa.current);b=B(P,x.type,b),P!==b&&(ae(mh,x),ae(Sa,b))}function d1(x){mh.current===x&&(ee(Sa),ee(mh))}var Hr=Ui(0);function Rv(x){for(var b=x;b!==null;){if(b.tag===13){var P=b.memoizedState;if(P!==null&&(P=P.dehydrated,P===null||Qu(P)||ge(P)))return b}else if(b.tag===19&&b.memoizedProps.revealOrder!==void 0){if((b.flags&128)!==0)return b}else if(b.child!==null){b.child.return=b,b=b.child;continue}if(b===x)break;for(;b.sibling===null;){if(b.return===null||b.return===x)return null;b=b.return}b.sibling.return=b.return,b=b.sibling}return null}var Wa=[];function vh(){for(var x=0;x<Wa.length;x++){var b=Wa[x];Ae?b._workInProgressVersionPrimary=null:b._workInProgressVersionSecondary=null}Wa.length=0}var im=o.ReactCurrentDispatcher,Ga=o.ReactCurrentBatchConfig,yh=0,Wr=null,Un=null,Vn=null,Iv=!1,vl=!1,xh=0,rm=0;function jn(){throw Error(a(321))}function Lv(x,b){if(b===null)return!1;for(var P=0;P<b.length&&P<x.length;P++)if(!Qs(x[P],b[P]))return!1;return!0}function rf(x,b,P,O,U,Q){if(yh=Q,Wr=b,b.memoizedState=null,b.updateQueue=null,b.lanes=0,im.current=x===null||x.memoizedState===null?y1:x1,x=P(O,U),vl){Q=0;do{if(vl=!1,xh=0,25<=Q)throw Error(a(301));Q+=1,Vn=Un=null,b.updateQueue=null,im.current=w1,x=P(O,U)}while(vl)}if(im.current=of,b=Un!==null&&Un.next!==null,yh=0,Vn=Un=Wr=null,Iv=!1,b)throw Error(a(300));return x}function ic(){var x=xh!==0;return xh=0,x}function Ko(){var x={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Vn===null?Wr.memoizedState=Vn=x:Vn=Vn.next=x,Vn}function Zo(){if(Un===null){var x=Wr.alternate;x=x!==null?x.memoizedState:null}else x=Un.next;var b=Vn===null?Wr.memoizedState:Vn.next;if(b!==null)Vn=b,Un=x;else{if(x===null)throw Error(a(310));Un=x,x={memoizedState:Un.memoizedState,baseState:Un.baseState,baseQueue:Un.baseQueue,queue:Un.queue,next:null},Vn===null?Wr.memoizedState=Vn=x:Vn=Vn.next=x}return Vn}function yl(x,b){return typeof b=="function"?b(x):b}function nm(x){var b=Zo(),P=b.queue;if(P===null)throw Error(a(311));P.lastRenderedReducer=x;var O=Un,U=O.baseQueue,Q=P.pending;if(Q!==null){if(U!==null){var be=U.next;U.next=Q.next,Q.next=be}O.baseQueue=U=Q,P.pending=null}if(U!==null){Q=U.next,O=O.baseState;var Be=be=null,st=null,Ct=Q;do{var Gt=Ct.lane;if((yh&Gt)===Gt)st!==null&&(st=st.next={lane:0,action:Ct.action,hasEagerState:Ct.hasEagerState,eagerState:Ct.eagerState,next:null}),O=Ct.hasEagerState?Ct.eagerState:x(O,Ct.action);else{var Ti={lane:Gt,action:Ct.action,hasEagerState:Ct.hasEagerState,eagerState:Ct.eagerState,next:null};st===null?(Be=st=Ti,be=O):st=st.next=Ti,Wr.lanes|=Gt,Th|=Gt}Ct=Ct.next}while(Ct!==null&&Ct!==Q);st===null?be=O:st.next=Be,Qs(O,b.memoizedState)||(Hn=!0),b.memoizedState=O,b.baseState=be,b.baseQueue=st,P.lastRenderedState=O}if(x=P.interleaved,x!==null){U=x;do Q=U.lane,Wr.lanes|=Q,Th|=Q,U=U.next;while(U!==x)}else U===null&&(P.lanes=0);return[b.memoizedState,P.dispatch]}function sm(x){var b=Zo(),P=b.queue;if(P===null)throw Error(a(311));P.lastRenderedReducer=x;var O=P.dispatch,U=P.pending,Q=b.memoizedState;if(U!==null){P.pending=null;var be=U=U.next;do Q=x(Q,be.action),be=be.next;while(be!==U);Qs(Q,b.memoizedState)||(Hn=!0),b.memoizedState=Q,b.baseQueue===null&&(b.baseState=Q),P.lastRenderedState=Q}return[Q,O]}function f1(){}function p1(x,b){var P=Wr,O=Zo(),U=b(),Q=!Qs(O.memoizedState,U);if(Q&&(O.memoizedState=U,Hn=!0),O=O.queue,nf(iu.bind(null,P,O,x),[x]),O.getSnapshot!==b||Q||Vn!==null&&Vn.memoizedState.tag&1){if(P.flags|=2048,om(9,g1.bind(null,P,O,U,b),void 0,null),Gr===null)throw Error(a(349));(yh&30)!==0||m1(P,b,U)}return U}function m1(x,b,P){x.flags|=16384,x={getSnapshot:b,value:P},b=Wr.updateQueue,b===null?(b={lastEffect:null,stores:null},Wr.updateQueue=b,b.stores=[x]):(P=b.stores,P===null?b.stores=[x]:P.push(x))}function g1(x,b,P,O){b.value=P,b.getSnapshot=O,Ov(b)&&Ea(x,1,-1)}function iu(x,b,P){return P(function(){Ov(b)&&Ea(x,1,-1)})}function Ov(x){var b=x.getSnapshot;x=x.value;try{var P=b();return!Qs(x,P)}catch{return!0}}function am(x){var b=Ko();return typeof x=="function"&&(x=x()),b.memoizedState=b.baseState=x,x={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:yl,lastRenderedState:x},b.queue=x,x=x.dispatch=AT.bind(null,Wr,x),[b.memoizedState,x]}function om(x,b,P,O){return x={tag:x,create:b,destroy:P,deps:O,next:null},b=Wr.updateQueue,b===null?(b={lastEffect:null,stores:null},Wr.updateQueue=b,b.lastEffect=x.next=x):(P=b.lastEffect,P===null?b.lastEffect=x.next=x:(O=P.next,P.next=x,x.next=O,b.lastEffect=x)),x}function gS(){return Zo().memoizedState}function rc(x,b,P,O){var U=Ko();Wr.flags|=x,U.memoizedState=om(1|b,P,void 0,O===void 0?null:O)}function zv(x,b,P,O){var U=Zo();O=O===void 0?null:O;var Q=void 0;if(Un!==null){var be=Un.memoizedState;if(Q=be.destroy,O!==null&&Lv(O,be.deps)){U.memoizedState=om(b,P,Q,O);return}}Wr.flags|=x,U.memoizedState=om(1|b,P,Q,O)}function kv(x,b){return rc(8390656,8,x,b)}function nf(x,b){return zv(2048,8,x,b)}function Ar(x,b){return zv(4,2,x,b)}function Bv(x,b){return zv(4,4,x,b)}function lm(x,b){if(typeof b=="function")return x=x(),b(x),function(){b(null)};if(b!=null)return x=x(),b.current=x,function(){b.current=null}}function sf(x,b,P){return P=P!=null?P.concat([x]):null,zv(4,4,lm.bind(null,b,x),P)}function Nv(){}function Fv(x,b){var P=Zo();b=b===void 0?null:b;var O=P.memoizedState;return O!==null&&b!==null&&Lv(b,O[1])?O[0]:(P.memoizedState=[x,b],x)}function af(x,b){var P=Zo();b=b===void 0?null:b;var O=P.memoizedState;return O!==null&&b!==null&&Lv(b,O[1])?O[0]:(x=x(),P.memoizedState=[x,b],x)}function Uv(x,b){var P=Bi;Bi=P!==0&&4>P?P:4,x(!0);var O=Ga.transition;Ga.transition={};try{x(!1),b()}finally{Bi=P,Ga.transition=O}}function wh(){return Zo().memoizedState}function vS(x,b,P){var O=_l(x);P={lane:O,action:P,hasEagerState:!1,eagerState:null,next:null},yS(x)?v1(b,P):(um(x,b,P),P=qn(),x=Ea(x,O,P),x!==null&&cm(x,b,O))}function AT(x,b,P){var O=_l(x),U={lane:O,action:P,hasEagerState:!1,eagerState:null,next:null};if(yS(x))v1(b,U);else{um(x,b,U);var Q=x.alternate;if(x.lanes===0&&(Q===null||Q.lanes===0)&&(Q=b.lastRenderedReducer,Q!==null))try{var be=b.lastRenderedState,Be=Q(be,P);if(U.hasEagerState=!0,U.eagerState=Be,Qs(Be,be))return}catch{}finally{}P=qn(),x=Ea(x,O,P),x!==null&&cm(x,b,O)}}function yS(x){var b=x.alternate;return x===Wr||b!==null&&b===Wr}function v1(x,b){vl=Iv=!0;var P=x.pending;P===null?b.next=b:(b.next=P.next,P.next=b),x.pending=b}function um(x,b,P){Gr!==null&&(x.mode&1)!==0&&(ki&2)===0?(x=b.interleaved,x===null?(P.next=P,yo===null?yo=[b]:yo.push(b)):(P.next=x.next,x.next=P),b.interleaved=P):(x=b.pending,x===null?P.next=P:(P.next=x.next,x.next=P),b.pending=P)}function cm(x,b,P){if((P&4194240)!==0){var O=b.lanes;O&=x.pendingLanes,P|=O,b.lanes=P,ml(x,P)}}var of={readContext:_a,useCallback:jn,useContext:jn,useEffect:jn,useImperativeHandle:jn,useInsertionEffect:jn,useLayoutEffect:jn,useMemo:jn,useReducer:jn,useRef:jn,useState:jn,useDebugValue:jn,useDeferredValue:jn,useTransition:jn,useMutableSource:jn,useSyncExternalStore:jn,useId:jn,unstable_isNewReconciler:!1},y1={readContext:_a,useCallback:function(x,b){return Ko().memoizedState=[x,b===void 0?null:b],x},useContext:_a,useEffect:kv,useImperativeHandle:function(x,b,P){return P=P!=null?P.concat([x]):null,rc(4194308,4,lm.bind(null,b,x),P)},useLayoutEffect:function(x,b){return rc(4194308,4,x,b)},useInsertionEffect:function(x,b){return rc(4,2,x,b)},useMemo:function(x,b){var P=Ko();return b=b===void 0?null:b,x=x(),P.memoizedState=[x,b],x},useReducer:function(x,b,P){var O=Ko();return b=P!==void 0?P(b):b,O.memoizedState=O.baseState=b,x={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:x,lastRenderedState:b},O.queue=x,x=x.dispatch=vS.bind(null,Wr,x),[O.memoizedState,x]},useRef:function(x){var b=Ko();return x={current:x},b.memoizedState=x},useState:am,useDebugValue:Nv,useDeferredValue:function(x){var b=am(x),P=b[0],O=b[1];return kv(function(){var U=Ga.transition;Ga.transition={};try{O(x)}finally{Ga.transition=U}},[x]),P},useTransition:function(){var x=am(!1),b=x[0];return x=Uv.bind(null,x[1]),Ko().memoizedState=x,[b,x]},useMutableSource:function(){},useSyncExternalStore:function(x,b,P){var O=Wr,U=Ko();if(Br){if(P===void 0)throw Error(a(407));P=P()}else{if(P=b(),Gr===null)throw Error(a(349));(yh&30)!==0||m1(O,b,P)}U.memoizedState=P;var Q={value:P,getSnapshot:b};return U.queue=Q,kv(iu.bind(null,O,Q,x),[x]),O.flags|=2048,om(9,g1.bind(null,O,Q,P,b),void 0,null),P},useId:function(){var x=Ko(),b=Gr.identifierPrefix;if(Br){var P=eu,O=$l;P=(O&~(1<<32-mo(O)-1)).toString(32)+P,b=":"+b+"R"+P,P=xh++,0<P&&(b+="H"+P.toString(32)),b+=":"}else P=rm++,b=":"+b+"r"+P.toString(32)+":";return x.memoizedState=b},unstable_isNewReconciler:!1},x1={readContext:_a,useCallback:Fv,useContext:_a,useEffect:nf,useImperativeHandle:sf,useInsertionEffect:Ar,useLayoutEffect:Bv,useMemo:af,useReducer:nm,useRef:gS,useState:function(){return nm(yl)},useDebugValue:Nv,useDeferredValue:function(x){var b=nm(yl),P=b[0],O=b[1];return nf(function(){var U=Ga.transition;Ga.transition={};try{O(x)}finally{Ga.transition=U}},[x]),P},useTransition:function(){var x=nm(yl)[0],b=Zo().memoizedState;return[x,b]},useMutableSource:f1,useSyncExternalStore:p1,useId:wh,unstable_isNewReconciler:!1},w1={readContext:_a,useCallback:Fv,useContext:_a,useEffect:nf,useImperativeHandle:sf,useInsertionEffect:Ar,useLayoutEffect:Bv,useMemo:af,useReducer:sm,useRef:gS,useState:function(){return sm(yl)},useDebugValue:Nv,useDeferredValue:function(x){var b=sm(yl),P=b[0],O=b[1];return nf(function(){var U=Ga.transition;Ga.transition={};try{O(x)}finally{Ga.transition=U}},[x]),P},useTransition:function(){var x=sm(yl)[0],b=Zo().memoizedState;return[x,b]},useMutableSource:f1,useSyncExternalStore:p1,useId:wh,unstable_isNewReconciler:!1};function b1(x,b){try{var P="",O=b;do P+=r1(O),O=O.return;while(O);var U=P}catch(Q){U=`
Error generating stack: `+Q.message+`
`+Q.stack}return{value:x,source:b,stack:U}}function Vv(x,b){try{console.error(b.value)}catch(P){setTimeout(function(){throw P})}}var ET=typeof WeakMap=="function"?WeakMap:Map;function xS(x,b,P){P=Jl(-1,P),P.tag=3,P.payload={element:null};var O=b.value;return P.callback=function(){lc||(lc=!0,Ao=O),Vv(x,b)},P}function jv(x,b,P){P=Jl(-1,P),P.tag=3;var O=x.type.getDerivedStateFromError;if(typeof O=="function"){var U=b.value;P.payload=function(){return O(U)},P.callback=function(){Vv(x,b)}}var Q=x.stateNode;return Q!==null&&typeof Q.componentDidCatch=="function"&&(P.callback=function(){Vv(x,b),typeof O!="function"&&(Eo===null?Eo=new Set([this]):Eo.add(this));var be=b.stack;this.componentDidCatch(b.value,{componentStack:be!==null?be:""})}),P}function ru(x,b,P){var O=x.pingCache;if(O===null){O=x.pingCache=new ET;var U=new Set;O.set(b,U)}else U=O.get(b),U===void 0&&(U=new Set,O.set(b,U));U.has(P)||(U.add(P),x=SS.bind(null,x,b,P),b.then(x,x))}function _1(x){do{var b;if((b=x.tag===13)&&(b=x.memoizedState,b=b!==null?b.dehydrated!==null:!0),b)return x;x=x.return}while(x!==null);return null}function bh(x,b,P,O,U){return(x.mode&1)===0?(x===b?x.flags|=65536:(x.flags|=128,P.flags|=131072,P.flags&=-52805,P.tag===1&&(P.alternate===null?P.tag=17:(b=Jl(-1,1),b.tag=2,Ju(P,b))),P.lanes|=1),x):(x.flags|=65536,x.lanes=U,x)}function En(x){x.flags|=4}function lf(x,b){if(x!==null&&x.child===b.child)return!0;if((b.flags&16)!==0)return!1;for(x=b.child;x!==null;){if((x.flags&12854)!==0||(x.subtreeFlags&12854)!==0)return!1;x=x.sibling}return!0}var qa,_h,Hv,Wv;if(Ie)qa=function(x,b){for(var P=b.child;P!==null;){if(P.tag===5||P.tag===6)Y(x,P.stateNode);else if(P.tag!==4&&P.child!==null){P.child.return=P,P=P.child;continue}if(P===b)break;for(;P.sibling===null;){if(P.return===null||P.return===b)return;P=P.return}P.sibling.return=P.return,P=P.sibling}},_h=function(){},Hv=function(x,b,P,O,U){if(x=x.memoizedProps,x!==O){var Q=b.stateNode,be=Qo(Sa.current);P=oe(Q,P,x,O,U,be),(b.updateQueue=P)&&En(b)}},Wv=function(x,b,P,O){P!==O&&En(b)};else if(Me){qa=function(x,b,P,O){for(var U=b.child;U!==null;){if(U.tag===5){var Q=U.stateNode;P&&O&&(Q=ri(Q,U.type,U.memoizedProps,U)),Y(x,Q)}else if(U.tag===6)Q=U.stateNode,P&&O&&(Q=Yi(Q,U.memoizedProps,U)),Y(x,Q);else if(U.tag!==4){if(U.tag===22&&U.memoizedState!==null)Q=U.child,Q!==null&&(Q.return=U),qa(x,U,!0,!0);else if(U.child!==null){U.child.return=U,U=U.child;continue}}if(U===b)break;for(;U.sibling===null;){if(U.return===null||U.return===b)return;U=U.return}U.sibling.return=U.return,U=U.sibling}};var nc=function(x,b,P,O){for(var U=b.child;U!==null;){if(U.tag===5){var Q=U.stateNode;P&&O&&(Q=ri(Q,U.type,U.memoizedProps,U)),si(x,Q)}else if(U.tag===6)Q=U.stateNode,P&&O&&(Q=Yi(Q,U.memoizedProps,U)),si(x,Q);else if(U.tag!==4){if(U.tag===22&&U.memoizedState!==null)Q=U.child,Q!==null&&(Q.return=U),nc(x,U,!0,!0);else if(U.child!==null){U.child.return=U,U=U.child;continue}}if(U===b)break;for(;U.sibling===null;){if(U.return===null||U.return===b)return;U=U.return}U.sibling.return=U.return,U=U.sibling}};_h=function(x,b){var P=b.stateNode;if(!lf(x,b)){x=P.containerInfo;var O=Ut(x);nc(O,b,!1,!1),P.pendingChildren=O,En(b),Si(x,O)}},Hv=function(x,b,P,O,U){var Q=x.stateNode,be=x.memoizedProps;if((x=lf(x,b))&&be===O)b.stateNode=Q;else{var Be=b.stateNode,st=Qo(Sa.current),Ct=null;be!==O&&(Ct=oe(Be,P,be,O,U,st)),x&&Ct===null?b.stateNode=Q:(Q=ct(Q,Ct,P,be,O,b,x,Be),le(Q,P,O,U,st)&&En(b),b.stateNode=Q,x?En(b):qa(Q,b,!1,!1))}},Wv=function(x,b,P,O){P!==O?(x=Qo(gh.current),P=Qo(Sa.current),b.stateNode=ue(O,x,P,b),En(b)):b.stateNode=x.stateNode}}else _h=function(){},Hv=function(){},Wv=function(){};function nu(x,b){if(!Br)switch(x.tailMode){case"hidden":b=x.tail;for(var P=null;b!==null;)b.alternate!==null&&(P=b),b=b.sibling;P===null?x.tail=null:P.sibling=null;break;case"collapsed":P=x.tail;for(var O=null;P!==null;)P.alternate!==null&&(O=P),P=P.sibling;O===null?b||x.tail===null?x.tail=null:x.tail.sibling=null:O.sibling=null}}function nn(x){var b=x.alternate!==null&&x.alternate.child===x.child,P=0,O=0;if(b)for(var U=x.child;U!==null;)P|=U.lanes|U.childLanes,O|=U.subtreeFlags&14680064,O|=U.flags&14680064,U.return=x,U=U.sibling;else for(U=x.child;U!==null;)P|=U.lanes|U.childLanes,O|=U.subtreeFlags,O|=U.flags,U.return=x,U=U.sibling;return x.subtreeFlags|=O,x.childLanes=P,b}function Gv(x,b,P){var O=b.pendingProps;switch(u1(b),b.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return nn(b),null;case 1:return rn(b.type)&&ja(),nn(b),null;case 3:return O=b.stateNode,tf(),ee(Oe),ee(ce),vh(),O.pendingContext&&(O.context=O.pendingContext,O.pendingContext=null),(x===null||x.child===null)&&(tm(b)?En(b):x===null||x.memoizedState.isDehydrated&&(b.flags&256)===0||(b.flags|=1024,bo!==null&&(an(bo),bo=null))),_h(x,b),nn(b),null;case 5:d1(b),P=Qo(gh.current);var U=b.type;if(x!==null&&b.stateNode!=null)Hv(x,b,U,O,P),x.ref!==b.ref&&(b.flags|=512,b.flags|=2097152);else{if(!O){if(b.stateNode===null)throw Error(a(166));return nn(b),null}if(x=Qo(Sa.current),tm(b)){if(!De)throw Error(a(175));x=gt(b.stateNode,b.type,b.memoizedProps,P,x,b,!Kd),b.updateQueue=x,x!==null&&En(b)}else{var Q=X(U,O,P,x,b);qa(Q,b,!1,!1),b.stateNode=Q,le(Q,U,O,P,x)&&En(b)}b.ref!==null&&(b.flags|=512,b.flags|=2097152)}return nn(b),null;case 6:if(x&&b.stateNode!=null)Wv(x,b,x.memoizedProps,O);else{if(typeof O!="string"&&b.stateNode===null)throw Error(a(166));if(x=Qo(gh.current),P=Qo(Sa.current),tm(b)){if(!De)throw Error(a(176));if(x=b.stateNode,O=b.memoizedProps,(P=St(x,O,b,!Kd))&&(U=Zs,U!==null))switch(Q=(U.mode&1)!==0,U.tag){case 3:Qr(U.stateNode.containerInfo,x,O,Q);break;case 5:ir(U.type,U.memoizedProps,U.stateNode,x,O,Q)}P&&En(b)}else b.stateNode=ue(O,x,P,b)}return nn(b),null;case 13:if(ee(Hr),O=b.memoizedState,Br&&cs!==null&&(b.mode&1)!==0&&(b.flags&128)===0){for(x=cs;x;)x=ve(x);return Zd(),b.flags|=98560,b}if(O!==null&&O.dehydrated!==null){if(O=tm(b),x===null){if(!O)throw Error(a(318));if(!De)throw Error(a(344));if(x=b.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(a(317));Tt(x,b)}else Zd(),(b.flags&128)===0&&(b.memoizedState=null),b.flags|=4;return nn(b),null}return bo!==null&&(an(bo),bo=null),(b.flags&128)!==0?(b.lanes=P,b):(O=O!==null,P=!1,x===null?tm(b):P=x.memoizedState!==null,O&&!P&&(b.child.flags|=8192,(b.mode&1)!==0&&(x===null||(Hr.current&1)!==0?dn===0&&(dn=3):xm())),b.updateQueue!==null&&(b.flags|=4),nn(b),null);case 4:return tf(),_h(x,b),x===null&&Ge(b.stateNode.containerInfo),nn(b),null;case 10:return em(b.type._context),nn(b),null;case 17:return rn(b.type)&&ja(),nn(b),null;case 19:if(ee(Hr),U=b.memoizedState,U===null)return nn(b),null;if(O=(b.flags&128)!==0,Q=U.rendering,Q===null)if(O)nu(U,!1);else{if(dn!==0||x!==null&&(x.flags&128)!==0)for(x=b.child;x!==null;){if(Q=Rv(x),Q!==null){for(b.flags|=128,nu(U,!1),x=Q.updateQueue,x!==null&&(b.updateQueue=x,b.flags|=4),b.subtreeFlags=0,x=P,O=b.child;O!==null;)P=O,U=x,P.flags&=14680066,Q=P.alternate,Q===null?(P.childLanes=0,P.lanes=U,P.child=null,P.subtreeFlags=0,P.memoizedProps=null,P.memoizedState=null,P.updateQueue=null,P.dependencies=null,P.stateNode=null):(P.childLanes=Q.childLanes,P.lanes=Q.lanes,P.child=Q.child,P.subtreeFlags=0,P.deletions=null,P.memoizedProps=Q.memoizedProps,P.memoizedState=Q.memoizedState,P.updateQueue=Q.updateQueue,P.type=Q.type,U=Q.dependencies,P.dependencies=U===null?null:{lanes:U.lanes,firstContext:U.firstContext}),O=O.sibling;return ae(Hr,Hr.current&1|2),b.child}x=x.sibling}U.tail!==null&&An()>oc&&(b.flags|=128,O=!0,nu(U,!1),b.lanes=4194304)}else{if(!O)if(x=Rv(Q),x!==null){if(b.flags|=128,O=!0,x=x.updateQueue,x!==null&&(b.updateQueue=x,b.flags|=4),nu(U,!0),U.tail===null&&U.tailMode==="hidden"&&!Q.alternate&&!Br)return nn(b),null}else 2*An()-U.renderingStartTime>oc&&P!==1073741824&&(b.flags|=128,O=!0,nu(U,!1),b.lanes=4194304);U.isBackwards?(Q.sibling=b.child,b.child=Q):(x=U.last,x!==null?x.sibling=Q:b.child=Q,U.last=Q)}return U.tail!==null?(b=U.tail,U.rendering=b,U.tail=b.sibling,U.renderingStartTime=An(),b.sibling=null,x=Hr.current,ae(Hr,O?x&1|2:x&1),b):(nn(b),null);case 22:case 23:return R1(),O=b.memoizedState!==null,x!==null&&x.memoizedState!==null!==O&&(b.flags|=8192),O&&(b.mode&1)!==0?(ia&1073741824)!==0&&(nn(b),Ie&&b.subtreeFlags&6&&(b.flags|=8192)):nn(b),null;case 24:return null;case 25:return null}throw Error(a(156,b.tag))}var S1=o.ReactCurrentOwner,Hn=!1;function Kr(x,b,P,O){b.child=x===null?pS(b,null,P,O):tu(b,x.child,P,O)}function Er(x,b,P,O,U){P=P.render;var Q=b.ref;return Xd(b,U),O=rf(x,b,P,O,Q,U),P=ic(),x!==null&&!Hn?(b.updateQueue=x.updateQueue,b.flags&=-2053,x.lanes&=~U,Ma(x,b,U)):(Br&&P&&l1(b),b.flags|=1,Kr(x,b,O,U),b.child)}function yr(x,b,P,O,U){if(x===null){var Q=P.type;return typeof Q=="function"&&!Sm(Q)&&Q.defaultProps===void 0&&P.compare===null&&P.defaultProps===void 0?(b.tag=15,b.type=Q,su(x,b,Q,O,U)):(x=Mm(P.type,null,O,b,b.mode,U),x.ref=b.ref,x.return=b,b.child=x)}if(Q=x.child,(x.lanes&U)===0){var be=Q.memoizedProps;if(P=P.compare,P=P!==null?P:Yo,P(be,O)&&x.ref===b.ref)return Ma(x,b,U)}return b.flags|=1,x=du(Q,O),x.ref=b.ref,x.return=b,b.child=x}function su(x,b,P,O,U){if(x!==null&&Yo(x.memoizedProps,O)&&x.ref===b.ref)if(Hn=!1,(x.lanes&U)!==0)(x.flags&131072)!==0&&(Hn=!0);else return b.lanes=x.lanes,Ma(x,b,U);return au(x,b,P,O,U)}function hs(x,b,P){var O=b.pendingProps,U=O.children,Q=x!==null?x.memoizedState:null;if(O.mode==="hidden")if((b.mode&1)===0)b.memoizedState={baseLanes:0,cachePool:null},ae(hu,ia),ia|=P;else if((P&1073741824)!==0)b.memoizedState={baseLanes:0,cachePool:null},O=Q!==null?Q.baseLanes:P,ae(hu,ia),ia|=O;else return x=Q!==null?Q.baseLanes|P:P,b.lanes=b.childLanes=1073741824,b.memoizedState={baseLanes:x,cachePool:null},b.updateQueue=null,ae(hu,ia),ia|=x,null;else Q!==null?(O=Q.baseLanes|P,b.memoizedState=null):O=P,ae(hu,ia),ia|=O;return Kr(x,b,U,P),b.child}function Js(x,b){var P=b.ref;(x===null&&P!==null||x!==null&&x.ref!==P)&&(b.flags|=512,b.flags|=2097152)}function au(x,b,P,O,U){var Q=rn(P)?vt:ce.current;return Q=Mn(b,Q),Xd(b,U),P=rf(x,b,P,O,Q,U),O=ic(),x!==null&&!Hn?(b.updateQueue=x.updateQueue,b.flags&=-2053,x.lanes&=~U,Ma(x,b,U)):(Br&&O&&l1(b),b.flags|=1,Kr(x,b,P,U),b.child)}function Sh(x,b,P,O,U){if(rn(P)){var Q=!0;Ku(b)}else Q=!1;if(Xd(b,U),b.stateNode===null)x!==null&&(x.alternate=null,b.alternate=null,b.flags|=2),uS(b,P,O),o1(b,P,O,U),O=!0;else if(x===null){var be=b.stateNode,Be=b.memoizedProps;be.props=Be;var st=be.context,Ct=P.contextType;typeof Ct=="object"&&Ct!==null?Ct=_a(Ct):(Ct=rn(P)?vt:ce.current,Ct=Mn(b,Ct));var Gt=P.getDerivedStateFromProps,Ti=typeof Gt=="function"||typeof be.getSnapshotBeforeUpdate=="function";Ti||typeof be.UNSAFE_componentWillReceiveProps!="function"&&typeof be.componentWillReceiveProps!="function"||(Be!==O||st!==Ct)&&cS(b,be,O,Ct),xo=!1;var ci=b.memoizedState;be.state=ci,Mv(b,O,be,U),st=b.memoizedState,Be!==O||ci!==st||Oe.current||xo?(typeof Gt=="function"&&(s1(b,P,Gt,O),st=b.memoizedState),(Be=xo||a1(b,P,Be,O,ci,st,Ct))?(Ti||typeof be.UNSAFE_componentWillMount!="function"&&typeof be.componentWillMount!="function"||(typeof be.componentWillMount=="function"&&be.componentWillMount(),typeof be.UNSAFE_componentWillMount=="function"&&be.UNSAFE_componentWillMount()),typeof be.componentDidMount=="function"&&(b.flags|=4194308)):(typeof be.componentDidMount=="function"&&(b.flags|=4194308),b.memoizedProps=O,b.memoizedState=st),be.props=O,be.state=st,be.context=Ct,O=Be):(typeof be.componentDidMount=="function"&&(b.flags|=4194308),O=!1)}else{be=b.stateNode,n1(x,b),Be=b.memoizedProps,Ct=b.type===b.elementType?Be:ba(b.type,Be),be.props=Ct,Ti=b.pendingProps,ci=be.context,st=P.contextType,typeof st=="object"&&st!==null?st=_a(st):(st=rn(P)?vt:ce.current,st=Mn(b,st));var xr=P.getDerivedStateFromProps;(Gt=typeof xr=="function"||typeof be.getSnapshotBeforeUpdate=="function")||typeof be.UNSAFE_componentWillReceiveProps!="function"&&typeof be.componentWillReceiveProps!="function"||(Be!==Ti||ci!==st)&&cS(b,be,O,st),xo=!1,ci=b.memoizedState,be.state=ci,Mv(b,O,be,U);var jt=b.memoizedState;Be!==Ti||ci!==jt||Oe.current||xo?(typeof xr=="function"&&(s1(b,P,xr,O),jt=b.memoizedState),(Ct=xo||a1(b,P,Ct,O,ci,jt,st)||!1)?(Gt||typeof be.UNSAFE_componentWillUpdate!="function"&&typeof be.componentWillUpdate!="function"||(typeof be.componentWillUpdate=="function"&&be.componentWillUpdate(O,jt,st),typeof be.UNSAFE_componentWillUpdate=="function"&&be.UNSAFE_componentWillUpdate(O,jt,st)),typeof be.componentDidUpdate=="function"&&(b.flags|=4),typeof be.getSnapshotBeforeUpdate=="function"&&(b.flags|=1024)):(typeof be.componentDidUpdate!="function"||Be===x.memoizedProps&&ci===x.memoizedState||(b.flags|=4),typeof be.getSnapshotBeforeUpdate!="function"||Be===x.memoizedProps&&ci===x.memoizedState||(b.flags|=1024),b.memoizedProps=O,b.memoizedState=jt),be.props=O,be.state=jt,be.context=st,O=Ct):(typeof be.componentDidUpdate!="function"||Be===x.memoizedProps&&ci===x.memoizedState||(b.flags|=4),typeof be.getSnapshotBeforeUpdate!="function"||Be===x.memoizedProps&&ci===x.memoizedState||(b.flags|=1024),O=!1)}return Ds(x,b,P,O,Q,U)}function Ds(x,b,P,O,U,Q){Js(x,b);var be=(b.flags&128)!==0;if(!O&&!be)return U&&dv(b,P,!1),Ma(x,b,Q);O=b.stateNode,S1.current=b;var Be=be&&typeof P.getDerivedStateFromError!="function"?null:O.render();return b.flags|=1,x!==null&&be?(b.child=tu(b,x.child,null,Q),b.child=tu(b,null,Be,Q)):Kr(x,b,Be,Q),b.memoizedState=O.state,U&&dv(b,P,!0),b.child}function hm(x){var b=x.stateNode;b.pendingContext?Ql(x,b.pendingContext,b.pendingContext!==b.context):b.context&&Ql(x,b.context,!1),Dv(x,b.containerInfo)}function M1(x,b,P,O,U){return Zd(),Pv(U),b.flags|=256,Kr(x,b,P,O),b.child}var dm={dehydrated:null,treeContext:null,retryLane:0};function Mh(x){return{baseLanes:x,cachePool:null}}function A1(x,b,P){var O=b.pendingProps,U=Hr.current,Q=!1,be=(b.flags&128)!==0,Be;if((Be=be)||(Be=x!==null&&x.memoizedState===null?!1:(U&2)!==0),Be?(Q=!0,b.flags&=-129):(x===null||x.memoizedState!==null)&&(U|=1),ae(Hr,U&1),x===null)return ec(b),x=b.memoizedState,x!==null&&(x=x.dehydrated,x!==null)?((b.mode&1)===0?b.lanes=1:ge(x)?b.lanes=8:b.lanes=1073741824,null):(U=O.children,x=O.fallback,Q?(O=b.mode,Q=b.child,U={mode:"hidden",children:U},(O&1)===0&&Q!==null?(Q.childLanes=0,Q.pendingProps=U):Q=wf(U,O,0,null),x=fc(x,O,P,null),Q.return=b,x.return=b,Q.sibling=x,b.child=Q,b.child.memoizedState=Mh(P),b.memoizedState=dm,x):Jo(b,U));if(U=x.memoizedState,U!==null){if(Be=U.dehydrated,Be!==null){if(be)return b.flags&256?(b.flags&=-257,pm(x,b,P,Error(a(422)))):b.memoizedState!==null?(b.child=x.child,b.flags|=128,null):(Q=O.fallback,U=b.mode,O=wf({mode:"visible",children:O.children},U,0,null),Q=fc(Q,U,P,null),Q.flags|=2,O.return=b,Q.return=b,O.sibling=Q,b.child=O,(b.mode&1)!==0&&tu(b,x.child,null,P),b.child.memoizedState=Mh(P),b.memoizedState=dm,Q);if((b.mode&1)===0)b=pm(x,b,P,null);else if(ge(Be))b=pm(x,b,P,Error(a(419)));else if(O=(P&x.childLanes)!==0,Hn||O){if(O=Gr,O!==null){switch(P&-P){case 4:Q=2;break;case 16:Q=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:Q=32;break;case 536870912:Q=268435456;break;default:Q=0}O=(Q&(O.suspendedLanes|P))!==0?0:Q,O!==0&&O!==U.retryLane&&(U.retryLane=O,Ea(x,O,-1))}xm(),b=pm(x,b,P,Error(a(421)))}else Qu(Be)?(b.flags|=128,b.child=x.child,b=MS.bind(null,x),te(Be,b),b=null):(P=U.treeContext,De&&(cs=Ne(Be),Zs=b,Br=!0,bo=null,Kd=!1,P!==null&&(wo[Ha++]=$l,wo[Ha++]=eu,wo[Ha++]=fh,$l=P.id,eu=P.overflow,fh=b)),b=Jo(b,b.pendingProps.children),b.flags|=4096);return b}return Q?(O=qv(x,b,O.children,O.fallback,P),Q=b.child,U=x.child.memoizedState,Q.memoizedState=U===null?Mh(P):{baseLanes:U.baseLanes|P,cachePool:null},Q.childLanes=x.childLanes&~P,b.memoizedState=dm,O):(P=fm(x,b,O.children,P),b.memoizedState=null,P)}return Q?(O=qv(x,b,O.children,O.fallback,P),Q=b.child,U=x.child.memoizedState,Q.memoizedState=U===null?Mh(P):{baseLanes:U.baseLanes|P,cachePool:null},Q.childLanes=x.childLanes&~P,b.memoizedState=dm,O):(P=fm(x,b,O.children,P),b.memoizedState=null,P)}function Jo(x,b){return b=wf({mode:"visible",children:b},x.mode,0,null),b.return=x,x.child=b}function fm(x,b,P,O){var U=x.child;return x=U.sibling,P=du(U,{mode:"visible",children:P}),(b.mode&1)===0&&(P.lanes=O),P.return=b,P.sibling=null,x!==null&&(O=b.deletions,O===null?(b.deletions=[x],b.flags|=16):O.push(x)),b.child=P}function qv(x,b,P,O,U){var Q=b.mode;x=x.child;var be=x.sibling,Be={mode:"hidden",children:P};return(Q&1)===0&&b.child!==x?(P=b.child,P.childLanes=0,P.pendingProps=Be,b.deletions=null):(P=du(x,Be),P.subtreeFlags=x.subtreeFlags&14680064),be!==null?O=du(be,O):(O=fc(O,Q,U,null),O.flags|=2),O.return=b,P.return=b,P.sibling=O,b.child=P,O}function pm(x,b,P,O){return O!==null&&Pv(O),tu(b,x.child,null,P),x=Jo(b,b.pendingProps.children),x.flags|=2,b.memoizedState=null,x}function wS(x,b,P){x.lanes|=b;var O=x.alternate;O!==null&&(O.lanes|=b),dh(x.return,b,P)}function xl(x,b,P,O,U){var Q=x.memoizedState;Q===null?x.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:O,tail:P,tailMode:U}:(Q.isBackwards=b,Q.rendering=null,Q.renderingStartTime=0,Q.last=O,Q.tail=P,Q.tailMode=U)}function Ah(x,b,P){var O=b.pendingProps,U=O.revealOrder,Q=O.tail;if(Kr(x,b,O.children,P),O=Hr.current,(O&2)!==0)O=O&1|2,b.flags|=128;else{if(x!==null&&(x.flags&128)!==0)e:for(x=b.child;x!==null;){if(x.tag===13)x.memoizedState!==null&&wS(x,P,b);else if(x.tag===19)wS(x,P,b);else if(x.child!==null){x.child.return=x,x=x.child;continue}if(x===b)break e;for(;x.sibling===null;){if(x.return===null||x.return===b)break e;x=x.return}x.sibling.return=x.return,x=x.sibling}O&=1}if(ae(Hr,O),(b.mode&1)===0)b.memoizedState=null;else switch(U){case"forwards":for(P=b.child,U=null;P!==null;)x=P.alternate,x!==null&&Rv(x)===null&&(U=P),P=P.sibling;P=U,P===null?(U=b.child,b.child=null):(U=P.sibling,P.sibling=null),xl(b,!1,U,P,Q);break;case"backwards":for(P=null,U=b.child,b.child=null;U!==null;){if(x=U.alternate,x!==null&&Rv(x)===null){b.child=U;break}x=U.sibling,U.sibling=P,P=U,U=x}xl(b,!0,P,null,Q);break;case"together":xl(b,!1,null,null,void 0);break;default:b.memoizedState=null}return b.child}function Ma(x,b,P){if(x!==null&&(b.dependencies=x.dependencies),Th|=b.lanes,(P&b.childLanes)===0)return null;if(x!==null&&b.child!==x.child)throw Error(a(153));if(b.child!==null){for(x=b.child,P=du(x,x.pendingProps),b.child=P,P.return=b;x.sibling!==null;)x=x.sibling,P=P.sibling=du(x,x.pendingProps),P.return=b;P.sibling=null}return b.child}function Xv(x,b,P){switch(b.tag){case 3:hm(b),Zd();break;case 5:mS(b);break;case 1:rn(b.type)&&Ku(b);break;case 4:Dv(b,b.stateNode.containerInfo);break;case 10:hh(b,b.type._context,b.memoizedProps.value);break;case 13:var O=b.memoizedState;if(O!==null)return O.dehydrated!==null?(ae(Hr,Hr.current&1),b.flags|=128,null):(P&b.child.childLanes)!==0?A1(x,b,P):(ae(Hr,Hr.current&1),x=Ma(x,b,P),x!==null?x.sibling:null);ae(Hr,Hr.current&1);break;case 19:if(O=(P&b.childLanes)!==0,(x.flags&128)!==0){if(O)return Ah(x,b,P);b.flags|=128}var U=b.memoizedState;if(U!==null&&(U.rendering=null,U.tail=null,U.lastEffect=null),ae(Hr,Hr.current),O)break;return null;case 22:case 23:return b.lanes=0,hs(x,b,P)}return Ma(x,b,P)}function Yv(x,b){switch(u1(b),b.tag){case 1:return rn(b.type)&&ja(),x=b.flags,x&65536?(b.flags=x&-65537|128,b):null;case 3:return tf(),ee(Oe),ee(ce),vh(),x=b.flags,(x&65536)!==0&&(x&128)===0?(b.flags=x&-65537|128,b):null;case 5:return d1(b),null;case 13:if(ee(Hr),x=b.memoizedState,x!==null&&x.dehydrated!==null){if(b.alternate===null)throw Error(a(340));Zd()}return x=b.flags,x&65536?(b.flags=x&-65537|128,b):null;case 19:return ee(Hr),null;case 4:return tf(),null;case 10:return em(b.type._context),null;case 22:case 23:return R1(),null;case 24:return null;default:return null}}var $s=!1,Wn=!1,Eh=typeof WeakSet=="function"?WeakSet:Set,It=null;function _o(x,b){var P=x.ref;if(P!==null)if(typeof P=="function")try{P(null)}catch(O){na(x,b,O)}else P.current=null}function ou(x,b,P){try{P()}catch(O){na(x,b,O)}}var E1=!1;function C1(x,b){for(Z(x.containerInfo),It=b;It!==null;)if(x=It,b=x.child,(x.subtreeFlags&1028)!==0&&b!==null)b.return=x,It=b;else for(;It!==null;){x=It;try{var P=x.alternate;if((x.flags&1024)!==0)switch(x.tag){case 0:case 11:case 15:break;case 1:if(P!==null){var O=P.memoizedProps,U=P.memoizedState,Q=x.stateNode,be=Q.getSnapshotBeforeUpdate(x.elementType===x.type?O:ba(x.type,O),U);Q.__reactInternalSnapshotBeforeUpdate=be}break;case 3:Ie&&We(x.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(a(163))}}catch(Be){na(x,x.return,Be)}if(b=x.sibling,b!==null){b.return=x.return,It=b;break}It=x.return}return P=E1,E1=!1,P}function lu(x,b,P){var O=b.updateQueue;if(O=O!==null?O.lastEffect:null,O!==null){var U=O=O.next;do{if((U.tag&x)===x){var Q=U.destroy;U.destroy=void 0,Q!==void 0&&ou(b,P,Q)}U=U.next}while(U!==O)}}function ds(x,b){if(b=b.updateQueue,b=b!==null?b.lastEffect:null,b!==null){var P=b=b.next;do{if((P.tag&x)===x){var O=P.create;P.destroy=O()}P=P.next}while(P!==b)}}function ea(x){var b=x.ref;if(b!==null){var P=x.stateNode;switch(x.tag){case 5:x=ne(P);break;default:x=P}typeof b=="function"?b(x):b.current=x}}function Rr(x,b,P){if(gl&&typeof gl.onCommitFiberUnmount=="function")try{gl.onCommitFiberUnmount(Kp,b)}catch{}switch(b.tag){case 0:case 11:case 14:case 15:if(x=b.updateQueue,x!==null&&(x=x.lastEffect,x!==null)){var O=x=x.next;do{var U=O,Q=U.destroy;U=U.tag,Q!==void 0&&((U&2)!==0||(U&4)!==0)&&ou(b,P,Q),O=O.next}while(O!==x)}break;case 1:if(_o(b,P),x=b.stateNode,typeof x.componentWillUnmount=="function")try{x.props=b.memoizedProps,x.state=b.memoizedState,x.componentWillUnmount()}catch(be){na(b,P,be)}break;case 5:_o(b,P);break;case 4:Ie?D1(x,b,P):Me&&Me&&(b=b.stateNode.containerInfo,P=Ut(b),ar(b,P))}}function So(x,b,P){for(var O=b;;)if(Rr(x,O,P),O.child===null||Ie&&O.tag===4){if(O===b)break;for(;O.sibling===null;){if(O.return===null||O.return===b)return;O=O.return}O.sibling.return=O.return,O=O.sibling}else O.child.return=O,O=O.child}function T1(x){var b=x.alternate;b!==null&&(x.alternate=null,T1(b)),x.child=null,x.deletions=null,x.sibling=null,x.tag===5&&(b=x.stateNode,b!==null&&ot(b)),x.stateNode=null,x.return=null,x.dependencies=null,x.memoizedProps=null,x.memoizedState=null,x.pendingProps=null,x.stateNode=null,x.updateQueue=null}function P1(x){return x.tag===5||x.tag===3||x.tag===4}function Qv(x){e:for(;;){for(;x.sibling===null;){if(x.return===null||P1(x.return))return null;x=x.return}for(x.sibling.return=x.return,x=x.sibling;x.tag!==5&&x.tag!==6&&x.tag!==18;){if(x.flags&2||x.child===null||x.tag===4)continue e;x.child.return=x,x=x.child}if(!(x.flags&2))return x.stateNode}}function Kv(x){if(Ie){e:{for(var b=x.return;b!==null;){if(P1(b))break e;b=b.return}throw Error(a(160))}var P=b;switch(P.tag){case 5:b=P.stateNode,P.flags&32&&(it(b),P.flags&=-33),P=Qv(x),uf(x,P,b);break;case 3:case 4:b=P.stateNode.containerInfo,P=Qv(x),Zv(x,P,b);break;default:throw Error(a(161))}}}function Zv(x,b,P){var O=x.tag;if(O===5||O===6)x=x.stateNode,b?mt(P,x,b):Ye(P,x);else if(O!==4&&(x=x.child,x!==null))for(Zv(x,b,P),x=x.sibling;x!==null;)Zv(x,b,P),x=x.sibling}function uf(x,b,P){var O=x.tag;if(O===5||O===6)x=x.stateNode,b?pt(P,x,b):rt(P,x);else if(O!==4&&(x=x.child,x!==null))for(uf(x,b,P),x=x.sibling;x!==null;)uf(x,b,P),x=x.sibling}function D1(x,b,P){for(var O=b,U=!1,Q,be;;){if(!U){U=O.return;e:for(;;){if(U===null)throw Error(a(160));switch(Q=U.stateNode,U.tag){case 5:be=!1;break e;case 3:Q=Q.containerInfo,be=!0;break e;case 4:Q=Q.containerInfo,be=!0;break e}U=U.return}U=!0}if(O.tag===5||O.tag===6)So(x,O,P),be?_e(Q,O.stateNode):dt(Q,O.stateNode);else if(O.tag===18)be?$t(Q,O.stateNode):Yt(Q,O.stateNode);else if(O.tag===4){if(O.child!==null){Q=O.stateNode.containerInfo,be=!0,O.child.return=O,O=O.child;continue}}else if(Rr(x,O,P),O.child!==null){O.child.return=O,O=O.child;continue}if(O===b)break;for(;O.sibling===null;){if(O.return===null||O.return===b)return;O=O.return,O.tag===4&&(U=!1)}O.sibling.return=O.return,O=O.sibling}}function sc(x,b){if(Ie){switch(b.tag){case 0:case 11:case 14:case 15:lu(3,b,b.return),ds(3,b),lu(5,b,b.return);return;case 1:return;case 5:var P=b.stateNode;if(P!=null){var O=b.memoizedProps;x=x!==null?x.memoizedProps:O;var U=b.type,Q=b.updateQueue;b.updateQueue=null,Q!==null&&et(P,Q,U,x,O,b)}return;case 6:if(b.stateNode===null)throw Error(a(162));P=b.memoizedProps,Ee(b.stateNode,x!==null?x.memoizedProps:P,P);return;case 3:De&&x!==null&&x.memoizedState.isDehydrated&&Vt(b.stateNode.containerInfo);return;case 12:return;case 13:cf(b);return;case 19:cf(b);return;case 17:return}throw Error(a(163))}switch(b.tag){case 0:case 11:case 14:case 15:lu(3,b,b.return),ds(3,b),lu(5,b,b.return);return;case 12:return;case 13:cf(b);return;case 19:cf(b);return;case 3:De&&x!==null&&x.memoizedState.isDehydrated&&Vt(b.stateNode.containerInfo);break;case 22:case 23:return}e:if(Me){switch(b.tag){case 1:case 5:case 6:break e;case 3:case 4:b=b.stateNode,ar(b.containerInfo,b.pendingChildren);break e}throw Error(a(163))}}function cf(x){var b=x.updateQueue;if(b!==null){x.updateQueue=null;var P=x.stateNode;P===null&&(P=x.stateNode=new Eh),b.forEach(function(O){var U=bm.bind(null,x,O);P.has(O)||(P.add(O),O.then(U,U))})}}function CT(x,b){for(It=b;It!==null;){b=It;var P=b.deletions;if(P!==null)for(var O=0;O<P.length;O++){var U=P[O];try{var Q=x;Ie?D1(Q,U,b):So(Q,U,b);var be=U.alternate;be!==null&&(be.return=null),U.return=null}catch(ei){na(U,b,ei)}}if(P=b.child,(b.subtreeFlags&12854)!==0&&P!==null)P.return=b,It=P;else for(;It!==null;){b=It;try{var Be=b.flags;if(Be&32&&Ie&&it(b.stateNode),Be&512){var st=b.alternate;if(st!==null){var Ct=st.ref;Ct!==null&&(typeof Ct=="function"?Ct(null):Ct.current=null)}}if(Be&8192)switch(b.tag){case 13:if(b.memoizedState!==null){var Gt=b.alternate;(Gt===null||Gt.memoizedState===null)&&(e0=An())}break;case 22:var Ti=b.memoizedState!==null,ci=b.alternate,xr=ci!==null&&ci.memoizedState!==null;if(P=b,Ie){e:if(O=P,U=Ti,Q=null,Ie)for(var jt=O;;){if(jt.tag===5){if(Q===null){Q=jt;var cr=jt.stateNode;U?At(cr):we(jt.stateNode,jt.memoizedProps)}}else if(jt.tag===6){if(Q===null){var Qa=jt.stateNode;U?ie(Qa):Re(Qa,jt.memoizedProps)}}else if((jt.tag!==22&&jt.tag!==23||jt.memoizedState===null||jt===O)&&jt.child!==null){jt.child.return=jt,jt=jt.child;continue}if(jt===O)break;for(;jt.sibling===null;){if(jt.return===null||jt.return===O)break e;Q===jt&&(Q=null),jt=jt.return}Q===jt&&(Q=null),jt.sibling.return=jt.return,jt=jt.sibling}}if(Ti&&!xr&&(P.mode&1)!==0){It=P;for(var Xe=P.child;Xe!==null;){for(P=It=Xe;It!==null;){O=It;var Fe=O.child;switch(O.tag){case 0:case 11:case 14:case 15:lu(4,O,O.return);break;case 1:_o(O,O.return);var tt=O.stateNode;if(typeof tt.componentWillUnmount=="function"){var Nt=O.return;try{tt.props=O.memoizedProps,tt.state=O.memoizedState,tt.componentWillUnmount()}catch(ei){na(O,Nt,ei)}}break;case 5:_o(O,O.return);break;case 22:if(O.memoizedState!==null){Ch(P);continue}}Fe!==null?(Fe.return=O,It=Fe):Ch(P)}Xe=Xe.sibling}}}switch(Be&4102){case 2:Kv(b),b.flags&=-3;break;case 6:Kv(b),b.flags&=-3,sc(b.alternate,b);break;case 4096:b.flags&=-4097;break;case 4100:b.flags&=-4097,sc(b.alternate,b);break;case 4:sc(b.alternate,b)}}catch(ei){na(b,b.return,ei)}if(P=b.sibling,P!==null){P.return=b.return,It=P;break}It=b.return}}}function $o(x,b,P){It=x,mm(x)}function mm(x,b,P){for(var O=(x.mode&1)!==0;It!==null;){var U=It,Q=U.child;if(U.tag===22&&O){var be=U.memoizedState!==null||$s;if(!be){var Be=U.alternate,st=Be!==null&&Be.memoizedState!==null||Wn;Be=$s;var Ct=Wn;if($s=be,(Wn=st)&&!Ct)for(It=U;It!==null;)be=It,st=be.child,be.tag===22&&be.memoizedState!==null?Jv(U):st!==null?(st.return=be,It=st):Jv(U);for(;Q!==null;)It=Q,mm(Q),Q=Q.sibling;It=U,$s=Be,Wn=Ct}gm(x)}else(U.subtreeFlags&8772)!==0&&Q!==null?(Q.return=U,It=Q):gm(x)}}function gm(x){for(;It!==null;){var b=It;if((b.flags&8772)!==0){var P=b.alternate;try{if((b.flags&8772)!==0)switch(b.tag){case 0:case 11:case 15:Wn||ds(5,b);break;case 1:var O=b.stateNode;if(b.flags&4&&!Wn)if(P===null)O.componentDidMount();else{var U=b.elementType===b.type?P.memoizedProps:ba(b.type,P.memoizedProps);O.componentDidUpdate(U,P.memoizedState,O.__reactInternalSnapshotBeforeUpdate)}var Q=b.updateQueue;Q!==null&&oS(b,Q,O);break;case 3:var be=b.updateQueue;if(be!==null){if(P=null,b.child!==null)switch(b.child.tag){case 5:P=ne(b.child.stateNode);break;case 1:P=b.child.stateNode}oS(b,be,P)}break;case 5:var Be=b.stateNode;P===null&&b.flags&4&&lt(Be,b.type,b.memoizedProps,b);break;case 6:break;case 4:break;case 12:break;case 13:if(De&&b.memoizedState===null){var st=b.alternate;if(st!==null){var Ct=st.memoizedState;if(Ct!==null){var Gt=Ct.dehydrated;Gt!==null&&zt(Gt)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(a(163))}Wn||b.flags&512&&ea(b)}catch(Ti){na(b,b.return,Ti)}}if(b===x){It=null;break}if(P=b.sibling,P!==null){P.return=b.return,It=P;break}It=b.return}}function Ch(x){for(;It!==null;){var b=It;if(b===x){It=null;break}var P=b.sibling;if(P!==null){P.return=b.return,It=P;break}It=b.return}}function Jv(x){for(;It!==null;){var b=It;try{switch(b.tag){case 0:case 11:case 15:var P=b.return;try{ds(4,b)}catch(st){na(b,P,st)}break;case 1:var O=b.stateNode;if(typeof O.componentDidMount=="function"){var U=b.return;try{O.componentDidMount()}catch(st){na(b,U,st)}}var Q=b.return;try{ea(b)}catch(st){na(b,Q,st)}break;case 5:var be=b.return;try{ea(b)}catch(st){na(b,be,st)}}}catch(st){na(b,b.return,st)}if(b===x){It=null;break}var Be=b.sibling;if(Be!==null){Be.return=b.return,It=Be;break}It=b.return}}var hf=0,df=1,ff=2,uu=3,ta=4;if(typeof Symbol=="function"&&Symbol.for){var el=Symbol.for;hf=el("selector.component"),df=el("selector.has_pseudo_class"),ff=el("selector.role"),uu=el("selector.test_id"),ta=el("selector.text")}function vm(x){var b=Ve(x);if(b!=null){if(typeof b.memoizedProps["data-testname"]!="string")throw Error(a(364));return b}if(x=xt(x),x===null)throw Error(a(362));return x.stateNode.current}function $v(x,b){switch(b.$$typeof){case hf:if(x.type===b.value)return!0;break;case df:e:{b=b.value,x=[x,0];for(var P=0;P<x.length;){var O=x[P++],U=x[P++],Q=b[U];if(O.tag!==5||!de(O)){for(;Q!=null&&$v(O,Q);)U++,Q=b[U];if(U===b.length){b=!0;break e}else for(O=O.child;O!==null;)x.push(O,U),O=O.sibling}}b=!1}return b;case ff:if(x.tag===5&&ze(x.stateNode,b.value))return!0;break;case ta:if((x.tag===5||x.tag===6)&&(x=N(x),x!==null&&0<=x.indexOf(b.value)))return!0;break;case uu:if(x.tag===5&&(x=x.memoizedProps["data-testname"],typeof x=="string"&&x.toLowerCase()===b.value.toLowerCase()))return!0;break;default:throw Error(a(365))}return!1}function tl(x){switch(x.$$typeof){case hf:return"<"+(I(x.value)||"Unknown")+">";case df:return":has("+(tl(x)||"")+")";case ff:return'[role="'+x.value+'"]';case ta:return'"'+x.value+'"';case uu:return'[data-testname="'+x.value+'"]';default:throw Error(a(365))}}function cu(x,b){var P=[];x=[x,0];for(var O=0;O<x.length;){var U=x[O++],Q=x[O++],be=b[Q];if(U.tag!==5||!de(U)){for(;be!=null&&$v(U,be);)Q++,be=b[Q];if(Q===b.length)P.push(U);else for(U=U.child;U!==null;)x.push(U,Q),U=U.sibling}}return P}function ym(x,b){if(!bt)throw Error(a(363));x=vm(x),x=cu(x,b),b=[],x=Array.from(x);for(var P=0;P<x.length;){var O=x[P++];if(O.tag===5)de(O)||b.push(O.stateNode);else for(O=O.child;O!==null;)x.push(O),O=O.sibling}return b}var bS=Math.ceil,Mo=o.ReactCurrentDispatcher,wl=o.ReactCurrentOwner,Nr=o.ReactCurrentBatchConfig,ki=0,Gr=null,sn=null,Gn=0,ia=0,hu=Ui(0),dn=0,pf=null,Th=0,mf=0,Ph=0,ac=null,ra=null,e0=0,oc=1/0;function Dh(){oc=An()+500}var lc=!1,Ao=null,Eo=null,uc=!1,Aa=null,gf=0,bl=0,t0=null,vf=-1,Cr=0;function qn(){return(ki&6)!==0?An():vf!==-1?vf:vf=An()}function _l(x){return(x.mode&1)===0?1:(ki&2)!==0&&Gn!==0?Gn&-Gn:aS.transition!==null?(Cr===0&&(x=Wd,Wd<<=1,(Wd&4194240)===0&&(Wd=64),Cr=x),Cr):(x=Bi,x!==0?x:Qe())}function Ea(x,b,P){if(50<bl)throw bl=0,t0=null,Error(a(185));var O=Rh(x,b);return O===null?null:(oh(O,b,P),((ki&2)===0||O!==Gr)&&(O===Gr&&((ki&2)===0&&(mf|=b),dn===4&&il(O,Gn)),Rs(O,P),b===1&&ki===0&&(x.mode&1)===0&&(Dh(),yv&&vo())),O)}function Rh(x,b){x.lanes|=b;var P=x.alternate;for(P!==null&&(P.lanes|=b),P=x,x=x.return;x!==null;)x.childLanes|=b,P=x.alternate,P!==null&&(P.childLanes|=b),P=x,x=x.return;return P.tag===3?P.stateNode:null}function Rs(x,b){var P=x.callbackNode;sS(x,b);var O=Qp(x,x===Gr?Gn:0);if(O===0)P!==null&&qd(P),x.callbackNode=null,x.callbackPriority=0;else if(b=O&-O,x.callbackPriority!==b){if(P!=null&&qd(P),b===1)x.tag===0?wv(yf.bind(null,x)):xv(yf.bind(null,x)),$e?Ke(function(){ki===0&&vo()}):lh(uh,vo),P=null;else{switch(Kl(O)){case 1:P=uh;break;case 4:P=MT;break;case 16:P=gv;break;case 536870912:P=vv;break;default:P=gv}P=_m(P,cc.bind(null,x))}x.callbackPriority=b,x.callbackNode=P}}function cc(x,b){if(vf=-1,Cr=0,(ki&6)!==0)throw Error(a(327));var P=x.callbackNode;if(dc()&&x.callbackNode!==P)return null;var O=Qp(x,x===Gr?Gn:0);if(O===0)return null;if((O&30)!==0||(O&x.expiredLanes)!==0||b)b=Xa(x,O);else{b=O;var U=ki;ki|=2;var Q=r0();(Gr!==x||Gn!==b)&&(Dh(),Zr(x,b));do try{wm();break}catch(Be){i0(x,Be)}while(!0);Ks(),Mo.current=Q,ki=U,sn!==null?b=0:(Gr=null,Gn=0,b=dn)}if(b!==0){if(b===2&&(U=fv(x),U!==0&&(O=U,b=Ir(x,U))),b===1)throw P=pf,Zr(x,0),il(x,O),Rs(x,An()),P;if(b===6)il(x,O);else{if(U=x.current.alternate,(O&30)===0&&!Xn(U)&&(b=Xa(x,O),b===2&&(Q=fv(x),Q!==0&&(O=Q,b=Ir(x,Q))),b===1))throw P=pf,Zr(x,0),il(x,O),Rs(x,An()),P;switch(x.finishedWork=U,x.finishedLanes=O,b){case 0:case 1:throw Error(a(345));case 2:hc(x,ra);break;case 3:if(il(x,O),(O&130023424)===O&&(b=e0+500-An(),10<b)){if(Qp(x,0)!==0)break;if(U=x.suspendedLanes,(U&O)!==O){qn(),x.pingedLanes|=x.suspendedLanes&U;break}x.timeoutHandle=me(hc.bind(null,x,ra),b);break}hc(x,ra);break;case 4:if(il(x,O),(O&4194240)===O)break;for(b=x.eventTimes,U=-1;0<O;){var be=31-mo(O);Q=1<<be,be=b[be],be>U&&(U=be),O&=~Q}if(O=U,O=An()-O,O=(120>O?120:480>O?480:1080>O?1080:1920>O?1920:3e3>O?3e3:4320>O?4320:1960*bS(O/1960))-O,10<O){x.timeoutHandle=me(hc.bind(null,x,ra),O);break}hc(x,ra);break;case 5:hc(x,ra);break;default:throw Error(a(329))}}}return Rs(x,An()),x.callbackNode===P?cc.bind(null,x):null}function Ir(x,b){var P=ac;return x.current.memoizedState.isDehydrated&&(Zr(x,b).flags|=256),x=Xa(x,b),x!==2&&(b=ra,ra=P,b!==null&&an(b)),x}function an(x){ra===null?ra=x:ra.push.apply(ra,x)}function Xn(x){for(var b=x;;){if(b.flags&16384){var P=b.updateQueue;if(P!==null&&(P=P.stores,P!==null))for(var O=0;O<P.length;O++){var U=P[O],Q=U.getSnapshot;U=U.value;try{if(!Qs(Q(),U))return!1}catch{return!1}}}if(P=b.child,b.subtreeFlags&16384&&P!==null)P.return=b,b=P;else{if(b===x)break;for(;b.sibling===null;){if(b.return===null||b.return===x)return!0;b=b.return}b.sibling.return=b.return,b=b.sibling}}return!0}function il(x,b){for(b&=~Ph,b&=~mf,x.suspendedLanes|=b,x.pingedLanes&=~b,x=x.expirationTimes;0<b;){var P=31-mo(b),O=1<<P;x[P]=-1,b&=~O}}function yf(x){if((ki&6)!==0)throw Error(a(327));dc();var b=Qp(x,0);if((b&1)===0)return Rs(x,An()),null;var P=Xa(x,b);if(x.tag!==0&&P===2){var O=fv(x);O!==0&&(b=O,P=Ir(x,O))}if(P===1)throw P=pf,Zr(x,0),il(x,b),Rs(x,An()),P;if(P===6)throw Error(a(345));return x.finishedWork=x.current.alternate,x.finishedLanes=b,hc(x,ra),Rs(x,An()),null}function xf(x){Aa!==null&&Aa.tag===0&&(ki&6)===0&&dc();var b=ki;ki|=1;var P=Nr.transition,O=Bi;try{if(Nr.transition=null,Bi=1,x)return x()}finally{Bi=O,Nr.transition=P,ki=b,(ki&6)===0&&vo()}}function R1(){ia=hu.current,ee(hu)}function Zr(x,b){x.finishedWork=null,x.finishedLanes=0;var P=x.timeoutHandle;if(P!==Ce&&(x.timeoutHandle=Ce,he(P)),sn!==null)for(P=sn.return;P!==null;){var O=P;switch(u1(O),O.tag){case 1:O=O.type.childContextTypes,O!=null&&ja();break;case 3:tf(),ee(Oe),ee(ce),vh();break;case 5:d1(O);break;case 4:tf();break;case 13:ee(Hr);break;case 19:ee(Hr);break;case 10:em(O.type._context);break;case 22:case 23:R1()}P=P.return}if(Gr=x,sn=x=du(x.current,null),Gn=ia=b,dn=0,pf=null,Ph=mf=Th=0,ra=ac=null,yo!==null){for(b=0;b<yo.length;b++)if(P=yo[b],O=P.interleaved,O!==null){P.interleaved=null;var U=O.next,Q=P.pending;if(Q!==null){var be=Q.next;Q.next=U,O.next=be}P.pending=O}yo=null}return x}function i0(x,b){do{var P=sn;try{if(Ks(),im.current=of,Iv){for(var O=Wr.memoizedState;O!==null;){var U=O.queue;U!==null&&(U.pending=null),O=O.next}Iv=!1}if(yh=0,Vn=Un=Wr=null,vl=!1,xh=0,wl.current=null,P===null||P.return===null){dn=1,pf=b,sn=null;break}e:{var Q=x,be=P.return,Be=P,st=b;if(b=Gn,Be.flags|=32768,st!==null&&typeof st=="object"&&typeof st.then=="function"){var Ct=st,Gt=Be,Ti=Gt.tag;if((Gt.mode&1)===0&&(Ti===0||Ti===11||Ti===15)){var ci=Gt.alternate;ci?(Gt.updateQueue=ci.updateQueue,Gt.memoizedState=ci.memoizedState,Gt.lanes=ci.lanes):(Gt.updateQueue=null,Gt.memoizedState=null)}var xr=_1(be);if(xr!==null){xr.flags&=-257,bh(xr,be,Be,Q,b),xr.mode&1&&ru(Q,Ct,b),b=xr,st=Ct;var jt=b.updateQueue;if(jt===null){var cr=new Set;cr.add(st),b.updateQueue=cr}else jt.add(st);break e}else{if((b&1)===0){ru(Q,Ct,b),xm();break e}st=Error(a(426))}}else if(Br&&Be.mode&1){var Qa=_1(be);if(Qa!==null){(Qa.flags&65536)===0&&(Qa.flags|=256),bh(Qa,be,Be,Q,b),Pv(st);break e}}Q=st,dn!==4&&(dn=2),ac===null?ac=[Q]:ac.push(Q),st=b1(st,Be),Be=be;do{switch(Be.tag){case 3:Be.flags|=65536,b&=-b,Be.lanes|=b;var Xe=xS(Be,st,b);Sv(Be,Xe);break e;case 1:Q=st;var Fe=Be.type,tt=Be.stateNode;if((Be.flags&128)===0&&(typeof Fe.getDerivedStateFromError=="function"||tt!==null&&typeof tt.componentDidCatch=="function"&&(Eo===null||!Eo.has(tt)))){Be.flags|=65536,b&=-b,Be.lanes|=b;var Nt=jv(Be,Q,b);Sv(Be,Nt);break e}}Be=Be.return}while(Be!==null)}s0(P)}catch(ei){b=ei,sn===P&&P!==null&&(sn=P=P.return);continue}break}while(!0)}function r0(){var x=Mo.current;return Mo.current=of,x===null?of:x}function xm(){(dn===0||dn===3||dn===2)&&(dn=4),Gr===null||(Th&268435455)===0&&(mf&268435455)===0||il(Gr,Gn)}function Xa(x,b){var P=ki;ki|=2;var O=r0();Gr===x&&Gn===b||Zr(x,b);do try{Co();break}catch(U){i0(x,U)}while(!0);if(Ks(),ki=P,Mo.current=O,sn!==null)throw Error(a(261));return Gr=null,Gn=0,dn}function Co(){for(;sn!==null;)n0(sn)}function wm(){for(;sn!==null&&!Zu();)n0(sn)}function n0(x){var b=O1(x.alternate,x,ia);x.memoizedProps=x.pendingProps,b===null?s0(x):sn=b,wl.current=null}function s0(x){var b=x;do{var P=b.alternate;if(x=b.return,(b.flags&32768)===0){if(P=Gv(P,b,ia),P!==null){sn=P;return}}else{if(P=Yv(P,b),P!==null){P.flags&=32767,sn=P;return}if(x!==null)x.flags|=32768,x.subtreeFlags=0,x.deletions=null;else{dn=6,sn=null;return}}if(b=b.sibling,b!==null){sn=b;return}sn=b=x}while(b!==null);dn===0&&(dn=5)}function hc(x,b){var P=Bi,O=Nr.transition;try{Nr.transition=null,Bi=1,_S(x,b,P)}finally{Nr.transition=O,Bi=P}return null}function _S(x,b,P){do dc();while(Aa!==null);if((ki&6)!==0)throw Error(a(327));var O=x.finishedWork,U=x.finishedLanes;if(O===null)return null;if(x.finishedWork=null,x.finishedLanes=0,O===x.current)throw Error(a(177));x.callbackNode=null,x.callbackPriority=0;var Q=O.lanes|O.childLanes;if(mv(x,Q),x===Gr&&(sn=Gr=null,Gn=0),(O.subtreeFlags&2064)===0&&(O.flags&2064)===0||uc||(uc=!0,_m(gv,function(){return dc(),null})),Q=(O.flags&15990)!==0,(O.subtreeFlags&15990)!==0||Q){Q=Nr.transition,Nr.transition=null;var be=Bi;Bi=1;var Be=ki;ki|=4,wl.current=null,C1(x,O),CT(x,O),F(x.containerInfo),x.current=O,$o(O),ST(),ki=Be,Bi=be,Nr.transition=Q}else x.current=O;if(uc&&(uc=!1,Aa=x,gf=U),Q=x.pendingLanes,Q===0&&(Eo=null),Zp(O.stateNode),Rs(x,An()),b!==null)for(P=x.onRecoverableError,O=0;O<b.length;O++)P(b[O]);if(lc)throw lc=!1,x=Ao,Ao=null,x;return(gf&1)!==0&&x.tag!==0&&dc(),Q=x.pendingLanes,(Q&1)!==0?x===t0?bl++:(bl=0,t0=x):bl=0,vo(),null}function dc(){if(Aa!==null){var x=Kl(gf),b=Nr.transition,P=Bi;try{if(Nr.transition=null,Bi=16>x?16:x,Aa===null)var O=!1;else{if(x=Aa,Aa=null,gf=0,(ki&6)!==0)throw Error(a(331));var U=ki;for(ki|=4,It=x.current;It!==null;){var Q=It,be=Q.child;if((It.flags&16)!==0){var Be=Q.deletions;if(Be!==null){for(var st=0;st<Be.length;st++){var Ct=Be[st];for(It=Ct;It!==null;){var Gt=It;switch(Gt.tag){case 0:case 11:case 15:lu(8,Gt,Q)}var Ti=Gt.child;if(Ti!==null)Ti.return=Gt,It=Ti;else for(;It!==null;){Gt=It;var ci=Gt.sibling,xr=Gt.return;if(T1(Gt),Gt===Ct){It=null;break}if(ci!==null){ci.return=xr,It=ci;break}It=xr}}}var jt=Q.alternate;if(jt!==null){var cr=jt.child;if(cr!==null){jt.child=null;do{var Qa=cr.sibling;cr.sibling=null,cr=Qa}while(cr!==null)}}It=Q}}if((Q.subtreeFlags&2064)!==0&&be!==null)be.return=Q,It=be;else e:for(;It!==null;){if(Q=It,(Q.flags&2048)!==0)switch(Q.tag){case 0:case 11:case 15:lu(9,Q,Q.return)}var Xe=Q.sibling;if(Xe!==null){Xe.return=Q.return,It=Xe;break e}It=Q.return}}var Fe=x.current;for(It=Fe;It!==null;){be=It;var tt=be.child;if((be.subtreeFlags&2064)!==0&&tt!==null)tt.return=be,It=tt;else e:for(be=Fe;It!==null;){if(Be=It,(Be.flags&2048)!==0)try{switch(Be.tag){case 0:case 11:case 15:ds(9,Be)}}catch(ei){na(Be,Be.return,ei)}if(Be===be){It=null;break e}var Nt=Be.sibling;if(Nt!==null){Nt.return=Be.return,It=Nt;break e}It=Be.return}}if(ki=U,vo(),gl&&typeof gl.onPostCommitFiberRoot=="function")try{gl.onPostCommitFiberRoot(Kp,x)}catch{}O=!0}return O}finally{Bi=P,Nr.transition=b}}return!1}function I1(x,b,P){b=b1(P,b),b=xS(x,b,1),Ju(x,b),b=qn(),x=Rh(x,1),x!==null&&(oh(x,1,b),Rs(x,b))}function na(x,b,P){if(x.tag===3)I1(x,x,P);else for(;b!==null;){if(b.tag===3){I1(b,x,P);break}else if(b.tag===1){var O=b.stateNode;if(typeof b.type.getDerivedStateFromError=="function"||typeof O.componentDidCatch=="function"&&(Eo===null||!Eo.has(O))){x=b1(P,x),x=jv(b,x,1),Ju(b,x),x=qn(),b=Rh(b,1),b!==null&&(oh(b,1,x),Rs(b,x));break}}b=b.return}}function SS(x,b,P){var O=x.pingCache;O!==null&&O.delete(b),b=qn(),x.pingedLanes|=x.suspendedLanes&P,Gr===x&&(Gn&P)===P&&(dn===4||dn===3&&(Gn&130023424)===Gn&&500>An()-e0?Zr(x,0):Ph|=P),Rs(x,b)}function L1(x,b){b===0&&((x.mode&1)===0?b=1:(b=rr,rr<<=1,(rr&130023424)===0&&(rr=4194304)));var P=qn();x=Rh(x,b),x!==null&&(oh(x,b,P),Rs(x,P))}function MS(x){var b=x.memoizedState,P=0;b!==null&&(P=b.retryLane),L1(x,P)}function bm(x,b){var P=0;switch(x.tag){case 13:var O=x.stateNode,U=x.memoizedState;U!==null&&(P=U.retryLane);break;case 19:O=x.stateNode;break;default:throw Error(a(314))}O!==null&&O.delete(b),L1(x,P)}var O1;O1=function(x,b,P){if(x!==null)if(x.memoizedProps!==b.pendingProps||Oe.current)Hn=!0;else{if((x.lanes&P)===0&&(b.flags&128)===0)return Hn=!1,Xv(x,b,P);Hn=(x.flags&131072)!==0}else Hn=!1,Br&&(b.flags&1048576)!==0&&hS(b,Cv,b.index);switch(b.lanes=0,b.tag){case 2:var O=b.type;x!==null&&(x.alternate=null,b.alternate=null,b.flags|=2),x=b.pendingProps;var U=Mn(b,ce.current);Xd(b,P),U=rf(null,b,O,x,U,P);var Q=ic();return b.flags|=1,typeof U=="object"&&U!==null&&typeof U.render=="function"&&U.$$typeof===void 0?(b.tag=1,b.memoizedState=null,b.updateQueue=null,rn(O)?(Q=!0,Ku(b)):Q=!1,b.memoizedState=U.state!==null&&U.state!==void 0?U.state:null,Yd(b),U.updater=Av,b.stateNode=U,U._reactInternals=b,o1(b,O,x,P),b=Ds(null,b,O,!0,Q,P)):(b.tag=0,Br&&Q&&l1(b),Kr(null,b,U,P),b=b.child),b;case 16:O=b.elementType;e:{switch(x!==null&&(x.alternate=null,b.alternate=null,b.flags|=2),x=b.pendingProps,U=O._init,O=U(O._payload),b.type=O,U=b.tag=AS(O),x=ba(O,x),U){case 0:b=au(null,b,O,x,P);break e;case 1:b=Sh(null,b,O,x,P);break e;case 11:b=Er(null,b,O,x,P);break e;case 14:b=yr(null,b,O,ba(O.type,x),P);break e}throw Error(a(306,O,""))}return b;case 0:return O=b.type,U=b.pendingProps,U=b.elementType===O?U:ba(O,U),au(x,b,O,U,P);case 1:return O=b.type,U=b.pendingProps,U=b.elementType===O?U:ba(O,U),Sh(x,b,O,U,P);case 3:e:{if(hm(b),x===null)throw Error(a(387));O=b.pendingProps,Q=b.memoizedState,U=Q.element,n1(x,b),Mv(b,O,null,P);var be=b.memoizedState;if(O=be.element,De&&Q.isDehydrated)if(Q={element:O,isDehydrated:!1,cache:be.cache,transitions:be.transitions},b.updateQueue.baseState=Q,b.memoizedState=Q,b.flags&256){U=Error(a(423)),b=M1(x,b,O,P,U);break e}else if(O!==U){U=Error(a(424)),b=M1(x,b,O,P,U);break e}else for(De&&(cs=ye(b.stateNode.containerInfo),Zs=b,Br=!0,bo=null,Kd=!1),P=pS(b,null,O,P),b.child=P;P;)P.flags=P.flags&-3|4096,P=P.sibling;else{if(Zd(),O===U){b=Ma(x,b,P);break e}Kr(x,b,O,P)}b=b.child}return b;case 5:return mS(b),x===null&&ec(b),O=b.type,U=b.pendingProps,Q=x!==null?x.memoizedProps:null,be=U.children,re(O,U)?be=null:Q!==null&&re(O,Q)&&(b.flags|=32),Js(x,b),Kr(x,b,be,P),b.child;case 6:return x===null&&ec(b),null;case 13:return A1(x,b,P);case 4:return Dv(b,b.stateNode.containerInfo),O=b.pendingProps,x===null?b.child=tu(b,null,O,P):Kr(x,b,O,P),b.child;case 11:return O=b.type,U=b.pendingProps,U=b.elementType===O?U:ba(O,U),Er(x,b,O,U,P);case 7:return Kr(x,b,b.pendingProps,P),b.child;case 8:return Kr(x,b,b.pendingProps.children,P),b.child;case 12:return Kr(x,b,b.pendingProps.children,P),b.child;case 10:e:{if(O=b.type._context,U=b.pendingProps,Q=b.memoizedProps,be=U.value,hh(b,O,be),Q!==null)if(Qs(Q.value,be)){if(Q.children===U.children&&!Oe.current){b=Ma(x,b,P);break e}}else for(Q=b.child,Q!==null&&(Q.return=b);Q!==null;){var Be=Q.dependencies;if(Be!==null){be=Q.child;for(var st=Be.firstContext;st!==null;){if(st.context===O){if(Q.tag===1){st=Jl(-1,P&-P),st.tag=2;var Ct=Q.updateQueue;if(Ct!==null){Ct=Ct.shared;var Gt=Ct.pending;Gt===null?st.next=st:(st.next=Gt.next,Gt.next=st),Ct.pending=st}}Q.lanes|=P,st=Q.alternate,st!==null&&(st.lanes|=P),dh(Q.return,P,b),Be.lanes|=P;break}st=st.next}}else if(Q.tag===10)be=Q.type===b.type?null:Q.child;else if(Q.tag===18){if(be=Q.return,be===null)throw Error(a(341));be.lanes|=P,Be=be.alternate,Be!==null&&(Be.lanes|=P),dh(be,P,b),be=Q.sibling}else be=Q.child;if(be!==null)be.return=Q;else for(be=Q;be!==null;){if(be===b){be=null;break}if(Q=be.sibling,Q!==null){Q.return=be.return,be=Q;break}be=be.return}Q=be}Kr(x,b,U.children,P),b=b.child}return b;case 9:return U=b.type,O=b.pendingProps.children,Xd(b,P),U=_a(U),O=O(U),b.flags|=1,Kr(x,b,O,P),b.child;case 14:return O=b.type,U=ba(O,b.pendingProps),U=ba(O.type,U),yr(x,b,O,U,P);case 15:return su(x,b,b.type,b.pendingProps,P);case 17:return O=b.type,U=b.pendingProps,U=b.elementType===O?U:ba(O,U),x!==null&&(x.alternate=null,b.alternate=null,b.flags|=2),b.tag=1,rn(O)?(x=!0,Ku(b)):x=!1,Xd(b,P),uS(b,O,U),o1(b,O,U,P),Ds(null,b,O,!0,x,P);case 19:return Ah(x,b,P);case 22:return hs(x,b,P)}throw Error(a(156,b.tag))};function _m(x,b){return lh(x,b)}function a0(x,b,P,O){this.tag=x,this.key=P,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=b,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=O,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ya(x,b,P,O){return new a0(x,b,P,O)}function Sm(x){return x=x.prototype,!(!x||!x.isReactComponent)}function AS(x){if(typeof x=="function")return Sm(x)?1:0;if(x!=null){if(x=x.$$typeof,x===v)return 11;if(x===S)return 14}return 2}function du(x,b){var P=x.alternate;return P===null?(P=Ya(x.tag,b,x.key,x.mode),P.elementType=x.elementType,P.type=x.type,P.stateNode=x.stateNode,P.alternate=x,x.alternate=P):(P.pendingProps=b,P.type=x.type,P.flags=0,P.subtreeFlags=0,P.deletions=null),P.flags=x.flags&14680064,P.childLanes=x.childLanes,P.lanes=x.lanes,P.child=x.child,P.memoizedProps=x.memoizedProps,P.memoizedState=x.memoizedState,P.updateQueue=x.updateQueue,b=x.dependencies,P.dependencies=b===null?null:{lanes:b.lanes,firstContext:b.firstContext},P.sibling=x.sibling,P.index=x.index,P.ref=x.ref,P}function Mm(x,b,P,O,U,Q){var be=2;if(O=x,typeof x=="function")Sm(x)&&(be=1);else if(typeof x=="string")be=5;else e:switch(x){case c:return fc(P.children,U,Q,b);case h:be=8,U|=8;break;case d:return x=Ya(12,P,b,U|2),x.elementType=d,x.lanes=Q,x;case g:return x=Ya(13,P,b,U),x.elementType=g,x.lanes=Q,x;case w:return x=Ya(19,P,b,U),x.elementType=w,x.lanes=Q,x;case A:return wf(P,U,Q,b);default:if(typeof x=="object"&&x!==null)switch(x.$$typeof){case p:be=10;break e;case m:be=9;break e;case v:be=11;break e;case S:be=14;break e;case _:be=16,O=null;break e}throw Error(a(130,x==null?x:typeof x,""))}return b=Ya(be,P,b,U),b.elementType=x,b.type=O,b.lanes=Q,b}function fc(x,b,P,O){return x=Ya(7,x,O,b),x.lanes=P,x}function wf(x,b,P,O){return x=Ya(22,x,O,b),x.elementType=A,x.lanes=P,x.stateNode={},x}function o0(x,b,P){return x=Ya(6,x,null,b),x.lanes=P,x}function l0(x,b,P){return b=Ya(4,x.children!==null?x.children:[],x.key,b),b.lanes=P,b.stateNode={containerInfo:x.containerInfo,pendingChildren:null,implementation:x.implementation},b}function ES(x,b,P,O,U){this.tag=b,this.containerInfo=x,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=Ce,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=pv(0),this.expirationTimes=pv(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=pv(0),this.identifierPrefix=O,this.onRecoverableError=U,De&&(this.mutableSourceEagerHydrationData=null)}function CS(x,b,P,O,U,Q,be,Be,st){return x=new ES(x,b,P,Be,st),b===1?(b=1,Q===!0&&(b|=8)):b=0,Q=Ya(3,null,null,b),x.current=Q,Q.stateNode=x,Q.memoizedState={element:O,isDehydrated:P,cache:null,transitions:null},Yd(Q),x}function z1(x){if(!x)return Se;x=x._reactInternals;e:{if(D(x)!==x||x.tag!==1)throw Error(a(170));var b=x;do{switch(b.tag){case 3:b=b.stateNode.context;break e;case 1:if(rn(b.type)){b=b.stateNode.__reactInternalMemoizedMergedChildContext;break e}}b=b.return}while(b!==null);throw Error(a(171))}if(x.tag===1){var P=x.type;if(rn(P))return ah(x,P,b)}return b}function TS(x){var b=x._reactInternals;if(b===void 0)throw typeof x.render=="function"?Error(a(188)):(x=Object.keys(x).join(","),Error(a(268,x)));return x=G(b),x===null?null:x.stateNode}function PS(x,b){if(x=x.memoizedState,x!==null&&x.dehydrated!==null){var P=x.retryLane;x.retryLane=P!==0&&P<b?P:b}}function u0(x,b){PS(x,b),(x=x.alternate)&&PS(x,b)}function DS(x){return x=G(x),x===null?null:x.stateNode}function RS(){return null}return i.attemptContinuousHydration=function(x){if(x.tag===13){var b=qn();Ea(x,134217728,b),u0(x,134217728)}},i.attemptHydrationAtCurrentPriority=function(x){if(x.tag===13){var b=qn(),P=_l(x);Ea(x,P,b),u0(x,P)}},i.attemptSynchronousHydration=function(x){switch(x.tag){case 3:var b=x.stateNode;if(b.current.memoizedState.isDehydrated){var P=Gd(b.pendingLanes);P!==0&&(ml(b,P|1),Rs(b,An()),(ki&6)===0&&(Dh(),vo()))}break;case 13:var O=qn();xf(function(){return Ea(x,1,O)}),u0(x,1)}},i.batchedUpdates=function(x,b){var P=ki;ki|=1;try{return x(b)}finally{ki=P,ki===0&&(Dh(),yv&&vo())}},i.createComponentSelector=function(x){return{$$typeof:hf,value:x}},i.createContainer=function(x,b,P,O,U,Q,be){return CS(x,b,!1,null,P,O,U,Q,be)},i.createHasPseudoClassSelector=function(x){return{$$typeof:df,value:x}},i.createHydrationContainer=function(x,b,P,O,U,Q,be,Be,st){return x=CS(P,O,!0,x,U,Q,be,Be,st),x.context=z1(null),P=x.current,O=qn(),U=_l(P),Q=Jl(O,U),Q.callback=b??null,Ju(P,Q),x.current.lanes=U,oh(x,U,O),Rs(x,O),x},i.createPortal=function(x,b,P){var O=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:u,key:O==null?null:""+O,children:x,containerInfo:b,implementation:P}},i.createRoleSelector=function(x){return{$$typeof:ff,value:x}},i.createTestNameSelector=function(x){return{$$typeof:uu,value:x}},i.createTextSelector=function(x){return{$$typeof:ta,value:x}},i.deferredUpdates=function(x){var b=Bi,P=Nr.transition;try{return Nr.transition=null,Bi=16,x()}finally{Bi=b,Nr.transition=P}},i.discreteUpdates=function(x,b,P,O,U){var Q=Bi,be=Nr.transition;try{return Nr.transition=null,Bi=1,x(b,P,O,U)}finally{Bi=Q,Nr.transition=be,ki===0&&Dh()}},i.findAllNodes=ym,i.findBoundingRects=function(x,b){if(!bt)throw Error(a(363));b=ym(x,b),x=[];for(var P=0;P<b.length;P++)x.push(q(b[P]));for(b=x.length-1;0<b;b--){P=x[b];for(var O=P.x,U=O+P.width,Q=P.y,be=Q+P.height,Be=b-1;0<=Be;Be--)if(b!==Be){var st=x[Be],Ct=st.x,Gt=Ct+st.width,Ti=st.y,ci=Ti+st.height;if(O>=Ct&&Q>=Ti&&U<=Gt&&be<=ci){x.splice(b,1);break}else if(O!==Ct||P.width!==st.width||ci<Q||Ti>be){if(!(Q!==Ti||P.height!==st.height||Gt<O||Ct>U)){Ct>O&&(st.width+=Ct-O,st.x=O),Gt<U&&(st.width=U-Ct),x.splice(b,1);break}}else{Ti>Q&&(st.height+=Ti-Q,st.y=Q),ci<be&&(st.height=be-Ti),x.splice(b,1);break}}}return x},i.findHostInstance=TS,i.findHostInstanceWithNoPortals=function(x){return x=z(x),x=x!==null?j(x):null,x===null?null:x.stateNode},i.findHostInstanceWithWarning=function(x){return TS(x)},i.flushControlled=function(x){var b=ki;ki|=1;var P=Nr.transition,O=Bi;try{Nr.transition=null,Bi=1,x()}finally{Bi=O,Nr.transition=P,ki=b,ki===0&&(Dh(),vo())}},i.flushPassiveEffects=dc,i.flushSync=xf,i.focusWithin=function(x,b){if(!bt)throw Error(a(363));for(x=vm(x),b=cu(x,b),b=Array.from(b),x=0;x<b.length;){var P=b[x++];if(!de(P)){if(P.tag===5&&$(P.stateNode))return!0;for(P=P.child;P!==null;)b.push(P),P=P.sibling}}return!1},i.getCurrentUpdatePriority=function(){return Bi},i.getFindAllNodesFailureDescription=function(x,b){if(!bt)throw Error(a(363));var P=0,O=[];x=[vm(x),0];for(var U=0;U<x.length;){var Q=x[U++],be=x[U++],Be=b[be];if((Q.tag!==5||!de(Q))&&($v(Q,Be)&&(O.push(tl(Be)),be++,be>P&&(P=be)),be<b.length))for(Q=Q.child;Q!==null;)x.push(Q,be),Q=Q.sibling}if(P<b.length){for(x=[];P<b.length;P++)x.push(tl(b[P]));return`findAllNodes was able to match part of the selector:
  `+(O.join(" > ")+`

No matching component was found for:
  `)+x.join(" > ")}return null},i.getPublicRootInstance=function(x){if(x=x.current,!x.child)return null;switch(x.child.tag){case 5:return ne(x.child.stateNode);default:return x.child.stateNode}},i.injectIntoDevTools=function(x){if(x={bundleType:x.bundleType,version:x.version,rendererPackageName:x.rendererPackageName,rendererConfig:x.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:o.ReactCurrentDispatcher,findHostInstanceByFiber:DS,findFiberByHostInstance:x.findFiberByHostInstance||RS,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")x=!1;else{var b=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(b.isDisabled||!b.supportsFiber)x=!0;else{try{Kp=b.inject(x),gl=b}catch{}x=!!b.checkDCE}}return x},i.isAlreadyRendering=function(){return!1},i.observeVisibleRects=function(x,b,P,O){if(!bt)throw Error(a(363));x=ym(x,b);var U=Ue(x,P,O).disconnect;return{disconnect:function(){U()}}},i.registerMutableSourceForHydration=function(x,b){var P=b._getVersion;P=P(b._source),x.mutableSourceEagerHydrationData==null?x.mutableSourceEagerHydrationData=[b,P]:x.mutableSourceEagerHydrationData.push(b,P)},i.runWithPriority=function(x,b){var P=Bi;try{return Bi=x,b()}finally{Bi=P}},i.shouldError=function(){return null},i.shouldSuspend=function(){return!1},i.updateContainer=function(x,b,P,O){var U=b.current,Q=qn(),be=_l(U);return P=z1(P),b.context===null?b.context=P:b.pendingContext=P,b=Jl(Q,be),b.payload={element:x},O=O===void 0?null:O,O!==null&&(b.callback=O),Ju(U,b),x=Ea(U,be,Q),x!==null&&_v(x,U,be),be},i}),WP}var j4;function Iue(){return j4||(j4=1,VP.exports=Rue()),VP.exports}var Lue=Iue();const Oue=xC(Lue);var GP={exports:{}},qP={};var H4;function zue(){return H4||(H4=1,(function(e){function t(B,Z){var F=B.length;B.push(Z);e:for(;0<F;){var X=F-1>>>1,Y=B[X];if(0<n(Y,Z))B[X]=Z,B[F]=Y,F=X;else break e}}function i(B){return B.length===0?null:B[0]}function r(B){if(B.length===0)return null;var Z=B[0],F=B.pop();if(F!==Z){B[0]=F;e:for(var X=0,Y=B.length,le=Y>>>1;X<le;){var oe=2*(X+1)-1,re=B[oe],ue=oe+1,me=B[ue];if(0>n(re,F))ue<Y&&0>n(me,re)?(B[X]=me,B[ue]=F,X=ue):(B[X]=re,B[oe]=F,X=oe);else if(ue<Y&&0>n(me,F))B[X]=me,B[ue]=F,X=ue;else break e}}return Z}function n(B,Z){var F=B.sortIndex-Z.sortIndex;return F!==0?F:B.id-Z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],u=[],c=1,h=null,d=3,p=!1,m=!1,v=!1,g=typeof setTimeout=="function"?setTimeout:null,w=typeof clearTimeout=="function"?clearTimeout:null,S=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(B){for(var Z=i(u);Z!==null;){if(Z.callback===null)r(u);else if(Z.startTime<=B)r(u),Z.sortIndex=Z.expirationTime,t(l,Z);else break;Z=i(u)}}function A(B){if(v=!1,_(B),!m)if(i(l)!==null)m=!0,ne(C);else{var Z=i(u);Z!==null&&K(A,Z.startTime-B)}}function C(B,Z){m=!1,v&&(v=!1,w(T),T=-1),p=!0;var F=d;try{for(_(Z),h=i(l);h!==null&&(!(h.expirationTime>Z)||B&&!z());){var X=h.callback;if(typeof X=="function"){h.callback=null,d=h.priorityLevel;var Y=X(h.expirationTime<=Z);Z=e.unstable_now(),typeof Y=="function"?h.callback=Y:h===i(l)&&r(l),_(Z)}else r(l);h=i(l)}if(h!==null)var le=!0;else{var oe=i(u);oe!==null&&K(A,oe.startTime-Z),le=!1}return le}finally{h=null,d=F,p=!1}}var E=!1,I=null,T=-1,D=5,L=-1;function z(){return!(e.unstable_now()-L<D)}function G(){if(I!==null){var B=e.unstable_now();L=B;var Z=!0;try{Z=I(!0,B)}finally{Z?V():(E=!1,I=null)}}else E=!1}var V;if(typeof S=="function")V=function(){S(G)};else if(typeof MessageChannel<"u"){var j=new MessageChannel,J=j.port2;j.port1.onmessage=G,V=function(){J.postMessage(null)}}else V=function(){g(G,0)};function ne(B){I=B,E||(E=!0,V())}function K(B,Z){T=g(function(){B(e.unstable_now())},Z)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(B){B.callback=null},e.unstable_continueExecution=function(){m||p||(m=!0,ne(C))},e.unstable_forceFrameRate=function(B){0>B||125<B?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<B?Math.floor(1e3/B):5},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return i(l)},e.unstable_next=function(B){switch(d){case 1:case 2:case 3:var Z=3;break;default:Z=d}var F=d;d=Z;try{return B()}finally{d=F}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(B,Z){switch(B){case 1:case 2:case 3:case 4:case 5:break;default:B=3}var F=d;d=B;try{return Z()}finally{d=F}},e.unstable_scheduleCallback=function(B,Z,F){var X=e.unstable_now();switch(typeof F=="object"&&F!==null?(F=F.delay,F=typeof F=="number"&&0<F?X+F:X):F=X,B){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=F+Y,B={id:c++,callback:Z,priorityLevel:B,startTime:F,expirationTime:Y,sortIndex:-1},F>X?(B.sortIndex=F,t(u,B),i(l)===null&&B===i(u)&&(v?(w(T),T=-1):v=!0,K(A,F-X))):(B.sortIndex=Y,t(l,B),m||p||(m=!0,ne(C))),B},e.unstable_shouldYield=z,e.unstable_wrapCallback=function(B){var Z=d;return function(){var F=d;d=Z;try{return B.apply(this,arguments)}finally{d=F}}}})(qP)),qP}var W4;function kue(){return W4||(W4=1,GP.exports=zue()),GP.exports}var G4=kue();const Bue=e=>typeof e=="object"&&typeof e.then=="function",pg=[];function _7(e,t,i=(r,n)=>r===n){if(e===t)return!0;if(!e||!t)return!1;const r=e.length;if(t.length!==r)return!1;for(let n=0;n<r;n++)if(!i(e[n],t[n]))return!1;return!0}function S7(e,t=null,i=!1,r={}){t===null&&(t=[e]);for(const s of pg)if(_7(t,s.keys,s.equal)){if(i)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return r.lifespan&&r.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,r.lifespan)),s.response;if(!i)throw s.promise}const n={keys:t,equal:r.equal,remove:()=>{const s=pg.indexOf(n);s!==-1&&pg.splice(s,1)},promise:(Bue(e)?e:e(...t)).then(s=>{n.response=s,r.lifespan&&r.lifespan>0&&(n.timeout=setTimeout(n.remove,r.lifespan))}).catch(s=>n.error=s)};if(pg.push(n),!i)throw n.promise}const Nue=(e,t,i)=>S7(e,t,!1,i),Fue=(e,t,i)=>void S7(e,t,!0,i),Uue=e=>{if(e===void 0||e.length===0)pg.splice(0,pg.length);else{const t=pg.find(i=>_7(e,i.keys,i.equal));t&&t.remove()}},Uz={},Vue=e=>void Object.assign(Uz,e);function jue(e,t){function i(c,{args:h=[],attach:d,...p},m){let v=`${c[0].toUpperCase()}${c.slice(1)}`,g;if(c==="primitive"){if(p.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const w=p.object;g=hy(w,{type:c,root:m,attach:d,primitive:!0})}else{const w=Uz[v];if(!w)throw new Error(`R3F: ${v} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(h))throw new Error("R3F: The args prop must be an array!");g=hy(new w(...h),{type:c,root:m,attach:d,memoizedProps:{args:h}})}return g.__r3f.attach===void 0&&(g instanceof Fi?g.__r3f.attach="geometry":g instanceof wa&&(g.__r3f.attach="material")),v!=="inject"&&QP(g,p),g}function r(c,h){let d=!1;if(h){var p,m;(p=h.__r3f)!=null&&p.attach?YP(c,h,h.__r3f.attach):h.isObject3D&&c.isObject3D&&(c.add(h),d=!0),d||(m=c.__r3f)==null||m.objects.push(h),h.__r3f||hy(h,{}),h.__r3f.parent=c,xI(h),dy(h)}}function n(c,h,d){let p=!1;if(h){var m,v;if((m=h.__r3f)!=null&&m.attach)YP(c,h,h.__r3f.attach);else if(h.isObject3D&&c.isObject3D){h.parent=c,h.dispatchEvent({type:"added"});const g=c.children.filter(S=>S!==h),w=g.indexOf(d);c.children=[...g.slice(0,w),h,...g.slice(w)],p=!0}p||(v=c.__r3f)==null||v.objects.push(h),h.__r3f||hy(h,{}),h.__r3f.parent=c,xI(h),dy(h)}}function s(c,h,d=!1){c&&[...c].forEach(p=>a(h,p,d))}function a(c,h,d){if(h){var p,m,v;if(h.__r3f&&(h.__r3f.parent=null),(p=c.__r3f)!=null&&p.objects&&(c.__r3f.objects=c.__r3f.objects.filter(A=>A!==h)),(m=h.__r3f)!=null&&m.attach)K4(c,h,h.__r3f.attach);else if(h.isObject3D&&c.isObject3D){var g;c.remove(h),(g=h.__r3f)!=null&&g.root&&Kue(DE(h),h)}const S=(v=h.__r3f)==null?void 0:v.primitive,_=!S&&(d===void 0?h.dispose!==null:d);if(!S){var w;s((w=h.__r3f)==null?void 0:w.objects,h,_),s(h.children,h,_)}if(delete h.__r3f,_&&h.dispose&&h.type!=="Scene"){const A=()=>{try{h.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?G4.unstable_scheduleCallback(G4.unstable_IdlePriority,A):A()}dy(c)}}function o(c,h,d,p){var m;const v=(m=c.__r3f)==null?void 0:m.parent;if(!v)return;const g=i(h,d,c.__r3f.root);if(c.children){for(const w of c.children)w.__r3f&&r(g,w);c.children=c.children.filter(w=>!w.__r3f)}c.__r3f.objects.forEach(w=>r(g,w)),c.__r3f.objects=[],c.__r3f.autoRemovedBeforeAppend||a(v,c),g.parent&&(g.__r3f.autoRemovedBeforeAppend=!0),r(v,g),g.raycast&&g.__r3f.eventCount&&DE(g).getState().internal.interaction.push(g),[p,p.alternate].forEach(w=>{w!==null&&(w.stateNode=g,w.ref&&(typeof w.ref=="function"?w.ref(g):w.ref.current=g))})}const l=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:Oue({createInstance:i,removeChild:a,appendChild:r,appendInitialChild:r,insertBefore:n,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(c,h)=>{if(!h)return;const d=c.getState().scene;d.__r3f&&(d.__r3f.root=c,r(d,h))},removeChildFromContainer:(c,h)=>{h&&a(c.getState().scene,h)},insertInContainerBefore:(c,h,d)=>{if(!h||!d)return;const p=c.getState().scene;p.__r3f&&n(p,h,d)},getRootHostContext:()=>null,getChildHostContext:c=>c,finalizeInitialChildren(c){var h;return!!((h=c?.__r3f)!=null?h:{}).handlers},prepareUpdate(c,h,d,p){var m;if(((m=c?.__r3f)!=null?m:{}).primitive&&p.object&&p.object!==c)return[!0];{const{args:g=[],children:w,...S}=p,{args:_=[],children:A,...C}=d;if(!Array.isArray(g))throw new Error("R3F: the args prop must be an array!");if(g.some((I,T)=>I!==_[T]))return[!0];const E=D7(c,S,C,!0);return E.changes.length?[!1,E]:null}},commitUpdate(c,[h,d],p,m,v,g){h?o(c,p,v,g):QP(c,d)},commitMount(c,h,d,p){var m;const v=(m=c.__r3f)!=null?m:{};c.raycast&&v.handlers&&v.eventCount&&DE(c).getState().internal.interaction.push(c)},getPublicInstance:c=>c,prepareForCommit:()=>null,preparePortalMount:c=>hy(c.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(c){var h;const{attach:d,parent:p}=(h=c.__r3f)!=null?h:{};d&&p&&K4(p,c,d),c.isObject3D&&(c.visible=!1),dy(c)},unhideInstance(c,h){var d;const{attach:p,parent:m}=(d=c.__r3f)!=null?d:{};p&&m&&YP(m,c,p),(c.isObject3D&&h.visible==null||h.visible)&&(c.visible=!0),dy(c)},createTextInstance:l,hideTextInstance:l,unhideTextInstance:l,getCurrentEventPriority:()=>t?t():Ey.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&Xr.fun(performance.now)?performance.now:Xr.fun(Date.now)?Date.now:()=>0,scheduleTimeout:Xr.fun(setTimeout)?setTimeout:void 0,cancelTimeout:Xr.fun(clearTimeout)?clearTimeout:void 0}),applyProps:QP}}var q4,X4;const XP=e=>"colorSpace"in e||"outputColorSpace"in e,M7=()=>{var e;return(e=Uz.ColorManagement)!=null?e:null},A7=e=>e&&e.isOrthographicCamera,Hue=e=>e&&e.hasOwnProperty("current"),k_=typeof window<"u"&&((q4=window.document)!=null&&q4.createElement||((X4=window.navigator)==null?void 0:X4.product)==="ReactNative")?xe.useLayoutEffect:xe.useEffect;function E7(e){const t=xe.useRef(e);return k_(()=>void(t.current=e),[e]),t}function Wue({set:e}){return k_(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class C7 extends xe.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}C7.getDerivedStateFromError=()=>({error:!0});const T7="__default",Y4=new Map,Gue=e=>e&&!!e.memoized&&!!e.changes;function P7(e){var t;const i=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],i),e[1]):e}const iw=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()};function DE(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const Xr={obj:e=>e===Object(e)&&!Xr.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:i="shallow",objects:r="reference",strict:n=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(Xr.str(e)||Xr.num(e))return e===t;const s=Xr.obj(e);if(s&&r==="reference")return e===t;const a=Xr.arr(e);if(a&&i==="reference")return e===t;if((a||s)&&e===t)return!0;let o;for(o in e)if(!(o in t))return!1;if(s&&i==="shallow"&&r==="shallow"){for(o in n?t:e)if(!Xr.equ(e[o],t[o],{strict:n,objects:"reference"}))return!1}else for(o in n?t:e)if(e[o]!==t[o])return!1;if(Xr.und(o)){if(a&&e.length===0&&t.length===0||s&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function que(e){const t={nodes:{},materials:{}};return e&&e.traverse(i=>{i.name&&(t.nodes[i.name]=i),i.material&&!t.materials[i.material.name]&&(t.materials[i.material.name]=i.material)}),t}function Xue(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function hy(e,t){const i=e;return i.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function yI(e,t){let i=e;if(t.includes("-")){const r=t.split("-"),n=r.pop();return i=r.reduce((s,a)=>s[a],e),{target:i,key:n}}else return{target:i,key:t}}const Q4=/-\d+$/;function YP(e,t,i){if(Xr.str(i)){if(Q4.test(i)){const s=i.replace(Q4,""),{target:a,key:o}=yI(e,s);Array.isArray(a[o])||(a[o]=[])}const{target:r,key:n}=yI(e,i);t.__r3f.previousAttach=r[n],r[n]=t}else t.__r3f.previousAttach=i(e,t)}function K4(e,t,i){var r,n;if(Xr.str(i)){const{target:s,key:a}=yI(e,i),o=t.__r3f.previousAttach;o===void 0?delete s[a]:s[a]=o}else(r=t.__r3f)==null||r.previousAttach==null||r.previousAttach(e,t);(n=t.__r3f)==null||delete n.previousAttach}function D7(e,{children:t,key:i,ref:r,...n},{children:s,key:a,ref:o,...l}={},u=!1){var c;const h=(c=e?.__r3f)!=null?c:{},d=Object.entries(n),p=[];if(u){const v=Object.keys(l);for(let g=0;g<v.length;g++)n.hasOwnProperty(v[g])||d.unshift([v[g],T7+"remove"])}d.forEach(([v,g])=>{var w;if((w=e.__r3f)!=null&&w.primitive&&v==="object"||Xr.equ(g,l[v]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(v))return p.push([v,g,!0,[]]);let S=[];v.includes("-")&&(S=v.split("-")),p.push([v,g,!1,S]);for(const _ in n){const A=n[_];_.startsWith(`${v}-`)&&p.push([_,A,!1,_.split("-")])}});const m={...n};return h.memoizedProps&&h.memoizedProps.args&&(m.args=h.memoizedProps.args),h.memoizedProps&&h.memoizedProps.attach&&(m.attach=h.memoizedProps.attach),{memoized:m,changes:p}}function QP(e,t){var i,r,n;const s=(i=e.__r3f)!=null?i:{},a=s.root,o=(r=a==null||a.getState==null?void 0:a.getState())!=null?r:{},{memoized:l,changes:u}=Gue(t)?t:D7(e,t),c=s.eventCount;e.__r3f&&(e.__r3f.memoizedProps=l);for(let d=0;d<u.length;d++){let[p,m,v,g]=u[d];if(XP(e)){const A="srgb",C="srgb-linear";p==="encoding"?(p="colorSpace",m=m===3001?A:C):p==="outputEncoding"&&(p="outputColorSpace",m=m===3001?A:C)}let w=e,S=w[p];if(g.length&&(S=g.reduce((_,A)=>_[A],e),!(S&&S.set))){const[_,...A]=g.reverse();w=A.reverse().reduce((C,E)=>C[E],e),p=_}if(m===T7+"remove")if(w.constructor){let _=Y4.get(w.constructor);_||(_=new w.constructor,Y4.set(w.constructor,_)),m=_[p]}else m=0;if(v)m?s.handlers[p]=m:delete s.handlers[p],s.eventCount=Object.keys(s.handlers).length;else if(S&&S.set&&(S.copy||S instanceof Cg)){if(Array.isArray(m))S.fromArray?S.fromArray(m):S.set(...m);else if(S.copy&&m&&m.constructor&&S.constructor===m.constructor)S.copy(m);else if(m!==void 0){const _=S instanceof qt;!_&&S.setScalar?S.setScalar(m):S instanceof Cg&&m instanceof Cg?S.mask=m.mask:S.set(m),!M7()&&!o.linear&&_&&S.convertSRGBToLinear()}}else if(w[p]=m,w[p]instanceof _n&&w[p].format===ko&&w[p].type===Cd){const _=w[p];XP(_)&&XP(o.gl)?_.colorSpace=o.gl.outputColorSpace:_.encoding=o.gl.outputEncoding}dy(e)}if(s.parent&&e.raycast&&c!==s.eventCount){const d=DE(e).getState().internal,p=d.interaction.indexOf(e);p>-1&&d.interaction.splice(p,1),s.eventCount&&d.interaction.push(e)}return!(u.length===1&&u[0][0]==="onUpdate")&&u.length&&(n=e.__r3f)!=null&&n.parent&&xI(e),e}function dy(e){var t,i;const r=(t=e.__r3f)==null||(i=t.root)==null||i.getState==null?void 0:i.getState();r&&r.internal.frames===0&&r.invalidate()}function xI(e){e.onUpdate==null||e.onUpdate(e)}function Yue(e,t){e.manual||(A7(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function VM(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Que(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return Ey.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return Ey.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return Ey.ContinuousEventPriority;default:return Ey.DefaultEventPriority}}function R7(e,t,i,r){const n=i.get(t);n&&(i.delete(t),i.size===0&&(e.delete(r),n.target.releasePointerCapture(r)))}function Kue(e,t){const{internal:i}=e.getState();i.interaction=i.interaction.filter(r=>r!==t),i.initialHits=i.initialHits.filter(r=>r!==t),i.hovered.forEach((r,n)=>{(r.eventObject===t||r.object===t)&&i.hovered.delete(n)}),i.capturedMap.forEach((r,n)=>{R7(i.capturedMap,t,r,n)})}function Zue(e){function t(l){const{internal:u}=e.getState(),c=l.offsetX-u.initialClick[0],h=l.offsetY-u.initialClick[1];return Math.round(Math.sqrt(c*c+h*h))}function i(l){return l.filter(u=>["Move","Over","Enter","Out","Leave"].some(c=>{var h;return(h=u.__r3f)==null?void 0:h.handlers["onPointer"+c]}))}function r(l,u){const c=e.getState(),h=new Set,d=[],p=u?u(c.internal.interaction):c.internal.interaction;for(let w=0;w<p.length;w++){const S=iw(p[w]);S&&(S.raycaster.camera=void 0)}c.previousRoot||c.events.compute==null||c.events.compute(l,c);function m(w){const S=iw(w);if(!S||!S.events.enabled||S.raycaster.camera===null)return[];if(S.raycaster.camera===void 0){var _;S.events.compute==null||S.events.compute(l,S,(_=S.previousRoot)==null?void 0:_.getState()),S.raycaster.camera===void 0&&(S.raycaster.camera=null)}return S.raycaster.camera?S.raycaster.intersectObject(w,!0):[]}let v=p.flatMap(m).sort((w,S)=>{const _=iw(w.object),A=iw(S.object);return!_||!A?w.distance-S.distance:A.events.priority-_.events.priority||w.distance-S.distance}).filter(w=>{const S=VM(w);return h.has(S)?!1:(h.add(S),!0)});c.events.filter&&(v=c.events.filter(v,c));for(const w of v){let S=w.object;for(;S;){var g;(g=S.__r3f)!=null&&g.eventCount&&d.push({...w,eventObject:S}),S=S.parent}}if("pointerId"in l&&c.internal.capturedMap.has(l.pointerId))for(let w of c.internal.capturedMap.get(l.pointerId).values())h.has(VM(w.intersection))||d.push(w.intersection);return d}function n(l,u,c,h){const d=e.getState();if(l.length){const p={stopped:!1};for(const m of l){const v=iw(m.object)||d,{raycaster:g,pointer:w,camera:S,internal:_}=v,A=new pe(w.x,w.y,0).unproject(S),C=L=>{var z,G;return(z=(G=_.capturedMap.get(L))==null?void 0:G.has(m.eventObject))!=null?z:!1},E=L=>{const z={intersection:m,target:u.target};_.capturedMap.has(L)?_.capturedMap.get(L).set(m.eventObject,z):_.capturedMap.set(L,new Map([[m.eventObject,z]])),u.target.setPointerCapture(L)},I=L=>{const z=_.capturedMap.get(L);z&&R7(_.capturedMap,m.eventObject,z,L)};let T={};for(let L in u){let z=u[L];typeof z!="function"&&(T[L]=z)}let D={...m,...T,pointer:w,intersections:l,stopped:p.stopped,delta:c,unprojectedPoint:A,ray:g.ray,camera:S,stopPropagation(){const L="pointerId"in u&&_.capturedMap.get(u.pointerId);if((!L||L.has(m.eventObject))&&(D.stopped=p.stopped=!0,_.hovered.size&&Array.from(_.hovered.values()).find(z=>z.eventObject===m.eventObject))){const z=l.slice(0,l.indexOf(m));s([...z,m])}},target:{hasPointerCapture:C,setPointerCapture:E,releasePointerCapture:I},currentTarget:{hasPointerCapture:C,setPointerCapture:E,releasePointerCapture:I},nativeEvent:u};if(h(D),p.stopped===!0)break}}return l}function s(l){const{internal:u}=e.getState();for(const c of u.hovered.values())if(!l.length||!l.find(h=>h.object===c.object&&h.index===c.index&&h.instanceId===c.instanceId)){const d=c.eventObject.__r3f,p=d?.handlers;if(u.hovered.delete(VM(c)),d!=null&&d.eventCount){const m={...c,intersections:l};p.onPointerOut==null||p.onPointerOut(m),p.onPointerLeave==null||p.onPointerLeave(m)}}}function a(l,u){for(let c=0;c<u.length;c++){const h=u[c].__r3f;h==null||h.handlers.onPointerMissed==null||h.handlers.onPointerMissed(l)}}function o(l){switch(l){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return u=>{const{internal:c}=e.getState();"pointerId"in u&&c.capturedMap.has(u.pointerId)&&requestAnimationFrame(()=>{c.capturedMap.has(u.pointerId)&&(c.capturedMap.delete(u.pointerId),s([]))})}}return function(c){const{onPointerMissed:h,internal:d}=e.getState();d.lastEvent.current=c;const p=l==="onPointerMove",m=l==="onClick"||l==="onContextMenu"||l==="onDoubleClick",g=r(c,p?i:void 0),w=m?t(c):0;l==="onPointerDown"&&(d.initialClick=[c.offsetX,c.offsetY],d.initialHits=g.map(_=>_.eventObject)),m&&!g.length&&w<=2&&(a(c,d.interaction),h&&h(c)),p&&s(g);function S(_){const A=_.eventObject,C=A.__r3f,E=C?.handlers;if(C!=null&&C.eventCount)if(p){if(E.onPointerOver||E.onPointerEnter||E.onPointerOut||E.onPointerLeave){const I=VM(_),T=d.hovered.get(I);T?T.stopped&&_.stopPropagation():(d.hovered.set(I,_),E.onPointerOver==null||E.onPointerOver(_),E.onPointerEnter==null||E.onPointerEnter(_))}E.onPointerMove==null||E.onPointerMove(_)}else{const I=E[l];I?(!m||d.initialHits.includes(A))&&(a(c,d.interaction.filter(T=>!d.initialHits.includes(T))),I(_)):m&&d.initialHits.includes(A)&&a(c,d.interaction.filter(T=>!d.initialHits.includes(T)))}}n(g,c,w,S)}}return{handlePointer:o}}const I7=e=>!!(e!=null&&e.render),L7=xe.createContext(null),Jue=(e,t)=>{const i=b7((o,l)=>{const u=new pe,c=new pe,h=new pe;function d(w=l().camera,S=c,_=l().size){const{width:A,height:C,top:E,left:I}=_,T=A/C;S instanceof pe?h.copy(S):h.set(...S);const D=w.getWorldPosition(u).distanceTo(h);if(A7(w))return{width:A/w.zoom,height:C/w.zoom,top:E,left:I,factor:1,distance:D,aspect:T};{const L=w.fov*Math.PI/180,z=2*Math.tan(L/2)*D,G=z*(A/C);return{width:G,height:z,top:E,left:I,factor:A/G,distance:D,aspect:T}}}let p;const m=w=>o(S=>({performance:{...S.performance,current:w}})),v=new ft;return{set:o,get:l,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(w=1)=>e(l(),w),advance:(w,S)=>t(w,S,l()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new kz,pointer:v,mouse:v,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const w=l();p&&clearTimeout(p),w.performance.current!==w.performance.min&&m(w.performance.min),p=setTimeout(()=>m(l().performance.max),w.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:d},setEvents:w=>o(S=>({...S,events:{...S.events,...w}})),setSize:(w,S,_,A,C)=>{const E=l().camera,I={width:w,height:S,top:A||0,left:C||0,updateStyle:_};o(T=>({size:I,viewport:{...T.viewport,...d(E,c,I)}}))},setDpr:w=>o(S=>{const _=P7(w);return{viewport:{...S.viewport,dpr:_,initialDpr:S.viewport.initialDpr||_}}}),setFrameloop:(w="always")=>{const S=l().clock;S.stop(),S.elapsedTime=0,w!=="never"&&(S.start(),S.elapsedTime=0),o(()=>({frameloop:w}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:xe.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(w,S,_)=>{const A=l().internal;return A.priority=A.priority+(S>0?1:0),A.subscribers.push({ref:w,priority:S,store:_}),A.subscribers=A.subscribers.sort((C,E)=>C.priority-E.priority),()=>{const C=l().internal;C!=null&&C.subscribers&&(C.priority=C.priority-(S>0?1:0),C.subscribers=C.subscribers.filter(E=>E.ref!==w))}}}}}),r=i.getState();let n=r.size,s=r.viewport.dpr,a=r.camera;return i.subscribe(()=>{const{camera:o,size:l,viewport:u,gl:c,set:h}=i.getState();if(l.width!==n.width||l.height!==n.height||u.dpr!==s){var d;n=l,s=u.dpr,Yue(o,l),c.setPixelRatio(u.dpr);const p=(d=l.updateStyle)!=null?d:typeof HTMLCanvasElement<"u"&&c.domElement instanceof HTMLCanvasElement;c.setSize(l.width,l.height,p)}o!==a&&(a=o,h(p=>({viewport:{...p.viewport,...p.viewport.getCurrentViewport(o)}})))}),i.subscribe(o=>e(o)),i};let jM,$ue=new Set,ece=new Set,tce=new Set;function KP(e,t){if(e.size)for(const{callback:i}of e.values())i(t)}function rw(e,t){switch(e){case"before":return KP($ue,t);case"after":return KP(ece,t);case"tail":return KP(tce,t)}}let ZP,JP;function $P(e,t,i){let r=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(r=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),ZP=t.internal.subscribers,jM=0;jM<ZP.length;jM++)JP=ZP[jM],JP.ref.current(JP.store.getState(),r,i);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function ice(e){let t=!1,i,r,n;function s(l){r=requestAnimationFrame(s),t=!0,i=0,rw("before",l);for(const c of e.values()){var u;n=c.store.getState(),n.internal.active&&(n.frameloop==="always"||n.internal.frames>0)&&!((u=n.gl.xr)!=null&&u.isPresenting)&&(i+=$P(l,n))}if(rw("after",l),i===0)return rw("tail",l),t=!1,cancelAnimationFrame(r)}function a(l,u=1){var c;if(!l)return e.forEach(h=>a(h.store.getState()),u);(c=l.gl.xr)!=null&&c.isPresenting||!l.internal.active||l.frameloop==="never"||(l.internal.frames=Math.min(60,l.internal.frames+u),t||(t=!0,requestAnimationFrame(s)))}function o(l,u=!0,c,h){if(u&&rw("before",l),c)$P(l,c,h);else for(const d of e.values())$P(l,d.store.getState());u&&rw("after",l)}return{loop:s,invalidate:a,advance:o}}function O7(){const e=xe.useContext(L7);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function ll(e=i=>i,t){return O7()(e,t)}function Vz(e,t=0){const i=O7(),r=i.getState().internal.subscribe,n=E7(e);return k_(()=>r(n,t,i),[t,r,i]),null}const Z4=new WeakMap;function z7(e,t){return function(i,...r){let n=Z4.get(i);return n||(n=new i,Z4.set(i,n)),e&&e(n),Promise.all(r.map(s=>new Promise((a,o)=>n.load(s,l=>{l.scene&&Object.assign(l,que(l.scene)),a(l)},t,l=>o(new Error(`Could not load ${s}: ${l?.message}`)))))).finally(()=>n.dispose==null?void 0:n.dispose())}}function B_(e,t,i,r){const n=Array.isArray(t)?t:[t],s=Nue(z7(i,r),[e,...n],{equal:Xr.equ});return Array.isArray(t)?s:s[0]}B_.preload=function(e,t,i){const r=Array.isArray(t)?t:[t];return Fue(z7(i),[e,...r])};B_.clear=function(e,t){const i=Array.isArray(t)?t:[t];return Uue([e,...i])};const nx=new Map,{invalidate:J4,advance:$4}=ice(nx),{reconciler:r2,applyProps:Rc}=jue(nx,Que),R0={objects:"shallow",strict:!1},rce=(e,t)=>{const i=typeof e=="function"?e(t):e;return I7(i)?i:new DC({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function nce(e,t){const i=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:r,height:n,top:s,left:a,updateStyle:o=i}=t;return{width:r,height:n,top:s,left:a,updateStyle:o}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:r,height:n,top:s,left:a}=e.parentElement.getBoundingClientRect();return{width:r,height:n,top:s,left:a,updateStyle:i}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:i};return{width:0,height:0,top:0,left:0}}function sce(e){const t=nx.get(e),i=t?.fiber,r=t?.store;t&&console.warn("R3F.createRoot should only be called once!");const n=typeof reportError=="function"?reportError:console.error,s=r||Jue(J4,$4),a=i||r2.createContainer(s,Ey.ConcurrentRoot,null,!1,null,"",n,null);t||nx.set(e,{fiber:a,store:s});let o,l=!1,u;return{configure(c={}){let{gl:h,size:d,scene:p,events:m,onCreated:v,shadows:g=!1,linear:w=!1,flat:S=!1,legacy:_=!1,orthographic:A=!1,frameloop:C="always",dpr:E=[1,2],performance:I,raycaster:T,camera:D,onPointerMissed:L}=c,z=s.getState(),G=z.gl;z.gl||z.set({gl:G=rce(h,e)});let V=z.raycaster;V||z.set({raycaster:V=new x7});const{params:j,...J}=T||{};if(Xr.equ(J,V,R0)||Rc(V,{...J}),Xr.equ(j,V.params,R0)||Rc(V,{params:{...V.params,...j}}),!z.camera||z.camera===u&&!Xr.equ(u,D,R0)){u=D;const Y=D instanceof b_,le=Y?D:A?new jc(0,0,0,0,.1,1e3):new on(75,0,.1,1e3);Y||(le.position.z=5,D&&Rc(le,D),!z.camera&&!(D!=null&&D.rotation)&&le.lookAt(0,0,0)),z.set({camera:le}),V.camera=le}if(!z.scene){let Y;p instanceof i2?Y=p:(Y=new i2,p&&Rc(Y,p)),z.set({scene:hy(Y)})}if(!z.xr){var ne;const Y=(re,ue)=>{const me=s.getState();me.frameloop!=="never"&&$4(re,!0,me,ue)},le=()=>{const re=s.getState();re.gl.xr.enabled=re.gl.xr.isPresenting,re.gl.xr.setAnimationLoop(re.gl.xr.isPresenting?Y:null),re.gl.xr.isPresenting||J4(re)},oe={connect(){const re=s.getState().gl;re.xr.addEventListener("sessionstart",le),re.xr.addEventListener("sessionend",le)},disconnect(){const re=s.getState().gl;re.xr.removeEventListener("sessionstart",le),re.xr.removeEventListener("sessionend",le)}};typeof((ne=G.xr)==null?void 0:ne.addEventListener)=="function"&&oe.connect(),z.set({xr:oe})}if(G.shadowMap){const Y=G.shadowMap.enabled,le=G.shadowMap.type;if(G.shadowMap.enabled=!!g,Xr.boo(g))G.shadowMap.type=Zw;else if(Xr.str(g)){var K;const oe={basic:_8,percentage:MC,soft:Zw,variance:ug};G.shadowMap.type=(K=oe[g])!=null?K:Zw}else Xr.obj(g)&&Object.assign(G.shadowMap,g);(Y!==G.shadowMap.enabled||le!==G.shadowMap.type)&&(G.shadowMap.needsUpdate=!0)}const B=M7();B&&("enabled"in B?B.enabled=!_:"legacyMode"in B&&(B.legacyMode=_)),Rc(G,{outputEncoding:w?3e3:3001,toneMapping:S?Nu:rz}),z.legacy!==_&&z.set(()=>({legacy:_})),z.linear!==w&&z.set(()=>({linear:w})),z.flat!==S&&z.set(()=>({flat:S})),h&&!Xr.fun(h)&&!I7(h)&&!Xr.equ(h,G,R0)&&Rc(G,h),m&&!z.events.handlers&&z.set({events:m(s)});const X=nce(e,d);return Xr.equ(X,z.size,R0)||z.setSize(X.width,X.height,X.updateStyle,X.top,X.left),E&&z.viewport.dpr!==P7(E)&&z.setDpr(E),z.frameloop!==C&&z.setFrameloop(C),z.onPointerMissed||z.set({onPointerMissed:L}),I&&!Xr.equ(I,z.performance,R0)&&z.set(Y=>({performance:{...Y.performance,...I}})),o=v,l=!0,this},render(c){return l||this.configure(),r2.updateContainer(xe.createElement(ace,{store:s,children:c,onCreated:o,rootElement:e}),a,null,()=>{}),s},unmount(){k7(e)}}}function ace({store:e,children:t,onCreated:i,rootElement:r}){return k_(()=>{const n=e.getState();n.set(s=>({internal:{...s.internal,active:!0}})),i&&i(n),e.getState().events.connected||n.events.connect==null||n.events.connect(r)},[]),xe.createElement(L7.Provider,{value:e},t)}function k7(e,t){const i=nx.get(e),r=i?.fiber;if(r){const n=i?.store.getState();n&&(n.internal.active=!1),r2.updateContainer(null,r,null,()=>{n&&setTimeout(()=>{try{var s,a,o,l;n.events.disconnect==null||n.events.disconnect(),(s=n.gl)==null||(a=s.renderLists)==null||a.dispose==null||a.dispose(),(o=n.gl)==null||o.forceContextLoss==null||o.forceContextLoss(),(l=n.gl)!=null&&l.xr&&n.xr.disconnect(),Xue(n),nx.delete(e)}catch{}},500)})}}r2.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:xe.version});function jg(){return jg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)({}).hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},jg.apply(null,arguments)}function eU(e,t){let i;return(...r)=>{window.clearTimeout(i),i=window.setTimeout(()=>e(...r),t)}}function oce({debounce:e,scroll:t,polyfill:i,offsetSize:r}={debounce:0,scroll:!1,offsetSize:!1}){const n=i||(typeof window>"u"?class{}:window.ResizeObserver);if(!n)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[s,a]=xe.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),o=xe.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s,orientationHandler:null}),l=e?typeof e=="number"?e:e.scroll:null,u=e?typeof e=="number"?e:e.resize:null,c=xe.useRef(!1);xe.useEffect(()=>(c.current=!0,()=>void(c.current=!1)));const[h,d,p]=xe.useMemo(()=>{const w=()=>{if(!o.current.element)return;const{left:S,top:_,width:A,height:C,bottom:E,right:I,x:T,y:D}=o.current.element.getBoundingClientRect(),L={left:S,top:_,width:A,height:C,bottom:E,right:I,x:T,y:D};o.current.element instanceof HTMLElement&&r&&(L.height=o.current.element.offsetHeight,L.width=o.current.element.offsetWidth),Object.freeze(L),c.current&&!hce(o.current.lastBounds,L)&&a(o.current.lastBounds=L)};return[w,u?eU(w,u):w,l?eU(w,l):w]},[a,r,l,u]);function m(){o.current.scrollContainers&&(o.current.scrollContainers.forEach(w=>w.removeEventListener("scroll",p,!0)),o.current.scrollContainers=null),o.current.resizeObserver&&(o.current.resizeObserver.disconnect(),o.current.resizeObserver=null),o.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",o.current.orientationHandler))}function v(){o.current.element&&(o.current.resizeObserver=new n(p),o.current.resizeObserver.observe(o.current.element),t&&o.current.scrollContainers&&o.current.scrollContainers.forEach(w=>w.addEventListener("scroll",p,{capture:!0,passive:!0})),o.current.orientationHandler=()=>{p()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",o.current.orientationHandler))}const g=w=>{!w||w===o.current.element||(m(),o.current.element=w,o.current.scrollContainers=B7(w),v())};return uce(p,!!t),lce(d),xe.useEffect(()=>{m(),v()},[t,p,d]),xe.useEffect(()=>m,[]),[g,s,h]}function lce(e){xe.useEffect(()=>{const t=e;return window.addEventListener("resize",t),()=>void window.removeEventListener("resize",t)},[e])}function uce(e,t){xe.useEffect(()=>{if(t){const i=e;return window.addEventListener("scroll",i,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",i,!0)}},[e,t])}function B7(e){const t=[];if(!e||e===document.body)return t;const{overflow:i,overflowX:r,overflowY:n}=window.getComputedStyle(e);return[i,r,n].some(s=>s==="auto"||s==="scroll")&&t.push(e),[...t,...B7(e.parentElement)]}const cce=["x","y","top","bottom","left","right","width","height"],hce=(e,t)=>cce.every(i=>e[i]===t[i]);var dce=Object.defineProperty,fce=Object.defineProperties,pce=Object.getOwnPropertyDescriptors,tU=Object.getOwnPropertySymbols,mce=Object.prototype.hasOwnProperty,gce=Object.prototype.propertyIsEnumerable,iU=(e,t,i)=>t in e?dce(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,rU=(e,t)=>{for(var i in t||(t={}))mce.call(t,i)&&iU(e,i,t[i]);if(tU)for(var i of tU(t))gce.call(t,i)&&iU(e,i,t[i]);return e},vce=(e,t)=>fce(e,pce(t)),nU,sU;typeof window<"u"&&((nU=window.document)!=null&&nU.createElement||((sU=window.navigator)==null?void 0:sU.product)==="ReactNative")?xe.useLayoutEffect:xe.useEffect;function N7(e,t,i){if(!e)return;if(i(e)===!0)return e;let r=e.child;for(;r;){const n=N7(r,t,i);if(n)return n;r=r.sibling}}function F7(e){try{return Object.defineProperties(e,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return e}}const aU=console.error;console.error=function(){const e=[...arguments].join("");if(e?.startsWith("Warning:")&&e.includes("useContext")){console.error=aU;return}return aU.apply(this,arguments)};const jz=F7(xe.createContext(null));class U7 extends xe.Component{render(){return xe.createElement(jz.Provider,{value:this._reactInternals},this.props.children)}}function yce(){const e=xe.useContext(jz);if(e===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const t=xe.useId();return xe.useMemo(()=>{for(const r of[e,e?.alternate]){if(!r)continue;const n=N7(r,!1,s=>{let a=s.memoizedState;for(;a;){if(a.memoizedState===t)return!0;a=a.next}});if(n)return n}},[e,t])}function xce(){const e=yce(),[t]=xe.useState(()=>new Map);t.clear();let i=e;for(;i;){if(i.type&&typeof i.type=="object"){const n=i.type._context===void 0&&i.type.Provider===i.type?i.type:i.type._context;n&&n!==jz&&!t.has(n)&&t.set(n,xe.useContext(F7(n)))}i=i.return}return t}function wce(){const e=xce();return xe.useMemo(()=>Array.from(e.keys()).reduce((t,i)=>r=>xe.createElement(t,null,xe.createElement(i.Provider,vce(rU({},r),{value:e.get(i)}))),t=>xe.createElement(U7,rU({},t))),[e])}const e3={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function bce(e){const{handlePointer:t}=Zue(e);return{priority:1,enabled:!0,compute(i,r,n){r.pointer.set(i.offsetX/r.size.width*2-1,-(i.offsetY/r.size.height)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)},connected:void 0,handlers:Object.keys(e3).reduce((i,r)=>({...i,[r]:t(r)}),{}),update:()=>{var i;const{events:r,internal:n}=e.getState();(i=n.lastEvent)!=null&&i.current&&r.handlers&&r.handlers.onPointerMove(n.lastEvent.current)},connect:i=>{var r;const{set:n,events:s}=e.getState();s.disconnect==null||s.disconnect(),n(a=>({events:{...a.events,connected:i}})),Object.entries((r=s.handlers)!=null?r:[]).forEach(([a,o])=>{const[l,u]=e3[a];i.addEventListener(l,o,{passive:u})})},disconnect:()=>{const{set:i,events:r}=e.getState();if(r.connected){var n;Object.entries((n=r.handlers)!=null?n:[]).forEach(([s,a])=>{if(r&&r.connected instanceof HTMLElement){const[o]=e3[s];r.connected.removeEventListener(o,a)}}),i(s=>({events:{...s.events,connected:void 0}}))}}}}const _ce=xe.forwardRef(function({children:t,fallback:i,resize:r,style:n,gl:s,events:a=bce,eventSource:o,eventPrefix:l,shadows:u,linear:c,flat:h,legacy:d,orthographic:p,frameloop:m,dpr:v,performance:g,raycaster:w,camera:S,scene:_,onPointerMissed:A,onCreated:C,...E},I){xe.useMemo(()=>Vue(Mue),[]);const T=wce(),[D,L]=oce({scroll:!0,debounce:{scroll:50,resize:0},...r}),z=xe.useRef(null),G=xe.useRef(null);xe.useImperativeHandle(I,()=>z.current);const V=E7(A),[j,J]=xe.useState(!1),[ne,K]=xe.useState(!1);if(j)throw j;if(ne)throw ne;const B=xe.useRef(null);k_(()=>{const F=z.current;L.width>0&&L.height>0&&F&&(B.current||(B.current=sce(F)),B.current.configure({gl:s,events:a,shadows:u,linear:c,flat:h,legacy:d,orthographic:p,frameloop:m,dpr:v,performance:g,raycaster:w,camera:S,scene:_,size:L,onPointerMissed:(...X)=>V.current==null?void 0:V.current(...X),onCreated:X=>{X.events.connect==null||X.events.connect(o?Hue(o)?o.current:o:G.current),l&&X.setEvents({compute:(Y,le)=>{const oe=Y[l+"X"],re=Y[l+"Y"];le.pointer.set(oe/le.size.width*2-1,-(re/le.size.height)*2+1),le.raycaster.setFromCamera(le.pointer,le.camera)}}),C?.(X)}}),B.current.render(xe.createElement(T,null,xe.createElement(C7,{set:K},xe.createElement(xe.Suspense,{fallback:xe.createElement(Wue,{set:J})},t)))))}),xe.useEffect(()=>{const F=z.current;if(F)return()=>k7(F)},[]);const Z=o?"none":"auto";return xe.createElement("div",jg({ref:G,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:Z,...n}},E),xe.createElement("div",{ref:D,style:{width:"100%",height:"100%"}},xe.createElement("canvas",{ref:z,style:{display:"block"}},i)))}),Sce=xe.forwardRef(function(t,i){return xe.createElement(U7,null,xe.createElement(_ce,jg({},t,{ref:i})))}),N_=new pe,Hz=new pe,Mce=new pe;function Ace(e,t,i){const r=N_.setFromMatrixPosition(e.matrixWorld);r.project(t);const n=i.width/2,s=i.height/2;return[r.x*n+n,-(r.y*s)+s]}function Ece(e,t){const i=N_.setFromMatrixPosition(e.matrixWorld),r=Hz.setFromMatrixPosition(t.matrixWorld),n=i.sub(r),s=t.getWorldDirection(Mce);return n.angleTo(s)>Math.PI/2}function Cce(e,t,i,r){const n=N_.setFromMatrixPosition(e.matrixWorld),s=n.clone();s.project(t),i.setFromCamera(s,t);const a=i.intersectObjects(r,!0);if(a.length){const o=a[0].distance;return n.distanceTo(i.ray.origin)<o}return!0}function Tce(e,t){if(t instanceof jc)return t.zoom;if(t instanceof on){const i=N_.setFromMatrixPosition(e.matrixWorld),r=Hz.setFromMatrixPosition(t.matrixWorld),n=t.fov*Math.PI/180,s=i.distanceTo(r);return 1/(2*Math.tan(n/2)*s)}else return 1}function Pce(e,t,i){if(t instanceof on||t instanceof jc){const r=N_.setFromMatrixPosition(e.matrixWorld),n=Hz.setFromMatrixPosition(t.matrixWorld),s=r.distanceTo(n),a=(i[1]-i[0])/(t.far-t.near),o=i[1]-a*t.far;return Math.round(a*s+o)}}const wI=e=>Math.abs(e)<1e-10?0:e;function V7(e,t,i=""){let r="matrix3d(";for(let n=0;n!==16;n++)r+=wI(t[n]*e.elements[n])+(n!==15?",":")");return i+r}const Dce=(e=>t=>V7(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),Rce=(e=>(t,i)=>V7(t,e(i),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function Ice(e){return e&&typeof e=="object"&&"current"in e}const Lce=xe.forwardRef(({children:e,eps:t=.001,style:i,className:r,prepend:n,center:s,fullscreen:a,portal:o,distanceFactor:l,sprite:u=!1,transform:c=!1,occlude:h,onOcclude:d,castShadow:p,receiveShadow:m,material:v,geometry:g,zIndexRange:w=[16777271,0],calculatePosition:S=Ace,as:_="div",wrapperClass:A,pointerEvents:C="auto",...E},I)=>{const{gl:T,camera:D,scene:L,size:z,raycaster:G,events:V,viewport:j}=ll(),[J]=xe.useState(()=>document.createElement(_)),ne=xe.useRef(),K=xe.useRef(null),B=xe.useRef(0),Z=xe.useRef([0,0]),F=xe.useRef(null),X=xe.useRef(null),Y=o?.current||V.connected||T.domElement.parentNode,le=xe.useRef(null),oe=xe.useRef(!1),re=xe.useMemo(()=>h&&h!=="blending"||Array.isArray(h)&&h.length&&Ice(h[0]),[h]);xe.useLayoutEffect(()=>{const Ae=T.domElement;Ae.style.zIndex=`${Math.floor(w[0]/2)}`,Ae.style.position="absolute",Ae.style.pointerEvents="none"},[]),xe.useLayoutEffect(()=>{if(K.current){const Ae=ne.current=YG.createRoot(J);if(L.updateMatrixWorld(),c)J.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const Ie=S(K.current,D,z);J.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${Ie[0]}px,${Ie[1]}px,0);transform-origin:0 0;`}return Y&&(n?Y.prepend(J):Y.appendChild(J)),()=>{Y&&Y.removeChild(J),Ae.unmount()}}},[Y,c]),xe.useLayoutEffect(()=>{A&&(J.className=A)},[A]);const ue=xe.useMemo(()=>c?{position:"absolute",top:0,left:0,width:z.width,height:z.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:s?"translate3d(-50%,-50%,0)":"none",...a&&{top:-z.height/2,left:-z.width/2,width:z.width,height:z.height},...i},[i,s,a,z,c]),me=xe.useMemo(()=>({position:"absolute",pointerEvents:C}),[C]);xe.useLayoutEffect(()=>{if(oe.current=!1,c){var Ae;(Ae=ne.current)==null||Ae.render(xe.createElement("div",{ref:F,style:ue},xe.createElement("div",{ref:X,style:me},xe.createElement("div",{ref:I,className:r,style:i,children:e}))))}else{var Ie;(Ie=ne.current)==null||Ie.render(xe.createElement("div",{ref:I,style:ue,className:r,children:e}))}});const he=xe.useRef(!0);Vz(Ae=>{if(K.current){D.updateMatrixWorld(),K.current.updateWorldMatrix(!0,!1);const Ie=c?Z.current:S(K.current,D,z);if(c||Math.abs(B.current-D.zoom)>t||Math.abs(Z.current[0]-Ie[0])>t||Math.abs(Z.current[1]-Ie[1])>t){const Me=Ece(K.current,D);let De=!1;re&&(h!=="blending"?De=[L]:Array.isArray(h)&&(De=h.map(ot=>ot.current)));const Ve=he.current;if(De){const ot=Cce(K.current,D,G,De);he.current=ot&&!Me}else he.current=!Me;Ve!==he.current&&(d?d(!he.current):J.style.display=he.current?"block":"none");const Ge=Math.floor(w[0]/2),Qe=h?re?[w[0],Ge]:[Ge-1,0]:w;if(J.style.zIndex=`${Pce(K.current,D,Qe)}`,c){const[ot,$e]=[z.width/2,z.height/2],Ke=D.projectionMatrix.elements[5]*$e,{isOrthographicCamera:bt,top:xt,left:q,bottom:N,right:de}=D,ze=Dce(D.matrixWorldInverse),$=bt?`scale(${Ke})translate(${wI(-(de+q)/2)}px,${wI((xt+N)/2)}px)`:`translateZ(${Ke}px)`;let Ue=K.current.matrixWorld;u&&(Ue=D.matrixWorldInverse.clone().transpose().copyPosition(Ue).scale(K.current.scale),Ue.elements[3]=Ue.elements[7]=Ue.elements[11]=0,Ue.elements[15]=1),J.style.width=z.width+"px",J.style.height=z.height+"px",J.style.perspective=bt?"":`${Ke}px`,F.current&&X.current&&(F.current.style.transform=`${$}${ze}translate(${ot}px,${$e}px)`,X.current.style.transform=Rce(Ue,1/((l||10)/400)))}else{const ot=l===void 0?1:Tce(K.current,D)*l;J.style.transform=`translate3d(${Ie[0]}px,${Ie[1]}px,0) scale(${ot})`}Z.current=Ie,B.current=D.zoom}}if(!re&&le.current&&!oe.current)if(c){if(F.current){const Ie=F.current.children[0];if(Ie!=null&&Ie.clientWidth&&Ie!=null&&Ie.clientHeight){const{isOrthographicCamera:Me}=D;if(Me||g)E.scale&&(Array.isArray(E.scale)?E.scale instanceof pe?le.current.scale.copy(E.scale.clone().divideScalar(1)):le.current.scale.set(1/E.scale[0],1/E.scale[1],1/E.scale[2]):le.current.scale.setScalar(1/E.scale));else{const De=(l||10)/400,Ve=Ie.clientWidth*De,Ge=Ie.clientHeight*De;le.current.scale.set(Ve,Ge,1)}oe.current=!0}}}else{const Ie=J.children[0];if(Ie!=null&&Ie.clientWidth&&Ie!=null&&Ie.clientHeight){const Me=1/j.factor,De=Ie.clientWidth*Me,Ve=Ie.clientHeight*Me;le.current.scale.set(De,Ve,1),oe.current=!0}le.current.lookAt(Ae.camera.position)}});const Ce=xe.useMemo(()=>({vertexShader:c?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom" 
            is false. 
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;
            
            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[c]);return xe.createElement("group",jg({},E,{ref:K}),h&&!re&&xe.createElement("mesh",{castShadow:p,receiveShadow:m,ref:le},g||xe.createElement("planeGeometry",null),v||xe.createElement("shaderMaterial",{side:Nc,vertexShader:Ce.vertexShader,fragmentShader:Ce.fragmentShader})))});let nw=0;const Oce=b7(e=>(Ay.onStart=(t,i,r)=>{e({active:!0,item:t,loaded:i,total:r,progress:(i-nw)/(r-nw)*100})},Ay.onLoad=()=>{e({active:!1})},Ay.onError=t=>e(i=>({errors:[...i.errors,t]})),Ay.onProgress=(t,i,r)=>{i===r&&(nw=r),e({active:!0,item:t,loaded:i,total:r,progress:(i-nw)/(r-nw)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0}));function zce(e){return function(t){e.forEach(function(i){typeof i=="function"?i(t):i!=null&&(i.current=t)})}}var kce=Object.defineProperty,Bce=(e,t,i)=>t in e?kce(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Nce=(e,t,i)=>(Bce(e,t+"",i),i);class Fce{constructor(){Nce(this,"_listeners")}addEventListener(t,i){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[t]===void 0&&(r[t]=[]),r[t].indexOf(i)===-1&&r[t].push(i)}hasEventListener(t,i){if(this._listeners===void 0)return!1;const r=this._listeners;return r[t]!==void 0&&r[t].indexOf(i)!==-1}removeEventListener(t,i){if(this._listeners===void 0)return;const n=this._listeners[t];if(n!==void 0){const s=n.indexOf(i);s!==-1&&n.splice(s,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const r=this._listeners[t.type];if(r!==void 0){t.target=this;const n=r.slice(0);for(let s=0,a=n.length;s<a;s++)n[s].call(this,t);t.target=null}}}var Uce=Object.defineProperty,Vce=(e,t,i)=>t in e?Uce(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,vi=(e,t,i)=>(Vce(e,typeof t!="symbol"?t+"":t,i),i);const HM=new Cx,oU=new rd,jce=Math.cos(70*(Math.PI/180)),lU=(e,t)=>(e%t+t)%t;let Hce=class extends Fce{constructor(t,i){super(),vi(this,"object"),vi(this,"domElement"),vi(this,"enabled",!0),vi(this,"target",new pe),vi(this,"minDistance",0),vi(this,"maxDistance",1/0),vi(this,"minZoom",0),vi(this,"maxZoom",1/0),vi(this,"minPolarAngle",0),vi(this,"maxPolarAngle",Math.PI),vi(this,"minAzimuthAngle",-1/0),vi(this,"maxAzimuthAngle",1/0),vi(this,"enableDamping",!1),vi(this,"dampingFactor",.05),vi(this,"enableZoom",!0),vi(this,"zoomSpeed",1),vi(this,"enableRotate",!0),vi(this,"rotateSpeed",1),vi(this,"enablePan",!0),vi(this,"panSpeed",1),vi(this,"screenSpacePanning",!0),vi(this,"keyPanSpeed",7),vi(this,"zoomToCursor",!1),vi(this,"autoRotate",!1),vi(this,"autoRotateSpeed",2),vi(this,"reverseOrbit",!1),vi(this,"reverseHorizontalOrbit",!1),vi(this,"reverseVerticalOrbit",!1),vi(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),vi(this,"mouseButtons",{LEFT:qm.ROTATE,MIDDLE:qm.DOLLY,RIGHT:qm.PAN}),vi(this,"touches",{ONE:Xm.ROTATE,TWO:Xm.DOLLY_PAN}),vi(this,"target0"),vi(this,"position0"),vi(this,"zoom0"),vi(this,"_domElementKeyEvents",null),vi(this,"getPolarAngle"),vi(this,"getAzimuthalAngle"),vi(this,"setPolarAngle"),vi(this,"setAzimuthalAngle"),vi(this,"getDistance"),vi(this,"getZoomScale"),vi(this,"listenToKeyEvents"),vi(this,"stopListenToKeyEvents"),vi(this,"saveState"),vi(this,"reset"),vi(this,"update"),vi(this,"connect"),vi(this,"dispose"),vi(this,"dollyIn"),vi(this,"dollyOut"),vi(this,"getScale"),vi(this,"setScale"),this.object=t,this.domElement=i,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>c.phi,this.getAzimuthalAngle=()=>c.theta,this.setPolarAngle=_e=>{let it=lU(_e,2*Math.PI),At=c.phi;At<0&&(At+=2*Math.PI),it<0&&(it+=2*Math.PI);let ie=Math.abs(it-At);2*Math.PI-ie<ie&&(it<At?it+=2*Math.PI:At+=2*Math.PI),h.phi=it-At,r.update()},this.setAzimuthalAngle=_e=>{let it=lU(_e,2*Math.PI),At=c.theta;At<0&&(At+=2*Math.PI),it<0&&(it+=2*Math.PI);let ie=Math.abs(it-At);2*Math.PI-ie<ie&&(it<At?it+=2*Math.PI:At+=2*Math.PI),h.theta=it-At,r.update()},this.getDistance=()=>r.object.position.distanceTo(r.target),this.listenToKeyEvents=_e=>{_e.addEventListener("keydown",rt),this._domElementKeyEvents=_e},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",rt),this._domElementKeyEvents=null},this.saveState=()=>{r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=()=>{r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(n),r.update(),l=o.NONE},this.update=(()=>{const _e=new pe,it=new pe(0,1,0),At=new Fa().setFromUnitVectors(t.up,it),ie=At.clone().invert(),we=new pe,Re=new Fa,We=2*Math.PI;return function(){const Ut=r.object.position;At.setFromUnitVectors(t.up,it),ie.copy(At).invert(),_e.copy(Ut).sub(r.target),_e.applyQuaternion(At),c.setFromVector3(_e),r.autoRotate&&l===o.NONE&&j(G()),r.enableDamping?(c.theta+=h.theta*r.dampingFactor,c.phi+=h.phi*r.dampingFactor):(c.theta+=h.theta,c.phi+=h.phi);let si=r.minAzimuthAngle,Si=r.maxAzimuthAngle;isFinite(si)&&isFinite(Si)&&(si<-Math.PI?si+=We:si>Math.PI&&(si-=We),Si<-Math.PI?Si+=We:Si>Math.PI&&(Si-=We),si<=Si?c.theta=Math.max(si,Math.min(Si,c.theta)):c.theta=c.theta>(si+Si)/2?Math.max(si,c.theta):Math.min(Si,c.theta)),c.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,c.phi)),c.makeSafe(),r.enableDamping===!0?r.target.addScaledVector(p,r.dampingFactor):r.target.add(p),r.zoomToCursor&&D||r.object.isOrthographicCamera?c.radius=le(c.radius):c.radius=le(c.radius*d),_e.setFromSpherical(c),_e.applyQuaternion(ie),Ut.copy(r.target).add(_e),r.object.matrixAutoUpdate||r.object.updateMatrix(),r.object.lookAt(r.target),r.enableDamping===!0?(h.theta*=1-r.dampingFactor,h.phi*=1-r.dampingFactor,p.multiplyScalar(1-r.dampingFactor)):(h.set(0,0,0),p.set(0,0,0));let ar=!1;if(r.zoomToCursor&&D){let ri=null;if(r.object instanceof on&&r.object.isPerspectiveCamera){const Yi=_e.length();ri=le(Yi*d);const ji=Yi-ri;r.object.position.addScaledVector(I,ji),r.object.updateMatrixWorld()}else if(r.object.isOrthographicCamera){const Yi=new pe(T.x,T.y,0);Yi.unproject(r.object),r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/d)),r.object.updateProjectionMatrix(),ar=!0;const ji=new pe(T.x,T.y,0);ji.unproject(r.object),r.object.position.sub(ji).add(Yi),r.object.updateMatrixWorld(),ri=_e.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),r.zoomToCursor=!1;ri!==null&&(r.screenSpacePanning?r.target.set(0,0,-1).transformDirection(r.object.matrix).multiplyScalar(ri).add(r.object.position):(HM.origin.copy(r.object.position),HM.direction.set(0,0,-1).transformDirection(r.object.matrix),Math.abs(r.object.up.dot(HM.direction))<jce?t.lookAt(r.target):(oU.setFromNormalAndCoplanarPoint(r.object.up,r.target),HM.intersectPlane(oU,r.target))))}else r.object instanceof jc&&r.object.isOrthographicCamera&&(ar=d!==1,ar&&(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/d)),r.object.updateProjectionMatrix()));return d=1,D=!1,ar||we.distanceToSquared(r.object.position)>u||8*(1-Re.dot(r.object.quaternion))>u?(r.dispatchEvent(n),we.copy(r.object.position),Re.copy(r.object.quaternion),ar=!1,!0):!1}})(),this.connect=_e=>{r.domElement=_e,r.domElement.style.touchAction="none",r.domElement.addEventListener("contextmenu",lt),r.domElement.addEventListener("pointerdown",q),r.domElement.addEventListener("pointercancel",de),r.domElement.addEventListener("wheel",Ue)},this.dispose=()=>{var _e,it,At,ie,we,Re;r.domElement&&(r.domElement.style.touchAction="auto"),(_e=r.domElement)==null||_e.removeEventListener("contextmenu",lt),(it=r.domElement)==null||it.removeEventListener("pointerdown",q),(At=r.domElement)==null||At.removeEventListener("pointercancel",de),(ie=r.domElement)==null||ie.removeEventListener("wheel",Ue),(we=r.domElement)==null||we.ownerDocument.removeEventListener("pointermove",N),(Re=r.domElement)==null||Re.ownerDocument.removeEventListener("pointerup",de),r._domElementKeyEvents!==null&&r._domElementKeyEvents.removeEventListener("keydown",rt)};const r=this,n={type:"change"},s={type:"start"},a={type:"end"},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=o.NONE;const u=1e-6,c=new vI,h=new vI;let d=1;const p=new pe,m=new ft,v=new ft,g=new ft,w=new ft,S=new ft,_=new ft,A=new ft,C=new ft,E=new ft,I=new pe,T=new ft;let D=!1;const L=[],z={};function G(){return 2*Math.PI/60/60*r.autoRotateSpeed}function V(){return Math.pow(.95,r.zoomSpeed)}function j(_e){r.reverseOrbit||r.reverseHorizontalOrbit?h.theta+=_e:h.theta-=_e}function J(_e){r.reverseOrbit||r.reverseVerticalOrbit?h.phi+=_e:h.phi-=_e}const ne=(()=>{const _e=new pe;return function(At,ie){_e.setFromMatrixColumn(ie,0),_e.multiplyScalar(-At),p.add(_e)}})(),K=(()=>{const _e=new pe;return function(At,ie){r.screenSpacePanning===!0?_e.setFromMatrixColumn(ie,1):(_e.setFromMatrixColumn(ie,0),_e.crossVectors(r.object.up,_e)),_e.multiplyScalar(At),p.add(_e)}})(),B=(()=>{const _e=new pe;return function(At,ie){const we=r.domElement;if(we&&r.object instanceof on&&r.object.isPerspectiveCamera){const Re=r.object.position;_e.copy(Re).sub(r.target);let We=_e.length();We*=Math.tan(r.object.fov/2*Math.PI/180),ne(2*At*We/we.clientHeight,r.object.matrix),K(2*ie*We/we.clientHeight,r.object.matrix)}else we&&r.object instanceof jc&&r.object.isOrthographicCamera?(ne(At*(r.object.right-r.object.left)/r.object.zoom/we.clientWidth,r.object.matrix),K(ie*(r.object.top-r.object.bottom)/r.object.zoom/we.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}})();function Z(_e){r.object instanceof on&&r.object.isPerspectiveCamera||r.object instanceof jc&&r.object.isOrthographicCamera?d=_e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function F(_e){Z(d/_e)}function X(_e){Z(d*_e)}function Y(_e){if(!r.zoomToCursor||!r.domElement)return;D=!0;const it=r.domElement.getBoundingClientRect(),At=_e.clientX-it.left,ie=_e.clientY-it.top,we=it.width,Re=it.height;T.x=At/we*2-1,T.y=-(ie/Re)*2+1,I.set(T.x,T.y,1).unproject(r.object).sub(r.object.position).normalize()}function le(_e){return Math.max(r.minDistance,Math.min(r.maxDistance,_e))}function oe(_e){m.set(_e.clientX,_e.clientY)}function re(_e){Y(_e),A.set(_e.clientX,_e.clientY)}function ue(_e){w.set(_e.clientX,_e.clientY)}function me(_e){v.set(_e.clientX,_e.clientY),g.subVectors(v,m).multiplyScalar(r.rotateSpeed);const it=r.domElement;it&&(j(2*Math.PI*g.x/it.clientHeight),J(2*Math.PI*g.y/it.clientHeight)),m.copy(v),r.update()}function he(_e){C.set(_e.clientX,_e.clientY),E.subVectors(C,A),E.y>0?F(V()):E.y<0&&X(V()),A.copy(C),r.update()}function Ce(_e){S.set(_e.clientX,_e.clientY),_.subVectors(S,w).multiplyScalar(r.panSpeed),B(_.x,_.y),w.copy(S),r.update()}function Ae(_e){Y(_e),_e.deltaY<0?X(V()):_e.deltaY>0&&F(V()),r.update()}function Ie(_e){let it=!1;switch(_e.code){case r.keys.UP:B(0,r.keyPanSpeed),it=!0;break;case r.keys.BOTTOM:B(0,-r.keyPanSpeed),it=!0;break;case r.keys.LEFT:B(r.keyPanSpeed,0),it=!0;break;case r.keys.RIGHT:B(-r.keyPanSpeed,0),it=!0;break}it&&(_e.preventDefault(),r.update())}function Me(){if(L.length==1)m.set(L[0].pageX,L[0].pageY);else{const _e=.5*(L[0].pageX+L[1].pageX),it=.5*(L[0].pageY+L[1].pageY);m.set(_e,it)}}function De(){if(L.length==1)w.set(L[0].pageX,L[0].pageY);else{const _e=.5*(L[0].pageX+L[1].pageX),it=.5*(L[0].pageY+L[1].pageY);w.set(_e,it)}}function Ve(){const _e=L[0].pageX-L[1].pageX,it=L[0].pageY-L[1].pageY,At=Math.sqrt(_e*_e+it*it);A.set(0,At)}function Ge(){r.enableZoom&&Ve(),r.enablePan&&De()}function Qe(){r.enableZoom&&Ve(),r.enableRotate&&Me()}function ot(_e){if(L.length==1)v.set(_e.pageX,_e.pageY);else{const At=dt(_e),ie=.5*(_e.pageX+At.x),we=.5*(_e.pageY+At.y);v.set(ie,we)}g.subVectors(v,m).multiplyScalar(r.rotateSpeed);const it=r.domElement;it&&(j(2*Math.PI*g.x/it.clientHeight),J(2*Math.PI*g.y/it.clientHeight)),m.copy(v)}function $e(_e){if(L.length==1)S.set(_e.pageX,_e.pageY);else{const it=dt(_e),At=.5*(_e.pageX+it.x),ie=.5*(_e.pageY+it.y);S.set(At,ie)}_.subVectors(S,w).multiplyScalar(r.panSpeed),B(_.x,_.y),w.copy(S)}function Ke(_e){const it=dt(_e),At=_e.pageX-it.x,ie=_e.pageY-it.y,we=Math.sqrt(At*At+ie*ie);C.set(0,we),E.set(0,Math.pow(C.y/A.y,r.zoomSpeed)),F(E.y),A.copy(C)}function bt(_e){r.enableZoom&&Ke(_e),r.enablePan&&$e(_e)}function xt(_e){r.enableZoom&&Ke(_e),r.enableRotate&&ot(_e)}function q(_e){var it,At;r.enabled!==!1&&(L.length===0&&((it=r.domElement)==null||it.ownerDocument.addEventListener("pointermove",N),(At=r.domElement)==null||At.ownerDocument.addEventListener("pointerup",de)),et(_e),_e.pointerType==="touch"?Ye(_e):ze(_e))}function N(_e){r.enabled!==!1&&(_e.pointerType==="touch"?Ee(_e):$(_e))}function de(_e){var it,At,ie;pt(_e),L.length===0&&((it=r.domElement)==null||it.releasePointerCapture(_e.pointerId),(At=r.domElement)==null||At.ownerDocument.removeEventListener("pointermove",N),(ie=r.domElement)==null||ie.ownerDocument.removeEventListener("pointerup",de)),r.dispatchEvent(a),l=o.NONE}function ze(_e){let it;switch(_e.button){case 0:it=r.mouseButtons.LEFT;break;case 1:it=r.mouseButtons.MIDDLE;break;case 2:it=r.mouseButtons.RIGHT;break;default:it=-1}switch(it){case qm.DOLLY:if(r.enableZoom===!1)return;re(_e),l=o.DOLLY;break;case qm.ROTATE:if(_e.ctrlKey||_e.metaKey||_e.shiftKey){if(r.enablePan===!1)return;ue(_e),l=o.PAN}else{if(r.enableRotate===!1)return;oe(_e),l=o.ROTATE}break;case qm.PAN:if(_e.ctrlKey||_e.metaKey||_e.shiftKey){if(r.enableRotate===!1)return;oe(_e),l=o.ROTATE}else{if(r.enablePan===!1)return;ue(_e),l=o.PAN}break;default:l=o.NONE}l!==o.NONE&&r.dispatchEvent(s)}function $(_e){if(r.enabled!==!1)switch(l){case o.ROTATE:if(r.enableRotate===!1)return;me(_e);break;case o.DOLLY:if(r.enableZoom===!1)return;he(_e);break;case o.PAN:if(r.enablePan===!1)return;Ce(_e);break}}function Ue(_e){r.enabled===!1||r.enableZoom===!1||l!==o.NONE&&l!==o.ROTATE||(_e.preventDefault(),r.dispatchEvent(s),Ae(_e),r.dispatchEvent(a))}function rt(_e){r.enabled===!1||r.enablePan===!1||Ie(_e)}function Ye(_e){switch(mt(_e),L.length){case 1:switch(r.touches.ONE){case Xm.ROTATE:if(r.enableRotate===!1)return;Me(),l=o.TOUCH_ROTATE;break;case Xm.PAN:if(r.enablePan===!1)return;De(),l=o.TOUCH_PAN;break;default:l=o.NONE}break;case 2:switch(r.touches.TWO){case Xm.DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;Ge(),l=o.TOUCH_DOLLY_PAN;break;case Xm.DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;Qe(),l=o.TOUCH_DOLLY_ROTATE;break;default:l=o.NONE}break;default:l=o.NONE}l!==o.NONE&&r.dispatchEvent(s)}function Ee(_e){switch(mt(_e),l){case o.TOUCH_ROTATE:if(r.enableRotate===!1)return;ot(_e),r.update();break;case o.TOUCH_PAN:if(r.enablePan===!1)return;$e(_e),r.update();break;case o.TOUCH_DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;bt(_e),r.update();break;case o.TOUCH_DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;xt(_e),r.update();break;default:l=o.NONE}}function lt(_e){r.enabled!==!1&&_e.preventDefault()}function et(_e){L.push(_e)}function pt(_e){delete z[_e.pointerId];for(let it=0;it<L.length;it++)if(L[it].pointerId==_e.pointerId){L.splice(it,1);return}}function mt(_e){let it=z[_e.pointerId];it===void 0&&(it=new ft,z[_e.pointerId]=it),it.set(_e.pageX,_e.pageY)}function dt(_e){const it=_e.pointerId===L[0].pointerId?L[1]:L[0];return z[it.pointerId]}this.dollyIn=(_e=V())=>{X(_e),r.update()},this.dollyOut=(_e=V())=>{F(_e),r.update()},this.getScale=()=>d,this.setScale=_e=>{Z(_e),r.update()},this.getZoomScale=()=>V(),i!==void 0&&this.connect(i),this.update()}};class Wce extends Fi{constructor(t,i,r,n){super();const s=[],a=[],o=[],l=new pe,u=new Oi;u.makeRotationFromEuler(r),u.setPosition(i);const c=new Oi;c.copy(u).invert(),h(),this.setAttribute("position",new Jt(s,3)),this.setAttribute("normal",new Jt(a,3)),this.setAttribute("uv",new Jt(o,2));function h(){let v,g=[];const w=new pe,S=new pe;if(t.geometry.isGeometry===!0){console.error("THREE.DecalGeometry no longer supports THREE.Geometry. Use BufferGeometry instead.");return}const _=t.geometry,A=_.attributes.position,C=_.attributes.normal;if(_.index!==null){const E=_.index;for(v=0;v<E.count;v++)w.fromBufferAttribute(A,E.getX(v)),S.fromBufferAttribute(C,E.getX(v)),d(g,w,S)}else for(v=0;v<A.count;v++)w.fromBufferAttribute(A,v),S.fromBufferAttribute(C,v),d(g,w,S);for(g=p(g,l.set(1,0,0)),g=p(g,l.set(-1,0,0)),g=p(g,l.set(0,1,0)),g=p(g,l.set(0,-1,0)),g=p(g,l.set(0,0,1)),g=p(g,l.set(0,0,-1)),v=0;v<g.length;v++){const E=g[v];o.push(.5+E.position.x/n.x,.5+E.position.y/n.y),E.position.applyMatrix4(u),s.push(E.position.x,E.position.y,E.position.z),a.push(E.normal.x,E.normal.y,E.normal.z)}}function d(v,g,w){g.applyMatrix4(t.matrixWorld),g.applyMatrix4(c),w.transformDirection(t.matrixWorld),v.push(new uU(g.clone(),w.clone()))}function p(v,g){const w=[],S=.5*Math.abs(n.dot(g));for(let _=0;_<v.length;_+=3){let A,C,E,I=0,T,D,L,z;const G=v[_+0].position.dot(g)-S,V=v[_+1].position.dot(g)-S,j=v[_+2].position.dot(g)-S;switch(A=G>0,C=V>0,E=j>0,I=(A?1:0)+(C?1:0)+(E?1:0),I){case 0:{w.push(v[_]),w.push(v[_+1]),w.push(v[_+2]);break}case 1:{if(A&&(T=v[_+1],D=v[_+2],L=m(v[_],T,g,S),z=m(v[_],D,g,S)),C){T=v[_],D=v[_+2],L=m(v[_+1],T,g,S),z=m(v[_+1],D,g,S),w.push(L),w.push(D.clone()),w.push(T.clone()),w.push(D.clone()),w.push(L.clone()),w.push(z);break}E&&(T=v[_],D=v[_+1],L=m(v[_+2],T,g,S),z=m(v[_+2],D,g,S)),w.push(T.clone()),w.push(D.clone()),w.push(L),w.push(z),w.push(L.clone()),w.push(D.clone());break}case 2:{A||(T=v[_].clone(),D=m(T,v[_+1],g,S),L=m(T,v[_+2],g,S),w.push(T),w.push(D),w.push(L)),C||(T=v[_+1].clone(),D=m(T,v[_+2],g,S),L=m(T,v[_],g,S),w.push(T),w.push(D),w.push(L)),E||(T=v[_+2].clone(),D=m(T,v[_],g,S),L=m(T,v[_+1],g,S),w.push(T),w.push(D),w.push(L));break}}}return w}function m(v,g,w,S){const _=v.position.dot(w)-S,A=g.position.dot(w)-S,C=_/(_-A);return new uU(new pe(v.position.x+C*(g.position.x-v.position.x),v.position.y+C*(g.position.y-v.position.y),v.position.z+C*(g.position.z-v.position.z)),new pe(v.normal.x+C*(g.normal.x-v.normal.x),v.normal.y+C*(g.normal.y-v.normal.y),v.normal.z+C*(g.normal.z-v.normal.z)))}}}class uU{constructor(t,i){this.position=t,this.normal=i}clone(){return new this.constructor(this.position.clone(),this.normal.clone())}}const cU=e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function";function Wz(e,t){const i=ll(n=>n.gl),r=B_(NC,cU(e)?Object.values(e):e);if(xe.useLayoutEffect(()=>{t?.(r)},[t]),xe.useEffect(()=>{(Array.isArray(r)?r:[r]).forEach(i.initTexture)},[i,r]),cU(e)){const n=Object.keys(e),s={};return n.forEach(a=>Object.assign(s,{[a]:r[n.indexOf(a)]})),s}else return r}Wz.preload=e=>B_.preload(NC,e);Wz.clear=e=>B_.clear(NC,e);function Gce(e){return Array.isArray(e)}function t3(e=[0,0,0]){return Gce(e)?e:e instanceof pe||e instanceof iv?[e.x,e.y,e.z]:[e,e,e]}function qce({debug:e,mesh:t,children:i,position:r,rotation:n,scale:s,...a}){const o=xe.useRef(null),l=xe.useRef(null);return xe.useLayoutEffect(()=>{const u=t?.current||o.current.parent,c=o.current;if(!(u instanceof js))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');const h={position:new pe,rotation:new iv,scale:new pe(1,1,1)};if(u){Rc(h,{position:r,scale:s});const d=u.matrixWorld.clone();if(u.matrixWorld.identity(),!n||typeof n=="number"){const p=new ur;p.position.copy(h.position),p.lookAt(u.position),typeof n=="number"&&p.rotateZ(n),Rc(h,{rotation:p.rotation})}else Rc(h,{rotation:n});return c.geometry=new Wce(u,h.position,h.rotation,h.scale),l.current&&Rc(l.current,h),u.matrixWorld=d,()=>{c.geometry.dispose()}}},[t,...t3(r),...t3(s),...t3(n)]),xe.createElement("mesh",{ref:o},i||xe.createElement("meshStandardMaterial",jg({transparent:!0,polygonOffset:!0,polygonOffsetFactor:-10},a)),e&&xe.createElement("mesh",{ref:l},xe.createElement("boxGeometry",null),xe.createElement("meshNormalMaterial",{wireframe:!0}),xe.createElement("axesHelper",null)))}const Xce=xe.forwardRef(({makeDefault:e,events:t,camera:i,regress:r,domElement:n,enableDamping:s=!0,onChange:a,onStart:o,onEnd:l,...u},c)=>{const h=ll(E=>E.invalidate),d=ll(E=>E.camera),p=ll(E=>E.gl),m=ll(E=>E.events),v=ll(E=>E.setEvents),g=ll(E=>E.set),w=ll(E=>E.get),S=ll(E=>E.performance),_=i||d,A=n||m.connected||p.domElement,C=xe.useMemo(()=>new Hce(_),[_]);return Vz(()=>{C.enabled&&C.update()},-1),xe.useEffect(()=>(C.connect(A),()=>void C.dispose()),[A,r,C,h]),xe.useEffect(()=>{t&&v({enabled:!0});const E=D=>{h(),r&&S.regress(),a&&a(D)},I=D=>{o&&o(D),t||v({enabled:!1})},T=D=>{l&&l(D),t||v({enabled:!0})};return C.addEventListener("change",E),C.addEventListener("start",I),C.addEventListener("end",T),()=>{C.removeEventListener("start",I),C.removeEventListener("end",T),C.removeEventListener("change",E)}},[a,o,l,C,h,t,v]),xe.useEffect(()=>{if(e){const E=w().controls;return g({controls:C}),()=>g({controls:E})}},[e,C]),xe.createElement("primitive",jg({ref:c,object:C,enableDamping:s},u))}),Yce=xe.forwardRef(({children:e,speed:t=1,rotationIntensity:i=1,floatIntensity:r=1,floatingRange:n=[-.1,.1],...s},a)=>{const o=xe.useRef(null),l=xe.useRef(Math.random()*1e4);return Vz(u=>{var c,h;const d=l.current+u.clock.getElapsedTime();o.current.rotation.x=Math.cos(d/4*t)/8*i,o.current.rotation.y=Math.sin(d/4*t)/8*i,o.current.rotation.z=Math.sin(d/4*t)/20*i;let p=Math.sin(d/4*t)/10;p=y9.mapLinear(p,-.1,.1,(c=n?.[0])!==null&&c!==void 0?c:-.1,(h=n?.[1])!==null&&h!==void 0?h:.1),o.current.position.y=p*r}),xe.createElement("group",s,xe.createElement("group",{ref:zce([o,a])},e))});var i3={exports:{}},r3,hU;function Qce(){if(hU)return r3;hU=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return r3=e,r3}var n3,dU;function Kce(){if(dU)return n3;dU=1;var e=Qce();function t(){}function i(){}return i.resetWarningCache=t,n3=function(){function r(a,o,l,u,c,h){if(h!==e){var d=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw d.name="Invariant Violation",d}}r.isRequired=r;function n(){return r}var s={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:n,element:r,elementType:r,instanceOf:n,node:r,objectOf:n,oneOf:n,oneOfType:n,shape:n,exact:n,checkPropTypes:i,resetWarningCache:t};return s.PropTypes=s,s},n3}var fU;function j7(){return fU||(fU=1,i3.exports=Kce()()),i3.exports}function Zce({all:e,scene:t,camera:i}){const r=ll(({gl:a})=>a),n=ll(({camera:a})=>a),s=ll(({scene:a})=>a);return xe.useLayoutEffect(()=>{const a=[];e&&(t||s).traverse(u=>{u.visible===!1&&(a.push(u),u.visible=!0)}),r.compile(t||s,i||n);const o=new pz(128);new fz(.01,1e5,o).update(r,t||s),o.dispose(),a.forEach(u=>u.visible=!1)},[]),null}const Jce=()=>{const{progress:e}=Oce();return at.jsxs(Lce,{as:"div",center:!0,style:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:[at.jsx("span",{className:"canvas-loader"}),at.jsxs("p",{style:{fontSize:14,color:"#F1F1F1",fontWeight:800,marginTop:40},children:[e.toFixed(2),"%"]})]})},$ce=e=>{const[t]=Wz([e.imgUrl]);return at.jsxs(Yce,{speed:1.75,rotationIntensity:1,floatIntensity:2,children:[at.jsx("ambientLight",{intensity:.25}),at.jsx("directionalLight",{position:[0,0,.05]}),at.jsxs("mesh",{castShadow:!0,receiveShadow:!0,scale:2.75,children:[at.jsx("icosahedronGeometry",{args:[1,1]}),at.jsx("meshStandardMaterial",{color:"#fff",polygonOffset:!0,polygonOffsetFactor:-5,flatShading:!0}),at.jsx(qce,{map:t,position:[0,0,1],rotation:[2*Math.PI,0,6.25],flatShading:!0})]})]})},ehe=({icon:e})=>at.jsxs(Sce,{frameloop:"demand",gl:{preserveDrawingBuffer:!0},children:[at.jsxs(xe.Suspense,{fallback:at.jsx(Jce,{}),children:[at.jsx(Xce,{enableZoom:!1}),at.jsx($ce,{imgUrl:e})]}),at.jsx(Zce,{all:!0})]}),the=()=>at.jsx("div",{}),ihe="modulepreload",rhe=function(e){return"/my-portofolio/"+e},pU={},Vd=function(t,i,r){let n=Promise.resolve();if(i&&i.length>0){let l=function(u){return Promise.all(u.map(c=>Promise.resolve(c).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=a?.nonce||a?.getAttribute("nonce");n=l(i.map(u=>{if(u=rhe(u),u in pU)return;pU[u]=!0;const c=u.endsWith(".css"),h=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${h}`))return;const d=document.createElement("link");if(d.rel=c?"stylesheet":ihe,c||(d.as="script"),d.crossOrigin="",d.href=u,o&&d.setAttribute("nonce",o),document.head.appendChild(d),c)return new Promise((p,m)=>{d.addEventListener("load",p),d.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${u}`)))})}))}function s(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return n.then(a=>{for(const o of a||[])o.status==="rejected"&&s(o.reason);return t().catch(s)})};var nhe=Object.create,VC=Object.defineProperty,she=Object.getOwnPropertyDescriptor,ahe=Object.getOwnPropertyNames,ohe=Object.getPrototypeOf,lhe=Object.prototype.hasOwnProperty,uhe=(e,t,i)=>t in e?VC(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,av=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),che=(e,t)=>{for(var i in t)VC(e,i,{get:t[i],enumerable:!0})},hhe=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of ahe(t))!lhe.call(e,n)&&n!==i&&VC(e,n,{get:()=>t[n],enumerable:!(r=she(t,n))||r.enumerable});return e},Hp=(e,t,i)=>(i=e!=null?nhe(ohe(e)):{},hhe(t||!e||!e.__esModule?VC(i,"default",{value:e,enumerable:!0}):i,e)),Fw=(e,t,i)=>(uhe(e,typeof t!="symbol"?t+"":t,i),i),dhe=av((e,t)=>{(function(i,r){typeof e=="object"?t.exports=r():typeof define=="function"&&define.amd?define(r):i.Alea=r()})(e,function(){return i.importState=function(n){var s=new i;return s.importState(n),s},i;function i(){return(function(n){var s=0,a=0,o=0,l=1;n.length==0&&(n=[+new Date]);var u=r();s=u(" "),a=u(" "),o=u(" ");for(var c=0;c<n.length;c++)s-=u(n[c]),s<0&&(s+=1),a-=u(n[c]),a<0&&(a+=1),o-=u(n[c]),o<0&&(o+=1);u=null;var h=function(){var d=2091639*s+l*23283064365386963e-26;return s=a,a=o,o=d-(l=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=n,h.exportState=function(){return[s,a,o,l]},h.importState=function(d){s=+d[0]||0,a=+d[1]||0,o=+d[2]||0,l=+d[3]||0},h})(Array.prototype.slice.call(arguments))}function r(){var n=4022871197,s=function(a){a=a.toString();for(var o=0;o<a.length;o++){n+=a.charCodeAt(o);var l=.02519603282416938*n;n=l>>>0,l-=n,l*=n,n=l>>>0,l-=n,n+=l*4294967296}return(n>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})}),H7=av((e,t)=>{(function(i,r){typeof e=="object"&&typeof t<"u"?r(e):typeof define=="function"&&define.amd?define(["exports"],r):r((i=typeof globalThis<"u"?globalThis:i||self).SVDJS={})})(e,function(i){i.SVD=function(r,n,s,a,o){if(n=n===void 0||n,s=s===void 0||s,o=1e-64/(a=a||Math.pow(2,-52)),!r)throw new TypeError("Matrix a is not defined");var l,u,c,h,d,p,m,v,g,w,S,_,A=r[0].length,C=r.length;if(C<A)throw new TypeError("Invalid matrix: m < n");for(var E=[],I=[],T=[],D=n==="f"?C:A,L=w=m=0;L<C;L++)I[L]=new Array(D).fill(0);for(L=0;L<A;L++)T[L]=new Array(A).fill(0);var z,G=new Array(A).fill(0);for(L=0;L<C;L++)for(l=0;l<A;l++)I[L][l]=r[L][l];for(L=0;L<A;L++){for(E[L]=m,g=0,c=L+1,l=L;l<C;l++)g+=Math.pow(I[l][L],2);if(g<o)m=0;else for(v=(p=I[L][L])*(m=p<0?Math.sqrt(g):-Math.sqrt(g))-g,I[L][L]=p-m,l=c;l<A;l++){for(g=0,u=L;u<C;u++)g+=I[u][L]*I[u][l];for(p=g/v,u=L;u<C;u++)I[u][l]=I[u][l]+p*I[u][L]}for(G[L]=m,g=0,l=c;l<A;l++)g+=Math.pow(I[L][l],2);if(g<o)m=0;else{for(v=(p=I[L][L+1])*(m=p<0?Math.sqrt(g):-Math.sqrt(g))-g,I[L][L+1]=p-m,l=c;l<A;l++)E[l]=I[L][l]/v;for(l=c;l<C;l++){for(g=0,u=c;u<A;u++)g+=I[l][u]*I[L][u];for(u=c;u<A;u++)I[l][u]=I[l][u]+g*E[u]}}w<(S=Math.abs(G[L])+Math.abs(E[L]))&&(w=S)}if(s)for(L=A-1;0<=L;L--){if(m!==0){for(v=I[L][L+1]*m,l=c;l<A;l++)T[l][L]=I[L][l]/v;for(l=c;l<A;l++){for(g=0,u=c;u<A;u++)g+=I[L][u]*T[u][l];for(u=c;u<A;u++)T[u][l]=T[u][l]+g*T[u][L]}}for(l=c;l<A;l++)T[L][l]=0,T[l][L]=0;T[L][L]=1,m=E[L],c=L}if(n){if(n==="f")for(L=A;L<C;L++){for(l=A;l<C;l++)I[L][l]=0;I[L][L]=1}for(L=A-1;0<=L;L--){for(c=L+1,m=G[L],l=c;l<D;l++)I[L][l]=0;if(m!==0){for(v=I[L][L]*m,l=c;l<D;l++){for(g=0,u=c;u<C;u++)g+=I[u][L]*I[u][l];for(p=g/v,u=L;u<C;u++)I[u][l]=I[u][l]+p*I[u][L]}for(l=L;l<C;l++)I[l][L]=I[l][L]/m}else for(l=L;l<C;l++)I[l][L]=0;I[L][L]=I[L][L]+1}}for(a*=w,u=A-1;0<=u;u--)for(var V=0;V<50;V++){for(z=!1,c=u;0<=c;c--){if(Math.abs(E[c])<=a){z=!0;break}if(Math.abs(G[c-1])<=a)break}if(!z){for(d=0,h=c-(g=1),L=c;L<u+1&&(p=g*E[L],E[L]=d*E[L],!(Math.abs(p)<=a));L++)if(m=G[L],G[L]=Math.sqrt(p*p+m*m),d=m/(v=G[L]),g=-p/v,n)for(l=0;l<C;l++)S=I[l][h],_=I[l][L],I[l][h]=S*d+_*g,I[l][L]=-S*g+_*d}if(_=G[u],c===u){if(_<0&&(G[u]=-_,s))for(l=0;l<A;l++)T[l][u]=-T[l][u];break}for(w=G[c],p=(((S=G[u-1])-_)*(S+_)+((m=E[u-1])-(v=E[u]))*(m+v))/(2*v*S),m=Math.sqrt(p*p+1),p=((w-_)*(w+_)+v*(S/(p<0?p-m:p+m)-v))/w,L=c+(g=d=1);L<u+1;L++){if(m=E[L],S=G[L],v=g*m,m*=d,_=Math.sqrt(p*p+v*v),p=w*(d=p/(E[L-1]=_))+m*(g=v/_),m=-w*g+m*d,v=S*g,S*=d,s)for(l=0;l<A;l++)w=T[l][L-1],_=T[l][L],T[l][L-1]=w*d+_*g,T[l][L]=-w*g+_*d;if(_=Math.sqrt(p*p+v*v),p=(d=p/(G[L-1]=_))*m+(g=v/_)*S,w=-g*m+d*S,n)for(l=0;l<C;l++)S=I[l][L-1],_=I[l][L],I[l][L-1]=S*d+_*g,I[l][L]=-S*g+_*d}E[c]=0,E[u]=p,G[u]=w}for(L=0;L<A;L++)G[L]<a&&(G[L]=0);return{u:I,q:G,v:T}},i.VERSION="1.1.1",Object.defineProperty(i,"__esModule",{value:!0})})}),fhe=av((e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;function i(r){if(r===null||r===!0||r===!1)return NaN;var n=Number(r);return isNaN(n)?n:n<0?Math.ceil(n):Math.floor(n)}t.exports=e.default}),phe=av((e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;function i(r){var n=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return n.setUTCFullYear(r.getFullYear()),r.getTime()-n.getTime()}t.exports=e.default}),mhe=av((e,t)=>{function i(s,a){function o(){this.constructor=s}o.prototype=a.prototype,s.prototype=new o}function r(s,a,o,l){this.message=s,this.expected=a,this.found=o,this.location=l,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,r)}i(r,Error),r.buildMessage=function(s,a){var o={literal:function(m){return'"'+u(m.text)+'"'},class:function(m){var v="",g;for(g=0;g<m.parts.length;g++)v+=m.parts[g]instanceof Array?c(m.parts[g][0])+"-"+c(m.parts[g][1]):c(m.parts[g]);return"["+(m.inverted?"^":"")+v+"]"},any:function(m){return"any character"},end:function(m){return"end of input"},other:function(m){return m.description}};function l(m){return m.charCodeAt(0).toString(16).toUpperCase()}function u(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(v){return"\\x0"+l(v)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(v){return"\\x"+l(v)})}function c(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(v){return"\\x0"+l(v)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(v){return"\\x"+l(v)})}function h(m){return o[m.type](m)}function d(m){var v=new Array(m.length),g,w;for(g=0;g<m.length;g++)v[g]=h(m[g]);if(v.sort(),v.length>0){for(g=1,w=1;g<v.length;g++)v[g-1]!==v[g]&&(v[w]=v[g],w++);v.length=w}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}function p(m){return m?'"'+u(m)+'"':"end of input"}return"Expected "+d(s)+" but "+p(a)+" found."};function n(s,a){a=a!==void 0?a:{};var o={},l={svg_path:At},u=At,c=function(ee){if(!ee)return[];for(var ae=[],Se=0;Se<ee.length;Se++)ae=ae.concat.apply(ae,ee[Se]);var ce=ae[0];return ce&&ce.code=="m"&&(delete ce.relative,ce.code="M"),ae},h=function(ee,ae){return ls(ee,ae)},d=/^[Mm]/,p=et(["M","m"],!1,!1),m=function(ee,ae,Se){var ce=Ui(ee,[ae]);return Se&&(ce=ce.concat(Ui(ee=="M"?"L":"l",Se[1]))),ce},v=/^[Zz]/,g=et(["Z","z"],!1,!1),w=function(){return Ui("Z")},S=/^[Ll]/,_=et(["L","l"],!1,!1),A=function(ee,ae){return Ui(ee,ae)},C=/^[Hh]/,E=et(["H","h"],!1,!1),I=function(ee,ae){return Ui(ee,ae.map(function(Se){return{x:Se}}))},T=/^[Vv]/,D=et(["V","v"],!1,!1),L=function(ee,ae){return Ui(ee,ae.map(function(Se){return{y:Se}}))},z=/^[Cc]/,G=et(["C","c"],!1,!1),V=function(ee,ae,Se){return{x1:ee.x,y1:ee.y,x2:ae.x,y2:ae.y,x:Se.x,y:Se.y}},j=/^[Ss]/,J=et(["S","s"],!1,!1),ne=function(ee,ae){return{x2:ee.x,y2:ee.y,x:ae.x,y:ae.y}},K=/^[Qq]/,B=et(["Q","q"],!1,!1),Z=function(ee,ae){return{x1:ee.x,y1:ee.y,x:ae.x,y:ae.y}},F=/^[Tt]/,X=et(["T","t"],!1,!1),Y=/^[Aa]/,le=et(["A","a"],!1,!1),oe=function(ee,ae,Se,ce,Oe,vt){return{rx:ee,ry:ae,xAxisRotation:Se,largeArc:ce,sweep:Oe,x:vt.x,y:vt.y}},re=function(ee,ae){return{x:ee,y:ae}},ue=function(ee){return ee*1},me=function(ee){return ee.join("")*1},he=/^[01]/,Ce=et(["0","1"],!1,!1),Ae=function(ee){return ee=="1"},Ie=function(){return""},Me=",",De=lt(",",!1),Ve=function(ee){return ee.join("")},Ge=".",Qe=lt(".",!1),ot=/^[eE]/,$e=et(["e","E"],!1,!1),Ke=/^[+\-]/,bt=et(["+","-"],!1,!1),xt=/^[0-9]/,q=et([["0","9"]],!1,!1),N=function(ee){return ee.join("")},de=/^[ \t\n\r]/,ze=et([" ","	",`
`,"\r"],!1,!1),$=0,Ue=[{line:1,column:1}],rt=0,Ye=[],Ee;if("startRule"in a){if(!(a.startRule in l))throw new Error(`Can't start parsing from rule "`+a.startRule+'".');u=l[a.startRule]}function lt(ee,ae){return{type:"literal",text:ee,ignoreCase:ae}}function et(ee,ae,Se){return{type:"class",parts:ee,inverted:ae,ignoreCase:Se}}function pt(){return{type:"end"}}function mt(ee){var ae=Ue[ee],Se;if(ae)return ae;for(Se=ee-1;!Ue[Se];)Se--;for(ae=Ue[Se],ae={line:ae.line,column:ae.column};Se<ee;)s.charCodeAt(Se)===10?(ae.line++,ae.column=1):ae.column++,Se++;return Ue[ee]=ae,ae}function dt(ee,ae){var Se=mt(ee),ce=mt(ae);return{start:{offset:ee,line:Se.line,column:Se.column},end:{offset:ae,line:ce.line,column:ce.column}}}function _e(ee){$<rt||($>rt&&(rt=$,Ye=[]),Ye.push(ee))}function it(ee,ae,Se){return new r(r.buildMessage(ee,ae),ee,ae,Se)}function At(){var ee,ae,Se,ce,Oe;for(ee=$,ae=[],Se=ui();Se!==o;)ae.push(Se),Se=ui();if(ae!==o)if(Se=ie(),Se===o&&(Se=null),Se!==o){for(ce=[],Oe=ui();Oe!==o;)ce.push(Oe),Oe=ui();ce!==o?(ae=c(Se),ee=ae):($=ee,ee=o)}else $=ee,ee=o;else $=ee,ee=o;return ee}function ie(){var ee,ae,Se,ce,Oe,vt;if(ee=$,ae=we(),ae!==o){for(Se=[],ce=$,Oe=[],vt=ui();vt!==o;)Oe.push(vt),vt=ui();for(Oe!==o?(vt=we(),vt!==o?(Oe=[Oe,vt],ce=Oe):($=ce,ce=o)):($=ce,ce=o);ce!==o;){for(Se.push(ce),ce=$,Oe=[],vt=ui();vt!==o;)Oe.push(vt),vt=ui();Oe!==o?(vt=we(),vt!==o?(Oe=[Oe,vt],ce=Oe):($=ce,ce=o)):($=ce,ce=o)}Se!==o?(ae=h(ae,Se),ee=ae):($=ee,ee=o)}else $=ee,ee=o;return ee}function we(){var ee,ae,Se,ce,Oe,vt;if(ee=$,ae=We(),ae!==o){for(Se=[],ce=$,Oe=[],vt=ui();vt!==o;)Oe.push(vt),vt=ui();for(Oe!==o?(vt=Re(),vt!==o?(Oe=[Oe,vt],ce=Oe):($=ce,ce=o)):($=ce,ce=o);ce!==o;){for(Se.push(ce),ce=$,Oe=[],vt=ui();vt!==o;)Oe.push(vt),vt=ui();Oe!==o?(vt=Re(),vt!==o?(Oe=[Oe,vt],ce=Oe):($=ce,ce=o)):($=ce,ce=o)}Se!==o?(ae=h(ae,Se),ee=ae):($=ee,ee=o)}else $=ee,ee=o;return ee}function Re(){var ee;return ee=ct(),ee===o&&(ee=Ut(),ee===o&&(ee=Si(),ee===o&&(ee=ri(),ee===o&&(ee=Yi(),ee===o&&(ee=Xo(),ee===o&&(ee=te(),ee===o&&(ee=ye(),ee===o&&(ee=gt())))))))),ee}function We(){var ee,ae,Se,ce,Oe,vt,Mn;if(ee=$,d.test(s.charAt($))?(ae=s.charAt($),$++):(ae=o,_e(p)),ae!==o){for(Se=[],ce=ui();ce!==o;)Se.push(ce),ce=ui();Se!==o?(ce=Et(),ce!==o?(Oe=$,vt=$t(),vt===o&&(vt=null),vt!==o?(Mn=si(),Mn!==o?(vt=[vt,Mn],Oe=vt):($=Oe,Oe=o)):($=Oe,Oe=o),Oe===o&&(Oe=null),Oe!==o?(ae=m(ae,ce,Oe),ee=ae):($=ee,ee=o)):($=ee,ee=o)):($=ee,ee=o)}else $=ee,ee=o;return ee}function ct(){var ee,ae;return ee=$,v.test(s.charAt($))?(ae=s.charAt($),$++):(ae=o,_e(g)),ae!==o&&(ae=w()),ee=ae,ee}function Ut(){var ee,ae,Se,ce;if(ee=$,S.test(s.charAt($))?(ae=s.charAt($),$++):(ae=o,_e(_)),ae!==o){for(Se=[],ce=ui();ce!==o;)Se.push(ce),ce=ui();Se!==o?(ce=si(),ce!==o?(ae=A(ae,ce),ee=ae):($=ee,ee=o)):($=ee,ee=o)}else $=ee,ee=o;return ee}function si(){var ee,ae,Se,ce,Oe,vt;if(ee=$,ae=Et(),ae!==o){for(Se=[],ce=$,Oe=$t(),Oe===o&&(Oe=null),Oe!==o?(vt=Et(),vt!==o?(Oe=[Oe,vt],ce=Oe):($=ce,ce=o)):($=ce,ce=o);ce!==o;)Se.push(ce),ce=$,Oe=$t(),Oe===o&&(Oe=null),Oe!==o?(vt=Et(),vt!==o?(Oe=[Oe,vt],ce=Oe):($=ce,ce=o)):($=ce,ce=o);Se!==o?(ae=h(ae,Se),ee=ae):($=ee,ee=o)}else $=ee,ee=o;return ee}function Si(){var ee,ae,Se,ce;if(ee=$,C.test(s.charAt($))?(ae=s.charAt($),$++):(ae=o,_e(E)),ae!==o){for(Se=[],ce=ui();ce!==o;)Se.push(ce),ce=ui();Se!==o?(ce=ar(),ce!==o?(ae=I(ae,ce),ee=ae):($=ee,ee=o)):($=ee,ee=o)}else $=ee,ee=o;return ee}function ar(){var ee,ae,Se,ce,Oe,vt;if(ee=$,ae=zt(),ae!==o){for(Se=[],ce=$,Oe=$t(),Oe===o&&(Oe=null),Oe!==o?(vt=zt(),vt!==o?(Oe=[Oe,vt],ce=Oe):($=ce,ce=o)):($=ce,ce=o);ce!==o;)Se.push(ce),ce=$,Oe=$t(),Oe===o&&(Oe=null),Oe!==o?(vt=zt(),vt!==o?(Oe=[Oe,vt],ce=Oe):($=ce,ce=o)):($=ce,ce=o);Se!==o?(ae=h(ae,Se),ee=ae):($=ee,ee=o)}else $=ee,ee=o;return ee}function ri(){var ee,ae,Se,ce;if(ee=$,T.test(s.charAt($))?(ae=s.charAt($),$++):(ae=o,_e(D)),ae!==o){for(Se=[],ce=ui();ce!==o;)Se.push(ce),ce=ui();Se!==o?(ce=ar(),ce!==o?(ae=L(ae,ce),ee=ae):($=ee,ee=o)):($=ee,ee=o)}else $=ee,ee=o;return ee}function Yi(){var ee,ae,Se,ce;if(ee=$,z.test(s.charAt($))?(ae=s.charAt($),$++):(ae=o,_e(G)),ae!==o){for(Se=[],ce=ui();ce!==o;)Se.push(ce),ce=ui();Se!==o?(ce=ji(),ce!==o?(ae=A(ae,ce),ee=ae):($=ee,ee=o)):($=ee,ee=o)}else $=ee,ee=o;return ee}function ji(){var ee,ae,Se,ce,Oe,vt;if(ee=$,ae=po(),ae!==o){for(Se=[],ce=$,Oe=$t(),Oe===o&&(Oe=null),Oe!==o?(vt=po(),vt!==o?(Oe=[Oe,vt],ce=Oe):($=ce,ce=o)):($=ce,ce=o);ce!==o;)Se.push(ce),ce=$,Oe=$t(),Oe===o&&(Oe=null),Oe!==o?(vt=po(),vt!==o?(Oe=[Oe,vt],ce=Oe):($=ce,ce=o)):($=ce,ce=o);Se!==o?(ae=h(ae,Se),ee=ae):($=ee,ee=o)}else $=ee,ee=o;return ee}function po(){var ee,ae,Se,ce,Oe,vt;return ee=$,ae=Et(),ae!==o?(Se=$t(),Se===o&&(Se=null),Se!==o?(ce=Et(),ce!==o?(Oe=$t(),Oe===o&&(Oe=null),Oe!==o?(vt=Et(),vt!==o?(ae=V(ae,ce,vt),ee=ae):($=ee,ee=o)):($=ee,ee=o)):($=ee,ee=o)):($=ee,ee=o)):($=ee,ee=o),ee}function Xo(){var ee,ae,Se,ce;if(ee=$,j.test(s.charAt($))?(ae=s.charAt($),$++):(ae=o,_e(J)),ae!==o){for(Se=[],ce=ui();ce!==o;)Se.push(ce),ce=ui();Se!==o?(ce=Qu(),ce!==o?(ae=A(ae,ce),ee=ae):($=ee,ee=o)):($=ee,ee=o)}else $=ee,ee=o;return ee}function Qu(){var ee,ae,Se,ce,Oe,vt;if(ee=$,ae=ge(),ae!==o){for(Se=[],ce=$,Oe=$t(),Oe===o&&(Oe=null),Oe!==o?(vt=ge(),vt!==o?(Oe=[Oe,vt],ce=Oe):($=ce,ce=o)):($=ce,ce=o);ce!==o;)Se.push(ce),ce=$,Oe=$t(),Oe===o&&(Oe=null),Oe!==o?(vt=ge(),vt!==o?(Oe=[Oe,vt],ce=Oe):($=ce,ce=o)):($=ce,ce=o);Se!==o?(ae=h(ae,Se),ee=ae):($=ee,ee=o)}else $=ee,ee=o;return ee}function ge(){var ee,ae,Se,ce;return ee=$,ae=Et(),ae!==o?(Se=$t(),Se===o&&(Se=null),Se!==o?(ce=Et(),ce!==o?(ae=ne(ae,ce),ee=ae):($=ee,ee=o)):($=ee,ee=o)):($=ee,ee=o),ee}function te(){var ee,ae,Se,ce;if(ee=$,K.test(s.charAt($))?(ae=s.charAt($),$++):(ae=o,_e(B)),ae!==o){for(Se=[],ce=ui();ce!==o;)Se.push(ce),ce=ui();Se!==o?(ce=ve(),ce!==o?(ae=A(ae,ce),ee=ae):($=ee,ee=o)):($=ee,ee=o)}else $=ee,ee=o;return ee}function ve(){var ee,ae,Se,ce,Oe,vt;if(ee=$,ae=fe(),ae!==o){for(Se=[],ce=$,Oe=$t(),Oe===o&&(Oe=null),Oe!==o?(vt=fe(),vt!==o?(Oe=[Oe,vt],ce=Oe):($=ce,ce=o)):($=ce,ce=o);ce!==o;)Se.push(ce),ce=$,Oe=$t(),Oe===o&&(Oe=null),Oe!==o?(vt=fe(),vt!==o?(Oe=[Oe,vt],ce=Oe):($=ce,ce=o)):($=ce,ce=o);Se!==o?(ae=h(ae,Se),ee=ae):($=ee,ee=o)}else $=ee,ee=o;return ee}function fe(){var ee,ae,Se,ce;return ee=$,ae=Et(),ae!==o?(Se=$t(),Se===o&&(Se=null),Se!==o?(ce=Et(),ce!==o?(ae=Z(ae,ce),ee=ae):($=ee,ee=o)):($=ee,ee=o)):($=ee,ee=o),ee}function ye(){var ee,ae,Se,ce;if(ee=$,F.test(s.charAt($))?(ae=s.charAt($),$++):(ae=o,_e(X)),ae!==o){for(Se=[],ce=ui();ce!==o;)Se.push(ce),ce=ui();Se!==o?(ce=Ne(),ce!==o?(ae=A(ae,ce),ee=ae):($=ee,ee=o)):($=ee,ee=o)}else $=ee,ee=o;return ee}function Ne(){var ee,ae,Se,ce,Oe,vt;if(ee=$,ae=Et(),ae!==o){for(Se=[],ce=$,Oe=$t(),Oe===o&&(Oe=null),Oe!==o?(vt=Et(),vt!==o?(Oe=[Oe,vt],ce=Oe):($=ce,ce=o)):($=ce,ce=o);ce!==o;)Se.push(ce),ce=$,Oe=$t(),Oe===o&&(Oe=null),Oe!==o?(vt=Et(),vt!==o?(Oe=[Oe,vt],ce=Oe):($=ce,ce=o)):($=ce,ce=o);Se!==o?(ae=h(ae,Se),ee=ae):($=ee,ee=o)}else $=ee,ee=o;return ee}function gt(){var ee,ae,Se,ce;if(ee=$,Y.test(s.charAt($))?(ae=s.charAt($),$++):(ae=o,_e(le)),ae!==o){for(Se=[],ce=ui();ce!==o;)Se.push(ce),ce=ui();Se!==o?(ce=St(),ce!==o?(ae=A(ae,ce),ee=ae):($=ee,ee=o)):($=ee,ee=o)}else $=ee,ee=o;return ee}function St(){var ee,ae,Se,ce,Oe,vt;if(ee=$,ae=Tt(),ae!==o){for(Se=[],ce=$,Oe=$t(),Oe===o&&(Oe=null),Oe!==o?(vt=Tt(),vt!==o?(Oe=[Oe,vt],ce=Oe):($=ce,ce=o)):($=ce,ce=o);ce!==o;)Se.push(ce),ce=$,Oe=$t(),Oe===o&&(Oe=null),Oe!==o?(vt=Tt(),vt!==o?(Oe=[Oe,vt],ce=Oe):($=ce,ce=o)):($=ce,ce=o);Se!==o?(ae=h(ae,Se),ee=ae):($=ee,ee=o)}else $=ee,ee=o;return ee}function Tt(){var ee,ae,Se,ce,Oe,vt,Mn,rn,ja,Ql,ah,Ku;return ee=$,ae=Vt(),ae!==o?(Se=$t(),Se===o&&(Se=null),Se!==o?(ce=Vt(),ce!==o?(Oe=$t(),Oe===o&&(Oe=null),Oe!==o?(vt=zt(),vt!==o?(Mn=$t(),Mn!==o?(rn=Yt(),rn!==o?(ja=$t(),ja===o&&(ja=null),ja!==o?(Ql=Yt(),Ql!==o?(ah=$t(),ah===o&&(ah=null),ah!==o?(Ku=Et(),Ku!==o?(ae=oe(ae,ce,vt,rn,Ql,Ku),ee=ae):($=ee,ee=o)):($=ee,ee=o)):($=ee,ee=o)):($=ee,ee=o)):($=ee,ee=o)):($=ee,ee=o)):($=ee,ee=o)):($=ee,ee=o)):($=ee,ee=o)):($=ee,ee=o)):($=ee,ee=o),ee}function Et(){var ee,ae,Se,ce;return ee=$,ae=zt(),ae!==o?(Se=$t(),Se===o&&(Se=null),Se!==o?(ce=zt(),ce!==o?(ae=re(ae,ce),ee=ae):($=ee,ee=o)):($=ee,ee=o)):($=ee,ee=o),ee}function Vt(){var ee,ae;return ee=$,ae=Qr(),ae===o&&(ae=Hi()),ae!==o&&(ae=ue(ae)),ee=ae,ee}function zt(){var ee,ae,Se,ce;return ee=$,ae=$,Se=_i(),Se===o&&(Se=null),Se!==o?(ce=Qr(),ce!==o?(Se=[Se,ce],ae=Se):($=ae,ae=o)):($=ae,ae=o),ae===o&&(ae=$,Se=_i(),Se===o&&(Se=null),Se!==o?(ce=Hi(),ce!==o?(Se=[Se,ce],ae=Se):($=ae,ae=o)):($=ae,ae=o)),ae!==o&&(ae=me(ae)),ee=ae,ee}function Yt(){var ee,ae;return ee=$,he.test(s.charAt($))?(ae=s.charAt($),$++):(ae=o,_e(Ce)),ae!==o&&(ae=Ae(ae)),ee=ae,ee}function $t(){var ee,ae,Se,ce,Oe;if(ee=$,ae=[],Se=ui(),Se!==o)for(;Se!==o;)ae.push(Se),Se=ui();else ae=o;if(ae!==o)if(Se=tr(),Se===o&&(Se=null),Se!==o){for(ce=[],Oe=ui();Oe!==o;)ce.push(Oe),Oe=ui();ce!==o?(ae=[ae,Se,ce],ee=ae):($=ee,ee=o)}else $=ee,ee=o;else $=ee,ee=o;if(ee===o){if(ee=$,ae=$,Se=tr(),Se!==o){for(ce=[],Oe=ui();Oe!==o;)ce.push(Oe),Oe=ui();ce!==o?(Se=[Se,ce],ae=Se):($=ae,ae=o)}else $=ae,ae=o;ae!==o&&(ae=Ie()),ee=ae}return ee}function tr(){var ee;return s.charCodeAt($)===44?(ee=Me,$++):(ee=o,_e(De)),ee}function Qr(){var ee,ae,Se,ce;return ee=$,ae=$,Se=ir(),Se!==o?(ce=Rt(),ce===o&&(ce=null),ce!==o?(Se=[Se,ce],ae=Se):($=ae,ae=o)):($=ae,ae=o),ae===o&&(ae=$,Se=Hi(),Se!==o?(ce=Rt(),ce!==o?(Se=[Se,ce],ae=Se):($=ae,ae=o)):($=ae,ae=o)),ae!==o&&(ae=Ve(ae)),ee=ae,ee}function ir(){var ee,ae,Se,ce,Oe;return ee=$,ae=$,Se=Hi(),Se===o&&(Se=null),Se!==o?(s.charCodeAt($)===46?(ce=Ge,$++):(ce=o,_e(Qe)),ce!==o?(Oe=Hi(),Oe!==o?(Se=[Se,ce,Oe],ae=Se):($=ae,ae=o)):($=ae,ae=o)):($=ae,ae=o),ae===o&&(ae=$,Se=Hi(),Se!==o?(s.charCodeAt($)===46?(ce=Ge,$++):(ce=o,_e(Qe)),ce!==o?(Se=[Se,ce],ae=Se):($=ae,ae=o)):($=ae,ae=o)),ae!==o&&(ae=Ve(ae)),ee=ae,ee}function Rt(){var ee,ae,Se,ce,Oe;return ee=$,ae=$,ot.test(s.charAt($))?(Se=s.charAt($),$++):(Se=o,_e($e)),Se!==o?(ce=_i(),ce===o&&(ce=null),ce!==o?(Oe=Hi(),Oe!==o?(Se=[Se,ce,Oe],ae=Se):($=ae,ae=o)):($=ae,ae=o)):($=ae,ae=o),ae!==o&&(ae=Ve(ae)),ee=ae,ee}function _i(){var ee;return Ke.test(s.charAt($))?(ee=s.charAt($),$++):(ee=o,_e(bt)),ee}function Hi(){var ee,ae,Se;if(ee=$,ae=[],xt.test(s.charAt($))?(Se=s.charAt($),$++):(Se=o,_e(q)),Se!==o)for(;Se!==o;)ae.push(Se),xt.test(s.charAt($))?(Se=s.charAt($),$++):(Se=o,_e(q));else ae=o;return ae!==o&&(ae=N(ae)),ee=ae,ee}function ui(){var ee,ae;return ee=$,de.test(s.charAt($))?(ae=s.charAt($),$++):(ae=o,_e(ze)),ae!==o&&(ae=Ie()),ee=ae,ee}function ls(ee,ae){if(!ae)return[ee];for(var Se=[ee],ce=0,Oe=ae.length;ce<Oe;ce++)Se[ce+1]=ae[ce][1];return Se}var us={m:"moveto",l:"lineto",h:"horizontal lineto",v:"vertical lineto",c:"curveto",s:"smooth curveto",q:"quadratic curveto",t:"smooth quadratic curveto",a:"elliptical arc",z:"closepath"};for(var hn in us)us[hn.toUpperCase()]=us[hn];function Ui(ee,ae){ae||(ae=[{}]);for(var Se=ae.length;Se--;){var ce={code:ee,command:us[ee]};ee==ee.toLowerCase()&&(ce.relative=!0);for(var Oe in ae[Se])ce[Oe]=ae[Se][Oe];ae[Se]=ce}return ae}if(Ee=u(),Ee!==o&&$===s.length)return Ee;throw Ee!==o&&$<s.length&&_e(pt()),it(Ye,rt<s.length?s.charAt(rt):null,rt<s.length?dt(rt,rt+1):dt(rt,rt))}t.exports={SyntaxError:r,parse:n}}),W7=av((e,t)=>{var i=mhe().parse;i.parseSVG=i,i.makeAbsolute=r,t.exports=i;function r(n){var s,a={x:0,y:0},o={x:"x0",y:"y0",x1:"x0",y1:"y0",x2:"x0",y2:"y0"};return n.forEach(function(l){l.command==="moveto"&&(s=l),l.x0=a.x,l.y0=a.y;for(var u in o)u in l&&(l[u]+=l.relative?l[o[u]]:0);"x"in l||(l.x=a.x),"y"in l||(l.y=a.y),l.relative=!1,l.code=l.code.toUpperCase(),l.command=="closepath"&&(l.x=s.x,l.y=s.y),a=l}),n}}),ghe=av((e,t)=>{t.exports=function(i,r){for(var n=i.split("."),s=r.split("."),a=0;a<3;a++){var o=Number(n[a]),l=Number(s[a]);if(o>l)return 1;if(l>o)return-1;if(!isNaN(o)&&isNaN(l))return 1;if(isNaN(o)&&!isNaN(l))return-1}return 0}}),Ox="149",Cl={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},vhe=0,mU=1,yhe=2,Gz=1,xhe=2,Uw=3,ju=0,Hs=1,Ba=2,ns=0,Pg=1,gU=2,vU=3,yU=4,whe=5,fy=100,bhe=101,_he=102,xU=103,wU=104,She=200,Mhe=201,Ahe=202,Ehe=203,G7=204,q7=205,Che=206,The=207,Phe=208,Dhe=209,Rhe=210,Ihe=0,Lhe=1,Ohe=2,bI=3,zhe=4,khe=5,Bhe=6,Nhe=7,X7=0,Fhe=1,Uhe=2,Wc=0,Vhe=1,jhe=2,Hhe=3,Whe=4,Ghe=5,Y7=300,Hg=301,Wg=302,_I=303,SI=304,F_=306,md=1e3,Yr=1001,MI=1002,Ni=1003,bU=1004,s3=1005,Li=1006,qhe=1007,sx=1008,Ua=1009,Xhe=1010,Yhe=1011,Q7=1012,Qhe=1013,gd=1014,br=1015,Pd=1016,Khe=1017,Zhe=1018,Dg=1020,Jhe=1021,$r=1023,$he=1024,ede=1025,Rg=1026,Gg=1027,RE=1028,tde=1029,n2=1030,ide=1031,K7=1033,a3=33776,o3=33777,l3=33778,u3=33779,_U=35840,SU=35841,MU=35842,AU=35843,rde=36196,EU=37492,CU=37496,TU=37808,PU=37809,DU=37810,RU=37811,IU=37812,LU=37813,OU=37814,zU=37815,kU=37816,BU=37817,NU=37818,FU=37819,UU=37820,VU=37821,c3=36492,nde=36283,jU=36284,HU=36285,WU=36286,Z7=2200,J7=2201,qz=2202,s2=2300,a2=2301,h3=2302,Cy=2400,Ty=2401,o2=2402,Xz=2500,sde=2501,Hu=3e3,Ri=3001,jd=3200,$7=3201,ade=0,ode=1,Pc="srgb",l2="srgb-linear",d3=7680,lde=519,AI=35044,ude=35048,EI="300 es",CI=1035,Ys=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});let i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;let i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;let i=this._listeners[e];if(i!==void 0){let r=i.indexOf(t);r!==-1&&i.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;let t=this._listeners[e.type];if(t!==void 0){e.target=this;let i=t.slice(0);for(let r=0,n=i.length;r<n;r++)i[r].call(this,e);e.target=null}}},Ra=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],GU=1234567,ib=Math.PI/180,jb=180/Math.PI;function Wl(){let e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Ra[e&255]+Ra[e>>8&255]+Ra[e>>16&255]+Ra[e>>24&255]+"-"+Ra[t&255]+Ra[t>>8&255]+"-"+Ra[t>>16&15|64]+Ra[t>>24&255]+"-"+Ra[i&63|128]+Ra[i>>8&255]+"-"+Ra[i>>16&255]+Ra[i>>24&255]+Ra[r&255]+Ra[r>>8&255]+Ra[r>>16&255]+Ra[r>>24&255]).toLowerCase()}function ts(e,t,i){return Math.max(t,Math.min(i,e))}function Yz(e,t){return(e%t+t)%t}function cde(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)}function hde(e,t,i){return e!==t?(i-e)/(t-e):0}function rb(e,t,i){return(1-i)*e+i*t}function dde(e,t,i,r){return rb(e,t,1-Math.exp(-i*r))}function fde(e,t=1){return t-Math.abs(Yz(e,t*2)-t)}function pde(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*(3-2*e))}function mde(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*e*(e*(e*6-15)+10))}function gde(e,t){return e+Math.floor(Math.random()*(t-e+1))}function vde(e,t){return e+Math.random()*(t-e)}function yde(e){return e*(.5-Math.random())}function xde(e){e!==void 0&&(GU=e);let t=GU+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function wde(e){return e*ib}function bde(e){return e*jb}function TI(e){return(e&e-1)===0&&e!==0}function eq(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function u2(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function _de(e,t,i,r,n){let s=Math.cos,a=Math.sin,o=s(i/2),l=a(i/2),u=s((t+r)/2),c=a((t+r)/2),h=s((t-r)/2),d=a((t-r)/2),p=s((r-t)/2),m=a((r-t)/2);switch(n){case"XYX":e.set(o*c,l*h,l*d,o*u);break;case"YZY":e.set(l*d,o*c,l*h,o*u);break;case"ZXZ":e.set(l*h,l*d,o*c,o*u);break;case"XZX":e.set(o*c,l*m,l*p,o*u);break;case"YXY":e.set(l*p,o*c,l*m,o*u);break;case"ZYZ":e.set(l*m,l*p,o*c,o*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function vd(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Or(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(e*65535);case Uint8Array:return Math.round(e*255);case Int16Array:return Math.round(e*32767);case Int8Array:return Math.round(e*127);default:throw new Error("Invalid component type.")}}var Ot=Object.freeze({__proto__:null,DEG2RAD:ib,RAD2DEG:jb,ceilPowerOfTwo:eq,clamp:ts,damp:dde,degToRad:wde,denormalize:vd,euclideanModulo:Yz,floorPowerOfTwo:u2,generateUUID:Wl,inverseLerp:hde,isPowerOfTwo:TI,lerp:rb,mapLinear:cde,normalize:Or,pingpong:fde,radToDeg:bde,randFloat:vde,randFloatSpread:yde,randInt:gde,seededRandom:xde,setQuaternionFromProperEuler:_de,smootherstep:mde,smoothstep:pde}),Pe=class{constructor(e=0,t=0){Pe.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let i=Math.cos(t),r=Math.sin(t),n=this.x-e.x,s=this.y-e.y;return this.x=n*i-s*r+e.x,this.y=n*r+s*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},rs=class{constructor(){rs.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,i,r,n,s,a,o,l){let u=this.elements;return u[0]=e,u[1]=r,u[2]=a,u[3]=t,u[4]=n,u[5]=o,u[6]=i,u[7]=s,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,r=t.elements,n=this.elements,s=i[0],a=i[3],o=i[6],l=i[1],u=i[4],c=i[7],h=i[2],d=i[5],p=i[8],m=r[0],v=r[3],g=r[6],w=r[1],S=r[4],_=r[7],A=r[2],C=r[5],E=r[8];return n[0]=s*m+a*w+o*A,n[3]=s*v+a*S+o*C,n[6]=s*g+a*_+o*E,n[1]=l*m+u*w+c*A,n[4]=l*v+u*S+c*C,n[7]=l*g+u*_+c*E,n[2]=h*m+d*w+p*A,n[5]=h*v+d*S+p*C,n[8]=h*g+d*_+p*E,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],u=e[8];return t*s*u-t*a*l-i*n*u+i*a*o+r*n*l-r*s*o}invert(){let e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],u=e[8],c=u*s-a*l,h=a*o-u*n,d=l*n-s*o,p=t*c+i*h+r*d;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);let m=1/p;return e[0]=c*m,e[1]=(r*l-u*i)*m,e[2]=(a*i-r*s)*m,e[3]=h*m,e[4]=(u*t-r*o)*m,e[5]=(r*n-a*t)*m,e[6]=d*m,e[7]=(i*o-l*t)*m,e[8]=(s*t-i*n)*m,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,n,s,a){let o=Math.cos(n),l=Math.sin(n);return this.set(i*o,i*l,-i*(o*s+l*a)+s+e,-r*l,r*o,-r*(-l*s+o*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(f3.makeScale(e,t)),this}rotate(e){return this.premultiply(f3.makeRotation(-e)),this}translate(e,t){return this.premultiply(f3.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){let t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}},f3=new rs;function tq(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}var Sde={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function WM(e,t){return new Sde[e](t)}function Hb(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function Mde(e,t,i){return new Promise(function(r,n){function s(){switch(e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:n();break;case e.TIMEOUT_EXPIRED:setTimeout(s,i);break;default:r()}}setTimeout(s,i)})}function Ig(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function IE(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}var p3={[Pc]:{[l2]:Ig},[l2]:{[Pc]:IE}},Ja={legacyMode:!0,get workingColorSpace(){return l2},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,i){if(this.legacyMode||t===i||!t||!i)return e;if(p3[t]&&p3[t][i]!==void 0){let r=p3[t][i];return e.r=r(e.r),e.g=r(e.g),e.b=r(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},iq={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ps={r:0,g:0,b:0},xu={h:0,s:0,l:0},GM={h:0,s:0,l:0};function m3(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*6*(2/3-i):e}function qM(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}var li=class{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&i===void 0?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Pc){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Ja.toWorkingColorSpace(this,t),this}setRGB(e,t,i,r=Ja.workingColorSpace){return this.r=e,this.g=t,this.b=i,Ja.toWorkingColorSpace(this,r),this}setHSL(e,t,i,r=Ja.workingColorSpace){if(e=Yz(e,1),t=ts(t,0,1),i=ts(i,0,1),t===0)this.r=this.g=this.b=i;else{let n=i<=.5?i*(1+t):i+t-i*t,s=2*i-n;this.r=m3(s,n,e+1/3),this.g=m3(s,n,e),this.b=m3(s,n,e-1/3)}return Ja.toWorkingColorSpace(this,r),this}setStyle(e,t=Pc){function i(n){n!==void 0&&parseFloat(n)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let n,s=r[1],a=r[2];switch(s){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,Ja.toWorkingColorSpace(this,t),i(n[4]),this;if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,Ja.toWorkingColorSpace(this,t),i(n[4]),this;break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){let o=parseFloat(n[1])/360,l=parseFloat(n[2])/100,u=parseFloat(n[3])/100;return i(n[4]),this.setHSL(o,l,u,t)}break}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){let n=r[1],s=n.length;if(s===3)return this.r=parseInt(n.charAt(0)+n.charAt(0),16)/255,this.g=parseInt(n.charAt(1)+n.charAt(1),16)/255,this.b=parseInt(n.charAt(2)+n.charAt(2),16)/255,Ja.toWorkingColorSpace(this,t),this;if(s===6)return this.r=parseInt(n.charAt(0)+n.charAt(1),16)/255,this.g=parseInt(n.charAt(2)+n.charAt(3),16)/255,this.b=parseInt(n.charAt(4)+n.charAt(5),16)/255,Ja.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=Pc){let i=iq[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Ig(e.r),this.g=Ig(e.g),this.b=Ig(e.b),this}copyLinearToSRGB(e){return this.r=IE(e.r),this.g=IE(e.g),this.b=IE(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Pc){return Ja.fromWorkingColorSpace(qM(this,ps),e),ts(ps.r*255,0,255)<<16^ts(ps.g*255,0,255)<<8^ts(ps.b*255,0,255)<<0}getHexString(e=Pc){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Ja.workingColorSpace){Ja.fromWorkingColorSpace(qM(this,ps),t);let i=ps.r,r=ps.g,n=ps.b,s=Math.max(i,r,n),a=Math.min(i,r,n),o,l,u=(a+s)/2;if(a===s)o=0,l=0;else{let c=s-a;switch(l=u<=.5?c/(s+a):c/(2-s-a),s){case i:o=(r-n)/c+(r<n?6:0);break;case r:o=(n-i)/c+2;break;case n:o=(i-r)/c+4;break}o/=6}return e.h=o,e.s=l,e.l=u,e}getRGB(e,t=Ja.workingColorSpace){return Ja.fromWorkingColorSpace(qM(this,ps),t),e.r=ps.r,e.g=ps.g,e.b=ps.b,e}getStyle(e=Pc){return Ja.fromWorkingColorSpace(qM(this,ps),e),e!==Pc?`color(${e} ${ps.r} ${ps.g} ${ps.b})`:`rgb(${ps.r*255|0},${ps.g*255|0},${ps.b*255|0})`}offsetHSL(e,t,i){return this.getHSL(xu),xu.h+=e,xu.s+=t,xu.l+=i,this.setHSL(xu.h,xu.s,xu.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(xu),e.getHSL(GM);let i=rb(xu.h,GM.h,t),r=rb(xu.s,GM.s,t),n=rb(xu.l,GM.l,t);return this.setHSL(i,r,n),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};li.NAMES=iq;var I0,rq=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{I0===void 0&&(I0=Hb("canvas")),I0.width=e.width,I0.height=e.height;let i=I0.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=I0}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){let t=Hb("canvas");t.width=e.width,t.height=e.height;let i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);let r=i.getImageData(0,0,e.width,e.height),n=r.data;for(let s=0;s<n.length;s++)n[s]=Ig(n[s]/255)*255;return i.putImageData(r,0,0),t}else if(e.data){let t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(Ig(t[i]/255)*255):t[i]=Ig(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},nq=class{constructor(e=null){this.isSource=!0,this.uuid=Wl(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];let i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let n;if(Array.isArray(r)){n=[];for(let s=0,a=r.length;s<a;s++)r[s].isDataTexture?n.push(g3(r[s].image)):n.push(g3(r[s]))}else n=g3(r);i.url=n}return t||(e.images[this.uuid]=i),i}};function g3(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?rq.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var Ade=0,tn=class extends Ys{constructor(e=tn.DEFAULT_IMAGE,t=tn.DEFAULT_MAPPING,i=Yr,r=Yr,n=Li,s=sx,a=$r,o=Ua,l=tn.DEFAULT_ANISOTROPY,u=Hu){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Ade++}),this.uuid=Wl(),this.name="",this.source=new nq(e),this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=r,this.magFilter=n,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new Pe(0,0),this.repeat=new Pe(1,1),this.center=new Pe(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new rs,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];let i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Y7)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case md:e.x=e.x-Math.floor(e.x);break;case Yr:e.x=e.x<0?0:1;break;case MI:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case md:e.y=e.y-Math.floor(e.y);break;case Yr:e.y=e.y<0?0:1;break;case MI:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}};tn.DEFAULT_IMAGE=null;tn.DEFAULT_MAPPING=Y7;tn.DEFAULT_ANISOTROPY=1;var bi=class{constructor(e=0,t=0,i=0,r=1){bi.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,i=this.y,r=this.z,n=this.w,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r+s[12]*n,this.y=s[1]*t+s[5]*i+s[9]*r+s[13]*n,this.z=s[2]*t+s[6]*i+s[10]*r+s[14]*n,this.w=s[3]*t+s[7]*i+s[11]*r+s[15]*n,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,n,s=e.elements,a=s[0],o=s[4],l=s[8],u=s[1],c=s[5],h=s[9],d=s[2],p=s[6],m=s[10];if(Math.abs(o-u)<.01&&Math.abs(l-d)<.01&&Math.abs(h-p)<.01){if(Math.abs(o+u)<.1&&Math.abs(l+d)<.1&&Math.abs(h+p)<.1&&Math.abs(a+c+m-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;let g=(a+1)/2,w=(c+1)/2,S=(m+1)/2,_=(o+u)/4,A=(l+d)/4,C=(h+p)/4;return g>w&&g>S?g<.01?(i=0,r=.707106781,n=.707106781):(i=Math.sqrt(g),r=_/i,n=A/i):w>S?w<.01?(i=.707106781,r=0,n=.707106781):(r=Math.sqrt(w),i=_/r,n=C/r):S<.01?(i=.707106781,r=.707106781,n=0):(n=Math.sqrt(S),i=A/n,r=C/n),this.set(i,r,n,t),this}let v=Math.sqrt((p-h)*(p-h)+(l-d)*(l-d)+(u-o)*(u-o));return Math.abs(v)<.001&&(v=1),this.x=(p-h)/v,this.y=(l-d)/v,this.z=(u-o)/v,this.w=Math.acos((a+c+m-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},Ki=class extends Ys{constructor(e=1,t=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new bi(0,0,e,t),this.scissorTest=!1,this.viewport=new bi(0,0,e,t);let r={width:e,height:t,depth:1};this.texture=new tn(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:Li,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;let t=Object.assign({},e.texture.image);return this.texture.source=new nq(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},sq=class extends tn{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Ni,this.minFilter=Ni,this.wrapR=Yr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},Ede=class extends tn{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Ni,this.minFilter=Ni,this.wrapR=Yr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},aq=class extends Ki{constructor(e=1,t=1,i=1,r={}){super(e,t,r),this.isWebGLMultipleRenderTargets=!0;let n=this.texture;this.texture=[];for(let s=0;s<i;s++)this.texture[s]=n.clone(),this.texture[s].isRenderTargetTexture=!0}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,n=this.texture.length;r<n;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}},xi=class{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,n,s,a){let o=i[r+0],l=i[r+1],u=i[r+2],c=i[r+3],h=n[s+0],d=n[s+1],p=n[s+2],m=n[s+3];if(a===0){e[t+0]=o,e[t+1]=l,e[t+2]=u,e[t+3]=c;return}if(a===1){e[t+0]=h,e[t+1]=d,e[t+2]=p,e[t+3]=m;return}if(c!==m||o!==h||l!==d||u!==p){let v=1-a,g=o*h+l*d+u*p+c*m,w=g>=0?1:-1,S=1-g*g;if(S>Number.EPSILON){let A=Math.sqrt(S),C=Math.atan2(A,g*w);v=Math.sin(v*C)/A,a=Math.sin(a*C)/A}let _=a*w;if(o=o*v+h*_,l=l*v+d*_,u=u*v+p*_,c=c*v+m*_,v===1-a){let A=1/Math.sqrt(o*o+l*l+u*u+c*c);o*=A,l*=A,u*=A,c*=A}}e[t]=o,e[t+1]=l,e[t+2]=u,e[t+3]=c}static multiplyQuaternionsFlat(e,t,i,r,n,s){let a=i[r],o=i[r+1],l=i[r+2],u=i[r+3],c=n[s],h=n[s+1],d=n[s+2],p=n[s+3];return e[t]=a*p+u*c+o*d-l*h,e[t+1]=o*p+u*h+l*c-a*d,e[t+2]=l*p+u*d+a*h-o*c,e[t+3]=u*p-a*c-o*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){let i=e._x,r=e._y,n=e._z,s=e._order,a=Math.cos,o=Math.sin,l=a(i/2),u=a(r/2),c=a(n/2),h=o(i/2),d=o(r/2),p=o(n/2);switch(s){case"XYZ":this._x=h*u*c+l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c-h*d*p;break;case"YXZ":this._x=h*u*c+l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c+h*d*p;break;case"ZXY":this._x=h*u*c-l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c-h*d*p;break;case"ZYX":this._x=h*u*c-l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c+h*d*p;break;case"YZX":this._x=h*u*c+l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c-h*d*p;break;case"XZY":this._x=h*u*c-l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,i=t[0],r=t[4],n=t[8],s=t[1],a=t[5],o=t[9],l=t[2],u=t[6],c=t[10],h=i+a+c;if(h>0){let d=.5/Math.sqrt(h+1);this._w=.25/d,this._x=(u-o)*d,this._y=(n-l)*d,this._z=(s-r)*d}else if(i>a&&i>c){let d=2*Math.sqrt(1+i-a-c);this._w=(u-o)/d,this._x=.25*d,this._y=(r+s)/d,this._z=(n+l)/d}else if(a>c){let d=2*Math.sqrt(1+a-i-c);this._w=(n-l)/d,this._x=(r+s)/d,this._y=.25*d,this._z=(o+u)/d}else{let d=2*Math.sqrt(1+c-i-a);this._w=(s-r)/d,this._x=(n+l)/d,this._y=(o+u)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ts(this.dot(e),-1,1)))}rotateTowards(e,t){let i=this.angleTo(e);if(i===0)return this;let r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let i=e._x,r=e._y,n=e._z,s=e._w,a=t._x,o=t._y,l=t._z,u=t._w;return this._x=i*u+s*a+r*l-n*o,this._y=r*u+s*o+n*a-i*l,this._z=n*u+s*l+i*o-r*a,this._w=s*u-i*a-r*o-n*l,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);let i=this._x,r=this._y,n=this._z,s=this._w,a=s*e._w+i*e._x+r*e._y+n*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=i,this._y=r,this._z=n,this;let o=1-a*a;if(o<=Number.EPSILON){let d=1-t;return this._w=d*s+t*this._w,this._x=d*i+t*this._x,this._y=d*r+t*this._y,this._z=d*n+t*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(o),u=Math.atan2(l,a),c=Math.sin((1-t)*u)/l,h=Math.sin(t*u)/l;return this._w=s*c+this._w*h,this._x=i*c+this._x*h,this._y=r*c+this._y*h,this._z=n*c+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){let e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),n=2*Math.PI*Math.random();return this.set(t*Math.cos(r),i*Math.sin(n),i*Math.cos(n),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},H=class{constructor(e=0,t=0,i=0){H.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(qU.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(qU.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,i=this.y,r=this.z,n=e.elements,s=1/(n[3]*t+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*t+n[4]*i+n[8]*r+n[12])*s,this.y=(n[1]*t+n[5]*i+n[9]*r+n[13])*s,this.z=(n[2]*t+n[6]*i+n[10]*r+n[14])*s,this}applyQuaternion(e){let t=this.x,i=this.y,r=this.z,n=e.x,s=e.y,a=e.z,o=e.w,l=o*t+s*r-a*i,u=o*i+a*t-n*r,c=o*r+n*i-s*t,h=-n*t-s*i-a*r;return this.x=l*o+h*-n+u*-a-c*-s,this.y=u*o+h*-s+c*-n-l*-a,this.z=c*o+h*-a+l*-s-u*-n,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){let i=e.x,r=e.y,n=e.z,s=t.x,a=t.y,o=t.z;return this.x=r*o-n*a,this.y=n*s-i*o,this.z=i*a-r*s,this}projectOnVector(e){let t=e.lengthSq();if(t===0)return this.set(0,0,0);let i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return v3.copy(this).projectOnVector(e),this.sub(v3)}reflect(e){return this.sub(v3.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;let i=this.dot(e)/t;return Math.acos(ts(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){let r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},v3=new H,qU=new xi,Nn=class{constructor(e=new H(1/0,1/0,1/0),t=new H(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,r=1/0,n=-1/0,s=-1/0,a=-1/0;for(let o=0,l=e.length;o<l;o+=3){let u=e[o],c=e[o+1],h=e[o+2];u<t&&(t=u),c<i&&(i=c),h<r&&(r=h),u>n&&(n=u),c>s&&(s=c),h>a&&(a=h)}return this.min.set(t,i,r),this.max.set(n,s,a),this}setFromBufferAttribute(e){let t=1/0,i=1/0,r=1/0,n=-1/0,s=-1/0,a=-1/0;for(let o=0,l=e.count;o<l;o++){let u=e.getX(o),c=e.getY(o),h=e.getZ(o);u<t&&(t=u),c<i&&(i=c),h<r&&(r=h),u>n&&(n=u),c>s&&(s=c),h>a&&(a=h)}return this.min.set(t,i,r),this.max.set(n,s,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=Nm.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);let i=e.geometry;if(i!==void 0)if(t&&i.attributes!=null&&i.attributes.position!==void 0){let n=i.attributes.position;for(let s=0,a=n.count;s<a;s++)Nm.fromBufferAttribute(n,s).applyMatrix4(e.matrixWorld),this.expandByPoint(Nm)}else i.boundingBox===null&&i.computeBoundingBox(),y3.copy(i.boundingBox),y3.applyMatrix4(e.matrixWorld),this.union(y3);let r=e.children;for(let n=0,s=r.length;n<s;n++)this.expandByObject(r[n],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Nm),Nm.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(sw),XM.subVectors(this.max,sw),L0.subVectors(e.a,sw),O0.subVectors(e.b,sw),z0.subVectors(e.c,sw),Of.subVectors(O0,L0),zf.subVectors(z0,O0),Fm.subVectors(L0,z0);let t=[0,-Of.z,Of.y,0,-zf.z,zf.y,0,-Fm.z,Fm.y,Of.z,0,-Of.x,zf.z,0,-zf.x,Fm.z,0,-Fm.x,-Of.y,Of.x,0,-zf.y,zf.x,0,-Fm.y,Fm.x,0];return!x3(t,L0,O0,z0,XM)||(t=[1,0,0,0,1,0,0,0,1],!x3(t,L0,O0,z0,XM))?!1:(YM.crossVectors(Of,zf),t=[YM.x,YM.y,YM.z],x3(t,L0,O0,z0,XM))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Nm.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(Nm).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Uh[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Uh[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Uh[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Uh[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Uh[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Uh[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Uh[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Uh[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Uh),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},Uh=[new H,new H,new H,new H,new H,new H,new H,new H],Nm=new H,y3=new Nn,L0=new H,O0=new H,z0=new H,Of=new H,zf=new H,Fm=new H,sw=new H,XM=new H,YM=new H,Um=new H;function x3(e,t,i,r,n){for(let s=0,a=e.length-3;s<=a;s+=3){Um.fromArray(e,s);let o=n.x*Math.abs(Um.x)+n.y*Math.abs(Um.y)+n.z*Math.abs(Um.z),l=t.dot(Um),u=i.dot(Um),c=r.dot(Um);if(Math.max(-Math.max(l,u,c),Math.min(l,u,c))>o)return!1}return!0}var Cde=new Nn,aw=new H,w3=new H,Wo=class{constructor(e=new H,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let i=this.center;t!==void 0?i.copy(t):Cde.setFromPoints(e).getCenter(i);let r=0;for(let n=0,s=e.length;n<s;n++)r=Math.max(r,i.distanceToSquared(e[n]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;aw.subVectors(e,this.center);let t=aw.lengthSq();if(t>this.radius*this.radius){let i=Math.sqrt(t),r=(i-this.radius)*.5;this.center.addScaledVector(aw,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(w3.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(aw.copy(e.center).add(w3)),this.expandByPoint(aw.copy(e.center).sub(w3))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}},Vh=new H,b3=new H,QM=new H,kf=new H,_3=new H,KM=new H,S3=new H,zx=class{constructor(e=new H,t=new H(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Vh)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=Vh.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Vh.copy(this.direction).multiplyScalar(t).add(this.origin),Vh.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){b3.copy(e).add(t).multiplyScalar(.5),QM.copy(t).sub(e).normalize(),kf.copy(this.origin).sub(b3);let n=e.distanceTo(t)*.5,s=-this.direction.dot(QM),a=kf.dot(this.direction),o=-kf.dot(QM),l=kf.lengthSq(),u=Math.abs(1-s*s),c,h,d,p;if(u>0)if(c=s*o-a,h=s*a-o,p=n*u,c>=0)if(h>=-p)if(h<=p){let m=1/u;c*=m,h*=m,d=c*(c+s*h+2*a)+h*(s*c+h+2*o)+l}else h=n,c=Math.max(0,-(s*h+a)),d=-c*c+h*(h+2*o)+l;else h=-n,c=Math.max(0,-(s*h+a)),d=-c*c+h*(h+2*o)+l;else h<=-p?(c=Math.max(0,-(-s*n+a)),h=c>0?-n:Math.min(Math.max(-n,-o),n),d=-c*c+h*(h+2*o)+l):h<=p?(c=0,h=Math.min(Math.max(-n,-o),n),d=h*(h+2*o)+l):(c=Math.max(0,-(s*n+a)),h=c>0?n:Math.min(Math.max(-n,-o),n),d=-c*c+h*(h+2*o)+l);else h=s>0?-n:n,c=Math.max(0,-(s*h+a)),d=-c*c+h*(h+2*o)+l;return i&&i.copy(this.direction).multiplyScalar(c).add(this.origin),r&&r.copy(QM).multiplyScalar(h).add(b3),d}intersectSphere(e,t){Vh.subVectors(e.center,this.origin);let i=Vh.dot(this.direction),r=Vh.dot(Vh)-i*i,n=e.radius*e.radius;if(r>n)return null;let s=Math.sqrt(n-r),a=i-s,o=i+s;return a<0&&o<0?null:a<0?this.at(o,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;let i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){let i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,n,s,a,o,l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,h=this.origin;return l>=0?(i=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(i=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),u>=0?(n=(e.min.y-h.y)*u,s=(e.max.y-h.y)*u):(n=(e.max.y-h.y)*u,s=(e.min.y-h.y)*u),i>s||n>r||((n>i||isNaN(i))&&(i=n),(s<r||isNaN(r))&&(r=s),c>=0?(a=(e.min.z-h.z)*c,o=(e.max.z-h.z)*c):(a=(e.max.z-h.z)*c,o=(e.min.z-h.z)*c),i>o||a>r)||((a>i||i!==i)&&(i=a),(o<r||r!==r)&&(r=o),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return this.intersectBox(e,Vh)!==null}intersectTriangle(e,t,i,r,n){_3.subVectors(t,e),KM.subVectors(i,e),S3.crossVectors(_3,KM);let s=this.direction.dot(S3),a;if(s>0){if(r)return null;a=1}else if(s<0)a=-1,s=-s;else return null;kf.subVectors(this.origin,e);let o=a*this.direction.dot(KM.crossVectors(kf,KM));if(o<0)return null;let l=a*this.direction.dot(_3.cross(kf));if(l<0||o+l>s)return null;let u=-a*kf.dot(S3);return u<0?null:this.at(u/s,n)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},yt=class{constructor(){yt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,i,r,n,s,a,o,l,u,c,h,d,p,m,v){let g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=r,g[1]=n,g[5]=s,g[9]=a,g[13]=o,g[2]=l,g[6]=u,g[10]=c,g[14]=h,g[3]=d,g[7]=p,g[11]=m,g[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new yt().fromArray(this.elements)}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){let t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,i=e.elements,r=1/k0.setFromMatrixColumn(e,0).length(),n=1/k0.setFromMatrixColumn(e,1).length(),s=1/k0.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*n,t[5]=i[5]*n,t[6]=i[6]*n,t[7]=0,t[8]=i[8]*s,t[9]=i[9]*s,t[10]=i[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){let t=this.elements,i=e.x,r=e.y,n=e.z,s=Math.cos(i),a=Math.sin(i),o=Math.cos(r),l=Math.sin(r),u=Math.cos(n),c=Math.sin(n);if(e.order==="XYZ"){let h=s*u,d=s*c,p=a*u,m=a*c;t[0]=o*u,t[4]=-o*c,t[8]=l,t[1]=d+p*l,t[5]=h-m*l,t[9]=-a*o,t[2]=m-h*l,t[6]=p+d*l,t[10]=s*o}else if(e.order==="YXZ"){let h=o*u,d=o*c,p=l*u,m=l*c;t[0]=h+m*a,t[4]=p*a-d,t[8]=s*l,t[1]=s*c,t[5]=s*u,t[9]=-a,t[2]=d*a-p,t[6]=m+h*a,t[10]=s*o}else if(e.order==="ZXY"){let h=o*u,d=o*c,p=l*u,m=l*c;t[0]=h-m*a,t[4]=-s*c,t[8]=p+d*a,t[1]=d+p*a,t[5]=s*u,t[9]=m-h*a,t[2]=-s*l,t[6]=a,t[10]=s*o}else if(e.order==="ZYX"){let h=s*u,d=s*c,p=a*u,m=a*c;t[0]=o*u,t[4]=p*l-d,t[8]=h*l+m,t[1]=o*c,t[5]=m*l+h,t[9]=d*l-p,t[2]=-l,t[6]=a*o,t[10]=s*o}else if(e.order==="YZX"){let h=s*o,d=s*l,p=a*o,m=a*l;t[0]=o*u,t[4]=m-h*c,t[8]=p*c+d,t[1]=c,t[5]=s*u,t[9]=-a*u,t[2]=-l*u,t[6]=d*c+p,t[10]=h-m*c}else if(e.order==="XZY"){let h=s*o,d=s*l,p=a*o,m=a*l;t[0]=o*u,t[4]=-c,t[8]=l*u,t[1]=h*c+m,t[5]=s*u,t[9]=d*c-p,t[2]=p*c-d,t[6]=a*u,t[10]=m*c+h}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Tde,e,Pde)}lookAt(e,t,i){let r=this.elements;return al.subVectors(e,t),al.lengthSq()===0&&(al.z=1),al.normalize(),Bf.crossVectors(i,al),Bf.lengthSq()===0&&(Math.abs(i.z)===1?al.x+=1e-4:al.z+=1e-4,al.normalize(),Bf.crossVectors(i,al)),Bf.normalize(),ZM.crossVectors(al,Bf),r[0]=Bf.x,r[4]=ZM.x,r[8]=al.x,r[1]=Bf.y,r[5]=ZM.y,r[9]=al.y,r[2]=Bf.z,r[6]=ZM.z,r[10]=al.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,r=t.elements,n=this.elements,s=i[0],a=i[4],o=i[8],l=i[12],u=i[1],c=i[5],h=i[9],d=i[13],p=i[2],m=i[6],v=i[10],g=i[14],w=i[3],S=i[7],_=i[11],A=i[15],C=r[0],E=r[4],I=r[8],T=r[12],D=r[1],L=r[5],z=r[9],G=r[13],V=r[2],j=r[6],J=r[10],ne=r[14],K=r[3],B=r[7],Z=r[11],F=r[15];return n[0]=s*C+a*D+o*V+l*K,n[4]=s*E+a*L+o*j+l*B,n[8]=s*I+a*z+o*J+l*Z,n[12]=s*T+a*G+o*ne+l*F,n[1]=u*C+c*D+h*V+d*K,n[5]=u*E+c*L+h*j+d*B,n[9]=u*I+c*z+h*J+d*Z,n[13]=u*T+c*G+h*ne+d*F,n[2]=p*C+m*D+v*V+g*K,n[6]=p*E+m*L+v*j+g*B,n[10]=p*I+m*z+v*J+g*Z,n[14]=p*T+m*G+v*ne+g*F,n[3]=w*C+S*D+_*V+A*K,n[7]=w*E+S*L+_*j+A*B,n[11]=w*I+S*z+_*J+A*Z,n[15]=w*T+S*G+_*ne+A*F,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],s=e[1],a=e[5],o=e[9],l=e[13],u=e[2],c=e[6],h=e[10],d=e[14],p=e[3],m=e[7],v=e[11],g=e[15];return p*(+n*o*c-r*l*c-n*a*h+i*l*h+r*a*d-i*o*d)+m*(+t*o*d-t*l*h+n*s*h-r*s*d+r*l*u-n*o*u)+v*(+t*l*c-t*a*d-n*s*c+i*s*d+n*a*u-i*l*u)+g*(-r*a*u-t*o*c+t*a*h+r*s*c-i*s*h+i*o*u)}transpose(){let e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){let r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){let e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],u=e[8],c=e[9],h=e[10],d=e[11],p=e[12],m=e[13],v=e[14],g=e[15],w=c*v*l-m*h*l+m*o*d-a*v*d-c*o*g+a*h*g,S=p*h*l-u*v*l-p*o*d+s*v*d+u*o*g-s*h*g,_=u*m*l-p*c*l+p*a*d-s*m*d-u*a*g+s*c*g,A=p*c*o-u*m*o-p*a*h+s*m*h+u*a*v-s*c*v,C=t*w+i*S+r*_+n*A;if(C===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let E=1/C;return e[0]=w*E,e[1]=(m*h*n-c*v*n-m*r*d+i*v*d+c*r*g-i*h*g)*E,e[2]=(a*v*n-m*o*n+m*r*l-i*v*l-a*r*g+i*o*g)*E,e[3]=(c*o*n-a*h*n-c*r*l+i*h*l+a*r*d-i*o*d)*E,e[4]=S*E,e[5]=(u*v*n-p*h*n+p*r*d-t*v*d-u*r*g+t*h*g)*E,e[6]=(p*o*n-s*v*n-p*r*l+t*v*l+s*r*g-t*o*g)*E,e[7]=(s*h*n-u*o*n+u*r*l-t*h*l-s*r*d+t*o*d)*E,e[8]=_*E,e[9]=(p*c*n-u*m*n-p*i*d+t*m*d+u*i*g-t*c*g)*E,e[10]=(s*m*n-p*a*n+p*i*l-t*m*l-s*i*g+t*a*g)*E,e[11]=(u*a*n-s*c*n-u*i*l+t*c*l+s*i*d-t*a*d)*E,e[12]=A*E,e[13]=(u*m*r-p*c*r+p*i*h-t*m*h-u*i*v+t*c*v)*E,e[14]=(p*a*r-s*m*r-p*i*o+t*m*o+s*i*v-t*a*v)*E,e[15]=(s*c*r-u*a*r+u*i*o-t*c*o-s*i*h+t*a*h)*E,this}scale(e){let t=this.elements,i=e.x,r=e.y,n=e.z;return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let i=Math.cos(t),r=Math.sin(t),n=1-i,s=e.x,a=e.y,o=e.z,l=n*s,u=n*a;return this.set(l*s+i,l*a-r*o,l*o+r*a,0,l*a+r*o,u*a+i,u*o-r*s,0,l*o-r*a,u*o+r*s,n*o*o+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,n,s){return this.set(1,i,n,0,e,1,s,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){let r=this.elements,n=t._x,s=t._y,a=t._z,o=t._w,l=n+n,u=s+s,c=a+a,h=n*l,d=n*u,p=n*c,m=s*u,v=s*c,g=a*c,w=o*l,S=o*u,_=o*c,A=i.x,C=i.y,E=i.z;return r[0]=(1-(m+g))*A,r[1]=(d+_)*A,r[2]=(p-S)*A,r[3]=0,r[4]=(d-_)*C,r[5]=(1-(h+g))*C,r[6]=(v+w)*C,r[7]=0,r[8]=(p+S)*E,r[9]=(v-w)*E,r[10]=(1-(h+m))*E,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){let r=this.elements,n=k0.set(r[0],r[1],r[2]).length(),s=k0.set(r[4],r[5],r[6]).length(),a=k0.set(r[8],r[9],r[10]).length();this.determinant()<0&&(n=-n),e.x=r[12],e.y=r[13],e.z=r[14],wu.copy(this);let o=1/n,l=1/s,u=1/a;return wu.elements[0]*=o,wu.elements[1]*=o,wu.elements[2]*=o,wu.elements[4]*=l,wu.elements[5]*=l,wu.elements[6]*=l,wu.elements[8]*=u,wu.elements[9]*=u,wu.elements[10]*=u,t.setFromRotationMatrix(wu),i.x=n,i.y=s,i.z=a,this}makePerspective(e,t,i,r,n,s){let a=this.elements,o=2*n/(t-e),l=2*n/(i-r),u=(t+e)/(t-e),c=(i+r)/(i-r),h=-(s+n)/(s-n),d=-2*s*n/(s-n);return a[0]=o,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=l,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,i,r,n,s){let a=this.elements,o=1/(t-e),l=1/(i-r),u=1/(s-n),c=(t+e)*o,h=(i+r)*l,d=(s+n)*u;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){let t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}},k0=new H,wu=new yt,Tde=new H(0,0,0),Pde=new H(1,1,1),Bf=new H,ZM=new H,al=new H,XU=new yt,YU=new xi,ws=class{constructor(e=0,t=0,i=0,r=ws.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){let r=e.elements,n=r[0],s=r[4],a=r[8],o=r[1],l=r[5],u=r[9],c=r[2],h=r[6],d=r[10];switch(t){case"XYZ":this._y=Math.asin(ts(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-s,n)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-ts(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-c,n),this._z=0);break;case"ZXY":this._x=Math.asin(ts(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,n));break;case"ZYX":this._y=Math.asin(-ts(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(o,n)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(ts(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-c,n)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-ts(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(a,n)):(this._x=Math.atan2(-u,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return XU.makeRotationFromQuaternion(e),this.setFromRotationMatrix(XU,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return YU.setFromEuler(this),this.setFromQuaternion(YU,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};ws.DEFAULT_ORDER="XYZ";var Qz=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}},Dde=0,QU=new H,B0=new xi,jh=new yt,JM=new H,ow=new H,Rde=new H,Ide=new xi,KU=new H(1,0,0),ZU=new H(0,1,0),JU=new H(0,0,1),Lde={type:"added"},$U={type:"removed"},vr=class extends Ys{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Dde++}),this.uuid=Wl(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=vr.DEFAULT_UP.clone();let e=new H,t=new ws,i=new xi,r=new H(1,1,1);function n(){i.setFromEuler(t,!1)}function s(){t.setFromQuaternion(i,void 0,!1)}t._onChange(n),i._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new yt},normalMatrix:{value:new rs}}),this.matrix=new yt,this.matrixWorld=new yt,this.matrixAutoUpdate=vr.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=vr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Qz,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return B0.setFromAxisAngle(e,t),this.quaternion.multiply(B0),this}rotateOnWorldAxis(e,t){return B0.setFromAxisAngle(e,t),this.quaternion.premultiply(B0),this}rotateX(e){return this.rotateOnAxis(KU,e)}rotateY(e){return this.rotateOnAxis(ZU,e)}rotateZ(e){return this.rotateOnAxis(JU,e)}translateOnAxis(e,t){return QU.copy(e).applyQuaternion(this.quaternion),this.position.add(QU.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(KU,e)}translateY(e){return this.translateOnAxis(ZU,e)}translateZ(e){return this.translateOnAxis(JU,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(jh.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?JM.copy(e):JM.set(e,t,i);let r=this.parent;this.updateWorldMatrix(!0,!1),ow.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?jh.lookAt(ow,JM,this.up):jh.lookAt(JM,ow,this.up),this.quaternion.setFromRotationMatrix(jh),r&&(jh.extractRotation(r.matrixWorld),B0.setFromRotationMatrix(jh),this.quaternion.premultiply(B0.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Lde)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}let t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent($U)),this}removeFromParent(){let e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){let t=this.children[e];t.parent=null,t.dispatchEvent($U)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),jh.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),jh.multiply(e.parent.matrixWorld)),e.applyMatrix4(jh),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){let n=this.children[i].getObjectByProperty(e,t);if(n!==void 0)return n}}getObjectsByProperty(e,t){let i=[];this[e]===t&&i.push(this);for(let r=0,n=this.children.length;r<n;r++){let s=this.children[r].getObjectsByProperty(e,t);s.length>0&&(i=i.concat(s))}return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ow,e,Rde),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ow,Ide,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);let t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);let t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){let t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let t=this.children;for(let i=0,r=t.length;i<r;i++){let n=t[i];(n.matrixWorldAutoUpdate===!0||e===!0)&&n.updateMatrixWorld(e)}}updateWorldMatrix(e,t){let i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){let r=this.children;for(let n=0,s=r.length;n<s;n++){let a=r[n];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){let t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function n(a,o){return a[o.uuid]===void 0&&(a[o.uuid]=o.toJSON(e)),o.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=n(e.geometries,this.geometry);let a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){let o=a.shapes;if(Array.isArray(o))for(let l=0,u=o.length;l<u;l++){let c=o[l];n(e.shapes,c)}else n(e.shapes,o)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(n(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let a=[];for(let o=0,l=this.material.length;o<l;o++)a.push(n(e.materials,this.material[o]));r.material=a}else r.material=n(e.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){let o=this.animations[a];r.animations.push(n(e.animations,o))}}if(t){let a=s(e.geometries),o=s(e.materials),l=s(e.textures),u=s(e.images),c=s(e.shapes),h=s(e.skeletons),d=s(e.animations),p=s(e.nodes);a.length>0&&(i.geometries=a),o.length>0&&(i.materials=o),l.length>0&&(i.textures=l),u.length>0&&(i.images=u),c.length>0&&(i.shapes=c),h.length>0&&(i.skeletons=h),d.length>0&&(i.animations=d),p.length>0&&(i.nodes=p)}return i.object=r,i;function s(a){let o=[];for(let l in a){let u=a[l];delete u.metadata,o.push(u)}return o}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){let r=e.children[i];this.add(r.clone())}return this}};vr.DEFAULT_UP=new H(0,1,0);vr.DEFAULT_MATRIX_AUTO_UPDATE=!0;vr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var bu=new H,Hh=new H,M3=new H,Wh=new H,N0=new H,F0=new H,e5=new H,A3=new H,E3=new H,C3=new H,pa=class{constructor(e=new H,t=new H,i=new H){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),bu.subVectors(e,t),r.cross(bu);let n=r.lengthSq();return n>0?r.multiplyScalar(1/Math.sqrt(n)):r.set(0,0,0)}static getBarycoord(e,t,i,r,n){bu.subVectors(r,t),Hh.subVectors(i,t),M3.subVectors(e,t);let s=bu.dot(bu),a=bu.dot(Hh),o=bu.dot(M3),l=Hh.dot(Hh),u=Hh.dot(M3),c=s*l-a*a;if(c===0)return n.set(-2,-1,-1);let h=1/c,d=(l*o-a*u)*h,p=(s*u-a*o)*h;return n.set(1-d-p,p,d)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,Wh),Wh.x>=0&&Wh.y>=0&&Wh.x+Wh.y<=1}static getUV(e,t,i,r,n,s,a,o){return this.getBarycoord(e,t,i,r,Wh),o.set(0,0),o.addScaledVector(n,Wh.x),o.addScaledVector(s,Wh.y),o.addScaledVector(a,Wh.z),o}static isFrontFacing(e,t,i,r){return bu.subVectors(i,t),Hh.subVectors(e,t),bu.cross(Hh).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return bu.subVectors(this.c,this.b),Hh.subVectors(this.a,this.b),bu.cross(Hh).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return pa.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return pa.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,r,n){return pa.getUV(e,this.a,this.b,this.c,t,i,r,n)}containsPoint(e){return pa.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return pa.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let i=this.a,r=this.b,n=this.c,s,a;N0.subVectors(r,i),F0.subVectors(n,i),A3.subVectors(e,i);let o=N0.dot(A3),l=F0.dot(A3);if(o<=0&&l<=0)return t.copy(i);E3.subVectors(e,r);let u=N0.dot(E3),c=F0.dot(E3);if(u>=0&&c<=u)return t.copy(r);let h=o*c-u*l;if(h<=0&&o>=0&&u<=0)return s=o/(o-u),t.copy(i).addScaledVector(N0,s);C3.subVectors(e,n);let d=N0.dot(C3),p=F0.dot(C3);if(p>=0&&d<=p)return t.copy(n);let m=d*l-o*p;if(m<=0&&l>=0&&p<=0)return a=l/(l-p),t.copy(i).addScaledVector(F0,a);let v=u*p-d*c;if(v<=0&&c-u>=0&&d-p>=0)return e5.subVectors(n,r),a=(c-u)/(c-u+(d-p)),t.copy(r).addScaledVector(e5,a);let g=1/(v+m+h);return s=m*g,a=h*g,t.copy(i).addScaledVector(N0,s).addScaledVector(F0,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},Ode=0,U_=class extends Ys{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Ode++}),this.uuid=Wl(),this.name="",this.type="Material",this.blending=Pg,this.side=ju,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=G7,this.blendDst=q7,this.blendEquation=fy,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=bI,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=lde,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=d3,this.stencilZFail=d3,this.stencilZPass=d3,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(let t in e){let i=e[t];if(i===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}let r=this[t];if(r===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){let t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});let i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Pg&&(i.blending=this.blending),this.side!==ju&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(i.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(n){let s=[];for(let a in n){let o=n[a];delete o.metadata,s.push(o)}return s}if(t){let n=r(e.textures),s=r(e.images);n.length>0&&(i.textures=n),s.length>0&&(i.images=s)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,i=null;if(t!==null){let r=t.length;i=new Array(r);for(let n=0;n!==r;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}},Dd=class extends U_{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new li(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=X7,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}},Kn=new H,$M=new Pe,hi=class{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=AI,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,n=this.itemSize;r<n;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)$M.fromBufferAttribute(this,t),$M.applyMatrix3(e),this.setXY(t,$M.x,$M.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)Kn.fromBufferAttribute(this,t),Kn.applyMatrix3(e),this.setXYZ(t,Kn.x,Kn.y,Kn.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)Kn.fromBufferAttribute(this,t),Kn.applyMatrix4(e),this.setXYZ(t,Kn.x,Kn.y,Kn.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Kn.fromBufferAttribute(this,t),Kn.applyNormalMatrix(e),this.setXYZ(t,Kn.x,Kn.y,Kn.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Kn.fromBufferAttribute(this,t),Kn.transformDirection(e),this.setXYZ(t,Kn.x,Kn.y,Kn.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=vd(t,this.array)),t}setX(e,t){return this.normalized&&(t=Or(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=vd(t,this.array)),t}setY(e,t){return this.normalized&&(t=Or(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=vd(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Or(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=vd(t,this.array)),t}setW(e,t){return this.normalized&&(t=Or(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Or(t,this.array),i=Or(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=Or(t,this.array),i=Or(i,this.array),r=Or(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,n){return e*=this.itemSize,this.normalized&&(t=Or(t,this.array),i=Or(i,this.array),r=Or(r,this.array),n=Or(n,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=n,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==AI&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}},oq=class extends hi{constructor(e,t,i){super(new Uint16Array(e),t,i)}},Vy=class extends hi{constructor(e,t,i){super(new Uint32Array(e),t,i)}},kt=class extends hi{constructor(e,t,i){super(new Float32Array(e),t,i)}},zde=0,Tl=new yt,T3=new vr,U0=new H,ol=new Nn,lw=new Nn,zs=new H,Kt=class extends Ys{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:zde++}),this.uuid=Wl(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(tq(e)?Vy:oq)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);let i=this.attributes.normal;if(i!==void 0){let n=new rs().getNormalMatrix(e);i.applyNormalMatrix(n),i.needsUpdate=!0}let r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Tl.makeRotationFromQuaternion(e),this.applyMatrix4(Tl),this}rotateX(e){return Tl.makeRotationX(e),this.applyMatrix4(Tl),this}rotateY(e){return Tl.makeRotationY(e),this.applyMatrix4(Tl),this}rotateZ(e){return Tl.makeRotationZ(e),this.applyMatrix4(Tl),this}translate(e,t,i){return Tl.makeTranslation(e,t,i),this.applyMatrix4(Tl),this}scale(e,t,i){return Tl.makeScale(e,t,i),this.applyMatrix4(Tl),this}lookAt(e){return T3.lookAt(e),T3.updateMatrix(),this.applyMatrix4(T3.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(U0).negate(),this.translate(U0.x,U0.y,U0.z),this}setFromPoints(e){let t=[];for(let i=0,r=e.length;i<r;i++){let n=e[i];t.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new kt(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Nn);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new H(-1/0,-1/0,-1/0),new H(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++){let n=t[i];ol.setFromBufferAttribute(n),this.morphTargetsRelative?(zs.addVectors(this.boundingBox.min,ol.min),this.boundingBox.expandByPoint(zs),zs.addVectors(this.boundingBox.max,ol.max),this.boundingBox.expandByPoint(zs)):(this.boundingBox.expandByPoint(ol.min),this.boundingBox.expandByPoint(ol.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Wo);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new H,1/0);return}if(e){let i=this.boundingSphere.center;if(ol.setFromBufferAttribute(e),t)for(let n=0,s=t.length;n<s;n++){let a=t[n];lw.setFromBufferAttribute(a),this.morphTargetsRelative?(zs.addVectors(ol.min,lw.min),ol.expandByPoint(zs),zs.addVectors(ol.max,lw.max),ol.expandByPoint(zs)):(ol.expandByPoint(lw.min),ol.expandByPoint(lw.max))}ol.getCenter(i);let r=0;for(let n=0,s=e.count;n<s;n++)zs.fromBufferAttribute(e,n),r=Math.max(r,i.distanceToSquared(zs));if(t)for(let n=0,s=t.length;n<s;n++){let a=t[n],o=this.morphTargetsRelative;for(let l=0,u=a.count;l<u;l++)zs.fromBufferAttribute(a,l),o&&(U0.fromBufferAttribute(e,l),zs.add(U0)),r=Math.max(r,i.distanceToSquared(zs))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let i=e.array,r=t.position.array,n=t.normal.array,s=t.uv.array,a=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new hi(new Float32Array(4*a),4));let o=this.getAttribute("tangent").array,l=[],u=[];for(let D=0;D<a;D++)l[D]=new H,u[D]=new H;let c=new H,h=new H,d=new H,p=new Pe,m=new Pe,v=new Pe,g=new H,w=new H;function S(D,L,z){c.fromArray(r,D*3),h.fromArray(r,L*3),d.fromArray(r,z*3),p.fromArray(s,D*2),m.fromArray(s,L*2),v.fromArray(s,z*2),h.sub(c),d.sub(c),m.sub(p),v.sub(p);let G=1/(m.x*v.y-v.x*m.y);!isFinite(G)||(g.copy(h).multiplyScalar(v.y).addScaledVector(d,-m.y).multiplyScalar(G),w.copy(d).multiplyScalar(m.x).addScaledVector(h,-v.x).multiplyScalar(G),l[D].add(g),l[L].add(g),l[z].add(g),u[D].add(w),u[L].add(w),u[z].add(w))}let _=this.groups;_.length===0&&(_=[{start:0,count:i.length}]);for(let D=0,L=_.length;D<L;++D){let z=_[D],G=z.start,V=z.count;for(let j=G,J=G+V;j<J;j+=3)S(i[j+0],i[j+1],i[j+2])}let A=new H,C=new H,E=new H,I=new H;function T(D){E.fromArray(n,D*3),I.copy(E);let L=l[D];A.copy(L),A.sub(E.multiplyScalar(E.dot(L))).normalize(),C.crossVectors(I,L);let z=C.dot(u[D])<0?-1:1;o[D*4]=A.x,o[D*4+1]=A.y,o[D*4+2]=A.z,o[D*4+3]=z}for(let D=0,L=_.length;D<L;++D){let z=_[D],G=z.start,V=z.count;for(let j=G,J=G+V;j<J;j+=3)T(i[j+0]),T(i[j+1]),T(i[j+2])}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new hi(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let h=0,d=i.count;h<d;h++)i.setXYZ(h,0,0,0);let r=new H,n=new H,s=new H,a=new H,o=new H,l=new H,u=new H,c=new H;if(e)for(let h=0,d=e.count;h<d;h+=3){let p=e.getX(h+0),m=e.getX(h+1),v=e.getX(h+2);r.fromBufferAttribute(t,p),n.fromBufferAttribute(t,m),s.fromBufferAttribute(t,v),u.subVectors(s,n),c.subVectors(r,n),u.cross(c),a.fromBufferAttribute(i,p),o.fromBufferAttribute(i,m),l.fromBufferAttribute(i,v),a.add(u),o.add(u),l.add(u),i.setXYZ(p,a.x,a.y,a.z),i.setXYZ(m,o.x,o.y,o.z),i.setXYZ(v,l.x,l.y,l.z)}else for(let h=0,d=t.count;h<d;h+=3)r.fromBufferAttribute(t,h+0),n.fromBufferAttribute(t,h+1),s.fromBufferAttribute(t,h+2),u.subVectors(s,n),c.subVectors(r,n),u.cross(c),i.setXYZ(h+0,u.x,u.y,u.z),i.setXYZ(h+1,u.x,u.y,u.z),i.setXYZ(h+2,u.x,u.y,u.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){let e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)zs.fromBufferAttribute(e,t),zs.normalize(),e.setXYZ(t,zs.x,zs.y,zs.z)}toNonIndexed(){function e(a,o){let l=a.array,u=a.itemSize,c=a.normalized,h=new l.constructor(o.length*u),d=0,p=0;for(let m=0,v=o.length;m<v;m++){a.isInterleavedBufferAttribute?d=o[m]*a.data.stride+a.offset:d=o[m]*u;for(let g=0;g<u;g++)h[p++]=l[d++]}return new hi(h,u,c)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new Kt,i=this.index.array,r=this.attributes;for(let a in r){let o=r[a],l=e(o,i);t.setAttribute(a,l)}let n=this.morphAttributes;for(let a in n){let o=[],l=n[a];for(let u=0,c=l.length;u<c;u++){let h=l[u],d=e(h,i);o.push(d)}t.morphAttributes[a]=o}t.morphTargetsRelative=this.morphTargetsRelative;let s=this.groups;for(let a=0,o=s.length;a<o;a++){let l=s[a];t.addGroup(l.start,l.count,l.materialIndex)}return t}toJSON(){let e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){let o=this.parameters;for(let l in o)o[l]!==void 0&&(e[l]=o[l]);return e}e.data={attributes:{}};let t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let i=this.attributes;for(let o in i){let l=i[o];e.data.attributes[o]=l.toJSON(e.data)}let r={},n=!1;for(let o in this.morphAttributes){let l=this.morphAttributes[o],u=[];for(let c=0,h=l.length;c<h;c++){let d=l[c];u.push(d.toJSON(e.data))}u.length>0&&(r[o]=u,n=!0)}n&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);let s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));let a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let i=e.index;i!==null&&this.setIndex(i.clone(t));let r=e.attributes;for(let l in r){let u=r[l];this.setAttribute(l,u.clone(t))}let n=e.morphAttributes;for(let l in n){let u=[],c=n[l];for(let h=0,d=c.length;h<d;h++)u.push(c[h].clone(t));this.morphAttributes[l]=u}this.morphTargetsRelative=e.morphTargetsRelative;let s=e.groups;for(let l=0,u=s.length;l<u;l++){let c=s[l];this.addGroup(c.start,c.count,c.materialIndex)}let a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());let o=e.boundingSphere;return o!==null&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}},t5=new yt,V0=new zx,P3=new Wo,uw=new H,cw=new H,hw=new H,D3=new H,eA=new H,tA=new Pe,iA=new Pe,rA=new Pe,R3=new H,nA=new H,zr=class extends vr{constructor(e=new Kt,t=new Dd){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,n=i.length;r<n;r++){let s=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=r}}}}getVertexPosition(e,t){let i=this.geometry,r=i.attributes.position,n=i.morphAttributes.position,s=i.morphTargetsRelative;t.fromBufferAttribute(r,e);let a=this.morphTargetInfluences;if(n&&a){eA.set(0,0,0);for(let o=0,l=n.length;o<l;o++){let u=a[o],c=n[o];u!==0&&(D3.fromBufferAttribute(c,e),s?eA.addScaledVector(D3,u):eA.addScaledVector(D3.sub(t),u))}t.add(eA)}return this.isSkinnedMesh&&this.boneTransform(e,t),t}raycast(e,t){let i=this.geometry,r=this.material,n=this.matrixWorld;if(r===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),P3.copy(i.boundingSphere),P3.applyMatrix4(n),e.ray.intersectsSphere(P3)===!1)||(t5.copy(n).invert(),V0.copy(e.ray).applyMatrix4(t5),i.boundingBox!==null&&V0.intersectsBox(i.boundingBox)===!1))return;let s,a=i.index,o=i.attributes.position,l=i.attributes.uv,u=i.attributes.uv2,c=i.groups,h=i.drawRange;if(a!==null)if(Array.isArray(r))for(let d=0,p=c.length;d<p;d++){let m=c[d],v=r[m.materialIndex],g=Math.max(m.start,h.start),w=Math.min(a.count,Math.min(m.start+m.count,h.start+h.count));for(let S=g,_=w;S<_;S+=3){let A=a.getX(S),C=a.getX(S+1),E=a.getX(S+2);s=sA(this,v,e,V0,l,u,A,C,E),s&&(s.faceIndex=Math.floor(S/3),s.face.materialIndex=m.materialIndex,t.push(s))}}else{let d=Math.max(0,h.start),p=Math.min(a.count,h.start+h.count);for(let m=d,v=p;m<v;m+=3){let g=a.getX(m),w=a.getX(m+1),S=a.getX(m+2);s=sA(this,r,e,V0,l,u,g,w,S),s&&(s.faceIndex=Math.floor(m/3),t.push(s))}}else if(o!==void 0)if(Array.isArray(r))for(let d=0,p=c.length;d<p;d++){let m=c[d],v=r[m.materialIndex],g=Math.max(m.start,h.start),w=Math.min(o.count,Math.min(m.start+m.count,h.start+h.count));for(let S=g,_=w;S<_;S+=3){let A=S,C=S+1,E=S+2;s=sA(this,v,e,V0,l,u,A,C,E),s&&(s.faceIndex=Math.floor(S/3),s.face.materialIndex=m.materialIndex,t.push(s))}}else{let d=Math.max(0,h.start),p=Math.min(o.count,h.start+h.count);for(let m=d,v=p;m<v;m+=3){let g=m,w=m+1,S=m+2;s=sA(this,r,e,V0,l,u,g,w,S),s&&(s.faceIndex=Math.floor(m/3),t.push(s))}}}};function kde(e,t,i,r,n,s,a,o){let l;if(t.side===Hs?l=r.intersectTriangle(a,s,n,!0,o):l=r.intersectTriangle(n,s,a,t.side===ju,o),l===null)return null;nA.copy(o),nA.applyMatrix4(e.matrixWorld);let u=i.ray.origin.distanceTo(nA);return u<i.near||u>i.far?null:{distance:u,point:nA.clone(),object:e}}function sA(e,t,i,r,n,s,a,o,l){e.getVertexPosition(a,uw),e.getVertexPosition(o,cw),e.getVertexPosition(l,hw);let u=kde(e,t,i,r,uw,cw,hw,R3);if(u){n&&(tA.fromBufferAttribute(n,a),iA.fromBufferAttribute(n,o),rA.fromBufferAttribute(n,l),u.uv=pa.getUV(R3,uw,cw,hw,tA,iA,rA,new Pe)),s&&(tA.fromBufferAttribute(s,a),iA.fromBufferAttribute(s,o),rA.fromBufferAttribute(s,l),u.uv2=pa.getUV(R3,uw,cw,hw,tA,iA,rA,new Pe));let c={a,b:o,c:l,normal:new H,materialIndex:0};pa.getNormal(uw,cw,hw,c.normal),u.face=c}return u}var Wu=class extends Kt{constructor(e=1,t=1,i=1,r=1,n=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:n,depthSegments:s};let a=this;r=Math.floor(r),n=Math.floor(n),s=Math.floor(s);let o=[],l=[],u=[],c=[],h=0,d=0;p("z","y","x",-1,-1,i,t,e,s,n,0),p("z","y","x",1,-1,i,t,-e,s,n,1),p("x","z","y",1,1,e,i,t,r,s,2),p("x","z","y",1,-1,e,i,-t,r,s,3),p("x","y","z",1,-1,e,t,i,r,n,4),p("x","y","z",-1,-1,e,t,-i,r,n,5),this.setIndex(o),this.setAttribute("position",new kt(l,3)),this.setAttribute("normal",new kt(u,3)),this.setAttribute("uv",new kt(c,2));function p(m,v,g,w,S,_,A,C,E,I,T){let D=_/E,L=A/I,z=_/2,G=A/2,V=C/2,j=E+1,J=I+1,ne=0,K=0,B=new H;for(let Z=0;Z<J;Z++){let F=Z*L-G;for(let X=0;X<j;X++){let Y=X*D-z;B[m]=Y*w,B[v]=F*S,B[g]=V,l.push(B.x,B.y,B.z),B[m]=0,B[v]=0,B[g]=C>0?1:-1,u.push(B.x,B.y,B.z),c.push(X/E),c.push(1-Z/I),ne+=1}}for(let Z=0;Z<I;Z++)for(let F=0;F<E;F++){let X=h+F+j*Z,Y=h+F+j*(Z+1),le=h+(F+1)+j*(Z+1),oe=h+(F+1)+j*Z;o.push(X,Y,oe),o.push(Y,le,oe),K+=6}a.addGroup(d,K,T),d+=K,h+=ne}}static fromJSON(e){return new Wu(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function ax(e){let t={};for(let i in e){t[i]={};for(let r in e[i]){let n=e[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?t[i][r]=n.clone():Array.isArray(n)?t[i][r]=n.slice():t[i][r]=n}}return t}function ro(e){let t={};for(let i=0;i<e.length;i++){let r=ax(e[i]);for(let n in r)t[n]=r[n]}return t}function Bde(e){let t=[];for(let i=0;i<e.length;i++)t.push(e[i].clone());return t}function lq(e){return e.getRenderTarget()===null&&e.outputEncoding===Ri?Pc:l2}var kx={clone:ax,merge:ro},Nde=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Fde=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,Zi=class extends U_{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Nde,this.fragmentShader=Fde,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=ax(e.uniforms),this.uniformsGroups=Bde(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(let r in this.uniforms){let n=this.uniforms[r].value;n&&n.isTexture?t.uniforms[r]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[r]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[r]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[r]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[r]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[r]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[r]={type:"m4",value:n.toArray()}:t.uniforms[r]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;let i={};for(let r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}},Wp=class extends vr{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new yt,this.projectionMatrix=new yt,this.projectionMatrixInverse=new yt}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}},La=class extends Wp{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=jb*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(ib*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return jb*2*Math.atan(Math.tan(ib*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,r,n,s){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(ib*.5*this.fov)/this.zoom,i=2*t,r=this.aspect*i,n=-.5*r,s=this.view;if(this.view!==null&&this.view.enabled){let o=s.fullWidth,l=s.fullHeight;n+=s.offsetX*r/o,t-=s.offsetY*i/l,r*=s.width/o,i*=s.height/l}let a=this.filmOffset;a!==0&&(n+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+r,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}},j0=-90,H0=1,Ude=class extends vr{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i;let r=new La(j0,H0,e,t);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(1,0,0),this.add(r);let n=new La(j0,H0,e,t);n.layers=this.layers,n.up.set(0,1,0),n.lookAt(-1,0,0),this.add(n);let s=new La(j0,H0,e,t);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(0,1,0),this.add(s);let a=new La(j0,H0,e,t);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(0,-1,0),this.add(a);let o=new La(j0,H0,e,t);o.layers=this.layers,o.up.set(0,1,0),o.lookAt(0,0,1),this.add(o);let l=new La(j0,H0,e,t);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,-1),this.add(l)}update(e,t){this.parent===null&&this.updateMatrixWorld();let i=this.renderTarget,[r,n,s,a,o,l]=this.children,u=e.getRenderTarget(),c=e.toneMapping,h=e.xr.enabled;e.toneMapping=Wc,e.xr.enabled=!1;let d=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,n),e.setRenderTarget(i,2),e.render(t,s),e.setRenderTarget(i,3),e.render(t,a),e.setRenderTarget(i,4),e.render(t,o),i.texture.generateMipmaps=d,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(u),e.toneMapping=c,e.xr.enabled=h,i.texture.needsPMREMUpdate=!0}},Kz=class extends tn{constructor(e,t,i,r,n,s,a,o,l,u){e=e!==void 0?e:[],t=t!==void 0?t:Hg,super(e,t,i,r,n,s,a,o,l,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}},Vde=class extends Ki{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;let i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new Kz(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Li}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new Wu(5,5,5),n=new Zi({name:"CubemapFromEquirect",uniforms:ax(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Hs,blending:ns});n.uniforms.tEquirect.value=t;let s=new zr(r,n),a=t.minFilter;return t.minFilter===sx&&(t.minFilter=Li),new Ude(1,10,this).update(e,s),t.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,i,r){let n=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,i,r);e.setRenderTarget(n)}},I3=new H,jde=new H,Hde=new rs,Oo=class{constructor(e=new H(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){let r=I3.subVectors(i,t).cross(jde.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){let i=e.delta(I3),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;let n=-(e.start.dot(this.normal)+this.constant)/r;return n<0||n>1?null:t.copy(i).multiplyScalar(n).add(e.start)}intersectsLine(e){let t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let i=t||Hde.getNormalMatrix(e),r=this.coplanarPoint(I3).applyMatrix4(e),n=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(n),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}},W0=new Wo,aA=new H,Zz=class{constructor(e=new Oo,t=new Oo,i=new Oo,r=new Oo,n=new Oo,s=new Oo){this.planes=[e,t,i,r,n,s]}set(e,t,i,r,n,s){let a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(n),a[5].copy(s),this}copy(e){let t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){let t=this.planes,i=e.elements,r=i[0],n=i[1],s=i[2],a=i[3],o=i[4],l=i[5],u=i[6],c=i[7],h=i[8],d=i[9],p=i[10],m=i[11],v=i[12],g=i[13],w=i[14],S=i[15];return t[0].setComponents(a-r,c-o,m-h,S-v).normalize(),t[1].setComponents(a+r,c+o,m+h,S+v).normalize(),t[2].setComponents(a+n,c+l,m+d,S+g).normalize(),t[3].setComponents(a-n,c-l,m-d,S-g).normalize(),t[4].setComponents(a-s,c-u,m-p,S-w).normalize(),t[5].setComponents(a+s,c+u,m+p,S+w).normalize(),this}intersectsObject(e){let t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),W0.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(W0)}intersectsSprite(e){return W0.center.set(0,0,0),W0.radius=.7071067811865476,W0.applyMatrix4(e.matrixWorld),this.intersectsSphere(W0)}intersectsSphere(e){let t=this.planes,i=e.center,r=-e.radius;for(let n=0;n<6;n++)if(t[n].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){let t=this.planes;for(let i=0;i<6;i++){let r=t[i];if(aA.x=r.normal.x>0?e.max.x:e.min.x,aA.y=r.normal.y>0?e.max.y:e.min.y,aA.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(aA)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function uq(){let e=null,t=!1,i=null,r=null;function n(s,a){i(s,a),r=e.requestAnimationFrame(n)}return{start:function(){t!==!0&&i!==null&&(r=e.requestAnimationFrame(n),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(s){i=s},setContext:function(s){e=s}}}function Wde(e,t){let i=t.isWebGL2,r=new WeakMap;function n(u,c){let h=u.array,d=u.usage,p=e.createBuffer();e.bindBuffer(c,p),e.bufferData(c,h,d),u.onUploadCallback();let m;if(h instanceof Float32Array)m=5126;else if(h instanceof Uint16Array)if(u.isFloat16BufferAttribute)if(i)m=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else m=5123;else if(h instanceof Int16Array)m=5122;else if(h instanceof Uint32Array)m=5125;else if(h instanceof Int32Array)m=5124;else if(h instanceof Int8Array)m=5120;else if(h instanceof Uint8Array)m=5121;else if(h instanceof Uint8ClampedArray)m=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:p,type:m,bytesPerElement:h.BYTES_PER_ELEMENT,version:u.version}}function s(u,c,h){let d=c.array,p=c.updateRange;e.bindBuffer(h,u),p.count===-1?e.bufferSubData(h,0,d):(i?e.bufferSubData(h,p.offset*d.BYTES_PER_ELEMENT,d,p.offset,p.count):e.bufferSubData(h,p.offset*d.BYTES_PER_ELEMENT,d.subarray(p.offset,p.offset+p.count)),p.count=-1),c.onUploadCallback()}function a(u){return u.isInterleavedBufferAttribute&&(u=u.data),r.get(u)}function o(u){u.isInterleavedBufferAttribute&&(u=u.data);let c=r.get(u);c&&(e.deleteBuffer(c.buffer),r.delete(u))}function l(u,c){if(u.isGLBufferAttribute){let d=r.get(u);(!d||d.version<u.version)&&r.set(u,{buffer:u.buffer,type:u.type,bytesPerElement:u.elementSize,version:u.version});return}u.isInterleavedBufferAttribute&&(u=u.data);let h=r.get(u);h===void 0?r.set(u,n(u,c)):h.version<u.version&&(s(h.buffer,u,c),h.version=u.version)}return{get:a,remove:o,update:l}}var Zc=class extends Kt{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};let n=e/2,s=t/2,a=Math.floor(i),o=Math.floor(r),l=a+1,u=o+1,c=e/a,h=t/o,d=[],p=[],m=[],v=[];for(let g=0;g<u;g++){let w=g*h-s;for(let S=0;S<l;S++){let _=S*c-n;p.push(_,-w,0),m.push(0,0,1),v.push(S/a),v.push(1-g/o)}}for(let g=0;g<o;g++)for(let w=0;w<a;w++){let S=w+l*g,_=w+l*(g+1),A=w+1+l*(g+1),C=w+1+l*g;d.push(S,_,C),d.push(_,A,C)}this.setIndex(d),this.setAttribute("position",new kt(p,3)),this.setAttribute("normal",new kt(m,3)),this.setAttribute("uv",new kt(v,2))}static fromJSON(e){return new Zc(e.width,e.height,e.widthSegments,e.heightSegments)}},Gde=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,qde=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Xde=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,Yde=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Qde=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,Kde=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Zde="vec3 transformed = vec3( position );",Jde=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,$de=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,efe=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,tfe=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,ife=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,rfe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,nfe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,sfe=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,afe=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,ofe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,lfe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,ufe=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,cfe=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,hfe=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,dfe=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,ffe=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,pfe=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,mfe=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,gfe=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,vfe="gl_FragColor = linearToOutputTexel( gl_FragColor );",yfe=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,xfe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,wfe=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,bfe=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,_fe=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Sfe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Mfe=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Afe=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Efe=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Cfe=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Tfe=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,Pfe=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,Dfe=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Rfe=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Ife=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,Lfe=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Ofe=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,zfe=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,kfe=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,Bfe=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Nfe=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,Ffe=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,Ufe=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Vfe=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,jfe=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Hfe=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,Wfe=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Gfe=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,qfe=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,Xfe=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,Yfe=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,Qfe=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,Kfe=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,Zfe=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Jfe=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,$fe=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,epe=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,tpe=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,ipe=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,rpe=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,npe=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,spe=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,ape=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,ope=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,lpe=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,upe=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,cpe=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,hpe=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,dpe=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,fpe=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,ppe=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,mpe=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,gpe=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,vpe=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,ype=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,xpe=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,wpe=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,bpe=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,_pe=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,Spe=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Mpe=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,Ape=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Epe=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Cpe=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,Tpe=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Ppe=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Dpe=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Rpe=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Ipe=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Lpe=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,Ope=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,zpe=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,kpe=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,Bpe=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,Npe=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,Fpe=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,Upe=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,Vpe=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,jpe=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,Hpe=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Wpe=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Gpe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,qpe=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Xpe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Ype=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Qpe=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,Kpe=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,Zpe=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,Jpe=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,$pe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,eme=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,tme=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,ime=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,rme=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,nme=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,sme=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,ame=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ome=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,lme=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ume=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,cme=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,hme=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,dme=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,fme=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,pme=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,mme=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,gme=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vme=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,yme=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,xme=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,wme=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,bme=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,_me=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Ii={alphamap_fragment:Gde,alphamap_pars_fragment:qde,alphatest_fragment:Xde,alphatest_pars_fragment:Yde,aomap_fragment:Qde,aomap_pars_fragment:Kde,begin_vertex:Zde,beginnormal_vertex:Jde,bsdfs:$de,iridescence_fragment:efe,bumpmap_pars_fragment:tfe,clipping_planes_fragment:ife,clipping_planes_pars_fragment:rfe,clipping_planes_pars_vertex:nfe,clipping_planes_vertex:sfe,color_fragment:afe,color_pars_fragment:ofe,color_pars_vertex:lfe,color_vertex:ufe,common:cfe,cube_uv_reflection_fragment:hfe,defaultnormal_vertex:dfe,displacementmap_pars_vertex:ffe,displacementmap_vertex:pfe,emissivemap_fragment:mfe,emissivemap_pars_fragment:gfe,encodings_fragment:vfe,encodings_pars_fragment:yfe,envmap_fragment:xfe,envmap_common_pars_fragment:wfe,envmap_pars_fragment:bfe,envmap_pars_vertex:_fe,envmap_physical_pars_fragment:Ofe,envmap_vertex:Sfe,fog_vertex:Mfe,fog_pars_vertex:Afe,fog_fragment:Efe,fog_pars_fragment:Cfe,gradientmap_pars_fragment:Tfe,lightmap_fragment:Pfe,lightmap_pars_fragment:Dfe,lights_lambert_fragment:Rfe,lights_lambert_pars_fragment:Ife,lights_pars_begin:Lfe,lights_toon_fragment:zfe,lights_toon_pars_fragment:kfe,lights_phong_fragment:Bfe,lights_phong_pars_fragment:Nfe,lights_physical_fragment:Ffe,lights_physical_pars_fragment:Ufe,lights_fragment_begin:Vfe,lights_fragment_maps:jfe,lights_fragment_end:Hfe,logdepthbuf_fragment:Wfe,logdepthbuf_pars_fragment:Gfe,logdepthbuf_pars_vertex:qfe,logdepthbuf_vertex:Xfe,map_fragment:Yfe,map_pars_fragment:Qfe,map_particle_fragment:Kfe,map_particle_pars_fragment:Zfe,metalnessmap_fragment:Jfe,metalnessmap_pars_fragment:$fe,morphcolor_vertex:epe,morphnormal_vertex:tpe,morphtarget_pars_vertex:ipe,morphtarget_vertex:rpe,normal_fragment_begin:npe,normal_fragment_maps:spe,normal_pars_fragment:ape,normal_pars_vertex:ope,normal_vertex:lpe,normalmap_pars_fragment:upe,clearcoat_normal_fragment_begin:cpe,clearcoat_normal_fragment_maps:hpe,clearcoat_pars_fragment:dpe,iridescence_pars_fragment:fpe,output_fragment:ppe,packing:mpe,premultiplied_alpha_fragment:gpe,project_vertex:vpe,dithering_fragment:ype,dithering_pars_fragment:xpe,roughnessmap_fragment:wpe,roughnessmap_pars_fragment:bpe,shadowmap_pars_fragment:_pe,shadowmap_pars_vertex:Spe,shadowmap_vertex:Mpe,shadowmask_pars_fragment:Ape,skinbase_vertex:Epe,skinning_pars_vertex:Cpe,skinning_vertex:Tpe,skinnormal_vertex:Ppe,specularmap_fragment:Dpe,specularmap_pars_fragment:Rpe,tonemapping_fragment:Ipe,tonemapping_pars_fragment:Lpe,transmission_fragment:Ope,transmission_pars_fragment:zpe,uv_pars_fragment:kpe,uv_pars_vertex:Bpe,uv_vertex:Npe,uv2_pars_fragment:Fpe,uv2_pars_vertex:Upe,uv2_vertex:Vpe,worldpos_vertex:jpe,background_vert:Hpe,background_frag:Wpe,backgroundCube_vert:Gpe,backgroundCube_frag:qpe,cube_vert:Xpe,cube_frag:Ype,depth_vert:Qpe,depth_frag:Kpe,distanceRGBA_vert:Zpe,distanceRGBA_frag:Jpe,equirect_vert:$pe,equirect_frag:eme,linedashed_vert:tme,linedashed_frag:ime,meshbasic_vert:rme,meshbasic_frag:nme,meshlambert_vert:sme,meshlambert_frag:ame,meshmatcap_vert:ome,meshmatcap_frag:lme,meshnormal_vert:ume,meshnormal_frag:cme,meshphong_vert:hme,meshphong_frag:dme,meshphysical_vert:fme,meshphysical_frag:pme,meshtoon_vert:mme,meshtoon_frag:gme,points_vert:vme,points_frag:yme,shadow_vert:xme,shadow_frag:wme,sprite_vert:bme,sprite_frag:_me},Dt={common:{diffuse:{value:new li(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new rs},uv2Transform:{value:new rs},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Pe(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new li(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new li(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new rs}},sprite:{diffuse:{value:new li(16777215)},opacity:{value:1},center:{value:new Pe(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new rs}}},Ic={basic:{uniforms:ro([Dt.common,Dt.specularmap,Dt.envmap,Dt.aomap,Dt.lightmap,Dt.fog]),vertexShader:Ii.meshbasic_vert,fragmentShader:Ii.meshbasic_frag},lambert:{uniforms:ro([Dt.common,Dt.specularmap,Dt.envmap,Dt.aomap,Dt.lightmap,Dt.emissivemap,Dt.bumpmap,Dt.normalmap,Dt.displacementmap,Dt.fog,Dt.lights,{emissive:{value:new li(0)}}]),vertexShader:Ii.meshlambert_vert,fragmentShader:Ii.meshlambert_frag},phong:{uniforms:ro([Dt.common,Dt.specularmap,Dt.envmap,Dt.aomap,Dt.lightmap,Dt.emissivemap,Dt.bumpmap,Dt.normalmap,Dt.displacementmap,Dt.fog,Dt.lights,{emissive:{value:new li(0)},specular:{value:new li(1118481)},shininess:{value:30}}]),vertexShader:Ii.meshphong_vert,fragmentShader:Ii.meshphong_frag},standard:{uniforms:ro([Dt.common,Dt.envmap,Dt.aomap,Dt.lightmap,Dt.emissivemap,Dt.bumpmap,Dt.normalmap,Dt.displacementmap,Dt.roughnessmap,Dt.metalnessmap,Dt.fog,Dt.lights,{emissive:{value:new li(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ii.meshphysical_vert,fragmentShader:Ii.meshphysical_frag},toon:{uniforms:ro([Dt.common,Dt.aomap,Dt.lightmap,Dt.emissivemap,Dt.bumpmap,Dt.normalmap,Dt.displacementmap,Dt.gradientmap,Dt.fog,Dt.lights,{emissive:{value:new li(0)}}]),vertexShader:Ii.meshtoon_vert,fragmentShader:Ii.meshtoon_frag},matcap:{uniforms:ro([Dt.common,Dt.bumpmap,Dt.normalmap,Dt.displacementmap,Dt.fog,{matcap:{value:null}}]),vertexShader:Ii.meshmatcap_vert,fragmentShader:Ii.meshmatcap_frag},points:{uniforms:ro([Dt.points,Dt.fog]),vertexShader:Ii.points_vert,fragmentShader:Ii.points_frag},dashed:{uniforms:ro([Dt.common,Dt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ii.linedashed_vert,fragmentShader:Ii.linedashed_frag},depth:{uniforms:ro([Dt.common,Dt.displacementmap]),vertexShader:Ii.depth_vert,fragmentShader:Ii.depth_frag},normal:{uniforms:ro([Dt.common,Dt.bumpmap,Dt.normalmap,Dt.displacementmap,{opacity:{value:1}}]),vertexShader:Ii.meshnormal_vert,fragmentShader:Ii.meshnormal_frag},sprite:{uniforms:ro([Dt.sprite,Dt.fog]),vertexShader:Ii.sprite_vert,fragmentShader:Ii.sprite_frag},background:{uniforms:{uvTransform:{value:new rs},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Ii.background_vert,fragmentShader:Ii.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Ii.backgroundCube_vert,fragmentShader:Ii.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ii.cube_vert,fragmentShader:Ii.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ii.equirect_vert,fragmentShader:Ii.equirect_frag},distanceRGBA:{uniforms:ro([Dt.common,Dt.displacementmap,{referencePosition:{value:new H},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ii.distanceRGBA_vert,fragmentShader:Ii.distanceRGBA_frag},shadow:{uniforms:ro([Dt.lights,Dt.fog,{color:{value:new li(0)},opacity:{value:1}}]),vertexShader:Ii.shadow_vert,fragmentShader:Ii.shadow_frag}};Ic.physical={uniforms:ro([Ic.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Pe(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new li(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Pe},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new li(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new li(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Ii.meshphysical_vert,fragmentShader:Ii.meshphysical_frag};var oA={r:0,b:0,g:0};function Sme(e,t,i,r,n,s,a){let o=new li(0),l=s===!0?0:1,u,c,h=null,d=0,p=null;function m(g,w){let S=!1,_=w.isScene===!0?w.background:null;_&&_.isTexture&&(_=(w.backgroundBlurriness>0?i:t).get(_));let A=e.xr,C=A.getSession&&A.getSession();C&&C.environmentBlendMode==="additive"&&(_=null),_===null?v(o,l):_&&_.isColor&&(v(_,1),S=!0),(e.autoClear||S)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),_&&(_.isCubeTexture||_.mapping===F_)?(c===void 0&&(c=new zr(new Wu(1,1,1),new Zi({name:"BackgroundCubeMaterial",uniforms:ax(Ic.backgroundCube.uniforms),vertexShader:Ic.backgroundCube.vertexShader,fragmentShader:Ic.backgroundCube.fragmentShader,side:Hs,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(E,I,T){this.matrixWorld.copyPosition(T.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(c)),c.material.uniforms.envMap.value=_,c.material.uniforms.flipEnvMap.value=_.isCubeTexture&&_.isRenderTargetTexture===!1?-1:1,c.material.uniforms.backgroundBlurriness.value=w.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=w.backgroundIntensity,c.material.toneMapped=_.encoding!==Ri,(h!==_||d!==_.version||p!==e.toneMapping)&&(c.material.needsUpdate=!0,h=_,d=_.version,p=e.toneMapping),c.layers.enableAll(),g.unshift(c,c.geometry,c.material,0,0,null)):_&&_.isTexture&&(u===void 0&&(u=new zr(new Zc(2,2),new Zi({name:"BackgroundMaterial",uniforms:ax(Ic.background.uniforms),vertexShader:Ic.background.vertexShader,fragmentShader:Ic.background.fragmentShader,side:ju,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(u)),u.material.uniforms.t2D.value=_,u.material.uniforms.backgroundIntensity.value=w.backgroundIntensity,u.material.toneMapped=_.encoding!==Ri,_.matrixAutoUpdate===!0&&_.updateMatrix(),u.material.uniforms.uvTransform.value.copy(_.matrix),(h!==_||d!==_.version||p!==e.toneMapping)&&(u.material.needsUpdate=!0,h=_,d=_.version,p=e.toneMapping),u.layers.enableAll(),g.unshift(u,u.geometry,u.material,0,0,null))}function v(g,w){g.getRGB(oA,lq(e)),r.buffers.color.setClear(oA.r,oA.g,oA.b,w,a)}return{getClearColor:function(){return o},setClearColor:function(g,w=1){o.set(g),l=w,v(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(g){l=g,v(o,l)},render:m}}function Mme(e,t,i,r){let n=e.getParameter(34921),s=r.isWebGL2?null:t.get("OES_vertex_array_object"),a=r.isWebGL2||s!==null,o={},l=g(null),u=l,c=!1;function h(j,J,ne,K,B){let Z=!1;if(a){let F=v(K,ne,J);u!==F&&(u=F,p(u.object)),Z=w(j,K,ne,B),Z&&S(j,K,ne,B)}else{let F=J.wireframe===!0;(u.geometry!==K.id||u.program!==ne.id||u.wireframe!==F)&&(u.geometry=K.id,u.program=ne.id,u.wireframe=F,Z=!0)}B!==null&&i.update(B,34963),(Z||c)&&(c=!1,T(j,J,ne,K),B!==null&&e.bindBuffer(34963,i.get(B).buffer))}function d(){return r.isWebGL2?e.createVertexArray():s.createVertexArrayOES()}function p(j){return r.isWebGL2?e.bindVertexArray(j):s.bindVertexArrayOES(j)}function m(j){return r.isWebGL2?e.deleteVertexArray(j):s.deleteVertexArrayOES(j)}function v(j,J,ne){let K=ne.wireframe===!0,B=o[j.id];B===void 0&&(B={},o[j.id]=B);let Z=B[J.id];Z===void 0&&(Z={},B[J.id]=Z);let F=Z[K];return F===void 0&&(F=g(d()),Z[K]=F),F}function g(j){let J=[],ne=[],K=[];for(let B=0;B<n;B++)J[B]=0,ne[B]=0,K[B]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:J,enabledAttributes:ne,attributeDivisors:K,object:j,attributes:{},index:null}}function w(j,J,ne,K){let B=u.attributes,Z=J.attributes,F=0,X=ne.getAttributes();for(let Y in X)if(X[Y].location>=0){let le=B[Y],oe=Z[Y];if(oe===void 0&&(Y==="instanceMatrix"&&j.instanceMatrix&&(oe=j.instanceMatrix),Y==="instanceColor"&&j.instanceColor&&(oe=j.instanceColor)),le===void 0||le.attribute!==oe||oe&&le.data!==oe.data)return!0;F++}return u.attributesNum!==F||u.index!==K}function S(j,J,ne,K){let B={},Z=J.attributes,F=0,X=ne.getAttributes();for(let Y in X)if(X[Y].location>=0){let le=Z[Y];le===void 0&&(Y==="instanceMatrix"&&j.instanceMatrix&&(le=j.instanceMatrix),Y==="instanceColor"&&j.instanceColor&&(le=j.instanceColor));let oe={};oe.attribute=le,le&&le.data&&(oe.data=le.data),B[Y]=oe,F++}u.attributes=B,u.attributesNum=F,u.index=K}function _(){let j=u.newAttributes;for(let J=0,ne=j.length;J<ne;J++)j[J]=0}function A(j){C(j,0)}function C(j,J){let ne=u.newAttributes,K=u.enabledAttributes,B=u.attributeDivisors;ne[j]=1,K[j]===0&&(e.enableVertexAttribArray(j),K[j]=1),B[j]!==J&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](j,J),B[j]=J)}function E(){let j=u.newAttributes,J=u.enabledAttributes;for(let ne=0,K=J.length;ne<K;ne++)J[ne]!==j[ne]&&(e.disableVertexAttribArray(ne),J[ne]=0)}function I(j,J,ne,K,B,Z){r.isWebGL2===!0&&(ne===5124||ne===5125)?e.vertexAttribIPointer(j,J,ne,B,Z):e.vertexAttribPointer(j,J,ne,K,B,Z)}function T(j,J,ne,K){if(r.isWebGL2===!1&&(j.isInstancedMesh||K.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;_();let B=K.attributes,Z=ne.getAttributes(),F=J.defaultAttributeValues;for(let X in Z){let Y=Z[X];if(Y.location>=0){let le=B[X];if(le===void 0&&(X==="instanceMatrix"&&j.instanceMatrix&&(le=j.instanceMatrix),X==="instanceColor"&&j.instanceColor&&(le=j.instanceColor)),le!==void 0){let oe=le.normalized,re=le.itemSize,ue=i.get(le);if(ue===void 0)continue;let me=ue.buffer,he=ue.type,Ce=ue.bytesPerElement;if(le.isInterleavedBufferAttribute){let Ae=le.data,Ie=Ae.stride,Me=le.offset;if(Ae.isInstancedInterleavedBuffer){for(let De=0;De<Y.locationSize;De++)C(Y.location+De,Ae.meshPerAttribute);j.isInstancedMesh!==!0&&K._maxInstanceCount===void 0&&(K._maxInstanceCount=Ae.meshPerAttribute*Ae.count)}else for(let De=0;De<Y.locationSize;De++)A(Y.location+De);e.bindBuffer(34962,me);for(let De=0;De<Y.locationSize;De++)I(Y.location+De,re/Y.locationSize,he,oe,Ie*Ce,(Me+re/Y.locationSize*De)*Ce)}else{if(le.isInstancedBufferAttribute){for(let Ae=0;Ae<Y.locationSize;Ae++)C(Y.location+Ae,le.meshPerAttribute);j.isInstancedMesh!==!0&&K._maxInstanceCount===void 0&&(K._maxInstanceCount=le.meshPerAttribute*le.count)}else for(let Ae=0;Ae<Y.locationSize;Ae++)A(Y.location+Ae);e.bindBuffer(34962,me);for(let Ae=0;Ae<Y.locationSize;Ae++)I(Y.location+Ae,re/Y.locationSize,he,oe,re*Ce,re/Y.locationSize*Ae*Ce)}}else if(F!==void 0){let oe=F[X];if(oe!==void 0)switch(oe.length){case 2:e.vertexAttrib2fv(Y.location,oe);break;case 3:e.vertexAttrib3fv(Y.location,oe);break;case 4:e.vertexAttrib4fv(Y.location,oe);break;default:e.vertexAttrib1fv(Y.location,oe)}}}}E()}function D(){G();for(let j in o){let J=o[j];for(let ne in J){let K=J[ne];for(let B in K)m(K[B].object),delete K[B];delete J[ne]}delete o[j]}}function L(j){if(o[j.id]===void 0)return;let J=o[j.id];for(let ne in J){let K=J[ne];for(let B in K)m(K[B].object),delete K[B];delete J[ne]}delete o[j.id]}function z(j){for(let J in o){let ne=o[J];if(ne[j.id]===void 0)continue;let K=ne[j.id];for(let B in K)m(K[B].object),delete K[B];delete ne[j.id]}}function G(){V(),c=!0,u!==l&&(u=l,p(u.object))}function V(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:h,reset:G,resetDefaultState:V,dispose:D,releaseStatesOfGeometry:L,releaseStatesOfProgram:z,initAttributes:_,enableAttribute:A,disableUnusedAttributes:E}}function Ame(e,t,i,r){let n=r.isWebGL2,s;function a(u){s=u}function o(u,c){e.drawArrays(s,u,c),i.update(c,s,1)}function l(u,c,h){if(h===0)return;let d,p;if(n)d=e,p="drawArraysInstanced";else if(d=t.get("ANGLE_instanced_arrays"),p="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[p](s,u,c,h),i.update(c,s,h)}this.setMode=a,this.render=o,this.renderInstances=l}function Eme(e,t,i){let r;function n(){if(r!==void 0)return r;if(t.has("EXT_texture_filter_anisotropic")===!0){let I=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(I.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function s(I){if(I==="highp"){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";I="mediump"}return I==="mediump"&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let a=typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext,o=i.precision!==void 0?i.precision:"highp",l=s(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);let u=a||t.has("WEBGL_draw_buffers"),c=i.logarithmicDepthBuffer===!0,h=e.getParameter(34930),d=e.getParameter(35660),p=e.getParameter(3379),m=e.getParameter(34076),v=e.getParameter(34921),g=e.getParameter(36347),w=e.getParameter(36348),S=e.getParameter(36349),_=d>0,A=a||t.has("OES_texture_float"),C=_&&A,E=a?e.getParameter(36183):0;return{isWebGL2:a,drawBuffers:u,getMaxAnisotropy:n,getMaxPrecision:s,precision:o,logarithmicDepthBuffer:c,maxTextures:h,maxVertexTextures:d,maxTextureSize:p,maxCubemapSize:m,maxAttributes:v,maxVertexUniforms:g,maxVaryings:w,maxFragmentUniforms:S,vertexTextures:_,floatFragmentTextures:A,floatVertexTextures:C,maxSamples:E}}function Cme(e){let t=this,i=null,r=0,n=!1,s=!1,a=new Oo,o=new rs,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){let p=h.length!==0||d||r!==0||n;return n=d,r=h.length,p},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){i=c(h,d,0)},this.setState=function(h,d,p){let m=h.clippingPlanes,v=h.clipIntersection,g=h.clipShadows,w=e.get(h);if(!n||m===null||m.length===0||s&&!g)s?c(null):u();else{let S=s?0:r,_=S*4,A=w.clippingState||null;l.value=A,A=c(m,d,_,p);for(let C=0;C!==_;++C)A[C]=i[C];w.clippingState=A,this.numIntersection=v?this.numPlanes:0,this.numPlanes+=S}};function u(){l.value!==i&&(l.value=i,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function c(h,d,p,m){let v=h!==null?h.length:0,g=null;if(v!==0){if(g=l.value,m!==!0||g===null){let w=p+v*4,S=d.matrixWorldInverse;o.getNormalMatrix(S),(g===null||g.length<w)&&(g=new Float32Array(w));for(let _=0,A=p;_!==v;++_,A+=4)a.copy(h[_]).applyMatrix4(S,o),a.normal.toArray(g,A),g[A+3]=a.constant}l.value=g,l.needsUpdate=!0}return t.numPlanes=v,t.numIntersection=0,g}}function Tme(e){let t=new WeakMap;function i(a,o){return o===_I?a.mapping=Hg:o===SI&&(a.mapping=Wg),a}function r(a){if(a&&a.isTexture&&a.isRenderTargetTexture===!1){let o=a.mapping;if(o===_I||o===SI)if(t.has(a)){let l=t.get(a).texture;return i(l,a.mapping)}else{let l=a.image;if(l&&l.height>0){let u=new Vde(l.height/2);return u.fromEquirectangularTexture(e,a),t.set(a,u),a.addEventListener("dispose",n),i(u.texture,a.mapping)}else return null}}return a}function n(a){let o=a.target;o.removeEventListener("dispose",n);let l=t.get(o);l!==void 0&&(t.delete(o),l.dispose())}function s(){t=new WeakMap}return{get:r,dispose:s}}var jC=class extends Wp{constructor(e=-1,t=1,i=1,r=-1,n=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=n,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,n,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,n=i-e,s=i+e,a=r+t,o=r-t;if(this.view!==null&&this.view.enabled){let l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=l*this.view.offsetX,s=n+l*this.view.width,a-=u*this.view.offsetY,o=a-u*this.view.height}this.projectionMatrix.makeOrthographic(n,s,a,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}},Py=4,i5=[.125,.215,.35,.446,.526,.582],rg=20,L3=new jC,r5=new li,O3=null,Qm=(1+Math.sqrt(5))/2,G0=1/Qm,n5=[new H(1,1,1),new H(-1,1,1),new H(1,1,-1),new H(-1,1,-1),new H(0,Qm,G0),new H(0,Qm,-G0),new H(G0,0,Qm),new H(-G0,0,Qm),new H(Qm,G0,0),new H(-Qm,G0,0)],s5=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){O3=this._renderer.getRenderTarget(),this._setSize(256);let n=this._allocateTargets();return n.depthBuffer=!0,this._sceneToCubeUV(e,i,r,n),t>0&&this._blur(n,0,0,t),this._applyPMREM(n),this._cleanup(n),n}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=l5(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=o5(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(O3),e.scissorTest=!1,lA(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Hg||e.mapping===Wg?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),O3=this._renderer.getRenderTarget();let i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:Li,minFilter:Li,generateMipmaps:!1,type:Pd,format:$r,encoding:Hu,depthBuffer:!1},r=a5(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=a5(e,t,i);let{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Pme(n)),this._blurMaterial=Dme(n,e,t)}return r}_compileMaterial(e){let t=new zr(this._lodPlanes[0],e);this._renderer.compile(t,L3)}_sceneToCubeUV(e,t,i,r){let n=new La(90,1,t,i),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,u=o.toneMapping;o.getClearColor(r5),o.toneMapping=Wc,o.autoClear=!1;let c=new Dd({name:"PMREM.Background",side:Hs,depthWrite:!1,depthTest:!1}),h=new zr(new Wu,c),d=!1,p=e.background;p?p.isColor&&(c.color.copy(p),e.background=null,d=!0):(c.color.copy(r5),d=!0);for(let m=0;m<6;m++){let v=m%3;v===0?(n.up.set(0,s[m],0),n.lookAt(a[m],0,0)):v===1?(n.up.set(0,0,s[m]),n.lookAt(0,a[m],0)):(n.up.set(0,s[m],0),n.lookAt(0,0,a[m]));let g=this._cubeSize;lA(r,v*g,m>2?g:0,g,g),o.setRenderTarget(r),d&&o.render(h,n),o.render(e,n)}h.geometry.dispose(),h.material.dispose(),o.toneMapping=u,o.autoClear=l,e.background=p}_textureToCubeUV(e,t){let i=this._renderer,r=e.mapping===Hg||e.mapping===Wg;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=l5()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=o5());let n=r?this._cubemapMaterial:this._equirectMaterial,s=new zr(this._lodPlanes[0],n),a=n.uniforms;a.envMap.value=e;let o=this._cubeSize;lA(t,0,0,3*o,2*o),i.setRenderTarget(t),i.render(s,L3)}_applyPMREM(e){let t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){let n=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),s=n5[(r-1)%n5.length];this._blur(e,r-1,r,n,s)}t.autoClear=i}_blur(e,t,i,r,n){let s=this._pingPongRenderTarget;this._halfBlur(e,s,t,i,r,"latitudinal",n),this._halfBlur(s,e,i,i,r,"longitudinal",n)}_halfBlur(e,t,i,r,n,s,a){let o=this._renderer,l=this._blurMaterial;s!=="latitudinal"&&s!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let u=3,c=new zr(this._lodPlanes[r],l),h=l.uniforms,d=this._sizeLods[i]-1,p=isFinite(n)?Math.PI/(2*d):2*Math.PI/(2*rg-1),m=n/p,v=isFinite(n)?1+Math.floor(u*m):rg;v>rg&&console.warn(`sigmaRadians, ${n}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${rg}`);let g=[],w=0;for(let E=0;E<rg;++E){let I=E/m,T=Math.exp(-I*I/2);g.push(T),E===0?w+=T:E<v&&(w+=2*T)}for(let E=0;E<g.length;E++)g[E]=g[E]/w;h.envMap.value=e.texture,h.samples.value=v,h.weights.value=g,h.latitudinal.value=s==="latitudinal",a&&(h.poleAxis.value=a);let{_lodMax:S}=this;h.dTheta.value=p,h.mipInt.value=S-i;let _=this._sizeLods[r],A=3*_*(r>S-Py?r-S+Py:0),C=4*(this._cubeSize-_);lA(t,A,C,3*_,2*_),o.setRenderTarget(t),o.render(c,L3)}};function Pme(e){let t=[],i=[],r=[],n=e,s=e-Py+1+i5.length;for(let a=0;a<s;a++){let o=Math.pow(2,n);i.push(o);let l=1/o;a>e-Py?l=i5[a-e+Py-1]:a===0&&(l=0),r.push(l);let u=1/(o-2),c=-u,h=1+u,d=[c,c,h,c,h,h,c,c,h,h,c,h],p=6,m=6,v=3,g=2,w=1,S=new Float32Array(v*m*p),_=new Float32Array(g*m*p),A=new Float32Array(w*m*p);for(let E=0;E<p;E++){let I=E%3*2/3-1,T=E>2?0:-1,D=[I,T,0,I+2/3,T,0,I+2/3,T+1,0,I,T,0,I+2/3,T+1,0,I,T+1,0];S.set(D,v*m*E),_.set(d,g*m*E);let L=[E,E,E,E,E,E];A.set(L,w*m*E)}let C=new Kt;C.setAttribute("position",new hi(S,v)),C.setAttribute("uv",new hi(_,g)),C.setAttribute("faceIndex",new hi(A,w)),t.push(C),n>Py&&n--}return{lodPlanes:t,sizeLods:i,sigmas:r}}function a5(e,t,i){let r=new Ki(e,t,i);return r.texture.mapping=F_,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function lA(e,t,i,r,n){e.viewport.set(t,i,r,n),e.scissor.set(t,i,r,n)}function Dme(e,t,i){let r=new Float32Array(rg),n=new H(0,1,0);return new Zi({name:"SphericalGaussianBlur",defines:{n:rg,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:Jz(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:ns,depthTest:!1,depthWrite:!1})}function o5(){return new Zi({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Jz(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:ns,depthTest:!1,depthWrite:!1})}function l5(){return new Zi({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Jz(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:ns,depthTest:!1,depthWrite:!1})}function Jz(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Rme(e){let t=new WeakMap,i=null;function r(o){if(o&&o.isTexture){let l=o.mapping,u=l===_I||l===SI,c=l===Hg||l===Wg;if(u||c)if(o.isRenderTargetTexture&&o.needsPMREMUpdate===!0){o.needsPMREMUpdate=!1;let h=t.get(o);return i===null&&(i=new s5(e)),h=u?i.fromEquirectangular(o,h):i.fromCubemap(o,h),t.set(o,h),h.texture}else{if(t.has(o))return t.get(o).texture;{let h=o.image;if(u&&h&&h.height>0||c&&h&&n(h)){i===null&&(i=new s5(e));let d=u?i.fromEquirectangular(o):i.fromCubemap(o);return t.set(o,d),o.addEventListener("dispose",s),d.texture}else return null}}}return o}function n(o){let l=0,u=6;for(let c=0;c<u;c++)o[c]!==void 0&&l++;return l===u}function s(o){let l=o.target;l.removeEventListener("dispose",s);let u=t.get(l);u!==void 0&&(t.delete(l),u.dispose())}function a(){t=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:r,dispose:a}}function Ime(e){let t={};function i(r){if(t[r]!==void 0)return t[r];let n;switch(r){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(r)}return t[r]=n,n}return{has:function(r){return i(r)!==null},init:function(r){r.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(r){let n=i(r);return n===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),n}}}function Lme(e,t,i,r){let n={},s=new WeakMap;function a(h){let d=h.target;d.index!==null&&t.remove(d.index);for(let m in d.attributes)t.remove(d.attributes[m]);d.removeEventListener("dispose",a),delete n[d.id];let p=s.get(d);p&&(t.remove(p),s.delete(d)),r.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,i.memory.geometries--}function o(h,d){return n[d.id]===!0||(d.addEventListener("dispose",a),n[d.id]=!0,i.memory.geometries++),d}function l(h){let d=h.attributes;for(let m in d)t.update(d[m],34962);let p=h.morphAttributes;for(let m in p){let v=p[m];for(let g=0,w=v.length;g<w;g++)t.update(v[g],34962)}}function u(h){let d=[],p=h.index,m=h.attributes.position,v=0;if(p!==null){let S=p.array;v=p.version;for(let _=0,A=S.length;_<A;_+=3){let C=S[_+0],E=S[_+1],I=S[_+2];d.push(C,E,E,I,I,C)}}else{let S=m.array;v=m.version;for(let _=0,A=S.length/3-1;_<A;_+=3){let C=_+0,E=_+1,I=_+2;d.push(C,E,E,I,I,C)}}let g=new(tq(d)?Vy:oq)(d,1);g.version=v;let w=s.get(h);w&&t.remove(w),s.set(h,g)}function c(h){let d=s.get(h);if(d){let p=h.index;p!==null&&d.version<p.version&&u(h)}else u(h);return s.get(h)}return{get:o,update:l,getWireframeAttribute:c}}function Ome(e,t,i,r){let n=r.isWebGL2,s;function a(d){s=d}let o,l;function u(d){o=d.type,l=d.bytesPerElement}function c(d,p){e.drawElements(s,p,o,d*l),i.update(p,s,1)}function h(d,p,m){if(m===0)return;let v,g;if(n)v=e,g="drawElementsInstanced";else if(v=t.get("ANGLE_instanced_arrays"),g="drawElementsInstancedANGLE",v===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}v[g](s,p,o,d*l,m),i.update(p,s,m)}this.setMode=a,this.setIndex=u,this.render=c,this.renderInstances=h}function zme(e){let t={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,a,o){switch(i.calls++,a){case 4:i.triangles+=o*(s/3);break;case 1:i.lines+=o*(s/2);break;case 3:i.lines+=o*(s-1);break;case 2:i.lines+=o*s;break;case 0:i.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function n(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:t,render:i,programs:null,autoReset:!0,reset:n,update:r}}function kme(e,t){return e[0]-t[0]}function Bme(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Nme(e,t,i){let r={},n=new Float32Array(8),s=new WeakMap,a=new bi,o=[];for(let u=0;u<8;u++)o[u]=[u,0];function l(u,c,h,d){let p=u.morphTargetInfluences;if(t.isWebGL2===!0){let m=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,v=m!==void 0?m.length:0,g=s.get(c);if(g===void 0||g.count!==v){let _=function(){j.dispose(),s.delete(c),c.removeEventListener("dispose",_)};g!==void 0&&g.texture.dispose();let A=c.morphAttributes.position!==void 0,C=c.morphAttributes.normal!==void 0,E=c.morphAttributes.color!==void 0,I=c.morphAttributes.position||[],T=c.morphAttributes.normal||[],D=c.morphAttributes.color||[],L=0;A===!0&&(L=1),C===!0&&(L=2),E===!0&&(L=3);let z=c.attributes.position.count*L,G=1;z>t.maxTextureSize&&(G=Math.ceil(z/t.maxTextureSize),z=t.maxTextureSize);let V=new Float32Array(z*G*4*v),j=new sq(V,z,G,v);j.type=br,j.needsUpdate=!0;let J=L*4;for(let ne=0;ne<v;ne++){let K=I[ne],B=T[ne],Z=D[ne],F=z*G*4*ne;for(let X=0;X<K.count;X++){let Y=X*J;A===!0&&(a.fromBufferAttribute(K,X),V[F+Y+0]=a.x,V[F+Y+1]=a.y,V[F+Y+2]=a.z,V[F+Y+3]=0),C===!0&&(a.fromBufferAttribute(B,X),V[F+Y+4]=a.x,V[F+Y+5]=a.y,V[F+Y+6]=a.z,V[F+Y+7]=0),E===!0&&(a.fromBufferAttribute(Z,X),V[F+Y+8]=a.x,V[F+Y+9]=a.y,V[F+Y+10]=a.z,V[F+Y+11]=Z.itemSize===4?a.w:1)}}g={count:v,texture:j,size:new Pe(z,G)},s.set(c,g),c.addEventListener("dispose",_)}let w=0;for(let _=0;_<p.length;_++)w+=p[_];let S=c.morphTargetsRelative?1:1-w;d.getUniforms().setValue(e,"morphTargetBaseInfluence",S),d.getUniforms().setValue(e,"morphTargetInfluences",p),d.getUniforms().setValue(e,"morphTargetsTexture",g.texture,i),d.getUniforms().setValue(e,"morphTargetsTextureSize",g.size)}else{let m=p===void 0?0:p.length,v=r[c.id];if(v===void 0||v.length!==m){v=[];for(let A=0;A<m;A++)v[A]=[A,0];r[c.id]=v}for(let A=0;A<m;A++){let C=v[A];C[0]=A,C[1]=p[A]}v.sort(Bme);for(let A=0;A<8;A++)A<m&&v[A][1]?(o[A][0]=v[A][0],o[A][1]=v[A][1]):(o[A][0]=Number.MAX_SAFE_INTEGER,o[A][1]=0);o.sort(kme);let g=c.morphAttributes.position,w=c.morphAttributes.normal,S=0;for(let A=0;A<8;A++){let C=o[A],E=C[0],I=C[1];E!==Number.MAX_SAFE_INTEGER&&I?(g&&c.getAttribute("morphTarget"+A)!==g[E]&&c.setAttribute("morphTarget"+A,g[E]),w&&c.getAttribute("morphNormal"+A)!==w[E]&&c.setAttribute("morphNormal"+A,w[E]),n[A]=I,S+=I):(g&&c.hasAttribute("morphTarget"+A)===!0&&c.deleteAttribute("morphTarget"+A),w&&c.hasAttribute("morphNormal"+A)===!0&&c.deleteAttribute("morphNormal"+A),n[A]=0)}let _=c.morphTargetsRelative?1:1-S;d.getUniforms().setValue(e,"morphTargetBaseInfluence",_),d.getUniforms().setValue(e,"morphTargetInfluences",n)}}return{update:l}}function Fme(e,t,i,r){let n=new WeakMap;function s(l){let u=r.render.frame,c=l.geometry,h=t.get(l,c);return n.get(h)!==u&&(t.update(h),n.set(h,u)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),i.update(l.instanceMatrix,34962),l.instanceColor!==null&&i.update(l.instanceColor,34962)),h}function a(){n=new WeakMap}function o(l){let u=l.target;u.removeEventListener("dispose",o),i.remove(u.instanceMatrix),u.instanceColor!==null&&i.remove(u.instanceColor)}return{update:s,dispose:a}}var cq=new tn,hq=new sq,dq=new Ede,fq=new Kz,u5=[],c5=[],h5=new Float32Array(16),d5=new Float32Array(9),f5=new Float32Array(4);function Bx(e,t,i){let r=e[0];if(r==null||r<=0||r>0)return e;let n=t*i,s=u5[n];if(s===void 0&&(s=new Float32Array(n),u5[n]=s),t!==0){r.toArray(s,0);for(let a=1,o=0;a!==t;++a)o+=i,e[a].toArray(s,o)}return s}function Cs(e,t){if(e.length!==t.length)return!1;for(let i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}function Ts(e,t){for(let i=0,r=t.length;i<r;i++)e[i]=t[i]}function HC(e,t){let i=c5[t];i===void 0&&(i=new Int32Array(t),c5[t]=i);for(let r=0;r!==t;++r)i[r]=e.allocateTextureUnit();return i}function Ume(e,t){let i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function Vme(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Cs(i,t))return;e.uniform2fv(this.addr,t),Ts(i,t)}}function jme(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(t.r!==void 0)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(Cs(i,t))return;e.uniform3fv(this.addr,t),Ts(i,t)}}function Hme(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Cs(i,t))return;e.uniform4fv(this.addr,t),Ts(i,t)}}function Wme(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(Cs(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),Ts(i,t)}else{if(Cs(i,r))return;f5.set(r),e.uniformMatrix2fv(this.addr,!1,f5),Ts(i,r)}}function Gme(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(Cs(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),Ts(i,t)}else{if(Cs(i,r))return;d5.set(r),e.uniformMatrix3fv(this.addr,!1,d5),Ts(i,r)}}function qme(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(Cs(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),Ts(i,t)}else{if(Cs(i,r))return;h5.set(r),e.uniformMatrix4fv(this.addr,!1,h5),Ts(i,r)}}function Xme(e,t){let i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function Yme(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2i(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Cs(i,t))return;e.uniform2iv(this.addr,t),Ts(i,t)}}function Qme(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3i(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(Cs(i,t))return;e.uniform3iv(this.addr,t),Ts(i,t)}}function Kme(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Cs(i,t))return;e.uniform4iv(this.addr,t),Ts(i,t)}}function Zme(e,t){let i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function Jme(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2ui(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Cs(i,t))return;e.uniform2uiv(this.addr,t),Ts(i,t)}}function $me(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3ui(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(Cs(i,t))return;e.uniform3uiv(this.addr,t),Ts(i,t)}}function ege(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Cs(i,t))return;e.uniform4uiv(this.addr,t),Ts(i,t)}}function tge(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2D(t||cq,n)}function ige(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(t||dq,n)}function rge(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTextureCube(t||fq,n)}function nge(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(t||hq,n)}function sge(e){switch(e){case 5126:return Ume;case 35664:return Vme;case 35665:return jme;case 35666:return Hme;case 35674:return Wme;case 35675:return Gme;case 35676:return qme;case 5124:case 35670:return Xme;case 35667:case 35671:return Yme;case 35668:case 35672:return Qme;case 35669:case 35673:return Kme;case 5125:return Zme;case 36294:return Jme;case 36295:return $me;case 36296:return ege;case 35678:case 36198:case 36298:case 36306:case 35682:return tge;case 35679:case 36299:case 36307:return ige;case 35680:case 36300:case 36308:case 36293:return rge;case 36289:case 36303:case 36311:case 36292:return nge}}function age(e,t){e.uniform1fv(this.addr,t)}function oge(e,t){let i=Bx(t,this.size,2);e.uniform2fv(this.addr,i)}function lge(e,t){let i=Bx(t,this.size,3);e.uniform3fv(this.addr,i)}function uge(e,t){let i=Bx(t,this.size,4);e.uniform4fv(this.addr,i)}function cge(e,t){let i=Bx(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function hge(e,t){let i=Bx(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function dge(e,t){let i=Bx(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function fge(e,t){e.uniform1iv(this.addr,t)}function pge(e,t){e.uniform2iv(this.addr,t)}function mge(e,t){e.uniform3iv(this.addr,t)}function gge(e,t){e.uniform4iv(this.addr,t)}function vge(e,t){e.uniform1uiv(this.addr,t)}function yge(e,t){e.uniform2uiv(this.addr,t)}function xge(e,t){e.uniform3uiv(this.addr,t)}function wge(e,t){e.uniform4uiv(this.addr,t)}function bge(e,t,i){let r=this.cache,n=t.length,s=HC(i,n);Cs(r,s)||(e.uniform1iv(this.addr,s),Ts(r,s));for(let a=0;a!==n;++a)i.setTexture2D(t[a]||cq,s[a])}function _ge(e,t,i){let r=this.cache,n=t.length,s=HC(i,n);Cs(r,s)||(e.uniform1iv(this.addr,s),Ts(r,s));for(let a=0;a!==n;++a)i.setTexture3D(t[a]||dq,s[a])}function Sge(e,t,i){let r=this.cache,n=t.length,s=HC(i,n);Cs(r,s)||(e.uniform1iv(this.addr,s),Ts(r,s));for(let a=0;a!==n;++a)i.setTextureCube(t[a]||fq,s[a])}function Mge(e,t,i){let r=this.cache,n=t.length,s=HC(i,n);Cs(r,s)||(e.uniform1iv(this.addr,s),Ts(r,s));for(let a=0;a!==n;++a)i.setTexture2DArray(t[a]||hq,s[a])}function Age(e){switch(e){case 5126:return age;case 35664:return oge;case 35665:return lge;case 35666:return uge;case 35674:return cge;case 35675:return hge;case 35676:return dge;case 5124:case 35670:return fge;case 35667:case 35671:return pge;case 35668:case 35672:return mge;case 35669:case 35673:return gge;case 5125:return vge;case 36294:return yge;case 36295:return xge;case 36296:return wge;case 35678:case 36198:case 36298:case 36306:case 35682:return bge;case 35679:case 36299:case 36307:return _ge;case 35680:case 36300:case 36308:case 36293:return Sge;case 36289:case 36303:case 36311:case 36292:return Mge}}var Ege=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=sge(t.type)}},Cge=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=Age(t.type)}},Tge=class{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){if(t===void 0)return;let r=this.seq;for(let n=0,s=r.length;n!==s;++n){let a=r[n];a.setValue(e,t[a.id],i)}}},z3=/(\w+)(\])?(\[|\.)?/g;function p5(e,t){e.seq.push(t),e.map[t.id]=t}function Pge(e,t,i){let r=e.name,n=r.length;for(z3.lastIndex=0;;){let s=z3.exec(r),a=z3.lastIndex,o=s[1],l=s[2]==="]",u=s[3];if(l&&(o=o|0),u===void 0||u==="["&&a+2===n){p5(i,u===void 0?new Ege(o,e,t):new Cge(o,e,t));break}else{let c=i.map[o];c===void 0&&(c=new Tge(o),p5(i,c)),i=c}}}var LE=class{constructor(e,t){this.seq=[],this.map={};let i=e.getProgramParameter(t,35718);for(let r=0;r<i;++r){let n=e.getActiveUniform(t,r),s=e.getUniformLocation(t,n.name);Pge(n,s,this)}}setValue(e,t,i,r){let n=this.map[t];n!==void 0&&n.setValue(e,i,r)}setOptional(e,t,i){let r=t[i];r!==void 0&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let n=0,s=t.length;n!==s;++n){let a=t[n],o=i[a.id];o.needsUpdate!==!1&&a.setValue(e,o.value,r)}}static seqWithValue(e,t){let i=[];for(let r=0,n=e.length;r!==n;++r){let s=e[r];s.id in t&&i.push(s)}return i}};function m5(e,t,i){let r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),r}var Dge=0;function Rge(e,t){let i=e.split(`
`),r=[],n=Math.max(t-6,0),s=Math.min(t+6,i.length);for(let a=n;a<s;a++){let o=a+1;r.push(`${o===t?">":" "} ${o}: ${i[a]}`)}return r.join(`
`)}function Ige(e){switch(e){case Hu:return["Linear","( value )"];case Ri:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function g5(e,t,i){let r=e.getShaderParameter(t,35713),n=e.getShaderInfoLog(t).trim();if(r&&n==="")return"";let s=/ERROR: 0:(\d+)/.exec(n);if(s){let a=parseInt(s[1]);return i.toUpperCase()+`

`+n+`

`+Rge(e.getShaderSource(t),a)}else return n}function Lge(e,t){let i=Ige(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function Oge(e,t){let i;switch(t){case Vhe:i="Linear";break;case jhe:i="Reinhard";break;case Hhe:i="OptimizedCineon";break;case Whe:i="ACESFilmic";break;case Ghe:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function zge(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||e.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Vw).join(`
`)}function kge(e){let t=[];for(let i in e){let r=e[i];r!==!1&&t.push("#define "+i+" "+r)}return t.join(`
`)}function Bge(e,t){let i={},r=e.getProgramParameter(t,35721);for(let n=0;n<r;n++){let s=e.getActiveAttrib(t,n),a=s.name,o=1;s.type===35674&&(o=2),s.type===35675&&(o=3),s.type===35676&&(o=4),i[a]={type:s.type,location:e.getAttribLocation(t,a),locationSize:o}}return i}function Vw(e){return e!==""}function v5(e,t){let i=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function y5(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var Nge=/^[ \t]*#include +<([\w\d./]+)>/gm;function PI(e){return e.replace(Nge,Fge)}function Fge(e,t){let i=Ii[t];if(i===void 0)throw new Error("Can not resolve #include <"+t+">");return PI(i)}var Uge=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function x5(e){return e.replace(Uge,Vge)}function Vge(e,t,i,r){let n="";for(let s=parseInt(t);s<parseInt(i);s++)n+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return n}function w5(e){let t="precision "+e.precision+` float;
precision `+e.precision+" int;";return e.precision==="highp"?t+=`
#define HIGH_PRECISION`:e.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:e.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function jge(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===Gz?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===xhe?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===Uw&&(t="SHADOWMAP_TYPE_VSM"),t}function Hge(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case Hg:case Wg:t="ENVMAP_TYPE_CUBE";break;case F_:t="ENVMAP_TYPE_CUBE_UV";break}return t}function Wge(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case Wg:t="ENVMAP_MODE_REFRACTION";break}return t}function Gge(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case X7:t="ENVMAP_BLENDING_MULTIPLY";break;case Fhe:t="ENVMAP_BLENDING_MIX";break;case Uhe:t="ENVMAP_BLENDING_ADD";break}return t}function qge(e){let t=e.envMapCubeUVHeight;if(t===null)return null;let i=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:r,maxMip:i}}function Xge(e,t,i,r){let n=e.getContext(),s=i.defines,a=i.vertexShader,o=i.fragmentShader,l=jge(i),u=Hge(i),c=Wge(i),h=Gge(i),d=qge(i),p=i.isWebGL2?"":zge(i),m=kge(s),v=n.createProgram(),g,w,S=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(g=[m].filter(Vw).join(`
`),g.length>0&&(g+=`
`),w=[p,m].filter(Vw).join(`
`),w.length>0&&(w+=`
`)):(g=[w5(i),"#define SHADER_NAME "+i.shaderName,m,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Vw).join(`
`),w=[p,w5(i),"#define SHADER_NAME "+i.shaderName,m,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.envMap?"#define "+c:"",i.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Wc?"#define TONE_MAPPING":"",i.toneMapping!==Wc?Ii.tonemapping_pars_fragment:"",i.toneMapping!==Wc?Oge("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",Ii.encodings_pars_fragment,Lge("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(Vw).join(`
`)),a=PI(a),a=v5(a,i),a=y5(a,i),o=PI(o),o=v5(o,i),o=y5(o,i),a=x5(a),o=x5(o),i.isWebGL2&&i.isRawShaderMaterial!==!0&&(S=`#version 300 es
`,g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,w=["#define varying in",i.glslVersion===EI?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===EI?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+w);let _=S+g+a,A=S+w+o,C=m5(n,35633,_),E=m5(n,35632,A);if(n.attachShader(v,C),n.attachShader(v,E),i.index0AttributeName!==void 0?n.bindAttribLocation(v,0,i.index0AttributeName):i.morphTargets===!0&&n.bindAttribLocation(v,0,"position"),n.linkProgram(v),e.debug.checkShaderErrors){let D=n.getProgramInfoLog(v).trim(),L=n.getShaderInfoLog(C).trim(),z=n.getShaderInfoLog(E).trim(),G=!0,V=!0;if(n.getProgramParameter(v,35714)===!1){G=!1;let j=g5(n,C,"vertex"),J=g5(n,E,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(v,35715)+`

Program Info Log: `+D+`
`+j+`
`+J)}else D!==""?console.warn("THREE.WebGLProgram: Program Info Log:",D):(L===""||z==="")&&(V=!1);V&&(this.diagnostics={runnable:G,programLog:D,vertexShader:{log:L,prefix:g},fragmentShader:{log:z,prefix:w}})}n.deleteShader(C),n.deleteShader(E);let I;this.getUniforms=function(){return I===void 0&&(I=new LE(n,v)),I};let T;return this.getAttributes=function(){return T===void 0&&(T=Bge(n,v)),T},this.destroy=function(){r.releaseStatesOfProgram(this),n.deleteProgram(v),this.program=void 0},this.name=i.shaderName,this.id=Dge++,this.cacheKey=t,this.usedTimes=1,this.program=v,this.vertexShader=C,this.fragmentShader=E,this}var Yge=0,Qge=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let t=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(t),n=this._getShaderStage(i),s=this._getShaderCacheForMaterial(e);return s.has(r)===!1&&(s.add(r),r.usedTimes++),s.has(n)===!1&&(s.add(n),n.usedTimes++),this}remove(e){let t=this.materialCache.get(e);for(let i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let t=this.materialCache,i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){let t=this.shaderCache,i=t.get(e);return i===void 0&&(i=new Kge(e),t.set(e,i)),i}},Kge=class{constructor(e){this.id=Yge++,this.code=e,this.usedTimes=0}};function Zge(e,t,i,r,n,s,a){let o=new Qz,l=new Qge,u=[],c=n.isWebGL2,h=n.logarithmicDepthBuffer,d=n.vertexTextures,p=n.precision,m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function v(T,D,L,z,G){let V=z.fog,j=G.geometry,J=T.isMeshStandardMaterial?z.environment:null,ne=(T.isMeshStandardMaterial?i:t).get(T.envMap||J),K=ne&&ne.mapping===F_?ne.image.height:null,B=m[T.type];T.precision!==null&&(p=n.getMaxPrecision(T.precision),p!==T.precision&&console.warn("THREE.WebGLProgram.getParameters:",T.precision,"not supported, using",p,"instead."));let Z=j.morphAttributes.position||j.morphAttributes.normal||j.morphAttributes.color,F=Z!==void 0?Z.length:0,X=0;j.morphAttributes.position!==void 0&&(X=1),j.morphAttributes.normal!==void 0&&(X=2),j.morphAttributes.color!==void 0&&(X=3);let Y,le,oe,re;if(B){let Ae=Ic[B];Y=Ae.vertexShader,le=Ae.fragmentShader}else Y=T.vertexShader,le=T.fragmentShader,l.update(T),oe=l.getVertexShaderID(T),re=l.getFragmentShaderID(T);let ue=e.getRenderTarget(),me=T.alphaTest>0,he=T.clearcoat>0,Ce=T.iridescence>0;return{isWebGL2:c,shaderID:B,shaderName:T.type,vertexShader:Y,fragmentShader:le,defines:T.defines,customVertexShaderID:oe,customFragmentShaderID:re,isRawShaderMaterial:T.isRawShaderMaterial===!0,glslVersion:T.glslVersion,precision:p,instancing:G.isInstancedMesh===!0,instancingColor:G.isInstancedMesh===!0&&G.instanceColor!==null,supportsVertexTextures:d,outputEncoding:ue===null?e.outputEncoding:ue.isXRRenderTarget===!0?ue.texture.encoding:Hu,map:!!T.map,matcap:!!T.matcap,envMap:!!ne,envMapMode:ne&&ne.mapping,envMapCubeUVHeight:K,lightMap:!!T.lightMap,aoMap:!!T.aoMap,emissiveMap:!!T.emissiveMap,bumpMap:!!T.bumpMap,normalMap:!!T.normalMap,objectSpaceNormalMap:T.normalMapType===ode,tangentSpaceNormalMap:T.normalMapType===ade,decodeVideoTexture:!!T.map&&T.map.isVideoTexture===!0&&T.map.encoding===Ri,clearcoat:he,clearcoatMap:he&&!!T.clearcoatMap,clearcoatRoughnessMap:he&&!!T.clearcoatRoughnessMap,clearcoatNormalMap:he&&!!T.clearcoatNormalMap,iridescence:Ce,iridescenceMap:Ce&&!!T.iridescenceMap,iridescenceThicknessMap:Ce&&!!T.iridescenceThicknessMap,displacementMap:!!T.displacementMap,roughnessMap:!!T.roughnessMap,metalnessMap:!!T.metalnessMap,specularMap:!!T.specularMap,specularIntensityMap:!!T.specularIntensityMap,specularColorMap:!!T.specularColorMap,opaque:T.transparent===!1&&T.blending===Pg,alphaMap:!!T.alphaMap,alphaTest:me,gradientMap:!!T.gradientMap,sheen:T.sheen>0,sheenColorMap:!!T.sheenColorMap,sheenRoughnessMap:!!T.sheenRoughnessMap,transmission:T.transmission>0,transmissionMap:!!T.transmissionMap,thicknessMap:!!T.thicknessMap,combine:T.combine,vertexTangents:!!T.normalMap&&!!j.attributes.tangent,vertexColors:T.vertexColors,vertexAlphas:T.vertexColors===!0&&!!j.attributes.color&&j.attributes.color.itemSize===4,vertexUvs:!!T.map||!!T.bumpMap||!!T.normalMap||!!T.specularMap||!!T.alphaMap||!!T.emissiveMap||!!T.roughnessMap||!!T.metalnessMap||!!T.clearcoatMap||!!T.clearcoatRoughnessMap||!!T.clearcoatNormalMap||!!T.iridescenceMap||!!T.iridescenceThicknessMap||!!T.displacementMap||!!T.transmissionMap||!!T.thicknessMap||!!T.specularIntensityMap||!!T.specularColorMap||!!T.sheenColorMap||!!T.sheenRoughnessMap,uvsVertexOnly:!(T.map||T.bumpMap||T.normalMap||T.specularMap||T.alphaMap||T.emissiveMap||T.roughnessMap||T.metalnessMap||T.clearcoatNormalMap||T.iridescenceMap||T.iridescenceThicknessMap||T.transmission>0||T.transmissionMap||T.thicknessMap||T.specularIntensityMap||T.specularColorMap||T.sheen>0||T.sheenColorMap||T.sheenRoughnessMap)&&!!T.displacementMap,fog:!!V,useFog:T.fog===!0,fogExp2:V&&V.isFogExp2,flatShading:!!T.flatShading,sizeAttenuation:T.sizeAttenuation,logarithmicDepthBuffer:h,skinning:G.isSkinnedMesh===!0,morphTargets:j.morphAttributes.position!==void 0,morphNormals:j.morphAttributes.normal!==void 0,morphColors:j.morphAttributes.color!==void 0,morphTargetsCount:F,morphTextureStride:X,numDirLights:D.directional.length,numPointLights:D.point.length,numSpotLights:D.spot.length,numSpotLightMaps:D.spotLightMap.length,numRectAreaLights:D.rectArea.length,numHemiLights:D.hemi.length,numDirLightShadows:D.directionalShadowMap.length,numPointLightShadows:D.pointShadowMap.length,numSpotLightShadows:D.spotShadowMap.length,numSpotLightShadowsWithMaps:D.numSpotLightShadowsWithMaps,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:T.dithering,shadowMapEnabled:e.shadowMap.enabled&&L.length>0,shadowMapType:e.shadowMap.type,toneMapping:T.toneMapped?e.toneMapping:Wc,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:T.premultipliedAlpha,doubleSided:T.side===Ba,flipSided:T.side===Hs,useDepthPacking:!!T.depthPacking,depthPacking:T.depthPacking||0,index0AttributeName:T.index0AttributeName,extensionDerivatives:T.extensions&&T.extensions.derivatives,extensionFragDepth:T.extensions&&T.extensions.fragDepth,extensionDrawBuffers:T.extensions&&T.extensions.drawBuffers,extensionShaderTextureLOD:T.extensions&&T.extensions.shaderTextureLOD,rendererExtensionFragDepth:c||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:c||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:c||r.has("EXT_shader_texture_lod"),customProgramCacheKey:T.customProgramCacheKey()}}function g(T){let D=[];if(T.shaderID?D.push(T.shaderID):(D.push(T.customVertexShaderID),D.push(T.customFragmentShaderID)),T.defines!==void 0)for(let L in T.defines)D.push(L),D.push(T.defines[L]);return T.isRawShaderMaterial===!1&&(w(D,T),S(D,T),D.push(e.outputEncoding)),D.push(T.customProgramCacheKey),D.join()}function w(T,D){T.push(D.precision),T.push(D.outputEncoding),T.push(D.envMapMode),T.push(D.envMapCubeUVHeight),T.push(D.combine),T.push(D.vertexUvs),T.push(D.fogExp2),T.push(D.sizeAttenuation),T.push(D.morphTargetsCount),T.push(D.morphAttributeCount),T.push(D.numDirLights),T.push(D.numPointLights),T.push(D.numSpotLights),T.push(D.numSpotLightMaps),T.push(D.numHemiLights),T.push(D.numRectAreaLights),T.push(D.numDirLightShadows),T.push(D.numPointLightShadows),T.push(D.numSpotLightShadows),T.push(D.numSpotLightShadowsWithMaps),T.push(D.shadowMapType),T.push(D.toneMapping),T.push(D.numClippingPlanes),T.push(D.numClipIntersection),T.push(D.depthPacking)}function S(T,D){o.disableAll(),D.isWebGL2&&o.enable(0),D.supportsVertexTextures&&o.enable(1),D.instancing&&o.enable(2),D.instancingColor&&o.enable(3),D.map&&o.enable(4),D.matcap&&o.enable(5),D.envMap&&o.enable(6),D.lightMap&&o.enable(7),D.aoMap&&o.enable(8),D.emissiveMap&&o.enable(9),D.bumpMap&&o.enable(10),D.normalMap&&o.enable(11),D.objectSpaceNormalMap&&o.enable(12),D.tangentSpaceNormalMap&&o.enable(13),D.clearcoat&&o.enable(14),D.clearcoatMap&&o.enable(15),D.clearcoatRoughnessMap&&o.enable(16),D.clearcoatNormalMap&&o.enable(17),D.iridescence&&o.enable(18),D.iridescenceMap&&o.enable(19),D.iridescenceThicknessMap&&o.enable(20),D.displacementMap&&o.enable(21),D.specularMap&&o.enable(22),D.roughnessMap&&o.enable(23),D.metalnessMap&&o.enable(24),D.gradientMap&&o.enable(25),D.alphaMap&&o.enable(26),D.alphaTest&&o.enable(27),D.vertexColors&&o.enable(28),D.vertexAlphas&&o.enable(29),D.vertexUvs&&o.enable(30),D.vertexTangents&&o.enable(31),D.uvsVertexOnly&&o.enable(32),T.push(o.mask),o.disableAll(),D.fog&&o.enable(0),D.useFog&&o.enable(1),D.flatShading&&o.enable(2),D.logarithmicDepthBuffer&&o.enable(3),D.skinning&&o.enable(4),D.morphTargets&&o.enable(5),D.morphNormals&&o.enable(6),D.morphColors&&o.enable(7),D.premultipliedAlpha&&o.enable(8),D.shadowMapEnabled&&o.enable(9),D.physicallyCorrectLights&&o.enable(10),D.doubleSided&&o.enable(11),D.flipSided&&o.enable(12),D.useDepthPacking&&o.enable(13),D.dithering&&o.enable(14),D.specularIntensityMap&&o.enable(15),D.specularColorMap&&o.enable(16),D.transmission&&o.enable(17),D.transmissionMap&&o.enable(18),D.thicknessMap&&o.enable(19),D.sheen&&o.enable(20),D.sheenColorMap&&o.enable(21),D.sheenRoughnessMap&&o.enable(22),D.decodeVideoTexture&&o.enable(23),D.opaque&&o.enable(24),T.push(o.mask)}function _(T){let D=m[T.type],L;if(D){let z=Ic[D];L=kx.clone(z.uniforms)}else L=T.uniforms;return L}function A(T,D){let L;for(let z=0,G=u.length;z<G;z++){let V=u[z];if(V.cacheKey===D){L=V,++L.usedTimes;break}}return L===void 0&&(L=new Xge(e,D,T,s),u.push(L)),L}function C(T){if(--T.usedTimes===0){let D=u.indexOf(T);u[D]=u[u.length-1],u.pop(),T.destroy()}}function E(T){l.remove(T)}function I(){l.dispose()}return{getParameters:v,getProgramCacheKey:g,getUniforms:_,acquireProgram:A,releaseProgram:C,releaseShaderCache:E,programs:u,dispose:I}}function Jge(){let e=new WeakMap;function t(s){let a=e.get(s);return a===void 0&&(a={},e.set(s,a)),a}function i(s){e.delete(s)}function r(s,a,o){e.get(s)[a]=o}function n(){e=new WeakMap}return{get:t,remove:i,update:r,dispose:n}}function $ge(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function b5(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function _5(){let e=[],t=0,i=[],r=[],n=[];function s(){t=0,i.length=0,r.length=0,n.length=0}function a(h,d,p,m,v,g){let w=e[t];return w===void 0?(w={id:h.id,object:h,geometry:d,material:p,groupOrder:m,renderOrder:h.renderOrder,z:v,group:g},e[t]=w):(w.id=h.id,w.object=h,w.geometry=d,w.material=p,w.groupOrder=m,w.renderOrder=h.renderOrder,w.z=v,w.group=g),t++,w}function o(h,d,p,m,v,g){let w=a(h,d,p,m,v,g);p.transmission>0?r.push(w):p.transparent===!0?n.push(w):i.push(w)}function l(h,d,p,m,v,g){let w=a(h,d,p,m,v,g);p.transmission>0?r.unshift(w):p.transparent===!0?n.unshift(w):i.unshift(w)}function u(h,d){i.length>1&&i.sort(h||$ge),r.length>1&&r.sort(d||b5),n.length>1&&n.sort(d||b5)}function c(){for(let h=t,d=e.length;h<d;h++){let p=e[h];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:i,transmissive:r,transparent:n,init:s,push:o,unshift:l,finish:c,sort:u}}function eve(){let e=new WeakMap;function t(r,n){let s=e.get(r),a;return s===void 0?(a=new _5,e.set(r,[a])):n>=s.length?(a=new _5,s.push(a)):a=s[n],a}function i(){e=new WeakMap}return{get:t,dispose:i}}function tve(){let e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new H,color:new li};break;case"SpotLight":i={position:new H,direction:new H,color:new li,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new H,color:new li,distance:0,decay:0};break;case"HemisphereLight":i={direction:new H,skyColor:new li,groundColor:new li};break;case"RectAreaLight":i={color:new li,position:new H,halfWidth:new H,halfHeight:new H};break}return e[t.id]=i,i}}}function ive(){let e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Pe};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Pe};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Pe,shadowCameraNear:1,shadowCameraFar:1e3};break}return e[t.id]=i,i}}}var rve=0;function nve(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function sve(e,t){let i=new tve,r=ive(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let c=0;c<9;c++)n.probe.push(new H);let s=new H,a=new yt,o=new yt;function l(c,h){let d=0,p=0,m=0;for(let z=0;z<9;z++)n.probe[z].set(0,0,0);let v=0,g=0,w=0,S=0,_=0,A=0,C=0,E=0,I=0,T=0;c.sort(nve);let D=h!==!0?Math.PI:1;for(let z=0,G=c.length;z<G;z++){let V=c[z],j=V.color,J=V.intensity,ne=V.distance,K=V.shadow&&V.shadow.map?V.shadow.map.texture:null;if(V.isAmbientLight)d+=j.r*J*D,p+=j.g*J*D,m+=j.b*J*D;else if(V.isLightProbe)for(let B=0;B<9;B++)n.probe[B].addScaledVector(V.sh.coefficients[B],J);else if(V.isDirectionalLight){let B=i.get(V);if(B.color.copy(V.color).multiplyScalar(V.intensity*D),V.castShadow){let Z=V.shadow,F=r.get(V);F.shadowBias=Z.bias,F.shadowNormalBias=Z.normalBias,F.shadowRadius=Z.radius,F.shadowMapSize=Z.mapSize,n.directionalShadow[v]=F,n.directionalShadowMap[v]=K,n.directionalShadowMatrix[v]=V.shadow.matrix,A++}n.directional[v]=B,v++}else if(V.isSpotLight){let B=i.get(V);B.position.setFromMatrixPosition(V.matrixWorld),B.color.copy(j).multiplyScalar(J*D),B.distance=ne,B.coneCos=Math.cos(V.angle),B.penumbraCos=Math.cos(V.angle*(1-V.penumbra)),B.decay=V.decay,n.spot[w]=B;let Z=V.shadow;if(V.map&&(n.spotLightMap[I]=V.map,I++,Z.updateMatrices(V),V.castShadow&&T++),n.spotLightMatrix[w]=Z.matrix,V.castShadow){let F=r.get(V);F.shadowBias=Z.bias,F.shadowNormalBias=Z.normalBias,F.shadowRadius=Z.radius,F.shadowMapSize=Z.mapSize,n.spotShadow[w]=F,n.spotShadowMap[w]=K,E++}w++}else if(V.isRectAreaLight){let B=i.get(V);B.color.copy(j).multiplyScalar(J),B.halfWidth.set(V.width*.5,0,0),B.halfHeight.set(0,V.height*.5,0),n.rectArea[S]=B,S++}else if(V.isPointLight){let B=i.get(V);if(B.color.copy(V.color).multiplyScalar(V.intensity*D),B.distance=V.distance,B.decay=V.decay,V.castShadow){let Z=V.shadow,F=r.get(V);F.shadowBias=Z.bias,F.shadowNormalBias=Z.normalBias,F.shadowRadius=Z.radius,F.shadowMapSize=Z.mapSize,F.shadowCameraNear=Z.camera.near,F.shadowCameraFar=Z.camera.far,n.pointShadow[g]=F,n.pointShadowMap[g]=K,n.pointShadowMatrix[g]=V.shadow.matrix,C++}n.point[g]=B,g++}else if(V.isHemisphereLight){let B=i.get(V);B.skyColor.copy(V.color).multiplyScalar(J*D),B.groundColor.copy(V.groundColor).multiplyScalar(J*D),n.hemi[_]=B,_++}}S>0&&(t.isWebGL2||e.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=Dt.LTC_FLOAT_1,n.rectAreaLTC2=Dt.LTC_FLOAT_2):e.has("OES_texture_half_float_linear")===!0?(n.rectAreaLTC1=Dt.LTC_HALF_1,n.rectAreaLTC2=Dt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=d,n.ambient[1]=p,n.ambient[2]=m;let L=n.hash;(L.directionalLength!==v||L.pointLength!==g||L.spotLength!==w||L.rectAreaLength!==S||L.hemiLength!==_||L.numDirectionalShadows!==A||L.numPointShadows!==C||L.numSpotShadows!==E||L.numSpotMaps!==I)&&(n.directional.length=v,n.spot.length=w,n.rectArea.length=S,n.point.length=g,n.hemi.length=_,n.directionalShadow.length=A,n.directionalShadowMap.length=A,n.pointShadow.length=C,n.pointShadowMap.length=C,n.spotShadow.length=E,n.spotShadowMap.length=E,n.directionalShadowMatrix.length=A,n.pointShadowMatrix.length=C,n.spotLightMatrix.length=E+I-T,n.spotLightMap.length=I,n.numSpotLightShadowsWithMaps=T,L.directionalLength=v,L.pointLength=g,L.spotLength=w,L.rectAreaLength=S,L.hemiLength=_,L.numDirectionalShadows=A,L.numPointShadows=C,L.numSpotShadows=E,L.numSpotMaps=I,n.version=rve++)}function u(c,h){let d=0,p=0,m=0,v=0,g=0,w=h.matrixWorldInverse;for(let S=0,_=c.length;S<_;S++){let A=c[S];if(A.isDirectionalLight){let C=n.directional[d];C.direction.setFromMatrixPosition(A.matrixWorld),s.setFromMatrixPosition(A.target.matrixWorld),C.direction.sub(s),C.direction.transformDirection(w),d++}else if(A.isSpotLight){let C=n.spot[m];C.position.setFromMatrixPosition(A.matrixWorld),C.position.applyMatrix4(w),C.direction.setFromMatrixPosition(A.matrixWorld),s.setFromMatrixPosition(A.target.matrixWorld),C.direction.sub(s),C.direction.transformDirection(w),m++}else if(A.isRectAreaLight){let C=n.rectArea[v];C.position.setFromMatrixPosition(A.matrixWorld),C.position.applyMatrix4(w),o.identity(),a.copy(A.matrixWorld),a.premultiply(w),o.extractRotation(a),C.halfWidth.set(A.width*.5,0,0),C.halfHeight.set(0,A.height*.5,0),C.halfWidth.applyMatrix4(o),C.halfHeight.applyMatrix4(o),v++}else if(A.isPointLight){let C=n.point[p];C.position.setFromMatrixPosition(A.matrixWorld),C.position.applyMatrix4(w),p++}else if(A.isHemisphereLight){let C=n.hemi[g];C.direction.setFromMatrixPosition(A.matrixWorld),C.direction.transformDirection(w),g++}}}return{setup:l,setupView:u,state:n}}function S5(e,t){let i=new sve(e,t),r=[],n=[];function s(){r.length=0,n.length=0}function a(c){r.push(c)}function o(c){n.push(c)}function l(c){i.setup(r,c)}function u(c){i.setupView(r,c)}return{init:s,state:{lightsArray:r,shadowsArray:n,lights:i},setupLights:l,setupLightsView:u,pushLight:a,pushShadow:o}}function ave(e,t){let i=new WeakMap;function r(s,a=0){let o=i.get(s),l;return o===void 0?(l=new S5(e,t),i.set(s,[l])):a>=o.length?(l=new S5(e,t),o.push(l)):l=o[a],l}function n(){i=new WeakMap}return{get:r,dispose:n}}var pq=class extends U_{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=jd,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}},ove=class extends U_{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new H,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}},lve=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,uve=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function cve(e,t,i){let r=new Zz,n=new Pe,s=new Pe,a=new bi,o=new pq({depthPacking:$7}),l=new ove,u={},c=i.maxTextureSize,h={[ju]:Hs,[Hs]:ju,[Ba]:Ba},d=new Zi({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Pe},radius:{value:4}},vertexShader:lve,fragmentShader:uve}),p=d.clone();p.defines.HORIZONTAL_PASS=1;let m=new Kt;m.setAttribute("position",new hi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let v=new zr(m,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Gz,this.render=function(A,C,E){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||A.length===0)return;let I=e.getRenderTarget(),T=e.getActiveCubeFace(),D=e.getActiveMipmapLevel(),L=e.state;L.setBlending(ns),L.buffers.color.setClear(1,1,1,1),L.buffers.depth.setTest(!0),L.setScissorTest(!1);for(let z=0,G=A.length;z<G;z++){let V=A[z],j=V.shadow;if(j===void 0){console.warn("THREE.WebGLShadowMap:",V,"has no shadow.");continue}if(j.autoUpdate===!1&&j.needsUpdate===!1)continue;n.copy(j.mapSize);let J=j.getFrameExtents();if(n.multiply(J),s.copy(j.mapSize),(n.x>c||n.y>c)&&(n.x>c&&(s.x=Math.floor(c/J.x),n.x=s.x*J.x,j.mapSize.x=s.x),n.y>c&&(s.y=Math.floor(c/J.y),n.y=s.y*J.y,j.mapSize.y=s.y)),j.map===null){let K=this.type!==Uw?{minFilter:Ni,magFilter:Ni}:{};j.map=new Ki(n.x,n.y,K),j.map.texture.name=V.name+".shadowMap",j.camera.updateProjectionMatrix()}e.setRenderTarget(j.map),e.clear();let ne=j.getViewportCount();for(let K=0;K<ne;K++){let B=j.getViewport(K);a.set(s.x*B.x,s.y*B.y,s.x*B.z,s.y*B.w),L.viewport(a),j.updateMatrices(V,K),r=j.getFrustum(),_(C,E,j.camera,V,this.type)}j.isPointLightShadow!==!0&&this.type===Uw&&w(j,E),j.needsUpdate=!1}g.needsUpdate=!1,e.setRenderTarget(I,T,D)};function w(A,C){let E=t.update(v);d.defines.VSM_SAMPLES!==A.blurSamples&&(d.defines.VSM_SAMPLES=A.blurSamples,p.defines.VSM_SAMPLES=A.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),A.mapPass===null&&(A.mapPass=new Ki(n.x,n.y)),d.uniforms.shadow_pass.value=A.map.texture,d.uniforms.resolution.value=A.mapSize,d.uniforms.radius.value=A.radius,e.setRenderTarget(A.mapPass),e.clear(),e.renderBufferDirect(C,null,E,d,v,null),p.uniforms.shadow_pass.value=A.mapPass.texture,p.uniforms.resolution.value=A.mapSize,p.uniforms.radius.value=A.radius,e.setRenderTarget(A.map),e.clear(),e.renderBufferDirect(C,null,E,p,v,null)}function S(A,C,E,I,T,D){let L=null,z=E.isPointLight===!0?A.customDistanceMaterial:A.customDepthMaterial;if(z!==void 0)L=z;else if(L=E.isPointLight===!0?l:o,e.localClippingEnabled&&C.clipShadows===!0&&Array.isArray(C.clippingPlanes)&&C.clippingPlanes.length!==0||C.displacementMap&&C.displacementScale!==0||C.alphaMap&&C.alphaTest>0||C.map&&C.alphaTest>0){let G=L.uuid,V=C.uuid,j=u[G];j===void 0&&(j={},u[G]=j);let J=j[V];J===void 0&&(J=L.clone(),j[V]=J),L=J}return L.visible=C.visible,L.wireframe=C.wireframe,D===Uw?L.side=C.shadowSide!==null?C.shadowSide:C.side:L.side=C.shadowSide!==null?C.shadowSide:h[C.side],L.alphaMap=C.alphaMap,L.alphaTest=C.alphaTest,L.map=C.map,L.clipShadows=C.clipShadows,L.clippingPlanes=C.clippingPlanes,L.clipIntersection=C.clipIntersection,L.displacementMap=C.displacementMap,L.displacementScale=C.displacementScale,L.displacementBias=C.displacementBias,L.wireframeLinewidth=C.wireframeLinewidth,L.linewidth=C.linewidth,E.isPointLight===!0&&L.isMeshDistanceMaterial===!0&&(L.referencePosition.setFromMatrixPosition(E.matrixWorld),L.nearDistance=I,L.farDistance=T),L}function _(A,C,E,I,T){if(A.visible===!1)return;if(A.layers.test(C.layers)&&(A.isMesh||A.isLine||A.isPoints)&&(A.castShadow||A.receiveShadow&&T===Uw)&&(!A.frustumCulled||r.intersectsObject(A))){A.modelViewMatrix.multiplyMatrices(E.matrixWorldInverse,A.matrixWorld);let L=t.update(A),z=A.material;if(Array.isArray(z)){let G=L.groups;for(let V=0,j=G.length;V<j;V++){let J=G[V],ne=z[J.materialIndex];if(ne&&ne.visible){let K=S(A,ne,I,E.near,E.far,T);e.renderBufferDirect(E,null,L,K,A,J)}}}else if(z.visible){let G=S(A,z,I,E.near,E.far,T);e.renderBufferDirect(E,null,L,G,A,null)}}let D=A.children;for(let L=0,z=D.length;L<z;L++)_(D[L],C,E,I,T)}}function hve(e,t,i){let r=i.isWebGL2;function n(){let ie=!1,we=new bi,Re=null,We=new bi(0,0,0,0);return{setMask:function(ct){Re!==ct&&!ie&&(e.colorMask(ct,ct,ct,ct),Re=ct)},setLocked:function(ct){ie=ct},setClear:function(ct,Ut,si,Si,ar){ar===!0&&(ct*=Si,Ut*=Si,si*=Si),we.set(ct,Ut,si,Si),We.equals(we)===!1&&(e.clearColor(ct,Ut,si,Si),We.copy(we))},reset:function(){ie=!1,Re=null,We.set(-1,0,0,0)}}}function s(){let ie=!1,we=null,Re=null,We=null;return{setTest:function(ct){ct?me(2929):he(2929)},setMask:function(ct){we!==ct&&!ie&&(e.depthMask(ct),we=ct)},setFunc:function(ct){if(Re!==ct){switch(ct){case Ihe:e.depthFunc(512);break;case Lhe:e.depthFunc(519);break;case Ohe:e.depthFunc(513);break;case bI:e.depthFunc(515);break;case zhe:e.depthFunc(514);break;case khe:e.depthFunc(518);break;case Bhe:e.depthFunc(516);break;case Nhe:e.depthFunc(517);break;default:e.depthFunc(515)}Re=ct}},setLocked:function(ct){ie=ct},setClear:function(ct){We!==ct&&(e.clearDepth(ct),We=ct)},reset:function(){ie=!1,we=null,Re=null,We=null}}}function a(){let ie=!1,we=null,Re=null,We=null,ct=null,Ut=null,si=null,Si=null,ar=null;return{setTest:function(ri){ie||(ri?me(2960):he(2960))},setMask:function(ri){we!==ri&&!ie&&(e.stencilMask(ri),we=ri)},setFunc:function(ri,Yi,ji){(Re!==ri||We!==Yi||ct!==ji)&&(e.stencilFunc(ri,Yi,ji),Re=ri,We=Yi,ct=ji)},setOp:function(ri,Yi,ji){(Ut!==ri||si!==Yi||Si!==ji)&&(e.stencilOp(ri,Yi,ji),Ut=ri,si=Yi,Si=ji)},setLocked:function(ri){ie=ri},setClear:function(ri){ar!==ri&&(e.clearStencil(ri),ar=ri)},reset:function(){ie=!1,we=null,Re=null,We=null,ct=null,Ut=null,si=null,Si=null,ar=null}}}let o=new n,l=new s,u=new a,c=new WeakMap,h=new WeakMap,d={},p={},m=new WeakMap,v=[],g=null,w=!1,S=null,_=null,A=null,C=null,E=null,I=null,T=null,D=!1,L=null,z=null,G=null,V=null,j=null,J=e.getParameter(35661),ne=!1,K=0,B=e.getParameter(7938);B.indexOf("WebGL")!==-1?(K=parseFloat(/^WebGL (\d)/.exec(B)[1]),ne=K>=1):B.indexOf("OpenGL ES")!==-1&&(K=parseFloat(/^OpenGL ES (\d)/.exec(B)[1]),ne=K>=2);let Z=null,F={},X=e.getParameter(3088),Y=e.getParameter(2978),le=new bi().fromArray(X),oe=new bi().fromArray(Y);function re(ie,we,Re){let We=new Uint8Array(4),ct=e.createTexture();e.bindTexture(ie,ct),e.texParameteri(ie,10241,9728),e.texParameteri(ie,10240,9728);for(let Ut=0;Ut<Re;Ut++)e.texImage2D(we+Ut,0,6408,1,1,0,6408,5121,We);return ct}let ue={};ue[3553]=re(3553,3553,1),ue[34067]=re(34067,34069,6),o.setClear(0,0,0,1),l.setClear(1),u.setClear(0),me(2929),l.setFunc(bI),Qe(!1),ot(mU),me(2884),Ve(ns);function me(ie){d[ie]!==!0&&(e.enable(ie),d[ie]=!0)}function he(ie){d[ie]!==!1&&(e.disable(ie),d[ie]=!1)}function Ce(ie,we){return p[ie]!==we?(e.bindFramebuffer(ie,we),p[ie]=we,r&&(ie===36009&&(p[36160]=we),ie===36160&&(p[36009]=we)),!0):!1}function Ae(ie,we){let Re=v,We=!1;if(ie)if(Re=m.get(we),Re===void 0&&(Re=[],m.set(we,Re)),ie.isWebGLMultipleRenderTargets){let ct=ie.texture;if(Re.length!==ct.length||Re[0]!==36064){for(let Ut=0,si=ct.length;Ut<si;Ut++)Re[Ut]=36064+Ut;Re.length=ct.length,We=!0}}else Re[0]!==36064&&(Re[0]=36064,We=!0);else Re[0]!==1029&&(Re[0]=1029,We=!0);We&&(i.isWebGL2?e.drawBuffers(Re):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(Re))}function Ie(ie){return g!==ie?(e.useProgram(ie),g=ie,!0):!1}let Me={[fy]:32774,[bhe]:32778,[_he]:32779};if(r)Me[xU]=32775,Me[wU]=32776;else{let ie=t.get("EXT_blend_minmax");ie!==null&&(Me[xU]=ie.MIN_EXT,Me[wU]=ie.MAX_EXT)}let De={[She]:0,[Mhe]:1,[Ahe]:768,[G7]:770,[Rhe]:776,[Phe]:774,[Che]:772,[Ehe]:769,[q7]:771,[Dhe]:775,[The]:773};function Ve(ie,we,Re,We,ct,Ut,si,Si){if(ie===ns){w===!0&&(he(3042),w=!1);return}if(w===!1&&(me(3042),w=!0),ie!==whe){if(ie!==S||Si!==D){if((_!==fy||E!==fy)&&(e.blendEquation(32774),_=fy,E=fy),Si)switch(ie){case Pg:e.blendFuncSeparate(1,771,1,771);break;case gU:e.blendFunc(1,1);break;case vU:e.blendFuncSeparate(0,769,0,1);break;case yU:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",ie);break}else switch(ie){case Pg:e.blendFuncSeparate(770,771,1,771);break;case gU:e.blendFunc(770,1);break;case vU:e.blendFuncSeparate(0,769,0,1);break;case yU:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",ie);break}A=null,C=null,I=null,T=null,S=ie,D=Si}return}ct=ct||we,Ut=Ut||Re,si=si||We,(we!==_||ct!==E)&&(e.blendEquationSeparate(Me[we],Me[ct]),_=we,E=ct),(Re!==A||We!==C||Ut!==I||si!==T)&&(e.blendFuncSeparate(De[Re],De[We],De[Ut],De[si]),A=Re,C=We,I=Ut,T=si),S=ie,D=!1}function Ge(ie,we){ie.side===Ba?he(2884):me(2884);let Re=ie.side===Hs;we&&(Re=!Re),Qe(Re),ie.blending===Pg&&ie.transparent===!1?Ve(ns):Ve(ie.blending,ie.blendEquation,ie.blendSrc,ie.blendDst,ie.blendEquationAlpha,ie.blendSrcAlpha,ie.blendDstAlpha,ie.premultipliedAlpha),l.setFunc(ie.depthFunc),l.setTest(ie.depthTest),l.setMask(ie.depthWrite),o.setMask(ie.colorWrite);let We=ie.stencilWrite;u.setTest(We),We&&(u.setMask(ie.stencilWriteMask),u.setFunc(ie.stencilFunc,ie.stencilRef,ie.stencilFuncMask),u.setOp(ie.stencilFail,ie.stencilZFail,ie.stencilZPass)),Ke(ie.polygonOffset,ie.polygonOffsetFactor,ie.polygonOffsetUnits),ie.alphaToCoverage===!0?me(32926):he(32926)}function Qe(ie){L!==ie&&(ie?e.frontFace(2304):e.frontFace(2305),L=ie)}function ot(ie){ie!==vhe?(me(2884),ie!==z&&(ie===mU?e.cullFace(1029):ie===yhe?e.cullFace(1028):e.cullFace(1032))):he(2884),z=ie}function $e(ie){ie!==G&&(ne&&e.lineWidth(ie),G=ie)}function Ke(ie,we,Re){ie?(me(32823),(V!==we||j!==Re)&&(e.polygonOffset(we,Re),V=we,j=Re)):he(32823)}function bt(ie){ie?me(3089):he(3089)}function xt(ie){ie===void 0&&(ie=33984+J-1),Z!==ie&&(e.activeTexture(ie),Z=ie)}function q(ie,we,Re){Re===void 0&&(Z===null?Re=33984+J-1:Re=Z);let We=F[Re];We===void 0&&(We={type:void 0,texture:void 0},F[Re]=We),(We.type!==ie||We.texture!==we)&&(Z!==Re&&(e.activeTexture(Re),Z=Re),e.bindTexture(ie,we||ue[ie]),We.type=ie,We.texture=we)}function N(){let ie=F[Z];ie!==void 0&&ie.type!==void 0&&(e.bindTexture(ie.type,null),ie.type=void 0,ie.texture=void 0)}function de(){try{e.compressedTexImage2D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function ze(){try{e.compressedTexImage3D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function $(){try{e.texSubImage2D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function Ue(){try{e.texSubImage3D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function rt(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function Ye(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function Ee(){try{e.texStorage2D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function lt(){try{e.texStorage3D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function et(){try{e.texImage2D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function pt(){try{e.texImage3D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function mt(ie){le.equals(ie)===!1&&(e.scissor(ie.x,ie.y,ie.z,ie.w),le.copy(ie))}function dt(ie){oe.equals(ie)===!1&&(e.viewport(ie.x,ie.y,ie.z,ie.w),oe.copy(ie))}function _e(ie,we){let Re=h.get(we);Re===void 0&&(Re=new WeakMap,h.set(we,Re));let We=Re.get(ie);We===void 0&&(We=e.getUniformBlockIndex(we,ie.name),Re.set(ie,We))}function it(ie,we){let Re=h.get(we).get(ie);c.get(we)!==Re&&(e.uniformBlockBinding(we,Re,ie.__bindingPointIndex),c.set(we,Re))}function At(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),r===!0&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),d={},Z=null,F={},p={},m=new WeakMap,v=[],g=null,w=!1,S=null,_=null,A=null,C=null,E=null,I=null,T=null,D=!1,L=null,z=null,G=null,V=null,j=null,le.set(0,0,e.canvas.width,e.canvas.height),oe.set(0,0,e.canvas.width,e.canvas.height),o.reset(),l.reset(),u.reset()}return{buffers:{color:o,depth:l,stencil:u},enable:me,disable:he,bindFramebuffer:Ce,drawBuffers:Ae,useProgram:Ie,setBlending:Ve,setMaterial:Ge,setFlipSided:Qe,setCullFace:ot,setLineWidth:$e,setPolygonOffset:Ke,setScissorTest:bt,activeTexture:xt,bindTexture:q,unbindTexture:N,compressedTexImage2D:de,compressedTexImage3D:ze,texImage2D:et,texImage3D:pt,updateUBOMapping:_e,uniformBlockBinding:it,texStorage2D:Ee,texStorage3D:lt,texSubImage2D:$,texSubImage3D:Ue,compressedTexSubImage2D:rt,compressedTexSubImage3D:Ye,scissor:mt,viewport:dt,reset:At}}function dve(e,t,i,r,n,s,a){let o=n.isWebGL2,l=n.maxTextures,u=n.maxCubemapSize,c=n.maxTextureSize,h=n.maxSamples,d=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,p=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),m=new WeakMap,v,g=new WeakMap,w=!1;try{w=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function S(q,N){return w?new OffscreenCanvas(q,N):Hb("canvas")}function _(q,N,de,ze){let $=1;if((q.width>ze||q.height>ze)&&($=ze/Math.max(q.width,q.height)),$<1||N===!0)if(typeof HTMLImageElement<"u"&&q instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&q instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&q instanceof ImageBitmap){let Ue=N?u2:Math.floor,rt=Ue($*q.width),Ye=Ue($*q.height);v===void 0&&(v=S(rt,Ye));let Ee=de?S(rt,Ye):v;return Ee.width=rt,Ee.height=Ye,Ee.getContext("2d").drawImage(q,0,0,rt,Ye),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+q.width+"x"+q.height+") to ("+rt+"x"+Ye+")."),Ee}else return"data"in q&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+q.width+"x"+q.height+")."),q;return q}function A(q){return TI(q.width)&&TI(q.height)}function C(q){return o?!1:q.wrapS!==Yr||q.wrapT!==Yr||q.minFilter!==Ni&&q.minFilter!==Li}function E(q,N){return q.generateMipmaps&&N&&q.minFilter!==Ni&&q.minFilter!==Li}function I(q){e.generateMipmap(q)}function T(q,N,de,ze,$=!1){if(o===!1)return N;if(q!==null){if(e[q]!==void 0)return e[q];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+q+"'")}let Ue=N;return N===6403&&(de===5126&&(Ue=33326),de===5131&&(Ue=33325),de===5121&&(Ue=33321)),N===33319&&(de===5126&&(Ue=33328),de===5131&&(Ue=33327),de===5121&&(Ue=33323)),N===6408&&(de===5126&&(Ue=34836),de===5131&&(Ue=34842),de===5121&&(Ue=ze===Ri&&$===!1?35907:32856),de===32819&&(Ue=32854),de===32820&&(Ue=32855)),(Ue===33325||Ue===33326||Ue===33327||Ue===33328||Ue===34842||Ue===34836)&&t.get("EXT_color_buffer_float"),Ue}function D(q,N,de){return E(q,de)===!0||q.isFramebufferTexture&&q.minFilter!==Ni&&q.minFilter!==Li?Math.log2(Math.max(N.width,N.height))+1:q.mipmaps!==void 0&&q.mipmaps.length>0?q.mipmaps.length:q.isCompressedTexture&&Array.isArray(q.image)?N.mipmaps.length:1}function L(q){return q===Ni||q===bU||q===s3?9728:9729}function z(q){let N=q.target;N.removeEventListener("dispose",z),V(N),N.isVideoTexture&&m.delete(N)}function G(q){let N=q.target;N.removeEventListener("dispose",G),J(N)}function V(q){let N=r.get(q);if(N.__webglInit===void 0)return;let de=q.source,ze=g.get(de);if(ze){let $=ze[N.__cacheKey];$.usedTimes--,$.usedTimes===0&&j(q),Object.keys(ze).length===0&&g.delete(de)}r.remove(q)}function j(q){let N=r.get(q);e.deleteTexture(N.__webglTexture);let de=q.source,ze=g.get(de);delete ze[N.__cacheKey],a.memory.textures--}function J(q){let N=q.texture,de=r.get(q),ze=r.get(N);if(ze.__webglTexture!==void 0&&(e.deleteTexture(ze.__webglTexture),a.memory.textures--),q.depthTexture&&q.depthTexture.dispose(),q.isWebGLCubeRenderTarget)for(let $=0;$<6;$++)e.deleteFramebuffer(de.__webglFramebuffer[$]),de.__webglDepthbuffer&&e.deleteRenderbuffer(de.__webglDepthbuffer[$]);else{if(e.deleteFramebuffer(de.__webglFramebuffer),de.__webglDepthbuffer&&e.deleteRenderbuffer(de.__webglDepthbuffer),de.__webglMultisampledFramebuffer&&e.deleteFramebuffer(de.__webglMultisampledFramebuffer),de.__webglColorRenderbuffer)for(let $=0;$<de.__webglColorRenderbuffer.length;$++)de.__webglColorRenderbuffer[$]&&e.deleteRenderbuffer(de.__webglColorRenderbuffer[$]);de.__webglDepthRenderbuffer&&e.deleteRenderbuffer(de.__webglDepthRenderbuffer)}if(q.isWebGLMultipleRenderTargets)for(let $=0,Ue=N.length;$<Ue;$++){let rt=r.get(N[$]);rt.__webglTexture&&(e.deleteTexture(rt.__webglTexture),a.memory.textures--),r.remove(N[$])}r.remove(N),r.remove(q)}let ne=0;function K(){ne=0}function B(){let q=ne;return q>=l&&console.warn("THREE.WebGLTextures: Trying to use "+q+" texture units while this GPU supports only "+l),ne+=1,q}function Z(q){let N=[];return N.push(q.wrapS),N.push(q.wrapT),N.push(q.wrapR||0),N.push(q.magFilter),N.push(q.minFilter),N.push(q.anisotropy),N.push(q.internalFormat),N.push(q.format),N.push(q.type),N.push(q.generateMipmaps),N.push(q.premultiplyAlpha),N.push(q.flipY),N.push(q.unpackAlignment),N.push(q.encoding),N.join()}function F(q,N){let de=r.get(q);if(q.isVideoTexture&&bt(q),q.isRenderTargetTexture===!1&&q.version>0&&de.__version!==q.version){let ze=q.image;if(ze===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(ze.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{he(de,q,N);return}}i.bindTexture(3553,de.__webglTexture,33984+N)}function X(q,N){let de=r.get(q);if(q.version>0&&de.__version!==q.version){he(de,q,N);return}i.bindTexture(35866,de.__webglTexture,33984+N)}function Y(q,N){let de=r.get(q);if(q.version>0&&de.__version!==q.version){he(de,q,N);return}i.bindTexture(32879,de.__webglTexture,33984+N)}function le(q,N){let de=r.get(q);if(q.version>0&&de.__version!==q.version){Ce(de,q,N);return}i.bindTexture(34067,de.__webglTexture,33984+N)}let oe={[md]:10497,[Yr]:33071,[MI]:33648},re={[Ni]:9728,[bU]:9984,[s3]:9986,[Li]:9729,[qhe]:9985,[sx]:9987};function ue(q,N,de){if(de?(e.texParameteri(q,10242,oe[N.wrapS]),e.texParameteri(q,10243,oe[N.wrapT]),(q===32879||q===35866)&&e.texParameteri(q,32882,oe[N.wrapR]),e.texParameteri(q,10240,re[N.magFilter]),e.texParameteri(q,10241,re[N.minFilter])):(e.texParameteri(q,10242,33071),e.texParameteri(q,10243,33071),(q===32879||q===35866)&&e.texParameteri(q,32882,33071),(N.wrapS!==Yr||N.wrapT!==Yr)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(q,10240,L(N.magFilter)),e.texParameteri(q,10241,L(N.minFilter)),N.minFilter!==Ni&&N.minFilter!==Li&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),t.has("EXT_texture_filter_anisotropic")===!0){let ze=t.get("EXT_texture_filter_anisotropic");if(N.magFilter===Ni||N.minFilter!==s3&&N.minFilter!==sx||N.type===br&&t.has("OES_texture_float_linear")===!1||o===!1&&N.type===Pd&&t.has("OES_texture_half_float_linear")===!1)return;(N.anisotropy>1||r.get(N).__currentAnisotropy)&&(e.texParameterf(q,ze.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(N.anisotropy,n.getMaxAnisotropy())),r.get(N).__currentAnisotropy=N.anisotropy)}}function me(q,N){let de=!1;q.__webglInit===void 0&&(q.__webglInit=!0,N.addEventListener("dispose",z));let ze=N.source,$=g.get(ze);$===void 0&&($={},g.set(ze,$));let Ue=Z(N);if(Ue!==q.__cacheKey){$[Ue]===void 0&&($[Ue]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,de=!0),$[Ue].usedTimes++;let rt=$[q.__cacheKey];rt!==void 0&&($[q.__cacheKey].usedTimes--,rt.usedTimes===0&&j(N)),q.__cacheKey=Ue,q.__webglTexture=$[Ue].texture}return de}function he(q,N,de){let ze=3553;(N.isDataArrayTexture||N.isCompressedArrayTexture)&&(ze=35866),N.isData3DTexture&&(ze=32879);let $=me(q,N),Ue=N.source;i.bindTexture(ze,q.__webglTexture,33984+de);let rt=r.get(Ue);if(Ue.version!==rt.__version||$===!0){i.activeTexture(33984+de),e.pixelStorei(37440,N.flipY),e.pixelStorei(37441,N.premultiplyAlpha),e.pixelStorei(3317,N.unpackAlignment),e.pixelStorei(37443,0);let Ye=C(N)&&A(N.image)===!1,Ee=_(N.image,Ye,!1,c);Ee=xt(N,Ee);let lt=A(Ee)||o,et=s.convert(N.format,N.encoding),pt=s.convert(N.type),mt=T(N.internalFormat,et,pt,N.encoding,N.isVideoTexture);ue(ze,N,lt);let dt,_e=N.mipmaps,it=o&&N.isVideoTexture!==!0,At=rt.__version===void 0||$===!0,ie=D(N,Ee,lt);if(N.isDepthTexture)mt=6402,o?N.type===br?mt=36012:N.type===gd?mt=33190:N.type===Dg?mt=35056:mt=33189:N.type===br&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),N.format===Rg&&mt===6402&&N.type!==Q7&&N.type!==gd&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),N.type=gd,pt=s.convert(N.type)),N.format===Gg&&mt===6402&&(mt=34041,N.type!==Dg&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),N.type=Dg,pt=s.convert(N.type))),At&&(it?i.texStorage2D(3553,1,mt,Ee.width,Ee.height):i.texImage2D(3553,0,mt,Ee.width,Ee.height,0,et,pt,null));else if(N.isDataTexture)if(_e.length>0&&lt){it&&At&&i.texStorage2D(3553,ie,mt,_e[0].width,_e[0].height);for(let we=0,Re=_e.length;we<Re;we++)dt=_e[we],it?i.texSubImage2D(3553,we,0,0,dt.width,dt.height,et,pt,dt.data):i.texImage2D(3553,we,mt,dt.width,dt.height,0,et,pt,dt.data);N.generateMipmaps=!1}else it?(At&&i.texStorage2D(3553,ie,mt,Ee.width,Ee.height),i.texSubImage2D(3553,0,0,0,Ee.width,Ee.height,et,pt,Ee.data)):i.texImage2D(3553,0,mt,Ee.width,Ee.height,0,et,pt,Ee.data);else if(N.isCompressedTexture)if(N.isCompressedArrayTexture){it&&At&&i.texStorage3D(35866,ie,mt,_e[0].width,_e[0].height,Ee.depth);for(let we=0,Re=_e.length;we<Re;we++)dt=_e[we],N.format!==$r?et!==null?it?i.compressedTexSubImage3D(35866,we,0,0,0,dt.width,dt.height,Ee.depth,et,dt.data,0,0):i.compressedTexImage3D(35866,we,mt,dt.width,dt.height,Ee.depth,0,dt.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):it?i.texSubImage3D(35866,we,0,0,0,dt.width,dt.height,Ee.depth,et,pt,dt.data):i.texImage3D(35866,we,mt,dt.width,dt.height,Ee.depth,0,et,pt,dt.data)}else{it&&At&&i.texStorage2D(3553,ie,mt,_e[0].width,_e[0].height);for(let we=0,Re=_e.length;we<Re;we++)dt=_e[we],N.format!==$r?et!==null?it?i.compressedTexSubImage2D(3553,we,0,0,dt.width,dt.height,et,dt.data):i.compressedTexImage2D(3553,we,mt,dt.width,dt.height,0,dt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):it?i.texSubImage2D(3553,we,0,0,dt.width,dt.height,et,pt,dt.data):i.texImage2D(3553,we,mt,dt.width,dt.height,0,et,pt,dt.data)}else if(N.isDataArrayTexture)it?(At&&i.texStorage3D(35866,ie,mt,Ee.width,Ee.height,Ee.depth),i.texSubImage3D(35866,0,0,0,0,Ee.width,Ee.height,Ee.depth,et,pt,Ee.data)):i.texImage3D(35866,0,mt,Ee.width,Ee.height,Ee.depth,0,et,pt,Ee.data);else if(N.isData3DTexture)it?(At&&i.texStorage3D(32879,ie,mt,Ee.width,Ee.height,Ee.depth),i.texSubImage3D(32879,0,0,0,0,Ee.width,Ee.height,Ee.depth,et,pt,Ee.data)):i.texImage3D(32879,0,mt,Ee.width,Ee.height,Ee.depth,0,et,pt,Ee.data);else if(N.isFramebufferTexture){if(At)if(it)i.texStorage2D(3553,ie,mt,Ee.width,Ee.height);else{let we=Ee.width,Re=Ee.height;for(let We=0;We<ie;We++)i.texImage2D(3553,We,mt,we,Re,0,et,pt,null),we>>=1,Re>>=1}}else if(_e.length>0&&lt){it&&At&&i.texStorage2D(3553,ie,mt,_e[0].width,_e[0].height);for(let we=0,Re=_e.length;we<Re;we++)dt=_e[we],it?i.texSubImage2D(3553,we,0,0,et,pt,dt):i.texImage2D(3553,we,mt,et,pt,dt);N.generateMipmaps=!1}else it?(At&&i.texStorage2D(3553,ie,mt,Ee.width,Ee.height),i.texSubImage2D(3553,0,0,0,et,pt,Ee)):i.texImage2D(3553,0,mt,et,pt,Ee);E(N,lt)&&I(ze),rt.__version=Ue.version,N.onUpdate&&N.onUpdate(N)}q.__version=N.version}function Ce(q,N,de){if(N.image.length!==6)return;let ze=me(q,N),$=N.source;i.bindTexture(34067,q.__webglTexture,33984+de);let Ue=r.get($);if($.version!==Ue.__version||ze===!0){i.activeTexture(33984+de),e.pixelStorei(37440,N.flipY),e.pixelStorei(37441,N.premultiplyAlpha),e.pixelStorei(3317,N.unpackAlignment),e.pixelStorei(37443,0);let rt=N.isCompressedTexture||N.image[0].isCompressedTexture,Ye=N.image[0]&&N.image[0].isDataTexture,Ee=[];for(let we=0;we<6;we++)!rt&&!Ye?Ee[we]=_(N.image[we],!1,!0,u):Ee[we]=Ye?N.image[we].image:N.image[we],Ee[we]=xt(N,Ee[we]);let lt=Ee[0],et=A(lt)||o,pt=s.convert(N.format,N.encoding),mt=s.convert(N.type),dt=T(N.internalFormat,pt,mt,N.encoding),_e=o&&N.isVideoTexture!==!0,it=Ue.__version===void 0||ze===!0,At=D(N,lt,et);ue(34067,N,et);let ie;if(rt){_e&&it&&i.texStorage2D(34067,At,dt,lt.width,lt.height);for(let we=0;we<6;we++){ie=Ee[we].mipmaps;for(let Re=0;Re<ie.length;Re++){let We=ie[Re];N.format!==$r?pt!==null?_e?i.compressedTexSubImage2D(34069+we,Re,0,0,We.width,We.height,pt,We.data):i.compressedTexImage2D(34069+we,Re,dt,We.width,We.height,0,We.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):_e?i.texSubImage2D(34069+we,Re,0,0,We.width,We.height,pt,mt,We.data):i.texImage2D(34069+we,Re,dt,We.width,We.height,0,pt,mt,We.data)}}}else{ie=N.mipmaps,_e&&it&&(ie.length>0&&At++,i.texStorage2D(34067,At,dt,Ee[0].width,Ee[0].height));for(let we=0;we<6;we++)if(Ye){_e?i.texSubImage2D(34069+we,0,0,0,Ee[we].width,Ee[we].height,pt,mt,Ee[we].data):i.texImage2D(34069+we,0,dt,Ee[we].width,Ee[we].height,0,pt,mt,Ee[we].data);for(let Re=0;Re<ie.length;Re++){let We=ie[Re].image[we].image;_e?i.texSubImage2D(34069+we,Re+1,0,0,We.width,We.height,pt,mt,We.data):i.texImage2D(34069+we,Re+1,dt,We.width,We.height,0,pt,mt,We.data)}}else{_e?i.texSubImage2D(34069+we,0,0,0,pt,mt,Ee[we]):i.texImage2D(34069+we,0,dt,pt,mt,Ee[we]);for(let Re=0;Re<ie.length;Re++){let We=ie[Re];_e?i.texSubImage2D(34069+we,Re+1,0,0,pt,mt,We.image[we]):i.texImage2D(34069+we,Re+1,dt,pt,mt,We.image[we])}}}E(N,et)&&I(34067),Ue.__version=$.version,N.onUpdate&&N.onUpdate(N)}q.__version=N.version}function Ae(q,N,de,ze,$){let Ue=s.convert(de.format,de.encoding),rt=s.convert(de.type),Ye=T(de.internalFormat,Ue,rt,de.encoding);r.get(N).__hasExternalTextures||($===32879||$===35866?i.texImage3D($,0,Ye,N.width,N.height,N.depth,0,Ue,rt,null):i.texImage2D($,0,Ye,N.width,N.height,0,Ue,rt,null)),i.bindFramebuffer(36160,q),Ke(N)?d.framebufferTexture2DMultisampleEXT(36160,ze,$,r.get(de).__webglTexture,0,$e(N)):($===3553||$>=34069&&$<=34074)&&e.framebufferTexture2D(36160,ze,$,r.get(de).__webglTexture,0),i.bindFramebuffer(36160,null)}function Ie(q,N,de){if(e.bindRenderbuffer(36161,q),N.depthBuffer&&!N.stencilBuffer){let ze=33189;if(de||Ke(N)){let $=N.depthTexture;$&&$.isDepthTexture&&($.type===br?ze=36012:$.type===gd&&(ze=33190));let Ue=$e(N);Ke(N)?d.renderbufferStorageMultisampleEXT(36161,Ue,ze,N.width,N.height):e.renderbufferStorageMultisample(36161,Ue,ze,N.width,N.height)}else e.renderbufferStorage(36161,ze,N.width,N.height);e.framebufferRenderbuffer(36160,36096,36161,q)}else if(N.depthBuffer&&N.stencilBuffer){let ze=$e(N);de&&Ke(N)===!1?e.renderbufferStorageMultisample(36161,ze,35056,N.width,N.height):Ke(N)?d.renderbufferStorageMultisampleEXT(36161,ze,35056,N.width,N.height):e.renderbufferStorage(36161,34041,N.width,N.height),e.framebufferRenderbuffer(36160,33306,36161,q)}else{let ze=N.isWebGLMultipleRenderTargets===!0?N.texture:[N.texture];for(let $=0;$<ze.length;$++){let Ue=ze[$],rt=s.convert(Ue.format,Ue.encoding),Ye=s.convert(Ue.type),Ee=T(Ue.internalFormat,rt,Ye,Ue.encoding),lt=$e(N);de&&Ke(N)===!1?e.renderbufferStorageMultisample(36161,lt,Ee,N.width,N.height):Ke(N)?d.renderbufferStorageMultisampleEXT(36161,lt,Ee,N.width,N.height):e.renderbufferStorage(36161,Ee,N.width,N.height)}}e.bindRenderbuffer(36161,null)}function Me(q,N){if(N&&N.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,q),!(N.depthTexture&&N.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(N.depthTexture).__webglTexture||N.depthTexture.image.width!==N.width||N.depthTexture.image.height!==N.height)&&(N.depthTexture.image.width=N.width,N.depthTexture.image.height=N.height,N.depthTexture.needsUpdate=!0),F(N.depthTexture,0);let de=r.get(N.depthTexture).__webglTexture,ze=$e(N);if(N.depthTexture.format===Rg)Ke(N)?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,de,0,ze):e.framebufferTexture2D(36160,36096,3553,de,0);else if(N.depthTexture.format===Gg)Ke(N)?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,de,0,ze):e.framebufferTexture2D(36160,33306,3553,de,0);else throw new Error("Unknown depthTexture format")}function De(q){let N=r.get(q),de=q.isWebGLCubeRenderTarget===!0;if(q.depthTexture&&!N.__autoAllocateDepthBuffer){if(de)throw new Error("target.depthTexture not supported in Cube render targets");Me(N.__webglFramebuffer,q)}else if(de){N.__webglDepthbuffer=[];for(let ze=0;ze<6;ze++)i.bindFramebuffer(36160,N.__webglFramebuffer[ze]),N.__webglDepthbuffer[ze]=e.createRenderbuffer(),Ie(N.__webglDepthbuffer[ze],q,!1)}else i.bindFramebuffer(36160,N.__webglFramebuffer),N.__webglDepthbuffer=e.createRenderbuffer(),Ie(N.__webglDepthbuffer,q,!1);i.bindFramebuffer(36160,null)}function Ve(q,N,de){let ze=r.get(q);N!==void 0&&Ae(ze.__webglFramebuffer,q,q.texture,36064,3553),de!==void 0&&De(q)}function Ge(q){let N=q.texture,de=r.get(q),ze=r.get(N);q.addEventListener("dispose",G),q.isWebGLMultipleRenderTargets!==!0&&(ze.__webglTexture===void 0&&(ze.__webglTexture=e.createTexture()),ze.__version=N.version,a.memory.textures++);let $=q.isWebGLCubeRenderTarget===!0,Ue=q.isWebGLMultipleRenderTargets===!0,rt=A(q)||o;if($){de.__webglFramebuffer=[];for(let Ye=0;Ye<6;Ye++)de.__webglFramebuffer[Ye]=e.createFramebuffer()}else{if(de.__webglFramebuffer=e.createFramebuffer(),Ue)if(n.drawBuffers){let Ye=q.texture;for(let Ee=0,lt=Ye.length;Ee<lt;Ee++){let et=r.get(Ye[Ee]);et.__webglTexture===void 0&&(et.__webglTexture=e.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&q.samples>0&&Ke(q)===!1){let Ye=Ue?N:[N];de.__webglMultisampledFramebuffer=e.createFramebuffer(),de.__webglColorRenderbuffer=[],i.bindFramebuffer(36160,de.__webglMultisampledFramebuffer);for(let Ee=0;Ee<Ye.length;Ee++){let lt=Ye[Ee];de.__webglColorRenderbuffer[Ee]=e.createRenderbuffer(),e.bindRenderbuffer(36161,de.__webglColorRenderbuffer[Ee]);let et=s.convert(lt.format,lt.encoding),pt=s.convert(lt.type),mt=T(lt.internalFormat,et,pt,lt.encoding,q.isXRRenderTarget===!0),dt=$e(q);e.renderbufferStorageMultisample(36161,dt,mt,q.width,q.height),e.framebufferRenderbuffer(36160,36064+Ee,36161,de.__webglColorRenderbuffer[Ee])}e.bindRenderbuffer(36161,null),q.depthBuffer&&(de.__webglDepthRenderbuffer=e.createRenderbuffer(),Ie(de.__webglDepthRenderbuffer,q,!0)),i.bindFramebuffer(36160,null)}}if($){i.bindTexture(34067,ze.__webglTexture),ue(34067,N,rt);for(let Ye=0;Ye<6;Ye++)Ae(de.__webglFramebuffer[Ye],q,N,36064,34069+Ye);E(N,rt)&&I(34067),i.unbindTexture()}else if(Ue){let Ye=q.texture;for(let Ee=0,lt=Ye.length;Ee<lt;Ee++){let et=Ye[Ee],pt=r.get(et);i.bindTexture(3553,pt.__webglTexture),ue(3553,et,rt),Ae(de.__webglFramebuffer,q,et,36064+Ee,3553),E(et,rt)&&I(3553)}i.unbindTexture()}else{let Ye=3553;(q.isWebGL3DRenderTarget||q.isWebGLArrayRenderTarget)&&(o?Ye=q.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(Ye,ze.__webglTexture),ue(Ye,N,rt),Ae(de.__webglFramebuffer,q,N,36064,Ye),E(N,rt)&&I(Ye),i.unbindTexture()}q.depthBuffer&&De(q)}function Qe(q){let N=A(q)||o,de=q.isWebGLMultipleRenderTargets===!0?q.texture:[q.texture];for(let ze=0,$=de.length;ze<$;ze++){let Ue=de[ze];if(E(Ue,N)){let rt=q.isWebGLCubeRenderTarget?34067:3553,Ye=r.get(Ue).__webglTexture;i.bindTexture(rt,Ye),I(rt),i.unbindTexture()}}}function ot(q){if(o&&q.samples>0&&Ke(q)===!1){let N=q.isWebGLMultipleRenderTargets?q.texture:[q.texture],de=q.width,ze=q.height,$=16384,Ue=[],rt=q.stencilBuffer?33306:36096,Ye=r.get(q),Ee=q.isWebGLMultipleRenderTargets===!0;if(Ee)for(let lt=0;lt<N.length;lt++)i.bindFramebuffer(36160,Ye.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+lt,36161,null),i.bindFramebuffer(36160,Ye.__webglFramebuffer),e.framebufferTexture2D(36009,36064+lt,3553,null,0);i.bindFramebuffer(36008,Ye.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,Ye.__webglFramebuffer);for(let lt=0;lt<N.length;lt++){Ue.push(36064+lt),q.depthBuffer&&Ue.push(rt);let et=Ye.__ignoreDepthValues!==void 0?Ye.__ignoreDepthValues:!1;if(et===!1&&(q.depthBuffer&&($|=256),q.stencilBuffer&&($|=1024)),Ee&&e.framebufferRenderbuffer(36008,36064,36161,Ye.__webglColorRenderbuffer[lt]),et===!0&&(e.invalidateFramebuffer(36008,[rt]),e.invalidateFramebuffer(36009,[rt])),Ee){let pt=r.get(N[lt]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,pt,0)}e.blitFramebuffer(0,0,de,ze,0,0,de,ze,$,9728),p&&e.invalidateFramebuffer(36008,Ue)}if(i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),Ee)for(let lt=0;lt<N.length;lt++){i.bindFramebuffer(36160,Ye.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+lt,36161,Ye.__webglColorRenderbuffer[lt]);let et=r.get(N[lt]).__webglTexture;i.bindFramebuffer(36160,Ye.__webglFramebuffer),e.framebufferTexture2D(36009,36064+lt,3553,et,0)}i.bindFramebuffer(36009,Ye.__webglMultisampledFramebuffer)}}function $e(q){return Math.min(h,q.samples)}function Ke(q){let N=r.get(q);return o&&q.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&N.__useRenderToTexture!==!1}function bt(q){let N=a.render.frame;m.get(q)!==N&&(m.set(q,N),q.update())}function xt(q,N){let de=q.encoding,ze=q.format,$=q.type;return q.isCompressedTexture===!0||q.isVideoTexture===!0||q.format===CI||de!==Hu&&(de===Ri?o===!1?t.has("EXT_sRGB")===!0&&ze===$r?(q.format=CI,q.minFilter=Li,q.generateMipmaps=!1):N=rq.sRGBToLinear(N):(ze!==$r||$!==Ua)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",de)),N}this.allocateTextureUnit=B,this.resetTextureUnits=K,this.setTexture2D=F,this.setTexture2DArray=X,this.setTexture3D=Y,this.setTextureCube=le,this.rebindTextures=Ve,this.setupRenderTarget=Ge,this.updateRenderTargetMipmap=Qe,this.updateMultisampleRenderTarget=ot,this.setupDepthRenderbuffer=De,this.setupFrameBufferTexture=Ae,this.useMultisampledRTT=Ke}function fve(e,t,i){let r=i.isWebGL2;function n(s,a=null){let o;if(s===Ua)return 5121;if(s===Khe)return 32819;if(s===Zhe)return 32820;if(s===Xhe)return 5120;if(s===Yhe)return 5122;if(s===Q7)return 5123;if(s===Qhe)return 5124;if(s===gd)return 5125;if(s===br)return 5126;if(s===Pd)return r?5131:(o=t.get("OES_texture_half_float"),o!==null?o.HALF_FLOAT_OES:null);if(s===Jhe)return 6406;if(s===$r)return 6408;if(s===$he)return 6409;if(s===ede)return 6410;if(s===Rg)return 6402;if(s===Gg)return 34041;if(s===CI)return o=t.get("EXT_sRGB"),o!==null?o.SRGB_ALPHA_EXT:null;if(s===RE)return 6403;if(s===tde)return 36244;if(s===n2)return 33319;if(s===ide)return 33320;if(s===K7)return 36249;if(s===a3||s===o3||s===l3||s===u3)if(a===Ri)if(o=t.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(s===a3)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===o3)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===l3)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===u3)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=t.get("WEBGL_compressed_texture_s3tc"),o!==null){if(s===a3)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===o3)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===l3)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===u3)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===_U||s===SU||s===MU||s===AU)if(o=t.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(s===_U)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===SU)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===MU)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===AU)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===rde)return o=t.get("WEBGL_compressed_texture_etc1"),o!==null?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===EU||s===CU)if(o=t.get("WEBGL_compressed_texture_etc"),o!==null){if(s===EU)return a===Ri?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(s===CU)return a===Ri?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===TU||s===PU||s===DU||s===RU||s===IU||s===LU||s===OU||s===zU||s===kU||s===BU||s===NU||s===FU||s===UU||s===VU)if(o=t.get("WEBGL_compressed_texture_astc"),o!==null){if(s===TU)return a===Ri?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===PU)return a===Ri?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===DU)return a===Ri?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===RU)return a===Ri?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===IU)return a===Ri?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===LU)return a===Ri?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===OU)return a===Ri?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===zU)return a===Ri?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===kU)return a===Ri?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===BU)return a===Ri?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===NU)return a===Ri?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===FU)return a===Ri?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===UU)return a===Ri?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===VU)return a===Ri?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===c3)if(o=t.get("EXT_texture_compression_bptc"),o!==null){if(s===c3)return a===Ri?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(s===nde||s===jU||s===HU||s===WU)if(o=t.get("EXT_texture_compression_rgtc"),o!==null){if(s===c3)return o.COMPRESSED_RED_RGTC1_EXT;if(s===jU)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===HU)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===WU)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===Dg?r?34042:(o=t.get("WEBGL_depth_texture"),o!==null?o.UNSIGNED_INT_24_8_WEBGL:null):e[s]!==void 0?e[s]:null}return{convert:n}}var pve=class extends La{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}},yd=class extends vr{constructor(){super(),this.isGroup=!0,this.type="Group"}},mve={type:"move"},k3=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new yd,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new yd,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new H,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new H),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new yd,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new H,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new H),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){let t=this._hand;if(t)for(let i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let r=null,n=null,s=null,a=this._targetRay,o=this._grip,l=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(l&&e.hand){s=!0;for(let m of e.hand.values()){let v=t.getJointPose(m,i),g=this._getHandJoint(l,m);v!==null&&(g.matrix.fromArray(v.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.jointRadius=v.radius),g.visible=v!==null}let u=l.joints["index-finger-tip"],c=l.joints["thumb-tip"],h=u.position.distanceTo(c.position),d=.02,p=.005;l.inputState.pinching&&h>d+p?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&h<=d-p&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else o!==null&&e.gripSpace&&(n=t.getPose(e.gripSpace,i),n!==null&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1));a!==null&&(r=t.getPose(e.targetRaySpace,i),r===null&&n!==null&&(r=n),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(mve)))}return a!==null&&(a.visible=r!==null),o!==null&&(o.visible=n!==null),l!==null&&(l.visible=s!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){let i=new yd;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}},ox=class extends tn{constructor(e,t,i,r,n,s,a,o,l,u){if(u=u!==void 0?u:Rg,u!==Rg&&u!==Gg)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&u===Rg&&(i=gd),i===void 0&&u===Gg&&(i=Dg),super(null,r,n,s,a,o,u,i,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:Ni,this.minFilter=o!==void 0?o:Ni,this.flipY=!1,this.generateMipmaps=!1}},gve=class extends Ys{constructor(e,t){super();let i=this,r=null,n=1,s=null,a="local-floor",o=1,l=null,u=null,c=null,h=null,d=null,p=null,m=t.getContextAttributes(),v=null,g=null,w=[],S=[],_=new Set,A=new Map,C=new La;C.layers.enable(1),C.viewport=new bi;let E=new La;E.layers.enable(2),E.viewport=new bi;let I=[C,E],T=new pve;T.layers.enable(1),T.layers.enable(2);let D=null,L=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(X){let Y=w[X];return Y===void 0&&(Y=new k3,w[X]=Y),Y.getTargetRaySpace()},this.getControllerGrip=function(X){let Y=w[X];return Y===void 0&&(Y=new k3,w[X]=Y),Y.getGripSpace()},this.getHand=function(X){let Y=w[X];return Y===void 0&&(Y=new k3,w[X]=Y),Y.getHandSpace()};function z(X){let Y=S.indexOf(X.inputSource);if(Y===-1)return;let le=w[Y];le!==void 0&&le.dispatchEvent({type:X.type,data:X.inputSource})}function G(){r.removeEventListener("select",z),r.removeEventListener("selectstart",z),r.removeEventListener("selectend",z),r.removeEventListener("squeeze",z),r.removeEventListener("squeezestart",z),r.removeEventListener("squeezeend",z),r.removeEventListener("end",G),r.removeEventListener("inputsourceschange",V);for(let X=0;X<w.length;X++){let Y=S[X];Y!==null&&(S[X]=null,w[X].disconnect(Y))}D=null,L=null,e.setRenderTarget(v),d=null,h=null,c=null,r=null,g=null,F.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(X){n=X,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(X){a=X,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(X){l=X},this.getBaseLayer=function(){return h!==null?h:d},this.getBinding=function(){return c},this.getFrame=function(){return p},this.getSession=function(){return r},this.setSession=async function(X){if(r=X,r!==null){if(v=e.getRenderTarget(),r.addEventListener("select",z),r.addEventListener("selectstart",z),r.addEventListener("selectend",z),r.addEventListener("squeeze",z),r.addEventListener("squeezestart",z),r.addEventListener("squeezeend",z),r.addEventListener("end",G),r.addEventListener("inputsourceschange",V),m.xrCompatible!==!0&&await t.makeXRCompatible(),r.renderState.layers===void 0||e.capabilities.isWebGL2===!1){let Y={antialias:r.renderState.layers===void 0?m.antialias:!0,alpha:m.alpha,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:n};d=new XRWebGLLayer(r,t,Y),r.updateRenderState({baseLayer:d}),g=new Ki(d.framebufferWidth,d.framebufferHeight,{format:$r,type:Ua,encoding:e.outputEncoding,stencilBuffer:m.stencil})}else{let Y=null,le=null,oe=null;m.depth&&(oe=m.stencil?35056:33190,Y=m.stencil?Gg:Rg,le=m.stencil?Dg:gd);let re={colorFormat:32856,depthFormat:oe,scaleFactor:n};c=new XRWebGLBinding(r,t),h=c.createProjectionLayer(re),r.updateRenderState({layers:[h]}),g=new Ki(h.textureWidth,h.textureHeight,{format:$r,type:Ua,depthTexture:new ox(h.textureWidth,h.textureHeight,le,void 0,void 0,void 0,void 0,void 0,void 0,Y),stencilBuffer:m.stencil,encoding:e.outputEncoding,samples:m.antialias?4:0});let ue=e.properties.get(g);ue.__ignoreDepthValues=h.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(o),l=null,s=await r.requestReferenceSpace(a),F.setContext(r),F.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};function V(X){for(let Y=0;Y<X.removed.length;Y++){let le=X.removed[Y],oe=S.indexOf(le);oe>=0&&(S[oe]=null,w[oe].disconnect(le))}for(let Y=0;Y<X.added.length;Y++){let le=X.added[Y],oe=S.indexOf(le);if(oe===-1){for(let ue=0;ue<w.length;ue++)if(ue>=S.length){S.push(le),oe=ue;break}else if(S[ue]===null){S[ue]=le,oe=ue;break}if(oe===-1)break}let re=w[oe];re&&re.connect(le)}}let j=new H,J=new H;function ne(X,Y,le){j.setFromMatrixPosition(Y.matrixWorld),J.setFromMatrixPosition(le.matrixWorld);let oe=j.distanceTo(J),re=Y.projectionMatrix.elements,ue=le.projectionMatrix.elements,me=re[14]/(re[10]-1),he=re[14]/(re[10]+1),Ce=(re[9]+1)/re[5],Ae=(re[9]-1)/re[5],Ie=(re[8]-1)/re[0],Me=(ue[8]+1)/ue[0],De=me*Ie,Ve=me*Me,Ge=oe/(-Ie+Me),Qe=Ge*-Ie;Y.matrixWorld.decompose(X.position,X.quaternion,X.scale),X.translateX(Qe),X.translateZ(Ge),X.matrixWorld.compose(X.position,X.quaternion,X.scale),X.matrixWorldInverse.copy(X.matrixWorld).invert();let ot=me+Ge,$e=he+Ge,Ke=De-Qe,bt=Ve+(oe-Qe),xt=Ce*he/$e*ot,q=Ae*he/$e*ot;X.projectionMatrix.makePerspective(Ke,bt,xt,q,ot,$e)}function K(X,Y){Y===null?X.matrixWorld.copy(X.matrix):X.matrixWorld.multiplyMatrices(Y.matrixWorld,X.matrix),X.matrixWorldInverse.copy(X.matrixWorld).invert()}this.updateCamera=function(X){if(r===null)return;T.near=E.near=C.near=X.near,T.far=E.far=C.far=X.far,(D!==T.near||L!==T.far)&&(r.updateRenderState({depthNear:T.near,depthFar:T.far}),D=T.near,L=T.far);let Y=X.parent,le=T.cameras;K(T,Y);for(let re=0;re<le.length;re++)K(le[re],Y);T.matrixWorld.decompose(T.position,T.quaternion,T.scale),X.matrix.copy(T.matrix),X.matrix.decompose(X.position,X.quaternion,X.scale);let oe=X.children;for(let re=0,ue=oe.length;re<ue;re++)oe[re].updateMatrixWorld(!0);le.length===2?ne(T,C,E):T.projectionMatrix.copy(C.projectionMatrix)},this.getCamera=function(){return T},this.getFoveation=function(){if(!(h===null&&d===null))return o},this.setFoveation=function(X){o=X,h!==null&&(h.fixedFoveation=X),d!==null&&d.fixedFoveation!==void 0&&(d.fixedFoveation=X)},this.getPlanes=function(){return _};let B=null;function Z(X,Y){if(u=Y.getViewerPose(l||s),p=Y,u!==null){let le=u.views;d!==null&&(e.setRenderTargetFramebuffer(g,d.framebuffer),e.setRenderTarget(g));let oe=!1;le.length!==T.cameras.length&&(T.cameras.length=0,oe=!0);for(let re=0;re<le.length;re++){let ue=le[re],me=null;if(d!==null)me=d.getViewport(ue);else{let Ce=c.getViewSubImage(h,ue);me=Ce.viewport,re===0&&(e.setRenderTargetTextures(g,Ce.colorTexture,h.ignoreDepthValues?void 0:Ce.depthStencilTexture),e.setRenderTarget(g))}let he=I[re];he===void 0&&(he=new La,he.layers.enable(re),he.viewport=new bi,I[re]=he),he.matrix.fromArray(ue.transform.matrix),he.projectionMatrix.fromArray(ue.projectionMatrix),he.viewport.set(me.x,me.y,me.width,me.height),re===0&&T.matrix.copy(he.matrix),oe===!0&&T.cameras.push(he)}}for(let le=0;le<w.length;le++){let oe=S[le],re=w[le];oe!==null&&re!==void 0&&re.update(oe,Y,l||s)}if(B&&B(X,Y),Y.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:Y.detectedPlanes});let le=null;for(let oe of _)Y.detectedPlanes.has(oe)||(le===null&&(le=[]),le.push(oe));if(le!==null)for(let oe of le)_.delete(oe),A.delete(oe),i.dispatchEvent({type:"planeremoved",data:oe});for(let oe of Y.detectedPlanes)if(!_.has(oe))_.add(oe),A.set(oe,Y.lastChangedTime),i.dispatchEvent({type:"planeadded",data:oe});else{let re=A.get(oe);oe.lastChangedTime>re&&(A.set(oe,oe.lastChangedTime),i.dispatchEvent({type:"planechanged",data:oe}))}}p=null}let F=new uq;F.setAnimationLoop(Z),this.setAnimationLoop=function(X){B=X},this.dispose=function(){}}};function vve(e,t){function i(v,g){g.color.getRGB(v.fogColor.value,lq(e)),g.isFog?(v.fogNear.value=g.near,v.fogFar.value=g.far):g.isFogExp2&&(v.fogDensity.value=g.density)}function r(v,g,w,S,_){g.isMeshBasicMaterial||g.isMeshLambertMaterial?n(v,g):g.isMeshToonMaterial?(n(v,g),c(v,g)):g.isMeshPhongMaterial?(n(v,g),u(v,g)):g.isMeshStandardMaterial?(n(v,g),h(v,g),g.isMeshPhysicalMaterial&&d(v,g,_)):g.isMeshMatcapMaterial?(n(v,g),p(v,g)):g.isMeshDepthMaterial?n(v,g):g.isMeshDistanceMaterial?(n(v,g),m(v,g)):g.isMeshNormalMaterial?n(v,g):g.isLineBasicMaterial?(s(v,g),g.isLineDashedMaterial&&a(v,g)):g.isPointsMaterial?o(v,g,w,S):g.isSpriteMaterial?l(v,g):g.isShadowMaterial?(v.color.value.copy(g.color),v.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}function n(v,g){v.opacity.value=g.opacity,g.color&&v.diffuse.value.copy(g.color),g.emissive&&v.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(v.map.value=g.map),g.alphaMap&&(v.alphaMap.value=g.alphaMap),g.bumpMap&&(v.bumpMap.value=g.bumpMap,v.bumpScale.value=g.bumpScale,g.side===Hs&&(v.bumpScale.value*=-1)),g.displacementMap&&(v.displacementMap.value=g.displacementMap,v.displacementScale.value=g.displacementScale,v.displacementBias.value=g.displacementBias),g.emissiveMap&&(v.emissiveMap.value=g.emissiveMap),g.normalMap&&(v.normalMap.value=g.normalMap,v.normalScale.value.copy(g.normalScale),g.side===Hs&&v.normalScale.value.negate()),g.specularMap&&(v.specularMap.value=g.specularMap),g.alphaTest>0&&(v.alphaTest.value=g.alphaTest);let w=t.get(g).envMap;if(w&&(v.envMap.value=w,v.flipEnvMap.value=w.isCubeTexture&&w.isRenderTargetTexture===!1?-1:1,v.reflectivity.value=g.reflectivity,v.ior.value=g.ior,v.refractionRatio.value=g.refractionRatio),g.lightMap){v.lightMap.value=g.lightMap;let A=e.physicallyCorrectLights!==!0?Math.PI:1;v.lightMapIntensity.value=g.lightMapIntensity*A}g.aoMap&&(v.aoMap.value=g.aoMap,v.aoMapIntensity.value=g.aoMapIntensity);let S;g.map?S=g.map:g.specularMap?S=g.specularMap:g.displacementMap?S=g.displacementMap:g.normalMap?S=g.normalMap:g.bumpMap?S=g.bumpMap:g.roughnessMap?S=g.roughnessMap:g.metalnessMap?S=g.metalnessMap:g.alphaMap?S=g.alphaMap:g.emissiveMap?S=g.emissiveMap:g.clearcoatMap?S=g.clearcoatMap:g.clearcoatNormalMap?S=g.clearcoatNormalMap:g.clearcoatRoughnessMap?S=g.clearcoatRoughnessMap:g.iridescenceMap?S=g.iridescenceMap:g.iridescenceThicknessMap?S=g.iridescenceThicknessMap:g.specularIntensityMap?S=g.specularIntensityMap:g.specularColorMap?S=g.specularColorMap:g.transmissionMap?S=g.transmissionMap:g.thicknessMap?S=g.thicknessMap:g.sheenColorMap?S=g.sheenColorMap:g.sheenRoughnessMap&&(S=g.sheenRoughnessMap),S!==void 0&&(S.isWebGLRenderTarget&&(S=S.texture),S.matrixAutoUpdate===!0&&S.updateMatrix(),v.uvTransform.value.copy(S.matrix));let _;g.aoMap?_=g.aoMap:g.lightMap&&(_=g.lightMap),_!==void 0&&(_.isWebGLRenderTarget&&(_=_.texture),_.matrixAutoUpdate===!0&&_.updateMatrix(),v.uv2Transform.value.copy(_.matrix))}function s(v,g){v.diffuse.value.copy(g.color),v.opacity.value=g.opacity}function a(v,g){v.dashSize.value=g.dashSize,v.totalSize.value=g.dashSize+g.gapSize,v.scale.value=g.scale}function o(v,g,w,S){v.diffuse.value.copy(g.color),v.opacity.value=g.opacity,v.size.value=g.size*w,v.scale.value=S*.5,g.map&&(v.map.value=g.map),g.alphaMap&&(v.alphaMap.value=g.alphaMap),g.alphaTest>0&&(v.alphaTest.value=g.alphaTest);let _;g.map?_=g.map:g.alphaMap&&(_=g.alphaMap),_!==void 0&&(_.matrixAutoUpdate===!0&&_.updateMatrix(),v.uvTransform.value.copy(_.matrix))}function l(v,g){v.diffuse.value.copy(g.color),v.opacity.value=g.opacity,v.rotation.value=g.rotation,g.map&&(v.map.value=g.map),g.alphaMap&&(v.alphaMap.value=g.alphaMap),g.alphaTest>0&&(v.alphaTest.value=g.alphaTest);let w;g.map?w=g.map:g.alphaMap&&(w=g.alphaMap),w!==void 0&&(w.matrixAutoUpdate===!0&&w.updateMatrix(),v.uvTransform.value.copy(w.matrix))}function u(v,g){v.specular.value.copy(g.specular),v.shininess.value=Math.max(g.shininess,1e-4)}function c(v,g){g.gradientMap&&(v.gradientMap.value=g.gradientMap)}function h(v,g){v.roughness.value=g.roughness,v.metalness.value=g.metalness,g.roughnessMap&&(v.roughnessMap.value=g.roughnessMap),g.metalnessMap&&(v.metalnessMap.value=g.metalnessMap),t.get(g).envMap&&(v.envMapIntensity.value=g.envMapIntensity)}function d(v,g,w){v.ior.value=g.ior,g.sheen>0&&(v.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),v.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(v.sheenColorMap.value=g.sheenColorMap),g.sheenRoughnessMap&&(v.sheenRoughnessMap.value=g.sheenRoughnessMap)),g.clearcoat>0&&(v.clearcoat.value=g.clearcoat,v.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(v.clearcoatMap.value=g.clearcoatMap),g.clearcoatRoughnessMap&&(v.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap),g.clearcoatNormalMap&&(v.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),v.clearcoatNormalMap.value=g.clearcoatNormalMap,g.side===Hs&&v.clearcoatNormalScale.value.negate())),g.iridescence>0&&(v.iridescence.value=g.iridescence,v.iridescenceIOR.value=g.iridescenceIOR,v.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],v.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&(v.iridescenceMap.value=g.iridescenceMap),g.iridescenceThicknessMap&&(v.iridescenceThicknessMap.value=g.iridescenceThicknessMap)),g.transmission>0&&(v.transmission.value=g.transmission,v.transmissionSamplerMap.value=w.texture,v.transmissionSamplerSize.value.set(w.width,w.height),g.transmissionMap&&(v.transmissionMap.value=g.transmissionMap),v.thickness.value=g.thickness,g.thicknessMap&&(v.thicknessMap.value=g.thicknessMap),v.attenuationDistance.value=g.attenuationDistance,v.attenuationColor.value.copy(g.attenuationColor)),v.specularIntensity.value=g.specularIntensity,v.specularColor.value.copy(g.specularColor),g.specularIntensityMap&&(v.specularIntensityMap.value=g.specularIntensityMap),g.specularColorMap&&(v.specularColorMap.value=g.specularColorMap)}function p(v,g){g.matcap&&(v.matcap.value=g.matcap)}function m(v,g){v.referencePosition.value.copy(g.referencePosition),v.nearDistance.value=g.nearDistance,v.farDistance.value=g.farDistance}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function yve(e,t,i,r){let n={},s={},a=[],o=i.isWebGL2?e.getParameter(35375):0;function l(S,_){let A=_.program;r.uniformBlockBinding(S,A)}function u(S,_){let A=n[S.id];A===void 0&&(m(S),A=c(S),n[S.id]=A,S.addEventListener("dispose",g));let C=_.program;r.updateUBOMapping(S,C);let E=t.render.frame;s[S.id]!==E&&(d(S),s[S.id]=E)}function c(S){let _=h();S.__bindingPointIndex=_;let A=e.createBuffer(),C=S.__size,E=S.usage;return e.bindBuffer(35345,A),e.bufferData(35345,C,E),e.bindBuffer(35345,null),e.bindBufferBase(35345,_,A),A}function h(){for(let S=0;S<o;S++)if(a.indexOf(S)===-1)return a.push(S),S;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(S){let _=n[S.id],A=S.uniforms,C=S.__cache;e.bindBuffer(35345,_);for(let E=0,I=A.length;E<I;E++){let T=A[E];if(p(T,E,C)===!0){let D=T.__offset,L=Array.isArray(T.value)?T.value:[T.value],z=0;for(let G=0;G<L.length;G++){let V=L[G],j=v(V);typeof V=="number"?(T.__data[0]=V,e.bufferSubData(35345,D+z,T.__data)):V.isMatrix3?(T.__data[0]=V.elements[0],T.__data[1]=V.elements[1],T.__data[2]=V.elements[2],T.__data[3]=V.elements[0],T.__data[4]=V.elements[3],T.__data[5]=V.elements[4],T.__data[6]=V.elements[5],T.__data[7]=V.elements[0],T.__data[8]=V.elements[6],T.__data[9]=V.elements[7],T.__data[10]=V.elements[8],T.__data[11]=V.elements[0]):(V.toArray(T.__data,z),z+=j.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(35345,D,T.__data)}}e.bindBuffer(35345,null)}function p(S,_,A){let C=S.value;if(A[_]===void 0){if(typeof C=="number")A[_]=C;else{let E=Array.isArray(C)?C:[C],I=[];for(let T=0;T<E.length;T++)I.push(E[T].clone());A[_]=I}return!0}else if(typeof C=="number"){if(A[_]!==C)return A[_]=C,!0}else{let E=Array.isArray(A[_])?A[_]:[A[_]],I=Array.isArray(C)?C:[C];for(let T=0;T<E.length;T++){let D=E[T];if(D.equals(I[T])===!1)return D.copy(I[T]),!0}}return!1}function m(S){let _=S.uniforms,A=0,C=16,E=0;for(let I=0,T=_.length;I<T;I++){let D=_[I],L={boundary:0,storage:0},z=Array.isArray(D.value)?D.value:[D.value];for(let G=0,V=z.length;G<V;G++){let j=z[G],J=v(j);L.boundary+=J.boundary,L.storage+=J.storage}if(D.__data=new Float32Array(L.storage/Float32Array.BYTES_PER_ELEMENT),D.__offset=A,I>0){E=A%C;let G=C-E;E!==0&&G-L.boundary<0&&(A+=C-E,D.__offset=A)}A+=L.storage}return E=A%C,E>0&&(A+=C-E),S.__size=A,S.__cache={},this}function v(S){let _={boundary:0,storage:0};return typeof S=="number"?(_.boundary=4,_.storage=4):S.isVector2?(_.boundary=8,_.storage=8):S.isVector3||S.isColor?(_.boundary=16,_.storage=12):S.isVector4?(_.boundary=16,_.storage=16):S.isMatrix3?(_.boundary=48,_.storage=48):S.isMatrix4?(_.boundary=64,_.storage=64):S.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",S),_}function g(S){let _=S.target;_.removeEventListener("dispose",g);let A=a.indexOf(_.__bindingPointIndex);a.splice(A,1),e.deleteBuffer(n[_.id]),delete n[_.id],delete s[_.id]}function w(){for(let S in n)e.deleteBuffer(n[S]);a=[],n={},s={}}return{bind:l,update:u,dispose:w}}function xve(){let e=Hb("canvas");return e.style.display="block",e}function mq(e={}){this.isWebGLRenderer=!0;let t=e.canvas!==void 0?e.canvas:xve(),i=e.context!==void 0?e.context:null,r=e.depth!==void 0?e.depth:!0,n=e.stencil!==void 0?e.stencil:!0,s=e.antialias!==void 0?e.antialias:!1,a=e.premultipliedAlpha!==void 0?e.premultipliedAlpha:!0,o=e.preserveDrawingBuffer!==void 0?e.preserveDrawingBuffer:!1,l=e.powerPreference!==void 0?e.powerPreference:"default",u=e.failIfMajorPerformanceCaveat!==void 0?e.failIfMajorPerformanceCaveat:!1,c;i!==null?c=i.getContextAttributes().alpha:c=e.alpha!==void 0?e.alpha:!1;let h=null,d=null,p=[],m=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Hu,this.physicallyCorrectLights=!1,this.toneMapping=Wc,this.toneMappingExposure=1;let v=this,g=!1,w=0,S=0,_=null,A=-1,C=null,E=new bi,I=new bi,T=null,D=t.width,L=t.height,z=1,G=null,V=null,j=new bi(0,0,D,L),J=new bi(0,0,D,L),ne=!1,K=new Zz,B=!1,Z=!1,F=null,X=new yt,Y=new Pe,le=new H,oe={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function re(){return _===null?z:1}let ue=i;function me(te,ve){for(let fe=0;fe<te.length;fe++){let ye=te[fe],Ne=t.getContext(ye,ve);if(Ne!==null)return Ne}return null}try{let te={alpha:!0,depth:r,stencil:n,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:o,powerPreference:l,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Ox}`),t.addEventListener("webglcontextlost",mt,!1),t.addEventListener("webglcontextrestored",dt,!1),t.addEventListener("webglcontextcreationerror",_e,!1),ue===null){let ve=["webgl2","webgl","experimental-webgl"];if(v.isWebGL1Renderer===!0&&ve.shift(),ue=me(ve,te),ue===null)throw me(ve)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}ue.getShaderPrecisionFormat===void 0&&(ue.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(te){throw console.error("THREE.WebGLRenderer: "+te.message),te}let he,Ce,Ae,Ie,Me,De,Ve,Ge,Qe,ot,$e,Ke,bt,xt,q,N,de,ze,$,Ue,rt,Ye,Ee,lt;function et(){he=new Ime(ue),Ce=new Eme(ue,he,e),he.init(Ce),Ye=new fve(ue,he,Ce),Ae=new hve(ue,he,Ce),Ie=new zme,Me=new Jge,De=new dve(ue,he,Ae,Me,Ce,Ye,Ie),Ve=new Tme(v),Ge=new Rme(v),Qe=new Wde(ue,Ce),Ee=new Mme(ue,he,Qe,Ce),ot=new Lme(ue,Qe,Ie,Ee),$e=new Fme(ue,ot,Qe,Ie),$=new Nme(ue,Ce,De),N=new Cme(Me),Ke=new Zge(v,Ve,Ge,he,Ce,Ee,N),bt=new vve(v,Me),xt=new eve,q=new ave(he,Ce),ze=new Sme(v,Ve,Ge,Ae,$e,c,a),de=new cve(v,$e,Ce),lt=new yve(ue,Ie,Ce,Ae),Ue=new Ame(ue,he,Ie,Ce),rt=new Ome(ue,he,Ie,Ce),Ie.programs=Ke.programs,v.capabilities=Ce,v.extensions=he,v.properties=Me,v.renderLists=xt,v.shadowMap=de,v.state=Ae,v.info=Ie}et();let pt=new gve(v,ue);this.xr=pt,this.getContext=function(){return ue},this.getContextAttributes=function(){return ue.getContextAttributes()},this.forceContextLoss=function(){let te=he.get("WEBGL_lose_context");te&&te.loseContext()},this.forceContextRestore=function(){let te=he.get("WEBGL_lose_context");te&&te.restoreContext()},this.getPixelRatio=function(){return z},this.setPixelRatio=function(te){te!==void 0&&(z=te,this.setSize(D,L,!1))},this.getSize=function(te){return te.set(D,L)},this.setSize=function(te,ve,fe){if(pt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}D=te,L=ve,t.width=Math.floor(te*z),t.height=Math.floor(ve*z),fe!==!1&&(t.style.width=te+"px",t.style.height=ve+"px"),this.setViewport(0,0,te,ve)},this.getDrawingBufferSize=function(te){return te.set(D*z,L*z).floor()},this.setDrawingBufferSize=function(te,ve,fe){D=te,L=ve,z=fe,t.width=Math.floor(te*fe),t.height=Math.floor(ve*fe),this.setViewport(0,0,te,ve)},this.getCurrentViewport=function(te){return te.copy(E)},this.getViewport=function(te){return te.copy(j)},this.setViewport=function(te,ve,fe,ye){te.isVector4?j.set(te.x,te.y,te.z,te.w):j.set(te,ve,fe,ye),Ae.viewport(E.copy(j).multiplyScalar(z).floor())},this.getScissor=function(te){return te.copy(J)},this.setScissor=function(te,ve,fe,ye){te.isVector4?J.set(te.x,te.y,te.z,te.w):J.set(te,ve,fe,ye),Ae.scissor(I.copy(J).multiplyScalar(z).floor())},this.getScissorTest=function(){return ne},this.setScissorTest=function(te){Ae.setScissorTest(ne=te)},this.setOpaqueSort=function(te){G=te},this.setTransparentSort=function(te){V=te},this.getClearColor=function(te){return te.copy(ze.getClearColor())},this.setClearColor=function(){ze.setClearColor.apply(ze,arguments)},this.getClearAlpha=function(){return ze.getClearAlpha()},this.setClearAlpha=function(){ze.setClearAlpha.apply(ze,arguments)},this.clear=function(te=!0,ve=!0,fe=!0){let ye=0;te&&(ye|=16384),ve&&(ye|=256),fe&&(ye|=1024),ue.clear(ye)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",mt,!1),t.removeEventListener("webglcontextrestored",dt,!1),t.removeEventListener("webglcontextcreationerror",_e,!1),xt.dispose(),q.dispose(),Me.dispose(),Ve.dispose(),Ge.dispose(),$e.dispose(),Ee.dispose(),lt.dispose(),Ke.dispose(),pt.dispose(),pt.removeEventListener("sessionstart",We),pt.removeEventListener("sessionend",ct),F&&(F.dispose(),F=null),Ut.stop()};function mt(te){te.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function dt(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;let te=Ie.autoReset,ve=de.enabled,fe=de.autoUpdate,ye=de.needsUpdate,Ne=de.type;et(),Ie.autoReset=te,de.enabled=ve,de.autoUpdate=fe,de.needsUpdate=ye,de.type=Ne}function _e(te){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",te.statusMessage)}function it(te){let ve=te.target;ve.removeEventListener("dispose",it),At(ve)}function At(te){ie(te),Me.remove(te)}function ie(te){let ve=Me.get(te).programs;ve!==void 0&&(ve.forEach(function(fe){Ke.releaseProgram(fe)}),te.isShaderMaterial&&Ke.releaseShaderCache(te))}this.renderBufferDirect=function(te,ve,fe,ye,Ne,gt){ve===null&&(ve=oe);let St=Ne.isMesh&&Ne.matrixWorld.determinant()<0,Tt=Xo(te,ve,fe,ye,Ne);Ae.setMaterial(ye,St);let Et=fe.index,Vt=1;ye.wireframe===!0&&(Et=ot.getWireframeAttribute(fe),Vt=2);let zt=fe.drawRange,Yt=fe.attributes.position,$t=zt.start*Vt,tr=(zt.start+zt.count)*Vt;gt!==null&&($t=Math.max($t,gt.start*Vt),tr=Math.min(tr,(gt.start+gt.count)*Vt)),Et!==null?($t=Math.max($t,0),tr=Math.min(tr,Et.count)):Yt!=null&&($t=Math.max($t,0),tr=Math.min(tr,Yt.count));let Qr=tr-$t;if(Qr<0||Qr===1/0)return;Ee.setup(Ne,ye,Tt,fe,Et);let ir,Rt=Ue;if(Et!==null&&(ir=Qe.get(Et),Rt=rt,Rt.setIndex(ir)),Ne.isMesh)ye.wireframe===!0?(Ae.setLineWidth(ye.wireframeLinewidth*re()),Rt.setMode(1)):Rt.setMode(4);else if(Ne.isLine){let _i=ye.linewidth;_i===void 0&&(_i=1),Ae.setLineWidth(_i*re()),Ne.isLineSegments?Rt.setMode(1):Ne.isLineLoop?Rt.setMode(2):Rt.setMode(3)}else Ne.isPoints?Rt.setMode(0):Ne.isSprite&&Rt.setMode(4);if(Ne.isInstancedMesh)Rt.renderInstances($t,Qr,Ne.count);else if(fe.isInstancedBufferGeometry){let _i=fe._maxInstanceCount!==void 0?fe._maxInstanceCount:1/0,Hi=Math.min(fe.instanceCount,_i);Rt.renderInstances($t,Qr,Hi)}else Rt.render($t,Qr)},this.compile=function(te,ve){function fe(ye,Ne,gt){ye.transparent===!0&&ye.side===Ba&&ye.forceSinglePass===!1?(ye.side=Hs,ye.needsUpdate=!0,ji(ye,Ne,gt),ye.side=ju,ye.needsUpdate=!0,ji(ye,Ne,gt),ye.side=Ba):ji(ye,Ne,gt)}d=q.get(te),d.init(),m.push(d),te.traverseVisible(function(ye){ye.isLight&&ye.layers.test(ve.layers)&&(d.pushLight(ye),ye.castShadow&&d.pushShadow(ye))}),d.setupLights(v.physicallyCorrectLights),te.traverse(function(ye){let Ne=ye.material;if(Ne)if(Array.isArray(Ne))for(let gt=0;gt<Ne.length;gt++){let St=Ne[gt];fe(St,te,ye)}else fe(Ne,te,ye)}),m.pop(),d=null};let we=null;function Re(te){we&&we(te)}function We(){Ut.stop()}function ct(){Ut.start()}let Ut=new uq;Ut.setAnimationLoop(Re),typeof self<"u"&&Ut.setContext(self),this.setAnimationLoop=function(te){we=te,pt.setAnimationLoop(te),te===null?Ut.stop():Ut.start()},pt.addEventListener("sessionstart",We),pt.addEventListener("sessionend",ct),this.render=function(te,ve){if(ve!==void 0&&ve.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(g===!0)return;te.matrixWorldAutoUpdate===!0&&te.updateMatrixWorld(),ve.parent===null&&ve.matrixWorldAutoUpdate===!0&&ve.updateMatrixWorld(),pt.enabled===!0&&pt.isPresenting===!0&&(pt.cameraAutoUpdate===!0&&pt.updateCamera(ve),ve=pt.getCamera()),te.isScene===!0&&te.onBeforeRender(v,te,ve,_),d=q.get(te,m.length),d.init(),m.push(d),X.multiplyMatrices(ve.projectionMatrix,ve.matrixWorldInverse),K.setFromProjectionMatrix(X),Z=this.localClippingEnabled,B=N.init(this.clippingPlanes,Z),h=xt.get(te,p.length),h.init(),p.push(h),si(te,ve,0,v.sortObjects),h.finish(),v.sortObjects===!0&&h.sort(G,V),B===!0&&N.beginShadows();let fe=d.state.shadowsArray;if(de.render(fe,te,ve),B===!0&&N.endShadows(),this.info.autoReset===!0&&this.info.reset(),ze.render(h,te),d.setupLights(v.physicallyCorrectLights),ve.isArrayCamera){let ye=ve.cameras;for(let Ne=0,gt=ye.length;Ne<gt;Ne++){let St=ye[Ne];Si(h,te,St,St.viewport)}}else Si(h,te,ve);_!==null&&(De.updateMultisampleRenderTarget(_),De.updateRenderTargetMipmap(_)),te.isScene===!0&&te.onAfterRender(v,te,ve),Ee.resetDefaultState(),A=-1,C=null,m.pop(),m.length>0?d=m[m.length-1]:d=null,p.pop(),p.length>0?h=p[p.length-1]:h=null};function si(te,ve,fe,ye){if(te.visible===!1)return;if(te.layers.test(ve.layers)){if(te.isGroup)fe=te.renderOrder;else if(te.isLOD)te.autoUpdate===!0&&te.update(ve);else if(te.isLight)d.pushLight(te),te.castShadow&&d.pushShadow(te);else if(te.isSprite){if(!te.frustumCulled||K.intersectsSprite(te)){ye&&le.setFromMatrixPosition(te.matrixWorld).applyMatrix4(X);let gt=$e.update(te),St=te.material;St.visible&&h.push(te,gt,St,fe,le.z,null)}}else if((te.isMesh||te.isLine||te.isPoints)&&(te.isSkinnedMesh&&te.skeleton.frame!==Ie.render.frame&&(te.skeleton.update(),te.skeleton.frame=Ie.render.frame),!te.frustumCulled||K.intersectsObject(te))){ye&&le.setFromMatrixPosition(te.matrixWorld).applyMatrix4(X);let gt=$e.update(te),St=te.material;if(Array.isArray(St)){let Tt=gt.groups;for(let Et=0,Vt=Tt.length;Et<Vt;Et++){let zt=Tt[Et],Yt=St[zt.materialIndex];Yt&&Yt.visible&&h.push(te,gt,Yt,fe,le.z,zt)}}else St.visible&&h.push(te,gt,St,fe,le.z,null)}}let Ne=te.children;for(let gt=0,St=Ne.length;gt<St;gt++)si(Ne[gt],ve,fe,ye)}function Si(te,ve,fe,ye){let Ne=te.opaque,gt=te.transmissive,St=te.transparent;d.setupLightsView(fe),B===!0&&N.setGlobalState(v.clippingPlanes,fe),gt.length>0&&ar(Ne,ve,fe),ye&&Ae.viewport(E.copy(ye)),Ne.length>0&&ri(Ne,ve,fe),gt.length>0&&ri(gt,ve,fe),St.length>0&&ri(St,ve,fe),Ae.buffers.depth.setTest(!0),Ae.buffers.depth.setMask(!0),Ae.buffers.color.setMask(!0),Ae.setPolygonOffset(!1)}function ar(te,ve,fe){let ye=Ce.isWebGL2;F===null&&(F=new Ki(1,1,{generateMipmaps:!0,type:he.has("EXT_color_buffer_half_float")?Pd:Ua,minFilter:sx,samples:ye&&s===!0?4:0})),v.getDrawingBufferSize(Y),ye?F.setSize(Y.x,Y.y):F.setSize(u2(Y.x),u2(Y.y));let Ne=v.getRenderTarget();v.setRenderTarget(F),v.clear();let gt=v.toneMapping;v.toneMapping=Wc,ri(te,ve,fe),v.toneMapping=gt,De.updateMultisampleRenderTarget(F),De.updateRenderTargetMipmap(F),v.setRenderTarget(Ne)}function ri(te,ve,fe){let ye=ve.isScene===!0?ve.overrideMaterial:null;for(let Ne=0,gt=te.length;Ne<gt;Ne++){let St=te[Ne],Tt=St.object,Et=St.geometry,Vt=ye===null?St.material:ye,zt=St.group;Tt.layers.test(fe.layers)&&Yi(Tt,ve,fe,Et,Vt,zt)}}function Yi(te,ve,fe,ye,Ne,gt){te.onBeforeRender(v,ve,fe,ye,Ne,gt),te.modelViewMatrix.multiplyMatrices(fe.matrixWorldInverse,te.matrixWorld),te.normalMatrix.getNormalMatrix(te.modelViewMatrix),Ne.onBeforeRender(v,ve,fe,ye,te,gt),Ne.transparent===!0&&Ne.side===Ba&&Ne.forceSinglePass===!1?(Ne.side=Hs,Ne.needsUpdate=!0,v.renderBufferDirect(fe,ve,ye,Ne,te,gt),Ne.side=ju,Ne.needsUpdate=!0,v.renderBufferDirect(fe,ve,ye,Ne,te,gt),Ne.side=Ba):v.renderBufferDirect(fe,ve,ye,Ne,te,gt),te.onAfterRender(v,ve,fe,ye,Ne,gt)}function ji(te,ve,fe){ve.isScene!==!0&&(ve=oe);let ye=Me.get(te),Ne=d.state.lights,gt=d.state.shadowsArray,St=Ne.state.version,Tt=Ke.getParameters(te,Ne.state,gt,ve,fe),Et=Ke.getProgramCacheKey(Tt),Vt=ye.programs;ye.environment=te.isMeshStandardMaterial?ve.environment:null,ye.fog=ve.fog,ye.envMap=(te.isMeshStandardMaterial?Ge:Ve).get(te.envMap||ye.environment),Vt===void 0&&(te.addEventListener("dispose",it),Vt=new Map,ye.programs=Vt);let zt=Vt.get(Et);if(zt!==void 0){if(ye.currentProgram===zt&&ye.lightsStateVersion===St)return po(te,Tt),zt}else Tt.uniforms=Ke.getUniforms(te),te.onBuild(fe,Tt,v),te.onBeforeCompile(Tt,v),zt=Ke.acquireProgram(Tt,Et),Vt.set(Et,zt),ye.uniforms=Tt.uniforms;let Yt=ye.uniforms;(!te.isShaderMaterial&&!te.isRawShaderMaterial||te.clipping===!0)&&(Yt.clippingPlanes=N.uniform),po(te,Tt),ye.needsLights=ge(te),ye.lightsStateVersion=St,ye.needsLights&&(Yt.ambientLightColor.value=Ne.state.ambient,Yt.lightProbe.value=Ne.state.probe,Yt.directionalLights.value=Ne.state.directional,Yt.directionalLightShadows.value=Ne.state.directionalShadow,Yt.spotLights.value=Ne.state.spot,Yt.spotLightShadows.value=Ne.state.spotShadow,Yt.rectAreaLights.value=Ne.state.rectArea,Yt.ltc_1.value=Ne.state.rectAreaLTC1,Yt.ltc_2.value=Ne.state.rectAreaLTC2,Yt.pointLights.value=Ne.state.point,Yt.pointLightShadows.value=Ne.state.pointShadow,Yt.hemisphereLights.value=Ne.state.hemi,Yt.directionalShadowMap.value=Ne.state.directionalShadowMap,Yt.directionalShadowMatrix.value=Ne.state.directionalShadowMatrix,Yt.spotShadowMap.value=Ne.state.spotShadowMap,Yt.spotLightMatrix.value=Ne.state.spotLightMatrix,Yt.spotLightMap.value=Ne.state.spotLightMap,Yt.pointShadowMap.value=Ne.state.pointShadowMap,Yt.pointShadowMatrix.value=Ne.state.pointShadowMatrix);let $t=zt.getUniforms(),tr=LE.seqWithValue($t.seq,Yt);return ye.currentProgram=zt,ye.uniformsList=tr,zt}function po(te,ve){let fe=Me.get(te);fe.outputEncoding=ve.outputEncoding,fe.instancing=ve.instancing,fe.skinning=ve.skinning,fe.morphTargets=ve.morphTargets,fe.morphNormals=ve.morphNormals,fe.morphColors=ve.morphColors,fe.morphTargetsCount=ve.morphTargetsCount,fe.numClippingPlanes=ve.numClippingPlanes,fe.numIntersection=ve.numClipIntersection,fe.vertexAlphas=ve.vertexAlphas,fe.vertexTangents=ve.vertexTangents,fe.toneMapping=ve.toneMapping}function Xo(te,ve,fe,ye,Ne){ve.isScene!==!0&&(ve=oe),De.resetTextureUnits();let gt=ve.fog,St=ye.isMeshStandardMaterial?ve.environment:null,Tt=_===null?v.outputEncoding:_.isXRRenderTarget===!0?_.texture.encoding:Hu,Et=(ye.isMeshStandardMaterial?Ge:Ve).get(ye.envMap||St),Vt=ye.vertexColors===!0&&!!fe.attributes.color&&fe.attributes.color.itemSize===4,zt=!!ye.normalMap&&!!fe.attributes.tangent,Yt=!!fe.morphAttributes.position,$t=!!fe.morphAttributes.normal,tr=!!fe.morphAttributes.color,Qr=ye.toneMapped?v.toneMapping:Wc,ir=fe.morphAttributes.position||fe.morphAttributes.normal||fe.morphAttributes.color,Rt=ir!==void 0?ir.length:0,_i=Me.get(ye),Hi=d.state.lights;if(B===!0&&(Z===!0||te!==C)){let ce=te===C&&ye.id===A;N.setState(ye,te,ce)}let ui=!1;ye.version===_i.__version?(_i.needsLights&&_i.lightsStateVersion!==Hi.state.version||_i.outputEncoding!==Tt||Ne.isInstancedMesh&&_i.instancing===!1||!Ne.isInstancedMesh&&_i.instancing===!0||Ne.isSkinnedMesh&&_i.skinning===!1||!Ne.isSkinnedMesh&&_i.skinning===!0||_i.envMap!==Et||ye.fog===!0&&_i.fog!==gt||_i.numClippingPlanes!==void 0&&(_i.numClippingPlanes!==N.numPlanes||_i.numIntersection!==N.numIntersection)||_i.vertexAlphas!==Vt||_i.vertexTangents!==zt||_i.morphTargets!==Yt||_i.morphNormals!==$t||_i.morphColors!==tr||_i.toneMapping!==Qr||Ce.isWebGL2===!0&&_i.morphTargetsCount!==Rt)&&(ui=!0):(ui=!0,_i.__version=ye.version);let ls=_i.currentProgram;ui===!0&&(ls=ji(ye,ve,Ne));let us=!1,hn=!1,Ui=!1,ee=ls.getUniforms(),ae=_i.uniforms;if(Ae.useProgram(ls.program)&&(us=!0,hn=!0,Ui=!0),ye.id!==A&&(A=ye.id,hn=!0),us||C!==te){if(ee.setValue(ue,"projectionMatrix",te.projectionMatrix),Ce.logarithmicDepthBuffer&&ee.setValue(ue,"logDepthBufFC",2/(Math.log(te.far+1)/Math.LN2)),C!==te&&(C=te,hn=!0,Ui=!0),ye.isShaderMaterial||ye.isMeshPhongMaterial||ye.isMeshToonMaterial||ye.isMeshStandardMaterial||ye.envMap){let ce=ee.map.cameraPosition;ce!==void 0&&ce.setValue(ue,le.setFromMatrixPosition(te.matrixWorld))}(ye.isMeshPhongMaterial||ye.isMeshToonMaterial||ye.isMeshLambertMaterial||ye.isMeshBasicMaterial||ye.isMeshStandardMaterial||ye.isShaderMaterial)&&ee.setValue(ue,"isOrthographic",te.isOrthographicCamera===!0),(ye.isMeshPhongMaterial||ye.isMeshToonMaterial||ye.isMeshLambertMaterial||ye.isMeshBasicMaterial||ye.isMeshStandardMaterial||ye.isShaderMaterial||ye.isShadowMaterial||Ne.isSkinnedMesh)&&ee.setValue(ue,"viewMatrix",te.matrixWorldInverse)}if(Ne.isSkinnedMesh){ee.setOptional(ue,Ne,"bindMatrix"),ee.setOptional(ue,Ne,"bindMatrixInverse");let ce=Ne.skeleton;ce&&(Ce.floatVertexTextures?(ce.boneTexture===null&&ce.computeBoneTexture(),ee.setValue(ue,"boneTexture",ce.boneTexture,De),ee.setValue(ue,"boneTextureSize",ce.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}let Se=fe.morphAttributes;if((Se.position!==void 0||Se.normal!==void 0||Se.color!==void 0&&Ce.isWebGL2===!0)&&$.update(Ne,fe,ye,ls),(hn||_i.receiveShadow!==Ne.receiveShadow)&&(_i.receiveShadow=Ne.receiveShadow,ee.setValue(ue,"receiveShadow",Ne.receiveShadow)),ye.isMeshGouraudMaterial&&ye.envMap!==null&&(ae.envMap.value=Et,ae.flipEnvMap.value=Et.isCubeTexture&&Et.isRenderTargetTexture===!1?-1:1),hn&&(ee.setValue(ue,"toneMappingExposure",v.toneMappingExposure),_i.needsLights&&Qu(ae,Ui),gt&&ye.fog===!0&&bt.refreshFogUniforms(ae,gt),bt.refreshMaterialUniforms(ae,ye,z,L,F),LE.upload(ue,_i.uniformsList,ae,De)),ye.isShaderMaterial&&ye.uniformsNeedUpdate===!0&&(LE.upload(ue,_i.uniformsList,ae,De),ye.uniformsNeedUpdate=!1),ye.isSpriteMaterial&&ee.setValue(ue,"center",Ne.center),ee.setValue(ue,"modelViewMatrix",Ne.modelViewMatrix),ee.setValue(ue,"normalMatrix",Ne.normalMatrix),ee.setValue(ue,"modelMatrix",Ne.matrixWorld),Ne.previousModelViewMatrix&&ee.setValue(ue,"previousModelViewMatrix",Ne.previousModelViewMatrix),te.previousProjectionMatrix&&ee.setValue(ue,"previousProjectionMatrix",te.previousProjectionMatrix),ye.isShaderMaterial||ye.isRawShaderMaterial){let ce=ye.uniformsGroups;for(let Oe=0,vt=ce.length;Oe<vt;Oe++)if(Ce.isWebGL2){let Mn=ce[Oe];lt.update(Mn,ls),lt.bind(Mn,ls)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return ls}function Qu(te,ve){te.ambientLightColor.needsUpdate=ve,te.lightProbe.needsUpdate=ve,te.directionalLights.needsUpdate=ve,te.directionalLightShadows.needsUpdate=ve,te.pointLights.needsUpdate=ve,te.pointLightShadows.needsUpdate=ve,te.spotLights.needsUpdate=ve,te.spotLightShadows.needsUpdate=ve,te.rectAreaLights.needsUpdate=ve,te.hemisphereLights.needsUpdate=ve}function ge(te){return te.isMeshLambertMaterial||te.isMeshToonMaterial||te.isMeshPhongMaterial||te.isMeshStandardMaterial||te.isShadowMaterial||te.isShaderMaterial&&te.lights===!0}this.getActiveCubeFace=function(){return w},this.getActiveMipmapLevel=function(){return S},this.getRenderTarget=function(){return _},this.setRenderTargetTextures=function(te,ve,fe){Me.get(te.texture).__webglTexture=ve,Me.get(te.depthTexture).__webglTexture=fe;let ye=Me.get(te);ye.__hasExternalTextures=!0,ye.__hasExternalTextures&&(ye.__autoAllocateDepthBuffer=fe===void 0,ye.__autoAllocateDepthBuffer||he.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),ye.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(te,ve){let fe=Me.get(te);fe.__webglFramebuffer=ve,fe.__useDefaultFramebuffer=ve===void 0},this.setRenderTarget=function(te,ve=0,fe=0){_=te,w=ve,S=fe;let ye=!0,Ne=null,gt=!1,St=!1;if(te){let Tt=Me.get(te);Tt.__useDefaultFramebuffer!==void 0?(Ae.bindFramebuffer(36160,null),ye=!1):Tt.__webglFramebuffer===void 0?De.setupRenderTarget(te):Tt.__hasExternalTextures&&De.rebindTextures(te,Me.get(te.texture).__webglTexture,Me.get(te.depthTexture).__webglTexture);let Et=te.texture;(Et.isData3DTexture||Et.isDataArrayTexture||Et.isCompressedArrayTexture)&&(St=!0);let Vt=Me.get(te).__webglFramebuffer;te.isWebGLCubeRenderTarget?(Ne=Vt[ve],gt=!0):Ce.isWebGL2&&te.samples>0&&De.useMultisampledRTT(te)===!1?Ne=Me.get(te).__webglMultisampledFramebuffer:Ne=Vt,E.copy(te.viewport),I.copy(te.scissor),T=te.scissorTest}else E.copy(j).multiplyScalar(z).floor(),I.copy(J).multiplyScalar(z).floor(),T=ne;if(Ae.bindFramebuffer(36160,Ne)&&Ce.drawBuffers&&ye&&Ae.drawBuffers(te,Ne),Ae.viewport(E),Ae.scissor(I),Ae.setScissorTest(T),gt){let Tt=Me.get(te.texture);ue.framebufferTexture2D(36160,36064,34069+ve,Tt.__webglTexture,fe)}else if(St){let Tt=Me.get(te.texture),Et=ve||0;ue.framebufferTextureLayer(36160,36064,Tt.__webglTexture,fe||0,Et)}A=-1},this.readRenderTargetPixels=function(te,ve,fe,ye,Ne,gt,St){if(!(te&&te.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Tt=Me.get(te).__webglFramebuffer;if(te.isWebGLCubeRenderTarget&&St!==void 0&&(Tt=Tt[St]),Tt){Ae.bindFramebuffer(36160,Tt);try{let Et=te.texture,Vt=Et.format,zt=Et.type;if(Vt!==$r&&Ye.convert(Vt)!==ue.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let Yt=zt===Pd&&(he.has("EXT_color_buffer_half_float")||Ce.isWebGL2&&he.has("EXT_color_buffer_float"));if(zt!==Ua&&Ye.convert(zt)!==ue.getParameter(35738)&&!(zt===br&&(Ce.isWebGL2||he.has("OES_texture_float")||he.has("WEBGL_color_buffer_float")))&&!Yt){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ve>=0&&ve<=te.width-ye&&fe>=0&&fe<=te.height-Ne&&ue.readPixels(ve,fe,ye,Ne,Ye.convert(Vt),Ye.convert(zt),gt)}finally{let Et=_!==null?Me.get(_).__webglFramebuffer:null;Ae.bindFramebuffer(36160,Et)}}},this.readRenderTargetPixelsAsync=async function(te,ve,fe,ye,Ne,gt,St){if(!(te&&te.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Tt=Me.get(te).__webglFramebuffer;if(te.isWebGLCubeRenderTarget&&St!==void 0&&(Tt=Tt[St]),Tt){let Et=te.texture,Vt=Et.format,zt=Et.type;if(ve>=0&&ve<=te.width-ye&&fe>=0&&fe<=te.height-Ne){Ae.bindFramebuffer(ue.FRAMEBUFFER,Tt);let Yt=ue.createBuffer();ue.bindBuffer(ue.PIXEL_PACK_BUFFER,Yt),ue.bufferData(ue.PIXEL_PACK_BUFFER,gt.byteLength,ue.STREAM_READ),ue.readPixels(ve,fe,ye,Ne,Ye.convert(Vt),Ye.convert(zt),0);let $t=_!==null?Me.get(_).__webglFramebuffer:null;Ae.bindFramebuffer(ue.FRAMEBUFFER,$t);let tr=ue.fenceSync(ue.SYNC_GPU_COMMANDS_COMPLETE,0);return ue.flush(),await Mde(ue,tr,4),ue.bindBuffer(ue.PIXEL_PACK_BUFFER,Yt),ue.getBufferSubData(ue.PIXEL_PACK_BUFFER,0,gt),ue.deleteBuffer(Yt),ue.deleteSync(tr),gt}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(te,ve,fe=0){let ye=Math.pow(2,-fe),Ne=Math.floor(ve.image.width*ye),gt=Math.floor(ve.image.height*ye);De.setTexture2D(ve,0),ue.copyTexSubImage2D(3553,fe,0,0,te.x,te.y,Ne,gt),Ae.unbindTexture()},this.copyTextureToTexture=function(te,ve,fe,ye=0){let Ne=ve.image.width,gt=ve.image.height,St=Ye.convert(fe.format),Tt=Ye.convert(fe.type);De.setTexture2D(fe,0),ue.pixelStorei(37440,fe.flipY),ue.pixelStorei(37441,fe.premultiplyAlpha),ue.pixelStorei(3317,fe.unpackAlignment),ve.isDataTexture?ue.texSubImage2D(3553,ye,te.x,te.y,Ne,gt,St,Tt,ve.image.data):ve.isCompressedTexture?ue.compressedTexSubImage2D(3553,ye,te.x,te.y,ve.mipmaps[0].width,ve.mipmaps[0].height,St,ve.mipmaps[0].data):ue.texSubImage2D(3553,ye,te.x,te.y,St,Tt,ve.image),ye===0&&fe.generateMipmaps&&ue.generateMipmap(3553),Ae.unbindTexture()},this.copyTextureToTexture3D=function(te,ve,fe,ye,Ne=0){if(v.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let gt=te.max.x-te.min.x+1,St=te.max.y-te.min.y+1,Tt=te.max.z-te.min.z+1,Et=Ye.convert(ye.format),Vt=Ye.convert(ye.type),zt;if(ye.isData3DTexture)De.setTexture3D(ye,0),zt=32879;else if(ye.isDataArrayTexture)De.setTexture2DArray(ye,0),zt=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}ue.pixelStorei(37440,ye.flipY),ue.pixelStorei(37441,ye.premultiplyAlpha),ue.pixelStorei(3317,ye.unpackAlignment);let Yt=ue.getParameter(3314),$t=ue.getParameter(32878),tr=ue.getParameter(3316),Qr=ue.getParameter(3315),ir=ue.getParameter(32877),Rt=fe.isCompressedTexture?fe.mipmaps[0]:fe.image;ue.pixelStorei(3314,Rt.width),ue.pixelStorei(32878,Rt.height),ue.pixelStorei(3316,te.min.x),ue.pixelStorei(3315,te.min.y),ue.pixelStorei(32877,te.min.z),fe.isDataTexture||fe.isData3DTexture?ue.texSubImage3D(zt,Ne,ve.x,ve.y,ve.z,gt,St,Tt,Et,Vt,Rt.data):fe.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ue.compressedTexSubImage3D(zt,Ne,ve.x,ve.y,ve.z,gt,St,Tt,Et,Rt.data)):ue.texSubImage3D(zt,Ne,ve.x,ve.y,ve.z,gt,St,Tt,Et,Vt,Rt),ue.pixelStorei(3314,Yt),ue.pixelStorei(32878,$t),ue.pixelStorei(3316,tr),ue.pixelStorei(3315,Qr),ue.pixelStorei(32877,ir),Ne===0&&ye.generateMipmaps&&ue.generateMipmap(zt),Ae.unbindTexture()},this.initRenderTarget=function(te){Me.get(te).__webglFramebuffer===void 0&&De.setupRenderTarget(te)},this.initTexture=function(te){te.isCubeTexture?De.setTextureCube(te,0):te.isData3DTexture?De.setTexture3D(te,0):te.isDataArrayTexture||te.isCompressedArrayTexture?De.setTexture2DArray(te,0):De.setTexture2D(te,0),Ae.unbindTexture()},this.resetState=function(){w=0,S=0,_=null,Ae.reset(),Ee.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}var wve=class extends mq{};wve.prototype.isWebGL1Renderer=!0;var gq=class{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new li(e),this.near=t,this.far=i}clone(){return new gq(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}},Ho=class extends vr{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}},bve=class{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=AI,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Wl()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,n=this.stride;r<n;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Wl()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Wl()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},$a=new H,DI=class{constructor(e,t,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)$a.fromBufferAttribute(this,t),$a.applyMatrix4(e),this.setXYZ(t,$a.x,$a.y,$a.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)$a.fromBufferAttribute(this,t),$a.applyNormalMatrix(e),this.setXYZ(t,$a.x,$a.y,$a.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)$a.fromBufferAttribute(this,t),$a.transformDirection(e),this.setXYZ(t,$a.x,$a.y,$a.z);return this}setX(e,t){return this.normalized&&(t=Or(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Or(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Or(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Or(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=vd(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=vd(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=vd(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=vd(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Or(t,this.array),i=Or(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Or(t,this.array),i=Or(i,this.array),r=Or(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Or(t,this.array),i=Or(i,this.array),r=Or(r,this.array),n=Or(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=n,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)t.push(this.data.array[r+n])}return new hi(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new DI(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)t.push(this.data.array[r+n])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},vq=class extends vr{constructor(){super(),this.isBone=!0,this.type="Bone"}},oo=class extends tn{constructor(e=null,t=1,i=1,r,n,s,a,o,l=Ni,u=Ni,c,h){super(null,s,a,o,l,u,r,n,c,h),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},M5=new yt,_ve=new yt,$z=class{constructor(e=[],t=[]){this.uuid=Wl(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new yt)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){let i=new yt;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){let i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){let i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){let e=this.bones,t=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let n=0,s=e.length;n<s;n++){let a=e[n]?e[n].matrixWorld:_ve;M5.multiplyMatrices(a,t[n]),M5.toArray(i,n*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new $z(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=eq(e),e=Math.max(e,4);let t=new Float32Array(e*e*4);t.set(this.boneMatrices);let i=new oo(t,e,e,$r,br);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){let r=this.bones[t];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,r=e.bones.length;i<r;i++){let n=e.bones[i],s=t[n];s===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),s=new vq),this.bones.push(s),this.boneInverses.push(new yt().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){let e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let t=this.bones,i=this.boneInverses;for(let r=0,n=t.length;r<n;r++){let s=t[r];e.bones.push(s.uuid);let a=i[r];e.boneInverses.push(a.toArray())}return e}},Wb=class extends hi{constructor(e,t,i,r=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}},A5=new yt,E5=new yt,uA=[],Sve=new yt,dw=new zr,Mve=class extends zr{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Wb(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1;for(let r=0;r<i;r++)this.setMatrixAt(r,Sve)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){let i=this.matrixWorld,r=this.count;if(dw.geometry=this.geometry,dw.material=this.material,dw.material!==void 0)for(let n=0;n<r;n++){this.getMatrixAt(n,A5),E5.multiplyMatrices(i,A5),dw.matrixWorld=E5,dw.raycast(e,uA);for(let s=0,a=uA.length;s<a;s++){let o=uA[s];o.instanceId=n,o.object=this,t.push(o)}uA.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Wb(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}},Gp=class extends U_{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new li(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}},C5=new H,T5=new H,P5=new yt,B3=new zx,cA=new Wo,c2=class extends vr{constructor(e=new Kt,t=new Gp){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,i=[0];for(let r=1,n=t.count;r<n;r++)C5.fromBufferAttribute(t,r-1),T5.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=C5.distanceTo(T5);e.setAttribute("lineDistance",new kt(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){let i=this.geometry,r=this.matrixWorld,n=e.params.Line.threshold,s=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),cA.copy(i.boundingSphere),cA.applyMatrix4(r),cA.radius+=n,e.ray.intersectsSphere(cA)===!1)return;P5.copy(r).invert(),B3.copy(e.ray).applyMatrix4(P5);let a=n/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new H,u=new H,c=new H,h=new H,d=this.isLineSegments?2:1,p=i.index,m=i.attributes.position;if(p!==null){let v=Math.max(0,s.start),g=Math.min(p.count,s.start+s.count);for(let w=v,S=g-1;w<S;w+=d){let _=p.getX(w),A=p.getX(w+1);if(l.fromBufferAttribute(m,_),u.fromBufferAttribute(m,A),B3.distanceSqToSegment(l,u,h,c)>o)continue;h.applyMatrix4(this.matrixWorld);let C=e.ray.origin.distanceTo(h);C<e.near||C>e.far||t.push({distance:C,point:c.clone().applyMatrix4(this.matrixWorld),index:w,face:null,faceIndex:null,object:this})}}else{let v=Math.max(0,s.start),g=Math.min(m.count,s.start+s.count);for(let w=v,S=g-1;w<S;w+=d){if(l.fromBufferAttribute(m,w),u.fromBufferAttribute(m,w+1),B3.distanceSqToSegment(l,u,h,c)>o)continue;h.applyMatrix4(this.matrixWorld);let _=e.ray.origin.distanceTo(h);_<e.near||_>e.far||t.push({distance:_,point:c.clone().applyMatrix4(this.matrixWorld),index:w,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,n=i.length;r<n;r++){let s=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=r}}}}},D5=new H,R5=new H,V_=class extends c2{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,i=[];for(let r=0,n=t.count;r<n;r+=2)D5.fromBufferAttribute(t,r),R5.fromBufferAttribute(t,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+D5.distanceTo(R5);e.setAttribute("lineDistance",new kt(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},Ave=class extends tn{constructor(e,t,i,r,n,s,a,o,l){super(e,t,i,r,n,s,a,o,l),this.isVideoTexture=!0,this.minFilter=s!==void 0?s:Li,this.magFilter=n!==void 0?n:Li,this.generateMipmaps=!1;let u=this;function c(){u.needsUpdate=!0,e.requestVideoFrameCallback(c)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(c)}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},Eve=class extends tn{constructor(e,t,i,r,n,s,a,o,l){super(e,t,i,r,n,s,a,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}},rh=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t=[],i,r=this.getPoint(0),n=0;t.push(0);for(let s=1;s<=e;s++)i=this.getPoint(s/e),n+=i.distanceTo(r),t.push(n),r=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let i=this.getLengths(),r=0,n=i.length,s;t?s=t:s=e*i[n-1];let a=0,o=n-1,l;for(;a<=o;)if(r=Math.floor(a+(o-a)/2),l=i[r]-s,l<0)a=r+1;else if(l>0)o=r-1;else{o=r;break}if(r=o,i[r]===s)return r/(n-1);let u=i[r],c=i[r+1]-u,h=(s-u)/c;return(r+h)/(n-1)}getTangent(e,t){let i=e-1e-4,r=e+1e-4;i<0&&(i=0),r>1&&(r=1);let n=this.getPoint(i),s=this.getPoint(r),a=t||(n.isVector2?new Pe:new H);return a.copy(s).sub(n).normalize(),a}getTangentAt(e,t){let i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){let i=new H,r=[],n=[],s=[],a=new H,o=new yt;for(let d=0;d<=e;d++){let p=d/e;r[d]=this.getTangentAt(p,new H)}n[0]=new H,s[0]=new H;let l=Number.MAX_VALUE,u=Math.abs(r[0].x),c=Math.abs(r[0].y),h=Math.abs(r[0].z);u<=l&&(l=u,i.set(1,0,0)),c<=l&&(l=c,i.set(0,1,0)),h<=l&&i.set(0,0,1),a.crossVectors(r[0],i).normalize(),n[0].crossVectors(r[0],a),s[0].crossVectors(r[0],n[0]);for(let d=1;d<=e;d++){if(n[d]=n[d-1].clone(),s[d]=s[d-1].clone(),a.crossVectors(r[d-1],r[d]),a.length()>Number.EPSILON){a.normalize();let p=Math.acos(ts(r[d-1].dot(r[d]),-1,1));n[d].applyMatrix4(o.makeRotationAxis(a,p))}s[d].crossVectors(r[d],n[d])}if(t===!0){let d=Math.acos(ts(n[0].dot(n[e]),-1,1));d/=e,r[0].dot(a.crossVectors(n[0],n[e]))>0&&(d=-d);for(let p=1;p<=e;p++)n[p].applyMatrix4(o.makeRotationAxis(r[p],d*p)),s[p].crossVectors(r[p],n[p])}return{tangents:r,normals:n,binormals:s}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},WC=class extends rh{constructor(e=0,t=0,i=1,r=1,n=0,s=Math.PI*2,a=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=n,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(e,t){let i=t||new Pe,r=Math.PI*2,n=this.aEndAngle-this.aStartAngle,s=Math.abs(n)<Number.EPSILON;for(;n<0;)n+=r;for(;n>r;)n-=r;n<Number.EPSILON&&(s?n=0:n=r),this.aClockwise===!0&&!s&&(n===r?n=-r:n=n-r);let a=this.aStartAngle+e*n,o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){let u=Math.cos(this.aRotation),c=Math.sin(this.aRotation),h=o-this.aX,d=l-this.aY;o=h*u-d*c+this.aX,l=h*c+d*u+this.aY}return i.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}},Cve=class extends WC{constructor(e,t,i,r,n,s){super(e,t,i,i,r,n,s),this.isArcCurve=!0,this.type="ArcCurve"}};function ek(){let e=0,t=0,i=0,r=0;function n(s,a,o,l){e=s,t=o,i=-3*s+3*a-2*o-l,r=2*s-2*a+o+l}return{initCatmullRom:function(s,a,o,l,u){n(a,o,u*(o-s),u*(l-a))},initNonuniformCatmullRom:function(s,a,o,l,u,c,h){let d=(a-s)/u-(o-s)/(u+c)+(o-a)/c,p=(o-a)/c-(l-a)/(c+h)+(l-o)/h;d*=c,p*=c,n(a,o,d,p)},calc:function(s){let a=s*s,o=a*s;return e+t*s+i*a+r*o}}}var hA=new H,N3=new ek,F3=new ek,U3=new ek,Tve=class extends rh{constructor(e=[],t=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=r}getPoint(e,t=new H){let i=t,r=this.points,n=r.length,s=(n-(this.closed?0:1))*e,a=Math.floor(s),o=s-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/n)+1)*n:o===0&&a===n-1&&(a=n-2,o=1);let l,u;this.closed||a>0?l=r[(a-1)%n]:(hA.subVectors(r[0],r[1]).add(r[0]),l=hA);let c=r[a%n],h=r[(a+1)%n];if(this.closed||a+2<n?u=r[(a+2)%n]:(hA.subVectors(r[n-1],r[n-2]).add(r[n-1]),u=hA),this.curveType==="centripetal"||this.curveType==="chordal"){let d=this.curveType==="chordal"?.5:.25,p=Math.pow(l.distanceToSquared(c),d),m=Math.pow(c.distanceToSquared(h),d),v=Math.pow(h.distanceToSquared(u),d);m<1e-4&&(m=1),p<1e-4&&(p=m),v<1e-4&&(v=m),N3.initNonuniformCatmullRom(l.x,c.x,h.x,u.x,p,m,v),F3.initNonuniformCatmullRom(l.y,c.y,h.y,u.y,p,m,v),U3.initNonuniformCatmullRom(l.z,c.z,h.z,u.z,p,m,v)}else this.curveType==="catmullrom"&&(N3.initCatmullRom(l.x,c.x,h.x,u.x,this.tension),F3.initCatmullRom(l.y,c.y,h.y,u.y,this.tension),U3.initCatmullRom(l.z,c.z,h.z,u.z,this.tension));return i.set(N3.calc(o),F3.calc(o),U3.calc(o)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(new H().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}};function I5(e,t,i,r,n){let s=(r-t)*.5,a=(n-i)*.5,o=e*e,l=e*o;return(2*i-2*r+s+a)*l+(-3*i+3*r-2*s-a)*o+s*e+i}function Pve(e,t){let i=1-e;return i*i*t}function Dve(e,t){return 2*(1-e)*e*t}function Rve(e,t){return e*e*t}function nb(e,t,i,r){return Pve(e,t)+Dve(e,i)+Rve(e,r)}function Ive(e,t){let i=1-e;return i*i*i*t}function Lve(e,t){let i=1-e;return 3*i*i*e*t}function Ove(e,t){return 3*(1-e)*e*e*t}function zve(e,t){return e*e*e*t}function sb(e,t,i,r,n){return Ive(e,t)+Lve(e,i)+Ove(e,r)+zve(e,n)}var zu=class extends rh{constructor(e=new Pe,t=new Pe,i=new Pe,r=new Pe){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new Pe){let i=t,r=this.v0,n=this.v1,s=this.v2,a=this.v3;return i.set(sb(e,r.x,n.x,s.x,a.x),sb(e,r.y,n.y,s.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},OE=class extends rh{constructor(e=new H,t=new H,i=new H,r=new H){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new H){let i=t,r=this.v0,n=this.v1,s=this.v2,a=this.v3;return i.set(sb(e,r.x,n.x,s.x,a.x),sb(e,r.y,n.y,s.y,a.y),sb(e,r.z,n.z,s.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},Fu=class extends rh{constructor(e=new Pe,t=new Pe){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Pe){let i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){let i=t||new Pe;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},yq=class extends rh{constructor(e=new H,t=new H){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new H){let i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},Ip=class extends rh{constructor(e=new Pe,t=new Pe,i=new Pe){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new Pe){let i=t,r=this.v0,n=this.v1,s=this.v2;return i.set(nb(e,r.x,n.x,s.x),nb(e,r.y,n.y,s.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},kve=class extends rh{constructor(e=new H,t=new H,i=new H){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new H){let i=t,r=this.v0,n=this.v1,s=this.v2;return i.set(nb(e,r.x,n.x,s.x),nb(e,r.y,n.y,s.y),nb(e,r.z,n.z,s.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},tk=class extends rh{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Pe){let i=t,r=this.points,n=(r.length-1)*e,s=Math.floor(n),a=n-s,o=r[s===0?s:s-1],l=r[s],u=r[s>r.length-2?r.length-1:s+1],c=r[s>r.length-3?r.length-1:s+2];return i.set(I5(a,o.x,l.x,u.x,c.x),I5(a,o.y,l.y,u.y,c.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(new Pe().fromArray(r))}return this}},Bve=Object.freeze({__proto__:null,ArcCurve:Cve,CatmullRomCurve3:Tve,CubicBezierCurve:zu,CubicBezierCurve3:OE,EllipseCurve:WC,LineCurve:Fu,LineCurve3:yq,QuadraticBezierCurve:Ip,QuadraticBezierCurve3:kve,SplineCurve:tk}),xq=class extends rh{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Fu(t,e))}getPoint(e,t){let i=e*this.getLength(),r=this.getCurveLengths(),n=0;for(;n<r.length;){if(r[n]>=i){let s=r[n]-i,a=this.curves[n],o=a.getLength(),l=o===0?0:1-s/o;return a.getPointAt(l,t)}n++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){let t=[],i;for(let r=0,n=this.curves;r<n.length;r++){let s=n[r],a=s.isEllipseCurve?e*2:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?e*s.points.length:e,o=s.getPoints(a);for(let l=0;l<o.length;l++){let u=o[l];i&&i.equals(u)||(t.push(u),i=u)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){let r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let r=e.curves[t];this.curves.push(new Bve[r.type]().fromJSON(r))}return this}},h2=class extends xq{constructor(e){super(),this.type="Path",this.currentPoint=new Pe,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let i=new Fu(this.currentPoint.clone(),new Pe(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,r){let n=new Ip(this.currentPoint.clone(),new Pe(e,t),new Pe(i,r));return this.curves.push(n),this.currentPoint.set(i,r),this}bezierCurveTo(e,t,i,r,n,s){let a=new zu(this.currentPoint.clone(),new Pe(e,t),new Pe(i,r),new Pe(n,s));return this.curves.push(a),this.currentPoint.set(n,s),this}splineThru(e){let t=[this.currentPoint.clone()].concat(e),i=new tk(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,r,n,s){let a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+a,t+o,i,r,n,s),this}absarc(e,t,i,r,n,s){return this.absellipse(e,t,i,i,r,n,s),this}ellipse(e,t,i,r,n,s,a,o){let l=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+l,t+u,i,r,n,s,a,o),this}absellipse(e,t,i,r,n,s,a,o){let l=new WC(e,t,i,r,n,s,a,o);if(this.curves.length>0){let c=l.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(l);let u=l.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}},wq=class extends Kt{constructor(e=[new Pe(0,-.5),new Pe(.5,0),new Pe(0,.5)],t=12,i=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},t=Math.floor(t),r=ts(r,0,Math.PI*2);let n=[],s=[],a=[],o=[],l=[],u=1/t,c=new H,h=new Pe,d=new H,p=new H,m=new H,v=0,g=0;for(let w=0;w<=e.length-1;w++)switch(w){case 0:v=e[w+1].x-e[w].x,g=e[w+1].y-e[w].y,d.x=g*1,d.y=-v,d.z=g*0,m.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case e.length-1:o.push(m.x,m.y,m.z);break;default:v=e[w+1].x-e[w].x,g=e[w+1].y-e[w].y,d.x=g*1,d.y=-v,d.z=g*0,p.copy(d),d.x+=m.x,d.y+=m.y,d.z+=m.z,d.normalize(),o.push(d.x,d.y,d.z),m.copy(p)}for(let w=0;w<=t;w++){let S=i+w*u*r,_=Math.sin(S),A=Math.cos(S);for(let C=0;C<=e.length-1;C++){c.x=e[C].x*_,c.y=e[C].y,c.z=e[C].x*A,s.push(c.x,c.y,c.z),h.x=w/t,h.y=C/(e.length-1),a.push(h.x,h.y);let E=o[3*C+0]*_,I=o[3*C+1],T=o[3*C+0]*A;l.push(E,I,T)}}for(let w=0;w<t;w++)for(let S=0;S<e.length-1;S++){let _=S+w*e.length,A=_,C=_+e.length,E=_+e.length+1,I=_+1;n.push(A,C,I),n.push(E,I,C)}this.setIndex(n),this.setAttribute("position",new kt(s,3)),this.setAttribute("uv",new kt(a,2)),this.setAttribute("normal",new kt(l,3))}static fromJSON(e){return new wq(e.points,e.segments,e.phiStart,e.phiLength)}},ik=class extends Kt{constructor(e=1,t=1,i=1,r=32,n=1,s=!1,a=0,o=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:n,openEnded:s,thetaStart:a,thetaLength:o};let l=this;r=Math.floor(r),n=Math.floor(n);let u=[],c=[],h=[],d=[],p=0,m=[],v=i/2,g=0;w(),s===!1&&(e>0&&S(!0),t>0&&S(!1)),this.setIndex(u),this.setAttribute("position",new kt(c,3)),this.setAttribute("normal",new kt(h,3)),this.setAttribute("uv",new kt(d,2));function w(){let _=new H,A=new H,C=0,E=(t-e)/i;for(let I=0;I<=n;I++){let T=[],D=I/n,L=D*(t-e)+e;for(let z=0;z<=r;z++){let G=z/r,V=G*o+a,j=Math.sin(V),J=Math.cos(V);A.x=L*j,A.y=-D*i+v,A.z=L*J,c.push(A.x,A.y,A.z),_.set(j,E,J).normalize(),h.push(_.x,_.y,_.z),d.push(G,1-D),T.push(p++)}m.push(T)}for(let I=0;I<r;I++)for(let T=0;T<n;T++){let D=m[T][I],L=m[T+1][I],z=m[T+1][I+1],G=m[T][I+1];u.push(D,L,G),u.push(L,z,G),C+=6}l.addGroup(g,C,0),g+=C}function S(_){let A=p,C=new Pe,E=new H,I=0,T=_===!0?e:t,D=_===!0?1:-1;for(let z=1;z<=r;z++)c.push(0,v*D,0),h.push(0,D,0),d.push(.5,.5),p++;let L=p;for(let z=0;z<=r;z++){let G=z/r*o+a,V=Math.cos(G),j=Math.sin(G);E.x=T*j,E.y=v*D,E.z=T*V,c.push(E.x,E.y,E.z),h.push(0,D,0),C.x=V*.5+.5,C.y=j*.5*D+.5,d.push(C.x,C.y),p++}for(let z=0;z<r;z++){let G=A+z,V=L+z;_===!0?u.push(V,V+1,G):u.push(V+1,V,G),I+=3}l.addGroup(g,I,_===!0?1:2),g+=I}}static fromJSON(e){return new ik(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},rk=class extends ik{constructor(e=1,t=1,i=32,r=1,n=!1,s=0,a=Math.PI*2){super(0,e,t,i,r,n,s,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:s,thetaLength:a}}static fromJSON(e){return new rk(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},nk=class extends Kt{constructor(e=[],t=[],i=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r};let n=[],s=[];a(r),l(i),u(),this.setAttribute("position",new kt(n,3)),this.setAttribute("normal",new kt(n.slice(),3)),this.setAttribute("uv",new kt(s,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function a(w){let S=new H,_=new H,A=new H;for(let C=0;C<t.length;C+=3)d(t[C+0],S),d(t[C+1],_),d(t[C+2],A),o(S,_,A,w)}function o(w,S,_,A){let C=A+1,E=[];for(let I=0;I<=C;I++){E[I]=[];let T=w.clone().lerp(_,I/C),D=S.clone().lerp(_,I/C),L=C-I;for(let z=0;z<=L;z++)z===0&&I===C?E[I][z]=T:E[I][z]=T.clone().lerp(D,z/L)}for(let I=0;I<C;I++)for(let T=0;T<2*(C-I)-1;T++){let D=Math.floor(T/2);T%2===0?(h(E[I][D+1]),h(E[I+1][D]),h(E[I][D])):(h(E[I][D+1]),h(E[I+1][D+1]),h(E[I+1][D]))}}function l(w){let S=new H;for(let _=0;_<n.length;_+=3)S.x=n[_+0],S.y=n[_+1],S.z=n[_+2],S.normalize().multiplyScalar(w),n[_+0]=S.x,n[_+1]=S.y,n[_+2]=S.z}function u(){let w=new H;for(let S=0;S<n.length;S+=3){w.x=n[S+0],w.y=n[S+1],w.z=n[S+2];let _=v(w)/2/Math.PI+.5,A=g(w)/Math.PI+.5;s.push(_,1-A)}p(),c()}function c(){for(let w=0;w<s.length;w+=6){let S=s[w+0],_=s[w+2],A=s[w+4],C=Math.max(S,_,A),E=Math.min(S,_,A);C>.9&&E<.1&&(S<.2&&(s[w+0]+=1),_<.2&&(s[w+2]+=1),A<.2&&(s[w+4]+=1))}}function h(w){n.push(w.x,w.y,w.z)}function d(w,S){let _=w*3;S.x=e[_+0],S.y=e[_+1],S.z=e[_+2]}function p(){let w=new H,S=new H,_=new H,A=new H,C=new Pe,E=new Pe,I=new Pe;for(let T=0,D=0;T<n.length;T+=9,D+=6){w.set(n[T+0],n[T+1],n[T+2]),S.set(n[T+3],n[T+4],n[T+5]),_.set(n[T+6],n[T+7],n[T+8]),C.set(s[D+0],s[D+1]),E.set(s[D+2],s[D+3]),I.set(s[D+4],s[D+5]),A.copy(w).add(S).add(_).divideScalar(3);let L=v(A);m(C,D+0,w,L),m(E,D+2,S,L),m(I,D+4,_,L)}}function m(w,S,_,A){A<0&&w.x===1&&(s[S]=w.x-1),_.x===0&&_.z===0&&(s[S]=A/2/Math.PI+.5)}function v(w){return Math.atan2(w.z,-w.x)}function g(w){return Math.atan2(-w.y,Math.sqrt(w.x*w.x+w.z*w.z))}}static fromJSON(e){return new nk(e.vertices,e.indices,e.radius,e.details)}},bq=class extends nk{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2,r=1/i,n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],s=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(n,s,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new bq(e.radius,e.detail)}},d2=class extends h2{constructor(e){super(e),this.uuid=Wl(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){let r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let r=e.holes[t];this.holes.push(new h2().fromJSON(r))}return this}},Nve={triangulate:function(e,t,i=2){let r=t&&t.length,n=r?t[0]*i:e.length,s=_q(e,0,n,i,!0),a=[];if(!s||s.next===s.prev)return a;let o,l,u,c,h,d,p;if(r&&(s=Hve(e,t,s,i)),e.length>80*i){o=u=e[0],l=c=e[1];for(let m=i;m<n;m+=i)h=e[m],d=e[m+1],h<o&&(o=h),d<l&&(l=d),h>u&&(u=h),d>c&&(c=d);p=Math.max(u-o,c-l),p=p!==0?32767/p:0}return Gb(s,a,i,o,l,p,0),a}};function _q(e,t,i,r,n){let s,a;if(n===e0e(e,t,i,r)>0)for(s=t;s<i;s+=r)a=L5(s,e[s],e[s+1],a);else for(s=i-r;s>=t;s-=r)a=L5(s,e[s],e[s+1],a);return a&&GC(a,a.next)&&(Xb(a),a=a.next),a}function qg(e,t){if(!e)return e;t||(t=e);let i=e,r;do if(r=!1,!i.steiner&&(GC(i,i.next)||un(i.prev,i,i.next)===0)){if(Xb(i),i=t=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==t);return t}function Gb(e,t,i,r,n,s,a){if(!e)return;!a&&s&&Yve(e,r,n,s);let o=e,l,u;for(;e.prev!==e.next;){if(l=e.prev,u=e.next,s?Uve(e,r,n,s):Fve(e)){t.push(l.i/i|0),t.push(e.i/i|0),t.push(u.i/i|0),Xb(e),e=u.next,o=u.next;continue}if(e=u,e===o){a?a===1?(e=Vve(qg(e),t,i),Gb(e,t,i,r,n,s,2)):a===2&&jve(e,t,i,r,n,s):Gb(qg(e),t,i,r,n,s,1);break}}}function Fve(e){let t=e.prev,i=e,r=e.next;if(un(t,i,r)>=0)return!1;let n=t.x,s=i.x,a=r.x,o=t.y,l=i.y,u=r.y,c=n<s?n<a?n:a:s<a?s:a,h=o<l?o<u?o:u:l<u?l:u,d=n>s?n>a?n:a:s>a?s:a,p=o>l?o>u?o:u:l>u?l:u,m=r.next;for(;m!==t;){if(m.x>=c&&m.x<=d&&m.y>=h&&m.y<=p&&Dy(n,o,s,l,a,u,m.x,m.y)&&un(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function Uve(e,t,i,r){let n=e.prev,s=e,a=e.next;if(un(n,s,a)>=0)return!1;let o=n.x,l=s.x,u=a.x,c=n.y,h=s.y,d=a.y,p=o<l?o<u?o:u:l<u?l:u,m=c<h?c<d?c:d:h<d?h:d,v=o>l?o>u?o:u:l>u?l:u,g=c>h?c>d?c:d:h>d?h:d,w=RI(p,m,t,i,r),S=RI(v,g,t,i,r),_=e.prevZ,A=e.nextZ;for(;_&&_.z>=w&&A&&A.z<=S;){if(_.x>=p&&_.x<=v&&_.y>=m&&_.y<=g&&_!==n&&_!==a&&Dy(o,c,l,h,u,d,_.x,_.y)&&un(_.prev,_,_.next)>=0||(_=_.prevZ,A.x>=p&&A.x<=v&&A.y>=m&&A.y<=g&&A!==n&&A!==a&&Dy(o,c,l,h,u,d,A.x,A.y)&&un(A.prev,A,A.next)>=0))return!1;A=A.nextZ}for(;_&&_.z>=w;){if(_.x>=p&&_.x<=v&&_.y>=m&&_.y<=g&&_!==n&&_!==a&&Dy(o,c,l,h,u,d,_.x,_.y)&&un(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;A&&A.z<=S;){if(A.x>=p&&A.x<=v&&A.y>=m&&A.y<=g&&A!==n&&A!==a&&Dy(o,c,l,h,u,d,A.x,A.y)&&un(A.prev,A,A.next)>=0)return!1;A=A.nextZ}return!0}function Vve(e,t,i){let r=e;do{let n=r.prev,s=r.next.next;!GC(n,s)&&Sq(n,r,r.next,s)&&qb(n,s)&&qb(s,n)&&(t.push(n.i/i|0),t.push(r.i/i|0),t.push(s.i/i|0),Xb(r),Xb(r.next),r=e=s),r=r.next}while(r!==e);return qg(r)}function jve(e,t,i,r,n,s){let a=e;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&Zve(a,o)){let l=Mq(a,o);a=qg(a,a.next),l=qg(l,l.next),Gb(a,t,i,r,n,s,0),Gb(l,t,i,r,n,s,0);return}o=o.next}a=a.next}while(a!==e)}function Hve(e,t,i,r){let n=[],s,a,o,l,u;for(s=0,a=t.length;s<a;s++)o=t[s]*r,l=s<a-1?t[s+1]*r:e.length,u=_q(e,o,l,r,!1),u===u.next&&(u.steiner=!0),n.push(Kve(u));for(n.sort(Wve),s=0;s<n.length;s++)i=Gve(n[s],i);return i}function Wve(e,t){return e.x-t.x}function Gve(e,t){let i=qve(e,t);if(!i)return t;let r=Mq(i,e);return qg(r,r.next),qg(i,i.next)}function qve(e,t){let i=t,r=-1/0,n,s=e.x,a=e.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){let d=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(d<=s&&d>r&&(r=d,n=i.x<i.next.x?i:i.next,d===s))return n}i=i.next}while(i!==t);if(!n)return null;let o=n,l=n.x,u=n.y,c=1/0,h;i=n;do s>=i.x&&i.x>=l&&s!==i.x&&Dy(a<u?s:r,a,l,u,a<u?r:s,a,i.x,i.y)&&(h=Math.abs(a-i.y)/(s-i.x),qb(i,e)&&(h<c||h===c&&(i.x>n.x||i.x===n.x&&Xve(n,i)))&&(n=i,c=h)),i=i.next;while(i!==o);return n}function Xve(e,t){return un(e.prev,e,t.prev)<0&&un(t.next,e,e.next)<0}function Yve(e,t,i,r){let n=e;do n.z===0&&(n.z=RI(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,Qve(n)}function Qve(e){let t,i,r,n,s,a,o,l,u=1;do{for(i=e,e=null,s=null,a=0;i;){for(a++,r=i,o=0,t=0;t<u&&(o++,r=r.nextZ,!!r);t++);for(l=u;o>0||l>0&&r;)o!==0&&(l===0||!r||i.z<=r.z)?(n=i,i=i.nextZ,o--):(n=r,r=r.nextZ,l--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;i=r}s.nextZ=null,u*=2}while(a>1);return e}function RI(e,t,i,r,n){return e=(e-i)*n|0,t=(t-r)*n|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function Kve(e){let t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function Dy(e,t,i,r,n,s,a,o){return(n-a)*(t-o)>=(e-a)*(s-o)&&(e-a)*(r-o)>=(i-a)*(t-o)&&(i-a)*(s-o)>=(n-a)*(r-o)}function Zve(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!Jve(e,t)&&(qb(e,t)&&qb(t,e)&&$ve(e,t)&&(un(e.prev,e,t.prev)||un(e,t.prev,t))||GC(e,t)&&un(e.prev,e,e.next)>0&&un(t.prev,t,t.next)>0)}function un(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function GC(e,t){return e.x===t.x&&e.y===t.y}function Sq(e,t,i,r){let n=fA(un(e,t,i)),s=fA(un(e,t,r)),a=fA(un(i,r,e)),o=fA(un(i,r,t));return!!(n!==s&&a!==o||n===0&&dA(e,i,t)||s===0&&dA(e,r,t)||a===0&&dA(i,e,r)||o===0&&dA(i,t,r))}function dA(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function fA(e){return e>0?1:e<0?-1:0}function Jve(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&Sq(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function qb(e,t){return un(e.prev,e,e.next)<0?un(e,t,e.next)>=0&&un(e,e.prev,t)>=0:un(e,t,e.prev)<0||un(e,e.next,t)<0}function $ve(e,t){let i=e,r=!1,n=(e.x+t.x)/2,s=(e.y+t.y)/2;do i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==e);return r}function Mq(e,t){let i=new II(e.i,e.x,e.y),r=new II(t.i,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function L5(e,t,i,r){let n=new II(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function Xb(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function II(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function e0e(e,t,i,r){let n=0;for(let s=t,a=i-r;s<i;s+=r)n+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return n}var Aq=class{static area(e){let t=e.length,i=0;for(let r=t-1,n=0;n<t;r=n++)i+=e[r].x*e[n].y-e[n].x*e[r].y;return i*.5}static isClockWise(e){return Aq.area(e)<0}static triangulateShape(e,t){let i=[],r=[],n=[];O5(e),z5(i,e);let s=e.length;t.forEach(O5);for(let o=0;o<t.length;o++)r.push(s),s+=t[o].length,z5(i,t[o]);let a=Nve.triangulate(i,r);for(let o=0;o<a.length;o+=3)n.push(a.slice(o,o+3));return n}};function O5(e){let t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function z5(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}var Eq=class extends nk{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,n,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Eq(e.radius,e.detail)}},jy=class extends Kt{constructor(e=1,t=32,i=16,r=0,n=Math.PI*2,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:s,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));let o=Math.min(s+a,Math.PI),l=0,u=[],c=new H,h=new H,d=[],p=[],m=[],v=[];for(let g=0;g<=i;g++){let w=[],S=g/i,_=0;g==0&&s==0?_=.5/t:g==i&&o==Math.PI&&(_=-.5/t);for(let A=0;A<=t;A++){let C=A/t;c.x=-e*Math.cos(r+C*n)*Math.sin(s+S*a),c.y=e*Math.cos(s+S*a),c.z=e*Math.sin(r+C*n)*Math.sin(s+S*a),p.push(c.x,c.y,c.z),h.copy(c).normalize(),m.push(h.x,h.y,h.z),v.push(C+_,1-S),w.push(l++)}u.push(w)}for(let g=0;g<i;g++)for(let w=0;w<t;w++){let S=u[g][w+1],_=u[g][w],A=u[g+1][w],C=u[g+1][w+1];(g!==0||s>0)&&d.push(S,_,C),(g!==i-1||o<Math.PI)&&d.push(_,A,C)}this.setIndex(d),this.setAttribute("position",new kt(p,3)),this.setAttribute("normal",new kt(m,3)),this.setAttribute("uv",new kt(v,2))}static fromJSON(e){return new jy(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}},Cq=class extends Kt{constructor(e=1,t=.4,i=12,r=48,n=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:n},i=Math.floor(i),r=Math.floor(r);let s=[],a=[],o=[],l=[],u=new H,c=new H,h=new H;for(let d=0;d<=i;d++)for(let p=0;p<=r;p++){let m=p/r*n,v=d/i*Math.PI*2;c.x=(e+t*Math.cos(v))*Math.cos(m),c.y=(e+t*Math.cos(v))*Math.sin(m),c.z=t*Math.sin(v),a.push(c.x,c.y,c.z),u.x=e*Math.cos(m),u.y=e*Math.sin(m),h.subVectors(c,u).normalize(),o.push(h.x,h.y,h.z),l.push(p/r),l.push(d/i)}for(let d=1;d<=i;d++)for(let p=1;p<=r;p++){let m=(r+1)*d+p-1,v=(r+1)*(d-1)+p-1,g=(r+1)*(d-1)+p,w=(r+1)*d+p;s.push(m,v,w),s.push(v,g,w)}this.setIndex(s),this.setAttribute("position",new kt(a,3)),this.setAttribute("normal",new kt(o,3)),this.setAttribute("uv",new kt(l,2))}static fromJSON(e){return new Cq(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}},Tq=class extends Kt{constructor(e=1,t=.4,i=64,r=8,n=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:n,q:s},i=Math.floor(i),r=Math.floor(r);let a=[],o=[],l=[],u=[],c=new H,h=new H,d=new H,p=new H,m=new H,v=new H,g=new H;for(let S=0;S<=i;++S){let _=S/i*n*Math.PI*2;w(_,n,s,e,d),w(_+.01,n,s,e,p),v.subVectors(p,d),g.addVectors(p,d),m.crossVectors(v,g),g.crossVectors(m,v),m.normalize(),g.normalize();for(let A=0;A<=r;++A){let C=A/r*Math.PI*2,E=-t*Math.cos(C),I=t*Math.sin(C);c.x=d.x+(E*g.x+I*m.x),c.y=d.y+(E*g.y+I*m.y),c.z=d.z+(E*g.z+I*m.z),o.push(c.x,c.y,c.z),h.subVectors(c,d).normalize(),l.push(h.x,h.y,h.z),u.push(S/i),u.push(A/r)}}for(let S=1;S<=i;S++)for(let _=1;_<=r;_++){let A=(r+1)*(S-1)+(_-1),C=(r+1)*S+(_-1),E=(r+1)*S+_,I=(r+1)*(S-1)+_;a.push(A,C,I),a.push(C,E,I)}this.setIndex(a),this.setAttribute("position",new kt(o,3)),this.setAttribute("normal",new kt(l,3)),this.setAttribute("uv",new kt(u,2));function w(S,_,A,C,E){let I=Math.cos(S),T=Math.sin(S),D=A/_*S,L=Math.cos(D);E.x=C*(2+L)*.5*I,E.y=C*(2+L)*T*.5,E.z=C*Math.sin(D)*.5}}static fromJSON(e){return new Tq(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}},t0e=class extends Zi{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}};function Nf(e,t,i){return Pq(e)?new e.constructor(e.subarray(t,i!==void 0?i:e.length)):e.slice(t,i)}function pA(e,t,i){return!e||e.constructor===t?e:typeof t.BYTES_PER_ELEMENT=="number"?new t(e):Array.prototype.slice.call(e)}function Pq(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function i0e(e){function t(n,s){return e[n]-e[s]}let i=e.length,r=new Array(i);for(let n=0;n!==i;++n)r[n]=n;return r.sort(t),r}function k5(e,t,i){let r=e.length,n=new e.constructor(r);for(let s=0,a=0;a!==r;++s){let o=i[s]*t;for(let l=0;l!==t;++l)n[a++]=e[o+l]}return n}function Dq(e,t,i,r){let n=1,s=e[0];for(;s!==void 0&&s[r]===void 0;)s=e[n++];if(s===void 0)return;let a=s[r];if(a!==void 0)if(Array.isArray(a))do a=s[r],a!==void 0&&(t.push(s.time),i.push.apply(i,a)),s=e[n++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[r],a!==void 0&&(t.push(s.time),a.toArray(i,i.length)),s=e[n++];while(s!==void 0);else do a=s[r],a!==void 0&&(t.push(s.time),i.push(a)),s=e[n++];while(s!==void 0)}var qC=class{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,i=this._cachedIndex,r=t[i],n=t[i-1];e:{t:{let s;i:{r:if(!(e<r)){for(let a=i+2;;){if(r===void 0){if(e<n)break r;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(n=r,r=t[++i],e<r)break t}s=t.length;break i}if(!(e>=n)){let a=t[1];e<a&&(i=2,n=a);for(let o=i-2;;){if(n===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===o)break;if(r=n,n=t[--i-1],e>=n)break t}s=i,i=0;break i}break e}for(;i<s;){let a=i+s>>>1;e<t[a]?s=a:i=a+1}if(r=t[i],n=t[i-1],n===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,n,r)}return this.interpolate_(i,n,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=e*r;for(let s=0;s!==r;++s)t[s]=i[n+s];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},r0e=class extends qC{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Cy,endingEnd:Cy}}intervalChanged_(e,t,i){let r=this.parameterPositions,n=e-2,s=e+1,a=r[n],o=r[s];if(a===void 0)switch(this.getSettings_().endingStart){case Ty:n=e,a=2*t-i;break;case o2:n=r.length-2,a=t+r[n]-r[n+1];break;default:n=e,a=i}if(o===void 0)switch(this.getSettings_().endingEnd){case Ty:s=e,o=2*i-t;break;case o2:s=1,o=i+r[1]-r[0];break;default:s=e-1,o=t}let l=(i-t)*.5,u=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(o-i),this._offsetPrev=n*u,this._offsetNext=s*u}interpolate_(e,t,i,r){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,u=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(i-t)/(r-t),m=p*p,v=m*p,g=-h*v+2*h*m-h*p,w=(1+h)*v+(-1.5-2*h)*m+(-.5+h)*p+1,S=(-1-d)*v+(1.5+d)*m+.5*p,_=d*v-d*m;for(let A=0;A!==a;++A)n[A]=g*s[u+A]+w*s[l+A]+S*s[o+A]+_*s[c+A];return n}},Rq=class extends qC{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,u=(i-t)/(r-t),c=1-u;for(let h=0;h!==a;++h)n[h]=s[l+h]*c+s[o+h]*u;return n}},n0e=class extends qC{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}},nh=class{constructor(e,t,i,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=pA(t,this.TimeBufferType),this.values=pA(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){let t=e.constructor,i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:pA(e.times,Array),values:pA(e.values,Array)};let r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new n0e(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Rq(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new r0e(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case s2:t=this.InterpolantFactoryMethodDiscrete;break;case a2:t=this.InterpolantFactoryMethodLinear;break;case h3:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){let i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return s2;case this.InterpolantFactoryMethodLinear:return a2;case this.InterpolantFactoryMethodSmooth:return h3}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){let t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(e!==1){let t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){let i=this.times,r=i.length,n=0,s=r-1;for(;n!==r&&i[n]<e;)++n;for(;s!==-1&&i[s]>t;)--s;if(++s,n!==0||s!==r){n>=s&&(s=Math.max(s,1),n=s-1);let a=this.getValueSize();this.times=Nf(i,n,s),this.values=Nf(this.values,n*a,s*a)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let i=this.times,r=this.values,n=i.length;n===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let a=0;a!==n;a++){let o=i[a];if(typeof o=="number"&&isNaN(o)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,o),e=!1;break}if(s!==null&&s>o){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,o,s),e=!1;break}s=o}if(r!==void 0&&Pq(r))for(let a=0,o=r.length;a!==o;++a){let l=r[a];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,l),e=!1;break}}return e}optimize(){let e=Nf(this.times),t=Nf(this.values),i=this.getValueSize(),r=this.getInterpolation()===h3,n=e.length-1,s=1;for(let a=1;a<n;++a){let o=!1,l=e[a],u=e[a+1];if(l!==u&&(a!==1||l!==e[0]))if(r)o=!0;else{let c=a*i,h=c-i,d=c+i;for(let p=0;p!==i;++p){let m=t[c+p];if(m!==t[h+p]||m!==t[d+p]){o=!0;break}}}if(o){if(a!==s){e[s]=e[a];let c=a*i,h=s*i;for(let d=0;d!==i;++d)t[h+d]=t[c+d]}++s}}if(n>0){e[s]=e[n];for(let a=n*i,o=s*i,l=0;l!==i;++l)t[o+l]=t[a+l];++s}return s!==e.length?(this.times=Nf(e,0,s),this.values=Nf(t,0,s*i)):(this.times=e,this.values=t),this}clone(){let e=Nf(this.times,0),t=Nf(this.values,0),i=this.constructor,r=new i(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}};nh.prototype.TimeBufferType=Float32Array;nh.prototype.ValueBufferType=Float32Array;nh.prototype.DefaultInterpolation=a2;var Nx=class extends nh{};Nx.prototype.ValueTypeName="bool";Nx.prototype.ValueBufferType=Array;Nx.prototype.DefaultInterpolation=s2;Nx.prototype.InterpolantFactoryMethodLinear=void 0;Nx.prototype.InterpolantFactoryMethodSmooth=void 0;var Iq=class extends nh{};Iq.prototype.ValueTypeName="color";var f2=class extends nh{};f2.prototype.ValueTypeName="number";var s0e=class extends qC{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(i-t)/(r-t),l=e*a;for(let u=l+a;l!==u;l+=4)xi.slerpFlat(n,0,s,l-a,s,l,o);return n}},j_=class extends nh{InterpolantFactoryMethodLinear(e){return new s0e(this.times,this.values,this.getValueSize(),e)}};j_.prototype.ValueTypeName="quaternion";j_.prototype.DefaultInterpolation=a2;j_.prototype.InterpolantFactoryMethodSmooth=void 0;var Fx=class extends nh{};Fx.prototype.ValueTypeName="string";Fx.prototype.ValueBufferType=Array;Fx.prototype.DefaultInterpolation=s2;Fx.prototype.InterpolantFactoryMethodLinear=void 0;Fx.prototype.InterpolantFactoryMethodSmooth=void 0;var p2=class extends nh{};p2.prototype.ValueTypeName="vector";var LI=class{constructor(e,t=-1,i,r=Xz){this.name=e,this.tracks=i,this.duration=t,this.blendMode=r,this.uuid=Wl(),this.duration<0&&this.resetDuration()}static parse(e){let t=[],i=e.tracks,r=1/(e.fps||1);for(let s=0,a=i.length;s!==a;++s)t.push(o0e(i[s]).scale(r));let n=new this(e.name,e.duration,t,e.blendMode);return n.uuid=e.uuid,n}static toJSON(e){let t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let n=0,s=i.length;n!==s;++n)t.push(nh.toJSON(i[n]));return r}static CreateFromMorphTargetSequence(e,t,i,r){let n=t.length,s=[];for(let a=0;a<n;a++){let o=[],l=[];o.push((a+n-1)%n,a,(a+1)%n),l.push(0,1,0);let u=i0e(o);o=k5(o,1,u),l=k5(l,1,u),!r&&o[0]===0&&(o.push(n),l.push(l[0])),s.push(new f2(".morphTargetInfluences["+t[a].name+"]",o,l).scale(1/i))}return new this(e,-1,s)}static findByName(e,t){let i=e;if(!Array.isArray(e)){let r=e;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===t)return i[r];return null}static CreateClipsFromMorphTargetSequences(e,t,i){let r={},n=/^([\w-]*?)([\d]+)$/;for(let a=0,o=e.length;a<o;a++){let l=e[a],u=l.name.match(n);if(u&&u.length>1){let c=u[1],h=r[c];h||(r[c]=h=[]),h.push(l)}}let s=[];for(let a in r)s.push(this.CreateFromMorphTargetSequence(a,r[a],t,i));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let i=function(u,c,h,d,p){if(h.length!==0){let m=[],v=[];Dq(h,m,v,d),m.length!==0&&p.push(new u(c,m,v))}},r=[],n=e.name||"default",s=e.fps||30,a=e.blendMode,o=e.length||-1,l=e.hierarchy||[];for(let u=0;u<l.length;u++){let c=l[u].keys;if(!(!c||c.length===0))if(c[0].morphTargets){let h={},d;for(d=0;d<c.length;d++)if(c[d].morphTargets)for(let p=0;p<c[d].morphTargets.length;p++)h[c[d].morphTargets[p]]=-1;for(let p in h){let m=[],v=[];for(let g=0;g!==c[d].morphTargets.length;++g){let w=c[d];m.push(w.time),v.push(w.morphTarget===p?1:0)}r.push(new f2(".morphTargetInfluence["+p+"]",m,v))}o=h.length*s}else{let h=".bones["+t[u].name+"]";i(p2,h+".position",c,"pos",r),i(j_,h+".quaternion",c,"rot",r),i(p2,h+".scale",c,"scl",r)}}return r.length===0?null:new this(n,o,r,a)}resetDuration(){let e=this.tracks,t=0;for(let i=0,r=e.length;i!==r;++i){let n=this.tracks[i];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function a0e(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return f2;case"vector":case"vector2":case"vector3":case"vector4":return p2;case"color":return Iq;case"quaternion":return j_;case"bool":case"boolean":return Nx;case"string":return Fx}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function o0e(e){if(e.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let t=a0e(e.type);if(e.times===void 0){let i=[],r=[];Dq(e.keys,i,r,"value"),e.times=i,e.values=r}return t.parse!==void 0?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}var m2={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},Lq=class{constructor(e,t,i){let r=this,n=!1,s=0,a=0,o,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(u){a++,n===!1&&r.onStart!==void 0&&r.onStart(u,s,a),n=!0},this.itemEnd=function(u){s++,r.onProgress!==void 0&&r.onProgress(u,s,a),s===a&&(n=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(u){r.onError!==void 0&&r.onError(u)},this.resolveURL=function(u){return o?o(u):u},this.setURLModifier=function(u){return o=u,this},this.addHandler=function(u,c){return l.push(u,c),this},this.removeHandler=function(u){let c=l.indexOf(u);return c!==-1&&l.splice(c,2),this},this.getHandler=function(u){for(let c=0,h=l.length;c<h;c+=2){let d=l[c],p=l[c+1];if(d.global&&(d.lastIndex=0),d.test(u))return p}return null}}},l0e=new Lq,H_=class{constructor(e){this.manager=e!==void 0?e:l0e,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let i=this;return new Promise(function(r,n){i.load(e,r,t,n)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}},Gh={},u0e=class extends Error{constructor(e,t){super(e),this.response=t}},OI=class extends H_{constructor(e){super(e)}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let n=m2.get(e);if(n!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(n),this.manager.itemEnd(e)},0),n;if(Gh[e]!==void 0){Gh[e].push({onLoad:t,onProgress:i,onError:r});return}Gh[e]=[],Gh[e].push({onLoad:t,onProgress:i,onError:r});let s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(s).then(l=>{if(l.status===200||l.status===0){if(l.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||l.body===void 0||l.body.getReader===void 0)return l;let u=Gh[e],c=l.body.getReader(),h=l.headers.get("Content-Length")||l.headers.get("X-File-Size"),d=h?parseInt(h):0,p=d!==0,m=0,v=new ReadableStream({start(g){w();function w(){c.read().then(({done:S,value:_})=>{if(S)g.close();else{m+=_.byteLength;let A=new ProgressEvent("progress",{lengthComputable:p,loaded:m,total:d});for(let C=0,E=u.length;C<E;C++){let I=u[C];I.onProgress&&I.onProgress(A)}g.enqueue(_),w()}})}}});return new Response(v)}else throw new u0e(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`,l)}).then(l=>{switch(o){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(u=>new DOMParser().parseFromString(u,a));case"json":return l.json();default:if(a===void 0)return l.text();{let u=/charset="?([^;"\s]*)"?/i.exec(a),c=u&&u[1]?u[1].toLowerCase():void 0,h=new TextDecoder(c);return l.arrayBuffer().then(d=>h.decode(d))}}}).then(l=>{m2.add(e,l);let u=Gh[e];delete Gh[e];for(let c=0,h=u.length;c<h;c++){let d=u[c];d.onLoad&&d.onLoad(l)}}).catch(l=>{let u=Gh[e];if(u===void 0)throw this.manager.itemError(e),l;delete Gh[e];for(let c=0,h=u.length;c<h;c++){let d=u[c];d.onError&&d.onError(l)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}},c0e=class extends H_{constructor(e){super(e)}load(e,t,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let n=this,s=m2.get(e);if(s!==void 0)return n.manager.itemStart(e),setTimeout(function(){t&&t(s),n.manager.itemEnd(e)},0),s;let a=Hb("img");function o(){u(),m2.add(e,this),t&&t(this),n.manager.itemEnd(e)}function l(c){u(),r&&r(c),n.manager.itemError(e),n.manager.itemEnd(e)}function u(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),n.manager.itemStart(e),a.src=e,a}},h0e=class extends H_{constructor(e){super(e)}load(e,t,i,r){let n=new tn,s=new c0e(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,function(a){n.image=a,n.needsUpdate=!0,t!==void 0&&t(n)},i,r),n}},W_=class extends vr{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new li(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}},d0e=class extends W_{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(vr.DEFAULT_UP),this.updateMatrix(),this.groundColor=new li(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}},V3=new yt,B5=new H,N5=new H,sk=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Pe(512,512),this.map=null,this.mapPass=null,this.matrix=new yt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Zz,this._frameExtents=new Pe(1,1),this._viewportCount=1,this._viewports=[new bi(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,i=this.matrix;B5.setFromMatrixPosition(e.matrixWorld),t.position.copy(B5),N5.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(N5),t.updateMatrixWorld(),V3.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(V3),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(V3)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},f0e=class extends sk{constructor(){super(new La(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){let t=this.camera,i=jb*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,n=e.distance||t.far;(i!==t.fov||r!==t.aspect||n!==t.far)&&(t.fov=i,t.aspect=r,t.far=n,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}},p0e=class extends W_{constructor(e,t,i=0,r=Math.PI/3,n=0,s=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(vr.DEFAULT_UP),this.updateMatrix(),this.target=new vr,this.distance=i,this.angle=r,this.penumbra=n,this.decay=s,this.map=null,this.shadow=new f0e}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},F5=new yt,fw=new H,j3=new H,m0e=class extends sk{constructor(){super(new La(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Pe(4,2),this._viewportCount=6,this._viewports=[new bi(2,1,1,1),new bi(0,1,1,1),new bi(3,1,1,1),new bi(1,1,1,1),new bi(3,0,1,1),new bi(1,0,1,1)],this._cubeDirections=[new H(1,0,0),new H(-1,0,0),new H(0,0,1),new H(0,0,-1),new H(0,1,0),new H(0,-1,0)],this._cubeUps=[new H(0,1,0),new H(0,1,0),new H(0,1,0),new H(0,1,0),new H(0,0,1),new H(0,0,-1)]}updateMatrices(e,t=0){let i=this.camera,r=this.matrix,n=e.distance||i.far;n!==i.far&&(i.far=n,i.updateProjectionMatrix()),fw.setFromMatrixPosition(e.matrixWorld),i.position.copy(fw),j3.copy(i.position),j3.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(j3),i.updateMatrixWorld(),r.makeTranslation(-fw.x,-fw.y,-fw.z),F5.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(F5)}},g0e=class extends W_{constructor(e,t,i=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new m0e}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}},v0e=class extends sk{constructor(){super(new jC(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},y0e=class extends W_{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(vr.DEFAULT_UP),this.updateMatrix(),this.target=new vr,this.shadow=new v0e}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},Oq=class extends Kt{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){let e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}},zq=class extends H_{constructor(e){super(e)}load(e,t,i,r){let n=this,s=new OI(n.manager);s.setPath(n.path),s.setRequestHeader(n.requestHeader),s.setWithCredentials(n.withCredentials),s.load(e,function(a){try{t(n.parse(JSON.parse(a)))}catch(o){r?r(o):console.error(o),n.manager.itemError(e)}},i,r)}parse(e){let t={},i={};function r(h,d){if(t[d]!==void 0)return t[d];let p=h.interleavedBuffers[d],m=n(h,p.buffer),v=WM(p.type,m),g=new bve(v,p.stride);return g.uuid=p.uuid,t[d]=g,g}function n(h,d){if(i[d]!==void 0)return i[d];let p=h.arrayBuffers[d],m=new Uint32Array(p).buffer;return i[d]=m,m}let s=e.isInstancedBufferGeometry?new Oq:new Kt,a=e.data.index;if(a!==void 0){let h=WM(a.type,a.array);s.setIndex(new hi(h,1))}let o=e.data.attributes;for(let h in o){let d=o[h],p;if(d.isInterleavedBufferAttribute){let m=r(e.data,d.data);p=new DI(m,d.itemSize,d.offset,d.normalized)}else{let m=WM(d.type,d.array),v=d.isInstancedBufferAttribute?Wb:hi;p=new v(m,d.itemSize,d.normalized)}d.name!==void 0&&(p.name=d.name),d.usage!==void 0&&p.setUsage(d.usage),d.updateRange!==void 0&&(p.updateRange.offset=d.updateRange.offset,p.updateRange.count=d.updateRange.count),s.setAttribute(h,p)}let l=e.data.morphAttributes;if(l)for(let h in l){let d=l[h],p=[];for(let m=0,v=d.length;m<v;m++){let g=d[m],w;if(g.isInterleavedBufferAttribute){let S=r(e.data,g.data);w=new DI(S,g.itemSize,g.offset,g.normalized)}else{let S=WM(g.type,g.array);w=new hi(S,g.itemSize,g.normalized)}g.name!==void 0&&(w.name=g.name),p.push(w)}s.morphAttributes[h]=p}e.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);let u=e.data.groups||e.data.drawcalls||e.data.offsets;if(u!==void 0)for(let h=0,d=u.length;h!==d;++h){let p=u[h];s.addGroup(p.start,p.count,p.materialIndex)}let c=e.data.boundingSphere;if(c!==void 0){let h=new H;c.center!==void 0&&h.fromArray(c.center),s.boundingSphere=new Wo(h,c.radius)}return e.name&&(s.name=e.name),e.userData&&(s.userData=e.userData),s}},x0e=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=U5(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let t=U5();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}};function U5(){return(typeof performance>"u"?Date:performance).now()}var w0e=class{constructor(e,t,i){this.binding=e,this.valueSize=i;let r,n,s;switch(t){case"quaternion":r=this._slerp,n=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":r=this._select,n=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:r=this._lerp,n=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=n,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){let i=this.buffer,r=this.valueSize,n=e*r+r,s=this.cumulativeWeight;if(s===0){for(let a=0;a!==r;++a)i[n+a]=i[a];s=t}else{s+=t;let a=t/s;this._mixBufferRegion(i,n,0,a,r)}this.cumulativeWeight=s}accumulateAdditive(e){let t=this.buffer,i=this.valueSize,r=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){let t=this.valueSize,i=this.buffer,r=e*t+t,n=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,n<1){let o=t*this._origIndex;this._mixBufferRegion(i,r,o,1-n,t)}s>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*t,1,t);for(let o=t,l=t+t;o!==l;++o)if(i[o]!==i[o+t]){a.setValue(i,r);break}}saveOriginalState(){let e=this.binding,t=this.buffer,i=this.valueSize,r=i*this._origIndex;e.getValue(t,r);for(let n=i,s=r;n!==s;++n)t[n]=t[r+n%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,r,n){if(r>=.5)for(let s=0;s!==n;++s)e[t+s]=e[i+s]}_slerp(e,t,i,r){xi.slerpFlat(e,t,e,t,e,i,r)}_slerpAdditive(e,t,i,r,n){let s=this._workIndex*n;xi.multiplyQuaternionsFlat(e,s,e,t,e,i),xi.slerpFlat(e,t,e,t,e,s,r)}_lerp(e,t,i,r,n){let s=1-r;for(let a=0;a!==n;++a){let o=t+a;e[o]=e[o]*s+e[i+a]*r}}_lerpAdditive(e,t,i,r,n){for(let s=0;s!==n;++s){let a=t+s;e[a]=e[a]+e[i+s]*r}}},ak="\\[\\]\\.:\\/",b0e=new RegExp("["+ak+"]","g"),ok="[^"+ak+"]",_0e="[^"+ak.replace("\\.","")+"]",S0e=/((?:WC+[\/:])*)/.source.replace("WC",ok),M0e=/(WCOD+)?/.source.replace("WCOD",_0e),A0e=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",ok),E0e=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",ok),C0e=new RegExp("^"+S0e+M0e+A0e+E0e+"$"),T0e=["material","materials","bones","map"],P0e=class{constructor(e,t,i){let r=i||Tr.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();let i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(e,t)}setValue(e,t){let i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,n=i.length;r!==n;++r)i[r].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},Tr=class{constructor(e,t,i){this.path=t,this.parsedPath=i||Tr.parseTrackName(t),this.node=Tr.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new Tr.Composite(e,t,i):new Tr(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(b0e,"")}static parseTrackName(e){let t=C0e.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);let i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){let n=i.nodeName.substring(r+1);T0e.indexOf(n)!==-1&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=n)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){let i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){let i=function(n){for(let s=0;s<n.length;s++){let a=n[s];if(a.name===t||a.uuid===t)return a;let o=i(a.children);if(o)return o}return null},r=i(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)e[t++]=i[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node,t=this.parsedPath,i=t.objectName,r=t.propertyName,n=t.propertyIndex;if(e||(e=Tr.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let l=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===l){l=u;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(l!==void 0){if(e[l]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[l]}}let s=e[r];if(s===void 0){let l=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+r+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(n!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[n]!==void 0&&(n=e.morphTargetDictionary[n])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=n}else s.fromArray!==void 0&&s.toArray!==void 0?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};Tr.Composite=P0e;Tr.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Tr.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Tr.prototype.GetterByBindingType=[Tr.prototype._getValue_direct,Tr.prototype._getValue_array,Tr.prototype._getValue_arrayElement,Tr.prototype._getValue_toArray];Tr.prototype.SetterByBindingTypeAndVersioning=[[Tr.prototype._setValue_direct,Tr.prototype._setValue_direct_setNeedsUpdate,Tr.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Tr.prototype._setValue_array,Tr.prototype._setValue_array_setNeedsUpdate,Tr.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Tr.prototype._setValue_arrayElement,Tr.prototype._setValue_arrayElement_setNeedsUpdate,Tr.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Tr.prototype._setValue_fromArray,Tr.prototype._setValue_fromArray_setNeedsUpdate,Tr.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var D0e=class{constructor(e,t,i=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=r;let n=t.tracks,s=n.length,a=new Array(s),o={endingStart:Cy,endingEnd:Cy};for(let l=0;l!==s;++l){let u=n[l].createInterpolant(null);a[l]=u,u.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=J7,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){let r=this._clip.duration,n=e._clip.duration,s=n/r,a=r/n;e.warp(1,s,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){let e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){let r=this._mixer,n=r.time,s=this.timeScale,a=this._timeScaleInterpolant;a===null&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);let o=a.parameterPositions,l=a.sampleValues;return o[0]=n,o[1]=n+i,l[0]=e/s,l[1]=t/s,this}stopWarping(){let e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,r){if(!this.enabled){this._updateWeight(e);return}let n=this._startTime;if(n!==null){let o=(e-n)*i;o<0||i===0?t=0:(this._startTime=null,t=i*o)}t*=this._updateTimeScale(e);let s=this._updateTime(t),a=this._updateWeight(e);if(a>0){let o=this._interpolants,l=this._propertyBindings;switch(this.blendMode){case sde:for(let u=0,c=o.length;u!==c;++u)o[u].evaluate(s),l[u].accumulateAdditive(a);break;case Xz:default:for(let u=0,c=o.length;u!==c;++u)o[u].evaluate(s),l[u].accumulate(r,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;let i=this._weightInterpolant;if(i!==null){let r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;let i=this._timeScaleInterpolant;if(i!==null){let r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){let t=this._clip.duration,i=this.loop,r=this.time+e,n=this._loopCount,s=i===qz;if(e===0)return n===-1?r:s&&(n&1)===1?t-r:r;if(i===Z7){n===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(n===-1&&(e>=0?(n=0,this._setEndings(!0,this.repetitions===0,s)):this._setEndings(this.repetitions===0,!0,s)),r>=t||r<0){let a=Math.floor(r/t);r-=t*a,n+=Math.abs(a);let o=this.repetitions-n;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(o===1){let l=e<0;this._setEndings(l,!l,s)}else this._setEndings(!1,!1,s);this._loopCount=n,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(s&&(n&1)===1)return t-r}return r}_setEndings(e,t,i){let r=this._interpolantSettings;i?(r.endingStart=Ty,r.endingEnd=Ty):(e?r.endingStart=this.zeroSlopeAtStart?Ty:Cy:r.endingStart=o2,t?r.endingEnd=this.zeroSlopeAtEnd?Ty:Cy:r.endingEnd=o2)}_scheduleFading(e,t,i){let r=this._mixer,n=r.time,s=this._weightInterpolant;s===null&&(s=r._lendControlInterpolant(),this._weightInterpolant=s);let a=s.parameterPositions,o=s.sampleValues;return a[0]=n,o[0]=t,a[1]=n+e,o[1]=i,this}},R0e=new Float32Array(1),I0e=class extends Ys{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){let i=e._localRoot||this._root,r=e._clip.tracks,n=r.length,s=e._propertyBindings,a=e._interpolants,o=i.uuid,l=this._bindingsByRootAndName,u=l[o];u===void 0&&(u={},l[o]=u);for(let c=0;c!==n;++c){let h=r[c],d=h.name,p=u[d];if(p!==void 0)++p.referenceCount,s[c]=p;else{if(p=s[c],p!==void 0){p._cacheIndex===null&&(++p.referenceCount,this._addInactiveBinding(p,o,d));continue}let m=t&&t._propertyBindings[c].binding.parsedPath;p=new w0e(Tr.create(i,d,m),h.ValueTypeName,h.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,o,d),s[c]=p}a[c].resultBuffer=p.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){let i=(e._localRoot||this._root).uuid,r=e._clip.uuid,n=this._actionsByClip[r];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,r,i)}let t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){let n=t[i];n.useCount++===0&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){let n=t[i];--n.useCount===0&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){let r=this._actions,n=this._actionsByClip,s=n[t];if(s===void 0)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,n[t]=s;else{let a=s.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=r.length,r.push(e),s.actionByRoot[i]=e}_removeInactiveAction(e){let t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null;let n=e._clip.uuid,s=this._actionsByClip,a=s[n],o=a.knownActions,l=o[o.length-1],u=e._byClipCacheIndex;l._byClipCacheIndex=u,o[u]=l,o.pop(),e._byClipCacheIndex=null;let c=a.actionByRoot,h=(e._localRoot||this._root).uuid;delete c[h],o.length===0&&delete s[n],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){let n=t[i];--n.referenceCount===0&&this._removeInactiveBinding(n)}}_lendAction(e){let t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_takeBackAction(e){let t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_addInactiveBinding(e,t,i){let r=this._bindingsByRootAndName,n=this._bindings,s=r[t];s===void 0&&(s={},r[t]=s),s[i]=e,e._cacheIndex=n.length,n.push(e)}_removeInactiveBinding(e){let t=this._bindings,i=e.binding,r=i.rootNode.uuid,n=i.path,s=this._bindingsByRootAndName,a=s[r],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete a[n],Object.keys(a).length===0&&delete s[r]}_lendBinding(e){let t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_takeBackBinding(e){let t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_lendControlInterpolant(){let e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return i===void 0&&(i=new Rq(new Float32Array(2),new Float32Array(2),1,R0e),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){let t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,n=t[r];e.__cacheIndex=r,t[r]=e,n.__cacheIndex=i,t[i]=n}clipAction(e,t,i){let r=t||this._root,n=r.uuid,s=typeof e=="string"?LI.findByName(r,e):e,a=s!==null?s.uuid:e,o=this._actionsByClip[a],l=null;if(i===void 0&&(s!==null?i=s.blendMode:i=Xz),o!==void 0){let c=o.actionByRoot[n];if(c!==void 0&&c.blendMode===i)return c;l=o.knownActions[0],s===null&&(s=l._clip)}if(s===null)return null;let u=new D0e(this,s,t,i);return this._bindAction(u,l),this._addInactiveAction(u,a,n),u}existingAction(e,t){let i=t||this._root,r=i.uuid,n=typeof e=="string"?LI.findByName(i,e):e,s=n?n.uuid:e,a=this._actionsByClip[s];return a!==void 0&&a.actionByRoot[r]||null}stopAllAction(){let e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;let t=this._actions,i=this._nActiveActions,r=this.time+=e,n=Math.sign(e),s=this._accuIndex^=1;for(let l=0;l!==i;++l)t[l]._update(r,e,n,s);let a=this._bindings,o=this._nActiveBindings;for(let l=0;l!==o;++l)a[l].apply(s);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let t=this._actions,i=e.uuid,r=this._actionsByClip,n=r[i];if(n!==void 0){let s=n.knownActions;for(let a=0,o=s.length;a!==o;++a){let l=s[a];this._deactivateAction(l);let u=l._cacheIndex,c=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,c._cacheIndex=u,t[u]=c,t.pop(),this._removeInactiveBindingsForAction(l)}delete r[i]}}uncacheRoot(e){let t=e.uuid,i=this._actionsByClip;for(let s in i){let a=i[s].actionByRoot,o=a[t];o!==void 0&&(this._deactivateAction(o),this._removeInactiveAction(o))}let r=this._bindingsByRootAndName,n=r[t];if(n!==void 0)for(let s in n){let a=n[s];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){let i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}},ut=class{constructor(e){this.value=e}clone(){return new ut(this.value.clone===void 0?this.value:this.value.clone())}},kq=class{constructor(e,t,i=0,r=1/0){this.ray=new zx(e,t),this.near=i,this.far=r,this.camera=null,this.layers=new Qz,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return zI(e,this,i,t),i.sort(V5),i}intersectObjects(e,t=!0,i=[]){for(let r=0,n=e.length;r<n;r++)zI(e[r],this,i,t);return i.sort(V5),i}};function V5(e,t){return e.distance-t.distance}function zI(e,t,i,r){if(e.layers.test(t.layers)&&e.raycast(t,i),r===!0){let n=e.children;for(let s=0,a=n.length;s<a;s++)zI(n[s],t,i,!0)}}var j5=class{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(ts(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}},H5=new Pe,lk=class{constructor(e=new Pe(1/0,1/0),t=new Pe(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=H5.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return H5.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},W5=new H,mA=new H,Gl=class{constructor(e=new H,t=new H){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){W5.subVectors(e,this.start),mA.subVectors(this.end,this.start);let i=mA.dot(mA),r=mA.dot(W5)/i;return t&&(r=ts(r,0,1)),r}closestPointToPoint(e,t,i){let r=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}},G5=new H,L0e=class extends vr{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";let i=new Kt,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let s=0,a=1,o=32;s<o;s++,a++){let l=s/o*Math.PI*2,u=a/o*Math.PI*2;r.push(Math.cos(l),Math.sin(l),1,Math.cos(u),Math.sin(u),1)}i.setAttribute("position",new kt(r,3));let n=new Gp({fog:!1,toneMapped:!1});this.cone=new V_(i,n),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);let e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),G5.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(G5),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},O0e=class extends zr{constructor(e,t,i){let r=new jy(t,4,2),n=new Dd({wireframe:!0,fog:!1,toneMapped:!1});super(r,n),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},q5=new H,gA=new H,X5=new H,z0e=class extends vr{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",t===void 0&&(t=1);let r=new Kt;r.setAttribute("position",new kt([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));let n=new Gp({fog:!1,toneMapped:!1});this.lightPlane=new c2(r,n),this.add(this.lightPlane),r=new Kt,r.setAttribute("position",new kt([0,0,0,0,0,1],3)),this.targetLine=new c2(r,n),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),q5.setFromMatrixPosition(this.light.matrixWorld),gA.setFromMatrixPosition(this.light.target.matrixWorld),X5.subVectors(gA,q5),this.lightPlane.lookAt(gA),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(gA),this.targetLine.scale.z=X5.length()}},vA=new H,mn=new Wp,g2=class extends V_{constructor(e){let t=new Kt,i=new Gp({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],n=[],s={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(p,m){o(p),o(m)}function o(p){r.push(0,0,0),n.push(0,0,0),s[p]===void 0&&(s[p]=[]),s[p].push(r.length/3-1)}t.setAttribute("position",new kt(r,3)),t.setAttribute("color",new kt(n,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();let l=new li(16755200),u=new li(16711680),c=new li(43775),h=new li(16777215),d=new li(3355443);this.setColors(l,u,c,h,d)}setColors(e,t,i,r,n){let s=this.geometry.getAttribute("color");s.setXYZ(0,e.r,e.g,e.b),s.setXYZ(1,e.r,e.g,e.b),s.setXYZ(2,e.r,e.g,e.b),s.setXYZ(3,e.r,e.g,e.b),s.setXYZ(4,e.r,e.g,e.b),s.setXYZ(5,e.r,e.g,e.b),s.setXYZ(6,e.r,e.g,e.b),s.setXYZ(7,e.r,e.g,e.b),s.setXYZ(8,e.r,e.g,e.b),s.setXYZ(9,e.r,e.g,e.b),s.setXYZ(10,e.r,e.g,e.b),s.setXYZ(11,e.r,e.g,e.b),s.setXYZ(12,e.r,e.g,e.b),s.setXYZ(13,e.r,e.g,e.b),s.setXYZ(14,e.r,e.g,e.b),s.setXYZ(15,e.r,e.g,e.b),s.setXYZ(16,e.r,e.g,e.b),s.setXYZ(17,e.r,e.g,e.b),s.setXYZ(18,e.r,e.g,e.b),s.setXYZ(19,e.r,e.g,e.b),s.setXYZ(20,e.r,e.g,e.b),s.setXYZ(21,e.r,e.g,e.b),s.setXYZ(22,e.r,e.g,e.b),s.setXYZ(23,e.r,e.g,e.b),s.setXYZ(24,t.r,t.g,t.b),s.setXYZ(25,t.r,t.g,t.b),s.setXYZ(26,t.r,t.g,t.b),s.setXYZ(27,t.r,t.g,t.b),s.setXYZ(28,t.r,t.g,t.b),s.setXYZ(29,t.r,t.g,t.b),s.setXYZ(30,t.r,t.g,t.b),s.setXYZ(31,t.r,t.g,t.b),s.setXYZ(32,i.r,i.g,i.b),s.setXYZ(33,i.r,i.g,i.b),s.setXYZ(34,i.r,i.g,i.b),s.setXYZ(35,i.r,i.g,i.b),s.setXYZ(36,i.r,i.g,i.b),s.setXYZ(37,i.r,i.g,i.b),s.setXYZ(38,r.r,r.g,r.b),s.setXYZ(39,r.r,r.g,r.b),s.setXYZ(40,n.r,n.g,n.b),s.setXYZ(41,n.r,n.g,n.b),s.setXYZ(42,n.r,n.g,n.b),s.setXYZ(43,n.r,n.g,n.b),s.setXYZ(44,n.r,n.g,n.b),s.setXYZ(45,n.r,n.g,n.b),s.setXYZ(46,n.r,n.g,n.b),s.setXYZ(47,n.r,n.g,n.b),s.setXYZ(48,n.r,n.g,n.b),s.setXYZ(49,n.r,n.g,n.b),s.needsUpdate=!0}update(){let e=this.geometry,t=this.pointMap,i=1,r=1;mn.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Dn("c",t,e,mn,0,0,-1),Dn("t",t,e,mn,0,0,1),Dn("n1",t,e,mn,-i,-r,-1),Dn("n2",t,e,mn,i,-r,-1),Dn("n3",t,e,mn,-i,r,-1),Dn("n4",t,e,mn,i,r,-1),Dn("f1",t,e,mn,-i,-r,1),Dn("f2",t,e,mn,i,-r,1),Dn("f3",t,e,mn,-i,r,1),Dn("f4",t,e,mn,i,r,1),Dn("u1",t,e,mn,i*.7,r*1.1,-1),Dn("u2",t,e,mn,-i*.7,r*1.1,-1),Dn("u3",t,e,mn,0,r*2,-1),Dn("cf1",t,e,mn,-i,0,1),Dn("cf2",t,e,mn,i,0,1),Dn("cf3",t,e,mn,0,-r,1),Dn("cf4",t,e,mn,0,r,1),Dn("cn1",t,e,mn,-i,0,-1),Dn("cn2",t,e,mn,i,0,-1),Dn("cn3",t,e,mn,0,-r,-1),Dn("cn4",t,e,mn,0,r,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function Dn(e,t,i,r,n,s,a){vA.set(n,s,a).unproject(r);let o=t[e];if(o!==void 0){let l=i.getAttribute("position");for(let u=0,c=o.length;u<c;u++)l.setXYZ(o[u],vA.x,vA.y,vA.z)}}var v2=class extends V_{constructor(e,t=16776960){let i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],n=new Kt;n.setIndex(new hi(i,1)),n.setAttribute("position",new kt(r,3)),super(n,new Gp({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){let t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}},k0e=class extends V_{constructor(e=1){let t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new Kt;r.setAttribute("position",new kt(t,3)),r.setAttribute("color",new kt(i,3));let n=new Gp({vertexColors:!0,toneMapped:!1});super(r,n),this.type="AxesHelper"}setColors(e,t,i){let r=new li,n=this.geometry.attributes.color.array;return r.set(e),r.toArray(n,0),r.toArray(n,3),r.set(t),r.toArray(n,6),r.toArray(n,9),r.set(i),r.toArray(n,12),r.toArray(n,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},hd=B0e();function B0e(){let e=new ArrayBuffer(4),t=new Float32Array(e),i=new Uint32Array(e),r=new Uint32Array(512),n=new Uint32Array(512);for(let l=0;l<256;++l){let u=l-127;u<-27?(r[l]=0,r[l|256]=32768,n[l]=24,n[l|256]=24):u<-14?(r[l]=1024>>-u-14,r[l|256]=1024>>-u-14|32768,n[l]=-u-1,n[l|256]=-u-1):u<=15?(r[l]=u+15<<10,r[l|256]=u+15<<10|32768,n[l]=13,n[l|256]=13):u<128?(r[l]=31744,r[l|256]=64512,n[l]=24,n[l|256]=24):(r[l]=31744,r[l|256]=64512,n[l]=13,n[l|256]=13)}let s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let u=l<<13,c=0;for(;(u&8388608)===0;)u<<=1,c-=8388608;u&=-8388609,c+=947912704,s[l]=u|c}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:t,uint32View:i,baseTable:r,shiftTable:n,mantissaTable:s,exponentTable:a,offsetTable:o}}function N0e(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=ts(e,-65504,65504),hd.floatView[0]=e;let t=hd.uint32View[0],i=t>>23&511;return hd.baseTable[i]+((t&8388607)>>hd.shiftTable[i])}function F0e(e){let t=e>>10;return hd.uint32View[0]=hd.mantissaTable[hd.offsetTable[t]+(e&1023)]+hd.exponentTable[t],hd.floatView[0]}var U0e=Object.freeze({__proto__:null,fromHalfFloat:F0e,toHalfFloat:N0e});typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Ox}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Ox);var pw=".",uk=Symbol("target"),Bq=Symbol("unsubscribe");function kI(e){return e instanceof Date||e instanceof Set||e instanceof Map||e instanceof WeakSet||e instanceof WeakMap||ArrayBuffer.isView(e)}function V0e(e){return(typeof e=="object"?e===null:typeof e!="function")||e instanceof RegExp}var Oc=Array.isArray;function ck(e){return typeof e=="symbol"}var j0e={after:(e,t)=>Oc(e)?e.slice(t.length):t===""?e:e.slice(t.length+1),concat:(e,t)=>Oc(e)?(e=[...e],t&&e.push(t),e):t&&t.toString!==void 0?(e!==""&&(e+=pw),ck(t)?e+t.toString():e+t):e,initial:e=>{if(Oc(e))return e.slice(0,-1);if(e==="")return e;let t=e.lastIndexOf(pw);return t===-1?"":e.slice(0,t)},last:e=>{if(Oc(e))return e[e.length-1]||"";if(e==="")return e;let t=e.lastIndexOf(pw);return t===-1?e:e.slice(t+1)},walk:(e,t)=>{if(Oc(e))for(let i of e)t(i);else if(e!==""){let i=0,r=e.indexOf(pw);if(r===-1)t(e);else for(;i<e.length;)r===-1&&(r=e.length),t(e.slice(i,r)),i=r+1,r=e.indexOf(pw,i)}},get(e,t){return this.walk(t,i=>{e&&(e=e[i])}),e}},kl=j0e;function H0e(e){return typeof e=="object"&&typeof e.next=="function"}function W0e(e,t,i,r,n){let s=e.next;if(t.name==="entries")e.next=function(){let a=s.call(this);return a.done===!1&&(a.value[0]=n(a.value[0],t,a.value[0],r),a.value[1]=n(a.value[1],t,a.value[0],r)),a};else if(t.name==="values"){let a=i[uk].keys();e.next=function(){let o=s.call(this);return o.done===!1&&(o.value=n(o.value,t,a.next().value,r)),o}}else e.next=function(){let a=s.call(this);return a.done===!1&&(a.value=n(a.value,t,a.value,r)),a};return e}function Y5(e,t,i){return e.isUnsubscribed||t.ignoreSymbols&&ck(i)||t.ignoreUnderscores&&i.charAt(0)==="_"||"ignoreKeys"in t&&t.ignoreKeys.includes(i)}var G0e=class{constructor(e){this._equals=e,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}_getDescriptorCache(){return this._descriptorCache===void 0&&(this._descriptorCache=new WeakMap),this._descriptorCache}_getProperties(e){let t=this._getDescriptorCache(),i=t.get(e);return i===void 0&&(i={},t.set(e,i)),i}_getOwnPropertyDescriptor(e,t){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(e,t);let i=this._getProperties(e),r=i[t];return r===void 0&&(r=Reflect.getOwnPropertyDescriptor(e,t),i[t]=r),r}getProxy(e,t,i,r){if(this.isUnsubscribed)return e;let n=e[r],s=n||e;this._pathCache.set(s,t);let a=this._proxyCache.get(s);return a===void 0&&(a=n===void 0?new Proxy(e,i):e,this._proxyCache.set(s,a)),a}getPath(e){return this.isUnsubscribed?void 0:this._pathCache.get(e)}isDetached(e,t){return!Object.is(e,kl.get(t,this.getPath(e)))}defineProperty(e,t,i){return Reflect.defineProperty(e,t,i)?(this.isUnsubscribed||(this._getProperties(e)[t]=i),!0):!1}setProperty(e,t,i,r,n){if(!this._equals(n,i)||!(t in e)){let s=this._getOwnPropertyDescriptor(e,t);return s!==void 0&&"set"in s?Reflect.set(e,t,i,r):Reflect.set(e,t,i)}return!0}deleteProperty(e,t,i){if(Reflect.deleteProperty(e,t)){if(!this.isUnsubscribed){let r=this._getDescriptorCache().get(e);r&&(delete r[t],this._pathCache.delete(i))}return!0}return!1}isSameDescriptor(e,t,i){let r=this._getOwnPropertyDescriptor(t,i);return e!==void 0&&r!==void 0&&Object.is(e.value,r.value)&&(e.writable||!1)===(r.writable||!1)&&(e.enumerable||!1)===(r.enumerable||!1)&&(e.configurable||!1)===(r.configurable||!1)&&e.get===r.get&&e.set===r.set}isGetInvariant(e,t){let i=this._getOwnPropertyDescriptor(e,t);return i!==void 0&&i.configurable!==!0&&i.writable!==!0}unsubscribe(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}};function BI(e){return toString.call(e)==="[object Object]"}function yA(){return!0}function q0(e,t){return e.length!==t.length||e.some((i,r)=>t[r]!==i)}var Nq=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),q0e=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),Fq={push:yA,pop:yA,shift:yA,unshift:yA,copyWithin:q0,reverse:q0,sort:q0,splice:q0,flat:q0,fill:q0},X0e=new Set([...Nq,...q0e,...Object.keys(Fq)]);function xA(e,t){if(e.size!==t.size)return!0;for(let i of e)if(!t.has(i))return!0;return!1}var Uq=["keys","values","entries"],Vq=new Set(["has","toString"]),jq={add:xA,clear:xA,delete:xA,forEach:xA},Y0e=new Set([...Vq,...Object.keys(jq),...Uq]);function wA(e,t){if(e.size!==t.size)return!0;let i;for(let[r,n]of e)if(i=t.get(r),i!==n||i===void 0&&!t.has(r))return!0;return!1}var Q0e=new Set([...Vq,"get"]),Hq={set:wA,clear:wA,delete:wA,forEach:wA},K0e=new Set([...Q0e,...Object.keys(Hq),...Uq]),Lp=class{constructor(e,t,i,r){this._path=t,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=r,this._changes=r?[]:null,this.clone=t===void 0?e:this._shallowClone(e)}static isHandledMethod(e){return Nq.has(e)}_shallowClone(e){let t=e;if(BI(e))t={...e};else if(Oc(e))t=[...e];else if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set([...e].map(i=>this._shallowClone(i)));else if(e instanceof Map){t=new Map;for(let[i,r]of e.entries())t.set(i,this._shallowClone(r))}return this._clonedCache.add(t),t}preferredThisArg(e,t,i,r){return e?(Oc(r)?this._onIsChanged=Fq[t]:r instanceof Set?this._onIsChanged=jq[t]:r instanceof Map&&(this._onIsChanged=Hq[t]),r):i}update(e,t,i){let r=kl.after(e,this._path);if(t!=="length"){let n=this.clone;kl.walk(r,s=>{n&&n[s]&&(this._clonedCache.has(n[s])||(n[s]=this._shallowClone(n[s])),n=n[s])}),this._hasOnValidate&&this._changes.push({path:r,property:t,previous:i}),n&&n[t]&&(n[t]=i)}this._isChanged=!0}undo(e){let t;for(let i=this._changes.length-1;i!==-1;i--)t=this._changes[i],kl.get(e,t.path)[t.property]=t.previous}isChanged(e){return this._onIsChanged===void 0?this._isChanged:this._onIsChanged(this.clone,e)}},Q5=class extends Lp{static isHandledMethod(e){return X0e.has(e)}},Z0e=class extends Lp{undo(e){e.setTime(this.clone.getTime())}isChanged(e,t){return!t(this.clone.valueOf(),e.valueOf())}},K5=class extends Lp{static isHandledMethod(e){return Y0e.has(e)}undo(e){for(let t of this.clone)e.add(t);for(let t of e)this.clone.has(t)||e.delete(t)}},Z5=class extends Lp{static isHandledMethod(e){return K0e.has(e)}undo(e){for(let[t,i]of this.clone.entries())e.set(t,i);for(let t of e.keys())this.clone.has(t)||e.delete(t)}},J0e=class extends Lp{constructor(e,t,i,r){super(void 0,t,i,r),this._arg1=i[0],this._weakValue=e.has(this._arg1)}isChanged(e){return this._weakValue!==e.has(this._arg1)}undo(e){this._weakValue&&!e.has(this._arg1)?e.add(this._arg1):e.delete(this._arg1)}},$0e=class extends Lp{constructor(e,t,i,r){super(void 0,t,i,r),this._weakKey=i[0],this._weakHas=e.has(this._weakKey),this._weakValue=e.get(this._weakKey)}isChanged(e){return this._weakValue!==e.get(this._weakKey)}undo(e){let t=e.has(this._weakKey);this._weakHas&&!t?e.set(this._weakKey,this._weakValue):!this._weakHas&&t?e.delete(this._weakKey):this._weakValue!==e.get(this._weakKey)&&e.set(this._weakKey,this._weakValue)}},py=class{constructor(e){this._stack=[],this._hasOnValidate=e}static isHandledType(e){return BI(e)||Oc(e)||kI(e)}static isHandledMethod(e,t){return BI(e)?Lp.isHandledMethod(t):Oc(e)?Q5.isHandledMethod(t):e instanceof Set?K5.isHandledMethod(t):e instanceof Map?Z5.isHandledMethod(t):kI(e)}get isCloning(){return this._stack.length>0}start(e,t,i){let r=Lp;Oc(e)?r=Q5:e instanceof Date?r=Z0e:e instanceof Set?r=K5:e instanceof Map?r=Z5:e instanceof WeakSet?r=J0e:e instanceof WeakMap&&(r=$0e),this._stack.push(new r(e,t,i,this._hasOnValidate))}update(e,t,i){this._stack[this._stack.length-1].update(e,t,i)}preferredThisArg(e,t,i){let{name:r}=e,n=py.isHandledMethod(i,r);return this._stack[this._stack.length-1].preferredThisArg(n,r,t,i)}isChanged(e,t,i){return this._stack[this._stack.length-1].isChanged(e,t,i)}undo(e){this._previousClone!==void 0&&this._previousClone.undo(e)}stop(){return this._previousClone=this._stack.pop(),this._previousClone.clone}},eye={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},hk=(e,t,i={})=>{i={...eye,...i};let r=Symbol("ProxyTarget"),{equals:n,isShallow:s,ignoreDetached:a,details:o}=i,l=new G0e(n),u=typeof i.onValidate=="function",c=new py(u),h=(S,_,A,C,E)=>!u||c.isCloning||i.onValidate(kl.concat(l.getPath(S),_),A,C,E)===!0,d=(S,_,A,C)=>{!Y5(l,i,_)&&!(a&&l.isDetached(S,e))&&p(l.getPath(S),_,A,C)},p=(S,_,A,C,E)=>{c.isCloning?c.update(S,_,C):t(kl.concat(S,_),A,C,E)},m=S=>S&&(S[r]||S),v=(S,_,A,C)=>V0e(S)||A==="constructor"||s&&!py.isHandledMethod(_,A)||Y5(l,i,A)||l.isGetInvariant(_,A)||a&&l.isDetached(_,e)?S:(C===void 0&&(C=l.getPath(_)),l.getProxy(S,kl.concat(C,A),g,r)),g={get(S,_,A){if(ck(_)){if(_===r||_===uk)return S;if(_===Bq&&!l.isUnsubscribed&&l.getPath(S).length===0)return l.unsubscribe(),S}let C=kI(S)?Reflect.get(S,_):Reflect.get(S,_,A);return v(C,S,_)},set(S,_,A,C){A=m(A);let E=S[r]||S,I=E[_];if(n(I,A)&&_ in S)return!0;let T=h(S,_,A,I);return T&&l.setProperty(E,_,A,C,I)?(d(S,_,S[_],I),!0):!T},defineProperty(S,_,A){if(!l.isSameDescriptor(A,S,_)){let C=S[_];h(S,_,A.value,C)&&l.defineProperty(S,_,A,C)&&d(S,_,A.value,C)}return!0},deleteProperty(S,_){if(!Reflect.has(S,_))return!0;let A=Reflect.get(S,_),C=h(S,_,void 0,A);return C&&l.deleteProperty(S,_,A)?(d(S,_,void 0,A),!0):!C},apply(S,_,A){let C=_[r]||_;if(l.isUnsubscribed)return Reflect.apply(S,C,A);if((o===!1||o!==!0&&!o.includes(S.name))&&py.isHandledType(C)){let E=kl.initial(l.getPath(S)),I=py.isHandledMethod(C,S.name);c.start(C,E,A);let T=Reflect.apply(S,c.preferredThisArg(S,_,C),I?A.map(z=>m(z)):A),D=c.isChanged(C,n),L=c.stop();if(py.isHandledType(T)&&I&&(_ instanceof Map&&S.name==="get"&&(E=kl.concat(E,A[0])),T=l.getProxy(T,E,g)),D){let z={name:S.name,args:A,result:T},G=c.isCloning?kl.initial(E):E,V=c.isCloning?kl.last(E):"";h(kl.get(e,G),V,C,L,z)?p(G,V,C,L,z):c.undo(C)}return(_ instanceof Map||_ instanceof Set)&&H0e(T)?W0e(T,S,_,E,v):T}return Reflect.apply(S,_,A)}},w=l.getProxy(e,i.pathAsArray?[]:"",g);return t=t.bind(w),u&&(i.onValidate=i.onValidate.bind(w)),w};hk.target=e=>e&&e[uk]||e;hk.unsubscribe=e=>e[Bq]||e;var J5=hk,tye=typeof global=="object"&&global&&global.Object===Object&&global,Wq=tye,iye=typeof self=="object"&&self&&self.Object===Object&&self,rye=Wq||iye||Function("return this")(),Xu=rye,nye=Xu.Symbol,Yl=nye,Gq=Object.prototype,sye=Gq.hasOwnProperty,aye=Gq.toString,mw=Yl?Yl.toStringTag:void 0;function oye(e){var t=sye.call(e,mw),i=e[mw];try{e[mw]=void 0;var r=!0}catch{}var n=aye.call(e);return r&&(t?e[mw]=i:delete e[mw]),n}var lye=oye,uye=Object.prototype,cye=uye.toString;function hye(e){return cye.call(e)}var dye=hye,fye="[object Null]",pye="[object Undefined]",$5=Yl?Yl.toStringTag:void 0;function mye(e){return e==null?e===void 0?pye:fye:$5&&$5 in Object(e)?lye(e):dye(e)}var ov=mye;function gye(e){return e!=null&&typeof e=="object"}var Rd=gye,vye="[object Symbol]";function yye(e){return typeof e=="symbol"||Rd(e)&&ov(e)==vye}var G_=yye;function xye(e,t){for(var i=-1,r=e==null?0:e.length,n=Array(r);++i<r;)n[i]=t(e[i],i,e);return n}var qq=xye,wye=Array.isArray,Jc=wye,eV=Yl?Yl.prototype:void 0,tV=eV?eV.toString:void 0;function Xq(e){if(typeof e=="string")return e;if(Jc(e))return qq(e,Xq)+"";if(G_(e))return tV?tV.call(e):"";var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}var Yq=Xq,bye=/\s/;function _ye(e){for(var t=e.length;t--&&bye.test(e.charAt(t)););return t}var Qq=_ye,Sye=/^\s+/;function Mye(e){return e&&e.slice(0,Qq(e)+1).replace(Sye,"")}var Aye=Mye;function Eye(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var dl=Eye,iV=NaN,Cye=/^[-+]0x[0-9a-f]+$/i,Tye=/^0b[01]+$/i,Pye=/^0o[0-7]+$/i,Dye=parseInt;function Rye(e){if(typeof e=="number")return e;if(G_(e))return iV;if(dl(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=dl(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Aye(e);var i=Tye.test(e);return i||Pye.test(e)?Dye(e.slice(2),i?2:8):Cye.test(e)?iV:+e}var rV=Rye;function Iye(e){return e}var Kq=Iye,Lye="[object AsyncFunction]",Oye="[object Function]",zye="[object GeneratorFunction]",kye="[object Proxy]";function Bye(e){if(!dl(e))return!1;var t=ov(e);return t==Oye||t==zye||t==Lye||t==kye}var Zq=Bye,Nye=Xu["__core-js_shared__"],H3=Nye,nV=(function(){var e=/[^.]+$/.exec(H3&&H3.keys&&H3.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""})();function Fye(e){return!!nV&&nV in e}var Uye=Fye,Vye=Function.prototype,jye=Vye.toString;function Hye(e){if(e!=null){try{return jye.call(e)}catch{}try{return e+""}catch{}}return""}var lv=Hye,Wye=/[\\^$.*+?()[\]{}|]/g,Gye=/^\[object .+?Constructor\]$/,qye=Function.prototype,Xye=Object.prototype,Yye=qye.toString,Qye=Xye.hasOwnProperty,Kye=RegExp("^"+Yye.call(Qye).replace(Wye,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Zye(e){if(!dl(e)||Uye(e))return!1;var t=Zq(e)?Kye:Gye;return t.test(lv(e))}var Jye=Zye;function $ye(e,t){return e?.[t]}var exe=$ye;function txe(e,t){var i=exe(e,t);return Jye(i)?i:void 0}var uv=txe,ixe=uv(Xu,"WeakMap"),NI=ixe,sV=Object.create,rxe=(function(){function e(){}return function(t){if(!dl(t))return{};if(sV)return sV(t);e.prototype=t;var i=new e;return e.prototype=void 0,i}})(),nxe=rxe;function sxe(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}var axe=sxe;function oxe(e,t){var i=-1,r=e.length;for(t||(t=Array(r));++i<r;)t[i]=e[i];return t}var lxe=oxe,uxe=800,cxe=16,hxe=Date.now;function dxe(e){var t=0,i=0;return function(){var r=hxe(),n=cxe-(r-i);if(i=r,n>0){if(++t>=uxe)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var fxe=dxe;function pxe(e){return function(){return e}}var mxe=pxe,gxe=(function(){try{var e=uv(Object,"defineProperty");return e({},"",{}),e}catch{}})(),y2=gxe,vxe=y2?function(e,t){return y2(e,"toString",{configurable:!0,enumerable:!1,value:mxe(t),writable:!0})}:Kq,yxe=vxe,xxe=fxe(yxe),wxe=xxe;function bxe(e,t){for(var i=-1,r=e==null?0:e.length;++i<r&&t(e[i],i,e)!==!1;);return e}var _xe=bxe;function Sxe(e,t,i,r){for(var n=e.length,s=i+(r?1:-1);r?s--:++s<n;)if(t(e[s],s,e))return s;return-1}var Mxe=Sxe;function Axe(e){return e!==e}var Exe=Axe;function Cxe(e,t,i){for(var r=i-1,n=e.length;++r<n;)if(e[r]===t)return r;return-1}var Txe=Cxe;function Pxe(e,t,i){return t===t?Txe(e,t,i):Mxe(e,Exe,i)}var Dxe=Pxe,Rxe=9007199254740991,Ixe=/^(?:0|[1-9]\d*)$/;function Lxe(e,t){var i=typeof e;return t=t??Rxe,!!t&&(i=="number"||i!="symbol"&&Ixe.test(e))&&e>-1&&e%1==0&&e<t}var dk=Lxe;function Oxe(e,t,i){t=="__proto__"&&y2?y2(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}var Jq=Oxe;function zxe(e,t){return e===t||e!==e&&t!==t}var fk=zxe,kxe=Object.prototype,Bxe=kxe.hasOwnProperty;function Nxe(e,t,i){var r=e[t];(!(Bxe.call(e,t)&&fk(r,i))||i===void 0&&!(t in e))&&Jq(e,t,i)}var pk=Nxe;function Fxe(e,t,i,r){var n=!i;i||(i={});for(var s=-1,a=t.length;++s<a;){var o=t[s],l=r?r(i[o],e[o],o,i,e):void 0;l===void 0&&(l=e[o]),n?Jq(i,o,l):pk(i,o,l)}return i}var q_=Fxe,aV=Math.max;function Uxe(e,t,i){return t=aV(t===void 0?e.length-1:t,0),function(){for(var r=arguments,n=-1,s=aV(r.length-t,0),a=Array(s);++n<s;)a[n]=r[t+n];n=-1;for(var o=Array(t+1);++n<t;)o[n]=r[n];return o[t]=i(a),axe(e,this,o)}}var Vxe=Uxe,jxe=9007199254740991;function Hxe(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=jxe}var mk=Hxe;function Wxe(e){return e!=null&&mk(e.length)&&!Zq(e)}var $q=Wxe,Gxe=Object.prototype;function qxe(e){var t=e&&e.constructor,i=typeof t=="function"&&t.prototype||Gxe;return e===i}var gk=qxe;function Xxe(e,t){for(var i=-1,r=Array(e);++i<e;)r[i]=t(i);return r}var Yxe=Xxe,Qxe="[object Arguments]";function Kxe(e){return Rd(e)&&ov(e)==Qxe}var oV=Kxe,eX=Object.prototype,Zxe=eX.hasOwnProperty,Jxe=eX.propertyIsEnumerable,$xe=oV((function(){return arguments})())?oV:function(e){return Rd(e)&&Zxe.call(e,"callee")&&!Jxe.call(e,"callee")},vk=$xe;function e1e(){return!1}var t1e=e1e,tX=typeof exports=="object"&&exports&&!exports.nodeType&&exports,lV=tX&&typeof module=="object"&&module&&!module.nodeType&&module,i1e=lV&&lV.exports===tX,uV=i1e?Xu.Buffer:void 0,r1e=uV?uV.isBuffer:void 0,n1e=r1e||t1e,x2=n1e,s1e="[object Arguments]",a1e="[object Array]",o1e="[object Boolean]",l1e="[object Date]",u1e="[object Error]",c1e="[object Function]",h1e="[object Map]",d1e="[object Number]",f1e="[object Object]",p1e="[object RegExp]",m1e="[object Set]",g1e="[object String]",v1e="[object WeakMap]",y1e="[object ArrayBuffer]",x1e="[object DataView]",w1e="[object Float32Array]",b1e="[object Float64Array]",_1e="[object Int8Array]",S1e="[object Int16Array]",M1e="[object Int32Array]",A1e="[object Uint8Array]",E1e="[object Uint8ClampedArray]",C1e="[object Uint16Array]",T1e="[object Uint32Array]",qr={};qr[w1e]=qr[b1e]=qr[_1e]=qr[S1e]=qr[M1e]=qr[A1e]=qr[E1e]=qr[C1e]=qr[T1e]=!0;qr[s1e]=qr[a1e]=qr[y1e]=qr[o1e]=qr[x1e]=qr[l1e]=qr[u1e]=qr[c1e]=qr[h1e]=qr[d1e]=qr[f1e]=qr[p1e]=qr[m1e]=qr[g1e]=qr[v1e]=!1;function P1e(e){return Rd(e)&&mk(e.length)&&!!qr[ov(e)]}var D1e=P1e;function R1e(e){return function(t){return e(t)}}var yk=R1e,iX=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ab=iX&&typeof module=="object"&&module&&!module.nodeType&&module,I1e=ab&&ab.exports===iX,W3=I1e&&Wq.process,L1e=(function(){try{var e=ab&&ab.require&&ab.require("util").types;return e||W3&&W3.binding&&W3.binding("util")}catch{}})(),lx=L1e,cV=lx&&lx.isTypedArray,O1e=cV?yk(cV):D1e,rX=O1e,z1e=Object.prototype,k1e=z1e.hasOwnProperty;function B1e(e,t){var i=Jc(e),r=!i&&vk(e),n=!i&&!r&&x2(e),s=!i&&!r&&!n&&rX(e),a=i||r||n||s,o=a?Yxe(e.length,String):[],l=o.length;for(var u in e)(t||k1e.call(e,u))&&!(a&&(u=="length"||n&&(u=="offset"||u=="parent")||s&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||dk(u,l)))&&o.push(u);return o}var nX=B1e;function N1e(e,t){return function(i){return e(t(i))}}var sX=N1e,F1e=sX(Object.keys,Object),U1e=F1e,V1e=Object.prototype,j1e=V1e.hasOwnProperty;function H1e(e){if(!gk(e))return U1e(e);var t=[];for(var i in Object(e))j1e.call(e,i)&&i!="constructor"&&t.push(i);return t}var W1e=H1e;function G1e(e){return $q(e)?nX(e):W1e(e)}var xk=G1e;function q1e(e){var t=[];if(e!=null)for(var i in Object(e))t.push(i);return t}var X1e=q1e,Y1e=Object.prototype,Q1e=Y1e.hasOwnProperty;function K1e(e){if(!dl(e))return X1e(e);var t=gk(e),i=[];for(var r in e)r=="constructor"&&(t||!Q1e.call(e,r))||i.push(r);return i}var Z1e=K1e;function J1e(e){return $q(e)?nX(e,!0):Z1e(e)}var mg=J1e,$1e=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ewe=/^\w*$/;function twe(e,t){if(Jc(e))return!1;var i=typeof e;return i=="number"||i=="symbol"||i=="boolean"||e==null||G_(e)?!0:ewe.test(e)||!$1e.test(e)||t!=null&&e in Object(t)}var iwe=twe,rwe=uv(Object,"create"),Yb=rwe;function nwe(){this.__data__=Yb?Yb(null):{},this.size=0}var swe=nwe;function awe(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var owe=awe,lwe="__lodash_hash_undefined__",uwe=Object.prototype,cwe=uwe.hasOwnProperty;function hwe(e){var t=this.__data__;if(Yb){var i=t[e];return i===lwe?void 0:i}return cwe.call(t,e)?t[e]:void 0}var dwe=hwe,fwe=Object.prototype,pwe=fwe.hasOwnProperty;function mwe(e){var t=this.__data__;return Yb?t[e]!==void 0:pwe.call(t,e)}var gwe=mwe,vwe="__lodash_hash_undefined__";function ywe(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=Yb&&t===void 0?vwe:t,this}var xwe=ywe;function Ux(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}Ux.prototype.clear=swe;Ux.prototype.delete=owe;Ux.prototype.get=dwe;Ux.prototype.has=gwe;Ux.prototype.set=xwe;var hV=Ux;function wwe(){this.__data__=[],this.size=0}var bwe=wwe;function _we(e,t){for(var i=e.length;i--;)if(fk(e[i][0],t))return i;return-1}var XC=_we,Swe=Array.prototype,Mwe=Swe.splice;function Awe(e){var t=this.__data__,i=XC(t,e);if(i<0)return!1;var r=t.length-1;return i==r?t.pop():Mwe.call(t,i,1),--this.size,!0}var Ewe=Awe;function Cwe(e){var t=this.__data__,i=XC(t,e);return i<0?void 0:t[i][1]}var Twe=Cwe;function Pwe(e){return XC(this.__data__,e)>-1}var Dwe=Pwe;function Rwe(e,t){var i=this.__data__,r=XC(i,e);return r<0?(++this.size,i.push([e,t])):i[r][1]=t,this}var Iwe=Rwe;function Vx(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}Vx.prototype.clear=bwe;Vx.prototype.delete=Ewe;Vx.prototype.get=Twe;Vx.prototype.has=Dwe;Vx.prototype.set=Iwe;var YC=Vx,Lwe=uv(Xu,"Map"),Qb=Lwe;function Owe(){this.size=0,this.__data__={hash:new hV,map:new(Qb||YC),string:new hV}}var zwe=Owe;function kwe(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var Bwe=kwe;function Nwe(e,t){var i=e.__data__;return Bwe(t)?i[typeof t=="string"?"string":"hash"]:i.map}var QC=Nwe;function Fwe(e){var t=QC(this,e).delete(e);return this.size-=t?1:0,t}var Uwe=Fwe;function Vwe(e){return QC(this,e).get(e)}var jwe=Vwe;function Hwe(e){return QC(this,e).has(e)}var Wwe=Hwe;function Gwe(e,t){var i=QC(this,e),r=i.size;return i.set(e,t),this.size+=i.size==r?0:1,this}var qwe=Gwe;function jx(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}jx.prototype.clear=zwe;jx.prototype.delete=Uwe;jx.prototype.get=jwe;jx.prototype.has=Wwe;jx.prototype.set=qwe;var KC=jx,Xwe="Expected a function";function wk(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(Xwe);var i=function(){var r=arguments,n=t?t.apply(this,r):r[0],s=i.cache;if(s.has(n))return s.get(n);var a=e.apply(this,r);return i.cache=s.set(n,a)||s,a};return i.cache=new(wk.Cache||KC),i}wk.Cache=KC;var Ywe=wk,Qwe=500;function Kwe(e){var t=Ywe(e,function(r){return i.size===Qwe&&i.clear(),r}),i=t.cache;return t}var Zwe=Kwe,Jwe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,$we=/\\(\\)?/g,ebe=Zwe(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Jwe,function(i,r,n,s){t.push(n?s.replace($we,"$1"):r||i)}),t}),tbe=ebe;function ibe(e){return e==null?"":Yq(e)}var aX=ibe;function rbe(e,t){return Jc(e)?e:iwe(e,t)?[e]:tbe(aX(e))}var Hx=rbe;function nbe(e){if(typeof e=="string"||G_(e))return e;var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}var ZC=nbe;function sbe(e,t){t=Hx(t,e);for(var i=0,r=t.length;e!=null&&i<r;)e=e[ZC(t[i++])];return i&&i==r?e:void 0}var oX=sbe;function abe(e,t){for(var i=-1,r=t.length,n=e.length;++i<r;)e[n+i]=t[i];return e}var bk=abe,dV=Yl?Yl.isConcatSpreadable:void 0;function obe(e){return Jc(e)||vk(e)||!!(dV&&e&&e[dV])}var lbe=obe;function lX(e,t,i,r,n){var s=-1,a=e.length;for(i||(i=lbe),n||(n=[]);++s<a;){var o=e[s];t>0&&i(o)?t>1?lX(o,t-1,i,r,n):bk(n,o):r||(n[n.length]=o)}return n}var ube=lX;function cbe(e){var t=e==null?0:e.length;return t?ube(e,1):[]}var hbe=cbe;function dbe(e){return wxe(Vxe(e,void 0,hbe),e+"")}var uX=dbe,fbe=sX(Object.getPrototypeOf,Object),_k=fbe,pbe="[object Object]",mbe=Function.prototype,gbe=Object.prototype,cX=mbe.toString,vbe=gbe.hasOwnProperty,ybe=cX.call(Object);function xbe(e){if(!Rd(e)||ov(e)!=pbe)return!1;var t=_k(e);if(t===null)return!0;var i=vbe.call(t,"constructor")&&t.constructor;return typeof i=="function"&&i instanceof i&&cX.call(i)==ybe}var wbe=xbe;function bbe(e,t,i){var r=-1,n=e.length;t<0&&(t=-t>n?0:n+t),i=i>n?n:i,i<0&&(i+=n),n=t>i?0:i-t>>>0,t>>>=0;for(var s=Array(n);++r<n;)s[r]=e[r+t];return s}var hX=bbe;function _be(e,t,i){var r=e.length;return i=i===void 0?r:i,!t&&i>=r?e:hX(e,t,i)}var Sbe=_be,Mbe="\\ud800-\\udfff",Abe="\\u0300-\\u036f",Ebe="\\ufe20-\\ufe2f",Cbe="\\u20d0-\\u20ff",Tbe=Abe+Ebe+Cbe,Pbe="\\ufe0e\\ufe0f",Dbe="\\u200d",Rbe=RegExp("["+Dbe+Mbe+Tbe+Pbe+"]");function Ibe(e){return Rbe.test(e)}var Lbe=Ibe;function Obe(e){return e.split("")}var zbe=Obe,dX="\\ud800-\\udfff",kbe="\\u0300-\\u036f",Bbe="\\ufe20-\\ufe2f",Nbe="\\u20d0-\\u20ff",Fbe=kbe+Bbe+Nbe,Ube="\\ufe0e\\ufe0f",Vbe="["+dX+"]",FI="["+Fbe+"]",UI="\\ud83c[\\udffb-\\udfff]",jbe="(?:"+FI+"|"+UI+")",fX="[^"+dX+"]",pX="(?:\\ud83c[\\udde6-\\uddff]){2}",mX="[\\ud800-\\udbff][\\udc00-\\udfff]",Hbe="\\u200d",gX=jbe+"?",vX="["+Ube+"]?",Wbe="(?:"+Hbe+"(?:"+[fX,pX,mX].join("|")+")"+vX+gX+")*",Gbe=vX+gX+Wbe,qbe="(?:"+[fX+FI+"?",FI,pX,mX,Vbe].join("|")+")",Xbe=RegExp(UI+"(?="+UI+")|"+qbe+Gbe,"g");function Ybe(e){return e.match(Xbe)||[]}var Qbe=Ybe;function Kbe(e){return Lbe(e)?Qbe(e):zbe(e)}var fV=Kbe;function Zbe(){this.__data__=new YC,this.size=0}var Jbe=Zbe;function $be(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i}var e_e=$be;function t_e(e){return this.__data__.get(e)}var i_e=t_e;function r_e(e){return this.__data__.has(e)}var n_e=r_e,s_e=200;function a_e(e,t){var i=this.__data__;if(i instanceof YC){var r=i.__data__;if(!Qb||r.length<s_e-1)return r.push([e,t]),this.size=++i.size,this;i=this.__data__=new KC(r)}return i.set(e,t),this.size=i.size,this}var o_e=a_e;function Wx(e){var t=this.__data__=new YC(e);this.size=t.size}Wx.prototype.clear=Jbe;Wx.prototype.delete=e_e;Wx.prototype.get=i_e;Wx.prototype.has=n_e;Wx.prototype.set=o_e;var zE=Wx;function l_e(e,t){return e&&q_(t,xk(t),e)}var u_e=l_e;function c_e(e,t){return e&&q_(t,mg(t),e)}var h_e=c_e,yX=typeof exports=="object"&&exports&&!exports.nodeType&&exports,pV=yX&&typeof module=="object"&&module&&!module.nodeType&&module,d_e=pV&&pV.exports===yX,mV=d_e?Xu.Buffer:void 0,gV=mV?mV.allocUnsafe:void 0;function f_e(e,t){if(t)return e.slice();var i=e.length,r=gV?gV(i):new e.constructor(i);return e.copy(r),r}var p_e=f_e;function m_e(e,t){for(var i=-1,r=e==null?0:e.length,n=0,s=[];++i<r;){var a=e[i];t(a,i,e)&&(s[n++]=a)}return s}var g_e=m_e;function v_e(){return[]}var xX=v_e,y_e=Object.prototype,x_e=y_e.propertyIsEnumerable,vV=Object.getOwnPropertySymbols,w_e=vV?function(e){return e==null?[]:(e=Object(e),g_e(vV(e),function(t){return x_e.call(e,t)}))}:xX,Sk=w_e;function b_e(e,t){return q_(e,Sk(e),t)}var __e=b_e,S_e=Object.getOwnPropertySymbols,M_e=S_e?function(e){for(var t=[];e;)bk(t,Sk(e)),e=_k(e);return t}:xX,wX=M_e;function A_e(e,t){return q_(e,wX(e),t)}var E_e=A_e;function C_e(e,t,i){var r=t(e);return Jc(e)?r:bk(r,i(e))}var bX=C_e;function T_e(e){return bX(e,xk,Sk)}var VI=T_e;function P_e(e){return bX(e,mg,wX)}var _X=P_e,D_e=uv(Xu,"DataView"),jI=D_e,R_e=uv(Xu,"Promise"),HI=R_e,I_e=uv(Xu,"Set"),WI=I_e,yV="[object Map]",L_e="[object Object]",xV="[object Promise]",wV="[object Set]",bV="[object WeakMap]",_V="[object DataView]",O_e=lv(jI),z_e=lv(Qb),k_e=lv(HI),B_e=lv(WI),N_e=lv(NI),Km=ov;(jI&&Km(new jI(new ArrayBuffer(1)))!=_V||Qb&&Km(new Qb)!=yV||HI&&Km(HI.resolve())!=xV||WI&&Km(new WI)!=wV||NI&&Km(new NI)!=bV)&&(Km=function(e){var t=ov(e),i=t==L_e?e.constructor:void 0,r=i?lv(i):"";if(r)switch(r){case O_e:return _V;case z_e:return yV;case k_e:return xV;case B_e:return wV;case N_e:return bV}return t});var Kb=Km,F_e=Object.prototype,U_e=F_e.hasOwnProperty;function V_e(e){var t=e.length,i=new e.constructor(t);return t&&typeof e[0]=="string"&&U_e.call(e,"index")&&(i.index=e.index,i.input=e.input),i}var j_e=V_e,H_e=Xu.Uint8Array,w2=H_e;function W_e(e){var t=new e.constructor(e.byteLength);return new w2(t).set(new w2(e)),t}var Mk=W_e;function G_e(e,t){var i=t?Mk(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}var q_e=G_e,X_e=/\w*$/;function Y_e(e){var t=new e.constructor(e.source,X_e.exec(e));return t.lastIndex=e.lastIndex,t}var Q_e=Y_e,SV=Yl?Yl.prototype:void 0,MV=SV?SV.valueOf:void 0;function K_e(e){return MV?Object(MV.call(e)):{}}var Z_e=K_e;function J_e(e,t){var i=t?Mk(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}var $_e=J_e,eSe="[object Boolean]",tSe="[object Date]",iSe="[object Map]",rSe="[object Number]",nSe="[object RegExp]",sSe="[object Set]",aSe="[object String]",oSe="[object Symbol]",lSe="[object ArrayBuffer]",uSe="[object DataView]",cSe="[object Float32Array]",hSe="[object Float64Array]",dSe="[object Int8Array]",fSe="[object Int16Array]",pSe="[object Int32Array]",mSe="[object Uint8Array]",gSe="[object Uint8ClampedArray]",vSe="[object Uint16Array]",ySe="[object Uint32Array]";function xSe(e,t,i){var r=e.constructor;switch(t){case lSe:return Mk(e);case eSe:case tSe:return new r(+e);case uSe:return q_e(e,i);case cSe:case hSe:case dSe:case fSe:case pSe:case mSe:case gSe:case vSe:case ySe:return $_e(e,i);case iSe:return new r;case rSe:case aSe:return new r(e);case nSe:return Q_e(e);case sSe:return new r;case oSe:return Z_e(e)}}var wSe=xSe;function bSe(e){return typeof e.constructor=="function"&&!gk(e)?nxe(_k(e)):{}}var _Se=bSe,SSe="[object Map]";function MSe(e){return Rd(e)&&Kb(e)==SSe}var ASe=MSe,AV=lx&&lx.isMap,ESe=AV?yk(AV):ASe,CSe=ESe,TSe="[object Set]";function PSe(e){return Rd(e)&&Kb(e)==TSe}var DSe=PSe,EV=lx&&lx.isSet,RSe=EV?yk(EV):DSe,ISe=RSe,LSe=1,OSe=2,zSe=4,SX="[object Arguments]",kSe="[object Array]",BSe="[object Boolean]",NSe="[object Date]",FSe="[object Error]",MX="[object Function]",USe="[object GeneratorFunction]",VSe="[object Map]",jSe="[object Number]",AX="[object Object]",HSe="[object RegExp]",WSe="[object Set]",GSe="[object String]",qSe="[object Symbol]",XSe="[object WeakMap]",YSe="[object ArrayBuffer]",QSe="[object DataView]",KSe="[object Float32Array]",ZSe="[object Float64Array]",JSe="[object Int8Array]",$Se="[object Int16Array]",eMe="[object Int32Array]",tMe="[object Uint8Array]",iMe="[object Uint8ClampedArray]",rMe="[object Uint16Array]",nMe="[object Uint32Array]",Fr={};Fr[SX]=Fr[kSe]=Fr[YSe]=Fr[QSe]=Fr[BSe]=Fr[NSe]=Fr[KSe]=Fr[ZSe]=Fr[JSe]=Fr[$Se]=Fr[eMe]=Fr[VSe]=Fr[jSe]=Fr[AX]=Fr[HSe]=Fr[WSe]=Fr[GSe]=Fr[qSe]=Fr[tMe]=Fr[iMe]=Fr[rMe]=Fr[nMe]=!0;Fr[FSe]=Fr[MX]=Fr[XSe]=!1;function kE(e,t,i,r,n,s){var a,o=t&LSe,l=t&OSe,u=t&zSe;if(i&&(a=n?i(e,r,n,s):i(e)),a!==void 0)return a;if(!dl(e))return e;var c=Jc(e);if(c){if(a=j_e(e),!o)return lxe(e,a)}else{var h=Kb(e),d=h==MX||h==USe;if(x2(e))return p_e(e,o);if(h==AX||h==SX||d&&!n){if(a=l||d?{}:_Se(e),!o)return l?E_e(e,h_e(a,e)):__e(e,u_e(a,e))}else{if(!Fr[h])return n?e:{};a=wSe(e,h,o)}}s||(s=new zE);var p=s.get(e);if(p)return p;s.set(e,a),ISe(e)?e.forEach(function(g){a.add(kE(g,t,i,g,e,s))}):CSe(e)&&e.forEach(function(g,w){a.set(w,kE(g,t,i,w,e,s))});var m=u?l?_X:VI:l?mg:xk,v=c?void 0:m(e);return _xe(v||e,function(g,w){v&&(w=g,g=e[w]),pk(a,w,kE(g,t,i,w,e,s))}),a}var EX=kE,sMe=1,aMe=4;function oMe(e){return EX(e,sMe|aMe)}var JC=oMe,lMe="__lodash_hash_undefined__";function uMe(e){return this.__data__.set(e,lMe),this}var cMe=uMe;function hMe(e){return this.__data__.has(e)}var dMe=hMe;function b2(e){var t=-1,i=e==null?0:e.length;for(this.__data__=new KC;++t<i;)this.add(e[t])}b2.prototype.add=b2.prototype.push=cMe;b2.prototype.has=dMe;var fMe=b2;function pMe(e,t){for(var i=-1,r=e==null?0:e.length;++i<r;)if(t(e[i],i,e))return!0;return!1}var mMe=pMe;function gMe(e,t){return e.has(t)}var vMe=gMe,yMe=1,xMe=2;function wMe(e,t,i,r,n,s){var a=i&yMe,o=e.length,l=t.length;if(o!=l&&!(a&&l>o))return!1;var u=s.get(e),c=s.get(t);if(u&&c)return u==t&&c==e;var h=-1,d=!0,p=i&xMe?new fMe:void 0;for(s.set(e,t),s.set(t,e);++h<o;){var m=e[h],v=t[h];if(r)var g=a?r(v,m,h,t,e,s):r(m,v,h,e,t,s);if(g!==void 0){if(g)continue;d=!1;break}if(p){if(!mMe(t,function(w,S){if(!vMe(p,S)&&(m===w||n(m,w,i,r,s)))return p.push(S)})){d=!1;break}}else if(!(m===v||n(m,v,i,r,s))){d=!1;break}}return s.delete(e),s.delete(t),d}var CX=wMe;function bMe(e){var t=-1,i=Array(e.size);return e.forEach(function(r,n){i[++t]=[n,r]}),i}var _Me=bMe;function SMe(e){var t=-1,i=Array(e.size);return e.forEach(function(r){i[++t]=r}),i}var MMe=SMe,AMe=1,EMe=2,CMe="[object Boolean]",TMe="[object Date]",PMe="[object Error]",DMe="[object Map]",RMe="[object Number]",IMe="[object RegExp]",LMe="[object Set]",OMe="[object String]",zMe="[object Symbol]",kMe="[object ArrayBuffer]",BMe="[object DataView]",CV=Yl?Yl.prototype:void 0,G3=CV?CV.valueOf:void 0;function NMe(e,t,i,r,n,s,a){switch(i){case BMe:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case kMe:return!(e.byteLength!=t.byteLength||!s(new w2(e),new w2(t)));case CMe:case TMe:case RMe:return fk(+e,+t);case PMe:return e.name==t.name&&e.message==t.message;case IMe:case OMe:return e==t+"";case DMe:var o=_Me;case LMe:var l=r&AMe;if(o||(o=MMe),e.size!=t.size&&!l)return!1;var u=a.get(e);if(u)return u==t;r|=EMe,a.set(e,t);var c=CX(o(e),o(t),r,n,s,a);return a.delete(e),c;case zMe:if(G3)return G3.call(e)==G3.call(t)}return!1}var FMe=NMe,UMe=1,VMe=Object.prototype,jMe=VMe.hasOwnProperty;function HMe(e,t,i,r,n,s){var a=i&UMe,o=VI(e),l=o.length,u=VI(t),c=u.length;if(l!=c&&!a)return!1;for(var h=l;h--;){var d=o[h];if(!(a?d in t:jMe.call(t,d)))return!1}var p=s.get(e),m=s.get(t);if(p&&m)return p==t&&m==e;var v=!0;s.set(e,t),s.set(t,e);for(var g=a;++h<l;){d=o[h];var w=e[d],S=t[d];if(r)var _=a?r(S,w,d,t,e,s):r(w,S,d,e,t,s);if(!(_===void 0?w===S||n(w,S,i,r,s):_)){v=!1;break}g||(g=d=="constructor")}if(v&&!g){var A=e.constructor,C=t.constructor;A!=C&&"constructor"in e&&"constructor"in t&&!(typeof A=="function"&&A instanceof A&&typeof C=="function"&&C instanceof C)&&(v=!1)}return s.delete(e),s.delete(t),v}var WMe=HMe,GMe=1,TV="[object Arguments]",PV="[object Array]",bA="[object Object]",qMe=Object.prototype,DV=qMe.hasOwnProperty;function XMe(e,t,i,r,n,s){var a=Jc(e),o=Jc(t),l=a?PV:Kb(e),u=o?PV:Kb(t);l=l==TV?bA:l,u=u==TV?bA:u;var c=l==bA,h=u==bA,d=l==u;if(d&&x2(e)){if(!x2(t))return!1;a=!0,c=!1}if(d&&!c)return s||(s=new zE),a||rX(e)?CX(e,t,i,r,n,s):FMe(e,t,l,i,r,n,s);if(!(i&GMe)){var p=c&&DV.call(e,"__wrapped__"),m=h&&DV.call(t,"__wrapped__");if(p||m){var v=p?e.value():e,g=m?t.value():t;return s||(s=new zE),n(v,g,i,r,s)}}return d?(s||(s=new zE),WMe(e,t,i,r,n,s)):!1}var YMe=XMe;function TX(e,t,i,r,n){return e===t?!0:e==null||t==null||!Rd(e)&&!Rd(t)?e!==e&&t!==t:YMe(e,t,i,r,TX,n)}var QMe=TX;function KMe(e,t){return e!=null&&t in Object(e)}var ZMe=KMe;function JMe(e,t,i){t=Hx(t,e);for(var r=-1,n=t.length,s=!1;++r<n;){var a=ZC(t[r]);if(!(s=e!=null&&i(e,a)))break;e=e[a]}return s||++r!=n?s:(n=e==null?0:e.length,!!n&&mk(n)&&dk(a,n)&&(Jc(e)||vk(e)))}var $Me=JMe;function eAe(e,t){return e!=null&&$Me(e,t,ZMe)}var tAe=eAe,iAe=function(){return Xu.Date.now()},q3=iAe,rAe="Expected a function",nAe=Math.max,sAe=Math.min;function aAe(e,t,i){var r,n,s,a,o,l,u=0,c=!1,h=!1,d=!0;if(typeof e!="function")throw new TypeError(rAe);t=rV(t)||0,dl(i)&&(c=!!i.leading,h="maxWait"in i,s=h?nAe(rV(i.maxWait)||0,t):s,d="trailing"in i?!!i.trailing:d);function p(E){var I=r,T=n;return r=n=void 0,u=E,a=e.apply(T,I),a}function m(E){return u=E,o=setTimeout(w,t),c?p(E):a}function v(E){var I=E-l,T=E-u,D=t-I;return h?sAe(D,s-T):D}function g(E){var I=E-l,T=E-u;return l===void 0||I>=t||I<0||h&&T>=s}function w(){var E=q3();if(g(E))return S(E);o=setTimeout(w,v(E))}function S(E){return o=void 0,d&&r?p(E):(r=n=void 0,a)}function _(){o!==void 0&&clearTimeout(o),u=0,r=l=n=o=void 0}function A(){return o===void 0?a:S(q3())}function C(){var E=q3(),I=g(E);if(r=arguments,n=this,l=E,I){if(o===void 0)return m(l);if(h)return clearTimeout(o),o=setTimeout(w,t),p(l)}return o===void 0&&(o=setTimeout(w,t)),a}return C.cancel=_,C.flush=A,C}var Zb=aAe;function oAe(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var lAe=oAe;function uAe(e,t){return e>t}var cAe=uAe;function hAe(e,t){return t.length<2?e:oX(e,hX(t,0,-1))}var dAe=hAe;function fAe(e,t){return QMe(e,t)}var Ak=fAe;function pAe(e,t,i){for(var r=-1,n=e.length;++r<n;){var s=e[r],a=t(s);if(a!=null&&(o===void 0?a===a&&!G_(a):i(a,o)))var o=a,l=s}return l}var mAe=pAe;function gAe(e){return e&&e.length?mAe(e,Kq,cAe):void 0}var vAe=gAe;function yAe(e,t){return t=Hx(t,e),e=dAe(e,t),e==null||delete e[ZC(lAe(t))]}var xAe=yAe;function wAe(e){return wbe(e)?void 0:e}var bAe=wAe,_Ae=1,SAe=2,MAe=4,AAe=uX(function(e,t){var i={};if(e==null)return i;var r=!1;t=qq(t,function(s){return s=Hx(s,e),r||(r=s.length>1),s}),q_(e,_X(e),i),r&&(i=EX(i,_Ae|SAe|MAe,bAe));for(var n=t.length;n--;)xAe(i,t[n]);return i}),GI=AAe;function EAe(e,t,i,r){if(!dl(e))return e;t=Hx(t,e);for(var n=-1,s=t.length,a=s-1,o=e;o!=null&&++n<s;){var l=ZC(t[n]),u=i;if(l==="__proto__"||l==="constructor"||l==="prototype")return e;if(n!=a){var c=o[l];u=r?r(c,l,o):void 0,u===void 0&&(u=dl(c)?c:dk(t[n+1])?[]:{})}pk(o,l,u),o=o[l]}return e}var CAe=EAe;function TAe(e,t,i){for(var r=-1,n=t.length,s={};++r<n;){var a=t[r],o=oX(e,a);i(o,a)&&CAe(s,Hx(a,e),o)}return s}var PAe=TAe;function DAe(e,t){return PAe(e,t,function(i,r){return tAe(e,r)})}var RAe=DAe,IAe=uX(function(e,t){return e==null?{}:RAe(e,t)}),Gc=IAe,LAe="Expected a function";function OAe(e,t,i){var r=!0,n=!0;if(typeof e!="function")throw new TypeError(LAe);return dl(i)&&(r="leading"in i?!!i.leading:r,n="trailing"in i?!!i.trailing:n),Zb(e,t,{leading:r,maxWait:t,trailing:n})}var zAe=OAe;function kAe(e,t){for(var i=e.length;i--&&Dxe(t,e[i],0)>-1;);return i}var BAe=kAe;function NAe(e,t,i){if(e=aX(e),e&&(i||t===void 0))return e.slice(0,Qq(e)+1);if(!e||!(t=Yq(t)))return e;var r=fV(e),n=BAe(r,fV(t))+1;return Sbe(r,0,n).join("")}var FAe=NAe;function PX(e){for(let t of Object.keys(e))e[t]===void 0&&delete e[t];return e}function Go(e,t){return Object.setPrototypeOf(e,t),e}var UAe=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().includes(" electron/"),VAe=()=>typeof window>"u"?!1:window.navigator.platform.toUpperCase().includes("MAC"),jAe=()=>typeof window>"u"?!1:/iPad|iPhone|iPod/.test(window.navigator.userAgent)||$C&&"ontouchend"in document,HAe=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,WAe=()=>typeof window>"u"?!1:"ontouchstart"in window||navigator.maxTouchPoints>0,GAe=()=>{if(typeof window>"u")return!1;let e=navigator.userAgent,t=navigator.vendor;return/Safari/i.test(e)&&/Apple Computer/.test(t)},qAe=()=>{if(typeof window>"u")return null;let e=navigator.userAgent.match(/Version\/(\d+\.\d)/);return e&&e[1]},XAe=()=>{if(typeof window>"u")return;let e=new URLSearchParams(window.location.search).get("desktop-app-version");return e?(window.localStorage.setItem("desktop-app-version",e),e):window.localStorage.getItem("desktop-app-version")??"0.0.6"},DX=UAe();DX&&XAe();var $C=VAe(),Gx=jAe(),YAe=HAe(),cl=WAe(),RV=GAe(),QAe=Number(qAe());function RX(e){return Array.isArray(e)?e:[e]}function IX(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}function _A(e){return $C?e.metaKey:e.ctrlKey}function KAe(e){return e.wheelDeltaY===0||e.deltaY===0?$C&&e.shiftKey&&Math.abs(e.wheelDeltaX)>=120?!1:e.wheelDeltaX?e.wheelDeltaX===-3*e.deltaX||e.wheelDeltaX===-3*window.devicePixelRatio*e.deltaX:e.deltaMode===0:e.wheelDeltaY?e.wheelDeltaY===-3*e.deltaY||e.wheelDeltaY===-3*window.devicePixelRatio*e.deltaY:e.deltaMode===0}var pi=[],_2={},jw={},BE={};function LX(e){pi.includes(e)||pi.push(e)}function Hy(e){delete _2[e.pointerId];for(let t=0;t<pi.length;t++)if(pi[t].pointerId===e.pointerId){pi.splice(t,1);break}}function ZAe(){pi.splice(0,pi.length)}function S2(e){if(e.pointerType!=="touch")return;let t=_2[e.pointerId];t===void 0&&(t={x:0,y:0},_2[e.pointerId]=t),t.x=e.pageX,t.y=e.pageY}function X3(e){let t=e.pointerId===pi[0].pointerId?pi[1]:pi[0];return _2[t.pointerId]}function OX(e){jw[e.key]=!0,BE[e.key]=BE[e.key]===void 0?1:BE[e.key]+1}function zX(e){if($C&&jw.Meta)for(let t in jw)jw[t]=!1;else jw[e.key]=!1;BE={}}function JAe(e){e.addEventListener("pointerdown",LX,!0),e.addEventListener("pointerdown",S2,!0),e.addEventListener("pointermove",S2,!0),e.addEventListener("pointerup",Hy,!0),e.addEventListener("pointercancel",Hy,!0),e.addEventListener("pointerleave",Hy,!0),window.addEventListener("keydown",OX,!0),window.addEventListener("keyup",zX,!0)}function $Ae(e){e.removeEventListener("pointerdown",LX,!0),e.removeEventListener("pointerdown",S2,!0),e.removeEventListener("pointermove",S2,!0),e.removeEventListener("pointerup",Hy,!0),e.removeEventListener("pointercancel",Hy,!0),e.removeEventListener("pointerleave",Hy,!0),window.removeEventListener("keydown",OX,!0),window.removeEventListener("keyup",zX,!0)}var kX,eEe=new Promise(e=>{kX=e}),SA;function tEe(e){if(SA)return SA;async function t(){let i=e??"https://unpkg.com/@splinetool/navmesh-wasm@1.12.5/build",r=Vd(()=>import("./navmesh-B1pUQaZh.js"),[]),[n,s]=await Promise.all([r,fetch(`${i}/navmesh.wasm`).then(l=>l.arrayBuffer())]),a=n.default,o=await a({wasmBinary:s});kX(o)}return SA=t(),SA}var BX,iEe=new Promise(e=>{BX=e}),MA;function rEe(){if(MA)return MA;async function e(){let t=await Vd(()=>import("./physics-ChHD2_fM.js"),[]);await t.init(),BX(t)}return MA=e(),MA}var ii=class{modifyById(e,t){let i=this;if(i[e]===void 0)throw new Error("not expected");{let r={...i,[e]:t};return Object.setPrototypeOf(r,ii.prototype),r}}add(e,t){return this.runOp({type:1,id:e,data:t})?.data??this}runOp(e){let t=this;if(e.type===1){let i=t[e.id],r;i===void 0?r={type:2,id:e.id}:r={type:1,id:e.id,data:i};let{id:n,data:s}=e,a={...t,[n]:s};return Object.setPrototypeOf(a,ii.prototype),{data:a,actual:e,reverse:r}}else if(e.type===2){let{id:i}=e,r=t[i];if(r===void 0)return null;{let n={...t};return Object.setPrototypeOf(n,ii.prototype),delete n[i],{data:n,actual:e,reverse:{type:1,id:i,data:r}}}}return null}};function Ek(e){if(e.deepFreeze!==void 0){e.deepFreeze(e);return}let t=Object.getOwnPropertyNames(e);for(let i of t){let r=e[i];r&&typeof r=="object"&&Ek(r)}return Object.freeze(e)}function nEe(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}var NX=class extends Error{};function Y3(e){let t={...e};return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}function up(e,t,i){if(e===void 0?t===void 0?(e=0,t=10):e=t-10:t===void 0&&(t=e+10),e>t){let s=e;e=t,t=s}let r=[],n=1/(i+1);for(let s=0;s<i;s++){let a=e+(t-e)*(s+.75+Math.random()*.5)*n;r.push(a)}return r}function Ck(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array}function sEe(){return typeof process<"u"}function FX(e,t){for(let i of e)t(i.id,i.data)!==!0&&FX(i.children,t)}function UX(e,t){if(t(e.id,e.data)!==!0)for(let i of e.children)UX(i,t)}var ga=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,ga.prototype)}deepFreeze(){let e=0;for(;e<this.length;)Ek(this[e]),e++}fillCaches0(e,t){this.objCaches.set(e.id,e),this.parentCaches.set(e.id,t);for(let i of e.children)this.fillCaches0(i,e.id)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,this.parentCaches=new Map;for(let e of this)this.fillCaches0(e,null)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(e.length!==0)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}nonExistOrDescendantOf(e,t){if(!this.has(e))return!0;for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}rootAcestor(e){for(;e;){let t=this.parent(e);if(t)e=t;else return e}return e}isDescendantOf(e,t){for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}data(e){return this.get(e)?.data}has(e){return this.childrenOf(e)!==void 0}get(e){return this.fillCaches(),this.objCaches.get(e)}childrenOf(e){return e===null?this:this.get(e)?.children}traverseFrom(e,t){if(e===null)this.traverse(t);else{let i=this.get(e);i&&UX(i,t)}}traverse(e){FX(this,e)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(e){return this.fillCaches(),this.parentCaches.get(e)}childrenArray(e){return e===null?this:this.get(e).children}modifyById(e,t){if(this.get(e)===void 0)throw new Error("not expected");{let i=this.parent(e),r=this.childrenArray(i),n=r.findIndex(a=>a.id===e);if(n<0)throw new Error("not expected");let s=r[n];return r=[...r],r[n]={...s,data:t},this.modifyArrayBy(i,r)}}modifyArrayBy(e,t){let i=e,r=t;for(;i!==null;){let s=r,a=i;if(i=this.parent(i),i===void 0)throw new Error;r=this.childrenArray(i);let o=r.findIndex(l=>l.id===a);if(o<0)throw new Error;r=[...r],r[o]={...r[o],children:s}}Object.setPrototypeOf(r,ga.prototype);let n=r;return n.fillCaches(),n}runOp(e){switch(e.type){case 7:return this.addOp(e);case 8:return this.deleteOp(e);case 9:return this.moveOp(e)}return null}checkDuplicatedIdRec({id:e,children:t}){if(this.get(e)!==void 0)return!0;for(let i of t)if(this.checkDuplicatedIdRec(i))return!0;return!1}addOp(e){let{parent:t,fi:i,id:r,data:n,children:s}=e;if(t!==null&&this.get(t)===void 0||this.checkDuplicatedIdRec(e))return null;{let a=t,o=this.childrenArray(a),l={fi:i,id:r,data:n,children:s};return o=[...o,l],o.sort((u,c)=>u.fi-c.fi),e.localIndex=o.indexOf(l),{data:this.modifyArrayBy(a,o),actual:e,reverse:{type:8,id:r}}}}deleteOp(e){let{id:t}=e;if(this.get(t)===null)return null;{let i=this.parent(t);if(i===void 0)return null;let r=this.childrenArray(i),n=r.findIndex(a=>a.id===t);e.localIndex=n,r=[...r];let s=r.splice(n,1)[0];return{data:this.modifyArrayBy(i,r),actual:e,reverse:{type:7,...s,parent:i}}}}moveOp(e){let{parent:t,fi:i,id:r}=e;if(t!==null&&this.get(t)===void 0)return this.deleteOp({type:8,id:r});if(t!==null){let h=t;for(;h!==null;){if(h===void 0)throw new Error;if(h===r)throw new NX("cyclic tree");h=this.parent(h)}}let n=this.parent(r);if(n===void 0)return null;let s=n,a=this.childrenArray(n),o=a.findIndex(h=>h.id===r);a=[...a];let l=a.splice(o,1)[0],u=this.modifyArrayBy(n,a);n=t,a=u.childrenArray(n);let c=l.fi;return l={...l,fi:i},a=[...a,l],a.sort((h,d)=>h.fi-d.fi),e.localIndex=a.indexOf(l),u=u.modifyArrayBy(n,a),{data:u,actual:e,reverse:{type:9,parent:s,fi:c,id:r}}}previous(e,t){if(t===null){let r=this.childrenArray(e);return r.length===0?null:r[r.length-1].id}let i=null;for(let r of this.childrenArray(e)){if(r.id===t)return i;i=r.id}return null}traverseSortNext(e){let t=this.parent(e);if(t!==void 0){let i=this.childrenArray(t),r=i.findIndex(n=>n.id===e)+1;if(r<i.length)return i[r].id;if(t)return this.traverseSortNext(t)}}sortNext(e){let t=this.childrenArray(e);return t.length>0?t[0].id:this.traverseSortNext(e)}traverseSortPrevious(e){let t=this.childrenArray(e);return t.length>0?this.traverseSortPrevious(t[t.length-1].id):e}sortPrevious(e){let t=this.parent(e);if(t!==void 0){let i=this.childrenArray(t),r=i.findIndex(n=>n.id===e)-1;return r>=0?this.traverseSortPrevious(i[r].id):t}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push({...i,...r})}t.sort((i,r)=>nEe(i.sortKey,r.sortKey));for(let i of t)delete i.sortKey;return t}getWithSortKey(e){var t=e;let i=[],r=this.get(t),n=r;if(r!==void 0){for(;t;)i.splice(0,0,r.fi),t=this.parent(t),t!==null&&(r=this.get(t));return{...n,sortKey:i}}}insertBeforeHelper(e,t,i){return this.insertAfterHelper(e,this.previous(e,t),i)}insertAfterHelper(e,t,i){let r=this.childrenArray(e);if(t===null){if(r.length===0)return up(0,i,i);{let n=r[0].fi;return up(n-i,n,i)}}else{let n=this.get(t);if(n===void 0||this.parent(t)!==e)throw new Error("illegal args");let s=r.find(a=>a.fi>n.fi);if(s===void 0){let a=r[r.length-1].fi;return up(a,a+i,i)}else return up(n.fi,s.fi,i)}}},M2;(e=>{function t(i,r){if(r.type!==0)return null;if(Array.isArray(i)){let n=r.props,s={},a=[...i],o=!1;if(n)for(let l of Object.keys(n)){let u=parseInt(l);if(isNaN(u))throw new Error("wrong index");s[l]=a[u],a[u]=n[l],o=!0}return o?{data:a,actual:r,reverse:{type:0,props:s}}:null}else{let n=r.props,s={},a={...i},o=!1;if(n)for(let l of Object.keys(n)){s[l]=a[l];let u=n[l];u===void 0?delete a[l]:a[l]=u,o=!0}return o?{data:a,actual:r,reverse:{type:0,props:s}}:null}}e.runOp=t})(M2||(M2={}));var Xt=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,Xt.prototype)}deepFreeze(){let e=0;for(;e<this.length;)Ek(this[e]),e++}fillCaches0(e){this.objCaches.set(e.id,e)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1;for(let e of this)this.fillCaches0(e)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(e.length!==0)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}data(e){return this.get(e)?.data}get(e){return this.fillCaches(),this.objCaches.get(e)}modifyById(e,t){if(this.get(e)===void 0)throw new Error("not expected");{let i=this,r=i.findIndex(s=>s.id===e);if(r<0)throw new Error("not expected");let n=i[r];return i=[...i],i[r]={...n,data:t},this.modifyArrayBy(i)}}modifyArrayBy(e){Object.setPrototypeOf(e,Xt.prototype);let t=e;return sEe()||t.fillCaches(),t}runOp(e){switch(e.type){case 4:return this.addOp(e);case 5:return this.deleteOp(e);case 6:return this.moveOp(e)}return null}addOp(e){let{fi:t,id:i,data:r}=e,n=this,s={fi:t,id:i,data:r};return n=[...n,s],n.sort((a,o)=>a.fi-o.fi),e.localIndex=n.indexOf(s),{data:this.modifyArrayBy(n),actual:e,reverse:{type:5,id:i}}}deleteOp(e){let{id:t}=e,i=this,r=i.findIndex(s=>s.id===t);if(r===-1)return null;e.localIndex=r,i=[...i];let n=i.splice(r,1)[0];return{data:this.modifyArrayBy(i),actual:e,reverse:{type:4,...n}}}moveOp(e){let{fi:t,id:i}=e,r=this;r=[...r];let n=r.findIndex(o=>o.id===i);if(n===-1)return null;let s=r[n].fi,a={...r[n],fi:t};return r[n]=a,r.sort((o,l)=>o.fi-l.fi),e.localIndex=r.indexOf(a),{data:this.modifyArrayBy(r),actual:e,reverse:{type:6,fi:s,id:i}}}previous(e){if(e===null)return this.length===0?null:this[this.length-1].id;let t=null;for(let i of this){if(i.id===e)return t;t=i.id}return null}insertBeforeHelper(e,t){return this.insertAfterHelper(this.previous(e),t)}insertAfterHelper(e,t){let i=this;if(e===null){if(i.length===0)return up(0,t,t);{let r=i[0].fi;return up(r-t,r,t)}}else{let r=this.get(e);if(r===void 0)throw new Error("illegal args");let n=i.find(s=>s.fi>r.fi);if(n===void 0){let s=i[i.length-1].fi;return up(s,s+t,t)}else return up(r.fi,n.fi,t)}}};function ux(e){return e&&typeof e=="object"&&e instanceof Sn}var Sn=class{unusedFunOverridesTable(e){}runOp(e){let t=[],i=this,r=0,n={};for(;r<e.path.length;){if(t.push(i),i=i===void 0?void 0:i[e.path[r]],i!==void 0&&!ux(i))return null;r+=1}i=i?Y3(i):new Sn;for(let[o,l]of Object.entries(e.props)){let u=i[o];n[o]=u,l===void 0?delete i[o]:i[o]=l}for(;r>0;){if(Object.keys(i).length===0){let o=t[r-1];o&&(i=Y3(o),delete i[e.path[r-1]])}else{let o=t[r-1];if(o){let l=Y3(o);l[e.path[r-1]]=i,i=l}else{let l=new Sn;l[e.path[r-1]]=i,i=l}}r-=1}let s=Object.setPrototypeOf(i,Sn.prototype),a={...e,props:n};return{data:s,actual:e,reverse:a}}},bp;(e=>{function t(n,s){return Jb(n,s)??n}e.apply=t;function i(n,s){return Pk(n,s)}e.merge=i;function r(n,s){let a=0,o=s.path,l=n;for(;a<o.length&&l!==void 0;){if(l=bs.zoomOnce(l,o[a]),l===void 0)return s;if(!ux(l))return;a+=1}if(l===void 0)return s;if(ux(l))if(s.type===0){let u={...s.props};for(let c of Object.keys(l))delete u[c];return{...s,props:u}}else if(s.type===1||s.type===4||s.type===7){let u=Tk([s],l);return u?u[0]:s}else return s}e.filterOp=r})(bp||(bp={}));function Tk(e,t){if(t===void 0)return;let i=!1,r=e.map(n=>{let s=n.id,a=Jb(n.data,t[s]);if(i=i||a!==void 0,a===void 0&&(a=n.data),n.children){let o=Tk(n.children,t);return o!==void 0?i=!0:o=n.children,{...n,id:s,data:a,children:o}}else return{...n,id:s,data:a}});if(i)return r}function aEe(e,t){if(t===void 0)return;let i=!1,r=e.map(n=>{let s=n.id,a=Jb(n.data,t[s]);return i=i||a!==void 0,a===void 0&&(a=n.data),{...n,id:s,data:a}});if(i)return Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}function Jb(e,t){if(!ux(t))return t;if(e instanceof ga){let i=Tk(e,t);return i!==void 0&&Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i}else{if(e instanceof Xt)return aEe(e,t);if(Array.isArray(e)){let i=!1,r=e.map((n,s)=>{let a=Jb(n,t[s]);return i=i||a!==void 0,a===void 0&&(a=n),a});return i?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}else{if(e instanceof Sn)return Pk(e,t);if(e&&typeof e=="object"){let i={},r=!1;for(let[n,s]of Object.entries(e)){let a=Jb(s,t[n]);r=r||a!==void 0,a===void 0&&(a=s),i[n]=a}return r?(Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i):void 0}}}}function Pk(e,t){if(e===void 0)return t;if(t===void 0)return e;if(!ux(t))return t;if(!ux(e))return bp.apply(e,t);let i=new Set;for(let n of Object.keys(e))i.add(n);for(let n of Object.keys(t))i.add(n);let r=new Sn;for(let n of i){let s=Pk(e===void 0?void 0:e[n],t===void 0?void 0:t[n]);r[n]=s}return r}function oEe(e,t){let i={cur:[],result:[],len:0};return e=$b(e,t,i)??e,[e,i.result]}function A2(e,t){return e===null?null:(e.cur[e.len]=t,e.len+=1,e)}function E2(e){e&&(e.len-=1)}function lEe(e){if(e===null)return null;e.result.push(e.cur.slice(0,e.len))}function VX(e,t,i){let r=!1,n=e.map(s=>{let a=s.id,o=t[a];if(o!==void 0&&typeof o=="string"&&(r=!0,a=o,i!==null))throw new Error("not supported");let l=$b(s.data,t,A2(i,a));E2(i),r=r||l!==void 0,l===void 0&&(l=s.data);let u=VX(s.children,t,i);return u!==void 0?r=!0:u=s.children,{...s,id:a,data:l,children:u}});if(r)return n}function uEe(e,t,i){let r=!1,n=e.map(s=>{let a=s.id,o=t[a];if(o!==void 0&&typeof o=="string"&&(r=!0,a=o,i!==null))throw new Error("not supported");let l=$b(s.data,t,A2(i,a));return E2(i),r=r||l!==void 0,l===void 0&&(l=s.data),{...s,id:a,data:l}});if(r)return Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n}function $b(e,t,i){if(e instanceof ga){let r=VX(e,t,i);return r!==void 0&&Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}else{if(e instanceof Xt)return uEe(e,t,i);if(Array.isArray(e)){let r=!1,n=e.map((s,a)=>{let o=$b(s,t,A2(i,a));return E2(i),r=r||o!==void 0,o===void 0&&(o=s),o});return r?(Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n):void 0}else if(e&&typeof e=="object"&&!Ck(e)){let r={},n=!1;for(let[s,a]of Object.entries(e))if(s!=="name"&&s!=="variableId"){let o=t[s];if(typeof o=="string"){if(i!==null)throw new Error("not supported");n=!0,s=o}let l=$b(a,t,A2(i,s));E2(i),n=n||l!==void 0,l===void 0&&(l=a),r[s]=l}else r[s]=a;return n?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}else if(typeof e=="string"){let r=t[e];return r!==void 0&&lEe(i),r}else return}}var C2;(e=>{function t(i,r){let n=bs.zoom(r,i.path);if(typeof n=="object"){let s={};for(let a of Object.keys(i.props))s[a]=n[a];return{...i,props:s}}else return{...i,props:{}}}e.replaceProps=t})(C2||(C2={}));var Us;(e=>{function t(l,u){return{...l,path:l.path.slice(u)}}e.drop=t;function i(l,u){return r(l,u)?.data??l}e.applySimple=i;function r(l,u){let c=u.path;for(var h=[];;){let d;if(l instanceof Sn&&u.type===0&&(d=l.runOp({...u,path:c.slice(h.length)}),d===null&&(d=void 0)),d===void 0&&h.length===c.length&&(l instanceof ga||l instanceof Xt||l instanceof ii?d=l.runOp(u):d=M2.runOp(l,u)),d!==void 0)if(d!==null){let v=d.data;for(let g=h.length-1;g>=0;g--){let w=c[g],S=h[g];if(S instanceof ga){if(typeof w=="number")throw new Error("illegal arg");v=S.modifyById(w,v)}else if(S instanceof Xt){if(typeof w=="number")throw new Error("illegal arg");v=S.modifyById(w,v)}else if(S instanceof ii){if(typeof w=="number")throw new Error("illegal arg");v=S.modifyById(w,v)}else if(S instanceof Sn){let _={...S,[w]:v};v=Object.setPrototypeOf(_,Sn.prototype)}else if(typeof S=="object")if(Array.isArray(S)){if(typeof w=="string"&&(w=parseInt(w),isNaN(w)))throw new Error("Invalid path");let _=v;v=[...S],v[w]=_}else v={...S,[w]:v};else return null}return{data:v,actual:{...d.actual,path:c},reverse:{...d.reverse,path:c}}}else return null;let p=c[h.length],m;if(l instanceof ga){if(typeof p=="number")throw new Error("");m=l.get(p)?.data}else if(l instanceof Xt){if(typeof p=="number")throw new Error("");m=l.get(p)?.data}else l!==null&&(m=l[p]);if(m!==void 0)h.push(l),l=m;else return null}}e.apply=r;function n(l,u){for(let c=0;c<l.length&&c<u.length;c++)if(l[c]!==u[c])return!0;return!1}e.pathDisjoint=n;function s(l,u){if(l.length!==u.length)return!1;for(let c=0;c<l.length;c++)if(l[c]!==u[c])return!1;return!0}e.pathEq=s;function a(l,u){return n(l.path,u.path)}e.commutative=a;function o(l,u){return l.type===0&&u.type===0&&s(l.path,u.path)?Object.keys(l.props).every(c=>u.props[c]!==void 0):!1}e.subsumed=o})(Us||(Us={}));var qI;(e=>{function t(){return[]}e.empty=t;function i(u,c){let h=[];for(let d of u){let[p,...m]=d.path;p===c&&h.push({...d,path:m})}return h}e.removePrefix=i;function r(u,c){return u.map(h=>({...h,path:[c,...h.path]}))}e.addPrefix=r;function n(u,c){return[...u,...c]}e.concat=n;function s(u,c){return[...u.filter(h=>!c.some(d=>Us.subsumed(h,d))),...c]}e.compress=s;function a(u,c){return u.every(h=>c.every(d=>Us.commutative(h,d)))}e.commutative=a;function o(u,c){for(let h of c){let d=l(u,h);d!==null&&(u=d.data)}return u}e.applyAll=o;function l(u,c){var h=u;let d=[],p=[];for(let m of c)try{if(m.type===3||m.type===5&&m.path[m.path.length-1]==="variables"){let v,g,w;if(m.type===3?(v=bs.zoom(h,[...m.path,m.id]),w=Us.apply(h,{...m,type:2})):(v=bs.zoom(h,[...m.path,m.id,"value"]),w=Us.apply(h,m)),w!==null){h=w.data;let[S,_]=oEe(h,{[m.id]:v});h=S;for(let A=0;A<_.length;A++){let C=_[A],E=C.pop();if(typeof E=="number"){let I=[E];for(let D=A+1;D<_.length;D++){let L=_[D],z=L[L.length-1];if(typeof z=="number"&&bs.equal(C,L.slice(0,L.length-1)))I.push(z),_.splice(D,1);else break}let T=bs.zoom(h,C);g=T.map((D,L)=>I.includes(L)?m.id:D),v=T,E=C.pop()}else{if(E==="alphaOverride"||E==="alpha"){v/=100;let I=v,T=bs.zoom(h,C.slice(0,C.length-2)),D=T.layers.map(L=>L.id===C[C.length-1]?{...L,data:{...L.data,[E]:I}}:L);Object.setPrototypeOf(D,Object.getPrototypeOf(T.layers)),T.layers=D}g=m.id}d.push({type:0,path:C,props:{[E]:v}}),p.push({type:0,path:C,props:{[E]:g}})}p.push(w.reverse),d.push(w.actual)}}else{let v=Us.apply(h,m);v!==null&&(d.push(v.actual),h=v.data,p.push(v.reverse))}}catch(v){if(v instanceof NX)return null;throw v}return{data:h,actual:d,reverse:p.reverse()}}e.apply=l})(qI||(qI={}));var jX=Symbol(),cEe=Symbol(),eT=Symbol(),X_=class{reportOp(e,t,i=[]){let r=this;if(t===null)return;r._current=t.data;let n=i;for(;!(r instanceof WX);){let s=r._path,a=r._current;if(s!==""&&n.splice(0,0,s),r=r._parent,r===null)return;r.update(s,a)}r.push(n,e,t.actual,t.reverse)}deleteChildren(e){if(this._children){let t=this._children[e];if(t){let i=t[eT];i&&i(),delete this._children[e]}}}},hEe=class extends X_{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){if(Array.isArray(this._current)){if(typeof e=="string"&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid path");this._current=[...this._current],this._current[e]=t}else if(this._current instanceof Sn){let i={...this._current,[e]:t};this._current=Object.setPrototypeOf(i,Sn.prototype)}else this._current={...this._current,[e]:t}}runOp(e){this.reportOp(e,M2.runOp(this._current,e),e.path)}},dEe=class extends X_{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){this._current={...this._current,[e]:t},Object.setPrototypeOf(this._current,ii.prototype)}runOp(e){this.reportOp(e,this._current.runOp(e))}},HX={get(e,t){if(t===eT)return()=>{e._parent=null};if(t===jX)return e._current;if(t===cEe)return e;let{_current:i,_children:r}=e;if(t==="push"&&Array.isArray(i))throw new Error("not supported to expand array");let n=r===void 0?void 0:r[t];if(n!==void 0)return n;let s=i[t],a=tT(e,t,s);return a!==s?(r===void 0&&(r={},e._children=r),r[t]=a,a):s},has(e,t){return t in e._current},ownKeys(e){return Reflect.ownKeys(e._current)},defineProperty(){throw Error("not supported")},getPrototypeOf(e){return Object.getPrototypeOf(e._current)},setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(e,t){let i=e._current,r=Reflect.getOwnPropertyDescriptor(i,t);return r&&{writable:!0,configurable:!0,enumerable:r.enumerable,value:i[t]}}},fEe={...HX,set(e,t,i){let r={type:0,props:{[t]:Bn(i)??i}};return e.deleteChildren(t),e.runOp(r),!0},deleteProperty(e,t){let i={type:0,props:{[t]:void 0}};return e.deleteChildren(t),e.runOp(i),!0}},pEe={...HX,set(e,t,i){return i===void 0?this.deleteProperty(e,t):(e.deleteChildren(t),e.runOp({type:1,id:t,data:i})),!0},deleteProperty(e,t){return e.runOp({type:2,id:t}),!0}},Dk=class extends X_{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[eT]=()=>{this._parent=null}}unproxy(){return this._current}update(e,t){this._current=this._current.modifyById(e,t)}runOp(e){this.reportOp(e,this._current.runOp(e))}randomId(){return this._current.randomId()}isDescendantOf(e,t){return this._current.isDescendantOf(e,t)}childrenOf(e){return this._current.childrenOf(e)}traverse(e){return this._current.traverse(e)}get(e){return this._current.get(e)}parent(e){return this._current.parent(e)}traverse(e){this._current.traverse((t,i)=>{e(t,this.data(t))})}data(e){let{_current:t,_children:i}=this,r=i===void 0?void 0:i[e];if(r!==void 0)return r;let n=t.get(e)?.data,s=tT(this,e,n);return s!==n?(i===void 0&&(i={},this._children=i),i[e]=s,s):n}add(e,t,i,r,n){this.runOp({type:7,parent:e,fi:t,id:i,data:r,children:n})}move(e,t,i){this.runOp({type:9,parent:e,fi:t,id:i})}insertAfter(e,t,i){let r=this._current.insertAfterHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.add(e,r[n],s.id,s.data,s.children)}}insertBefore(e,t,i){let r=this._current.insertBeforeHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.add(e,r[n],s.id,s.data,s.children)}}moveAfter(e,t,i){let r=this._current.insertAfterHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.move(e,r[n],s)}}moveBefore(e,t,i){let r=this._current.insertBeforeHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.move(e,r[n],s)}}delete(e){this.deleteChildren(e),this.runOp({type:8,id:e})}sortNext(e){return this._current.sortNext(e)}sortPrevious(e){return this._current.sortPrevious(e)}getAllSorted(e){return this._current.getAllSorted(e)}},Rk=class extends X_{constructor(t,i,r){super(),this._children={},this._parent=t,this._path=i,this._current=r,this[eT]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(t){let i=this.length;for(let r=0;r<i;r++){let n=this._current[r].id,s=this._current[r].fi;t(this.data(this._current[r].id),n,s)}}find(t){let i=this.length;for(let r=0;r<i;r++){let n=this._current[r].id;if(t(this.data(n),n))return this.get(n)}}update(t,i){this._current=this._current.modifyById(t,i)}randomId(){return this._current.randomId()}get(t){return{...this._current.get(t),data:this.data(t)}}data(t){let{_current:i,_children:r}=this,n=r===void 0?void 0:r[t];if(n!==void 0)return n;let s=i.get(t)?.data,a=tT(this,t,s);return a!==s?(r===void 0&&(r={},this._children=r),r[t]=a,a):s}runOp(t){this.reportOp(t,this._current.runOp(t))}add(t,i,r){this.runOp({type:4,fi:t,id:i,data:r})}move(t,i){this.runOp({type:6,fi:t,id:i})}insertAfter(t,i){let r=this._current.insertAfterHelper(t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.add(r[n],s.id,s.data)}}insertBefore(t,i){let r=this._current.insertBeforeHelper(t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.add(r[n],s.id,s.data)}}moveAfter(t,i){let r=this._current.insertAfterHelper(t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.move(r[n],s)}}moveBefore(t,i){let r=this._current.insertBeforeHelper(t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.move(r[n],s)}}delete(t){this.deleteChildren(t),this.runOp({type:5,id:t})}};function Q3(e,t,i){if(e.length>0){let r=e[e.length-1];if(r.type===0&&t.type===0&&bs.equal(r.path,i)){Object.assign(r.props,t.props);return}}e.push({...t,path:i})}var WX=class extends X_{constructor(e){super(),this.ts=[],this.actual=[],this.reverse=[],this._current=e}update(e,t){if(e!=="")throw new Error("");this._current=t}push(e,t,i,r){Q3(this.ts,t,e),Q3(this.actual,i,e),Q3(this.reverse,r,e)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function tT(e,t,i){return i instanceof ga?new Dk(e,t,i):i instanceof Xt?new Rk(e,t,i):i instanceof ii?new Proxy(new dEe(e,t,i),pEe):i!==null&&typeof i=="object"?Ck(i)?i:new Proxy(new hEe(e,t,i),fEe):i}function GX(e){let t=new WX(e);return[tT(t,"",e),t]}function e_(e,t){let[i,r]=GX(e);return t(i),r.result()}function Bn(e){return e instanceof Dk||e instanceof Rk?e._current:e!==null&&typeof e=="object"?e[jX]:e}var bs;(e=>{function t(s,a){if(a.length===s.length)for(var o=0;o<s.length;){if(s[o]!==a[o])return!1;o+=1}else return!1;return!0}e.equal=t;function i(s,a,o){let l=n(o,s);if(l!==void 0&&typeof l=="object"&&l!==null){let u={...a};return Object.keys(l).forEach(c=>{delete u[c]}),u}else return a}e.removeOverridden=i;function r(s,a){if((s instanceof ga||s instanceof Dk)&&typeof a=="string"||(s instanceof Xt||s instanceof Rk)&&typeof a=="string")return s.data(a);if(typeof a=="number"&&Array.isArray(s)||typeof a=="string"&&typeof s=="object"&&s!==null)return s[a]}e.zoomOnce=r;function n(s,a,o=0){for(;o<a.length&&s!==void 0;)s=r(s,a[o]),o+=1;return s}e.zoom=n})(bs||(bs={}));function mEe(e,t){let i=[];if(t.length===e.length)for(var r=0;r<e.length;){if(t[r]==="*")i.push(e[r]);else if(e[r]!==t[r])return null;r+=1}else return null;return i}function Dr(e,t){let i=[];if(t.length<=e.length)for(var r=0;r<t.length;){if(t[r]==="*")i.push(e[r]);else if(e[r]!==t[r])return null;r+=1}else return null;return i}var qX=class{},IV=class extends qX{constructor(e){super(),this.id=e}},LV=class extends qX{constructor(e){super(),this.data=e}},XI;try{XI=new TextDecoder}catch{}var Ht,_p,He=0,Bo={},dr,cp,Bl=0,zc=0,ul,Sd,co=[],gr,OV={useRecords:!1,mapsAsObjects:!0},XX=class{},YX=new XX;YX.name="MessagePack 0xC1";var cx=!1,T2=class{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0)),Object.assign(this,e)}unpack(e,t){if(Ht)return eY(()=>(QI(),this?this.unpack(e,t):T2.prototype.unpack.call(OV,e,t)));_p=t>-1?t:e.length,He=0,zc=0,cp=null,ul=null,Ht=e;try{gr=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(i){throw Ht=null,e instanceof Uint8Array?i:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof T2){if(Bo=this,this.structures)return dr=this.structures,AA();(!dr||dr.length>0)&&(dr=[])}else Bo=OV,(!dr||dr.length>0)&&(dr=[]);return AA()}unpackMultiple(e,t){let i,r=0;try{cx=!0;let n=e.length,s=this?this.unpack(e,n):rT.unpack(e,n);if(t){for(t(s);He<n;)if(r=He,t(AA())===!1)return}else{for(i=[s];He<n;)r=He,i.push(AA());return i}}catch(n){throw n.lastPosition=r,n.values=i,n}finally{cx=!1,QI()}}_mergeStructures(e,t){e=e||[];for(let i=0,r=e.length;i<r;i++){let n=e[i];n&&(n.isShared=!0,i>=32&&(n.highByte=i-32>>5))}e.sharedLength=e.length;for(let i in t||[])if(i>=0){let r=e[i],n=t[i];n&&(r&&((e.restoreStructures||(e.restoreStructures=[]))[i]=r),e[i]=n)}return this.structures=e}decode(e,t){return this.unpack(e,t)}};function AA(){try{if(!Bo.trusted&&!cx){let t=dr.sharedLength||0;t<dr.length&&(dr.length=t)}let e=xn();if(He==_p)dr.restoreStructures&&zV(),dr=null,Ht=null,Sd&&(Sd=null);else if(He>_p){let t=new Error("Unexpected end of MessagePack data");throw t.incomplete=!0,t}else if(!cx)throw new Error("Data read, but end of buffer not reached");return e}catch(e){throw dr.restoreStructures&&zV(),QI(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer"))&&(e.incomplete=!0),e}}function zV(){for(let e in dr.restoreStructures)dr[e]=dr.restoreStructures[e];dr.restoreStructures=null}function xn(){let e=Ht[He++];if(e<160)if(e<128){if(e<64)return e;{let t=dr[e&63]||Bo.getStructures&&QX()[e&63];return t?(t.read||(t.read=Ik(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,Bo.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[ZX()]=xn();return t}else{let t=new Map;for(let i=0;i<e;i++)t.set(xn(),xn());return t}else{e-=144;let t=new Array(e);for(let i=0;i<e;i++)t[i]=xn();return t}else if(e<192){let t=e-160;if(zc>=He)return cp.slice(He-Bl,(He+=t)-Bl);if(zc==0&&_p<140){let i=t<16?Lk(t):KX(t);if(i!=null)return i}return YI(t)}else{let t;switch(e){case 192:return null;case 193:return ul?(t=xn(),t>0?ul[1].slice(ul.position1,ul.position1+=t):ul[0].slice(ul.position0,ul.position0-=t)):YX;case 194:return!1;case 195:return!0;case 196:return K3(Ht[He++]);case 197:return t=gr.getUint16(He),He+=2,K3(t);case 198:return t=gr.getUint32(He),He+=4,K3(t);case 199:return Vm(Ht[He++]);case 200:return t=gr.getUint16(He),He+=2,Vm(t);case 201:return t=gr.getUint32(He),He+=4,Vm(t);case 202:if(t=gr.getFloat32(He),Bo.useFloat32>2){let i=Ok[(Ht[He]&127)<<1|Ht[He+1]>>7];return He+=4,(i*t+(t>0?.5:-.5)>>0)/i}return He+=4,t;case 203:return t=gr.getFloat64(He),He+=8,t;case 204:return Ht[He++];case 205:return t=gr.getUint16(He),He+=2,t;case 206:return t=gr.getUint32(He),He+=4,t;case 207:return Bo.int64AsNumber?(t=gr.getUint32(He)*4294967296,t+=gr.getUint32(He+4)):t=gr.getBigUint64(He),He+=8,t;case 208:return gr.getInt8(He++);case 209:return t=gr.getInt16(He),He+=2,t;case 210:return t=gr.getInt32(He),He+=4,t;case 211:return Bo.int64AsNumber?(t=gr.getInt32(He)*4294967296,t+=gr.getUint32(He+4)):t=gr.getBigInt64(He),He+=8,t;case 212:if(t=Ht[He++],t==114)return UV(Ht[He++]&63);{let i=co[t];if(i)return i.read?(He++,i.read(xn())):i.noBuffer?(He++,i()):i(Ht.subarray(He,++He));throw new Error("Unknown extension "+t)}case 213:return t=Ht[He],t==114?(He++,UV(Ht[He++]&63,Ht[He++])):Vm(2);case 214:return Vm(4);case 215:return Vm(8);case 216:return Vm(16);case 217:return t=Ht[He++],zc>=He?cp.slice(He-Bl,(He+=t)-Bl):vEe(t);case 218:return t=gr.getUint16(He),He+=2,zc>=He?cp.slice(He-Bl,(He+=t)-Bl):yEe(t);case 219:return t=gr.getUint32(He),He+=4,zc>=He?cp.slice(He-Bl,(He+=t)-Bl):xEe(t);case 220:return t=gr.getUint16(He),He+=2,BV(t);case 221:return t=gr.getUint32(He),He+=4,BV(t);case 222:return t=gr.getUint16(He),He+=2,NV(t);case 223:return t=gr.getUint32(He),He+=4,NV(t);default:if(e>=224)return e-256;if(e===void 0){let i=new Error("Unexpected end of MessagePack data");throw i.incomplete=!0,i}throw new Error("Unknown MessagePack token "+e)}}}var gEe=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Ik(e,t){function i(){if(i.count++>2){let n=e.read=new Function("r","return function(){return {"+e.map(s=>gEe.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"}}")(xn);return e.highByte===0&&(e.read=kV(t,e.read)),n()}let r={};for(let n=0,s=e.length;n<s;n++){let a=e[n];r[a]=xn()}return r}return i.count=0,e.highByte===0?kV(t,i):i}var kV=(e,t)=>function(){let i=Ht[He++];if(i===0)return t();let r=e<32?-(e+(i<<5)):e+(i<<5),n=dr[r]||QX()[r];if(!n)throw new Error("Record id is not defined for "+r);return n.read||(n.read=Ik(n,e)),n.read()};function QX(){let e=eY(()=>(Ht=null,Bo.getStructures()));return dr=Bo._mergeStructures(e,dr)}var YI=iT,vEe=iT,yEe=iT,xEe=iT;function iT(e){let t;if(e<16&&(t=Lk(e)))return t;if(e>64&&XI)return XI.decode(Ht.subarray(He,He+=e));let i=He+e,r=[];for(t="";He<i;){let n=Ht[He++];if((n&128)===0)r.push(n);else if((n&224)===192){let s=Ht[He++]&63;r.push((n&31)<<6|s)}else if((n&240)===224){let s=Ht[He++]&63,a=Ht[He++]&63;r.push((n&31)<<12|s<<6|a)}else if((n&248)===240){let s=Ht[He++]&63,a=Ht[He++]&63,o=Ht[He++]&63,l=(n&7)<<18|s<<12|a<<6|o;l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|l&1023),r.push(l)}else r.push(n);r.length>=4096&&(t+=Bs.apply(String,r),r.length=0)}return r.length>0&&(t+=Bs.apply(String,r)),t}function BV(e){let t=new Array(e);for(let i=0;i<e;i++)t[i]=xn();return t}function NV(e){if(Bo.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[ZX()]=xn();return t}else{let t=new Map;for(let i=0;i<e;i++)t.set(xn(),xn());return t}}var Bs=String.fromCharCode;function KX(e){let t=He,i=new Array(e);for(let r=0;r<e;r++){let n=Ht[He++];if((n&128)>0){He=t;return}i[r]=n}return Bs.apply(String,i)}function Lk(e){if(e<4)if(e<2){if(e===0)return"";{let t=Ht[He++];if((t&128)>1){He-=1;return}return Bs(t)}}else{let t=Ht[He++],i=Ht[He++];if((t&128)>0||(i&128)>0){He-=2;return}if(e<3)return Bs(t,i);let r=Ht[He++];if((r&128)>0){He-=3;return}return Bs(t,i,r)}else{let t=Ht[He++],i=Ht[He++],r=Ht[He++],n=Ht[He++];if((t&128)>0||(i&128)>0||(r&128)>0||(n&128)>0){He-=4;return}if(e<6){if(e===4)return Bs(t,i,r,n);{let s=Ht[He++];if((s&128)>0){He-=5;return}return Bs(t,i,r,n,s)}}else if(e<8){let s=Ht[He++],a=Ht[He++];if((s&128)>0||(a&128)>0){He-=6;return}if(e<7)return Bs(t,i,r,n,s,a);let o=Ht[He++];if((o&128)>0){He-=7;return}return Bs(t,i,r,n,s,a,o)}else{let s=Ht[He++],a=Ht[He++],o=Ht[He++],l=Ht[He++];if((s&128)>0||(a&128)>0||(o&128)>0||(l&128)>0){He-=8;return}if(e<10){if(e===8)return Bs(t,i,r,n,s,a,o,l);{let u=Ht[He++];if((u&128)>0){He-=9;return}return Bs(t,i,r,n,s,a,o,l,u)}}else if(e<12){let u=Ht[He++],c=Ht[He++];if((u&128)>0||(c&128)>0){He-=10;return}if(e<11)return Bs(t,i,r,n,s,a,o,l,u,c);let h=Ht[He++];if((h&128)>0){He-=11;return}return Bs(t,i,r,n,s,a,o,l,u,c,h)}else{let u=Ht[He++],c=Ht[He++],h=Ht[He++],d=Ht[He++];if((u&128)>0||(c&128)>0||(h&128)>0||(d&128)>0){He-=12;return}if(e<14){if(e===12)return Bs(t,i,r,n,s,a,o,l,u,c,h,d);{let p=Ht[He++];if((p&128)>0){He-=13;return}return Bs(t,i,r,n,s,a,o,l,u,c,h,d,p)}}else{let p=Ht[He++],m=Ht[He++];if((p&128)>0||(m&128)>0){He-=14;return}if(e<15)return Bs(t,i,r,n,s,a,o,l,u,c,h,d,p,m);let v=Ht[He++];if((v&128)>0){He-=15;return}return Bs(t,i,r,n,s,a,o,l,u,c,h,d,p,m,v)}}}}}function K3(e){return Bo.copyBuffers?Uint8Array.prototype.slice.call(Ht,He,He+=e):Ht.subarray(He,He+=e)}function Vm(e){let t=Ht[He++];if(co[t])return co[t](Ht.subarray(He,He+=e));throw new Error("Unknown extension type "+t)}var FV=new Array(4096);function ZX(){let e=Ht[He++];if(e>=160&&e<192){if(e=e-160,zc>=He)return cp.slice(He-Bl,(He+=e)-Bl);if(!(zc==0&&_p<180))return YI(e)}else return He--,xn();let t=(e<<5^(e>1?gr.getUint16(He):e>0?Ht[He]:0))&4095,i=FV[t],r=He,n=He+e-3,s,a=0;if(i&&i.bytes==e){for(;r<n;){if(s=gr.getUint32(r),s!=i[a++]){r=1879048192;break}r+=4}for(n+=3;r<n;)if(s=Ht[r++],s!=i[a++]){r=1879048192;break}if(r===n)return He=r,i.string;n-=3,r=He}for(i=[],FV[t]=i,i.bytes=e;r<n;)s=gr.getUint32(r),i.push(s),r+=4;for(n+=3;r<n;)s=Ht[r++],i.push(s);let o=e<16?Lk(e):KX(e);return o!=null?i.string=o:i.string=YI(e)}var UV=(e,t)=>{var i=xn();let r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,i.highByte=t);let n=dr[e];return n&&n.isShared&&((dr.restoreStructures||(dr.restoreStructures=[]))[e]=n),dr[e]=i,i.read=Ik(i,r),i.read()},JX=typeof self=="object"?self:global;co[0]=()=>{};co[0].noBuffer=!0;co[101]=()=>{let e=xn();return(JX[e[0]]||Error)(e[1])};co[105]=e=>{let t=gr.getUint32(He-4);Sd||(Sd=new Map);let i=Ht[He],r;i>=144&&i<160||i==220||i==221?r=[]:r={};let n={target:r};Sd.set(t,n);let s=xn();return n.used?Object.assign(r,s):(n.target=s,s)};co[112]=e=>{let t=gr.getUint32(He-4),i=Sd.get(t);return i.used=!0,i.target};co[115]=()=>new Set(xn());var $X=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");co[116]=e=>{let t=e[0],i=$X[t];if(!i)throw new Error("Could not find typed array for code "+t);return new JX[i](Uint8Array.prototype.slice.call(e,1).buffer)};co[120]=()=>{let e=xn();return new RegExp(e[0],e[1])};co[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],i=He;He+=t-4,ul=[xn(),xn()],ul.position0=0,ul.position1=0;let r=He;He=i;try{return xn()}finally{He=r}};co[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function eY(e){let t=_p,i=He,r=Bl,n=zc,s=cp,a=Sd,o=ul,l=new Uint8Array(Ht.slice(0,_p)),u=dr,c=dr.slice(0,dr.length),h=Bo,d=cx,p=e();return _p=t,He=i,Bl=r,zc=n,cp=s,Sd=a,ul=o,Ht=l,cx=d,dr=u,dr.splice(0,dr.length,...c),Bo=h,gr=new DataView(Ht.buffer,Ht.byteOffset,Ht.byteLength),p}function QI(){Ht=null,Sd=null,dr=null}function wEe(e){e.unpack?co[e.type]=e.unpack:co[e.type]=e}var Ok=new Array(147);for(let e=0;e<256;e++)Ok[e]=+("1e"+Math.floor(45.15-e*.30103));var rT=new T2({useRecords:!1});rT.unpack;rT.unpackMultiple;rT.unpack;var bEe=new Float32Array(1);new Uint8Array(bEe.buffer,0,4);var NE;try{NE=new TextEncoder}catch{}var P2,zk,nT=typeof Buffer<"u",Z3=nT?Buffer.allocUnsafeSlow:Uint8Array,tY=nT?Buffer:Uint8Array,VV=nT?4294967296:2144337920,ht,Rn,Je=0,gc,vc=null,_Ee=/[\u0080-\uFFFF]/,gw=Symbol("record-id"),iY=class extends T2{constructor(e){super(e),this.offset=0;let t,i,r,n,s,a=0,o=tY.prototype.utf8Write?function(E,I,T){return ht.utf8Write(E,I,T)}:NE&&NE.encodeInto?function(E,I){return NE.encodeInto(E,ht.subarray(I)).written}:!1,l=this;e||(e={});let u=e&&e.sequential,c=e.structures||e.saveStructures,h=e.maxSharedStructures;if(h==null&&(h=c?32:0),h>8160)throw new Error("Maximum maxSharedStructure is 8160");let d=e.maxOwnStructures;d==null&&(d=c?32:64),u&&!e.saveStructures&&(this.structures=[]);let p=h>32||d+h>64,m=h+64,v=h+d+64;if(v>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let g=[],w=0,S=0;this.pack=this.encode=function(E,I){if(ht||(ht=new Z3(8192),Rn=new DataView(ht.buffer,0,8192),Je=0),gc=ht.length-10,gc-Je<2048?(ht=new Z3(ht.length),Rn=new DataView(ht.buffer,0,ht.length),gc=ht.length-10,Je=0):Je=Je+7&2147483640,t=Je,s=l.structuredClone?new Map:null,l.bundleStrings?(vc=["",""],ht[Je++]=214,ht[Je++]=98,vc.position=Je-t,Je+=4):vc=null,i=l.structures,i){i.uninitialized&&(i=l._mergeStructures(l.getStructures()));let T=i.sharedLength||0;if(T>h)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let D=0;D<T;D++){let L=i[D];if(!L)continue;let z,G=i.transitions;for(let V=0,j=L.length;V<j;V++){let J=L[V];z=G[J],z||(z=G[J]=Object.create(null)),G=z}G[gw]=D+64}a=T}u||(i.nextId=T+64)}r&&(r=!1),n=i||[];try{if(_(E),vc){Rn.setUint32(vc.position+t,Je-vc.position-t);let T=vc;vc=null,_(T[0]),_(T[1])}if(l.offset=Je,s&&s.idsToInsert){Je+=s.idsToInsert.length*6,Je>gc&&C(Je),l.offset=Je;let T=MEe(ht.subarray(t,Je),s.idsToInsert);return s=null,T}return I&AEe?(ht.start=t,ht.end=Je,ht):ht.subarray(t,Je)}finally{if(i){if(S<10&&S++,w>1e4)i.transitions=null,S=0,w=0,g.length>0&&(g=[]);else if(g.length>0&&!u){for(let T=0,D=g.length;T<D;T++)g[T][gw]=0;g=[]}if(r&&l.saveStructures){let T=i.sharedLength||h;i.length>T&&(i=i.slice(0,T));let D=ht.subarray(t,Je);return l.saveStructures(i,a)===!1?(l._mergeStructures(l.getStructures()),l.pack(E)):(a=T,D)}}I&EEe&&(Je=t)}};let _=E=>{Je>gc&&(ht=C(Je));var I=typeof E,T;if(I==="string"){let D=E.length;if(vc&&D>=8&&D<4096){let G=_Ee.test(E);vc[G?0:1]+=E,ht[Je++]=193,_(G?-D:D);return}let L;D<32?L=1:D<256?L=2:D<65536?L=3:L=5;let z=D*3;if(Je+z>gc&&(ht=C(Je+z)),D<64||!o){let G,V,j,J=Je+L;for(G=0;G<D;G++)V=E.charCodeAt(G),V<128?ht[J++]=V:V<2048?(ht[J++]=V>>6|192,ht[J++]=V&63|128):(V&64512)===55296&&((j=E.charCodeAt(G+1))&64512)===56320?(V=65536+((V&1023)<<10)+(j&1023),G++,ht[J++]=V>>18|240,ht[J++]=V>>12&63|128,ht[J++]=V>>6&63|128,ht[J++]=V&63|128):(ht[J++]=V>>12|224,ht[J++]=V>>6&63|128,ht[J++]=V&63|128);T=J-Je-L}else T=o(E,Je+L,z);T<32?ht[Je++]=160|T:T<256?(L<2&&ht.copyWithin(Je+2,Je+1,Je+1+T),ht[Je++]=217,ht[Je++]=T):T<65536?(L<3&&ht.copyWithin(Je+3,Je+2,Je+2+T),ht[Je++]=218,ht[Je++]=T>>8,ht[Je++]=T&255):(L<5&&ht.copyWithin(Je+5,Je+3,Je+3+T),ht[Je++]=219,Rn.setUint32(Je,T),Je+=4),Je+=T}else if(I==="number")if(E>>>0===E)E<64?ht[Je++]=E:E<256?(ht[Je++]=204,ht[Je++]=E):E<65536?(ht[Je++]=205,ht[Je++]=E>>8,ht[Je++]=E&255):(ht[Je++]=206,Rn.setUint32(Je,E),Je+=4);else if(E>>0===E)E>=-32?ht[Je++]=256+E:E>=-128?(ht[Je++]=208,ht[Je++]=E+256):E>=-32768?(ht[Je++]=209,Rn.setInt16(Je,E),Je+=2):(ht[Je++]=210,Rn.setInt32(Je,E),Je+=4);else{let D;if((D=this.useFloat32)>0&&E<4294967296&&E>=-2147483648){ht[Je++]=202,Rn.setFloat32(Je,E);let L;if(D<4||(L=E*Ok[(ht[Je]&127)<<1|ht[Je+1]>>7])>>0===L){Je+=4;return}else Je--}ht[Je++]=203,Rn.setFloat64(Je,E),Je+=8}else if(I==="object")if(!E)ht[Je++]=192;else{if(s){let L=s.get(E);if(L){if(!L.id){let z=s.idsToInsert||(s.idsToInsert=[]);L.id=z.push(L)}ht[Je++]=214,ht[Je++]=112,Rn.setUint32(Je,L.id),Je+=4;return}else s.set(E,{offset:Je-t})}let D=E.constructor;if(D===Object)A(E,!0);else if(D===Array){T=E.length,T<16?ht[Je++]=144|T:T<65536?(ht[Je++]=220,ht[Je++]=T>>8,ht[Je++]=T&255):(ht[Je++]=221,Rn.setUint32(Je,T),Je+=4);for(let L=0;L<T;L++)_(E[L])}else if(D===Map){T=E.size,T<16?ht[Je++]=128|T:T<65536?(ht[Je++]=222,ht[Je++]=T>>8,ht[Je++]=T&255):(ht[Je++]=223,Rn.setUint32(Je,T),Je+=4);for(let[L,z]of E)_(L),_(z)}else{for(let L=0,z=P2.length;L<z;L++){let G=zk[L];if(E instanceof G){let V=P2[L];if(V.write){V.type&&(ht[Je++]=212,ht[Je++]=V.type,ht[Je++]=0),_(V.write.call(this,E));return}let j=ht,J=Rn,ne=Je;ht=null;let K;try{K=V.pack.call(this,E,B=>(ht=j,j=null,Je+=B,Je>gc&&C(Je),{target:ht,targetView:Rn,position:Je-B}),_)}finally{j&&(ht=j,Rn=J,Je=ne,gc=ht.length-10)}K&&(K.length+Je>gc&&C(K.length+Je),Je=SEe(K,ht,Je,V.type));return}}A(E,!E.hasOwnProperty)}}else if(I==="boolean")ht[Je++]=E?195:194;else if(I==="bigint"){if(E<BigInt(1)<<BigInt(63)&&E>=-(BigInt(1)<<BigInt(63)))ht[Je++]=211,Rn.setBigInt64(Je,E);else if(E<BigInt(1)<<BigInt(64)&&E>0)ht[Je++]=207,Rn.setBigUint64(Je,E);else if(this.largeBigIntToFloat)ht[Je++]=203,Rn.setFloat64(Je,Number(E));else throw new RangeError(E+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");Je+=8}else if(I==="undefined")this.encodeUndefinedAsNil?ht[Je++]=192:(ht[Je++]=212,ht[Je++]=0,ht[Je++]=0);else if(I==="function")_(this.writeFunction&&this.writeFunction());else throw new Error("Unknown type: "+I)},A=this.useRecords===!1?this.variableMapSize?E=>{let I=Object.keys(E),T=I.length;T<16?ht[Je++]=128|T:T<65536?(ht[Je++]=222,ht[Je++]=T>>8,ht[Je++]=T&255):(ht[Je++]=223,Rn.setUint32(Je,T),Je+=4);let D;for(let L=0;L<T;L++)_(D=I[L]),_(E[D])}:(E,I)=>{ht[Je++]=222;let T=Je-t;Je+=2;let D=0;for(let L in E)(I||E.hasOwnProperty(L))&&(_(L),_(E[L]),D++);ht[T+++t]=D>>8,ht[T+t]=D&255}:E=>{let I=Object.keys(E),T,D=n.transitions||(n.transitions=Object.create(null)),L=0;for(let G=0,V=I.length;G<V;G++){let j=I[G];T=D[j],T||(T=D[j]=Object.create(null),L++),D=T}let z=D[gw];if(z)z>=96&&p?(ht[Je++]=((z-=96)&31)+96,ht[Je++]=z>>5):ht[Je++]=z;else{z=n.nextId,z||(z=64),z<m&&this.shouldShareStructure&&!this.shouldShareStructure(I)?(z=n.nextOwnId,z<v||(z=m),n.nextOwnId=z+1):(z>=v&&(z=m),n.nextId=z+1);let G=I.highByte=z>=96&&p?z-96>>5:-1;D[gw]=z,n[z-64]=I,z<m?(I.isShared=!0,n.sharedLength=z-63,r=!0,G>=0?(ht[Je++]=(z&31)+96,ht[Je++]=G):ht[Je++]=z):(G>=0?(ht[Je++]=213,ht[Je++]=114,ht[Je++]=(z&31)+96,ht[Je++]=G):(ht[Je++]=212,ht[Je++]=114,ht[Je++]=z),L&&(w+=S*L),g.length>=d&&(g.shift()[gw]=0),g.push(D),_(I))}for(let G=0,V=I.length;G<V;G++)_(E[I[G]])},C=E=>{let I;if(E>16777216){if(E-t>VV)throw new Error("Packed buffer would be larger than maximum buffer size");I=Math.min(VV,Math.round(Math.max((E-t)*(E>67108864?1.25:2),4194304)/4096)*4096)}else I=(Math.max(E-t<<2,ht.length-1)>>12)+1<<12;let T=new Z3(I);return Rn=new DataView(T.buffer,0,I),ht.copy?ht.copy(T,0,t,E):T.set(ht.slice(t,E)),Je-=t,t=0,gc=T.length-10,ht=T}}useBuffer(e){ht=e,Rn=new DataView(ht.buffer,ht.byteOffset,ht.byteLength),Je=0}};zk=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,XX];P2=[{pack(e,t,i){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:n,targetView:s,position:a}=t(6);n[a++]=214,n[a++]=255,s.setUint32(a,r)}else if(r>0&&r<17179869184){let{target:n,targetView:s,position:a}=t(10);n[a++]=215,n[a++]=255,s.setUint32(a,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(a+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),i(this.onInvalidDate());let{target:n,targetView:s,position:a}=t(3);n[a++]=212,n[a++]=255,n[a++]=255}else{let{target:n,targetView:s,position:a}=t(15);n[a++]=199,n[a++]=12,n[a++]=255,s.setUint32(a,e.getMilliseconds()*1e6),s.setBigInt64(a+4,BigInt(Math.floor(r)))}}},{pack(e,t,i){let r=Array.from(e),{target:n,position:s}=t(this.structuredClone?3:0);this.structuredClone&&(n[s++]=212,n[s++]=115,n[s++]=0),i(r)}},{pack(e,t,i){let{target:r,position:n}=t(this.structuredClone?3:0);this.structuredClone&&(r[n++]=212,r[n++]=101,r[n++]=0),i([e.name,e.message])}},{pack(e,t,i){let{target:r,position:n}=t(this.structuredClone?3:0);this.structuredClone&&(r[n++]=212,r[n++]=120,r[n++]=0),i([e.source,e.flags])}},{pack(e,t){this.structuredClone?jV(e,16,t):HV(nT?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let i=e.constructor;i!==tY&&this.structuredClone?jV(e,$X.indexOf(i.name),t):HV(e,t)}},{pack(e,t){let{target:i,position:r}=t(1);i[r]=193}}];function jV(e,t,i,r){let n=e.byteLength;if(n+1<256){var{target:s,position:a}=i(4+n);s[a++]=199,s[a++]=n+1}else if(n+1<65536){var{target:s,position:a}=i(5+n);s[a++]=200,s[a++]=n+1>>8,s[a++]=n+1&255}else{var{target:s,position:a,targetView:o}=i(7+n);s[a++]=201,o.setUint32(a,n+1),a+=4}s[a++]=116,s[a++]=t,s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),a)}function HV(e,t){let i=e.byteLength;var r,n;if(i<256){var{target:r,position:n}=t(i+2);r[n++]=196,r[n++]=i}else if(i<65536){var{target:r,position:n}=t(i+3);r[n++]=197,r[n++]=i>>8,r[n++]=i&255}else{var{target:r,position:n,targetView:s}=t(i+5);r[n++]=198,s.setUint32(n,i),n+=4}r.set(e,n)}function SEe(e,t,i,r){let n=e.length;switch(n){case 1:t[i++]=212;break;case 2:t[i++]=213;break;case 4:t[i++]=214;break;case 8:t[i++]=215;break;case 16:t[i++]=216;break;default:n<256?(t[i++]=199,t[i++]=n):n<65536?(t[i++]=200,t[i++]=n>>8,t[i++]=n&255):(t[i++]=201,t[i++]=n>>24,t[i++]=n>>16&255,t[i++]=n>>8&255,t[i++]=n&255)}return t[i++]=r,t.set(e,i),i+=n,i}function MEe(e,t){let i,r=t.length*6,n=e.length-r;for(t.sort((s,a)=>s.offset>a.offset?1:-1);i=t.pop();){let s=i.offset,a=i.id;e.copyWithin(s+r,s,n),r-=6;let o=s+r;e[o++]=214,e[o++]=105,e[o++]=a>>24,e[o++]=a>>16&255,e[o++]=a>>8&255,e[o++]=a&255,n=s}return e}function qx(e){if(e.Class){if(!e.pack&&!e.write)throw new Error("Extension has no pack or write function");if(e.pack&&!e.type)throw new Error("Extension has no type (numeric code to identify the extension)");zk.unshift(e.Class),P2.unshift(e)}wEe(e)}var rY=new iY({useRecords:!1});rY.pack;rY.pack;var AEe=512,EEe=1024,WV=new iY({structuredClone:!0});qx({Class:ii.prototype.constructor,type:1,write(e){return{...e}},read(e){return Object.setPrototypeOf(e,ii.prototype),e}});qx({Class:Xt.prototype.constructor,type:2,write(e){return[...e]},read(e){return Object.setPrototypeOf(e,Xt.prototype),e}});qx({Class:ga.prototype.constructor,type:3,write(e){return[...e]},read(e){return Object.setPrototypeOf(e,ga.prototype),e}});qx({Class:IV.prototype.constructor,type:4,write(e){return e.id},read(e){return new IV(e)}});qx({Class:LV.prototype.constructor,type:5,write(e){return e.data},read(e){return new LV(e)}});qx({Class:Sn.prototype.constructor,type:6,write(e){return{...e}},read(e){return Object.setPrototypeOf(e,Sn.prototype),e}});function CEe(e){var t=0;if(e.length===0)return t;for(let i=0;i<e.length;i++){let r=e[i];t=(t<<5)-t+r,t=t&t}return t}function KI(e){if(Ck(e))return e;if(Array.isArray(e))return e.map(KI);if(typeof e=="object"&&e!==null){let t={};for(let i of Object.keys(e).sort())t[i]=KI(e[i]);return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}else return e}var D2;(e=>{function t(n){return WV.pack(n)}e.serialize=t;function i(n){return WV.unpack(n)}e.deserialize=i;function r(n){return CEe(t(KI(n))).toString()}e.checksum=r})(D2||(D2={}));var GV;(e=>{function t(r){return r.type==="Conditional"?r.condition.type==="Distance"?"Distance":"StateChange":r.type}e.toEventUIType=t;function i(r){return r==="Distance"||r==="StateChange"?"Conditional":r}e.fromEventUIType=i})(GV||(GV={}));function ZI(e){return e==="MouseDown"||e==="MouseUp"||e==="KeyDown"||e==="KeyUp"||e==="Collision"||e==="Trigger"}var oa={LookAt:[],Follow:["Create"],DragDrop:["Transition","Animation","Audio","Particles","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseHover:["Transition","Animation","TimelineAnimation","Particles","Create","Destroy","SwitchCamera","SceneTransition","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Scroll:["Transition","Animation","TimelineAnimation","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Start:["Transition","Animation","TimelineAnimation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Conditional:["Transition","Animation","TimelineAnimation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseDown:["Transition","Animation","TimelineAnimation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseUp:["Transition","Animation","TimelineAnimation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MousePress:["Transition","Animation","TimelineAnimation","Audio","Particles","Video","Link","Create","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyDown:["Transition","Animation","TimelineAnimation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyUp:["Transition","Animation","TimelineAnimation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyPress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],GameControl:["Transition","Animation","TimelineAnimation","Audio","Particles","Create","Conditional"],Collision:["Transition","Animation","TimelineAnimation","Audio","Particles","Video","Create","Destroy","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Trigger:["Transition","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Resize:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],VariableChange:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],API:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],WEBHOOK:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],AIAssistantListener:["SetVariable"],AIAssistantTrigger:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"]},qV;(e=>{function t(r){return r.type==="MouseDown"||r.type==="MouseUp"||r.type==="MousePress"||r.type==="KeyDown"||r.type==="KeyUp"||r.type==="KeyPress"}e.is=t;function i(r){return r==="MouseDown"||r==="MouseUp"||r==="MousePress"?{type:r,mode:"Object",disabled:!1,name:"",actions:new Xt}:{type:r,disabled:!1,name:"",key:void 0,actions:new Xt}}e.defaultData=i})(qV||(qV={}));var R2;(e=>{function t(i){return{type:"Property",value:[i??null,"position","x"]}}e.propertyDefaultData=t,e.valueDefaultData={type:"Literal",value:0}})(R2||(R2={}));var JI;(e=>{function t(n){return{type:"Comparison",operator:"==",lOperand:R2.propertyDefaultData(n),rOperand:{...R2.valueDefaultData}}}e.comparisonDefaultData=t;function i(n){return{type:"Distance",toObject:n??null,fromObject:n??null,distance:200}}e.distanceDefaultData=i;function r(n,s){return{type:"State",object:n??null,state:s??null}}e.stateDefaultData=r})(JI||(JI={}));var XV;(e=>{function t(i){return i.find(r=>r==="ifActions"||r==="elseActions")!==void 0}e.isConditionalSubActions=t})(XV||(XV={}));var YV;(e=>{function t(r){return r.type==="Conditional"}e.is=t;function i(r){return{type:"Conditional",disabled:!1,name:"",inActions:new Xt,outActions:new Xt,condition:JI.distanceDefaultData(r)}}e.defaultData=i})(YV||(YV={}));var QV;(e=>e.defaultData={type:"DragDrop",name:"",cursor:"hand",disabled:!1,dampingFactor:1,objects:[],snapTo:"center",snapSurfaceMode:"bbox",snapSurfaceOffset:0,dropOn:"all",autoOrient:!0,dropDestinations:[],plane:"adaptive",planeMode:"locked",referenceFrame:"global",limits:[-1/0,1/0,-1/0,1/0,-1/0,1/0],drop:!1,resetOnSnapFail:!1,snapSpeed:20,resetSpeed:20,dragDropActions:{drag:new Xt,drop:new Xt}})(QV||(QV={}));var $I;(e=>e.defaultData={type:"Follow",disabled:!1,name:"",maxDelta:0,dampingFactor:1,target:"cursor",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledTranslation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5,actions:new Xt})($I||($I={}));var eL;(e=>e.defaultData={type:"LookAt",disabled:!1,name:"",distance:1e3,dampingFactor:1,target:"cursor",tilt:"up",axis:"z",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledRotation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5})(eL||(eL={}));var KV;(e=>{function t(r){return r.type==="MouseHover"}e.is=t;function i(){return{type:"MouseHover",disabled:!1,name:"",actions:new Xt}}e.defaultData=i})(KV||(KV={}));var ZV;(e=>{function t(r){return r.type==="Scroll"}e.is=t;function i(){return{type:"Scroll",disabled:!1,name:"",steps:100,trigger:"load",startFrom:"enter",enterAnchor:"top",startOffset:0,endAfter:400,actions:new Xt}}e.defaultData=i})(ZV||(ZV={}));var JV;(e=>{function t(r){return r.type==="Start"}e.is=t;function i(){return{type:"Start",disabled:!1,name:"",actions:new Xt}}e.defaultData=i})(JV||(JV={}));var $V;(e=>{function t(r){return r.type==="Collision"}e.is=t;function i(){return{type:"Collision",disabled:!1,name:"",target:"character",actions:new Xt}}e.defaultData=i})($V||($V={}));var e6;(e=>{function t(r){return r.type==="Trigger"}e.is=t;function i(r,n){return{type:"Trigger",name:"",disabled:!1,target:"all",triggeringObjects:[],actions:new Xt,triggerZone:"box",position:n.toArray(),rotation:[0,0,0],size:r.toArray(),radius:r.length()/2,helperVisible:!0}}e.defaultData=i})(e6||(e6={}));var tL;(e=>{e.defaultSizes={mobile:[480,480],tablet:[768,768],desktop:[1200,1200],custom:[769,1200]};function t(a){return a.type==="Resize"}e.is=t;function i(a){return typeof a=="string"?a:"custom"}e.sizeToDevice=i;function r(a){return typeof a=="string"?[...e.defaultSizes[a]]:[...a]}e.deviceToSize=r;function n(){let a={size:"mobile",operator:"<",actions:new Xt},o={size:"tablet",operator:"<",actions:new Xt},l={size:[...e.defaultSizes.custom],operator:"<>",actions:new Xt},u=new Xt;return u.push({id:Ot.generateUUID(),fi:0,data:a},{id:Ot.generateUUID(),fi:1,data:o},{id:Ot.generateUUID(),fi:2,data:l}),{type:"Resize",disabled:!1,name:"",orientation:"horizontal",breakpoints:u}}e.defaultData=n;function s(){return{size:[...e.defaultSizes.custom],operator:"<>",actions:new Xt}}e.defaultBreakpointData=s})(tL||(tL={}));var iL;(e=>{e.propertyPaths={Position:["position"],"Position X":["position","x"],"Position Y":["position","y"],"Position Z":["position","z"],Rotation:["rotation"],"Rotation X":["rotation","x"],"Rotation Y":["rotation","y"],"Rotation Z":["rotation","z"],Scale:["scale"],"Scale X":["scale","x"],"Scale Y":["scale","y"],"Scale Z":["scale","z"],Width:["width"],Height:["height"],Depth:["depth"],"Mouse Position X":["mouse","x"],"Mouse Position Y":["mouse","y"],"Mouse Pressed":["mouse","pressed"],"Screen Width":["mouse","width"],"Screen Height":["mouse","height"],"Hit Position X":["raycast","x"],"Hit Position Y":["raycast","y"],"Hit Position Z":["raycast","z"],"Hit Object Position X":["raycast","objX"],"Hit Object Position Y":["raycast","objY"],"Hit Object Position Z":["raycast","objZ"]};function t(r){return r.type==="VariableChange"}e.is=t;function i(){return{disabled:!1,type:"VariableChange",name:"",actions:new Xt,variableId:"",objectId:null,property:"Position X"}}e.defaultData=i})(iL||(iL={}));var t6;(e=>{function t(r){return r.type==="API"}e.is=t;function i(){return{disabled:!1,type:"API",name:"",successActions:new Xt,errorActions:new Xt,userAPIId:""}}e.defaultData=i})(t6||(t6={}));var i6;(e=>{function t(r){return r.type==="WEBHOOK"}e.is=t;function i(){return{disabled:!1,type:"WEBHOOK",name:"",actions:new Xt,userWebhookId:""}}e.defaultData=i})(i6||(i6={}));var r6;(e=>{function t(r){return r.type==="AIAssistantListener"}e.is=t;function i(){return{disabled:!1,type:"AIAssistantListener",name:"",actions:new Xt,analysis:"average",analysisRange:[0,71],analysisSingle:0}}e.defaultData=i})(r6||(r6={}));var n6;(e=>{function t(r){return r.type==="AIAssistantTrigger"}e.is=t;function i(){return{disabled:!1,description:"",name:"",type:"AIAssistantTrigger",actions:new Xt}}e.defaultData=i})(n6||(n6={}));var Xx="personal camera",ob="a218fcc3-276b-49b9-b485-49037fd14f5f",TEe=2960946,fl=5526619,Fc;(e=>{function t(m,v){return m[0]===v[0]&&m[1]===v[1]}e.isEqual=t;function i(m,v,g){return[m[0]+(v[0]-m[0])*g,m[1]+(v[1]-m[1])*g]}e.lerp=i;function r(m,v){return[m[0]+v[0],m[1]+v[1]]}e.add=r;function n(m,v){return[m[0]-v[0],m[1]-v[1]]}e.sub=n;function s(m,v){return[m[0]*v[0],m[1]*v[1]]}e.multiply=s;function a(m,v){return[m[0]/v[0],m[1]/v[1]]}e.divide=a;function o(m,v){return Math.pow(v[0]-m[0],2)+Math.pow(v[1]-m[1],2)}e.distanceSquared=o;function l(m,v){return Math.sqrt(o(m,v))}e.distance=l;function u(m,v){return m[0]*v[0]+m[1]*v[1]}e.dot=u;function c(m,v){return[m[0]*v,m[1]*v]}e.scalarMultiply=c;function h(m,v,g){let w=e.sub(v,m),S=e.sub(g,m),_=e.dot(w,S)/e.dot(w,w),A=e.scalarMultiply(w,_);return e.add(m,A)}e.projectionOnto=h;function d(m,v,g){return l(m,h(m,v,g))}e.projectionOntoDistance=d;function p(m,v){return[(m[0]+v[0])*.5,(m[1]+v[1])*.5]}e.center=p})(Fc||(Fc={}));var Sp;(e=>{function t(l,u){return l[0]===u[0]&&l[1]===u[1]&&l[2]===u[2]}e.isEqual=t;function i(l,u){return[l[0]+u[0],l[1]+u[1],l[2]+u[2]]}e.add=i;function r(l,u){return[l[0]-u[0],l[1]-u[1],l[2]-u[2]]}e.sub=r;function n(l,u){return[l[0]/u[0],l[1]/u[1],l[2]/u[2]]}e.div=n;function s(l,u){return[l[0]*u[0],l[1]*u[1],l[2]*u[2]]}e.mul=s;function a(l,u){return Math.hypot(l[0]-u[0],l[1]-u[1],l[2]-u[2])}e.dist=a;function o(l,u,c){return[l[0]+(u[0]-l[0])*c,l[1]+(u[1]-l[1])*c,l[2]+(u[2]-l[2])*c]}e.lerp=o})(Sp||(Sp={}));var t_;(e=>{function t(r,n){return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]&&r[3]===n[3]}e.isEqual=t;function i(r,n,s){return[r[0]+(n[0]-r[0])*s,r[1]+(n[1]-r[1])*s,r[2]+(n[2]-r[2])*s,r[3]+(n[3]-r[3])*s]}e.lerp=i})(t_||(t_={}));var s6;(e=>{let t=180/Math.PI,i=Math.PI/180;function r(o){return typeof o=="number"?o*t:o}function n(o){return typeof o=="number"?o*i:o}function s(o){return[r(o[0]),r(o[1]),r(o[2])]}e.radToDeg=s;function a(o){return[n(o[0]),n(o[1]),n(o[2])]}e.degToRad=a})(s6||(s6={}));var hx;(e=>{e.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function t(n,s){for(let a=0;a<16;a++)if(n[a]!==s[a])return!1;return!0}e.isEqual=t;function i(n){return n??e.identity}e.simplify=i;function r(n,s){let a=s.slice(0);for(var o=0,l=s.length;o<l;o+=3){let u=n[3]*s[o]+n[7]*s[o+1]+n[11]*s[o+2]+n[15];a[o]=(n[0]*s[o]+n[4]*s[o+1]+n[8]*s[o+2]+n[12])/u,a[o+1]=(n[1]*s[o]+n[5]*s[o+1]+n[9]*s[o+2]+n[13])/u,a[o+2]=(n[2]*s[o]+n[6]*s[o+1]+n[10]*s[o+2]+n[14])/u}return a}e.applyMatrix4=r})(hx||(hx={}));var es;(e=>{function t(c){return typeof c=="object"&&typeof c.r=="number"&&typeof c.g=="number"&&typeof c.b=="number"}e.isRGB=t,e.white={r:1,g:1,b:1},e.red={r:1,g:0,b:0},e.black={r:0,g:0,b:0};function i(c){return{r:Math.round(c.r*255),g:Math.round(c.g*255),b:Math.round(c.b*255),a:1}}e.toRgb255a1=i;function r(c){return{r:c.r,g:c.g,b:c.b}}e.clone=r;function n(c){return c=Math.floor(c),{r:(c>>16&255)/255,g:(c>>8&255)/255,b:(c&255)/255}}e.fromHex=n;function s(c){return Math.round(c.r*255)*65536+Math.round(c.g*255)*256+Math.round(c.b*255)}e.toHex=s;function a(c,h){return c.r===h.r&&c.g===h.g&&c.b===h.b}e.equals=a;function o(c,h){return c.r.toFixed(2)===h.r.toFixed(2)&&c.g.toFixed(2)===h.g.toFixed(2)&&c.b.toFixed(2)===h.b.toFixed(2)}e.equalsFixed=o;function l(c,h,d){return{r:c.r+(h.r-c.r)*d,g:c.g+(h.g-c.g)*d,b:c.b+(h.b-c.b)*d}}e.lerp=l;function u(c){return dl(c)?"r"in c&&"g"in c&&"b"in c&&!("a"in c):!1}e.is=u})(es||(es={}));var mr;(e=>{e.white={...es.white,a:1};function t(u){return dl(u)?"r"in u&&"g"in u&&"b"in u&&"a"in u:!1}e.is=t,e.transparent={...es.white,a:0};function i(u){return{r:u[0],g:u[1],b:u[2],a:u[3]}}e.from0to1=i;function r(u,c){return{...es.fromHex(u),a:c}}e.fromHexAndA=r;function n(u){return{r:Math.round(u.r*255),g:Math.round(u.g*255),b:Math.round(u.b*255),a:u.a}}e.toRgb255a1=n;function s(u,c){return es.equals(u,c)&&u.a===c.a}e.equals=s;function a(u,c){return es.equalsFixed(u,c)&&u.a.toFixed(2)===c.a.toFixed(2)}e.equalsFixed=a;function o(u,c,h){return{r:u.r+(c.r-u.r)*h,g:u.g+(c.g-u.g)*h,b:u.b+(c.b-u.b)*h,a:u.a+(c.a-u.a)*h}}e.lerp=o;function l({r:u,g:c,b:h,a:d}=e.white){return`rgba(${u*255}, ${c*255}, ${h*255}, ${d})`}e.toStyle=l})(mr||(mr={}));var rL;(e=>e.identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]})(rL||(rL={}));var PEe=(e=>(e[e.LINEAR=0]="LINEAR",e[e.EASE=1]="EASE",e[e.EASE_IN=2]="EASE_IN",e[e.EASE_OUT=3]="EASE_OUT",e[e.EASE_IN_OUT=4]="EASE_IN_OUT",e[e.CUBIC=5]="CUBIC",e[e.SPRING=6]="SPRING",e[e.ARC=7]="ARC",e[e.NONE=8]="NONE",e))(PEe||{}),I2;(e=>e.defaultData={mass:1,stiffness:80,damping:10,velocity:0})(I2||(I2={}));var L2;(e=>e.defaultData={control1:[.5,0],control2:[.5,1]})(L2||(L2={}));var Zf;(e=>(e.linear=[0,0,1,1],e.ease=[.25,.1,.25,1],e.easeIn=[.42,0,1,1],e.easeOut=[0,0,.58,1],e.easeInOut=[.42,0,.58,1]))(Zf||(Zf={}));function a6(e){return typeof e=="string"&&e.length===36?/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e):!1}var Xg;(e=>{e.all=["PerspectiveCamera","OrthographicCamera"];function t(i){return e.all.includes(i)}e.is=t})(Xg||(Xg={}));var dx;(e=>{e.DefaultUp=[0,1,0],e.DefaultTargetOffset=1e3,e.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:70,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1},up:e.DefaultUp,isUpVectorFlipped:!1,targetOffset:e.DefaultTargetOffset};function t(i){return i.type==="PerspectiveCamera"?i.perspective?.zoom??1:i.orthographic?.zoom??1}e.getZoom=t})(dx||(dx={}));var hp;(e=>{function t(n,s=.1){return{disabled:!1,type:"linear",hideBase:!1,count:3,radial:{radius:Math.max(n[0],n[1])*2,start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},linear:{scale:[1,1,1],rotation:[0,0,0],position:[n[0]+n[0]*s,0,0]},grid:{count:[2,2,2],size:n.map(a=>a*(1+s)),useCenter:!0},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}}e.defaultData=t;function i(n,s){let a={...n};if(nY.forEach(o=>{Object.assign(a,{[o]:s[o]??n[o]})}),a.radial={...n.radial},s.radial){let o=n.radial,l=s.radial;kk.forEach(u=>{Object.assign(a.radial,{[u]:l[u]??o[u]})})}if(a.linear={...n.linear},s.linear){let o=n.linear,l=s.linear;Bk.forEach(u=>{Object.assign(a.linear,{[u]:l[u]??o[u]})})}if(a.grid={...n.grid},s.grid){let o=n.grid,l=s.grid;Nk.forEach(u=>{Object.assign(a.grid,{[u]:l[u]??o[u]})})}if(a.toObject={...n.toObject},s.toObject){let o=n.toObject,l=s.toObject;Fk.forEach(u=>{Object.assign(a.toObject,{[u]:l[u]??o[u]})})}if(a.randomnessObject={...n.randomnessObject},s.randomnessObject){let o=n.randomnessObject,l=s.randomnessObject;Uk.forEach(u=>{Object.assign(a.randomnessObject,{[u]:l[u]??o[u]})})}return a}e.merge=i;function r(n){return!!(n.randomnessObject||n.toObject)}e.isPartial=r})(hp||(hp={}));var nL;(e=>{e.defaultData={radial:{},linear:{},grid:{},toObject:{},randomnessObject:{}};let t=["radial","linear","grid","toObject","randomnessObject"];function i(r,n){let s=[];r.count!==void 0&&s.push({type:0,path:n,props:{count:r.count}});for(let a of t){let o=r[a];o&&Object.keys(o).length>0&&s.push({type:0,path:[...n,a],props:o})}return s}e.toOps=i})(nL||(nL={}));var nY=["count"],kk=["radius","start","end","position","scale","rotation"],Bk=["position","scale","rotation"],Nk=["count","size"],Fk=["count","position","scale","rotation"],Uk=["strength","scale","rotation","position","movement","seed","freqScale"],sL;(e=>{e.all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"];function t(i){return e.all.includes(i)}e.is=t})(sL||(sL={}));var aL;(e=>{function t(r){return i(r)}e.defaultData=t;function i(r){if(r==="PointLight")return{type:r,color:mr.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,penumbraSize:.5,depth:1e5};if(r==="SpotLight")return{type:r,color:mr.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};if(r==="DirectionalLight")return{type:r,color:mr.white,intensity:1,shadows:!0,size:2e3,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};throw new Error("not implemented")}})(aL||(aL={}));var O2;(e=>(e.defaultShapeData={type:"PlaneEmitterShape",size:[100,100,100]},e.defaultCollisionData={colliderEntityId:null,collisionBounce:.75},e.defaultData={renderMaterial:{type:"particleMaterial",color:{r:1,g:.2,b:.545,a:1},color2:{r:.945,g:.714,b:.184,a:1},coloring:"gradient",ease:"linearFadeOut",easeSize:"linearFadeOut",transparent:!0,size:[40,40],texture:"pt_default_particle",spriteRotation:[0,0]},birthRatePerSec:50,gravity:1,noiseStrength:0,noiseScale:0,noiseSeed:1,noiseType:"curl",randomRotation:0,randomScale:.2,randomMass:.5,rootObjectType:"instancedMesh",life:1,direction:[0,0,0],directionMode:"axis",speed:10,shape:e.defaultShapeData,autoPlay:!0,emitTimeDelay:0,emitTimeCycle:"infinity",emitTimeDuration:1,...e.defaultCollisionData}))(O2||(O2={}));var fx;(e=>e.defaultData={enabled:"visibility",fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]})(fx||(fx={}));var oL;(e=>{e.defaultData={castShadow:!0,receiveShadow:!0};function t(i,r){return i.castShadow===r.castShadow&&i.receiveShadow===r.receiveShadow}e.equals=t})(oL||(oL={}));var lL;(e=>{e.defaultData={flatShading:!1,wireframe:!1,side:0};function t(i,r){return i.flatShading===r.flatShading&&i.side===r.side&&i.wireframe===r.wireframe}e.equals=t})(lL||(lL={}));var uL;(e=>e.defaultData={...lL.defaultData,...oL.defaultData})(uL||(uL={}));var o6;(e=>{function t(i,r){let n=[];if("material"in i){let s=typeof i.material=="string"?r.materials[i.material]??r.lib.materials[i.material]?.asset:i.material;s&&n.push(s)}else if("materials"in i)for(let s of i.materials){let a=typeof s=="string"?r.materials[s]??r.lib.materials[s]?.asset:s;a&&n.push(a)}return n}e.getMaterialData=t})(o6||(o6={}));var z2;(e=>(e.defaultVideo={data:"",thumb:"/_assets/_videos/catThumb.png",type:"video",name:"Cat video"},e.maxSize=3e7))(z2||(z2={}));var l6;(e=>{function t(i){return i==="texture"||i==="video"||i==="color"||i==="depth"||i==="normal"||i==="gradient"||i==="noise"||i==="fresnel"||i==="rainbow"||i==="toon"||i==="outline"||i==="particle"||i==="transmission"||i==="matcap"||i==="displace"||i==="pattern"||i==="light"}e.is=t})(l6||(l6={}));function DEe(e){return e.type!=="displace"}var u6;(e=>{function t(i){return i==="phong"||i==="toon"||i==="lambert"||i==="physical"}e.is=t})(u6||(u6={}));var sY=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],REe=["wrapping","image","video","name","minFilter","magFilter"],Jn;(e=>{function t(a,o){let{texture:l,...u}=o;if(Object.assign(a,u),l){let c=a.texture;c&&Object.assign(c,l)}}e.patch=t;function i(a){return{...e.defaultData("color"),color:a}}e.defaultColorLayer=i;function r(a,o){return a==="light"&&o?n(o):s(a)}e.defaultData=r;function n(a){let o={mode:0,isMask:!1,visible:!0,bumpMap:void 0,bumpMapIntensity:5,roughnessMap:void 0,alphaOverride:1};switch(a){case"phong":return{...o,category:"phong",specular:{r:.2,g:.2,b:.2},shininess:5,type:"light",visible:!0,mode:0,occlusion:!0,alpha:.6};case"toon":return{...o,category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1};case"lambert":return{...o,category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0,occlusion:!0};case"physical":return{...o,category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0,occlusion:!0}}}function s(a){let o={alpha:1,mode:0,isMask:!1,visible:!0};switch(a){case"texture":return{...o,type:"texture",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{image:"image_0",wrapping:1e3,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1};case"video":return{...o,type:"video",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{video:z2.defaultVideo,wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1};case"color":return{...o,type:"color",color:es.fromHex(fl)};case"depth":return{...o,type:"depth",gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200};case"normal":return{...o,type:"normal",cnormal:[1,1,1]};case"gradient":return{...o,type:"gradient",gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{...o,type:"noise",size:[100,100,100],noiseType:0,scale:1,move:1,colorA:{...es.fromHex(6710886),a:1},colorB:{...es.fromHex(6710886),a:1},colorC:{...es.fromHex(16777215),a:1},colorD:{...es.fromHex(16777215),a:1},distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8],voronoiStyle:0,highCut:1,lowCut:0,smoothness:.3,seed:0,quality:1};case"fresnel":return{...o,type:"fresnel",color:mr.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{...o,type:"rainbow",filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"toon":return{...o,type:"toon",positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:mr.fromHexAndA(0,0),offset:[0,0,0]};case"outline":return{...o,type:"outline",outlineColor:mr.fromHexAndA(0,1),contourColor:mr.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0};case"matcap":return{...o,type:"matcap",texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006}};case"transmission":return{...o,type:"transmission",thickness:10,ior:1.5,roughness:1};case"displace":return{visible:!0,type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,voronoiStyle:0,smoothness:.3,seed:0,highCut:1,lowCut:0,quality:1};case"pattern":return{...o,type:"pattern",style:0,projection:0,axis:"y",blending:0,offset:[0,0],colorA:{...es.fromHex(0),a:1},colorB:{...es.fromHex(16777215),a:1},frequency:[10,10],size:.5,variation:0,smoothness:.5,zigzag:0,rotation:0,vertical:[0,1],horizontal:[0,1],sides:6}}}})(Jn||(Jn={}));var Vs;(e=>{function t(h){return!h.layers.some(d=>d.data.type==="texture"&&d.data.projection!==0||d.data.type==="depth"&&!d.data.isWorldSpace||d.data.type==="noise"||d.data.type==="displace")}e.isMergable=t;function i(h){let d="";return h.layers.forEach(p=>{Object.entries(p.data).forEach(([m,v])=>{d+=`${m}${v}`,Array.isArray(v)?v.forEach(g=>d+=`${g}`):typeof v=="object"?Object.values(v).forEach(g=>{typeof g=="number"?d+=`${g.toFixed(4)}`:d+=`${g}`}):d+=`${v}`})}),d}e.getHash=i;function r(){return{layers:new Xt}}e.defaultEmptyData=r;function n(h="layer1",d="layer2"){return a("phong",h,d)}e.defaultData=n;function s(h,d){return{...h,name:d}}e.withName=s;function a(h,d="layer1",p="layer2",m=es.fromHex(16777215)){let v=new Xt;return v.push({fi:0,data:Jn.defaultData("light",h),id:d}),v.push({fi:1,data:Jn.defaultData("color"),id:p}),{layers:v}}e.defaultTwoLayerData=a;function o(h,d,p="layer1",m="layer2"){let v=new Xt;return v.push({fi:0,data:Jn.defaultData("light",d),id:p}),v.push({fi:1,data:Jn.defaultColorLayer(h),id:m}),{layers:v}}e.defaultColorMaterial=o;function l(h){let d=Jn.defaultData("texture");h&&Object.assign(d.texture,{image:h});let p=new Xt;return p.push({fi:0,data:d,id:"layer1"}),p.push({fi:1,data:{...Jn.defaultData("transmission"),alpha:1},id:"layer2"}),p.push({fi:2,data:{...Jn.defaultData("light","lambert"),alpha:0},id:"layer3"}),{layers:p}}e.defaultUIObjectMaterial=l;function u(h,d="phong",p="layer1",m="layer2"){let v=Jn.defaultData("texture");Object.assign(v.texture,{image:h});let g=new Xt;return g.push({fi:0,data:v,id:p}),g.push({fi:1,data:Jn.defaultData("light",d),id:m}),{layers:g}}e.defaultTwoLayerTextureData=u;function c(h,d="phong",p="layer1",m="layer2"){let v=Jn.defaultData("video");Object.assign(v.texture,{video:h});let g=new Xt;return g.push({fi:0,data:v,id:p}),g.push({fi:1,data:Jn.defaultData("light",d),id:m}),{layers:g}}e.defaultTwoLayerVideoTextureData=c})(Vs||(Vs={}));var k2;(e=>{function t(){return{points:new Xt,roundness:0,shapeHoles:[],isClosed:!1}}e.defaultData=t})(k2||(k2={}));var B2;(e=>{function t(){return{points:new Xt,lastInsertionPlane:null,subdivisions:12,isClosed:!1}}e.defaultData=t})(B2||(B2={}));var aY={type:"Ellipse",width:50,height:50,spikes:16,angle:360,innerRadius:0},cL;(e=>{function t(i,r){let n={...i};return Vk.forEach(s=>{Object.assign(n,{[s]:r[s]??i[s]})}),n}e.merge=t})(cL||(cL={}));var oY={shape:aY,depth:1,offset:0,bevel:50,bevelSides:6,angle:0,twist:0,startScale:1,endScale:1,capType:"flat"},Vk=["depth","offset","angle","twist","startScale","endScale"],N2;(e=>{function t(n){return n==="PolygonGeometry"||n==="RectangleGeometry"||n==="StarGeometry"||n==="TriangleGeometry"||n==="EllipseGeometry"||n==="UIGeometry"}e.is2DParametricMesh=t;function i(n){return n==="PolygonGeometry"||n==="RectangleGeometry"||n==="StarGeometry"||n==="TriangleGeometry"||n==="EllipseGeometry"||n==="PathGeometry"||n==="VectorGeometry"||n==="ConeGeometry"||n==="CubeGeometry"||n==="CylinderGeometry"||n==="DodecahedronGeometry"||n==="HelixGeometry"||n==="IcosahedronGeometry"||n==="LatheGeometry"||n==="PyramidGeometry"||n==="SphereGeometry"||n==="PlaneGeometry"||n==="BackdropGeometry"||n==="TorusGeometry"||n==="TorusKnotGeometry"||n==="BooleanGeometry"||n==="TextGeometry"||n==="InputGeometry"}e.isParametricMesh=i;function r(n){return n==="PolygonGeometry"||n==="RectangleGeometry"||n==="StarGeometry"||n==="TriangleGeometry"||n==="EllipseGeometry"||n==="PathGeometry"||n==="VectorGeometry"||n==="ConeGeometry"||n==="CubeGeometry"||n==="CylinderGeometry"||n==="DodecahedronGeometry"||n==="HelixGeometry"||n==="IcosahedronGeometry"||n==="LatheGeometry"||n==="PyramidGeometry"||n==="SphereGeometry"||n==="PlaneGeometry"||n==="BackdropGeometry"||n==="TorusGeometry"||n==="TorusKnotGeometry"||n==="TextGeometry"||n==="SubdivGeometry"||n==="NonParametricGeometry"}e.isSwappableGeometry=r})(N2||(N2={}));var hL;(e=>{function t(i,r){let n={...i};return Object.assign(n,r),n.type==="PathGeometry"&&"extrusion"in r&&r.extrusion&&(n.extrusion={...i.extrusion},Object.assign(n.extrusion,cL.merge(n.extrusion,r.extrusion))),n}e.merge=t})(hL||(hL={}));var $f;(e=>{function t(i){if(i==="RectangleGeometry")return{width:320,height:320,type:i,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="UIGeometry")return{type:i,frame:"",cornerRadius:[0,0,0,0],cornerType:0,width:1,height:1};if(i==="PathGeometry")return{type:i,width:1,height:1,depth:1,path:B2.defaultData(),extrusion:oY};if(i==="VectorGeometry")return{width:1,height:1,type:i,subdivisions:12,shape:k2.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="BooleanGeometry")return{type:i,operation:2,width:0,height:0,depth:0,phongAngle:35};if(i==="ShapeBlendGeometry")return{type:i,width:0,height:0,depth:0,resolutionLevel:6,blendRange:100,useChildrenColors:!1};if(i==="TextGeometry")return{type:i,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:{textValue:""},textTransform:1,font:"Roboto_regular",editable:!1,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="InputGeometry")return{...e.defaultData("TextGeometry"),type:i,editable:!0};if(i==="SphereGeometry")return{type:"SphereGeometry",width:100,height:100,depth:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180};throw new Error("not implemented")}e.defaultData=t})($f||($f={}));var J3=["width","height","depth"],dL;(e=>e.defaultData={enabled:!1,useBackgroundColor:!1,color:es.white,near:.1,far:2e3})(dL||(dL={}));var F2;(e=>{let t={opacity:1,blendFunction:13,enabled:!1};e.defaultData={enabled:!1,pixelation:{...t,blendFunction:16,granularity:15},bloom:{...t,blendFunction:16,intensity:1,blurScale:1,luminanceThreshold:.25,luminanceSmoothing:.025,kernelSize:3},chromaticAberration:{...t,offset:[2,2]},vignette:{...t,darkness:1,offset:0},hueSaturation:{...t,hue:3,saturation:0},brightnessContrast:{...t,brightness:.25,contrast:0},depthOfField:{...t,focusDistance:100,focalLength:20,bokehScale:5},noise:{...t,blendFunction:16}}})(F2||(F2={}));var fL;(e=>e.defaultData={softShadowQuality:"low"})(fL||(fL={}));var pL;(e=>e.defaultData={enabled:!0,color:{r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},intensity:.75})(pL||(pL={}));var mL;(e=>e.defaultData={occlusion:!1,aoFullRes:!1,radius:256,bias:.5,aoColor:{r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}})(mL||(mL={}));var px;(e=>e.defaultData={usePhysics:!1,gravity:-10})(px||(px={}));var gL;(e=>e.defaultData={playCamera:Xx,gameControlObject:null})(gL||(gL={}));var vL;(e=>e.defaultData={backgroundColor:mr.fromHexAndA(TEe,1),postprocessing:F2.defaultData,fog:dL.defaultData,globalPhysics:px.defaultData,ambient:pL.defaultData,ao:mL.defaultData,shadow:fL.defaultData,publish:gL.defaultData})(vL||(vL={}));var yL;(e=>e.defaultData={colliderType:"box",size:[100,100,100],colliderHelperVisible:!0,forceType:"collider",forceRange:"global",forceIntensity:.5,forceDambing:.95})(yL||(yL={}));var c6;(e=>{function t(r){return r==="Component"||r==="Instance"}e.isComponentRelated=t;function i(r){return r==="Empty"||r==="Instance"}e.isEmptyOrComponent=i})(c6||(c6={}));var mx;(e=>{e.identity={...rL.identity,hiddenMatrix:hx.identity};function t(n){return{position:n.position,rotation:n.rotation,scale:n.scale,hiddenMatrix:n.hiddenMatrix}}e.fromObject=t;function i(n,s){return{position:s?.position||n.position,rotation:s?.rotation||n.rotation,scale:s?.scale||n.scale,hiddenMatrix:s?.hiddenMatrix||n.hiddenMatrix}}e.merge=i;function r(n,s){return PX({position:Sp.isEqual(n.position,s.position)?void 0:s.position,rotation:Sp.isEqual(n.rotation,s.rotation)?void 0:s.rotation,scale:Sp.isEqual(n.scale,s.scale)?null:s.scale,hiddenMatrix:hx.isEqual(n.hiddenMatrix,s.hiddenMatrix)?void 0:s.hiddenMatrix})}e.diff=r})(mx||(mx={}));var IEe=["slide","offset"],_s;(e=>e.defaultData={states:new Xt,events:new Xt,timelineAnimations:new ii,visible:!0,raycastLock:!1,physics:fx.defaultData,pathSnapping:{pathId:null,slide:0,offset:0,orientation:"tangential"},...mx.identity,cloner:null})(_s||(_s={}));var xL;(e=>e.defaultData={type:"Empty",..._s.defaultData})(xL||(xL={}));var h6;(e=>e.defaultData={type:"ParticleCollider",...yL.defaultData,..._s.defaultData})(h6||(h6={}));var d6;(e=>e.defaultData={type:"Component",..._s.defaultData})(d6||(d6={}));var f6;(e=>e.defaultData={type:"Particle",..._s.defaultData,...O2.defaultData})(f6||(f6={}));var ep;(e=>e.defaultData={type:"Mesh",..._s.defaultData,...uL.defaultData})(ep||(ep={}));var i_;(e=>e.defaultData={..._s.defaultData,...mx.identity,position:[0,0,dx.DefaultTargetOffset],...dx.defaultData})(i_||(i_={}));var wL;(e=>{function t(i){return{..._s.defaultData,...aL.defaultData(i)}}e.defaultData=t,e.defaultDirectionalLightData={...e.defaultData("DirectionalLight"),position:[200,300,300],name:"Directional Light",intensity:.7}})(wL||(wL={}));var U2;(e=>{function t(r,n,s=0){for(;s<n.length;){let a=r?r[n[s]]:void 0;if(n.length===s+1)return a;if(a)r=a.descendants,s+=1;else return}}e.resolveWithDes=t;function i(r,n,s=0){let a=t(r,n,s);if(a){let o=Object.keys(a);if(o.length===1&&o[0]==="descendants")return}return a}e.resolve=i})(U2||(U2={}));var dp;(e=>{e.rootOverrideProps=["physics","events"],e.compositeNonOptionalOverrideProps=["geometry"],e.compositeEntireOverrideOverrideProps=["material"];function t(r,n){return{..._s.defaultData,...n,component:r,overrides:new Sn,physics:void 0,events:void 0,type:"Instance"}}e.ofComponent=t;function i(r){let n=mx.fromObject(r.data);return t(r.id,n)}e.fromComponentData=i})(dp||(dp={}));var gx;(e=>{e.defaultData={type:"Page",..._s.defaultData,physics:{...fx.defaultData,fusedBody:!1},...vL.defaultData,camera:i_.defaultData};function t(i){return i.uiScene!==void 0}e.isUIPage=t})(gx||(gx={}));var bL;(e=>(e.defaultCamera={position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:hx.identity,name:"Play Camera",visible:!0,raycastLock:!1,physics:fx.defaultData,states:new Xt,events:new Xt,timelineAnimations:new ii,cloner:null,pathSnapping:{pathId:null,orientation:"tangential",slide:0,offset:0},...dx.defaultData},e.KeysByResetCategory={States:["states"],Events:["events"],Material:["material","materials"],Geometry:["geometry"],Position:["position"],Rotation:["rotation"],Scale:["scale"],Transform:["position","scale","rotation","hiddenMatrix"],Name:["name"],Visibility:["visible","raycastLock","flatShading","wireframe","side"],Shadows:["castShadow","receiveShadow"],Cloner:["cloner"],Physics:["physics"]},e.defaultMeshObject={name:"Rectangle",..._s.defaultData,...ep.defaultData,geometry:$f.defaultData("RectangleGeometry"),material:Vs.defaultTwoLayerData("phong","layer1","layer2")},e.defaultBooleanObject={name:"Boolean",..._s.defaultData,...ep.defaultData,geometry:$f.defaultData("BooleanGeometry"),material:Vs.defaultTwoLayerData("phong","layer1","layer2")},e.defaultShapeBlendObject={name:"Shape Blend",..._s.defaultData,...ep.defaultData,geometry:$f.defaultData("ShapeBlendGeometry"),material:Vs.defaultTwoLayerData("phong","layer1","layer2")},e.defaultTextObject={name:"Text",..._s.defaultData,...ep.defaultData,geometry:$f.defaultData("TextGeometry"),material:Vs.defaultTwoLayerData("phong","layer1","layer2")},e.defaultInputObject={name:"Input",..._s.defaultData,...ep.defaultData,geometry:$f.defaultData("InputGeometry"),material:Vs.defaultTwoLayerData("phong","layer1","layer2")}))(bL||(bL={}));var fp;(e=>{function t(s,a){let o={name:a};return s.type==="Mesh"?(o.geometry={},"material"in s&&(o.material={layers:new Sn}),"materials"in s&&(o.materials=s.materials.map(l=>({layers:new Sn})))):Xg.is(s.type)&&(o.perspective={},o.orthographic={}),o}e.newEmpty=t;function i(s,a){if(a===void 0)return s;let o={...s};return"material"in o&&"material"in a&&a.material&&(o.material=e_(o.material,l=>{if(typeof l!="string")for(let[u,c]of Object.entries(a.material.layers)){let h=l.layers.data(u);h&&Jn.patch(h,c)}}).data),o.materials&&a.materials&&(o.materials=e_(o.materials,l=>{for(let u=0;u<o.materials.length;u++){let c=a.materials[u];if(typeof c!="string")for(let[h,d]of Object.entries(c.layers)){let p=l[u]?.layers?.data(h);p&&Jn.patch(p,d)}}}).data),o}function r(s,a){let o,l=[],u={orthographic:0,perspective:0,geometry:0};function c(h,d){for(let[p,m]of Object.entries(d.layers)){let{texture:v,...g}=m;if(v!==void 0&&Object.keys(v).length>0){let w={path:[...h,"layers",p,"texture"],props:v,type:0};l.push(w)}if(Object.keys(g).length>0){let w={path:[...h,"layers",p],props:g,type:0};l.push(w)}}}for(let[h,d]of Object.entries(a))if(h!=="name")if(h==="cloner")l.push(...nL.toOps(d,["cloner"]));else if(h==="pathSnapping")l.push({path:[h],props:{slide:d.slide,offset:d.offset},type:0});else if(h==="material")c(["material"],d);else if(h==="materials")for(let[p,m]of Object.entries(d))c(["materials",p],m);else if(u[h]===0){if(h==="geometry"&&d.extrusion!==void 0){let p={path:[h,"extrusion"],props:d.extrusion,type:0};l.push(p),d={...d},delete d.extrusion}if(Object.keys(d).length>0){let p={path:[h],props:d,type:0};l.push(p)}}else o===void 0&&(o={path:[],props:{},type:0},l.push(o)),o.props[h]=d;return l}e.toOps=r;function n(s,a){if(a===void 0)return s;let o={...s};if(Object.assign(o,mx.merge(o,a)),Object.assign(o,{pathSnapping:Object.assign({},o.pathSnapping,{slide:a.pathSnapping?.slide??o.pathSnapping?.slide??0,offset:a.pathSnapping?.offset??o.pathSnapping?.offset??0})}),Xg.is(s.type)){o.orthographic={...o.orthographic},o.perspective={...o.perspective};let l=a;l.orthographic?.zoom!==void 0&&(o.orthographic.zoom=l.orthographic.zoom),l.perspective?.zoom!==void 0&&(o.perspective.zoom=l.perspective.zoom),l.isUpVectorFlipped!==void 0&&(o.isUpVectorFlipped=l.isUpVectorFlipped),l.targetOffset!==void 0&&(o.targetOffset=l.targetOffset)}else if(s.type==="Mesh")"geometry"in a&&Object.assign(o,{geometry:hL.merge(o.geometry,a.geometry)}),(a.material||a.materials)&&(o=i(o,a)),o.cloner&&"cloner"in a&&Object.assign(o,{cloner:hp.merge(o.cloner,a.cloner)});else if(s.type==="Empty")o.cloner&&"cloner"in a&&Object.assign(o,{cloner:hp.merge(o.cloner,a.cloner)});else if(sL.is(s.type)){let l=a;l.intensity!==void 0&&(o.intensity=l.intensity),l.color!==void 0&&(typeof l.color=="string"?o.color=l.color:o.color=es.clone(l.color))}return o}e.patch=n})(fp||(fp={}));var V2;(e=>e.defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,hoverRotateDamping:.125,isTouchZoom:!0,orbitTouches:2,panTouches:3,resetHoverEffectOnPointerLeave:!0})(V2||(V2={}));var xd;(e=>e.defaultData={orbitControls:V2.defaultData,playPage:ob,withBackground:!0,preventScroll:!1,preventTouchScroll:!1,hideCursor:!1,mouseEventTarget:"canvas",joystickSizeAndXYOffset:Array(12).fill(0).map((t,i)=>{let r=0,n=0;return i<5?n=-30:i<10&&(n=30),i===0||i===10||i===5?r=30:(i===4||i===11||i===9)&&(r=-30),[120,[r,n],"show"]}),settings:{image:{format:"jpg",ratio:1,colorSpace:"display-p3"},videoStatic:{fps:60,mbps:150,ratio:1,duration:1e3,format:"mp4",imageFormat:"jpg",activeTimeline:null,colorSpace:"display-p3"},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:Math.max(1,typeof window<"u"?Math.floor(window.devicePixelRatio):1),stopMode:"manual",duration:5e3},web:{logo:!0,compress:!0,preset:1,preload:!0,hint:!1,imageQuality:70,pixelRatioMobile:0,pixelRatioDesktop:0}},stopRaycast:!0,hdTransmission:!1})(xd||(xd={}));var _L;(e=>e.defaultData={id:"basic",label:"Basic",style:"None",prompt:""})(_L||(_L={}));var SL;(e=>e.defaultData={weather:0,shadows:0,lightOrigin:0,temperature:0,sun:0,camera:0,environment:0,particles:0,nature:0,floor:0})(SL||(SL={}));var gg;(e=>(e.defaultData=()=>({mode:"line-art-both",prompt:"",negativePrompt:"",style:{..._L.defaultData},isRandomSeed:!0,seed:e.generateSeed(),guessMode:!1,advanced:!1,steps:20,guidanceScale:7.5,controlNetScale:1,modifiers:SL.defaultData}),e.generateSeed=()=>Math.round(Math.random()*1e5)))(gg||(gg={}));var r_;(e=>{function t(r){return r.find(n=>n.data.type==="Page"&&n.data.globalPhysics.usePhysics)!==void 0}e.physicsEnabled=t;function i(r,n,s){r.scene.objects.traverseFrom(n,(a,o)=>{if(o.type==="Instance"){let l=vx.getComponentData(r,o.component)?.data;l&&s(a,o,l.events)}else s(a,o,o.events)})}e.traverseModuleInstances=i})(r_||(r_={}));var vg;(e=>{e.TRASH_CAN_ID="830a2708-8ed9-49cf-a68e-085299892222",e.defaultLight={fi:-1,data:wL.defaultDirectionalLightData,id:"830a2708-8ed9-49cf-a68e-085299899103",children:[]};function t(n=!0,s=[]){let a=[],o=bL.defaultMeshObject;n&&(a.push({...e.defaultLight}),a.push({fi:1,id:"7ba78968-2a55-48f2-b14c-5191da3e075e",data:o,children:[]})),a.push(...s);let l=new ga;return l.push({fi:1,id:ob,data:{...gx.defaultData,name:"Scene 1"},children:a}),l}e.createDefaultObjectTreeWithPage=t,e.defaultData={objects:t(),publish:xd.defaultData,styles:gg.defaultData()},e.emptyDataWithoutPage=function(){return{objects:new ga,publish:xd.defaultData,styles:gg.defaultData()}},e.emptyDataWithPage=function(n=!0){return{objects:t(n),publish:xd.defaultData,styles:gg.defaultData()}},e.emptyData=function(){return{objects:new ga,publish:{...xd.defaultData},styles:gg.defaultData()}};function i(n){return{...e.defaultData,objects:Go(n,ga.prototype)}}e.withObjs=i;function r(n,s){return i([{id:n,data:s,children:[],fi:0}])}e.withObj=r})(vg||(vg={}));var lb;(e=>e.defaultData={preset:"fullscreen",allowResponsive:!1,size:[512,512],coords:[0,0],sceneScale:1,color:{r:0,g:0,b:0,a:.5}})(lb||(lb={}));var ML;(e=>(e.defaultData=t=>({url:t,name:"New Webhook",parametersSchemas:new Xt}),e.defaultParameterValueByType=t=>t==="number"?0:t==="boolean"?!1:""))(ML||(ML={}));var p6;(e=>e.defaultData=(t,i="GET")=>({url:t,method:i,name:"New API",headers:new Xt,queries:new Xt,autoStart:!0}))(p6||(p6={}));var va;(e=>{function t(a){return a.textValue!==void 0}e.isTextValue=t;function i(a){return typeof a=="number"}e.isNumber=i;function r(a){return typeof a=="boolean"}e.isBoolean=r;function n(a){return t(a)?"string":r(a)?"boolean":"number"}e.typeOfVariable=n;function s(a){return e.isTextValue(a)?Array.isArray(a.textValue)?a.textValue.map(o=>o.toString().padStart(a.padding??2,"0")).join(a.deliminator??":")+(a.suffix!==void 0?" "+a.suffix:""):a.textValue.toString():e.isBoolean(a)?a?"True":"False":e.isNumber(a)?parseFloat(a.toFixed(3)).toString():a.toString()}e.getDisplayedValue=s})(va||(va={}));var AL;(e=>e.all=["images","videos","colors","audios","particles","fonts","materials","variables"])(AL||(AL={}));var m6;(e=>e.all=[...AL.all,"components"])(m6||(m6={}));var g6;(e=>{function t(){return{images:new ii,videos:new ii,colors:new ii,audios:new ii,particles:new ii,fonts:new ii,materials:new ii,components:new ii,variables:new ii,userAPIs:new ii,userWebhooks:new ii,timelineAnimations:new ii}}e.defaultData=t})(g6||(g6={}));var Id;(e=>{function t(){return{images:new ii,videos:new ii,colors:new ii,audios:new ii,particles:new ii,fonts:new ii,materials:new ii,components:new ii,variables:new ii,userAPIs:new ii,userWebhooks:new ii,timelineAnimations:new ii}}e.defaultData=t})(Id||(Id={}));var Nl;(e=>{function t(){let a={};return a["89b10010-844c-11ec-a8a3-0242ac120002"]={r:.5,g:.5,b:.5,a:1,name:"Default Color"},Go(a,ii.prototype)}e.defaultColors=t;function i(){return Go({},ii.prototype)}e.defaultImages=i;function r(){return{catelogs:new ii,materials:new ii,images:new ii,videos:new ii,colors:new ii,timelineAnimations:new ii,audios:new ii,particles:new ii,fonts:new ii,variables:new Xt,userAPIs:new ii,userWebhooks:new ii,lib:Id.defaultData()}}e.emptyData=r;function n(a){switch(a){case"number":return{value:0,name:"Number"};case"boolean":return{value:!1,name:"Boolean"};case"string":return{value:{textValue:"String value"},name:"String"};case"time":let o=[0,0,0];return{name:"Time",value:{textValue:o,deliminator:":",padding:2,suffix:"AM"},dynamicVariableType:"time",format:"HH:mm:ss",format12h24h:"12ampm",timeZone:null,hasEnd:!1,endValue:{textValue:o,deliminator:":",padding:2,suffix:"AM"},autoStart:!0,repeat:!1};case"counter":return{name:"Counter",value:0,dynamicVariableType:"counter",updateInterval:1e3,increment:1,autoStart:!0,hasEnd:!0,endValue:60,repeat:!0,randomStart:!1,range:[0,100],decimals:0};case"random":return{name:"Random",value:0,dynamicVariableType:"random",updateInterval:1e3,increment:1,autoStart:!0,isStatic:!1,hasEnd:!0,endValue:60,repeat:!0,min:0,max:100,decimals:0};default:console.error("Unknown variable type",a)}}e.defaultVariables=n;function s(a,o){if(o.format==="HH:mm:ss"){let l=Math.floor(a/3600),u=Math.floor((a-l*3600)/60),c=Math.round(a-l*3600-u*60);return{textValue:[l,u,c]}}else if(o.format==="mm:ss"){let l=Math.floor(a/60),u=Math.round(a-l*60);return{textValue:[l,u]}}else return o.format==="number"?a=Math.round(a):a=Math.round(a*1e3)/1e3,a}e.getFormattedTimerTime=s})(Nl||(Nl={}));var j2;(e=>e.list=["idle","move","jump","run"])(j2||(j2={}));var H2;(e=>(e.defaultColliderData={type:"capsule",height:200,radius:50,position:[0,0,0],rotation:[0,0,0]},e.defaultDataThirdPerson={moveMode:"walk",forwardDirection:"+z",speedTranslate:1e3,speedRotate:100,runMultiplier:2,rotationMode:"normal",rotBy:"keys",rotByTouch:"drag",delayPos:[.3,.3],delayRot:[.3,.3],keyAssignments:[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX",""],["rotPosY",""],["rotNegX",""],["rotNegY",""],["jump","Space"],["run",""],["none","Ctrl"]],touchControl:!0,joystickPosLoc:5,joystickRotLoc:11,jumpTouchButtonLoc:9,collider:e.defaultColliderData,colliderHelperVisible:!0,collisionEnabled:!0,jumpPower:100,resetYPosition:3e3,alignToGround:!1,autoOrientMove:!0,orientWith:"camera",orientMode:"radial",delayPosCamera:.3,delayRotCamera:.3,camera:"",cameraXAxis:"Limit",cameraYAxis:"Free",cameraRotXLimits:[0,Math.PI/2],cameraRotYLimits:[-Math.PI/2,Math.PI/2],gameActions:{idle:new Xt,move:new Xt,jump:new Xt,run:new Xt},navmesh:{enabled:!1,ch:6,cs:6,walkableClimb:5,walkableHeight:1,walkableRadius:0,zones:"all",objects:[],helperVisible:!0,destinationHelperRadius:0,destinationHelperColor:mr.fromHexAndA(3728051,1)}}))(H2||(H2={}));function v6(e){e.layers.forEach(t=>{if(t.type==="depth"&&t.colorA!==void 0){let i=t.colorA,r=t.colorB,n=[[i.r,i.g,i.b,i.a],[r.r,r.g,r.b,r.a]],s=[0,1];for(let o=2;o<10;o++)n.push(n[1]),s.push(1);let a={...Gc(Bn(t),"type","visible","isVector","isWorldSpace","origin","alpha","mode"),near:Math.max(0,t.near),far:Math.max(0,t.far),colors:n,steps:s,num:2,direction:[1,0,0],smooth:!1,gradientType:1};Object.assign(t,a)}else if(t.type==="depth"&&t.gradientType===1&&(t.near<0||t.far<0)){let i={...Bn(t),near:Math.max(t.near,0),far:Math.max(t.far,0)};Object.assign(t,i)}})}function tp(e,t){Object.values(e.shared.materials).forEach(i=>t(i))}function ip(e,t){e.scene.objects.traverse((i,r)=>{"materials"in r?r.materials.forEach((n,s)=>{n===void 0&&(r.materials[s]=Vs.defaultData(),n=r.materials[s]),typeof n!="string"&&t(n)}):"material"in r?typeof r.material!="string"&&(r.material===void 0&&(r.material=Vs.defaultData()),t(r.material)):r.type==="Mesh"&&(r.material===void 0&&(r.material=Vs.defaultData()),t(r.material)),"overrides"in r&&Object.values(r.overrides).forEach(n=>{n.material&&typeof n.material!="string"&&Object.getPrototypeOf(n.material)!==Sn.prototype&&t(n.material)})})}function LEe(e){Object.assign(e.scene.publish,{orbitControls:{...V2.defaultData,...Bn(e.scene.publish.orbitControls)}})}function OEe(e){Object.assign(e.scene.publish.settings,{video:{...xd.defaultData.settings.video,...Bn(e.scene.publish.settings.video)}})}function zEe(e){function t(i){if(i.layers){for(let r of Object.values(i.layers))if(r){for(let[n,s]of Object.entries(r))if((sY.includes(n)||typeof s=="boolean")&&delete r[n],n==="texture")for(let[a,o]of Object.entries(s))(REe.includes(a)||typeof o=="boolean")&&delete s[a]}}}e.scene.objects.traverse((i,r)=>{r.states.forEach(n=>{let s=n;s.material?t(s.material):s.materials&&s.materials.forEach(a=>{t(a)})})})}function kEe(e){e.scene.publish.withBackground=!0}function BEe(e){e.scene.publish.settings.web={compress:!0,preload:!0,preset:1,logo:!0,hint:!1}}function NEe(e){e.scene.objects.traverse((t,i)=>{let r=i.cloner;r&&(r.radial.scale=r.radial.scale.map(n=>n+1),r.linear.scale=r.linear.scale.map(n=>n+1))})}function FEe(e){e.scene.objects.traverse((t,i)=>{let r=i.geometry;r&&(r.type==="DodecahedronGeometry"||r.type==="IcosahedronGeometry")&&(r.detail=Math.round(r.detail))})}function UEe(e){e.scene.objects.traverse((t,i)=>{let r=e.scene.objects.unproxy().parent(t);if(r){let n=Bn(e.scene.objects.data(r));n&&n.type==="Mesh"&&n.geometry.type==="BooleanGeometry"&&i.type==="Mesh"&&(i.visible=Bn(i).booleanExclude!==!0)}})}function VEe(e){e.scene.objects.traverse((t,i)=>{if(i.type==="Mesh"){let r=i;i.geometry.type==="NonParametricGeometry"?r.material!==void 0&&delete r.material:r.materials!==void 0&&delete r.materials}})}function jEe(e){function t(r){Object.setPrototypeOf(r,Sn.prototype),r.texture&&Object.setPrototypeOf(r.texture,Sn.prototype)}function i(r){Object.setPrototypeOf(r,Sn.prototype);for(let n in r)t(r[n])}e.scene.objects.traverse((r,n)=>{n.states.forEach(s=>{let a=s;if(a.material){let o=Bn(a.material).layers;i(o),a.material.layers=o}if(a.materials)for(let o=0;o<a.materials.length;o++){let l=a.materials[o],u=Bn(l).layers;i(u),l.layers=u}})})}function y6(e){e.layers===void 0&&Object.assign(e,Vs.defaultTwoLayerData("lambert"))}function $3(e){!e.layers||e.layers.forEach(t=>{if(t.type==="depth"&&t.colors.length===10){let i=[...t.colors];i.push(t.colors[9]);let r=[...t.steps];r.push(t.steps[9]);let n={...Bn(t),colors:i,steps:r};Object.assign(t,n)}})}function HEe(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&(i.geometry.type==="BooleanGeometry"||i.geometry.type==="SubdivGeometry")&&(i.geometry.phongAngle=35)})}function x6(e){e.scene.objects.traverse((t,i)=>{"materials"in i?i.materials.forEach(r=>{typeof r!="string"&&$3(r)}):"material"in i&&typeof i.material!="string"&&$3(i.material)}),Object.values(e.shared.materials).forEach(t=>$3(t))}function WEe(e){e.scene.environment.ambientLight.softShadows=!1,e.scene.environment.ambientLight.softShadowQuality="low",e.scene.objects.traverse((t,i)=>{(i.type==="DirectionalLight"||i.type==="SpotLight")&&(i.shadowResolution=1024,i.shadowRadius=1,i.depth=1e5)}),e.shared.penumbraSize=new Array(5).fill(.5)}function GEe(e){e.shared.audios=Go({},ii.prototype)}function qEe(e){e.shared.videos=Go({},ii.prototype)}function XEe(e){let t=e.shared.materials;Object.entries(t).forEach(([i,r])=>{if(!r.layers){let n={name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"phong",alpha:.6,visible:!0,mode:0,specular:{r:.2,g:.2,b:.2},shininess:5},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]};Object.assign(t,{[i]:n})}})}function YEe(e){Object.entries(Bn(e.shared.images)).filter(t=>t[1].asset===!1).map(t=>t[0]).forEach(t=>{delete e.shared.images[t]}),Object.entries(Bn(e.shared.audios)).filter(t=>t[1].asset===!1).map(t=>t[0]).forEach(t=>{delete e.shared.audios[t]})}function QEe(e){e.scene.publish.settings.web.preload=!1}function w6(e){e.layers&&e.layers.forEach(t=>{t.type==="depth"&&t.num!==void 0&&(t.colors=t.colors.slice(0,t.num),t.steps=t.steps.slice(0,t.num),delete t.num)})}function b6(e){e.layers&&e.layers.forEach(t=>{DEe(t)&&t.isMask===void 0&&(t.isMask=!1),(t.type==="texture"||t.type==="video")&&t.blending===void 0&&(t.blending=0),(t.type==="noise"||t.type==="displace"&&t.displacementType==="noise")&&(t.voronoiStyle===void 0&&(t.voronoiStyle=0),t.highCut===void 0&&(t.highCut=1),t.lowCut===void 0&&(t.lowCut=0),t.smoothness===void 0&&(t.smoothness=.3),t.seed===void 0&&(t.seed=0),t.quality===void 0&&(t.quality=1))})}function KEe(e){e.shared.fonts=Go({},ii.prototype)}function ZEe(e){return e.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function JEe(e){let t=[];e.scene.objects.traverse((i,r)=>{let n=r;if(n.type==="TextFrame"){let s=Vs.defaultTwoLayerData("phong"),a=typeof n.color=="string"?e.shared.colors[n.color]:n.color;s.layers[1].data.color={r:a.r,g:a.g,b:a.b},s.layers[1].data.alpha=n.alpha;let o=ZEe(n.font);e.shared.fonts[o]===void 0&&(e.shared.fonts[o]={name:o});let l={name:n.name,..._s.defaultData,...ep.defaultData,flatShading:!1,wireframe:!1,geometry:{...$f.defaultData("TextGeometry"),width:n.width,height:n.height,font:o,depth:0,horizontalAlign:n.horizontalAlign,verticalAlign:n.verticalAlign,fontSize:n.fontSize*1.40625,lineHeight:n.lineHeight/1.40625,letterSpacing:n.letterSpacing-1,text:n.text,textTransform:n.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1},material:s,states:Bn(n.states),events:Bn(n.events),visible:n.visible,raycastLock:n.raycastLock,position:n.position,rotation:n.rotation,scale:n.scale,hiddenMatrix:n.hiddenMatrix},u=Bn(e.scene.objects).parent(i);e.scene.objects.insertAfter(u??null,i,[{id:i+"new",data:l,children:[]}]),t.push(i)}}),t.forEach(i=>{e.scene.objects.delete(i)})}function $Ee(e){let t={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};e.scene.objects.traverse((i,r)=>{r.events.forEach(n=>{if(t[Number(n.type)])if(Object.assign(n,{type:t[Number(n.type)]}),n.type==="Audio"&&"audioEvent"in n&&(Object.assign(n,{playAudio:n.audioEvent}),delete n.audioEvent),n.type==="GameControl")Object.assign(n,{gameActions:{idle:new Xt,move:new Xt,jump:new Xt}});else{let s=new Xt;Object.assign(n,{actions:s}),(n.type==="MouseDown"||n.type==="MouseUp"||n.type==="KeyDown"||n.type==="KeyUp")&&"url"in n&&s.push({fi:0,id:Ot.generateUUID(),data:{type:"Link",url:n.url,delay:0}}),"targets"in n&&(n.targets.forEach((a,o,l)=>{let u={state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4},c={easing:a.easing,duration:a.duration};a.easing===6?Object.assign(c,Gc(a,"mass","stiffness","damping","velocity")):a.easing===5&&Object.assign(c,{control1:{...a.control1},control2:{...a.control2}});let h={repeat:a.repeat?-1:0,delay:a.delay,delayDirection:a.delayDirection,direction:a.cycle&&a.rewind?"pingpong-rewind":a.cycle?"pingpong":"normal"},d={state:a.state,...h,...c},p={allowSlerp:!0,type:"Transition",object:a.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new Xt({fi:0,id:Ot.generateUUID(),data:u},{fi:1,id:Ot.generateUUID(),data:d})};s.push({fi:l,id:o,data:p})}),delete n.targets)}})})}function e2e(e){e.scene.objects.traverse((t,i)=>{function r(n,s){let a=new Xt,o=[];if(i.events.forEach((l,u,c)=>{if(l.type==="Audio"&&l.trigger===s){let h;o.push(u),l.interaction==="play"?h={...Gc(l,"interaction","audio","delay","volume","loop"),triggerAfter:"after"in l?l.after:void 0,toggle:"after"in l?l.toggle:void 0,type:"Audio"}:(l.interaction==="pause"||l.interaction==="stop")&&(h={...Gc(l,"interaction","delay","object","playAudio"),type:"Audio"}),h&&a.push({fi:c,id:u,data:h})}}),o.forEach(l=>i.events.delete(l)),a.length){let l=i.events.find(u=>u.type===n)?.data;l?"actions"in l&&l.actions.insertBefore(null,a):i.events.insertBefore(null,[{id:Ot.generateUUID(),data:{type:n,actions:a}}])}}r("Start","start"),r("MouseDown","mouseDown"),r("MouseUp","mouseUp"),r("KeyDown","keyDown"),r("KeyUp","keyUp")})}function _6(e){let t=e.layers.find(i=>i.type==="light")?.data;if(t?.category==="basic"){let i=Jn.defaultData("light","phong"),r=t;Object.assign(r,i),r.visible=!1}}function S6(e){tp(e,_6),ip(e,_6)}function t2e(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&i.geometry.type==="SubdivGeometry"&&(i.geometry.scaleBaked||(i.geometry.scaleBaked=[1,1,1]))})}function i2e(e){e.scene.objects.traverse((t,i)=>{(i.type==="Empty"||i.type==="Mesh")&&i.cloner&&!i.cloner.randomnessObject&&!i.cloner.toObject&&!i.cloner.randomness&&(i.cloner={...i.cloner,toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}})})}function r2e(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&i.geometry.type==="NonParametricGeometry"&&!("material"in i)&&!("materials"in i)&&(i.material=Vs.defaultTwoLayerData("phong"))})}function n2e(e){e.scene.publish.orbitControls.autoZoom===void 0&&(e.scene.publish.orbitControls.autoZoom=!1),e.scene.objects.traverse((t,i)=>{(i.type==="OrthographicCamera"||i.type==="PerspectiveCamera")&&(i.orthographic.autoZoom===void 0&&(i.orthographic.autoZoom=!1),i.orthographic.autoZoomFrustumSize===void 0&&(i.orthographic.autoZoomFrustumSize=790))})}function s2e(e){e.scene.objects.traverse((t,i)=>{i.pathSnapping===void 0&&(i.pathSnapping={pathId:null,slide:0,offset:0,orientation:"tangential"}),i.pathSnapping.offset===void 0&&(i.pathSnapping.offset=0)})}function a2e(e){e.scene.publish.mouseEventTarget===void 0&&(e.scene.publish.mouseEventTarget="canvas"),e.scene.publish.settings.web.hint===void 0&&(e.scene.publish.settings.web.hint=!1)}function o2e(e){let{video:t}=e.scene.publish.settings;t.format==="gif"&&t.fps>48&&(t.fps=15)}function l2e(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.resetYPosition=Math.abs(r.resetYPosition-i.position[1]))})})}function u2e(e){let t=e.scene.environment.usePhysics;e.scene.objects.traverse((i,r)=>{t&&r.physics===null?r.collision=!1:r.collision="visibility"})}function c2e(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.navmesh=H2.defaultDataThirdPerson.navmesh)})})}function h2e(e){e.scene.styles||(e.scene.styles=gg.defaultData())}function M6(e){e.layers.forEach(t=>{t.type==="light"&&t.category!=="toon"&&t.occlusion===void 0&&(t.occlusion=!0)})}function d2e(e){e.scene.environment.ambientLight.occlusion===void 0&&(e.scene.environment.ambientLight.occlusion=!1),e.scene.environment.ambientLight.aoFullRes===void 0&&(e.scene.environment.ambientLight.aoFullRes=!1),e.scene.environment.ambientLight.radius===void 0&&(e.scene.environment.ambientLight.radius=256),e.scene.environment.ambientLight.bias===void 0&&(e.scene.environment.ambientLight.bias=.5),e.scene.environment.ambientLight.aoColor===void 0&&(e.scene.environment.ambientLight.aoColor={r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}),ip(e,M6),tp(e,M6)}function f2e(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&Object.assign(r.gameActions,{run:new Xt})})})}function p2e(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.keyAssignments=[...r.keyAssignments,["run",""],["none","Ctrl"]])})})}function A6(e){e.layers&&e.layers.forEach(t=>{t.type==="light"&&t.bumpMapIntensity===void 0&&(t.bumpMapIntensity=5)})}function m2e(e,t){if(t<1&&(ip(e,v6),tp(e,v6),e.schema=1),t<2&&(LEe(e),e.schema=2),t<3&&(zEe(e),e.schema=3),t<4&&(kEe(e),e.schema=4),t<5&&(BEe(e),e.schema=5),t<6&&(NEe(e),e.schema=6),t<7&&(FEe(e),e.schema=7),t<8&&(e.schema=8),t<9&&(x6(e),e.schema=9),t<10&&(HEe(e),e.schema=10),t<11&&(WEe(e),e.schema=11),t<12&&(x6(e),e.schema=12),t<13&&(GEe(e),e.schema=13),t<14&&(XEe(e),e.schema=14),t<15&&(YEe(e),e.schema=15),t<16&&(QEe(e),e.schema=16),t<17&&(ip(e,w6),tp(e,w6),e.schema=17),t<18&&(ip(e,y6),tp(e,y6),e.schema=18),t<19&&(OEe(e),e.schema=19),t<20&&(KEe(e),JEe(e),e.schema=20),t<21&&($Ee(e),e2e(e),e.schema=21),t<22&&(S6(e),e.schema=22),t<23&&(t2e(e),e.schema=23),t<24&&(i2e(e),e.schema=24),(t<25||e.shared.videos===void 0)&&(qEe(e),t<25&&(e.schema=25)),t<26&&(UEe(e),e.schema=26),t<27&&(VEe(e),e.schema=27),t<28&&(S6(e),e.schema=28),t<29&&(jEe(e),e.schema=29),t<30&&(r2e(e),e.schema=30),t<31&&(n2e(e),e.schema=31),t<33&&(s2e(e),e.schema=33),t<34&&(a2e(e),e.schema=34),t<35&&(o2e(e),e.schema=35),t<36&&(l2e(e),e.schema=36),t<37&&(u2e(e),e.schema=37),t<38&&(ip(e,b6),tp(e,b6),e.schema=38),t<39&&(c2e(e),e.schema=39),t<40&&(h2e(e),e.schema=40),t<41&&(d2e(e),e.schema=41),t<42&&(f2e(e),e.schema=42),t<43&&(p2e(e),e.schema=43),t<99){ip(e,A6),tp(e,A6),e.scene.publish.playCamera===null&&(e.scene.publish.playCamera=Xx);let i=Bn(e.scene.objects),r=e.scene.objects;e.scene.publish.playPage=ob,r.insertBefore(null,null,[{id:ob,data:{...gx.defaultData,backgroundColor:e.scene.backgroundColor,fog:e.scene.fog,postprocessing:e.scene.postprocessing,ao:Gc(e.scene.environment.ambientLight,"occlusion","aoFullRes","radius","bias","aoColor"),publish:{playCamera:e.scene.publish.playCamera,gameControlObject:e.scene.publish.gameControlObject},shadow:Gc(e.scene.environment.ambientLight,"softShadowQuality"),globalPhysics:{...px.defaultData,...Gc(e.scene.environment,"usePhysics","gravity")},camera:Bn(e.scene.ownerCamera)??gx.defaultData.camera,name:"Scene"},children:[]}]);for(let a of i)a.id!==vg.TRASH_CAN_ID&&r.move(ob,a.fi,a.id);let n=0,s=0;e.shared.penumbraSize&&e.scene.objects.traverse((a,o)=>{o.type==="DirectionalLight"?(o.penumbraSize=e.shared.penumbraSize[Math.min(n,2)],n+=1):o.type==="SpotLight"&&(o.penumbraSize=e.shared.penumbraSize[3+Math.min(s,1)],s+=1),(o.physics===void 0||o.physics===null)&&o.type!=="Instance"&&(o.physics={},Object.assign(o.physics,fx.defaultData)),o.physics!==void 0&&o.physics!==null&&(o.physics.enabled=o.collision??"visibility",delete o.collision)}),e.schema=99}}function E6(e){e.layers&&e.layers.forEach(t=>{t.type==="light"&&t.alphaOverride===void 0&&(t.alphaOverride=1)})}function g2e(e){e.scene.objects.traverse((t,i)=>{let r=i.geometry;r&&r.type==="PathGeometry"&&(r.extrusion.capType="flat",r.extrusion.bevel=50,r.extrusion.bevelSides=6,r.extrusion.shape.type==="Custom"&&(r.extrusion.shape.shapeQuality="low"))})}function v2e(e){Array.isArray(Bn(e.events))&&e.events?.forEach(t=>{"disabled"in t||(t.disabled=!1),(t.type==="MouseDown"||t.type==="MouseUp"||t.type==="MousePress")&&(t.mode=t.mode||"Object")})}var my=180/Math.PI;function C6(e){e.rotation=e.rotation.slice(0,3).map(t=>t*my)}function lY(e){C6(e),e.type==="Page"&&C6(e.camera),e.states?.forEach(i=>{i.rotation===void 0||i.rotation===null||(i.rotation=i.rotation.slice(0,3).map(r=>r*my))});let t=e.geometry;t&&t.type==="SphereGeometry"&&(t.thetaLength=(t.thetaLength??180)*my),t&&t.type==="TorusGeometry"&&(t.arc=t.arc*my),t&&t.type==="PathGeometry"&&(t.extrusion.angle*=my,t.extrusion.twist*=my),e.type==="Mesh"&&e.geometry.type==="TextGeometry"&&(e.geometry.text={textValue:e.geometry.text}),Array.isArray(Bn(e.events))&&e.events?.forEach(i=>{(i.type==="MouseDown"||i.type==="MouseUp"||i.type==="MousePress"||i.type==="KeyDown"||i.type==="KeyUp"||i.type==="KeyPress"||i.type==="Collision"||i.type==="Trigger")&&(i.runMode=i.toggle?"Toggle":"Repeat")})}function y2e(e){e.shared.variables=Go({},ii.prototype)}function x2e(e){let t=Bn(e.shared.variables);e.shared.variables=Go(Object.entries(t??{}).map(([i,r],n)=>({fi:n,id:i,data:r})),Xt.prototype)}var nd=120;function EL(e,t){t(e.data);for(let i of e.children)EL(i,t)}function w2e(e){let t=e.schema??104;t!==nd&&(t<105&&(EL(e.asset,lY),e.schema=105),t<118&&(EL(e.asset,uY),e.schema=118))}function b2e(e){e.shared.particles=Go({},ii.prototype),e.shared.lib&&(e.shared.lib.particles=Id.defaultData().particles)}function _2e(e){e.scene.objects.traverse((t,i)=>{i.type==="Particle"&&typeof i.renderMaterial.size=="number"&&Object.assign(i.renderMaterial,{size:[i.renderMaterial.size,i.renderMaterial.size]})})}function S2e(e){e.scene.objects.traverse((t,i)=>{i.type==="Page"&&(i.postprocessing.depthOfField.focusDistance=100,i.postprocessing.depthOfField.focalLength=20,i.postprocessing.depthOfField.bokehScale=5)})}function M2e(e){e.scene.objects.traverse((t,i)=>{Array.isArray(Bn(i.events))!==!1&&i.events?.forEach(r=>{let n=r.runMode;r.type==="MouseDown"||r.type==="MouseUp"||r.type==="KeyDown"||r.type==="KeyUp"||r.type==="Collision"||r.type==="Trigger"?r.actions?.forEach(s=>{s.type==="Transition"&&(s.runMode=n??"Repeat"),(s.type==="Animation"||s.type==="SwitchCamera")&&(s.runMode=n==="Toggle"?"Toggle":"Normal")}):r.type==="MouseHover"||r.type==="MousePress"||r.type==="KeyPress"?r.actions?.forEach(s=>{(s.type==="Transition"||s.type==="Animation"||s.type==="SwitchCamera")&&(s.runMode="Toggle")}):r.type==="GameControl"?(delete r.actions,Object.keys(r.gameActions).forEach(s=>{r.gameActions[s]?.forEach(a=>{a.type==="Transition"&&(a.runMode="Repeat"),a.type==="Animation"&&(a.runMode="Normal")})})):r.type==="DragDrop"?(delete r.actions,r.dragDropActions?.drag?.forEach(s=>{(s.type==="Transition"||s.type==="Animation"||s.type==="SwitchCamera")&&(s.runMode="Toggle")}),r.dragDropActions?.drop?.forEach(s=>{(s.type==="Transition"||s.type==="Animation"||s.type==="SwitchCamera")&&(s.runMode="Toggle")})):r.type==="Resize"?(delete r.actions,r.breakpoints?.forEach(s=>{s.actions?.forEach(a=>{(a.type==="Transition"||a.type==="Animation"||a.type==="SwitchCamera")&&(a.runMode="Toggle")})})):r.type==="Start"?r.actions?.forEach(s=>{s.type==="Transition"&&(s.runMode="Once"),(s.type==="Animation"||s.type==="SwitchCamera")&&(s.runMode="Normal")}):r.type==="VariableChange"||r.type==="Scroll"?r.actions?.forEach(s=>{s.type==="Transition"&&(s.runMode="Repeat"),(s.type==="Animation"||s.type==="SwitchCamera")&&(s.runMode="Normal")}):r.type==="Conditional"&&(delete r.actions,r.inActions?.forEach(s=>{s.type==="Transition"&&(s.runMode="Repeat"),(s.type==="Animation"||s.type==="SwitchCamera")&&(s.runMode="Normal")}),r.outActions?.forEach(s=>{s.type==="Transition"&&(s.runMode="Repeat"),(s.type==="Animation"||s.type==="SwitchCamera")&&(s.runMode="Normal")}))})})}function A2e(e){e.shared.userAPIs=Go({},ii.prototype),e.shared.userWebhooks=Go({},ii.prototype),e.shared.lib&&(e.shared.lib.userAPIs=Id.defaultData().userAPIs,e.shared.lib.userWebhooks=Id.defaultData().userWebhooks)}function E2e(e){e.scene.publish.settings.videoStatic===void 0&&(e.scene.publish.settings.videoStatic=xd.defaultData.settings.videoStatic)}function uY(e){e.timelineAnimations=Go({},ii.prototype)}function cY(e){let t=e.schema??0;if(t!==nd){console.warn("updating from ",t,"to ",nd),m2e(e,t),t<100&&(e.scene.publish.joystickSizeAndXYOffset===void 0&&(e.scene.publish.joystickSizeAndXYOffset=xd.defaultData.joystickSizeAndXYOffset),e.schema=100),t<101&&(ip(e,E6),tp(e,E6),e.schema=101),t<102&&(g2e(e),e.schema=102),t<104&&(e.shared.catelogs=new ii,e.shared.lib=Id.defaultData(),e.schema=104),t<105&&(y2e(e),e.scene.objects.traverse((i,r)=>{lY(r)}),e.schema=105);for(let i of Object.values(e.shared.lib.components))w2e(i);t<106&&(x2e(e),e.schema=106),t<107&&(e.shared.lib.variables=Id.defaultData().variables,e.schema=107),t<109&&(b2e(e),e.schema=109),t<110&&(_2e(e),e.schema=110),t<111&&(e.scene.objects.traverse((i,r)=>{v2e(r)}),e.schema=111),t<112&&(S2e(e),e.schema=112),t<113&&(M2e(e),e.schema=113),t<114&&(e.scene.publish.settings.web.imageQuality===void 0&&(e.scene.publish.settings.web.imageQuality=70),e.schema=114),t<115&&(A2e(e),e.schema=115),t<116&&(E2e(e),e.schema=116),t<117&&(e.scene.publish.settings.web.pixelRatioMobile===void 0&&(e.scene.publish.settings.web.pixelRatioMobile=0),e.scene.publish.settings.web.pixelRatioDesktop===void 0&&(e.scene.publish.settings.web.pixelRatioDesktop=0),e.schema=117),t<118&&(e.shared.timelineAnimations=Go({},ii.prototype),e.scene.objects.traverse((i,r)=>{uY(r)}),e.schema=118),t<119&&(e.scene.publish.settings.videoStatic.format=vx.defaultData.scene.publish.settings.videoStatic.format,e.scene.publish.settings.videoStatic.imageFormat=vx.defaultData.scene.publish.settings.videoStatic.imageFormat,e.schema=119),t<120&&(e.scene.publish.settings.image.colorSpace="display-p3",e.scene.publish.settings.videoStatic.colorSpace="display-p3",e.schema=120)}}var vx;(e=>{e.defaultData={schema:nd,scene:vg.defaultData,frames:new ii().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",lb.defaultData),shared:{...Nl.emptyData(),colors:Nl.defaultColors()}},e.emptyDataForImports=function(){let s=vg.emptyDataWithPage();return{schema:nd,scene:s,frames:new ii().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",lb.defaultData),shared:{...Nl.emptyData(),colors:Nl.defaultColors(),images:Nl.defaultImages()}}},e.emptyData=function(){return{schema:nd,scene:vg.emptyDataWithPage(),frames:new ii().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",lb.defaultData),shared:Nl.emptyData()}},e.clipboard2dData=function(){return{schema:nd,scene:vg.emptyData(),frames:new ii,shared:Nl.emptyData()}},e.collabHelper={...qI,updateSchema(s){return(s.schema??0)<nd?e_(s,cY):(s.schema??0)-nd}};function t(s){let a=e.collabHelper.updateSchema(s);return typeof a=="number"?a===0?s:null:a.data}e.updateSchemaDirectly=t;function i(s){return{...s,shared:{...s.shared,lib:Id.defaultData()}}}e.withoutLib=i;function r(s,a){let o=s.scene.objects.get(a);if(o&&o.data.type==="Component")return o;{let l=s.shared.lib.components[a];if(l)return l.asset}}e.getComponentData=r;function n(s){let a=Object.values(s.shared.userAPIs);for(let o of a){let l=o.headers;for(let u of l)if(u.data.key.toLowerCase()==="authorization"&&u.data.value!=="")return!0}return!1}e.hasSensitiveData=n})(vx||(vx={}));var CL;(e=>e.emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=",name:"empty"})(CL||(CL={}));var T6;(e=>{function t(i){return!0}e.is=t})(T6||(T6={}));var W2;(e=>{e.defaultData={position:[0,0],scale:[1,1],rotation:0,shear:[0,0]};function t(r,n){return{position:n?.position??r.position,rotation:n?.rotation??r.rotation,scale:n?.scale??r.scale,shear:n?.shear??r.shear}}e.merge=t;function i(r,n){return PX({position:Fc.isEqual(r.position,n.position)?void 0:n.position,rotation:r.rotation===n.rotation?void 0:n.rotation,scale:Fc.isEqual(r.scale,n.scale)?void 0:n.scale,shear:r.shear&&n.shear&&Fc.isEqual(r.shear,n.shear)?void 0:n.shear})}e.diff=i})(W2||(W2={}));var TL;(e=>e.defaultData={horizontalConstraint:0,verticalConstraint:0})(TL||(TL={}));var P6;(e=>e.defaultData={direction:"row",wrap:"unwrap",align:"top-left",gap:10,rowGap:10,autoGap:!1,autoRowGap:!1,leftPadding:8,rightPadding:8,topPadding:8,bottomPadding:8})(P6||(P6={}));var G2;(e=>e.defaultData={opacity:1,fill:{color:mr.fromHexAndA(fl,1),enabled:!0},stroke:{color:mr.from0to1([0,0,0,1]),thickness:1,enabled:!1,mode:"inside"},layerBlur:{radius:2,enabled:!1},backgroundBlur:{radius:2,enabled:!1},dropShadow:{offset:[10,10],blurRadius:10,color:mr.from0to1([0,0,0,1]),enabled:!1,spread:0},innerShadow:{offset:[10,10],blurRadius:10,color:mr.from0to1([0,0,0,1]),enabled:!1,spread:0}})(G2||(G2={}));var yg;(e=>{function t(a,o){return{name:o}}e.newEmpty=t;function i(a,o){if(o===void 0)return a;let l={...a},u=["width","height","cornerRadius"];for(let c of u)c in l&&c in o&&o[c]!==void 0&&Object.assign(l,{[c]:o[c]});return l}function r(a,o){if(o===void 0)return a;let l={...a};return"fill"in l&&"fill"in o&&o.fill!==void 0&&Object.assign(l,{fill:{...l.fill,...o.fill}}),"stroke"in l&&"stroke"in o&&o.stroke!==void 0&&Object.assign(l,{stroke:{...l.stroke,...o.stroke}}),"layerBlur"in l&&"layerBlur"in o&&o.layerBlur!==void 0&&Object.assign(l,{layerBlur:{...l.layerBlur,...o.layerBlur}}),"backgroundBlur"in l&&"backgroundBlur"in o&&o.backgroundBlur!==void 0&&Object.assign(l,{backgroundBlur:{...l.backgroundBlur,...o.backgroundBlur}}),"dropShadow"in l&&"dropShadow"in o&&o.dropShadow!==void 0&&Object.assign(l,{dropShadow:{...l.dropShadow,...o.dropShadow}}),"innerShadow"in l&&"innerShadow"in o&&o.innerShadow!==void 0&&Object.assign(l,{innerShadow:{...l.innerShadow,...o.innerShadow}}),l}function n(a,o){if(o===void 0)return a;let l={...a};return Object.assign(l,W2.merge(l,o)),l=i(l,o),l=r(l,o),l}e.patch=n;function s(a,o){let l,u=[];for(let[c,h]of Object.entries(o))c!=="name"&&(l===void 0&&(l={path:[],props:{},type:0},u.push(l)),l.props[c]=h);return u}e.toOps=s})(yg||(yg={}));var n_;(e=>e.defaultData={...W2.defaultData,...TL.defaultData,states:new Xt,events:new Xt,visible:!0,raycastLock:!1})(n_||(n_={}));var yx;(e=>e.defaultData={...n_.defaultData,...G2.defaultData})(yx||(yx={}));var q2;(e=>e.defaultData={cornerRadius:[0,0,0,0]})(q2||(q2={}));var PL;(e=>e.defaultData={...yx.defaultData,type:"ellipse2d",width:100,height:100,name:"Ellipse"})(PL||(PL={}));var s_;(e=>e.defaultData={...yx.defaultData,...q2.defaultData,type:"rectangle2d",width:100,height:100,name:"Rectangle"})(s_||(s_={}));var DL;(e=>e.defaultData={...yx.defaultData,type:"text2d",width:100,height:100,fontSize:12,lineHeight:1.2,letterSpacing:0,text:{textValue:"Hello world"},horizontalAlign:1,verticalAlign:1,textTransform:1,font:"Roboto_regular",name:"Text"})(DL||(DL={}));var RL;(e=>e.defaultData={...yx.defaultData,type:"path2d",path:"",name:"Path"})(RL||(RL={}));var D6;(e=>{function t(i){return i.type==="ellipse2d"||i.type==="rectangle2d"||i.type==="text2d"||i.type==="vector2d"||i.type==="path2d"}e.is=t})(D6||(D6={}));var X2;(e=>e.defaultData={...n_.defaultData,name:"Group",type:"group2d"})(X2||(X2={}));var IL;(e=>e.defaultData=()=>({...n_.defaultData,...q2.defaultData,...G2.defaultData,name:"Frame",type:"frame2d",clipped:!0,width:200,height:200,fill:{color:mr.fromHexAndA(4737101,1),enabled:!0},stroke:{color:mr.fromHexAndA(0,1),thickness:1,enabled:!1,mode:"inside"},backgroundBlur:{radius:2,enabled:!1},layerBlur:{radius:2,enabled:!1}}))(IL||(IL={}));var Lg;(e=>{function t(a){switch(a){case"rectangle2d":return{...s_.defaultData};case"ellipse2d":return{...PL.defaultData};case"text2d":return{...DL.defaultData};case"vector2d":return{...s_.defaultData};case"path2d":return{...RL.defaultData};case"frame2d":return{...IL.defaultData()};case"group2d":return{...X2.defaultData}}}e.defaultData=t;function i(a){return"width"in a&&"height"in a?[typeof a.width=="number"?a.width*.5:0,typeof a.height=="number"?a.height*.5:0]:[0,0]}e.getPivot=i;function r(a){return a.type==="rectangle2d"||a.type==="ellipse2d"||a.type==="text2d"||a.type==="frame2d"}e.isResizeable=r;function n(a){return a.type==="frame2d"&&a.autoLayout!==void 0}e.isAutoLayoutable=n;function s(a){return a.type==="rectangle2d"||a.type==="frame2d"}e.hasCorners=s})(Lg||(Lg={}));var LL;(e=>(e.defaultData={name:"UI",type:"scene2d",objects:new ga},e.emptyData=function(){return{type:"scene2d",objects:new ga}}))(LL||(LL={}));function xg(e,t=!1){let i=e[0].index!==null,r=new Set(Object.keys(e[0].attributes)),n=new Set(Object.keys(e[0].morphAttributes)),s={},a={},o=e[0].morphTargetsRelative,l=new Kt,u=0;for(let c=0;c<e.length;++c){let h=e[c],d=0;if(i!==(h.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let p in h.attributes){if(!r.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+'. All geometries must have compatible attributes; make sure "'+p+'" attribute exists among all geometries, or in none of them.'),null;s[p]===void 0&&(s[p]=[]),s[p].push(h.attributes[p]),d++}if(d!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". Make sure all geometries have the same number of attributes."),null;if(o!==h.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let p in h.morphAttributes){if(!n.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+".  .morphAttributes must be consistent throughout all geometries."),null;a[p]===void 0&&(a[p]=[]),a[p].push(h.morphAttributes[p])}if(t){let p;if(i)p=h.index.count;else if(h.attributes.position!==void 0)p=h.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". The geometry must have either an index or a position attribute"),null;l.addGroup(u,p,c),u+=p}}if(i){let c=0,h=[];for(let d=0;d<e.length;++d){let p=e[d].index;for(let m=0;m<p.count;++m)h.push(p.getX(m)+c);c+=e[d].attributes.position.count}l.setIndex(h)}for(let c in s){let h=R6(s[c]);if(!h)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+c+" attribute."),null;l.setAttribute(c,h)}for(let c in a){let h=a[c][0].length;if(h===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[c]=[];for(let d=0;d<h;++d){let p=[];for(let v=0;v<a[c].length;++v)p.push(a[c][v][d]);let m=R6(p);if(!m)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+c+" morphAttribute."),null;l.morphAttributes[c].push(m)}}return l}function R6(e){let t,i,r,n=0;for(let o=0;o<e.length;++o){let l=e[o];if(l.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(t===void 0&&(t=l.array.constructor),t!==l.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(i===void 0&&(i=l.itemSize),i!==l.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(r===void 0&&(r=l.normalized),r!==l.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;n+=l.array.length}let s=new t(n),a=0;for(let o=0;o<e.length;++o)s.set(e[o].array,a),a+=e[o].array.length;return new hi(s,i,r)}var hY={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,timelineChangeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0,rewind:!0},jk={duration:1e3,delay:0,endDelay:0,startOnceDelay:0,pingPongDelayCorrection:0,pingPongEndDelayCorrection:0,easing:"easeOutElastic(1, .5)",round:0},C2e=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],Y2={CSS:{},springs:{}};function ku(e,t,i){return Math.min(Math.max(e,t),i)}function ub(e,t){return e.indexOf(t)>-1}function eD(e,t){return e.apply(null,t)}var wi={arr:function(e){return Array.isArray(e)},obj:function(e){return ub(Object.prototype.toString.call(e),"Object")},pth:function(e){return wi.obj(e)&&e.hasOwnProperty("totalLength")},svg:function(e){return e instanceof SVGElement},inp:function(e){return e instanceof HTMLInputElement},dom:function(e){return!("isNode"in e)&&(e.nodeType||wi.svg(e))},str:function(e){return typeof e=="string"},fnc:function(e){return typeof e=="function"},und:function(e){return typeof e>"u"},hex:function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)},rgb:function(e){return/^rgb/.test(e)},hsl:function(e){return/^hsl/.test(e)},col:function(e){return wi.hex(e)||wi.rgb(e)||wi.hsl(e)},key:function(e){return!hY.hasOwnProperty(e)&&!jk.hasOwnProperty(e)&&e!=="targets"&&e!=="keyframes"}};function dY(e){var t=/\(([^)]+)\)/.exec(e);return t?t[1].split(",").map(function(i){return parseFloat(i)}):[]}function fY(e,t){var i=dY(e),r=ku(wi.und(i[0])?1:i[0],.1,100),n=ku(wi.und(i[1])?100:i[1],.1,100),s=ku(wi.und(i[2])?10:i[2],.1,100),a=ku(wi.und(i[3])?0:i[3],.1,100),o=Math.sqrt(n/r),l=s/(2*Math.sqrt(n*r)),u=l<1?o*Math.sqrt(1-l*l):0,c=1,h=l<1?(l*o+-a)/u:-a+o;function d(m){var v=t?t*m/1e3:m;return l<1?v=Math.exp(-v*l*o)*(c*Math.cos(u*v)+h*Math.sin(u*v)):v=(c+h*v)*Math.exp(-v*o),m===0||m===1?m:1-v}function p(){var m=Y2.springs[e];if(m)return m;for(var v=1/6,g=0,w=0;;)if(g+=v,d(g)===1){if(w++,w>=16)break}else w=0;var S=g*v*1e3;return Y2.springs[e]=S,S}return t?d:p}function T2e(e){return e===void 0&&(e=10),function(t){return Math.ceil(ku(t,1e-6,1)*e)*(1/e)}}var P2e=(function(){var e=11,t=1/(e-1);function i(c,h){return 1-3*h+3*c}function r(c,h){return 3*h-6*c}function n(c){return 3*c}function s(c,h,d){return((i(h,d)*c+r(h,d))*c+n(h))*c}function a(c,h,d){return 3*i(h,d)*c*c+2*r(h,d)*c+n(h)}function o(c,h,d,p,m){var v,g,w=0;do g=h+(d-h)/2,v=s(g,p,m)-c,v>0?d=g:h=g;while(Math.abs(v)>1e-7&&++w<10);return g}function l(c,h,d,p){for(var m=0;m<4;++m){var v=a(h,d,p);if(v===0)return h;var g=s(h,d,p)-c;h-=g/v}return h}function u(c,h,d,p){if(!(0<=c&&c<=1&&0<=d&&d<=1))return;var m=new Float32Array(e);if(c!==h||d!==p)for(var v=0;v<e;++v)m[v]=s(v*t,c,d);function g(w){for(var S=0,_=1,A=e-1;_!==A&&m[_]<=w;++_)S+=t;--_;var C=(w-m[_])/(m[_+1]-m[_]),E=S+C*t,I=a(E,c,d);return I>=.001?l(w,E,c,d):I===0?E:o(w,S,S+t,c,d)}return function(w){return c===h&&d===p||w===0||w===1?w:s(g(w),h,p)}}return u})(),pY=(function(){var e={linear:function(){return function(r){return r}}},t={Sine:function(){return function(r){return 1-Math.cos(r*Math.PI/2)}},Circ:function(){return function(r){return 1-Math.sqrt(1-r*r)}},Back:function(){return function(r){return r*r*(3*r-2)}},Bounce:function(){return function(r){for(var n,s=4;r<((n=Math.pow(2,--s))-1)/11;);return 1/Math.pow(4,3-s)-7.5625*Math.pow((n*3-2)/22-r,2)}},Elastic:function(r,n){r===void 0&&(r=1),n===void 0&&(n=.5);var s=ku(r,1,10),a=ku(n,.1,2);return function(o){return o===0||o===1?o:-s*Math.pow(2,10*(o-1))*Math.sin((o-1-a/(Math.PI*2)*Math.asin(1/s))*(Math.PI*2)/a)}}},i=["Quad","Cubic","Quart","Quint","Expo"];return i.forEach(function(r,n){t[r]=function(){return function(s){return Math.pow(s,n+2)}}}),Object.keys(t).forEach(function(r){var n=t[r];e["easeIn"+r]=n,e["easeOut"+r]=function(s,a){return function(o){return 1-n(s,a)(1-o)}},e["easeInOut"+r]=function(s,a){return function(o){return o<.5?n(s,a)(o*2)/2:1-n(s,a)(o*-2+2)/2}}}),e})();function Hk(e,t){if(wi.fnc(e))return e;var i=e.split("(")[0],r=pY[i],n=dY(e);switch(i){case"spring":return fY(e,t);case"cubicBezier":return eD(P2e,n);case"steps":return eD(T2e,n);default:return eD(r,n)}}function mY(e){try{var t=document.querySelectorAll(e);return t}catch{return}}function sT(e,t){for(var i=e.length,r=arguments.length>=2?arguments[1]:void 0,n=[],s=0;s<i;s++)if(s in e){var a=e[s];t.call(r,a,s,e)&&n.push(a)}return n}function aT(e){return e.reduce(function(t,i){return t.concat(wi.arr(i)?aT(i):i)},[])}function I6(e){return wi.arr(e)?e:(wi.str(e)&&(e=mY(e)||e),e instanceof NodeList||e instanceof HTMLCollection?[].slice.call(e):[e])}function Wk(e,t){return e.some(function(i){return i===t})}function Gk(e){var t={};for(var i in e)t[i]=e[i];return t}function OL(e,t){var i=Gk(e);for(var r in e)i[r]=t.hasOwnProperty(r)?t[r]:e[r];return i}function oT(e,t){var i=Gk(e);for(var r in t)i[r]=wi.und(e[r])?t[r]:e[r];return i}function D2e(e){var t=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(e);return t?"rgba("+t[1]+",1)":e}function R2e(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,i=e.replace(t,function(o,l,u,c){return l+l+u+u+c+c}),r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i),n=parseInt(r[1],16),s=parseInt(r[2],16),a=parseInt(r[3],16);return"rgba("+n+","+s+","+a+",1)"}function I2e(e){var t=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(e)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(e),i=parseInt(t[1],10)/360,r=parseInt(t[2],10)/100,n=parseInt(t[3],10)/100,s=t[4]||1;function a(d,p,m){return m<0&&(m+=1),m>1&&(m-=1),m<1/6?d+(p-d)*6*m:m<1/2?p:m<2/3?d+(p-d)*(2/3-m)*6:d}var o,l,u;if(r==0)o=l=u=n;else{var c=n<.5?n*(1+r):n+r-n*r,h=2*n-c;o=a(h,c,i+1/3),l=a(h,c,i),u=a(h,c,i-1/3)}return"rgba("+o*255+","+l*255+","+u*255+","+s+")"}function L2e(e){if(wi.rgb(e))return D2e(e);if(wi.hex(e))return R2e(e);if(wi.hsl(e))return I2e(e)}function Md(e){var t=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(e);if(t)return t[1]}function O2e(e){if(ub(e,"translate")||e==="perspective")return"px";if(ub(e,"rotate")||ub(e,"skew"))return"deg"}function zL(e,t){return wi.fnc(e)?e(t.target,t.id,t.total):e}function Uc(e,t){return e.getAttribute(t)}function qk(e,t,i){var r=Md(t);if(Wk([i,"deg","rad","turn"],r))return t;var n=Y2.CSS[t+i];if(!wi.und(n))return n;var s=100,a=document.createElement(e.tagName),o=e.parentNode&&e.parentNode!==document?e.parentNode:document.body;o.appendChild(a),a.style.position="absolute",a.style.width=s+i;var l=s/a.offsetWidth;o.removeChild(a);var u=l*parseFloat(t);return Y2.CSS[t+i]=u,u}function gY(e,t,i){if(t in e.style){var r=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),n=e.style[t]||getComputedStyle(e).getPropertyValue(r)||"0";return i?qk(e,n,i):n}}function Xk(e,t){if(wi.dom(e)&&!wi.inp(e)&&(Uc(e,t)||wi.svg(e)&&e[t]))return"attribute";if(wi.dom(e)&&Wk(C2e,t))return"transform";if(wi.dom(e)&&t!=="transform"&&gY(e,t))return"css";if(e[t]!=null)return"object"}function vY(e){if(wi.dom(e)){for(var t=e.style.transform||"",i=/(\w+)\(([^)]*)\)/g,r=new Map,n;n=i.exec(t);)r.set(n[1],n[2]);return r}}function z2e(e,t,i,r){var n=ub(t,"scale")?1:0+O2e(t),s=vY(e).get(t)||n;return i&&(i.transforms.list.set(t,s),i.transforms.last=t),r?qk(e,s,r):s}function Yk(e,t,i,r){switch(Xk(e,t)){case"transform":return z2e(e,t,r,i);case"css":return gY(e,t,i);case"attribute":return Uc(e,t);default:return e[t]||0}}function Qk(e,t){var i=/^(\*=|\+=|-=)/.exec(e);if(!i)return e;var r=Md(e)||0,n=parseFloat(t),s=parseFloat(e.replace(i[0],""));switch(i[0][0]){case"+":return n+s+r;case"-":return n-s+r;case"*":return n*s+r}}function yY(e,t){if(wi.col(e))return L2e(e);if(/\s/g.test(e))return e;var i=Md(e),r=i?e.substr(0,e.length-i.length):e;return t?r+t:r}function Kk(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function k2e(e){return Math.PI*2*Uc(e,"r")}function B2e(e){return Uc(e,"width")*2+Uc(e,"height")*2}function N2e(e){return Kk({x:Uc(e,"x1"),y:Uc(e,"y1")},{x:Uc(e,"x2"),y:Uc(e,"y2")})}function xY(e){for(var t=e.points,i=0,r,n=0;n<t.numberOfItems;n++){var s=t.getItem(n);n>0&&(i+=Kk(r,s)),r=s}return i}function F2e(e){var t=e.points;return xY(e)+Kk(t.getItem(t.numberOfItems-1),t.getItem(0))}function wY(e){if(e.getTotalLength)return e.getTotalLength();switch(e.tagName.toLowerCase()){case"circle":return k2e(e);case"rect":return B2e(e);case"line":return N2e(e);case"polyline":return xY(e);case"polygon":return F2e(e)}}function U2e(e){var t=wY(e);return e.setAttribute("stroke-dasharray",t),t}function V2e(e){for(var t=e.parentNode;wi.svg(t)&&wi.svg(t.parentNode);)t=t.parentNode;return t}function bY(e,t){var i=t||{},r=i.el||V2e(e),n=r.getBoundingClientRect(),s=Uc(r,"viewBox"),a=n.width,o=n.height,l=i.viewBox||(s?s.split(" "):[0,0,a,o]);return{el:r,viewBox:l,x:l[0]/1,y:l[1]/1,w:a/l[2],h:o/l[3]}}function j2e(e,t){var i=wi.str(e)?mY(e)[0]:e,r=t||100;return function(n){return{property:n,el:i,svg:bY(i),totalLength:wY(i)*(r/100)}}}function H2e(e,t){function i(o){o===void 0&&(o=0);var l=t+o>=1?t+o:0;return e.el.getPointAtLength(l)}var r=bY(e.el,e.svg),n=i(),s=i(-1),a=i(1);switch(e.property){case"x":return(n.x-r.x)*r.w;case"y":return(n.y-r.y)*r.h;case"angle":return Math.atan2(a.y-s.y,a.x-s.x)*180/Math.PI}}function L6(e,t){var i=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,r=yY(wi.pth(e)?e.totalLength:e,t)+"";return{original:r,numbers:r.match(i)?r.match(i).map(Number):[0],strings:wi.str(e)||t?r.split(i):[]}}function _Y(e){var t=e?aT(wi.arr(e)?e.map(I6):I6(e)):[];return sT(t,function(i,r,n){return n.indexOf(i)===r})}function SY(e){var t=_Y(e);return t.map(function(i,r){return{target:i,id:r,total:t.length,transforms:{list:vY(i)}}})}function W2e(e,t){var i=Gk(t);if(/^spring/.test(i.easing)&&(i.duration=fY(i.easing)),wi.arr(e)){var r=e.length,n=r===2&&!wi.obj(e[0]);n?e={value:e}:wi.fnc(t.duration)||(i.duration=t.duration/r)}var s=wi.arr(e)?e:[e];return s.map(function(a,o){var l=wi.obj(a)&&!wi.pth(a)?a:{value:a};return wi.und(l.delay)&&(l.delay=o?0:t.delay),wi.und(l.endDelay)&&(l.endDelay=o===s.length-1?t.endDelay:0),l}).map(function(a){return oT(a,i)})}function G2e(e){for(var t=sT(aT(e.map(function(s){return Object.keys(s)})),function(s){return wi.key(s)}).reduce(function(s,a){return s.indexOf(a)<0&&s.push(a),s},[]),i={},r=function(s){var a=t[s];i[a]=e.map(function(o){var l={};for(var u in o)wi.key(u)?u==a&&(l.value=o[u]):l[u]=o[u];return l})},n=0;n<t.length;n++)r(n);return i}function q2e(e,t){var i=[],r=t.keyframes;r&&(t=oT(G2e(r),t));for(var n in t)wi.key(n)&&i.push({name:n,tweens:W2e(t[n],e)});return i}function X2e(e,t){var i={};for(var r in e){var n=zL(e[r],t);wi.arr(n)&&(n=n.map(function(s){return zL(s,t)}),n.length===1&&(n=n[0])),i[r]=n}return i.duration=parseFloat(i.duration),i.delay=parseFloat(i.delay),i}function Y2e(e,t){var i;return e.tweens.map(function(r){var n=X2e(r,t),s=n.value,a=wi.arr(s)?s[1]:s,o=Md(a),l=Yk(t.target,e.name,o,t),u=i?i.to.original:l,c=wi.arr(s)?s[0]:u,h=Md(c)||Md(l),d=o||h;return wi.und(a)&&(a=u),n.from=L6(c,d),n.to=L6(Qk(a,c),d),n.start=i?i.end:0,n.end=n.start+n.delay+n.duration+n.endDelay,n.easing=Hk(n.easing,n.duration),n.isPath=wi.pth(s),n.isColor=wi.col(n.from.original),n.isColor&&(n.round=1),i=n,n})}var MY={css:function(e,t,i){return e.style[t]=i},attribute:function(e,t,i){return e.setAttribute(t,i)},object:function(e,t,i){return e[t]=i},transform:function(e,t,i,r,n){if(r.list.set(t,i),t===r.last||n){var s="";r.list.forEach(function(a,o){s+=o+"("+a+") "}),e.style.transform=s}}};function AY(e,t){var i=SY(e);i.forEach(function(r){for(var n in t){var s=zL(t[n],r),a=r.target,o=Md(s),l=Yk(a,n,o,r),u=o||Md(l),c=Qk(yY(s,u),l),h=Xk(a,n);MY[h](a,n,c,r.transforms,!0)}})}function Q2e(e,t){var i=Xk(e.target,t.name);if(i){var r=Y2e(t,e),n=r[r.length-1];return{type:i,property:t.name,animatable:e,tweens:r,duration:n.end,delay:r[0].delay,endDelay:n.endDelay}}}function K2e(e,t){return sT(aT(e.map(function(i){return t.map(function(r){return Q2e(i,r)})})),function(i){return!wi.und(i)})}function EY(e,t){var i=e.length,r=function(s){return s.timelineOffset?s.timelineOffset:0},n={};return n.duration=i?Math.max.apply(Math,e.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0,l=s.pingPongEndDelayCorrection??0;return r(s)+a+o+l+s.duration*(s.loop??1)})):t.duration,n.delay=i?Math.min.apply(Math,e.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0;return r(s)+a+o+s.delay})):t.delay,n.endDelay=i?n.duration-Math.max.apply(Math,e.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0,l=s.pingPongEndDelayCorrection??0;return r(s)+a+o+s.duration*(s.loop??1)-s.endDelay-l})):t.endDelay,n}var O6=0;function Z2e(e){var t=OL(hY,e),i=OL(jk,e),r=q2e(i,e),n=SY(e.targets),s=K2e(n,r),a=EY(s,i),o=O6;return O6++,oT(t,{id:o,children:[],animatables:n,animations:s,duration:a.duration,delay:a.delay,endDelay:a.endDelay,startOnceDelay:i.startOnceDelay,pingPongDelayCorrection:i.pingPongDelayCorrection,pingPongEndDelayCorrection:i.pingPongEndDelayCorrection})}var ql=[],z6=[],gy,k6=(function(){let e=0,t=!0;function i(s){let a=ql.length;if(a){let o=0;for(;o<a;){let l=ql[o];l.paused?(ql.splice(o,1),a--):(l.tick(s),o++)}t&&(gy=requestAnimationFrame(i))}else gy&&(cancelAnimationFrame(gy),gy=null)}function r(){e=performance.now(),gy=requestAnimationFrame(i)}function n(s){e+=s,i(e)}return{get isUsingInternalRaf(){return t},set isUsingInternalRaf(s){t=s},play:r,update:n}})();function J2e(e){document.hidden?(ql.forEach(function(t){return t.pause(e.timeStamp)}),z6=ql.slice(0),ss.running=ql=[]):z6.forEach(function(t){return t.play(e.timeStamp)})}typeof document<"u"&&document.addEventListener("visibilitychange",J2e);function ss(e){e===void 0&&(e={});var t=0,i=0,r=0,n,s,a=0,o=null;function l(C){var E=window.Promise&&new Promise(function(I){return o=I});return C.finished=E,E}var u=Z2e(e);l(u);function c(){var C=u.direction;C!=="alternate"&&(u.direction=C!=="normal"?"normal":"reverse"),u.reversed=!u.reversed,s.forEach(function(E){(E.loop===1||E.loop%2===0)&&(E.reversed=u.reversed)})}function h(){u.direction="normal",u.reversed=!1,s.forEach(function(C){return C.reversed=!1})}function d(C){return u.reversed?u.duration-C:C}function p(C,E,I=!1){E&&(u.reversed?E.seek(E.duration*E.loop-(C-E.timelineOffset-E.pingPongDelayCorrection),I):E.seek(C-E.timelineOffset-E.startOnceDelay-E.pingPongDelayCorrection,I))}function m(C,E=!1){if(u.reversed)for(var I=a;I--;)p(C,s[I],E);else for(var T=0;T<a;T++)p(C,s[T],E)}function v(C){var E=0,I=u.animations,T=I.length;for(u.direction!=="alternate"&&u.parent?.direction==="alternate"?u.parent?.rewind===!1&&u.reversePlayback===!0&&u.rewind===!1&&(u.parent?.reversed&&u.direction==="alternate"?C=u.duration-u.delay+u.endDelay-C:C=u.duration+u.delay-u.endDelay-C):_(!1,u.parent?.rewind,u.rewind,u.parent?.reversePlayback,u.reversePlayback)&&(u.parent?.reversed&&u.direction==="alternate"?C=u.duration-u.delay+u.endDelay-C:C=u.duration+u.delay-u.endDelay-C);E<T;){var D=I[E],L=D.animatable,z=D.tweens,G=z.length-1,V=z[G];G&&(V=sT(z,function(me){return C<me.end})[0]||V);let ue;u.parent?.reversed&&u.direction==="alternate"?ue=ku(C-V.start-V.endDelay,0,V.duration)/V.duration:ue=ku(C-V.start-V.delay,0,V.duration)/V.duration;for(var j=isNaN(ue)?1:V.easing(ue),J=V.to.strings,ne=V.round,K=[],B=V.to.numbers.length,Z=void 0,F=0;F<B;F++){var X=void 0;let me,he;u.direction!=="alternate"?u.parent?.rewind===!1&&u.reversePlayback===!0&&u.rewind===!1?(me=V.to.numbers[F],he=V.from.numbers[F]||0):(he=V.to.numbers[F],me=V.from.numbers[F]||0):_(!0,u.parent?.rewind,u.rewind,u.parent?.reversePlayback,u.reversePlayback)?(me=V.to.numbers[F],he=V.from.numbers[F]||0):(he=V.to.numbers[F],me=V.from.numbers[F]||0),V.isPath?X=H2e(V.value,j*he):X=me+j*(he-me),ne&&(V.isColor&&F>2||(X=Math.round(X*ne)/ne)),K.push(X)}var Y=J.length;if(!Y)Z=K[0];else{Z=J[0];for(var le=0;le<Y;le++){J[le];var oe=J[le+1],re=K[le];isNaN(re)||(oe?Z+=re+oe:Z+=re+" ")}}MY[D.type](L.target,D.property,Z,L.transforms),D.currentValue=Z,E++}}function g(C){u[C]&&!u.passThrough&&u[C](u)}function w(){u.remaining&&u.remaining!==!0&&u.remaining--}let S={0:!1,1:!0,2:!1,3:!0,4:!1,5:!1,6:!1,7:!1,8:!1,9:!0,10:!0,11:!1,12:!1,13:!1,14:!0,15:!0,16:!1,17:!0,18:!0,19:!1,20:!1,21:!1,22:!0,23:!0,24:!1,25:!0,26:!1,27:!0,28:!1,29:!1,30:!1,31:!1};function _(C,E,I,T,D){return S[C<<4|E<<3|I<<2|T<<1|D]}function A(C,E=!1){var I=u.duration;let T=u.delay,D=I-u.endDelay;u.parent?.reversed&&u.direction==="alternate"&&(T=u.endDelay,D=I-u.delay);var L=d(C);if(u.progress=ku(L/I*100,0,100),E||(u.reversePlayback=L<u.currentTime),a&&m(L,E),!u.began&&L>=T&&(u.began=!0),!u.loopBegan&&u.currentTime>0&&(u.loopBegan=!0,g("loopBegin")),(u.reversed||L>=0)&&L<=T&&u.currentTime!==0&&(v(0),g("change")),(L>=D&&u.currentTime!==I+u.pingPongDelayCorrection||!I)&&(v(I),g("change")),L>T&&L<D?(u.changeBegan||(u.changeBegan=!0,u.changeCompleted=!1,g("changeBegin")),v(L),g("change")):u.changeBegan?(u.changeCompleted=!0,u.changeBegan=!1,g("change"),a&&g("timelineChangeComplete")):u.began&&L>D&&g("changeComplete"),u.currentTime=ku(L,0,I+u.pingPongDelayCorrection),u.began&&g("update"),C>=I)if(w(),!u.remaining)u.paused=!0,u.completed||(u.completed=!0,g("loopComplete"),g("complete"),!u.passThrough&&"Promise"in window&&(o(),l(u)));else{a?t+=u.duration/ss.speed:t+=u.duration;for(let z of s)z.setStartTime(0),z.remaining=z.loop;g("loopComplete"),u.loopBegan=!1,u.direction==="alternate"?c():a&&h()}}return u.reset=function(){var C=u.direction;u.passThrough=!1,u.currentTime=0,u.progress=0,u.paused=!0,u.began=!1,u.loopBegan=!1,u.changeBegan=!1,u.completed=!1,u.changeCompleted=!1,u.reversed=C==="reverse",u.remaining=u.loop,s=u.children,a=s.length;for(var E=a;E--;)u.children[E].reset();v(u.reversed?u.duration:0)},u.setStartTime=function(C){t=C},u.set=function(C,E){return AY(C,E),u},u.tick=function(C){r=C,t||(t=r),A((r+(i-t))*ss.speed)},u.seek=function(C,E=!1){A(C-t,E)},u.pause=function(C){u.paused=!0,a&&(n=C??performance.now())},u.play=function(C){!u.paused||(u.completed&&u.reset(),u.paused=!1,ql.push(u),a&&n!==void 0&&(t+=(C??performance.now())-n),!gy&&k6.isUsingInternalRaf&&k6.play())},u.reverse=function(C=0){c(),u.completed=!u.reversed,t=void 0,i=C},u.restart=function(){u.reset(),t=void 0,i=0,u.play()},u.reset(),u.autoplay&&u.play(),u}function B6(e,t){for(var i=t.length;i--;)Wk(e,t[i].animatable.target)&&t.splice(i,1)}function $2e(e){for(var t=_Y(e),i=ql.length;i--;){var r=ql[i],n=r.animations,s=r.children;B6(t,n);for(var a=s.length;a--;){var o=s[a],l=o.animations;B6(t,l),!l.length&&!o.children.length&&s.splice(a,1)}!n.length&&!s.length&&r.pause()}}function eCe(e,t){t===void 0&&(t={});var i=t.direction||"normal",r=t.easing?Hk(t.easing):null,n=t.grid,s=t.axis,a=t.from||0,o=a==="first",l=a==="center",u=a==="last",c=wi.arr(e),h=parseFloat(c?e[0]:e),d=c?parseFloat(e[1]):0,p=Md(c?e[1]:e)||0,m=t.start||0+(c?h:0),v=[],g=0;return function(w,S,_){if(o&&(a=0),l&&(a=(_-1)/2),u&&(a=_-1),!v.length){for(var A=0;A<_;A++){if(!n)v.push(Math.abs(a-A));else{var C=l?(n[0]-1)/2:a%n[0],E=l?(n[1]-1)/2:Math.floor(a/n[0]),I=A%n[0],T=Math.floor(A/n[0]),D=C-I,L=E-T,z=Math.sqrt(D*D+L*L);s==="x"&&(z=-D),s==="y"&&(z=-L),v.push(z)}g=Math.max.apply(Math,v)}r&&(v=v.map(function(V){return r(V/g)*g})),i==="reverse"&&(v=v.map(function(V){return s?V<0?V*-1:-V:Math.abs(g-V)}))}var G=c?(d-h)/g:h;return m+G*(Math.round(v[S]*100)/100)+p}}function tCe(e){e===void 0&&(e={});var t=ss(e);return t.duration=0,t.add=function(i,r){var n=ql.indexOf(t),s=t.children;n>-1&&ql.splice(n,1);function a(d){d.passThrough=!0}for(var o=0;o<s.length;o++)a(s[o]);var l=oT(i,OL(jk,e));l.targets=l.targets||e.targets;var u=t.duration;l.autoplay=!1,l.timelineOffset=wi.und(r)?u:Qk(r,u),a(t);var c=ss(l);a(c),s.push(c),c.parent=t;var h=EY(s,e);return t.delay=h.delay,t.endDelay=h.endDelay,t.duration=h.duration,c.loop===!0&&(t.duration=1/0),t.seek(0),t.reset(),t.autoplay&&t.play(),t},t}ss.version="3.2.0";ss.speed=1;ss.running=ql;ss.remove=$2e;ss.get=Yk;ss.set=AY;ss.convertPx=qk;ss.path=j2e;ss.setDashoffset=U2e;ss.stagger=eCe;ss.timeline=tCe;ss.easing=Hk;ss.penner=pY;ss.random=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};var Og=ss,Gs=class extends li{constructor(e,t,i,r){super(e,t,i),this.isColorA=!0,this.a=r}setRGBA(e,t,i,r){super.setRGB(e,t,i),this.a=r}copy(e){return super.copy(e),this.a="a"in e?e.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}equals(e){return super.equals(e)&&this.a===e.a}setStyle(e,t="srgb"){let i;if(e==="transparent")return this.setRGBA(0,0,0,0),this;if(i=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(e)){let r,n=i[1],s=i[2];switch(n){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a=n==="rgba"?parseFloat(r[4]):1,super.setStyle(e,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a=n==="hsla"?parseFloat(r[4]):1,super.setStyle(e,t);break}}return super.setStyle(e,t)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(e){this.r=e}set y(e){this.g=e}set z(e){this.b=e}set w(e){this.a=e}},{degToRad:i6e,radToDeg:r6e}=Ot,N6=new H,F6=new H,U6=new xi,iCe=1e-4;function rCe(e,t,i,r){if(r===0)return i.copy(e);if(r===1)return i.copy(t);let n=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;if(n>=1)return i.copy(e);let s=1-n*n;if(s<=Number.EPSILON){let c=1-r;return i.w=c*e.w+r*t.w,i.x=c*e.x+r*t.x,i.y=c*e.y+r*t.y,i.z=c*e.z+r*t.z,i.normalize(),i}let a=Math.sqrt(s),o=Math.atan2(a,n),l=Math.sin((1-r)*o)/a,u=Math.sin(r*o)/a;return i.w=e.w*l+t.w*u,i.x=e.x*l+t.x*u,i.y=e.y*l+t.y*u,i.z=e.z*l+t.z*u,i}function fa(e,t,i,r,n,s){let a=i[e]!==void 0?i[e]:void 0,o=r[e];if(o==null)return;let l=a!=null?typeof a=="string"?Number(n.getVariable(a)??0):a:t[e],u=typeof o=="string"?Number(n.getVariable(o)??0):o;if(l!==u)return{update:c=>{let h=Ot.lerp(l,u,c);s?t[e]=Math.trunc(h):t[e]=h},start:()=>{t[e]=l},end:()=>{t[e]=u}}}function Zk(e,t,i,r,n,s){let a=i[e]?i[e]:void 0,o=r[e];if(!o)return;let l=t[e],u=[...a??l].map(h=>typeof h=="string"?Number(n.getVariable(h)??0):h),c=[...o].map(h=>typeof h=="string"?Number(n.getVariable(h)??0):h);if(!(u.length!==c.length||Ak(u,c)))return{update:h=>{u.forEach((d,p)=>{let m=Ot.lerp(d,c[p],h);t[e][p]=s?Math.trunc(m):m})},start:()=>{Object.assign(t[e],u)},end:()=>{Object.assign(t[e],c)}}}function Q2(e,t,i){return t.forEach((r,n)=>{e.setComponent(n,typeof r=="string"?Number(i.getVariable(r)??0):r)}),e}function V6(e,t,i,r,n){let s=i[e]?i[e]:void 0,a=r[e];if(!a)return;let o=t[e],l=s?Q2(new H,s,n):o.clone(),u=Q2(new H,a,n);if(!l.equals(u))return{update:c=>{o.lerpVectors(l,u,c)},start:()=>{o.copy(l)},end:()=>{o.copy(u)}}}function j6(e,t,i){return t.forEach((r,n)=>{e.setComponent(n,typeof r=="string"?Number(i.getVariable(r)??0):r)}),e}function K2(e,t,i,r,n){let s=i[e]?i[e]:void 0,a=r[e];if(!a)return;let o=t[e],l=!(o instanceof Pe),u=o instanceof Pe?o:new Pe().fromArray(o),c=s?j6(new Pe,s,n):u.clone(),h=j6(new Pe,a,n);if(!c.equals(h))return{update:d=>{u.lerpVectors(c,h,d),l&&(t[e]=u.toArray())},start:()=>{u.copy(c),l&&(t[e]=u.toArray())},end:()=>{u.copy(h),l&&(t[e]=u.toArray())}}}function nCe(e,t,i,r){let n=i[e]?i[e]:void 0,s=r[e];if(!s)return;let a=t[e],o=n?new yt().fromArray(n):a.clone(),l=new H,u=new xi,c=new H;o.decompose(l,u,c);let h=new yt().fromArray(s),d=new H,p=new xi,m=new H;if(h.decompose(d,p,m),!o.equals(h))return{update:v=>{U6.slerpQuaternions(u,p,v),N6.lerpVectors(l,d,v),F6.lerpVectors(c,m,v),a.compose(N6,U6,F6)},start:()=>{a.compose(l,u,c)},end:()=>{a.compose(d,p,m)}}}function sCe(e,t,i,r,n){let s=i[e]?i[e]:void 0,a=r[e];if(!a)return;let o=t[e],l=s?typeof s=="string"?n.getColor(s).clone():new li().setRGB(s.r,s.g,s.b):o.clone(),u=typeof a=="string"?n.getColor(a).clone():new li().setRGB(a.r,a.g,a.b);if(l.equals(u))return;let c=o.clone();return{update:h=>{c.lerpColors(l,u,h),t[e]?.copy?.(c)},start:()=>{c.copy(l)},end:()=>{c.copy(u)}}}function EA(e,t,i,r,n){let s=i[e]?i[e]:void 0,a=r[e];if(!a)return;let o=t[e],l=new Gs(o.r,o.g,o.b,o.a),u=s?typeof s=="string"?n.getColor(s).clone():new Gs(s.r,s.g,s.b,s.a):l.clone(),c=typeof a=="string"?n.getColor(a).clone():new Gs(a.r,a.g,a.b,a.a);if(!u.equals(c))return{update:h=>{l.lerpColors(u,c,h);let d=Ot.lerp(u.a,c.a,h);l.a=d,t[e]={r:l.r,g:l.g,b:l.b,a:l.a}},start:()=>{l.copy(u)},end:()=>{l.copy(c)}}}function qp(e,t,i,r,n){if(typeof t[e]=="number")return fa(e,t,i??{},r,n);if(Array.isArray(t[e]))return Zk(e,t,i??{},r,n)}function rp(e,t,i,r,n){let s=i[e],a=r[e];if(typeof t[e]=="number")Math.abs(s-a)>iCe&&(t[e]=Ot.lerp(s,a,n));else if(Array.isArray(t[e]))for(let o=0,l=s.length;o<l;o++)t[e][o]=Ot.lerp(s[o],a[o],n)}function aCe(e,t,i,r){let n=[];if(!("cloner"in i)||!e.cloner)return n;let s=e.cloner,a="cloner"in t?t.cloner:{},o=i.cloner;nY.forEach(p=>{let m;p==="count"?m=fa("count",s.parameters,a,o,r,!0):m=qp(p,s.parameters,a??{},o,r),m&&n.push(m)});let l=oCe(s,a,o,r);l?.length&&n.push(...l);let u=lCe(s,a,o,r);u?.length&&n.push(...u);let c=uCe(s,a,o,r);c?.length&&n.push(...c);let h=cCe(s,a,o,r);h?.length&&n.push(...h);let d=hCe(s,a,o,r);return d?.length&&n.push(...d),n.length&&n.push({update:()=>{s.update()}}),n}function oCe(e,t,i,r){if(e.parameters.type!=="radial")return;let n=t.radial,s=i.radial;if(!s)return;let a=e.parameters.radial,o=[];return kk.forEach(l=>{let u=qp(l,a,n??{},s,r);u&&o.push(u)}),o}function lCe(e,t,i,r){if(e.parameters.type!=="linear")return;let n=t.linear,s=i.linear;if(!s)return;let a=[],o=e.parameters.linear;return Bk.forEach(l=>{let u=qp(l,o,n??{},s,r);u&&a.push(u)}),a}function uCe(e,t,i,r){if(e.parameters.type!=="grid")return;let n=t.grid,s=i.grid;if(!s)return;let a=[],o=e.parameters.grid;return Nk.forEach(l=>{let u;l==="count"?u=Zk(l,o,n??{},s,r,!0):u=qp(l,o,n??{},s,r),u&&a.push(u)}),a}function cCe(e,t,i,r){if(e.parameters.type!=="toObject")return;let n=t.toObject,s=i.toObject;if(!s)return;let a=[],o=e.parameters.toObject;return Fk.forEach(l=>{let u;l==="count"?u=fa(l,o,n??{},s,r,!0):u=qp(l,o,n??{},s,r),u&&a.push(u)}),a}function hCe(e,t,i,r){if(!e.parameters.randomness)return;let n=t.randomnessObject,s=i.randomnessObject;if(!s)return;let a=[],o=e.parameters.randomnessObject;return Uk.forEach(l=>{let u=qp(l,o,n??{},s,r);u&&a.push(u)}),a}function dCe(e,t,i,r){let n=r.cloner?.parameters;if(n){rp("count",n,e,t,i),n.count=Math.trunc(n.count);for(let s of kk)rp(s,n.radial,e.radial,t.radial,i);for(let s of Bk)rp(s,n.linear,e.linear,t.linear,i);for(let s of Nk)rp(s,n.grid,e.grid,t.grid,i);for(let s of Fk)rp(s,n.toObject,e.toObject,t.toObject,i);return n}}function fCe(e,t,i,r){let n=r.cloner?.parameters;if(n){for(let s of Uk)rp(s,n.randomnessObject,e.randomnessObject,t.randomnessObject,i);return n}}function as(e,t=[0,0]){let i=e&&!isNaN(e[0])?e[0]:t[0],r=e&&!isNaN(e[1])?e[1]:t[1];return[i,r]}function so(e,t,i){switch(e){case 0:return"cubicBezier( 0, 0, 1, 1 )";case 1:return"cubicBezier( .25, .1, .25, 1 )";case 2:return"cubicBezier( .42, 0, 1, 1 )";case 3:return"cubicBezier( 0, 0, .58, 1 )";case 4:return"cubicBezier( .42, 0, .58, 1 )";case 7:return"cubicBezier( .25, 1, .5, 1 )";case 5:let{control1:r,control2:n}=t??{...L2.defaultData};return`cubicBezier( ${r[0]}, ${r[1]}, ${n[0]}, ${n[1]} )`;case 6:let{mass:s,stiffness:a,damping:o,velocity:l}=i??{...I2.defaultData},u=new _Ce(s,a,o,l),c=u.solve(1);return()=>h=>u.solve(h)/c;case 8:return()=>h=>Math.floor(h)}}var H6;(e=>{function t(i){return i&&typeof i.x=="number"&&typeof i.y=="number"&&typeof i.z=="number"}e.is=t})(H6||(H6={}));var kL;(e=>{function t(o,l){let u=[0,0],c=[1,1];if(o?.cubicControls)u=as(o.cubicControls.control1,u);else switch(o?.type){case 2:u=[.42,0];break;case 3:u=[0,0];break;case 4:u=[.42,0];break;case 1:u=[.25,.1];break;case 0:u=[0,0];break;case 7:u=[.25,1];break}if(l?.cubicControls)c=as(l.cubicControls.control2,c);else switch(l?.type){case 2:c=[1,1];break;case 3:c=[.58,1];break;case 4:c=[.58,1];break;case 1:c=[.25,1];break;case 0:c=[1,1];break;case 7:c=[.5,1];break}return{control1:u,control2:c}}e.getControlsWithDefault=t;function i(o,l){return{id:o,name:l,to:5,properties:new Xt}}e.defaultData=i;function r(o){let l=new Xt;return o.forEach(({data:u,id:c,fi:h})=>{if(u.type==="light"){let d=W6(["material",`${u.category} lighting`],c,h);l.push(d)}else{let d=W6(["material",u.type],c,h);l.push(d)}}),l}e.createMaterialGroup=r;function n(o){return Object.entries(o).reduce((l,[u,c])=>(typeof c!="string"&&l.push({name:c.name}),l),[])}e.createName=n;function s(o,l,u){let c=Og.timeline({easing:so(0),begin(){o.resetBBoxNeedsUpdate()},change(){o.resetBBoxNeedsUpdate()},direction:l.direction,autoplay:!1});return a(o,l,u).forEach(h=>c.add(h,0)),c.duration=l.to*1e3,c}e.createTimeline=s;function a(o,l,u,c){let h=[];return l.properties.forEach((d,p)=>{let m=d.data.path?.[0];if(m&&["position","rotation","scale"].includes(m)){let v=pCe(d.data,u?.[m]);v&&h.push(...v)}if(m&&m==="shape size"&&"geometry"in o){let v=mCe(o,d.data,u?.shapeSize);v&&h.push(...v)}if(m&&m==="path extrusion"&&o instanceof gT){let v=gCe(o,d.data,u?.pathExtrusion);v&&h.push(v)}if(m&&m==="path snapping"&&o.data.pathSnapping){let v=vCe(o,d.data,u?.pathSnapping);v&&h.push(v)}if(m&&m==="material"&&o.type==="Mesh"&&"material"in o&&o.material instanceof zd){let v=d.data.id;if(v){let g=o.material.getLayerByUuid(v);if(g){let w=G6(g,d.data,u?.material,c);w&&h.push(w)}else{let w=o.material.getLayersOfType(d.data.type);if(w)for(let S of w){let _=G6(S,d.data,u?.material,c);_&&h.push(_)}}}}if(m&&m==="opacity"&&o.type==="Mesh"&&"material"in o){let v=yCe(d.data,u?.opacity);v&&h.push(v)}if(m&&m==="cloner"){let v=xCe(o,d.data,u?.cloner);v&&h.push(v)}if(m&&m==="camera"&&o instanceof Ms){let v=wCe(o,d.data,u?.camera,"zoom");v&&h.push(v)}if(m&&m==="light"&&(o instanceof fT||o instanceof CB||o instanceof pT)){let v=bCe(o,d.data,u?.light,d.data.path[1],c);v&&h.push(v)}}),h}e.addKeyframesToTimeline=a,e.Presets=[{name:"Slide in",animationParams:{translateX:{value:[-20,0],easing:so(3),duration:1e3},opacity:{value:[0,1],easing:so(3),duration:1e3},endDelay:250,loop:!0}},{name:"Rotate",animationParams:{rotate:{value:[0,"1turn"],easing:so(5),duration:700},endDelay:250,loop:!0}},{name:"Scale Out",animationParams:{scale:{value:[1,1.5],easing:so(4),duration:1e3},endDelay:250,loop:!0}},{name:"Jump",animationParams:{translateY:[{value:0,duration:200,easing:"linear"},{value:-20,easing:"linear",duration:200},{value:0,easing:"linear",duration:100}],endDelay:500,loop:!0}},{name:"Jump Rotate",animationParams:{translateY:[{value:0,duration:200,easing:"linear"},{value:-20,easing:"linear",duration:200},{value:0,easing:"linear",duration:100}],rotate:{value:[0,"1turn"],easing:so(5),duration:500},endDelay:500,loop:!0}},{name:"Bounce",animationParams:{translateY:{value:["20px","-20px"],duration:575,easing:"easeOutQuad"},direction:"alternate",loop:!0}}]})(kL||(kL={}));function W6(e,t,i){let r=t;return{id:r,fi:i,data:{id:r,path:e,keyframes:new Xt}}}var CY=["x","y","z"];function pCe(e,t=()=>{}){let i=[];for(let r of CY){let n=[...e.keyframes??[]].filter(o=>o.data.value[r]!==void 0).sort((o,l)=>o.data.time-l.data.time),s=n[0];s&&t?.(s.data.value);let a={index:[],t:[]};for(let o=0;o<n.length-1;o++){let l=n[o],u=n[o+1]??l,c={duration:(u?.data?.time-l.data.time)*1e3,delay:o===0?n[0].data.time*1e3:0};o<n.length-1&&(a.t.push({...c,value:o%2===0?1:0,easing:so(l.data.easing.type,{control1:as(l.data.easing.cubicControls?.control1,[0,0]),control2:as(u.data.easing.cubicControls?.control2,[1,1])},l.data.easing.springParameters)}),a.index.push({...c,value:o,easing:"linear"}))}if(n.length>1){let o={t:0,index:0};i.push({targets:o,...a,update:l=>{let u=Math.ceil(o.index),c=u%2===0?o.t:1-o.t,h=n?.[u].data.value,d=n?.[u+1]?.data.value;if(h!==void 0&&d!==void 0){let p={[r]:h[r]+(d[r]-h[r])*c};t?.(p)}}})}}return i}function mCe(e,t,i){let r=[];for(let n of CY){let s={},a=[...t.keyframes??[]].filter(l=>l.data.value[n]!==void 0).sort((l,u)=>l.data.time-u.data.time),o=a[0];o&&i?.(o.data.value),s={index:[],t:[]};for(let l=0;l<a.length-1;l++){let u=a[l],c=a[l+1]??u,h={duration:(c?.data?.time-u.data.time)*1e3,delay:l===0?a[0].data.time*1e3:0};l<a.length-1&&(s.t.push({...h,value:l%2===0?1:0,easing:so(u.data.easing.type,{control1:as(u.data.easing.cubicControls?.control1,[0,0]),control2:as(c.data.easing.cubicControls?.control2,[1,1])},u.data.easing.springParameters)}),s.index.push({...h,value:l,easing:"linear"}))}if(a.length>1){let l={t:0,index:0};r.push({targets:l,...s,update:u=>{let c=Math.ceil(l.index),h=c%2===0?l.t:1-l.t,d=a?.[c].data.value,p=a?.[c+1]?.data.value;if(d!==void 0&&p!==void 0){let m={[n]:d[n]+(p[n]-d[n])*h};i?.(m)}}})}}return r}function gCe(e,t,i){let r={},n=[...t.keyframes??[]].sort((a,o)=>a.data.time-o.data.time),s=n[0];s&&i?.(e,s.data.value),r={index:[],t:[]};for(let a=0;a<n.length-1;a++){let o=n[a],l=n[a+1]??o,u={duration:(l?.data?.time-o.data.time)*1e3,delay:a===0?n[0].data.time*1e3:0};a<n.length-1&&(r.t.push({...u,value:a%2===0?1:0,easing:so(o.data.easing.type,{control1:as(o.data.easing.cubicControls?.control1,[0,0]),control2:as(l.data.easing.cubicControls?.control2,[1,1])},o.data.easing.springParameters)}),r.index.push({...u,value:a,easing:"linear"}))}if(n.length>1){let a={t:0,index:0};return{targets:a,...r,update:o=>{let l=Math.ceil(a.index),u=l%2===0?a.t:1-a.t,c=n?.[Math.min(l,n.length-1)].data.value,h=n?.[Math.min(l,n.length-1)+1]?.data.value;i?.(e,zze(e,c,h,u))}}}}function vCe(e,t,i){let r={},n=[...t.keyframes??[]].sort((a,o)=>a.data.time-o.data.time),s=n[0];s&&i?.(s.data.value),r={index:[],t:[]};for(let a=0;a<n.length-1;a++){let o=n[a],l=n[a+1]??o,u={duration:(l?.data?.time-o.data.time)*1e3,delay:a===0?n[0].data.time*1e3:0};a<n.length-1&&(r.t.push({...u,value:a%2===0?1:0,easing:so(o.data.easing.type,{control1:as(o.data.easing.cubicControls?.control1,[0,0]),control2:as(l.data.easing.cubicControls?.control2,[1,1])},o.data.easing.springParameters)}),r.index.push({...u,value:a,easing:"linear"}))}if(n.length>1){let a={t:0,index:0};return{targets:a,...r,update:o=>{let l=Math.ceil(a.index),u=l%2===0?a.t:1-a.t,c=n?.[Math.min(l,n.length-1)].data.value,h=n?.[Math.min(l,n.length-1)+1]?.data.value;i?.(kze(e,c,h,u))}}}}function G6(e,t,i,r){if(t){let n={},s=[...t.keyframes??[]].sort((a,o)=>a.data.time-o.data.time);if("data"in e){let a=s[0];a&&i?.(a.data.value,e),n={index:[],t:[]};for(let o=0;o<s.length-1;o++){let l=s[o],u=s[o+1]??l,c={duration:(u?.data?.time-l.data.time)*1e3,delay:o===0?s[0].data.time*1e3:0};o<s.length-1&&(n.t.push({...c,value:o%2===0?1:0,easing:so(l.data.easing.type,{control1:as(l.data.easing.cubicControls?.control1,[0,0]),control2:as(u.data.easing.cubicControls?.control2,[1,1])},l.data.easing.springParameters)}),n.index.push({...c,value:o,easing:"linear"}))}if(s.length>1){let o={t:0,index:0};return{targets:o,...n,update:l=>{let u=Math.ceil(o.index),c=u%2===0?o.t:1-o.t,h=s?.[Math.min(u,s.length-1)].data.value,d=s?.[Math.min(u,s.length-1)+1]?.data.value,p={},m={};if(Object.keys(h).length>0&&Object.keys(d).length>0){for(let v in e.data)if(v in h&&v in d){let g=Jk(h[v],d[v],c,r);g!==void 0&&(p[v]=g,m[v]={start:h,end:d,t:c})}}i?.({...p},e,m)}}}}}}function yCe(e,t){if(e){let i={},r=[...e.keyframes??[]].sort((s,a)=>s.data.time-a.data.time),n=r[0];n&&t?.(n.data.value),i={index:[],t:[]};for(let s=0;s<r.length-1;s++){let a=r[s],o=r[s+1]??a,l={duration:(o?.data?.time-a.data.time)*1e3,delay:s===0?r[0].data.time*1e3:0};s<r.length-1&&(i.t.push({...l,value:s%2===0?1:0,easing:so(a.data.easing.type,{control1:as(a.data.easing.cubicControls?.control1,[0,0]),control2:as(o.data.easing.cubicControls?.control2,[1,1])},a.data.easing.springParameters)}),i.index.push({...l,value:s,easing:"linear"}))}if(r.length>1){let s={t:0,index:0};return{targets:s,...i,update:a=>{let o=Math.ceil(s.index),l=o%2===0?s.t:1-s.t,u=r?.[Math.min(o,r.length-1)].data.value,c=r?.[Math.min(o,r.length-1)+1]?.data.value,h=Ot.lerp(u,c,l);t?.(h)}}}}}function xCe(e,t,i){let r={},n=[...t.keyframes??[]].sort((a,o)=>a.data.time-o.data.time),s=n[0];s&&i?.(e,s.data.value,s.data.value),r={index:[],t:[]};for(let a=0;a<n.length-1;a++){let o=n[a],l=n[a+1]??o,u={duration:(l?.data?.time-o.data.time)*1e3,delay:a===0?n[0].data.time*1e3:0};a<n.length-1&&(r.t.push({...u,value:a%2===0?1:0,easing:so(o.data.easing.type,{control1:as(o.data.easing.cubicControls?.control1,[0,0]),control2:as(l.data.easing.cubicControls?.control2,[1,1])},o.data.easing.springParameters)}),r.index.push({...u,value:a,easing:"linear"}))}if(n.length>1){let a={t:0,index:0};return{targets:a,...r,update:o=>{let l=Math.ceil(a.index),u=l%2===0?a.t:1-a.t,c=n?.[Math.min(l,n.length-1)].data.value,h=n?.[Math.min(l,n.length-1)+1]?.data.value;i?.(e,c.randomnessObject?void 0:dCe(c,h,u,e),c.randomnessObject?fCe(c,h,u,e):void 0)}}}}function Jk(e,t,i,r){if(typeof e=="string"&&r&&(e=r.color(e)),typeof t=="string"&&r&&(e=r.color(t)),typeof e=="number")return e===t?void 0:Ot.lerp(e,t,i);if(mr.is(e))return mr.lerp(e,t,i);if(es.is(e))return es.lerp(e,t,i);if(Array.isArray(e))return(e.length>t.length?t:e).map((n,s,a)=>{if(Array.isArray(n)){let o=e[s].length>t[s].length?t[s].length:e[s].length;return(o===4?t_:o===3?Sp:Fc).lerp(e[s],t[s],i)}else return Ot.lerp(e[s],t[s],i)});if(typeof e=="object"&&e!==null){let n={};for(let s in e){let a=Jk(e[s],t[s],i,r);a!==void 0&&(n[s]=a)}return n}}function wCe(e,t,i,r){if(t){let n={[r]:[]},s=[...t.keyframes??[]].sort((o,l)=>o.data.time-l.data.time),a=s[0];a&&(e[r]=a.data.value,a&&i?.(r,a.data.value));for(let o=0;o<s.length-1;o++){let l=s[o];if(!Number.isFinite(l.data.value))continue;let u=s[o+1]??l,c=u.data.value;n[r].push({value:c,easing:so(l.data.easing.type,{control1:as(l.data.easing.cubicControls?.control1,[0,0]),control2:as(u.data.easing.cubicControls?.control2,[1,1])},l.data.easing.springParameters),duration:(u?.data?.time-l.data.time)*1e3,delay:o===0?s[0].data.time*1e3:0})}if(s.length>1)return{targets:e,...n,update:()=>{i?.(r,e[r])}}}}function bCe(e,t,i,r,n){if(t){let s={},a=[...t.keyframes??[]].sort((l,u)=>l.data.time-u.data.time),o=a[0];if(o){let l=o.data.value;e[r]=l,i?.(r,l)}s={index:[],t:[]};for(let l=0;l<a.length-1;l++){let u=a[l],c=a[l+1]??u,h={duration:(c?.data?.time-u.data.time)*1e3,delay:l===0?a[0].data.time*1e3:0};l<a.length-1&&(s.t.push({...h,value:l%2===0?1:0,easing:so(u.data.easing.type,{control1:as(u.data.easing.cubicControls?.control1,[0,0]),control2:as(c.data.easing.cubicControls?.control2,[1,1])},u.data.easing.springParameters)}),s.index.push({...h,value:l,easing:"linear"}))}if(a.length>1){let l={t:0,index:0};return{targets:l,...s,update:()=>{let u=Math.ceil(l.index),c=u%2===0?l.t:1-l.t,h=a?.[Math.min(u,a.length-1)].data.value,d=a?.[Math.min(u,a.length-1)+1]?.data.value,p=Jk(h,d,c,n);i?.(r,p)}}}}}var _Ce=class{constructor(e=1,t=100,i=10,r=0){this.mass=e,this.stiffness=t,this.damping=i,this.initialVelocity=r,this.m_w0=Math.sqrt(t/e),this.m_zeta=i/(2*Math.sqrt(t*e)),this.m_zeta<1?(this.m_wd=this.m_w0*Math.sqrt(1-this.m_zeta*this.m_zeta),this.m_A=1,this.m_B=(this.m_zeta*this.m_w0+-r)/this.m_wd):(this.m_wd=0,this.m_A=1,this.m_B=-r+this.m_w0)}solve(e){return this.m_zeta<1?e=Math.exp(-e*this.m_zeta*this.m_w0)*(this.m_A*Math.cos(this.m_wd*e)+this.m_B*Math.sin(this.m_wd*e)):e=(this.m_A+this.m_B*e)*Math.exp(-e*this.m_w0),1-e}getDuration(){let e=.16666666666666666,t=0,i=0;for(;;)if(t+=e,this.solve(t)===1){if(i++,i>=16)break}else i=0;return t*e*1e3}},SCe=Math.pow(2,-24),CA=class{constructor(){}};function kc(e,t,i){return i.min.x=t[e],i.min.y=t[e+1],i.min.z=t[e+2],i.max.x=t[e+3],i.max.y=t[e+4],i.max.z=t[e+5],i}function q6(e){let t=-1,i=-1/0;for(let r=0;r<3;r++){let n=e[r+3]-e[r];n>i&&(i=n,t=r)}return t}function X6(e,t){t.set(e)}function Y6(e,t,i){let r,n;for(let s=0;s<3;s++){let a=s+3;r=e[s],n=t[s],i[s]=r<n?r:n,r=e[a],n=t[a],i[a]=r>n?r:n}}function TA(e,t,i){for(let r=0;r<3;r++){let n=t[e+2*r],s=t[e+2*r+1],a=n-s,o=n+s;a<i[r]&&(i[r]=a),o>i[r+3]&&(i[r+3]=o)}}function vw(e){let t=e[3]-e[0],i=e[4]-e[1],r=e[5]-e[2];return 2*(t*i+i*r+r*t)}function MCe(e,t){if(!e.index){let i=e.attributes.position.count,r=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,n;i>65535?n=new Uint32Array(new r(4*i)):n=new Uint16Array(new r(2*i)),e.setIndex(new hi(n,1));for(let s=0;s<i;s++)n[s]=s}}function ACe(e){if(!e.groups||!e.groups.length)return[{offset:0,count:e.index.count/3}];let t=[],i=new Set;for(let n of e.groups)i.add(n.start),i.add(n.start+n.count);let r=Array.from(i.values()).sort((n,s)=>n-s);for(let n=0;n<r.length-1;n++){let s=r[n],a=r[n+1];t.push({offset:s/3,count:(a-s)/3})}return t}function tD(e,t,i,r,n=null){let s=1/0,a=1/0,o=1/0,l=-1/0,u=-1/0,c=-1/0,h=1/0,d=1/0,p=1/0,m=-1/0,v=-1/0,g=-1/0,w=n!==null;for(let S=t*6,_=(t+i)*6;S<_;S+=6){let A=e[S+0],C=e[S+1],E=A-C,I=A+C;E<s&&(s=E),I>l&&(l=I),w&&A<h&&(h=A),w&&A>m&&(m=A);let T=e[S+2],D=e[S+3],L=T-D,z=T+D;L<a&&(a=L),z>u&&(u=z),w&&T<d&&(d=T),w&&T>v&&(v=T);let G=e[S+4],V=e[S+5],j=G-V,J=G+V;j<o&&(o=j),J>c&&(c=J),w&&G<p&&(p=G),w&&G>g&&(g=G)}r[0]=s,r[1]=a,r[2]=o,r[3]=l,r[4]=u,r[5]=c,w&&(n[0]=h,n[1]=d,n[2]=p,n[3]=m,n[4]=v,n[5]=g)}function ECe(e,t,i,r){let n=1/0,s=1/0,a=1/0,o=-1/0,l=-1/0,u=-1/0;for(let c=t*6,h=(t+i)*6;c<h;c+=6){let d=e[c+0];d<n&&(n=d),d>o&&(o=d);let p=e[c+2];p<s&&(s=p),p>l&&(l=p);let m=e[c+4];m<a&&(a=m),m>u&&(u=m)}r[0]=n,r[1]=s,r[2]=a,r[3]=o,r[4]=l,r[5]=u}function CCe(e,t,i,r,n){let s=i,a=i+r-1,o=n.pos,l=n.axis*2;for(;;){for(;s<=a&&t[s*6+l]<o;)s++;for(;s<=a&&t[a*6+l]>=o;)a--;if(s<a){for(let u=0;u<3;u++){let c=e[s*3+u];e[s*3+u]=e[a*3+u],e[a*3+u]=c;let h=t[s*6+u*2+0];t[s*6+u*2+0]=t[a*6+u*2+0],t[a*6+u*2+0]=h;let d=t[s*6+u*2+1];t[s*6+u*2+1]=t[a*6+u*2+1],t[a*6+u*2+1]=d}s++,a--}else return s}}var Jh=32,TCe=(e,t)=>e.candidate-t.candidate,Ff=new Array(Jh).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),PA=new Float32Array(6);function PCe(e,t,i,r,n,s){let a=-1,o=0;if(s===0)a=q6(t),a!==-1&&(o=(t[a]+t[a+3])/2);else if(s===1)a=q6(e),a!==-1&&(o=DCe(i,r,n,a));else if(s===2){let l=vw(e),u=1.25*n,c=r*6,h=(r+n)*6;for(let d=0;d<3;d++){let p=t[d],m=(t[d+3]-p)/Jh;if(n<Jh/4){let v=[...Ff];v.length=n;let g=0;for(let S=c;S<h;S+=6,g++){let _=v[g];_.candidate=i[S+2*d],_.count=0;let{bounds:A,leftCacheBounds:C,rightCacheBounds:E}=_;for(let I=0;I<3;I++)E[I]=1/0,E[I+3]=-1/0,C[I]=1/0,C[I+3]=-1/0,A[I]=1/0,A[I+3]=-1/0;TA(S,i,A)}v.sort(TCe);let w=n;for(let S=0;S<w;S++){let _=v[S];for(;S+1<w&&v[S+1].candidate===_.candidate;)v.splice(S+1,1),w--}for(let S=c;S<h;S+=6){let _=i[S+2*d];for(let A=0;A<w;A++){let C=v[A];_>=C.candidate?TA(S,i,C.rightCacheBounds):(TA(S,i,C.leftCacheBounds),C.count++)}}for(let S=0;S<w;S++){let _=v[S],A=_.count,C=n-_.count,E=_.leftCacheBounds,I=_.rightCacheBounds,T=0;A!==0&&(T=vw(E)/l);let D=0;C!==0&&(D=vw(I)/l);let L=1+1.25*(T*A+D*C);L<u&&(a=d,u=L,o=_.candidate)}}else{for(let w=0;w<Jh;w++){let S=Ff[w];S.count=0,S.candidate=p+m+w*m;let _=S.bounds;for(let A=0;A<3;A++)_[A]=1/0,_[A+3]=-1/0}for(let w=c;w<h;w+=6){let S=~~((i[w+2*d]-p)/m);S>=Jh&&(S=Jh-1);let _=Ff[S];_.count++,TA(w,i,_.bounds)}let v=Ff[Jh-1];X6(v.bounds,v.rightCacheBounds);for(let w=Jh-2;w>=0;w--){let S=Ff[w],_=Ff[w+1];Y6(S.bounds,_.rightCacheBounds,S.rightCacheBounds)}let g=0;for(let w=0;w<Jh-1;w++){let S=Ff[w],_=S.count,A=S.bounds,C=Ff[w+1].rightCacheBounds;_!==0&&(g===0?X6(A,PA):Y6(A,PA,PA)),g+=_;let E=0,I=0;g!==0&&(E=vw(PA)/l);let T=n-g;T!==0&&(I=vw(C)/l);let D=1+1.25*(E*g+I*T);D<u&&(a=d,u=D,o=S.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:a,pos:o}}function DCe(e,t,i,r){let n=0;for(let s=t,a=t+i;s<a;s++)n+=e[s*6+r*2];return n/i}function RCe(e,t){let i=e.attributes.position,r=e.index.array,n=r.length/3,s=new Float32Array(n*6),a=i.normalized,o=i.array,l=i.offset||0,u=3;i.isInterleavedBufferAttribute&&(u=i.data.stride);let c=["getX","getY","getZ"];for(let h=0;h<n;h++){let d=h*3,p=h*6,m,v,g;a?(m=r[d+0],v=r[d+1],g=r[d+2]):(m=r[d+0]*u+l,v=r[d+1]*u+l,g=r[d+2]*u+l);for(let w=0;w<3;w++){let S,_,A;a?(S=i[c[w]](m),_=i[c[w]](v),A=i[c[w]](g)):(S=o[m+w],_=o[v+w],A=o[g+w]);let C=S;_<C&&(C=_),A<C&&(C=A);let E=S;_>E&&(E=_),A>E&&(E=A);let I=(E-C)/2,T=w*2;s[p+T+0]=C+I,s[p+T+1]=I+(Math.abs(C)+I)*SCe,C<t[w]&&(t[w]=C),E>t[w+3]&&(t[w+3]=E)}}return s}function ICe(e,t){function i(w){d&&d(w/p)}function r(w,S,_,A=null,C=0){if(!m&&C>=l&&(m=!0,u&&(console.warn(`MeshBVH: Max depth of ${l} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),_<=c||C>=l)return i(S+_),w.offset=S,w.count=_,w;let E=PCe(w.boundingData,A,a,S,_,h);if(E.axis===-1)return i(S+_),w.offset=S,w.count=_,w;let I=CCe(o,a,S,_,E);if(I===S||I===S+_)i(S+_),w.offset=S,w.count=_;else{w.splitAxis=E.axis;let T=new CA,D=S,L=I-S;w.left=T,T.boundingData=new Float32Array(6),tD(a,D,L,T.boundingData,s),r(T,D,L,s,C+1);let z=new CA,G=I,V=_-L;w.right=z,z.boundingData=new Float32Array(6),tD(a,G,V,z.boundingData,s),r(z,G,V,s,C+1)}return w}MCe(e,t);let n=new Float32Array(6),s=new Float32Array(6),a=RCe(e,n),o=e.index.array,l=t.maxDepth,u=t.verbose,c=t.maxLeafTris,h=t.strategy,d=t.onProgress,p=e.index.count/3,m=!1,v=[],g=ACe(e);if(g.length===1){let w=g[0],S=new CA;S.boundingData=n,ECe(a,w.offset,w.count,s),r(S,w.offset,w.count,s),v.push(S)}else for(let w of g){let S=new CA;S.boundingData=new Float32Array(6),tD(a,w.offset,w.count,S.boundingData,s),r(S,w.offset,w.count,s),v.push(S)}return v}function LCe(e,t){let i=ICe(e,t),r,n,s,a=[],o=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let c=0;c<i.length;c++){let h=i[c],d=l(h),p=new o(32*d);r=new Float32Array(p),n=new Uint32Array(p),s=new Uint16Array(p),u(0,h),a.push(p)}return a;function l(c){return c.count?1:1+l(c.left)+l(c.right)}function u(c,h){let d=c/4,p=c/2,m=!!h.count,v=h.boundingData;for(let g=0;g<6;g++)r[d+g]=v[g];if(m){let g=h.offset,w=h.count;return n[d+6]=g,s[p+14]=w,s[p+15]=65535,c+32}else{let g=h.left,w=h.right,S=h.splitAxis,_;if(_=u(c+32,g),_/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[d+6]=_/4,_=u(_,w),n[d+7]=S,_}}}var Ld=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let i=1/0,r=-1/0;for(let n=0,s=e.length;n<s;n++){let a=e[n][t];i=a<i?a:i,r=a>r?a:r}this.min=i,this.max=r}setFromPoints(e,t){let i=1/0,r=-1/0;for(let n=0,s=t.length;n<s;n++){let a=t[n],o=e.dot(a);i=o<i?o:i,r=o>r?o:r}this.min=i,this.max=r}isSeparated(e){return this.min>e.max||e.min>this.max}};Ld.prototype.setFromBox=(function(){let e=new H;return function(t,i){let r=i.min,n=i.max,s=1/0,a=-1/0;for(let o=0;o<=1;o++)for(let l=0;l<=1;l++)for(let u=0;u<=1;u++){e.x=r.x*o+n.x*(1-o),e.y=r.y*l+n.y*(1-l),e.z=r.z*u+n.z*(1-u);let c=t.dot(e);s=Math.min(c,s),a=Math.max(c,a)}this.min=s,this.max=a}})();var OCe=(function(){let e=new H,t=new H,i=new H;return function(r,n,s){let a=r.start,o=e,l=n.start,u=t;i.subVectors(a,l),e.subVectors(r.end,r.start),t.subVectors(n.end,n.start);let c=i.dot(u),h=u.dot(o),d=u.dot(u),p=i.dot(o),m=o.dot(o)*d-h*h,v,g;m!==0?v=(c*h-p*d)/m:v=0,g=(c+v*h)/d,s.x=v,s.y=g}})(),$k=(function(){let e=new Pe,t=new H,i=new H;return function(r,n,s,a){OCe(r,n,e);let o=e.x,l=e.y;if(o>=0&&o<=1&&l>=0&&l<=1){r.at(o,s),n.at(l,a);return}else if(o>=0&&o<=1){l<0?n.at(0,a):n.at(1,a),r.closestPointToPoint(a,!0,s);return}else if(l>=0&&l<=1){o<0?r.at(0,s):r.at(1,s),n.closestPointToPoint(s,!0,a);return}else{let u;o<0?u=r.start:u=r.end;let c;l<0?c=n.start:c=n.end;let h=t,d=i;if(r.closestPointToPoint(c,!0,t),n.closestPointToPoint(u,!0,i),h.distanceToSquared(c)<=d.distanceToSquared(u)){s.copy(h),a.copy(c);return}else{s.copy(u),a.copy(d);return}}}})(),zCe=(function(){let e=new H,t=new H,i=new Oo,r=new Gl;return function(n,s){let{radius:a,center:o}=n,{a:l,b:u,c}=s;if(r.start=l,r.end=u,r.closestPointToPoint(o,!0,e).distanceTo(o)<=a||(r.start=l,r.end=c,r.closestPointToPoint(o,!0,e).distanceTo(o)<=a)||(r.start=u,r.end=c,r.closestPointToPoint(o,!0,e).distanceTo(o)<=a))return!0;let h=s.getPlane(i);if(Math.abs(h.distanceToPoint(o))<=a){let d=h.projectPoint(o,t);if(s.containsPoint(d))return!0}return!1}})(),kCe=1e-15;function X0(e){return Math.abs(e)<kCe}var Od=class extends pa{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new H),this.satBounds=new Array(4).fill().map(()=>new Ld),this.points=[this.a,this.b,this.c],this.sphere=new Wo,this.plane=new Oo,this.needsUpdate=!0}intersectsSphere(e){return zCe(e,this)}update(){let e=this.a,t=this.b,i=this.c,r=this.points,n=this.satAxes,s=this.satBounds,a=n[0],o=s[0];this.getNormal(a),o.setFromPoints(a,r);let l=n[1],u=s[1];l.subVectors(e,t),u.setFromPoints(l,r);let c=n[2],h=s[2];c.subVectors(t,i),h.setFromPoints(c,r);let d=n[3],p=s[3];d.subVectors(i,e),p.setFromPoints(d,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,e),this.needsUpdate=!1}};Od.prototype.closestPointToSegment=(function(){let e=new H,t=new H,i=new Gl;return function(r,n=null,s=null){let{start:a,end:o}=r,l=this.points,u,c=1/0;for(let h=0;h<3;h++){let d=(h+1)%3;i.start.copy(l[h]),i.end.copy(l[d]),$k(i,r,e,t),u=e.distanceToSquared(t),u<c&&(c=u,n&&n.copy(e),s&&s.copy(t))}return this.closestPointToPoint(a,e),u=a.distanceToSquared(e),u<c&&(c=u,n&&n.copy(e),s&&s.copy(a)),this.closestPointToPoint(o,e),u=o.distanceToSquared(e),u<c&&(c=u,n&&n.copy(e),s&&s.copy(o)),Math.sqrt(c)}})();Od.prototype.intersectsTriangle=(function(){let e=new Od,t=new Array(3),i=new Array(3),r=new Ld,n=new Ld,s=new H,a=new H,o=new H,l=new H,u=new Gl,c=new Gl,h=new Gl;return function(d,p=null,m=!1){this.needsUpdate&&this.update(),d.isExtendedTriangle?d.needsUpdate&&d.update():(e.copy(d),e.update(),d=e);let v=this.plane,g=d.plane;if(Math.abs(v.normal.dot(g.normal))>1-1e-10){let w=this.satBounds,S=this.satAxes;i[0]=d.a,i[1]=d.b,i[2]=d.c;for(let C=0;C<4;C++){let E=w[C],I=S[C];if(r.setFromPoints(I,i),E.isSeparated(r))return!1}let _=d.satBounds,A=d.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let C=0;C<4;C++){let E=_[C],I=A[C];if(r.setFromPoints(I,t),E.isSeparated(r))return!1}for(let C=0;C<4;C++){let E=S[C];for(let I=0;I<4;I++){let T=A[I];if(s.crossVectors(E,T),r.setFromPoints(s,t),n.setFromPoints(s,i),r.isSeparated(n))return!1}}return p&&(m||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),p.start.set(0,0,0),p.end.set(0,0,0)),!0}else{let w=this.points,S=!1,_=0;for(let V=0;V<3;V++){let j=w[V],J=w[(V+1)%3];u.start.copy(j),u.end.copy(J),u.delta(a);let ne=S?c.start:c.end,K=X0(g.distanceToPoint(j));if(X0(g.normal.dot(a))&&K){c.copy(u),_=2;break}if((g.intersectLine(u,ne)||K)&&!X0(ne.distanceTo(J))){if(_++,S)break;S=!0}}if(_===1&&d.containsPoint(c.end))return p&&(p.start.copy(c.end),p.end.copy(c.end)),!0;if(_!==2)return!1;let A=d.points,C=!1,E=0;for(let V=0;V<3;V++){let j=A[V],J=A[(V+1)%3];u.start.copy(j),u.end.copy(J),u.delta(o);let ne=C?h.start:h.end,K=X0(v.distanceToPoint(j));if(X0(v.normal.dot(o))&&K){h.copy(u),E=2;break}if((v.intersectLine(u,ne)||K)&&!X0(ne.distanceTo(J))){if(E++,C)break;C=!0}}if(E===1&&this.containsPoint(h.end))return p&&(p.start.copy(h.end),p.end.copy(h.end)),!0;if(E!==2)return!1;if(c.delta(a),h.delta(o),a.dot(o)<0){let V=h.start;h.start=h.end,h.end=V}let I=c.start.dot(a),T=c.end.dot(a),D=h.start.dot(a),L=h.end.dot(a),z=T<D,G=I<L;return I!==L&&D!==T&&z===G?!1:(p&&(l.subVectors(c.start,h.start),l.dot(a)>0?p.start.copy(c.start):p.start.copy(h.start),l.subVectors(c.end,h.end),l.dot(a)<0?p.end.copy(c.end):p.end.copy(h.end)),!0)}}})();Od.prototype.distanceToPoint=(function(){let e=new H;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}})();Od.prototype.distanceToTriangle=(function(){let e=new H,t=new H,i=["a","b","c"],r=new Gl,n=new Gl;return function(s,a=null,o=null){let l=a||o?r:null;if(this.intersectsTriangle(s,l))return(a||o)&&(a&&l.getCenter(a),o&&l.getCenter(o)),0;let u=1/0;for(let c=0;c<3;c++){let h,d=i[c],p=s[d];this.closestPointToPoint(p,e),h=p.distanceToSquared(e),h<u&&(u=h,a&&a.copy(e),o&&o.copy(p));let m=this[d];s.closestPointToPoint(m,e),h=m.distanceToSquared(e),h<u&&(u=h,a&&a.copy(m),o&&o.copy(e))}for(let c=0;c<3;c++){let h=i[c],d=i[(c+1)%3];r.set(this[h],this[d]);for(let p=0;p<3;p++){let m=i[p],v=i[(p+1)%3];n.set(s[m],s[v]),$k(r,n,e,t);let g=e.distanceToSquared(t);g<u&&(u=g,a&&a.copy(e),o&&o.copy(t))}}return Math.sqrt(u)}})();var $c=class{constructor(e,t,i){this.isOrientedBox=!0,this.min=new H,this.max=new H,this.matrix=new yt,this.invMatrix=new yt,this.points=new Array(8).fill().map(()=>new H),this.satAxes=new Array(3).fill().map(()=>new H),this.satBounds=new Array(3).fill().map(()=>new Ld),this.alignedSatBounds=new Array(3).fill().map(()=>new Ld),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),i&&this.matrix.copy(i)}set(e,t,i){this.min.copy(e),this.max.copy(t),this.matrix.copy(i),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}};$c.prototype.update=(function(){return function(){let e=this.matrix,t=this.min,i=this.max,r=this.points;for(let l=0;l<=1;l++)for(let u=0;u<=1;u++)for(let c=0;c<=1;c++){let h=1*l|2*u|4*c,d=r[h];d.x=l?i.x:t.x,d.y=u?i.y:t.y,d.z=c?i.z:t.z,d.applyMatrix4(e)}let n=this.satBounds,s=this.satAxes,a=r[0];for(let l=0;l<3;l++){let u=s[l],c=n[l],h=1<<l,d=r[h];u.subVectors(a,d),c.setFromPoints(u,r)}let o=this.alignedSatBounds;o[0].setFromPointsField(r,"x"),o[1].setFromPointsField(r,"y"),o[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}})();$c.prototype.intersectsBox=(function(){let e=new Ld;return function(t){this.needsUpdate&&this.update();let i=t.min,r=t.max,n=this.satBounds,s=this.satAxes,a=this.alignedSatBounds;if(e.min=i.x,e.max=r.x,a[0].isSeparated(e)||(e.min=i.y,e.max=r.y,a[1].isSeparated(e))||(e.min=i.z,e.max=r.z,a[2].isSeparated(e)))return!1;for(let o=0;o<3;o++){let l=s[o],u=n[o];if(e.setFromBox(l,t),u.isSeparated(e))return!1}return!0}})();$c.prototype.intersectsTriangle=(function(){let e=new Od,t=new Array(3),i=new Ld,r=new Ld,n=new H;return function(s){this.needsUpdate&&this.update(),s.isExtendedTriangle?s.needsUpdate&&s.update():(e.copy(s),e.update(),s=e);let a=this.satBounds,o=this.satAxes;t[0]=s.a,t[1]=s.b,t[2]=s.c;for(let h=0;h<3;h++){let d=a[h],p=o[h];if(i.setFromPoints(p,t),d.isSeparated(i))return!1}let l=s.satBounds,u=s.satAxes,c=this.points;for(let h=0;h<3;h++){let d=l[h],p=u[h];if(i.setFromPoints(p,c),d.isSeparated(i))return!1}for(let h=0;h<3;h++){let d=o[h];for(let p=0;p<4;p++){let m=u[p];if(n.crossVectors(d,m),i.setFromPoints(n,t),r.setFromPoints(n,c),i.isSeparated(r))return!1}}return!0}})();$c.prototype.closestPointToPoint=(function(){return function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}})();$c.prototype.distanceToPoint=(function(){let e=new H;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}})();$c.prototype.distanceToBox=(function(){let e=["x","y","z"],t=new Array(12).fill().map(()=>new Gl),i=new Array(12).fill().map(()=>new Gl),r=new H,n=new H;return function(s,a=0,o=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(s))return(o||l)&&(s.getCenter(n),this.closestPointToPoint(n,r),s.closestPointToPoint(r,n),o&&o.copy(r),l&&l.copy(n)),0;let u=a*a,c=s.min,h=s.max,d=this.points,p=1/0;for(let v=0;v<8;v++){let g=d[v];n.copy(g).clamp(c,h);let w=g.distanceToSquared(n);if(w<p&&(p=w,o&&o.copy(g),l&&l.copy(n),w<u))return Math.sqrt(w)}let m=0;for(let v=0;v<3;v++)for(let g=0;g<=1;g++)for(let w=0;w<=1;w++){let S=(v+1)%3,_=(v+2)%3,A=g<<S|w<<_,C=1<<v|g<<S|w<<_,E=d[A],I=d[C];t[m].set(E,I);let T=e[v],D=e[S],L=e[_],z=i[m],G=z.start,V=z.end;G[T]=c[T],G[D]=g?c[D]:h[D],G[L]=w?c[L]:h[D],V[T]=h[T],V[D]=g?c[D]:h[D],V[L]=w?c[L]:h[D],m++}for(let v=0;v<=1;v++)for(let g=0;g<=1;g++)for(let w=0;w<=1;w++){n.x=v?h.x:c.x,n.y=g?h.y:c.y,n.z=w?h.z:c.z,this.closestPointToPoint(n,r);let S=n.distanceToSquared(r);if(S<p&&(p=S,o&&o.copy(r),l&&l.copy(n),S<u))return Math.sqrt(S)}for(let v=0;v<12;v++){let g=t[v];for(let w=0;w<12;w++){let S=i[w];$k(g,S,r,n);let _=r.distanceToSquared(n);if(_<p&&(p=_,o&&o.copy(r),l&&l.copy(n),_<u))return Math.sqrt(_)}}return Math.sqrt(p)}})();var Y0=new H,Q0=new H,K0=new H,DA=new Pe,RA=new Pe,IA=new Pe,Q6=new H,K6=new H,Z6=new H,LA=new H;function BCe(e,t,i,r,n,s){let a;return s===Hs?a=e.intersectTriangle(r,i,t,!0,n):a=e.intersectTriangle(t,i,r,s!==Ba,n),a===null?null:{distance:e.origin.distanceTo(n),point:n.clone()}}function NCe(e,t,i,r,n,s,a,o,l){Y0.fromBufferAttribute(t,s),Q0.fromBufferAttribute(t,a),K0.fromBufferAttribute(t,o);let u=BCe(e,Y0,Q0,K0,LA,l);if(u){r&&(DA.fromBufferAttribute(r,s),RA.fromBufferAttribute(r,a),IA.fromBufferAttribute(r,o),u.uv=pa.getInterpolation(LA,Y0,Q0,K0,DA,RA,IA,new Pe)),n&&(DA.fromBufferAttribute(n,s),RA.fromBufferAttribute(n,a),IA.fromBufferAttribute(n,o),u.uv1=pa.getInterpolation(LA,Y0,Q0,K0,DA,RA,IA,new Pe)),i&&(Q6.fromBufferAttribute(i,s),K6.fromBufferAttribute(i,a),Z6.fromBufferAttribute(i,o),u.normal=pa.getInterpolation(LA,Y0,Q0,K0,Q6,K6,Z6,new H),u.normal.dot(e.direction)>0&&u.normal.multiplyScalar(-1));let c={a:s,b:a,c:o,normal:new H,materialIndex:0};pa.getNormal(Y0,Q0,K0,c.normal),u.face=c,u.faceIndex=s}return u}function TY(e,t,i,r,n){let s=r*3,a=e.index.getX(s),o=e.index.getX(s+1),l=e.index.getX(s+2),{position:u,normal:c,uv:h,uv1:d}=e.attributes,p=NCe(i,u,c,h,d,a,o,l,t);return p?(p.faceIndex=r,n&&n.push(p),p):null}function FCe(e,t,i,r,n,s){for(let a=r,o=r+n;a<o;a++)TY(e,t,i,a,s)}function UCe(e,t,i,r,n){let s=1/0,a=null;for(let o=r,l=r+n;o<l;o++){let u=TY(e,t,i,o);u&&u.distance<s&&(a=u,s=u.distance)}return a}function Lc(e,t,i,r){let n=e.a,s=e.b,a=e.c,o=t,l=t+1,u=t+2;i&&(o=i.getX(t),l=i.getX(t+1),u=i.getX(t+2)),n.x=r.getX(o),n.y=r.getY(o),n.z=r.getZ(o),s.x=r.getX(l),s.y=r.getY(l),s.z=r.getZ(l),a.x=r.getX(u),a.y=r.getY(u),a.z=r.getZ(u)}function J6(e,t,i,r,n,s,a){let o=i.index,l=i.attributes.position;for(let u=e,c=t+e;u<c;u++)if(Lc(a,u*3,o,l),a.needsUpdate=!0,r(a,u,n,s))return!0;return!1}var PY=class{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){let e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}};function np(e,t){return t[e+15]===65535}function Wy(e,t){return t[e+6]}function a_(e,t){return t[e+14]}function o_(e){return e+8}function l_(e,t){return t[e+6]}function VCe(e,t){return t[e+7]}var Ry=new Nn,Z2=new H,jCe=["x","y","z"];function BL(e,t,i,r,n){let s=e*2,a=Yx,o=Mp,l=Ap;if(np(s,o)){let u=Wy(e,l),c=a_(s,o);FCe(t,i,r,u,c,n)}else{let u=o_(e);J2(u,a,r,Z2)&&BL(u,t,i,r,n);let c=l_(e,l);J2(c,a,r,Z2)&&BL(c,t,i,r,n)}}function NL(e,t,i,r){let n=e*2,s=Yx,a=Mp,o=Ap;if(np(n,a)){let l=Wy(e,o),u=a_(n,a);return UCe(t,i,r,l,u)}else{let l=VCe(e,o),u=jCe[l],c=r.direction[u]>=0,h,d;c?(h=o_(e),d=l_(e,o)):(h=l_(e,o),d=o_(e));let p=J2(h,s,r,Z2)?NL(h,t,i,r):null;if(p){let v=p.point[u];if(c?v<=s[d+l]:v>=s[d+l+3])return p}let m=J2(d,s,r,Z2)?NL(d,t,i,r):null;return p&&m?p.distance<=m.distance?p:m:p||m||null}}var HCe=(function(){let e,t,i=[],r=new PY(()=>new Nn);return function(...s){e=r.getPrimitive(),t=r.getPrimitive(),i.push(e,t);let a=n(...s);r.releasePrimitive(e),r.releasePrimitive(t),i.pop(),i.pop();let o=i.length;return o>0&&(t=i[o-1],e=i[o-2]),a};function n(s,a,o,l,u=null,c=0,h=0){function d(S){let _=S*2,A=Mp,C=Ap;for(;!np(_,A);)S=o_(S),_=S*2;return Wy(S,C)}function p(S){let _=S*2,A=Mp,C=Ap;for(;!np(_,A);)S=l_(S,C),_=S*2;return Wy(S,C)+a_(_,A)}let m=s*2,v=Yx,g=Mp,w=Ap;if(np(m,g)){let S=Wy(s,w),_=a_(m,g);return kc(s,v,e),l(S,_,!1,h,c+s,e)}else{let S=o_(s),_=l_(s,w),A=S,C=_,E,I,T,D;if(u&&(T=e,D=t,kc(A,v,T),kc(C,v,D),E=u(T),I=u(D),I<E)){A=_,C=S;let ne=E;E=I,I=ne,T=D}T||(T=e,kc(A,v,T));let L=np(A*2,g),z=o(T,L,E,h+1,c+A),G;if(z===2){let ne=d(A),K=p(A)-ne;G=l(ne,K,!0,h+1,c+A,T)}else G=z&&n(A,a,o,l,u,c,h+1);if(G)return!0;D=t,kc(C,v,D);let V=np(C*2,g),j=o(D,V,I,h+1,c+C),J;if(j===2){let ne=d(C),K=p(C)-ne;J=l(ne,K,!0,h+1,c+C,D)}else J=j&&n(C,a,o,l,u,c,h+1);return!!J}}})(),WCe=(function(){let e=new Od,t=new Od,i=new yt,r=new $c,n=new $c;return function s(a,o,l,u,c=null){let h=a*2,d=Yx,p=Mp,m=Ap;if(c===null&&(l.boundingBox||l.computeBoundingBox(),r.set(l.boundingBox.min,l.boundingBox.max,u),c=r),np(h,p)){let v=o,g=v.index,w=v.attributes.position,S=l.index,_=l.attributes.position,A=Wy(a,m),C=a_(h,p);if(i.copy(u).invert(),l.boundsTree)return kc(a,d,n),n.matrix.copy(i),n.needsUpdate=!0,l.boundsTree.shapecast({intersectsBounds:E=>n.intersectsBox(E),intersectsTriangle:E=>{E.a.applyMatrix4(u),E.b.applyMatrix4(u),E.c.applyMatrix4(u),E.needsUpdate=!0;for(let I=A*3,T=(C+A)*3;I<T;I+=3)if(Lc(t,I,g,w),t.needsUpdate=!0,E.intersectsTriangle(t))return!0;return!1}});for(let E=A*3,I=C+A*3;E<I;E+=3){Lc(e,E,g,w),e.a.applyMatrix4(i),e.b.applyMatrix4(i),e.c.applyMatrix4(i),e.needsUpdate=!0;for(let T=0,D=S.count;T<D;T+=3)if(Lc(t,T,S,_),t.needsUpdate=!0,e.intersectsTriangle(t))return!0}}else{let v=a+8,g=m[a+6];return kc(v,d,Ry),!!(c.intersectsBox(Ry)&&s(v,o,l,u,c)||(kc(g,d,Ry),c.intersectsBox(Ry)&&s(g,o,l,u,c)))}}})();function J2(e,t,i,r){return kc(e,t,Ry),i.intersectBox(Ry,r)}var FL=[],FE,Yx,Mp,Ap;function Hw(e){FE&&FL.push(FE),FE=e,Yx=new Float32Array(e),Mp=new Uint16Array(e),Ap=new Uint32Array(e)}function OA(){FE=null,Yx=null,Mp=null,Ap=null,FL.length&&Hw(FL.pop())}var iD=Symbol("skip tree generation"),rD=new Nn,nD=new Nn,Z0=new yt,jm=new $c,yw=new $c,xw=new H,zA=new H,GCe=new H,qCe=new H,XCe=new H,$6=new Nn,yc=new PY(()=>new Od),cb=class{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),cb.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0?!0:arguments[2]});t={cloneBuffers:!0,...t};let i=e.geometry,r=e._roots,n=i.getIndex(),s;return t.cloneBuffers?s={roots:r.map(a=>a.slice()),index:n.array.slice()}:s={roots:r,index:n.array},s}static deserialize(e,t,i={}){if(typeof i=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),cb.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0?!0:arguments[2]});i={setIndex:!0,...i};let{index:r,roots:n}=e,s=new cb(t,{...i,[iD]:!0});if(s._roots=n,i.setIndex){let a=t.getIndex();if(a===null){let o=new hi(e.index,1,!1);t.setIndex(o)}else a.array!==r&&(a.array.set(r),a.needsUpdate=!0)}return s}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[iD]:!1},t),t.useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[iD]||(this._roots=LCe(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Nn))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));let t=this.geometry,i=t.index.array,r=t.attributes.position,n,s,a,o,l=0,u=this._roots;for(let h=0,d=u.length;h<d;h++)n=u[h],s=new Uint32Array(n),a=new Uint16Array(n),o=new Float32Array(n),c(0,l),l+=n.byteLength;function c(h,d,p=!1){let m=h*2;if(a[m+15]===65535){let v=s[h+6],g=a[m+14],w=1/0,S=1/0,_=1/0,A=-1/0,C=-1/0,E=-1/0;for(let I=3*v,T=3*(v+g);I<T;I++){let D=i[I],L=r.getX(D),z=r.getY(D),G=r.getZ(D);L<w&&(w=L),L>A&&(A=L),z<S&&(S=z),z>C&&(C=z),G<_&&(_=G),G>E&&(E=G)}return o[h+0]!==w||o[h+1]!==S||o[h+2]!==_||o[h+3]!==A||o[h+4]!==C||o[h+5]!==E?(o[h+0]=w,o[h+1]=S,o[h+2]=_,o[h+3]=A,o[h+4]=C,o[h+5]=E,!0):!1}else{let v=h+8,g=s[h+6],w=v+d,S=g+d,_=p,A=!1,C=!1;e?_||(A=e.has(w),C=e.has(S),_=!A&&!C):(A=!0,C=!0);let E=_||A,I=_||C,T=!1;E&&(T=c(v,d,_));let D=!1;I&&(D=c(g,d,_));let L=T||D;if(L)for(let z=0;z<3;z++){let G=v+z,V=g+z,j=o[G],J=o[G+3],ne=o[V],K=o[V+3];o[h+z]=j<ne?j:ne,o[h+z+3]=J>K?J:K}return L}}}traverse(e,t=0){let i=this._roots[t],r=new Uint32Array(i),n=new Uint16Array(i);s(0);function s(a,o=0){let l=a*2,u=n[l+15]===65535;if(u){let c=r[a+6],h=n[l+14];e(o,u,new Float32Array(i,a*4,6),c,h)}else{let c=a+8,h=r[a+6],d=r[a+7];e(o,u,new Float32Array(i,a*4,6),d)||(s(c,o+1),s(h,o+1))}}}raycast(e,t=ju){let i=this._roots,r=this.geometry,n=[],s=t.isMaterial,a=Array.isArray(t),o=r.groups,l=s?t.side:t;for(let u=0,c=i.length;u<c;u++){let h=a?t[o[u].materialIndex].side:l,d=n.length;if(Hw(i[u]),BL(0,r,h,e,n),OA(),a){let p=o[u].materialIndex;for(let m=d,v=n.length;m<v;m++)n[m].face.materialIndex=p}}return n}raycastFirst(e,t=ju){let i=this._roots,r=this.geometry,n=t.isMaterial,s=Array.isArray(t),a=null,o=r.groups,l=n?t.side:t;for(let u=0,c=i.length;u<c;u++){let h=s?t[o[u].materialIndex].side:l;Hw(i[u]);let d=NL(0,r,h,e);OA(),d!=null&&(a==null||d.distance<a.distance)&&(a=d,s&&(d.face.materialIndex=o[u].materialIndex))}return a}intersectsGeometry(e,t){let i=this.geometry,r=!1;for(let n of this._roots)if(Hw(n),r=WCe(0,i,e,t),OA(),r)break;return r}shapecast(e,t,i){let r=this.geometry;if(e instanceof Function){if(t){let h=t;t=(d,p,m,v)=>{let g=p*3;return h(d,g,g+1,g+2,m,v)}}e={boundsTraverseOrder:i,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let n=yc.getPrimitive(),{boundsTraverseOrder:s,intersectsBounds:a,intersectsRange:o,intersectsTriangle:l}=e;if(o&&l){let h=o;o=(d,p,m,v,g)=>h(d,p,m,v,g)?!0:J6(d,p,r,l,m,v,n)}else o||(l?o=(h,d,p,m)=>J6(h,d,r,l,p,m,n):o=(h,d,p)=>p);let u=!1,c=0;for(let h of this._roots){if(Hw(h),u=HCe(0,r,a,o,s,c),OA(),u)break;c+=h.byteLength}return yc.releasePrimitive(n),u}bvhcast(e,t,i){let{intersectsRanges:r,intersectsTriangles:n}=i,s=this.geometry.index,a=this.geometry.attributes.position,o=e.geometry.index,l=e.geometry.attributes.position;Z0.copy(t).invert();let u=yc.getPrimitive(),c=yc.getPrimitive();if(n){let d=function(p,m,v,g,w,S,_,A){for(let C=v,E=v+g;C<E;C++){Lc(c,C*3,o,l),c.a.applyMatrix4(t),c.b.applyMatrix4(t),c.c.applyMatrix4(t),c.needsUpdate=!0;for(let I=p,T=p+m;I<T;I++)if(Lc(u,I*3,s,a),u.needsUpdate=!0,n(u,c,I,C,w,S,_,A))return!0}return!1};if(r){let p=r;r=function(m,v,g,w,S,_,A,C){return p(m,v,g,w,S,_,A,C)?!0:d(m,v,g,w,S,_,A,C)}}else r=d}e.getBoundingBox(nD),nD.applyMatrix4(t);let h=this.shapecast({intersectsBounds:d=>nD.intersectsBox(d),intersectsRange:(d,p,m,v,g,w)=>(rD.copy(w),rD.applyMatrix4(Z0),e.shapecast({intersectsBounds:S=>rD.intersectsBox(S),intersectsRange:(S,_,A,C,E)=>r(d,p,S,_,v,g,C,E)}))});return yc.releasePrimitive(u),yc.releasePrimitive(c),h}intersectsBox(e,t){return jm.set(e.min,e.max,t),jm.needsUpdate=!0,this.shapecast({intersectsBounds:i=>jm.intersectsBox(i),intersectsTriangle:i=>jm.intersectsTriangle(i)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,i={},r={},n=0,s=1/0){e.boundingBox||e.computeBoundingBox(),jm.set(e.boundingBox.min,e.boundingBox.max,t),jm.needsUpdate=!0;let a=this.geometry,o=a.attributes.position,l=a.index,u=e.attributes.position,c=e.index,h=yc.getPrimitive(),d=yc.getPrimitive(),p=zA,m=GCe,v=null,g=null;r&&(v=qCe,g=XCe);let w=1/0,S=null,_=null;return Z0.copy(t).invert(),yw.matrix.copy(Z0),this.shapecast({boundsTraverseOrder:A=>jm.distanceToBox(A),intersectsBounds:(A,C,E)=>E<w&&E<s?(C&&(yw.min.copy(A.min),yw.max.copy(A.max),yw.needsUpdate=!0),!0):!1,intersectsRange:(A,C)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:E=>yw.distanceToBox(E),intersectsBounds:(E,I,T)=>T<w&&T<s,intersectsRange:(E,I)=>{for(let T=E*3,D=(E+I)*3;T<D;T+=3){Lc(d,T,c,u),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let L=A*3,z=(A+C)*3;L<z;L+=3){Lc(h,L,l,o),h.needsUpdate=!0;let G=h.distanceToTriangle(d,p,v);if(G<w&&(m.copy(p),g&&g.copy(v),w=G,S=L/3,_=T/3),G<n)return!0}}}});{let E=c?c.count:u.count;for(let I=0,T=E;I<T;I+=3){Lc(d,I,c,u),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let D=A*3,L=(A+C)*3;D<L;D+=3){Lc(h,D,l,o),h.needsUpdate=!0;let z=h.distanceToTriangle(d,p,v);if(z<w&&(m.copy(p),g&&g.copy(v),w=z,S=D/3,_=I/3),z<n)return!0}}}}}),yc.releasePrimitive(h),yc.releasePrimitive(d),w===1/0?null:(i.point?i.point.copy(m):i.point=m.clone(),i.distance=w,i.faceIndex=S,r&&(r.point?r.point.copy(g):r.point=g.clone(),r.point.applyMatrix4(Z0),m.applyMatrix4(Z0),r.distance=m.sub(r.point).length(),r.faceIndex=_),i)}closestPointToPoint(e,t={},i=0,r=1/0){let n=i*i,s=r*r,a=1/0,o=null;if(this.shapecast({boundsTraverseOrder:u=>(xw.copy(e).clamp(u.min,u.max),xw.distanceToSquared(e)),intersectsBounds:(u,c,h)=>h<a&&h<s,intersectsTriangle:(u,c)=>{u.closestPointToPoint(e,xw);let h=e.distanceToSquared(xw);return h<a&&(zA.copy(xw),a=h,o=c),h<n}}),a===1/0)return null;let l=Math.sqrt(a);return t.point?t.point.copy(zA):t.point=zA.clone(),t.distance=l,t.faceIndex=o,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{kc(0,new Float32Array(t),$6),e.union($6)}),e}},UL=Hp(dhe()),YCe=.5*(Math.sqrt(3)-1),ww=(3-Math.sqrt(3))/6,QCe=1/3,xc=1/6,hb=e=>Math.floor(e)|0,ej=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),sD=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function KCe(e=Math.random){let t=DY(e),i=new Float64Array(t).map(n=>ej[n%12*2]),r=new Float64Array(t).map(n=>ej[n%12*2+1]);return function(n,s){let a=0,o=0,l=0,u=(n+s)*YCe,c=hb(n+u),h=hb(s+u),d=(c+h)*ww,p=c-d,m=h-d,v=n-p,g=s-m,w,S;v>g?(w=1,S=0):(w=0,S=1);let _=v-w+ww,A=g-S+ww,C=v-1+2*ww,E=g-1+2*ww,I=c&255,T=h&255,D=.5-v*v-g*g;if(D>=0){let G=I+t[T],V=i[G],j=r[G];D*=D,a=D*D*(V*v+j*g)}let L=.5-_*_-A*A;if(L>=0){let G=I+w+t[T+S],V=i[G],j=r[G];L*=L,o=L*L*(V*_+j*A)}let z=.5-C*C-E*E;if(z>=0){let G=I+1+t[T+1],V=i[G],j=r[G];z*=z,l=z*z*(V*C+j*E)}return 70*(a+o+l)}}function ZCe(e=Math.random){let t=DY(e),i=new Float64Array(t).map(s=>sD[s%12*3]),r=new Float64Array(t).map(s=>sD[s%12*3+1]),n=new Float64Array(t).map(s=>sD[s%12*3+2]);return function(s,a,o){let l,u,c,h,d=(s+a+o)*QCe,p=hb(s+d),m=hb(a+d),v=hb(o+d),g=(p+m+v)*xc,w=p-g,S=m-g,_=v-g,A=s-w,C=a-S,E=o-_,I,T,D,L,z,G;A>=C?C>=E?(I=1,T=0,D=0,L=1,z=1,G=0):A>=E?(I=1,T=0,D=0,L=1,z=0,G=1):(I=0,T=0,D=1,L=1,z=0,G=1):C<E?(I=0,T=0,D=1,L=0,z=1,G=1):A<E?(I=0,T=1,D=0,L=0,z=1,G=1):(I=0,T=1,D=0,L=1,z=1,G=0);let V=A-I+xc,j=C-T+xc,J=E-D+xc,ne=A-L+2*xc,K=C-z+2*xc,B=E-G+2*xc,Z=A-1+3*xc,F=C-1+3*xc,X=E-1+3*xc,Y=p&255,le=m&255,oe=v&255,re=.6-A*A-C*C-E*E;if(re<0)l=0;else{let Ce=Y+t[le+t[oe]];re*=re,l=re*re*(i[Ce]*A+r[Ce]*C+n[Ce]*E)}let ue=.6-V*V-j*j-J*J;if(ue<0)u=0;else{let Ce=Y+I+t[le+T+t[oe+D]];ue*=ue,u=ue*ue*(i[Ce]*V+r[Ce]*j+n[Ce]*J)}let me=.6-ne*ne-K*K-B*B;if(me<0)c=0;else{let Ce=Y+L+t[le+z+t[oe+G]];me*=me,c=me*me*(i[Ce]*ne+r[Ce]*K+n[Ce]*B)}let he=.6-Z*Z-F*F-X*X;if(he<0)h=0;else{let Ce=Y+1+t[le+1+t[oe+1]];he*=he,h=he*he*(i[Ce]*Z+r[Ce]*F+n[Ce]*X)}return 32*(l+u+c+h)}}function DY(e){let t=new Uint8Array(512);for(let i=0;i<512/2;i++)t[i]=i;for(let i=0;i<512/2-1;i++){let r=i+~~(e()*(256-i)),n=t[i];t[i]=t[r],t[r]=n}for(let i=256;i<512;i++)t[i]=t[i-256];return t}var _u=new pa,JCe=class{constructor(e){this.weightAttribute=null;let t=e.geometry;if(!t.isBufferGeometry||t.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.distribution=null}build(){let e=this.positionAttribute,t=new Float32Array(e.count/3);for(let r=0;r<e.count;r+=3){let n=1;_u.a.fromBufferAttribute(e,r),_u.b.fromBufferAttribute(e,r+1),_u.c.fromBufferAttribute(e,r+2),n*=_u.getArea(),t[r/3]=n}this.distribution=new Float32Array(e.count/3);let i=0;for(let r=0;r<t.length;r++)i+=t[r],this.distribution[r]=i;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t){if(this.distribution){let i=this.distribution[this.distribution.length-1],r=this.binarySearch(this.randomFunction()*i);return this.sampleFace(r,e,t)}}binarySearch(e){if(!this.distribution)return 0;let t=this.distribution,i=0,r=t.length-1,n=-1;for(;i<=r;){let s=Math.ceil((i+r)/2);if(s===0||t[s-1]<=e&&t[s]>e){n=s;break}else e<t[s]?r=s-1:i=s+1}return n}sampleFace(e,t,i){let r=this.randomFunction(),n=this.randomFunction();return r+n>1&&(r=1-r,n=1-n),_u.a.fromBufferAttribute(this.positionAttribute,e*3),_u.b.fromBufferAttribute(this.positionAttribute,e*3+1),_u.c.fromBufferAttribute(this.positionAttribute,e*3+2),t.set(0,0,0).addScaledVector(_u.a,r).addScaledVector(_u.b,n).addScaledVector(_u.c,1-(r+n)),_u.getNormal(i),this}},$Ce=Hp(H7()),eTe=new yt,tTe=new yt,iTe=new yt,Yg;(e=>{function t(i){return i&&i.__isSPEObject}e.is=t})(Yg||(Yg={}));var eB=e=>class extends e{constructor(){super(...arguments),this.previousModelViewMatrix=new yt,this.copyPreviousMatrix=!0,this.hiddenMatrix=new yt,this.matrixWorldRigid=new yt,this.shearScale=new yt,this.shearScaleInv=new yt}get __isSPEObject(){return!0}isDescendantOf(t){t instanceof vr&&(t=t.uuid);let i=this;for(;i.parent;){if(i.parent.uuid===t)return!0;i=i.parent}return!1}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);for(let i of this.children)i.updateMatrixWorld(t)}updateWorldMatrix(t,i){let r=this.parent;if(t&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),i)for(let n of this.children)n.updateWorldMatrix(!1,!0)}traverseChildren(t,i=0){for(let r of this.children)Yg.is(r)&&r.traverseObject(t,i+1)}traverseObject(t,i=0){if(t(this,i)!==!0)for(let r of this.children)Yg.is(r)&&r.traverseObject(t,i+1)}updateMatrixWorldSVD(){let t=this.matrixWorld.elements,i=[[t[0],t[4],t[8]],[t[1],t[5],t[9]],[t[2],t[6],t[10]]],{u:r,v:n,q:s}=(0,$Ce.SVD)(i),a=eTe.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1),o=tTe.set(n[0][0],n[0][1],n[0][2],0,n[1][0],n[1][1],n[1][2],0,n[2][0],n[2][1],n[2][2],0,0,0,0,1),l=iTe.copy(o).transpose();this.shearScale.makeScale(s[0],s[1],s[2]).multiply(l).premultiply(o),this.shearScaleInv.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(a,l).copyPosition(this.matrixWorld),s.every(u=>Math.abs(s[0]-u)<.01)?this.hasNonUniformScale=!1:this.hasNonUniformScale=!0}attach(t,i){this.updateWorldMatrix(!0,!1);let r=new yt().copy(this.matrixWorld).invert();return t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),r.multiply(t.parent.matrixWorld)),"hiddenMatrix"in t&&t.hiddenMatrix instanceof yt?t.hiddenMatrix.premultiply(r):t.applyMatrix4(r),t.updateWorldMatrix(!1,!1),this.add(t),i!==void 0&&(this.children.pop(),this.children.splice(i,0,t)),this}copy(t,i=!1){return super.copy(t,i),this.hasNonUniformScale=t.hasNonUniformScale,this}onAfterRender(t,i,r,n,s,a){this.copyPreviousMatrix&&this.previousModelViewMatrix.copy(this.modelViewMatrix)}},rTe=class extends eB(vr){},nTe=e=>e.type==="Mesh",ya=class extends rTe{constructor(e){super(),this.object=e,this.matrixAutoUpdate=!1,this.hasNonUniformScale=e.hasNonUniformScale}raycast(e,t){}expand(){let e=0,t=this.object.entityChildren(e);for(;t;){let i=this.children[e];i?.object!==t&&(i&&this.remove(i),i=new ya(t),this.add(i),this.children.splice(e,0,this.children.pop()),i.matrixWorldNeedsUpdate=!0,i.matrixAutoUpdate=!1,i.matrix=t.matrix,i.hiddenMatrix=t.hiddenMatrix),i.expand(),e+=1,t=this.object.entityChildren(e)}for(;this.children.length>e;)this.remove(this.children[e])}get visible(){return this.playModeVisible!==void 0?this.playModeVisible:this.object.visible||this.object.dataPatched.visible&&this.object.dataPatched.cloner?.hideBase===!0}set visible(e){}get castShadow(){return this.object.castShadow}set castShadow(e){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(e){}get isMesh(){return nTe(this.object)}get isLight(){return this.object.isLight}get layers(){return this.object.layers}set layers(e){}get isCamera(){return!1}get geometry(){if(this.object.geometry)return this.object.geometry}get material(){if(this.object.material)return this.object.material}get morphTargetInfluences(){if(this.object.morphTargetInfluences)return this.object.morphTargetInfluences}set morphTargetInfluences(e){}},ng=new H,sg=new H,Gy=new yt,RY=[new H(-1,1,1),new H(-1,-1,1),new H(1,-1,1),new H(1,1,1),new H(-1,1,-1),new H(-1,-1,-1),new H(1,-1,-1),new H(1,1,-1)],sTe=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],aTe=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],tj=(e,t,i)=>{e.updateEntityBoxSize(ng,sg),Gy.copy(t).multiply(e.matrixWorld),sg.x===0&&sg.y===0&&sg.z===0?i.push(new H(ng.x,ng.y,ng.z).applyMatrix4(Gy)):RY.forEach(r=>{i.push(r.clone().multiply(sg).add(ng).applyMatrix4(Gy))})},ij=class extends Nn{constructor(){super(...arguments),this.matrix=new yt,this.vertices=[],this.faces=[],this.edges=[],this.centerEdges=[]}copy(e){return super.copy(e),this.matrix.copy(e.matrix),this.vertices=e.vertices.map(t=>t.clone()),this.faces=e.faces.map(t=>t.clone()),this.edges=e.edges.map(t=>t.clone()),this.centerEdges=e.centerEdges.map(t=>t.clone()),this}setFromObjectSize(e,t=!1){e.updateWorldMatrix(!1,t),this.makeEmpty(),this.matrix.copy(e.matrixWorld);let i=new yt().copy(e.matrixWorld).invert();return this.expandByObjectSize(e,i,t)}expandByObjectSize(e,t,i=!1){let r=[];return i===!0?e.traverseEntity(n=>{if(n.visible||n.cloner&&n.data.visible){if(!("geometry"in n)){r.push(new H);return}tj(n,t,r)}}):tj(e,t,r),this.setFromPoints(r)}getCenter(e){return e=super.getCenter(e),e.applyMatrix4(this.matrix),e}getPositionToCenter(e){return e=super.getCenter(e),e.applyMatrix4(Gy.copy(this.matrix).setPosition(0,0,0)),e}computeVertices(){this.getSize(sg).multiplyScalar(.5),this.getCenter(ng),Gy.copy(this.matrix).setPosition(ng),this.vertices=RY.map(e=>e.clone().multiply(sg).applyMatrix4(Gy))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=sTe.map(([e,t])=>new Gl(this.vertices[e],this.vertices[t])),this.centerEdges=this.edges.map(e=>e.getCenter(new H))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=aTe.map(([e,t])=>this.vertices[e].clone().add(this.vertices[t]).multiplyScalar(.5))}},pp={Cloner:()=>{},changeEntityProptotype:()=>{},createEntity:()=>{}},oTe=class extends xq{constructor(){super()}getPoints(e=12){let t=[],i,r=this.getCurveLengths(),n=r[r.length-1]/r.length;for(let s=0,a=this.curves;s<a.length;s++){let o=a[s],l=s===0?r[s]:r[s]-r[s-1],u=Math.ceil(e*l/n),c=o.getPoints(u);for(let h=0;h<c.length;h++){let d=c[h];i&&i.equals(d)||(t.push(d),i=d)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}},VL=.001;function jL(e,t,i){return t.clone().sub(e).cross(t.clone().sub(i)).length()<=VL}function aD(e,t){let i=new H(...e.position),r=new H(...e.controlNext.position),n=new H(...t.controlPrevious.position),s=new H(...t.position);return jL(i,r,s)&&jL(i,n,s)}function IY(e){let t=e.points.map(c=>new H(...c.data.position)),i=[e.points[0]],r=new H(...i[0].data.position);for(let c=0;c<e.points.length-1;c++)jL(r,t[c],t[c+1])||(i.push(e.points[c]),r=t[c]);i.push(e.points[e.points.length-1]);let n=e.isClosed,s=i.length-(n?0:1),a=i.length,o=[];for(let c=0;c<a;c++){let h=i[c].data,d=new H(...h.position),p=new H(...h.controlPrevious.position),m=new H(...h.controlNext.position),v={position:d,baseRoundness:h.roundness,controlPrevious:p,controlNext:m};if(h.roundness===0||!e.isClosed&&(c===0||c===a-1)){o[c]={...v,removedLength:0};continue}let g=n&&c==0?a-1:c-1,w=n&&c==a-1?0:c+1,S=i[g].data,_=i[w].data,A=new H(...S.position),C=new H(..._.position),E=A.clone().sub(d).normalize(),I=C.clone().sub(d).normalize();Object.assign(v,{prevDir:E,nextDir:I});let T=aD(S,h),D=aD(h,_);if(!T||!D)o[c]={...v,removedLength:0};else{let L=E.clone().add(I).normalize(),z=L.clone().cross(E).length()/E.dot(L);o[c]={...v,tan:z,removedLength:h.roundness/z}}}for(let c=0;c<s;c++){let h=c,d=n&&c===a-1?0:c+1,p=o[h],m=o[d];if(p.removedLength!==0||m.removedLength!==0){let v=p.position.distanceTo(m.position);p.removedLength=Math.min(p.removedLength,v/2),m.removedLength=Math.min(m.removedLength,v/2)}}let l=[];for(let c=0;c<s;c++){let h=c,d=n&&c===a-1?0:c+1,p=o[h],m=o[d],v=null;if(!aD(i[h].data,i[d].data))p.position.distanceTo(m.position)>VL&&(v=new OE(p.position,p.controlNext,m.controlPrevious,m.position));else{let g=p.position.clone(),w=m.position.clone();(p.removedLength!==0||m.removedLength!==0)&&(p.nextDir&&g.add(p.nextDir.clone().setLength(p.removedLength)),m.prevDir&&w.add(m.prevDir.clone().setLength(m.removedLength))),g.distanceTo(w)>VL&&(v=new OE(g,g.clone().lerp(w,.3),w.clone().lerp(g,.3),w))}l[2*c+1]=v}for(let c=0;c<a;c++){let h=o[c];if(h.removedLength===0){l[2*c]=null;continue}let d=h.position,p=h.prevDir.clone().multiplyScalar(h.removedLength).add(d),m=h.nextDir.clone().multiplyScalar(h.removedLength).add(d),v=h.tan*h.removedLength,g=h.prevDir.clone().add(h.nextDir).normalize(),w=p.clone().lerp(m,.5),S=p.distanceTo(m)/2,_=g.clone().multiplyScalar(Math.sqrt(Math.pow(v,2)-Math.pow(S,2))).add(w),A=g.clone().multiplyScalar(-v).add(_),C=d.distanceTo(A)/d.distanceTo(w),E=h.prevDir.clone().multiplyScalar(C*d.distanceTo(p)).add(d),I=E.clone().lerp(A,2),T=p.clone().lerp(E,4/3),D=m.clone().lerp(I,4/3);l[2*c]=new OE(p,T,D,m)}let u=new oTe;return l.forEach(c=>{c&&u.add(c)}),u}var Xi;(e=>{function t(i){return i&&i.__isEntity}e.is=t})(Xi||(Xi={}));var sd=e=>Xi.is(e),lTe={type:"completeState",isfromEntity:!0},uTe=["x","y","z"],oD=new H,cTe=new H().set(0,1,0),tB=e=>class extends eB(e){constructor(){super(...arguments),this.raycastLock=!1,this.scaleLock=!1,this.disposed=!1,this.stateSelection=null,this.destroyedInAction=!1,this.instances=[],this.prevState=null,this.currentState=null,this.currentAnimationAction=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this._singleBBox=new ij,this._recursiveBBox=new ij,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this._needApplyPathSnapping=!0,this.attachedPaths=new Set}get __isEntity(){return!0}entityChildren(t){let i=this.children[t];if(Xi.is(i))return i}entityChildrenCount(){let t=this.children.length;for(;t--;)if(Xi.is(this.children[t]))return t+1;return 0}get isConcreteEntity(){return typeof this.identity=="string"}get isVirtualEntity(){return typeof this.identity!="string"}get isInstanceRoot(){return this.isConcreteEntity&&this.data.type==="Instance"}nearestInstanceSelfOrParent(){let t=this;for(;t.data.type!=="Instance";){let i=t.parent;if(Xi.is(i))t=i;else return}return t}forInstancesRec(t){this.instances.forEach(i=>{i.disposed||t(i),i.forInstancesRec(t)})}super_Entity(t,i){typeof t=="string"&&(this.uuid=t),this.identity=t,this.data=i,this.matrixAutoUpdate=!1,this.dataPatched=this.data}changeSelectedState(t,i,r=!1){if(!(this.data.states.length===0&&!r)){for(let n of this.data.states)fp.toOps(this.data,n.data).forEach(s=>{let a=C2.replaceProps(s,this.data);this.dataPatched=this.data,this.updateByPatchedOp(a,this.data,i)});if(t!==null){let n=this.data.states.data(t);n&&(this.dataPatched=fp.patch(this.data,n),fp.toOps(this.data,n).forEach(s=>{this.updateByPatchedOp(s,this.dataPatched,i)}))}r&&this.updateTransformState(this.dataPatched,i),this.stateSelection=t,this.updatePathSnapping(this.dataPatched.pathSnapping)}}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}updateEntityBoxSize(t,i){t.setScalar(0),i.setScalar(0)}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(t=>{sd(t)&&t.resetBBoxNeedsUpdateSelf()}),this.traverseEntity(t=>{t.resetBBoxNeedsUpdateSelf()})}find(t){let i;return this.traverseEntity(r=>{r.uuid===t&&(i=r)}),i}traverseSortNextHelper(){let t=this.parent;if(t){let i=t.children,r=i.indexOf(this)+1;if(Xi.is(i[r]))return i[r];if(Xi.is(t))return t.traverseSortNextHelper()}}sortNext(){let t=this.children;return this.children.length>0&&Xi.is(this.children[0])?t[0]:this.traverseSortNextHelper()}goUp(t){let i=this;for(;t>0&&i!==null;)i=i.parent,t-=1;return i}hasAnccestorOrSelf(t){return this===t||this.hasAnccestor(t)}hasAnccestor(t){let i=this.parent;for(;i;){if(t===i)return!0;i=i.parent}return!1}countToAccestor(t){let i=0,r=this;for(;r!==t;){if(r===null)return-1;r=r.parent,i+=1}return i}forEachEntity(t){for(let i of this.children)sd(i)&&t(i)}traverseEntityAncestors(t){this.traverseAncestors(i=>{Xi.is(i)&&t(i)})}traverseConcreteEntity(t,i=0){if(t(this,i)!==!0)for(let r of this.children)sd(r)&&r.isConcreteEntity&&r.traverseEntity(t,i+1)}traverseEntity(t,i=0){if(t(this,i)!==!0)for(let r of this.children)sd(r)&&r.traverseEntity(t,i+1)}traverseVisibleEntity(t){t(this);for(let i of this.children)sd(i)&&i.visible&&i.traverseVisibleEntity(t)}updateMatrix(){super.updateMatrix(),this.cloner&&this.cloner.onObjUpdateMatrix(),this.dispatchEvent({type:"updateMatrix"})}updateMatrixWorld(t){super.updateMatrixWorld(t),this.dispatchEvent({type:"updateMatrixWorld"})}copy(t,i=!1){return super.copy(t,i),this.dataPatched=t.dataPatched,this.raycastLock=t.raycastLock,this.scaleLock=t.scaleLock,this.hiddenMatrix.copy(t.hiddenMatrix),this}hasEntityChild(){return this.children.some(t=>sd(t))}isAncestorOf(t){if(this.uuid===t)return!1;let i=!1;return this.traverseEntity(r=>{r.uuid===t&&(i=!0)}),i}toObjectTransformState(t=[]){this.updateWorldMatrix(!0,!1);let i={position:this.position.toArray(),rotation:[this.rotation.x*Ot.RAD2DEG,this.rotation.y*Ot.RAD2DEG,this.rotation.z*Ot.RAD2DEG],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()};return GI(i,t)}getTransformValues(t,i,r){return i[t].map((n,s)=>r?.shared.getVariable(n,[this.uuid,t,uTe[s]])??n)}updateTransformState(t,i){let r=!1;return t.position&&(this.position.fromArray(this.getTransformValues("position",t,i)),r=!0),t.rotation&&(oD.fromArray(this.getTransformValues("rotation",t,i)).multiplyScalar(Ot.DEG2RAD),this.rotation.setFromVector3(oD),r=!0),t.scale&&(this.scale.fromArray(this.getTransformValues("scale",t,i)),r=!0),t.hiddenMatrix!==void 0&&(r=!0,this.hiddenMatrix.fromArray(t.hiddenMatrix??hx.identity)),r&&(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(n=>{n.invalidateClonerTransform(this)})),t.position&&t.rotation&&t.scale&&t.hiddenMatrix!==void 0&&this.updateWorldMatrix(!1,!0),r}onVariableUpdate(t=!1){if(t){this.resetBBoxNeedsUpdate();return}this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(i=>{i.invalidateClonerTransform(this)}),this.requestRender()}dispose(){this.disposed=!0,this.cloner&&(this.cloner.removeFromParent(),this.cloner=void 0)}disposeChildrenRecursively(){for(let t of this.children)Xi.is(t)&&t.disposeRecursively()}disposeRecursively(){this.dispose(),this.children.forEach(t=>{Xi.is(t)&&t.disposeRecursively()})}toState(t=[]){let i={name:this.name,visible:this.visible,raycastLock:this.raycastLock,...this.toObjectTransformState(t)};return GI(i,t)}updateByObjUpdateOp(t,i){t!==void 0&&this.updateByOp({type:0,props:t,path:[]},{...this.data,...t},i,!1)}updateByOp(t,i,r,n){let s=this.data;this.data=i;let a=t,o=Dr(t.path,["states","*"]);if(o!==null){if(t.type===0){let[l]=o;if(this?.stateSelection===l){let u={...t.props};if(delete u.name,Object.values(t.props).some(c=>c===void 0)){let c=this.data;if(c!==void 0){let h=bs.zoom(c,t.path.slice(2));if(h)for(let d in t.props)t.props[d]===void 0&&d in h&&(u[d]=h[d])}}a={...t,props:u,path:t.path.slice(2)}}}}else if(t.type===0){let l=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(l!==void 0){if(t.props.name!==void 0&&l.name){let{name:c,...h}=l;l=h}if(t.props.material!==void 0&&"material"in l){let{material:c,...h}=l;l=h}let u=bs.removeOverridden(t.path,t.props,l);a={...t,props:u}}}if(this.updateByPatchedOpBase(a,fp.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),r),Dr(t.path,["overrides"])){let l=[],u=[...t.path];for(l.push(u[1]),u.splice(0,2);u.length>0&&u[0]==="descendants";)l.push(u[1]),u.splice(0,2);if(l[l.length-1]===void 0){if(t.type===0)for(let c of Object.keys(t.props)){l[l.length-1]=c;let h=r.scene.findInstance([this.uuid,...l]);h&&(h.overrideData=t.props[c],h.updateState(bp.apply(h.component.data,h.overrideData),r))}}else{let c=r.scene.findInstance([this.uuid,...l]);if(c){let h=bs.zoom(c.component.data,u);if(t={...t,path:u},t.type===0){let d=t.props;if(h)for(let[p,m]of Object.entries(t.props))m===void 0&&(d===t.props&&(d={...t.props}),d[p]=h[p]);t={...t,props:d}}c.overrideData=U2.resolve(i.overrides,l),c.updateByOp(t,Us.applySimple(c.data,t),r,!1)}}}else if(this.instances.length>0){let l;if(t.path.length===0&&t.type===0){let u;for(let c of dp.rootOverrideProps)c in t.props&&(u===void 0&&(u={}),u[c]=t.props[c]);u&&(l={...t,props:u})}else for(let u of dp.rootOverrideProps)if(Dr(t.path,[u])){l=t;break}l!==void 0&&this.instances.forEach(u=>{if(u.isInstanceRoot){let c=bp.filterOp(u.overrideData,l);c&&u.updateByOp(c,Us.applySimple(u.data,c),r,!0)}}),this.instances.forEach(u=>{if(!u.isInstanceRoot){let c=bp.filterOp(u.overrideData,t);if(c){let h;s===u.data&&t===c?h=i:h=Us.applySimple(u.data,c),u.updateByOp(c,h,r,!0)}}})}}updateByPatchedOpBase(t,i,r){if(this.dataPatched=i,t.path.length===0&&t.type===0)t.props.type!==void 0&&!Xg.is(t.props.type)&&pp.changeEntityProptotype(this,i,r);else if(t.path.length===1&&t.path[0]==="geometry"&&t.type===0&&"type"in t.props){pp.changeEntityProptotype(this,i,r);for(let n of this.children)Xi.is(n)&&n.updateVisible(r.scene)}this.updateByPatchedOp(t,i,r)}updateByPatchedOp(t,i,r){if(t.path.length===0&&t.type===0?this.updateState(t.props,r):t.type===0&&("resolutionLevel"in t.props||"useChildrenColors"in t.props)&&this.updateState(i,r),t.path[0]==="morphTargetInfluences"&&t.type===0){let n=i.morphTargetInfluences.get(t.path[1])?.data.name;n&&this.updateMorphInfluences(n,r.shared.getVariable(t.props.value,[this.uuid,"morphTargetInfluences",n]))}if(Dr(t.path,["pathSnapping"])!==null&&this.updatePathSnapping(i.pathSnapping),Dr(t.path,["cloner"])!==null){let n=Us.drop(t,1);n.path.length===0&&n.type===0&&n.props.disabled===!0?this.setFromClonerState(null,r):this.cloner?this.cloner.updateState(i.cloner,r):(this.setFromClonerState(i.cloner,r),this.expandCloner(r)),this.updateVisible(r.scene)}}updatePathSnapping(t=this.dataPatched.pathSnapping){this._updatedPathSnapping=t,this._needApplyPathSnapping=!0}get updatedPathSnapping(){return this._updatedPathSnapping}applyPathSnapping(t){let i=this._updatedPathSnapping?.pathId??this.dataPatched.pathSnapping.pathId,r=this._updatedPathSnapping?.slide??this.dataPatched.pathSnapping.slide??0,n=this._updatedPathSnapping?.offset??this.dataPatched.pathSnapping.offset??0,s=this._updatedPathSnapping?.orientation??this.dataPatched.pathSnapping.orientation;if(i===null)return;let a=t.find(i);if(!a||this._needApplyPathSnapping===!1)return;this._needApplyPathSnapping=!1;let o=a.data;if(o.geometry.path.points.length<=1)return;let l=IY(o.geometry.path),u=(r+n)%1;r+n===1&&u===0&&(u=1);let c=null;try{c=l.curves.length?l.getPointAt(u):null}catch{}if(c===null)return;let h=this.parent?this.parent?.matrixWorld:new yt;a.updateMatrixWorld();let d=new yt().multiplyMatrices(h.clone().invert(),a.matrixWorld);c.applyMatrix4(d);let p={position:c.toArray(),rotation:o.rotation};if(s==="tangential"){let m=new yt().extractRotation(a.matrixWorld),v=l.getTangentAt(u).applyMatrix4(m).add(c),g=new yt().lookAt(c,v,cTe),w=oD.setFromEuler(new ws().setFromRotationMatrix(g)).multiplyScalar(Ot.RAD2DEG);p={...p,rotation:w.toArray()}}this.updateTransformState(p),this.traverseEntity(m=>{m._cameraType&&m.dispatchEvent(lTe)})}updateVisible(t){if(this.visible=this.dataPatched.visible&&(!this.dataPatched.cloner||(this.dataPatched.cloner.disabled??!1)||this.dataPatched.cloner?.hideBase!==!0),!t)return;let i=!1;this.traverseEntity(r=>{if(r.data.type==="Splat")return i=!0,!0}),i&&t.reloadSplats()}updateState_Entity(t,i){t.name!==void 0&&(this.name=t.name),t.raycastLock!==void 0&&(this.raycastLock=t.raycastLock),t.visible!==void 0&&(this.updateVisible(i?.scene),this.resetBBoxNeedsUpdate()),i&&"cloner"in t&&t.cloner!==void 0&&(this.setFromClonerState(t.cloner,i),this.updateVisible(i.scene)),this.updateTransformState(t,i)}get attachedSurfaceCloners(){return this.children.filter(t=>t instanceof pp.Cloner&&t.parameters.type==="toObject")}setFromClonerState(t,i){this.disposed||(t===null||t.disabled?(this.cloner&&this.cloner.removeFromParent(),this.cloner=void 0):this.cloner===void 0?(this.cloner=new pp.Cloner(this,t),i.scene.addPendingExpandCloner(this)):this.cloner.updateState(t,i))}expandCloner(t){!this.disposed&&this.cloner&&this.cloner.expandClones(t)}invalidateClonerTransform(t){this.cloner&&this.cloner.invalidateTransform(t)}requestRender(){this.dispatchEvent({type:"requestRender"})}},LY=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=e.parameters?.radiusTop,r=e.parameters?.radiusBottom,n=Object.assign({},t?.parameters??{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:8,cornerSegments:8,hollow:0},e.parameters);n.thetaLength=Ot.clamp(n.thetaLength,0,360);let s=n.width/2,a=n.radiusTop??s,o=n.radiusBottom??s;if(a===o?(a=s,o=s):a>o?(a=s,o=o*s/a):(a=a*s/o,o=s),n.shapeBlendNode){a=i??s,o=r??s;let l=Math.max(a,o)*2;n.width=l,n.depth=l}return{parameters:Object.assign(n,{width:Math.abs(n.width),height:Math.abs(n.height??n.width),depth:Math.abs(n.depth??n.width),radiusTop:a,radiusBottom:o})}}static build(e){let{width:t,depth:i,height:r,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l,radiusTop:u,radiusBottom:c,cornerRadius:h,cornerSegments:d,hollow:p}=e.parameters,m;return l===0?(m=new Kt,m.setAttribute("position",new kt([],3))):h||p?m=new OY(u,c,r,n,s,a,o,l*Math.PI/180,h,h,d,p):m=new ik(u,c,r,n,s,a,o,l*Math.PI/180),m.scale(1,1,i/t),Object.assign(m,{userData:{...e,type:"CylinderGeometry"}})}};function Uf(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function rj(e){return new Pe(e.y,-e.x)}var OY=class extends Kt{constructor(e,t,i,r,n,s,a,o,l,u,c,h,d=!1){super(),this.type="RoundedCylinderBufferGeometry",e=e!==void 0?e:1,t=t!==void 0?t:1,i=i||1,r=Math.floor(r)||8,n=Math.floor(n)||1,s=s!==void 0?s:!1,a=a!==void 0?a:0,o=o!==void 0?o:Math.PI*2,s&&(l=0,u=0);let p=[],m=[],v=[],g=[],w=0,S=i/2,_=new H,A=new H;d&&e==0&&(e=l),d&&t==0&&(t=u);let C=new Pe(e,S),E=new Pe(t,-S),I=null,T=null,D=null,L=null,z=C.clone().sub(E),G=0,V=0,j=0;h>0&&(G=Math.min(e,t)*(1-h),V=e-G,j=t-G);let J=C.clone();J.x-=G;let ne=Math.PI-z.angle(),K=z.angle(),B=Math.tan(K/2),Z=Math.tan(ne/2),F=B+Z,X=h?F:Z,Y=h?F:B;if(l=Math.min(l,(e-V)/X,z.length()/F),u=Math.min(u,(t-j)/Y,z.length()/F),l>0){let he=l/B;I=C.clone().sub(new Pe(he,l)),h&&(D=I.clone(),D.x-=G-F*l),C.sub(z.clone().setLength(he))}if(u>0){let he=u/Z;T=E.clone().sub(new Pe(he,-u)),E.add(z.clone().setLength(he)),h&&(L=T.clone(),L.x-=G-F*u,J.sub(z.clone().setLength(he)))}z=C.clone().sub(E);let le=z.length()<.5,oe=[];for(let he=0;he<=r;he++){let Ce=[],Ae=he/r,Ie=Ae*o+a,Me=new Pe(Math.sin(Ie),Math.cos(Ie));L&&T?(re(Ce,Ae,Me,ne,u,L,-1,!0),re(Ce,Ae,Me,K,u,T,-1,!1)):T?(ue(Ce,Me,T.x,0,-1),re(Ce,Ae,Me,K,u,T,-1,!1)):s||ue(Ce,Me,t,j,-1);let De=rj(z).normalize();if(Uf(De,Me,_),!le)for(let Ve=0;Ve<=n;Ve++){let Ge=Ve/n,Qe=z.clone().multiplyScalar(Ge).add(E);Uf(Qe,Me,A),m.push(A.x,A.y,A.z),v.push(_.x,_.y,_.z),g.push(Ae,.5+A.y/i),Ce.push(w++)}if(D&&I?(re(Ce,Ae,Me,ne,l,I,1,!1),re(Ce,Ae,Me,K,l,D,1,!0)):I?(re(Ce,Ae,Me,ne,l,I,1,!1),ue(Ce,Me,I.x,0,1)):s||ue(Ce,Me,e,V,1),h&&!le){let Ve=rj(z).multiplyScalar(-1).normalize();Uf(Ve,Me,_);for(let Ge=0;Ge<=n;Ge++){let Qe=Ge/n,ot=z.clone().multiplyScalar(-Qe).add(J);Uf(ot,Me,A),m.push(A.x,A.y,A.z),v.push(_.x,_.y,_.z),g.push(Ae,.5+A.y/i),Ce.push(w++)}}h&&!s&&Ce.push(Ce[0]),oe.push(Ce)}for(let he=0;he<oe.length-1;he++)for(let Ce=0;Ce<oe[0].length-1;Ce++){if(s&&h&&Ce==n)continue;let Ae=oe[he][Ce],Ie=oe[he+1][Ce],Me=oe[he+1][Ce+1],De=oe[he][Ce+1],Ve=m[Me*3+0],Ge=m[Me*3+2];p.push(Ae,Ie,De),(Ve!=0||Ge!=0)&&p.push(Ie,Me,De)}o<Math.PI*2&&(me(-1,oe[0],a),me(1,oe[oe.length-1],a+o)),this.setIndex(p),this.setAttribute("position",new kt(m,3)),this.setAttribute("normal",new kt(v,3)),this.setAttribute("uv",new kt(g,2));function re(he,Ce,Ae,Ie,Me,De,Ve,Ge){for(let Qe=0;Qe<c+1;Qe++){let ot=Qe/c,$e=Ve<0?ot:1-ot;Ge&&($e-=1),$e*=Ie;let Ke=new Pe(Math.sin($e),Math.cos($e)*Ve),bt=Ke.clone().multiplyScalar(Me).add(De);Uf(bt,Ae,A),m.push(A.x,A.y,A.z),Uf(Ke,Ae,_),v.push(_.x,_.y,_.z),g.push(Ce,.5+A.y/i),he.push(w++)}}function ue(he,Ce,Ae,Ie,Me){let De=new H,Ve=new Pe,Ge=[Ae,Ie];Me<0&&Ge.reverse();for(let Qe of Ge)Ve.set(Qe,S*Me),Uf(Ve,Ce,De),m.push(De.x,De.y,De.z),v.push(0,Me,0),g.push(.5,.5),he.push(w++)}function me(he,Ce,Ae){let Ie=new Pe(Math.sin(Ae),Math.cos(Ae)),Me=new Pe(-Math.cos(Ae),Math.sin(Ae)),De=new H,Ve=he<0?(ot,$e,Ke)=>p.push(ot,$e,Ke):(ot,$e,Ke)=>p.push(ot,Ke,$e),Ge=new Pe((e+t+V+j)/4,0);Uf(Ge,Ie,De),m.push(De.x,De.y,De.z),v.push(Me.x,0,Me.y),g.push(.5,.5);let Qe=w++;for(let ot of Ce){let $e=m.slice(ot*3,ot*3+3);m.push(...$e),v.push(Me.x,0,Me.y);let Ke=g.slice(ot*2,ot*2+2);g.push(...Ke),w++}for(let ot=Qe+1;ot<w-1;ot++)Ve(Qe,ot,ot+1);Ve(Qe,w-1,Qe+1)}}},hTe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:8,cornerRadiusBottom:8,cornerSegments:8},e.parameters);return i.thetaLength=Ot.clamp(i.thetaLength,0,360),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,depth:i,height:r,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l,cornerRadiusTop:u,cornerRadiusBottom:c,cornerSegments:h}=e.parameters,d;return l===0?(d=new Kt,d.setAttribute("position",new kt([],3))):u>0||c>0||l<360?d=new OY(0,t/2,r,n,s,a,o,l*Math.PI/180,u,c,h,0,!0):d=new rk(t/2,r,n,s,a),d.scale(1,1,i/t),Object.assign(d,{userData:{...e,type:"ConeGeometry"}})}},dTe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:8,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,widthSegments:n,heightSegments:s,depthSegments:a,cornerRadius:o,cornerSegments:l}=e.parameters,u;return o===0?u=new Wu(t,i,r,n,s,a):u=new fTe(t,i,r,n,s,a,o,l),Object.assign(u,{userData:{...e,type:"CubeGeometry"}})}},lD=Math.PI/2,fTe=class extends Kt{constructor(e=1,t=1,i=1,r=1,n=1,s=1,a=0,o=4){super(),this.type="BoxGeometry",r=Math.floor(r),n=Math.floor(n),s=Math.floor(s),o=Math.floor(o),a=Math.min(a,e/2,t/2,i/2);let l=[],u=[],c=[],h=[],d=0;p("z","y","x",-1,-1,i,t,e,s,n),p("z","y","x",1,-1,i,t,-e,s,n),p("x","z","y",1,1,e,i,t,r,s),p("x","z","y",1,-1,e,i,-t,r,s),p("x","y","z",1,-1,e,t,i,r,n),p("x","y","z",-1,-1,e,t,-i,r,n),a>0&&(m("z","y","x",-1,-1,1,i,t,e,s),m("z","y","x",1,-1,-1,i,t,e,s),m("z","y","x",-1,1,-1,i,t,e,s),m("z","y","x",1,1,1,i,t,e,s),m("x","y","z",-1,-1,-1,e,t,i,r),m("x","y","z",1,-1,1,e,t,i,r),m("x","y","z",-1,1,1,e,t,i,r),m("x","y","z",1,1,-1,e,t,i,r),m("y","x","z",-1,-1,1,t,e,i,n),m("y","x","z",1,-1,-1,t,e,i,n),m("y","x","z",1,1,1,t,e,i,n),m("y","x","z",-1,1,-1,t,e,i,n),v(1,1,1),v(-1,1,1),v(1,-1,1),v(-1,-1,1),v(1,1,-1),v(-1,1,-1),v(1,-1,-1),v(-1,-1,-1)),this.setIndex(l),this.setAttribute("position",new kt(u,3)),this.setAttribute("normal",new kt(c,3)),this.setAttribute("uv",new kt(h,2));function p(g,w,S,_,A,C,E,I,T,D){let L=(C-2*a)/T,z=(E-2*a)/D,G=C/2-a,V=E/2-a,j=I/2,J=T+1,ne=D+1,K=0,B=new H;for(let Z=0;Z<ne;Z++){let F=Z*z-V;for(let X=0;X<J;X++){let Y=X*L-G;B[g]=Y*_,B[w]=F*A,B[S]=j,u.push(B.x,B.y,B.z),B[g]=0,B[w]=0,B[S]=I>0?1:-1,c.push(B.x,B.y,B.z),h.push(X/T),h.push(1-Z/D),K+=1}}for(let Z=0;Z<D;Z++)for(let F=0;F<T;F++){let X=d+F+J*Z,Y=d+F+J*(Z+1),le=d+(F+1)+J*(Z+1),oe=d+(F+1)+J*Z;l.push(X,Y,oe),l.push(Y,le,oe)}d+=K}function m(g,w,S,_,A,C,E,I,T,D){let L=(E-2*a)/D,z=E/2-a,G=I/2-a,V=T/2,j=D+1,J=0,ne=new H,K=new H;for(let B=0;B<o+1;B++){let Z=B/o*lD,F=Math.sin(Z)*a,X=(1-Math.cos(Z))*a,Y=Math.sin(Z),le=Math.cos(Z);ne[w]=(G+F)*A,ne[S]=(V-X)*C,K[g]=0,K[w]=Y*Math.sign(ne[w]),K[S]=le*Math.sign(ne[S]);for(let oe=0;oe<j;oe++){let re=oe*L-z;ne[g]=re*_,u.push(ne.x,ne.y,ne.z),c.push(K.x,K.y,K.z),h.push(oe/D),h.push(0),J+=1}}for(let B=0;B<o;B++)for(let Z=0;Z<D;Z++){let F=d+Z+j*B,X=d+Z+j*(B+1),Y=d+(Z+1)+j*(B+1),le=d+(Z+1)+j*B;l.push(F,X,le),l.push(X,Y,le)}d+=J}function v(g,w,S){let _=new H,A=new H(e/2,t/2,i/2);A.subScalar(a);let C=[],E=g*w*S>0?(T,D,L)=>l.push(T,D,L):(T,D,L)=>l.push(T,L,D);for(let T=0;T<=o;T++){let D=[],L=lD*(1-T/o),z=Math.cos(L),G=Math.sin(L),V=0;for(let j=0;j<=T;j++){let J=Math.cos(V),ne=Math.sin(V);_.x=z*J,_.y=G,_.z=z*ne;let K=A.clone().addScaledVector(_,a);u.push(g*K.x,w*K.y,S*K.z),c.push(g*_.x,w*_.y,S*_.z),h.push(0,0),D.push(d++),V+=lD/T}C.push(D)}let I=C.length-1;for(let T=0;T<I;T++){let D=C[T],L=C[T+1],z=D.length-1;E(D[0],L[1],L[0]);for(let G=1;G<=z;G++)E(D[G-1],D[G],L[G]),E(D[G],L[G+1],L[G])}}}},iB=class extends Kt{constructor(e=[],t=[],i="",r=1,n=.2,s=4){super(),this.type="PolyhedronGeometryRound";let a=[],o=[],l=[];u(),c(),this.setAttribute("position",new kt(a,3)),this.setAttribute("normal",new kt(l,3)),this.setAttribute("uv",new kt(o,2));return;function u(){n=Math.min(1-1e-5,n),n==0&&(s=0);let h={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[i],d=new H,p=d.clone(),m=new pa,v=n*r,g=r-v,w=s+1,S=new H,_=(K,B)=>S.subVectors(K,B).normalize(),A=(K,B)=>Array(K).fill(void 0).map(B),C=A(e.length/3,(K,B)=>new H().fromArray(e,B*3).setLength(r)),E=[],I=1e6;for(let K=0;K<C.length;K++){let B=C[K],Z=[],F,X,Y,le=1e10,oe=-1;for(;(oe=t.indexOf(K,oe+1))!=-1;){let he=oe-oe%3;F=t[he+(oe+1)%3],X=t[he+(oe+2)%3],Y=B.distanceToSquared(C[F]),le=Math.min(le,Y),Z.push([F,X,Y])}le+=1e-6;let re=[],ue=0,me=Z.length;for(let he=0;he<me;he++){[F,X,Y]=Z[ue];let Ce=E[F]?.includes(K)==!0;Y<=le&&re.push(F+ +Ce*I),ue=Z.findIndex(Ae=>Ae[0]==X)}E.push(re)}let T=[];{let K=0,B=0,Z,F,X=h==3;for(let Y=0;Y<=s;Y++){Z=Y*(Y+1)/2,F=(Y+1)*(Y+2)/2;for(let le=0;le<s-Y;le++)[K,B]=[Z+le+Y+2,F+le+Y+3],T.push(Z,F,...X?[B,Z]:[K,F],B,K),[Z,F]=[K,B];T.push(Z,F,Z+s+2)}}let D=d.clone(),L=d.clone(),z=d.clone(),G=d.clone(),V=d.clone(),j=[],J=A(C.length,()=>A(h,()=>d.clone()));for(let K=0;K<C.length;K++){d.copy(C[K]).normalize(),D.copy(d).multiplyScalar(g);let B=E[K];for(let re=0;re<B.length;re++){let ue=B[re],me=B[(re+1)%h];m.setFromPointsAndIndices(C,K,ue%I,me%I),m.b.sub(m.a).setLength(1e10).add(m.a),m.c.sub(m.a).setLength(1e10).add(m.a),m.closestPointToPoint(D,J[K][re])}let Z=[],F=[],X=[],Y=new H;s==0&&[...J[K]].reduce((re,ue)=>re.add(ue),Y).multiplyScalar(1/h);for(let re=0;re<h;re++){let ue=[],me=(re-1+h)%h,he=J[K][me],Ce=J[K][re];d.copy(he).sub(D),p.copy(Ce).sub(D);let Ae=D.angleTo(d),Ie=d.angleTo(p),Me=Math.cos(Ae)*v;s==0?L.copy(Y):L.copy(D).setLength(g+Me),F.push(Me);let De=[L,he,Ce];for(let Ve=0;Ve<2;Ve++){let Ge=De[Ve],Qe=De[Ve+1];G.subVectors(Ge,D),V.subVectors(Qe,D),z.crossVectors(G,V).normalize();for(let ot=0;ot<w;ot++){let $e=[Ae,Ie][Ve]*ot/w;d.copy(G).applyAxisAngle(z,$e).add(D),Z.push(d.clone()),Ve&&(_(d,D),ue.push([ot==0?Ge:d.clone(),S.clone()]))}Ve&&(_(Qe,D),ue.push([Qe,S.clone()]))}X.push(ue)}j.push(X);let le=2*w,oe=2;for(let re=0;re<h;re++){let ue=le*re,me=le*((re+1)%h),he=[Z[ue]];for(let Ae=1;Ae<w;Ae++){G=Z[ue+Ae],V=Z[me+Ae],he.push(G);for(let Ie=1,Me=Ae-oe+1;Ie<=Me;Ie++)d.lerpVectors(G,V,Ie/(Me+1)),d.sub(D).setLength(F[re]).add(D),he.push(d.clone());he.push(V)}for(let Ae=0;Ae<w;Ae++)he.push(Z[Ae+w+ue]);he.push(Z[me+w]);let Ce=T.map(Ae=>he[Ae]);a.push(...Ce.map(Ae=>[Ae.x,Ae.y,Ae.z]).flat()),l.push(...Ce.map(Ae=>(_(Ae,D),[S.x,S.y,S.z])).flat())}}let ne=[];for(let K=0;K<E.length;K++)for(let B=0;B<h;B++){let Z=E[K][B];if(Z<I){let F=E[Z].findIndex(le=>le%I==K),X=j[K][B],Y=j[Z][F];for(let le=0;le<w;le++){let oe=X[le],re=Y[w-le],ue=X[le+1],me=Y[w-(le+1)];[oe,re,ue,ue,re,me].forEach(he=>{a.push(he[0].x,he[0].y,he[0].z),l.push(he[1].x,he[1].y,he[1].z)})}ne.push(X[0][0],Y[w][0],X[w][0],Y[0][0])}}for(;ne.length;){let K,B,Z,F;[K,B]=ne.splice(0,2);let X=[K];for(;K!=B;)X.push(B),Z=ne.indexOf(B),F=Z%2,B=ne.splice(Z-F,2)[1-F];S.subVectors(X[0],X[1]).cross(d.subVectors(X[0],X[2])).normalize();let Y=S.dot(X[0])<0;Y&&S.negate();for(let le=1;le<=X.length-2;le++)[X[le+ +Y],X[le+1-+Y],X[0]].forEach(oe=>{a.push(oe.x,oe.y,oe.z),l.push(S.x,S.y,S.z)})}}function c(){let h=new H;for(let E=0;E<a.length;E+=3){h.x=a[E+0],h.y=a[E+1],h.z=a[E+2];let I=A(h)/2/Math.PI+.5,T=C(h)/Math.PI+.5;o.push(I,1-T)}let d=new H,p=new H,m=new H,v=new H,g=new Pe,w=new Pe,S=new Pe,_=(E,I,T,D)=>{D<0&&E.x===1&&(o[I]=E.x-1),T.x===0&&T.z===0&&(o[I]=D/2/Math.PI+.5)};for(let E=0,I=0;E<a.length;E+=9,I+=6){d.set(a[E+0],a[E+1],a[E+2]),p.set(a[E+3],a[E+4],a[E+5]),m.set(a[E+6],a[E+7],a[E+8]),g.set(o[I+0],o[I+1]),w.set(o[I+2],o[I+3]),S.set(o[I+4],o[I+5]),v.copy(d).add(p).add(m).divideScalar(3);let T=A(v);_(g,I+0,d,T),_(w,I+2,p,T),_(S,I+4,m,T)}for(let E=0;E<o.length;E+=6){let I=o[E+0],T=o[E+2],D=o[E+4],L=Math.max(I,T,D),z=Math.min(I,T,D);L>.9&&z<.1&&(I<.2&&(o[E+0]+=1),T<.2&&(o[E+2]+=1),D<.2&&(o[E+4]+=1))}function A(E){return Math.atan2(E.z,-E.x)}function C(E){return Math.atan2(-E.y,Math.sqrt(E.x*E.x+E.z*E.z))}}}static fromJSON(e){return new iB(e.vertices,e.indices,e.radius,e.corner,e.cornerSides)}},pTe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,detail:n,corner:s,cornerSides:a}=e.parameters,o=n===0&&s!==0?new zY(t*.5,s,a):new bq(t*.5,n);return o.scale(1,i/t,r/t),Object.assign(o,{userData:{...e,type:"DodecahedronGeometry"}})}},zY=class extends iB{constructor(e=1,t=.2,i=4){let r=(1+Math.sqrt(5))/2,n=1/r,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],o="DodecahedronGeometry";super(s,a,o,e,t,i),this.type=o}static fromJSON(e){return new zY(e.radius,e.corner,e.cornerSides)}},bw=1e-12,rB=class{constructor(e){this.position=new Pe,this.startPosition=new Pe,this.uuid=Ot.generateUUID(),this.position=e.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(e){this.position.copy(this.startPosition).add(e)}copy(e){return this.position.copy(e.position),this.startPosition.copy(e.startPosition),this}clone(){return new rB(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},HL=class extends rB{constructor(e){super(e.position),this.parent=e}copy(e){return super.copy(e),this}clone(){return new HL(this.parent).copy(this)}},qy=class extends rB{constructor(e,t){super(t),this.controls=[],this.roundness=0,this.areControlsDirectionsMirrored=!0,this.uuid=e,this.controls.push(new HL(this),new HL(this))}static create(e,t){let i=new qy(e,new Pe(...t.position));return i.controls[0].position.set(...t.controlPrevious.position),i.controls[1].position.set(...t.controlNext.position),i.roundness=t.roundness,i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored,i}getOppositeControl(e){let t=this.controls.indexOf(e);return t===0?this.controls[1]:t===1?this.controls[0]:null}applyOffsetToControls(e,t=1){for(let i=0,r=this.controls.length;i<r;i++){let n=this.controls[i];this.position.distanceTo(n.position)<=t?n.position.copy(this.position):n.applyOffset(e)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(e){return super.copy(e),this.controls[0].copy(e.controls[0]),this.controls[1].copy(e.controls[1]),this.roundness=e.roundness,this.uuid=e.uuid,this}clone(){return new qy(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){let e=this.curveBefore?.getTangentAt(1),t=this.curveAfter?.getTangentAt(0);return[e,t]}computeNormals(e=new Pe,t=new Pe){let[i,r]=this.computeTangents();return i&&r&&(nj(i,e),nj(r,t)),[e,t]}computeTangent(e=new Pe){let[t,i]=this.computeTangents();return t&&i&&e.copy(t).add(i).normalize(),e}computeNormal(e=new Pe){let[t,i]=this.computeNormals();return e.copy(t).add(i).normalize(),e}};function nj(e,t=new Pe){let i=e.length();return t.set(-e.y/i,e.x/i)}var nB=e=>e,Qx=new Pe,lT=new Pe,mTe=new Pe,gTe=new Pe,vTe=new Pe,yTe=new Pe,kY=new H,BY=new H;function xTe(e){let t=new Pe;t.addVectors(e.v0,Qx.subVectors(e.v1,e.v0).multiplyScalar(2/3));let i=new Pe;return i.addVectors(e.v2,lT.subVectors(e.v1,e.v2).multiplyScalar(2/3)),new zu(e.v0,t,i,e.v2)}function Ww(e,t,i=Number.EPSILON){return Math.abs(e-t)<i}function wTe(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function bTe(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function NY(e,t,i){let r=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),n=Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)),s=Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2));return Math.acos((n*n+r*r-s*s)/(2*n*r))}function _Te(e,t,i){return aj(e,t)&&aj(t,i)&&WL(e.position,t.position,i.position)}function WL(e,t,i){return Qx.copy(t).sub(e).cross(lT.copy(i).sub(e))===0}function STe(e,t,i,r,n){let s=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),a=(e.y+t.y)/2,o=(e.x+t.x)/2,l=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(e.y-t.y)/s,u=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(t.x-e.x)/s;return r.set(o+l,a+u),n.set(o-l,a-u),[r,n]}function MTe(e,t,i){let r=e.distanceTo(i),n=t.distanceTo(i);return r<n?t:e}function ATe(e,t,i,r,n,s){let a=t.x-e.x,o=t.y-e.y,l=i.x-e.x,u=i.y-e.y,c=Math.sqrt((a+l)*(a+l)+(o+u)*(o+u)),h;return NY(t,e,i)>Math.PI&&(c*=-1),Ww(u,o)?h=(o+u)*(r/c-.5)*8/3/(a-l):h=(a+l)*(r/c-.5)*8/3/(u-o),n.set(t.x-h*o,t.y+h*a),s.set(i.x+h*u,i.y-h*l),[n,s]}function sj(e,t){return e.position.equals(e.controls[1].position)&&t.position.equals(t.controls[0].position)}function aj(e,t){return WL(e.position,e.controls[1].position,t.position)&&WL(e.position,t.controls[0].position,t.position)}function ETe(e,t,i,r,n=.5){let s=Qx.subVectors(t,e).multiplyScalar(n).add(e),a=lT.subVectors(i,t).multiplyScalar(n).add(t),o=mTe.subVectors(r,i).multiplyScalar(n).add(i),l=s,u=gTe.subVectors(a,s).multiplyScalar(n).add(s),c=vTe.subVectors(o,a).multiplyScalar(n).add(a),h=o,d=yTe.subVectors(c,u).multiplyScalar(n).add(u);return[e.x,e.y,l.x,l.y,u.x,u.y,d.x,d.y,c.x,c.y,h.x,h.y,r.x,r.y]}function CTe(e,t,i=12,r=!0){let n=BY.set(0,0,0),s,a=0;for(let o=0;o<t.length;o++){let l=nB(t[o]),u=Qx,c=zg(l,i);for(let h=0;h<=c;h++)if(l instanceof zu||l instanceof Ip||l instanceof Fu){if(l.getPoint(h/c,u),n.set(u.x,u.y,0),s!==void 0&&bTe(s,n))continue;s===void 0&&(s=kY),s.copy(n),e.setXYZ(a,n.x,n.y,n.z),a++}}return r&&a>1&&!(e.getX(a-1)===e.getX(0)&&e.getY(a-1)===e.getY(0)&&e.getZ(a-1)===e.getZ(0))&&(e.setXYZ(a,e.getX(0),e.getY(0),e.getZ(0)),a++),e}function TTe(e,t,i,r=12,n=!0){let s=BY.set(0,0,0),a=0,o=[];for(let l=0;l<t.length;l++){if(i[l]===!1)continue;let u,c=nB(t[l]),h=Qx,d=zg(c,r);o.push(d);for(let p=0;p<=d;p++)if(c instanceof zu||c instanceof Ip||c instanceof Fu){if(c.getPoint(p/d,h),s.set(h.x,h.y,0),u?.equals(s))continue;u===void 0?u=kY:(e.setXYZ(a,u.x,u.y,u.z),a++,e.setXYZ(a,s.x,s.y,s.z),a++),u.copy(s)}}return n&&a>1&&!(e.getX(a-1)===e.getX(0)&&e.getY(a-1)===e.getY(0)&&e.getZ(a-1)===e.getZ(0))&&(e.setXYZ(a,e.getX(0),e.getY(0),e.getZ(0)),a++),o}function oj(e,t=12,i=!1){let r=[];for(let n=0,s=e.length;n<s;n++){let a=e[n],o=0;if(i&&a.roundedCurveCorner!==void 0){let l=zg(a.roundedCurveCorner,t)*.5;n>0&&(r[n-1]+=l),o+=l}a.curveAfter!==void 0&&(o+=zg(a.curveAfter,t)),r.push(o)}return e.length>0&&i&&e[0].roundedCurveCorner!==void 0&&(r[e.length-1]+=zg(e[0].roundedCurveCorner,t)*.5),r}function zg(e,t=12){return e&&e instanceof WC?t*2:e&&(e instanceof Fu||e instanceof yq)?1:e&&e instanceof tk?t*e.points.length:t}function PTe(e,t,i=12,r=!0){let n,s=0;for(let a=0;a<t.length;a++){let o=nB(t[a]),l=zg(o,i),u=Qx;for(let c=0;c<=l;c++)if(o instanceof zu||o instanceof Ip||o instanceof Fu){if(o.getPoint(c/l,u),n!==void 0&&wTe(n,u,bw))continue;n===void 0&&(n=lT),n.copy(u),e.push(u.x,u.y),s++}}return Ww(e[0],e[e.length-2],bw)&&Ww(e[1],e[e.length-1],bw)&&(e.pop(),e.pop()),r&&s>1&&!(Ww(e[s-1],e[1],bw)&&Ww(e[s-2],e[0],bw))&&(e.push(e[0],e[1]),s++),e}var uD=new Pe,DTe=new Pe,RTe=new Pe,ITe=new Pe,LTe=new Pe,OTe=new Pe,wn=class extends d2{constructor(e=100,t=100){super(),this.points=[],this.shapeHoles=[],this.plane=new Oo(new H(0,0,-1)),this.subdivision=0,this.controlSnapDistance=4,this.pointIDs=0,this.isMesh2D=!1,this.isText=!1,this._roundness=0,this.isClosed=!1,this.useCubicForRoundedCorners=!0,this.uuid=Ot.generateUUID(),this.needsUpdate=!1,this.roundedCurves=[],this._width=e,this._height=t}static createFromState(e,t,i){let r=new wn;return r.isClosed=e.isClosed,r.points=e.points.map(n=>qy.create(n.id,n.data)),typeof e.roundness=="number"&&(r.roundness=e.roundness),r.shapeHoles=e.shapeHoles.map(n=>wn.createFromState(n)),t!==void 0&&i!==void 0&&r.applySize(t,i),r.update(),r}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(e){if(this._roundness!==e){this._roundness=e;for(let t=0,i=this.points.length;t<i;t++)this.points[t].roundness=e;this.needsUpdate=!0}}getPointsIndexesByIds(e){return e.map(t=>this.getPointIndexById(t)).filter(t=>t>=0)}getPointIndexById(e){let t=this.points.length,i=this.points.findIndex(r=>r.uuid===e);if(i<0){let r=t;for(let n=0,s=this.shapeHoles.length;n<s;n++){let a=this.shapeHoles[n],o=a.points.length,l=a.getPointIndexById(e);if(l<0)r+=o;else return l+r}}return i}getLineIndexById(e){return this.getPointIndexById(e)}getBezierPoint(e){if(e<=this.points.length-1)return this.points[e];if(this.shapeHoles.length>0){let t=this.points.length;for(let i=0,r=this.shapeHoles.length;i<r;i++){let n=this.shapeHoles[i],s=e-t;if(s<=n.points.length-1)return n.points[s];t+=n.points.length}}throw new Error("This shape does not have a point for this index: "+e)}getBezierPointIndex(e){let t=this.points.indexOf(e);if(t>=0)return t;if(t=this.points.length,this.shapeHoles.length>0)for(let i=0,r=this.shapeHoles.length;i<r;i++){let n=this.shapeHoles[i],s=n.points.indexOf(e);if(s>=0)return t+s;t+=n.points.length}return-1}getAllPoints(){let e=[].concat(...this.shapeHoles.map(t=>t.points));return[...this.points,...e]}applySize(e,t){e===0&&(e=.001),t===0&&(t=.001),this._width=e,this._height=t}applyScale(e,t){let i=uD.set(e,t);for(let r=0,n=this.points.length;r<n;r++){let s=this.points[r];s.position.multiply(i),s.controls[0].position.multiply(i),s.controls[1].position.multiply(i)}for(let r=0,n=this.shapeHoles.length;r<n;r++)this.shapeHoles[r].applyScale(e,t);this._update()}createPoint(e,t=0,i=Ot.generateUUID()){let r;e instanceof Pe?r=e:r=new Pe(e,t);let n=new qy(i,r);return n.roundness=this.roundness,n}addPoint(e){this.points.push(e),this.needsUpdate=!0}addPointAt(e,t){this.points.splice(t,0,e),this.needsUpdate=!0}getPointByUuid(e){for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];if(r.uuid===e)return r}for(let t=0,i=this.shapeHoles.length;t<i;t++){let r=this.shapeHoles[t].getPointByUuid(e);if(r)return r}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(e){let t=this.points.indexOf(e);t>=0&&this.points.splice(t,1),this.needsUpdate=!0}removePointById(e){let t=this.points.find(i=>i.uuid===e);t&&this.removePoint(t)}update(){for(let e=0,t=this.shapeHoles.length;e<t;e++)this.shapeHoles[e].update();this._update()}extractShapePointsToBuffer(e,t=12,i=!1){this.subdivision=t,this.curveDivisions===void 0&&this.computeCurveDivisions(t);let r=i?this.roundedCurveDivisions:this.curveDivisions;return CTe(e,i?this.roundedCurves:this.curves,t,this.autoClose),r.reduce((n,s)=>n+s,0)+1}computeCurveDivisions(e=12){return this.curveDivisions=oj(this.points,e,!1),this.roundedCurveDivisions=oj(this.points,e,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(e,t,i=12){return TTe(e,this.curves,t,i,this.autoClose).reduce((r,n)=>r+n,0)*2}extractShapePointsToFlatArray(e,t=12){return this.subdivision=t,this.curveDivisions===void 0&&this.computeCurveDivisions(t),PTe(e,this.roundedCurves,t,this.autoClose)}getCurveIndexFromVertexId(e,t=!1){let i=0;this.curveDivisions===void 0&&this.computeCurveDivisions(this.subdivision);let r=t?this.roundedCurveDivisions:this.curveDivisions,n=0;t&&this.points[0].roundedCurveCorner!==void 0&&(n=zg(this.points[0].roundedCurveCorner,this.subdivision)*.5);let s=e-n;s<0&&(s+=r.reduce((a,o)=>a+o,0));for(let a=0,o=r.length;a<o;a++){let l=r[a];if(s<i+l)return[a,(s-i+1)/l];i+=l}return[0,1]}getCurveT(e,t,i){let r=this.points[e],n=this.points[e>=this.points.length-1?0:e+1],s=this.curveDivisions,a=s[e];if(sj(r,n)){let l=r.position.distanceTo(n.position);return r.position.distanceTo(uD.set(i.x,i.y))/l}let o=0;for(let l=0;l<e;l++)o+=s[l];return(t-o)/a}dispose(){}_applyCurveForPoint(e,t){sj(t,e)?this.lineTo(e.position.x,e.position.y):this.bezierCurveTo(t.controls[1].position.x,t.controls[1].position.y,e.controls[0].position.x,e.controls[0].position.y,e.position.x,e.position.y);let i=this.curves[this.curves.length-1];e.curveBefore=i,t.curveAfter=i;let r=i.clone();e.roundedCurveBefore=r,t.roundedCurveAfter=r,e.roundedCurveCorner=void 0,this.roundedCurves.push(r)}_update(){if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];if(t===0)this.moveTo(r.position.x,r.position.y);else{let n=this.points[t-1];this._applyCurveForPoint(r,n)}}let e=this.getLastPoint();if(e?.curveAfter&&(e.curveAfter=void 0),this.isClosed){let t=this.points[0],i=this.points[this.points.length-1];this._applyCurveForPoint(t,i)}if(this.points.length>2){let t=0;for(let i=0,r=this.points.length;i<r;i++){let n=this.points[i],s=this.points[i-1]??this.points[this.points.length-1],a=this.points[i+1]??this.points[0],o=n.roundness,l=s&&a&&_Te(s,n,a);if(!n.controlsMoved()&&o>0&&!l){let u=n.curveBefore,c=n.curveAfter;if(u===void 0||c===void 0)continue;let h=n.roundedCurveBefore,d=n.roundedCurveAfter,p=u.getLength(),m=c.getLength(),v=Math.min(o,p*.499),g=Math.min(o,m*.499),w=Math.min(v,g),S=1-w/p,_=w/m,A=u.getPointAt(S,uD),C=c.getPointAt(_,DTe);this._subSplitCurve(u,h,S,A,void 0),this._subSplitCurve(c,d,_,void 0,C);let E;if(this.useCubicForRoundedCorners){let I=NY(A,n.position,C)/2,T=Math.tan(I)*A.distanceTo(n.position),[D,L]=STe(A,C,T,RTe,ITe),z=MTe(D,L,n.position),[G,V]=ATe(z,A,C,T,LTe,OTe);E=new zu(A.clone(),G.clone(),V.clone(),C.clone())}else E=new Ip(A.clone(),n.position.clone(),C.clone());n.roundedCurveCorner=E,this.roundedCurves.splice(i+t,0,E),t++}}}}_subSplitCurve(e,t,i,r,n){if(e instanceof Fu)r!==void 0&&t.v2.copy(r),n!==void 0&&t.v1.copy(n);else{let s=e,a=t,o=s.getUtoTmapping(i,0),l=ETe(s.v0,s.v1,s.v2,s.v3,o);return r!==void 0&&(a.v0.set(l[0],l[1]),a.v1.set(l[2],l[3]),a.v2.set(l[4],l[5]),a.v3.set(l[6],l[7])),n!==void 0&&(a.v0.set(l[6],l[7]),a.v1.set(l[8],l[9]),a.v2.set(l[10],l[11]),a.v3.set(l[12],l[13])),a}return t}clone(){let e=new wn(this._width,this._height);return e.points=this.points.map(t=>t.clone()),e.isClosed=this.isClosed,e.roundness=this.roundness,e.isMesh2D=this.isMesh2D,e.shapeHoles=this.shapeHoles.map(t=>t.clone()),e}toJSON(){return{points:this.points.reduce((e,t)=>e.concat(t.toJSON()),[]),shapeHoles:this.shapeHoles.map(e=>e.toJSON()),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(e){this.points=[],this.pointIDs=0;let t=e.points.length/7;for(let i=0;i<t;i++){let r=i*7,n=e.points[r+0],s=e.points[r+1],a=e.points[r+2],o=e.points[r+3],l=e.points[r+4],u=e.points[r+5],c=e.points[r+6],h=new qy(Ot.generateUUID(),new Pe(n,s));h.controls[0].position.set(a,o),h.controls[1].position.set(l,u),h.roundness=c,this.points.push(h)}return this.shapeHoles=e.shapeHoles?.length?e.shapeHoles.map(i=>{let r=new wn;return r.fromJSON(i),r}):[],this.isClosed=e.isClosed,this._roundness=e.roundness,this._update(),this}fromShape(e,t=!1){this.isText=t;let i=(n,s)=>{s instanceof zu&&s.v3.equals(n.position)&&n.controls[0].position.copy(s.v2)},r=n=>{let s=[],a,o;for(a=0,o=n.length;a<o;a++)n[a]instanceof Ip&&(n[a]=xTe(n[a]));for(a=0,o=n.length;a<o;a++){let c=n[a],h=a>0?n[a-1]:null,d;c instanceof zu?(d=this.createPoint(c.v0),d.controls[1].position.copy(c.v1)):c instanceof Fu&&(d=this.createPoint(c.v1)),d!==void 0&&(h!==null&&i(d,h),s.push(d))}let l=n[n.length-1],u=!1;return l instanceof zu?l.v3.equals(s[0].position)&&(s[0].controls[0].position.copy(l.v2),u=!0):l instanceof Fu&&l.v2.equals(s[0].position)&&(u=!0),this.isClosed=u,s};return this.points=r(e.curves),e instanceof d2&&(this.shapeHoles=e.holes.map(n=>{let s=new wn;return s.fromShape(n),s})),this.update(),this}updatePoint(e,t){let i=this.getPointByUuid(e);i&&(t.position!==void 0&&i.position.fromArray(t.position),t.roundness!==void 0&&(i.roundness=t.roundness),t.areControlsDirectionsMirrored!==void 0&&(i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored),this.needsUpdate=!0)}updatePreviousControl(e,t){let i=this.getPointByUuid(e)?.controls[0];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}updateNextControl(e,t){let i=this.getPointByUuid(e)?.controls[1];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}},FY=Math.PI*2;function cD({x:e,y:t},i,r,n,s){return{x:e*i+n,y:t*r+s}}function zTe(e,t){let i=t===1.5707963267948966?.551915024494:t===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(t/4),r=Math.cos(e),n=Math.sin(e),s=Math.cos(e+t),a=Math.sin(e+t);return[{x:r-n*i,y:n+r*i},{x:s+a*i,y:a-s*i},{x:s,y:a}]}function lj(e,t,i,r){let n=e*r-t*i<0?-1:1,s=Math.min(1,Math.max(-1,e*i+t*r));return n*Math.acos(s)}function kTe(e,t,i,r,n,s,a,o,l,u){let c=Math.pow(n,2),h=Math.pow(s,2),d=Math.pow(a,2),p=Math.pow(o,2),m=c*h-c*p-h*d;m<0&&(m=0),m/=c*p+h*d,m=Math.sqrt(m)*(l===u?-1:1);let v=m*n/s*o,g=m*-s/n*a,w=v+(e+i)/2,S=g+(t+r)/2,_=(a-v)/n,A=(o-g)/s,C=(-a-v)/n,E=(-o-g)/s,I=lj(1,0,_,A),T=lj(_,A,C,E);return T<0&&(T+=FY),{centerx:w,centery:S,ang1:I,ang2:T}}function BTe({px:e,py:t,cx:i,cy:r,rx:n,ry:s,largeArcFlag:a,sweepFlag:o}){let l=[];if(n===0||s===0)return[];let u=(e-i)/2,c=(t-r)/2;if(u===0&&c===0)return[];n=Math.abs(n),s=Math.abs(s);let h=Math.pow(u,2)/Math.pow(n,2)+Math.pow(c,2)/Math.pow(s,2);h>1&&(n*=Math.sqrt(h),s*=Math.sqrt(h));let d=kTe(e,t,i,r,n,s,u,c,a,o),{ang1:p,ang2:m}=d,{centerx:v,centery:g}=d,w=Math.abs(m)/(FY/4);Math.abs(1-w)<1e-7&&(w=1);let S=Math.max(Math.ceil(w),1);m/=S;for(let _=0;_<S;_++)l.push(zTe(p,m)),p+=m;return l.map(_=>{let{x:A,y:C}=cD(_[0],n,s,v,g),{x:E,y:I}=cD(_[1],n,s,v,g),{x:T,y:D}=cD(_[2],n,s,v,g);return{x1:A,y1:C,x2:E,y2:I,x:T,y:D}})}var Sr;(function(e){e[e.ODD=0]="ODD",e[e.NONZERO=1]="NONZERO",e[e.POSITIVE=2]="POSITIVE",e[e.NEGATIVE=3]="NEGATIVE",e[e.ABS_GEQ_TWO=4]="ABS_GEQ_TWO"})(Sr||(Sr={}));var is;(function(e){e[e.POLYGONS=0]="POLYGONS",e[e.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",e[e.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS"})(is||(is={}));function yi(e,t){if(!e)throw t||"Assertion Failed!"}var ai=(function(){function e(){}return e.vertEq=function(t,i){return t.s===i.s&&t.t===i.t},e.vertLeq=function(t,i){return t.s<i.s||t.s===i.s&&t.t<=i.t},e.transLeq=function(t,i){return t.t<i.t||t.t===i.t&&t.s<=i.s},e.edgeGoesLeft=function(t){return e.vertLeq(t.Dst,t.Org)},e.edgeGoesRight=function(t){return e.vertLeq(t.Org,t.Dst)},e.vertL1dist=function(t,i){return Math.abs(t.s-i.s)+Math.abs(t.t-i.t)},e.edgeEval=function(t,i,r){yi(e.vertLeq(t,i)&&e.vertLeq(i,r));var n=i.s-t.s,s=r.s-i.s;return n+s>0?n<s?i.t-t.t+(t.t-r.t)*(n/(n+s)):i.t-r.t+(r.t-t.t)*(s/(n+s)):0},e.edgeSign=function(t,i,r){yi(e.vertLeq(t,i)&&e.vertLeq(i,r));var n=i.s-t.s,s=r.s-i.s;return n+s>0?(i.t-r.t)*n+(i.t-t.t)*s:0},e.transEval=function(t,i,r){yi(e.transLeq(t,i)&&e.transLeq(i,r));var n=i.t-t.t,s=r.t-i.t;return n+s>0?n<s?i.s-t.s+(t.s-r.s)*(n/(n+s)):i.s-r.s+(r.s-t.s)*(s/(n+s)):0},e.transSign=function(t,i,r){yi(e.transLeq(t,i)&&e.transLeq(i,r));var n=i.t-t.t,s=r.t-i.t;return n+s>0?(i.s-r.s)*n+(i.s-t.s)*s:0},e.vertCCW=function(t,i,r){return t.s*(i.t-r.t)+i.s*(r.t-t.t)+r.s*(t.t-i.t)>=0},e.interpolate=function(t,i,r,n){return t=t<0?0:t,r=r<0?0:r,t<=r?r===0?(i+n)/2:i+(n-i)*(t/(t+r)):n+(i-n)*(r/(t+r))},e.intersect=function(t,i,r,n,s){var a,o,l;e.vertLeq(t,i)||(l=t,t=i,i=l),e.vertLeq(r,n)||(l=r,r=n,n=l),e.vertLeq(t,r)||(l=t,t=r,r=l,l=i,i=n,n=l),e.vertLeq(r,i)?e.vertLeq(i,n)?(a=e.edgeEval(t,r,i),o=e.edgeEval(r,i,n),a+o<0&&(a=-a,o=-o),s.s=e.interpolate(a,r.s,o,i.s)):(a=e.edgeSign(t,r,i),o=-e.edgeSign(t,n,i),a+o<0&&(a=-a,o=-o),s.s=e.interpolate(a,r.s,o,n.s)):s.s=(r.s+i.s)/2,e.transLeq(t,i)||(l=t,t=i,i=l),e.transLeq(r,n)||(l=r,r=n,n=l),e.transLeq(t,r)||(l=t,t=r,r=l,l=i,i=n,n=l),e.transLeq(r,i)?e.transLeq(i,n)?(a=e.transEval(t,r,i),o=e.transEval(r,i,n),a+o<0&&(a=-a,o=-o),s.t=e.interpolate(a,r.t,o,i.t)):(a=e.transSign(t,r,i),o=-e.transSign(t,n,i),a+o<0&&(a=-a,o=-o),s.t=e.interpolate(a,r.t,o,n.t)):s.t=(r.t+i.t)/2},e})(),_w=(function(){function e(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1}return e})(),kA=(function(){function e(t){this.side=t,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(e.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(t){this.Sym.Lface=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(t){this.Sym.Org=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(t){this.Sym.Lnext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(t){this.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(t){this.Lnext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(t){this.Sym.Onext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(t){this.Sym.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(t){this.Sym.Lnext.Sym=t},enumerable:!0,configurable:!0}),e})(),vy=(function(){function e(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0}return e})(),uj=(function(){function e(){var t=new vy,i=new _w,r=new kA(0),n=new kA(1);t.next=t.prev=t,t.anEdge=null,i.next=i.prev=i,r.next=r,r.Sym=n,n.next=n,n.Sym=r,this.vHead=t,this.fHead=i,this.eHead=r,this.eHeadSym=n}return e.prototype.makeEdge_=function(t){var i=new kA(0),r=new kA(1);t.Sym.side<t.side&&(t=t.Sym);var n=t.Sym.next;return r.next=n,n.Sym.next=i,i.next=t,t.Sym.next=r,i.Sym=r,i.Onext=i,i.Lnext=r,i.Org=null,i.Lface=null,i.winding=0,i.activeRegion=null,r.Sym=i,r.Onext=r,r.Lnext=i,r.Org=null,r.Lface=null,r.winding=0,r.activeRegion=null,i},e.prototype.splice_=function(t,i){var r=t.Onext,n=i.Onext;r.Sym.Lnext=i,n.Sym.Lnext=t,t.Onext=n,i.Onext=r},e.prototype.makeVertex_=function(t,i,r){var n=t;yi(n,"Vertex can't be null!");var s=r.prev;n.prev=s,s.next=n,n.next=r,r.prev=n,n.anEdge=i;var a=i;do a.Org=n,a=a.Onext;while(a!==i)},e.prototype.makeFace_=function(t,i,r){var n=t;yi(n,"Face can't be null");var s=r.prev;n.prev=s,s.next=n,n.next=r,r.prev=n,n.anEdge=i,n.trail=null,n.marked=!1,n.inside=r.inside;var a=i;do a.Lface=n,a=a.Lnext;while(a!==i)},e.prototype.killEdge_=function(t){t.Sym.side<t.side&&(t=t.Sym);var i=t.next,r=t.Sym.next;i.Sym.next=r,r.Sym.next=i},e.prototype.killVertex_=function(t,i){var r=t.anEdge,n=r;do n.Org=i,n=n.Onext;while(n!==r);var s=t.prev,a=t.next;a.prev=s,s.next=a},e.prototype.killFace_=function(t,i){var r=t.anEdge,n=r;do n.Lface=i,n=n.Lnext;while(n!==r);var s=t.prev,a=t.next;a.prev=s,s.next=a},e.prototype.makeEdge=function(){var t=new vy,i=new vy,r=new _w,n=this.makeEdge_(this.eHead);return this.makeVertex_(t,n,this.vHead),this.makeVertex_(i,n.Sym,this.vHead),this.makeFace_(r,n,this.fHead),n},e.prototype.splice=function(t,i){var r=!1,n=!1;if(t!==i){if(i.Org!==t.Org&&(n=!0,this.killVertex_(i.Org,t.Org)),i.Lface!==t.Lface&&(r=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(i,t),!n){var s=new vy;this.makeVertex_(s,i,t.Org),t.Org.anEdge=t}if(!r){var a=new _w;this.makeFace_(a,i,t.Lface),t.Lface.anEdge=t}}},e.prototype.delete=function(t){var i=t.Sym,r=!1;if(t.Lface!==t.Rface&&(r=!0,this.killFace_(t.Lface,t.Rface)),t.Onext===t)this.killVertex_(t.Org,null);else if(t.Rface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev),!r){var n=new _w;this.makeFace_(n,t,t.Lface)}i.Onext===i?(this.killVertex_(i.Org,null),this.killFace_(i.Lface,null)):(t.Lface.anEdge=i.Oprev,i.Org.anEdge=i.Onext,this.splice_(i,i.Oprev)),this.killEdge_(t)},e.prototype.addEdgeVertex=function(t){var i=this.makeEdge_(t),r=i.Sym;this.splice_(i,t.Lnext),i.Org=t.Dst;var n=new vy;return this.makeVertex_(n,r,i.Org),i.Lface=r.Lface=t.Lface,i},e.prototype.splitEdge=function(t){var i=this.addEdgeVertex(t),r=i.Sym;return this.splice_(t.Sym,t.Sym.Oprev),this.splice_(t.Sym,r),t.Dst=r.Org,r.Dst.anEdge=r.Sym,r.Rface=t.Rface,r.winding=t.winding,r.Sym.winding=t.Sym.winding,r.idx=t.idx,r.Sym.idx=t.Sym.idx,r},e.prototype.connect=function(t,i){var r=!1,n=this.makeEdge_(t),s=n.Sym;if(i.Lface!==t.Lface&&(r=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(n,t.Lnext),this.splice_(s,i),n.Org=t.Dst,s.Org=i.Org,n.Lface=s.Lface=t.Lface,t.Lface.anEdge=s,!r){var a=new _w;this.makeFace_(a,n,t.Lface)}return n},e.prototype.zapFace=function(t){var i=t.anEdge,r,n,s,a,o;n=i.Lnext;do r=n,n=r.Lnext,r.Lface=null,r.Rface===null&&(r.Onext===r?this.killVertex_(r.Org,null):(r.Org.anEdge=r.Onext,this.splice_(r,r.Oprev)),s=r.Sym,s.Onext===s?this.killVertex_(s.Org,null):(s.Org.anEdge=s.Onext,this.splice_(s,s.Oprev)),this.killEdge_(r));while(r!=i);a=t.prev,o=t.next,o.prev=a,a.next=o},e.prototype.countFaceVerts_=function(t){var i=t.anEdge,r=0;do r++,i=i.Lnext;while(i!==t.anEdge);return r},e.prototype.mergeConvexFaces=function(t){var i,r,n,s,a,o,l;for(i=this.fHead.next;i!==this.fHead;i=i.next)if(i.inside)for(r=i.anEdge,a=r.Org;n=r.Lnext,s=r.Sym,s&&s.Lface&&s.Lface.inside&&(o=this.countFaceVerts_(i),l=this.countFaceVerts_(s.Lface),o+l-2<=t&&ai.vertCCW(r.Lprev.Org,r.Org,s.Lnext.Lnext.Org)&&ai.vertCCW(s.Lprev.Org,s.Org,r.Lnext.Lnext.Org)&&(n=s.Lnext,this.delete(s),r=null,s=null)),!(r&&r.Lnext.Org===a);)r=n;return!0},e.prototype.check=function(){var t=this.fHead,i=this.vHead,r=this.eHead,n,s,a,o,l,u;for(s=t,s=t;(n=s.next)!==t;s=n){yi(n.prev===s),l=n.anEdge;do yi(l.Sym!==l),yi(l.Sym.Sym===l),yi(l.Lnext.Onext.Sym===l),yi(l.Onext.Sym.Lnext===l),yi(l.Lface===n),l=l.Lnext;while(l!==n.anEdge)}for(yi(n.prev===s&&n.anEdge===null),o=i,o=i;(a=o.next)!==i;o=a){yi(a.prev===o),l=a.anEdge;do yi(l.Sym!==l),yi(l.Sym.Sym===l),yi(l.Lnext.Onext.Sym===l),yi(l.Onext.Sym.Lnext===l),yi(l.Org===a),l=l.Onext;while(l!==a.anEdge)}for(yi(a.prev===o&&a.anEdge===null),u=r,u=r;(l=u.next)!==r;u=l)yi(l.Sym.next===u.Sym),yi(l.Sym!==l),yi(l.Sym.Sym===l),yi(l.Org!==null),yi(l.Dst!==null),yi(l.Lnext.Onext.Sym===l),yi(l.Onext.Sym.Lnext===l);yi(l.Sym.next===u.Sym&&l.Sym===this.eHeadSym&&l.Sym.Sym===l&&l.Org===null&&l.Dst===null&&l.Lface===null&&l.Rface===null)},e})(),cj=(function(){function e(){this.handle=null}return e})(),hj=(function(){function e(){this.key=null,this.node=0}return e})(),NTe=(function(){function e(t,i){this.leq=i,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=t,this.nodes=[],this.handles=[];for(var r=0;r<t+1;r++)this.nodes[r]=new cj,this.handles[r]=new hj;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return e.prototype.floatDown_=function(t){var i=this.nodes,r=this.handles,n,s,a;for(n=i[t].handle;;){if(a=t<<1,a<this.size&&this.leq(r[i[a+1].handle].key,r[i[a].handle].key)&&++a,yi(a<=this.max),s=i[a].handle,a>this.size||this.leq(r[n].key,r[s].key)){i[t].handle=n,r[n].node=t;break}i[t].handle=s,r[s].node=t,t=a}},e.prototype.floatUp_=function(t){var i=this.nodes,r=this.handles,n,s,a;for(n=i[t].handle;;){if(a=t>>1,s=i[a].handle,a===0||this.leq(r[s].key,r[n].key)){i[t].handle=n,r[n].node=t;break}i[t].handle=s,r[s].node=t,t=a}},e.prototype.init=function(){for(var t=this.size;t>=1;--t)this.floatDown_(t);this.initialized=!0},e.prototype.min=function(){return this.handles[this.nodes[1].handle].key},e.prototype.insert=function(t){var i,r;if(i=++this.size,i*2>this.max){this.max*=2;var n,s;for(s=this.nodes.length,this.nodes.length=this.max+1,n=s;n<this.nodes.length;n++)this.nodes[n]=new cj;for(s=this.handles.length,this.handles.length=this.max+1,n=s;n<this.handles.length;n++)this.handles[n]=new hj}return this.freeList===0?r=i:(r=this.freeList,this.freeList=this.handles[r].node),this.nodes[i].handle=r,this.handles[r].node=i,this.handles[r].key=t,this.initialized&&this.floatUp_(i),r},e.prototype.extractMin=function(){var t=this.nodes,i=this.handles,r=t[1].handle,n=i[r].key;return this.size>0&&(t[1].handle=t[this.size].handle,i[t[1].handle].node=1,i[r].key=null,i[r].node=this.freeList,this.freeList=r,--this.size,this.size>0&&this.floatDown_(1)),n},e.prototype.delete=function(t){var i=this.nodes,r=this.handles,n;yi(t>=1&&t<=this.max&&r[t].key!==null),n=r[t].node,i[n].handle=i[this.size].handle,r[i[n].handle].node=n,--this.size,n<=this.size&&(n<=1||this.leq(r[i[n>>1].handle].key,r[i[n].handle].key)?this.floatDown_(n):this.floatUp_(n)),r[t].key=null,r[t].node=this.freeList,this.freeList=t},e})(),hD=(function(){function e(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1}return e})(),dj=(function(){function e(){this.key=null,this.next=null,this.prev=null}return e})(),FTe=(function(){function e(t,i){this.frame=t,this.leq=i,this.head=new dj,this.head.next=this.head,this.head.prev=this.head}return e.prototype.min=function(){return this.head.next},e.prototype.max=function(){return this.head.prev},e.prototype.insert=function(t){return this.insertBefore(this.head,t)},e.prototype.search=function(t){var i=this.head;do i=i.next;while(i.key!==null&&!this.leq(this.frame,t,i.key));return i},e.prototype.insertBefore=function(t,i){do t=t.prev;while(t.key!==null&&!this.leq(this.frame,t.key,i));var r=new dj;return r.key=i,r.next=t.next,t.next.prev=r,r.prev=t,t.next=r,r},e.prototype.delete=function(t){t.next.prev=t.prev,t.prev.next=t.next},e})(),UTe=(function(){function e(){}return e.regionBelow=function(t){return t.nodeUp.prev.key},e.regionAbove=function(t){return t.nodeUp.next.key},e.debugEvent=function(t){},e.addWinding=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.edgeLeq=function(t,i,r){var n=t.event,s=i.eUp,a=r.eUp;if(s.Dst===n)return a.Dst===n?ai.vertLeq(s.Org,a.Org)?ai.edgeSign(a.Dst,s.Org,a.Org)<=0:ai.edgeSign(s.Dst,a.Org,s.Org)>=0:ai.edgeSign(a.Dst,n,a.Org)<=0;if(a.Dst===n)return ai.edgeSign(s.Dst,n,s.Org)>=0;var o=ai.edgeEval(s.Dst,n,s.Org),l=ai.edgeEval(a.Dst,n,a.Org);return o>=l},e.deleteRegion=function(t,i){i.fixUpperEdge&&yi(i.eUp.winding===0),i.eUp.activeRegion=null,t.dict.delete(i.nodeUp)},e.fixUpperEdge=function(t,i,r){yi(i.fixUpperEdge),t.mesh.delete(i.eUp),i.fixUpperEdge=!1,i.eUp=r,r.activeRegion=i},e.topLeftRegion=function(t,i){var r=i.eUp.Org,n;do i=e.regionAbove(i);while(i.eUp.Org===r);if(i.fixUpperEdge){if(n=t.mesh.connect(e.regionBelow(i).eUp.Sym,i.eUp.Lnext),n===null)return null;e.fixUpperEdge(t,i,n),i=e.regionAbove(i)}return i},e.topRightRegion=function(t){var i=t.eUp.Dst;do t=e.regionAbove(t);while(t.eUp.Dst===i);return t},e.addRegionBelow=function(t,i,r){var n=new hD;return n.eUp=r,n.nodeUp=t.dict.insertBefore(i.nodeUp,n),n.fixUpperEdge=!1,n.sentinel=!1,n.dirty=!1,r.activeRegion=n,n},e.isWindingInside=function(t,i){switch(t.windingRule){case Sr.ODD:return(i&1)!==0;case Sr.NONZERO:return i!==0;case Sr.POSITIVE:return i>0;case Sr.NEGATIVE:return i<0;case Sr.ABS_GEQ_TWO:return i>=2||i<=-2}throw new Error("Invalid winding rulle")},e.computeWinding=function(t,i){i.windingNumber=e.regionAbove(i).windingNumber+i.eUp.winding,i.inside=e.isWindingInside(t,i.windingNumber)},e.finishRegion=function(t,i){var r=i.eUp,n=r.Lface;n.inside=i.inside,n.anEdge=r,e.deleteRegion(t,i)},e.finishLeftRegions=function(t,i,r){for(var n,s=null,a=i,o=i.eUp;a!==r;){if(a.fixUpperEdge=!1,s=e.regionBelow(a),n=s.eUp,n.Org!=o.Org){if(!s.fixUpperEdge){e.finishRegion(t,a);break}n=t.mesh.connect(o.Lprev,n.Sym),e.fixUpperEdge(t,s,n)}o.Onext!==n&&(t.mesh.splice(n.Oprev,n),t.mesh.splice(o,n)),e.finishRegion(t,a),o=s.eUp,a=s}return o},e.addRightEdges=function(t,i,r,n,s,a){var o,l,u,c,h=!0;u=r;do yi(ai.vertLeq(u.Org,u.Dst)),e.addRegionBelow(t,i,u.Sym),u=u.Onext;while(u!==n);for(s===null&&(s=e.regionBelow(i).eUp.Rprev),l=i,c=s;o=e.regionBelow(l),u=o.eUp.Sym,u.Org===c.Org;)u.Onext!==c&&(t.mesh.splice(u.Oprev,u),t.mesh.splice(c.Oprev,u)),o.windingNumber=l.windingNumber-u.winding,o.inside=e.isWindingInside(t,o.windingNumber),l.dirty=!0,!h&&e.checkForRightSplice(t,l)&&(e.addWinding(u,c),e.deleteRegion(t,l),t.mesh.delete(c)),h=!1,l=o,c=u;l.dirty=!0,yi(l.windingNumber-u.winding===o.windingNumber),a&&e.walkDirtyRegions(t,l)},e.spliceMergeVertices=function(t,i,r){t.mesh.splice(i,r)},e.vertexWeights=function(t,i,r){var n=ai.vertL1dist(i,t),s=ai.vertL1dist(r,t),a=.5*s/(n+s),o=.5*n/(n+s);t.coords[0]+=a*i.coords[0]+o*r.coords[0],t.coords[1]+=a*i.coords[1]+o*r.coords[1],t.coords[2]+=a*i.coords[2]+o*r.coords[2]},e.getIntersectData=function(t,i,r,n,s,a){i.coords[0]=i.coords[1]=i.coords[2]=0,i.idx=-1,e.vertexWeights(i,r,n),e.vertexWeights(i,s,a)},e.checkForRightSplice=function(t,i){var r=e.regionBelow(i),n=i.eUp,s=r.eUp;if(ai.vertLeq(n.Org,s.Org)){if(ai.edgeSign(s.Dst,n.Org,s.Org)>0)return!1;ai.vertEq(n.Org,s.Org)?n.Org!==s.Org&&(t.pq.delete(n.Org.pqHandle),e.spliceMergeVertices(t,s.Oprev,n)):(t.mesh.splitEdge(s.Sym),t.mesh.splice(n,s.Oprev),i.dirty=r.dirty=!0)}else{if(ai.edgeSign(n.Dst,s.Org,n.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(n.Sym),t.mesh.splice(s.Oprev,n)}return!0},e.checkForLeftSplice=function(t,i){var r=e.regionBelow(i),n=i.eUp,s=r.eUp,a;if(yi(!ai.vertEq(n.Dst,s.Dst)),ai.vertLeq(n.Dst,s.Dst)){if(ai.edgeSign(n.Dst,s.Dst,n.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,a=t.mesh.splitEdge(n),t.mesh.splice(s.Sym,a),a.Lface.inside=i.inside}else{if(ai.edgeSign(s.Dst,n.Dst,s.Org)>0)return!1;i.dirty=r.dirty=!0,a=t.mesh.splitEdge(s),t.mesh.splice(n.Lnext,s.Sym),a.Rface.inside=i.inside}return!0},e.checkForIntersect=function(t,i){var r=e.regionBelow(i),n=i.eUp,s=r.eUp,a=n.Org,o=s.Org,l=n.Dst,u=s.Dst,c,h,d=new vy,p,m;if(yi(!ai.vertEq(u,l)),yi(ai.edgeSign(l,t.event,a)<=0),yi(ai.edgeSign(u,t.event,o)>=0),yi(a!==t.event&&o!==t.event),yi(!i.fixUpperEdge&&!r.fixUpperEdge),a===o||(c=Math.min(a.t,l.t),h=Math.max(o.t,u.t),c>h))return!1;if(ai.vertLeq(a,o)){if(ai.edgeSign(u,a,o)>0)return!1}else if(ai.edgeSign(l,o,a)<0)return!1;return e.debugEvent(t),ai.intersect(l,a,u,o,d),yi(Math.min(a.t,l.t)<=d.t),yi(d.t<=Math.max(o.t,u.t)),yi(Math.min(u.s,l.s)<=d.s),yi(d.s<=Math.max(o.s,a.s)),ai.vertLeq(d,t.event)&&(d.s=t.event.s,d.t=t.event.t),p=ai.vertLeq(a,o)?a:o,ai.vertLeq(p,d)&&(d.s=p.s,d.t=p.t),ai.vertEq(d,a)||ai.vertEq(d,o)?(e.checkForRightSplice(t,i),!1):!ai.vertEq(l,t.event)&&ai.edgeSign(l,t.event,d)>=0||!ai.vertEq(u,t.event)&&ai.edgeSign(u,t.event,d)<=0?u===t.event?(t.mesh.splitEdge(n.Sym),t.mesh.splice(s.Sym,n),i=e.topLeftRegion(t,i),n=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),r),e.addRightEdges(t,i,n.Oprev,n,n,!0),!0):l===t.event?(t.mesh.splitEdge(s.Sym),t.mesh.splice(n.Lnext,s.Oprev),r=i,i=e.topRightRegion(i),m=e.regionBelow(i).eUp.Rprev,r.eUp=s.Oprev,s=e.finishLeftRegions(t,r,null),e.addRightEdges(t,i,s.Onext,n.Rprev,m,!0),!0):(ai.edgeSign(l,t.event,d)>=0&&(e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(n.Sym),n.Org.s=t.event.s,n.Org.t=t.event.t),ai.edgeSign(u,t.event,d)<=0&&(i.dirty=r.dirty=!0,t.mesh.splitEdge(s.Sym),s.Org.s=t.event.s,s.Org.t=t.event.t),!1):(t.mesh.splitEdge(n.Sym),t.mesh.splitEdge(s.Sym),t.mesh.splice(s.Oprev,n),n.Org.s=d.s,n.Org.t=d.t,n.Org.pqHandle=t.pq.insert(n.Org),e.getIntersectData(t,n.Org,a,l,o,u),e.regionAbove(i).dirty=i.dirty=r.dirty=!0,!1)},e.walkDirtyRegions=function(t,i){for(var r=e.regionBelow(i),n,s;;){for(;r.dirty;)i=r,r=e.regionBelow(r);if(!i.dirty&&(r=i,i=e.regionAbove(i),i===null||!i.dirty))return;if(i.dirty=!1,n=i.eUp,s=r.eUp,n.Dst!==s.Dst&&e.checkForLeftSplice(t,i)&&(r.fixUpperEdge?(e.deleteRegion(t,r),t.mesh.delete(s),r=e.regionBelow(i),s=r.eUp):i.fixUpperEdge&&(e.deleteRegion(t,i),t.mesh.delete(n),i=e.regionAbove(r),n=i.eUp)),n.Org!==s.Org)if(n.Dst!==s.Dst&&!i.fixUpperEdge&&!r.fixUpperEdge&&(n.Dst===t.event||s.Dst===t.event)){if(e.checkForIntersect(t,i))return}else e.checkForRightSplice(t,i);n.Org===s.Org&&n.Dst===s.Dst&&(e.addWinding(s,n),e.deleteRegion(t,i),t.mesh.delete(n),i=e.regionAbove(r))}},e.connectRightVertex=function(t,i,r){var n,s=r.Onext,a=e.regionBelow(i),o=i.eUp,l=a.eUp,u=!1;if(o.Dst!==l.Dst&&e.checkForIntersect(t,i),ai.vertEq(o.Org,t.event)&&(t.mesh.splice(s.Oprev,o),i=e.topLeftRegion(t,i),s=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),a),u=!0),ai.vertEq(l.Org,t.event)&&(t.mesh.splice(r,l.Oprev),r=e.finishLeftRegions(t,a,null),u=!0),u){e.addRightEdges(t,i,r.Onext,s,s,!0);return}ai.vertLeq(l.Org,o.Org)?n=l.Oprev:n=o,n=t.mesh.connect(r.Lprev,n),e.addRightEdges(t,i,n,n.Onext,n.Onext,!1),n.Sym.activeRegion.fixUpperEdge=!0,e.walkDirtyRegions(t,i)},e.connectLeftDegenerate=function(t,i,r){var n,s,a,o,l;if(n=i.eUp,ai.vertEq(n.Org,r)){yi(!1),e.spliceMergeVertices(t,n,r.anEdge);return}if(!ai.vertEq(n.Dst,r)){t.mesh.splitEdge(n.Sym),i.fixUpperEdge&&(t.mesh.delete(n.Onext),i.fixUpperEdge=!1),t.mesh.splice(r.anEdge,n),e.sweepEvent(t,r);return}yi(!1),i=e.topRightRegion(i),l=e.regionBelow(i),a=l.eUp.Sym,s=o=a.Onext,l.fixUpperEdge&&(yi(s!==a),e.deleteRegion(t,l),t.mesh.delete(a),a=s.Oprev),t.mesh.splice(r.anEdge,a),ai.edgeGoesLeft(s)||(s=null),e.addRightEdges(t,i,a.Onext,o,s,!0)},e.connectLeftVertex=function(t,i){var r,n,s,a,o,l,u=new hD;if(u.eUp=i.anEdge.Sym,r=t.dict.search(u).key,n=e.regionBelow(r),!!n){if(a=r.eUp,o=n.eUp,ai.edgeSign(a.Dst,i,a.Org)===0){e.connectLeftDegenerate(t,r,i);return}if(s=ai.vertLeq(o.Dst,a.Dst)?r:n,r.inside||s.fixUpperEdge){if(s===r)l=t.mesh.connect(i.anEdge.Sym,a.Lnext);else{var c=t.mesh.connect(o.Dnext,i.anEdge);l=c.Sym}s.fixUpperEdge?e.fixUpperEdge(t,s,l):e.computeWinding(t,e.addRegionBelow(t,r,l)),e.sweepEvent(t,i)}else e.addRightEdges(t,r,i.anEdge,i.anEdge,null,!0)}},e.sweepEvent=function(t,i){t.event=i,e.debugEvent(t);for(var r=i.anEdge;r.activeRegion===null;)if(r=r.Onext,r===i.anEdge){e.connectLeftVertex(t,i);return}var n=e.topLeftRegion(t,r.activeRegion);yi(n!==null);var s=e.regionBelow(n),a=s.eUp,o=e.finishLeftRegions(t,s,null);o.Onext===a?e.connectRightVertex(t,n,o):e.addRightEdges(t,n,o.Onext,a,a,!0)},e.addSentinel=function(t,i,r,n){var s=new hD,a=t.mesh.makeEdge();a.Org.s=r,a.Org.t=n,a.Dst.s=i,a.Dst.t=n,t.event=a.Dst,s.eUp=a,s.windingNumber=0,s.inside=!1,s.fixUpperEdge=!1,s.sentinel=!0,s.dirty=!1,s.nodeUp=t.dict.insert(s)},e.initEdgeDict=function(t){t.dict=new FTe(t,e.edgeLeq);var i=t.bmax[0]-t.bmin[0],r=t.bmax[1]-t.bmin[1],n=t.bmin[0]-i,s=t.bmax[0]+i,a=t.bmin[1]-r,o=t.bmax[1]+r;e.addSentinel(t,n,s,a),e.addSentinel(t,n,s,o)},e.doneEdgeDict=function(t){for(var i,r=0;(i=t.dict.min().key)!==null;)i.sentinel||(yi(i.fixUpperEdge),yi(++r===1)),yi(i.windingNumber===0),e.deleteRegion(t,i)},e.removeDegenerateEdges=function(t){var i,r,n,s=t.mesh.eHead;for(i=s.next;i!==s;i=r)r=i.next,n=i.Lnext,ai.vertEq(i.Org,i.Dst)&&i.Lnext.Lnext!==i&&(e.spliceMergeVertices(t,n,i),t.mesh.delete(i),i=n,n=i.Lnext),n.Lnext===i&&(n!==i&&((n===r||n===r.Sym)&&(r=r.next),t.mesh.delete(n)),(i===r||i===r.Sym)&&(r=r.next),t.mesh.delete(i))},e.initPriorityQ=function(t){var i,r,n,s=0;for(n=t.mesh.vHead,r=n.next;r!==n;r=r.next)s++;for(s+=8,i=t.pq=new NTe(s,ai.vertLeq),n=t.mesh.vHead,r=n.next;r!==n;r=r.next)r.pqHandle=i.insert(r);return r!==n?!1:(i.init(),!0)},e.donePriorityQ=function(t){t.pq=null},e.removeDegenerateFaces=function(t,i){var r,n,s;for(r=i.fHead.next;r!==i.fHead;r=n)n=r.next,s=r.anEdge,yi(s.Lnext!==s),s.Lnext.Lnext===s&&(e.addWinding(s.Onext,s),t.mesh.delete(s));return!0},e.computeInterior=function(t,i){i===void 0&&(i=!0);var r,n;if(e.removeDegenerateEdges(t),!e.initPriorityQ(t))return!1;for(e.initEdgeDict(t);(r=t.pq.extractMin())!==null;){for(;n=t.pq.min(),!(n===null||!ai.vertEq(n,r));)n=t.pq.extractMin(),e.spliceMergeVertices(t,r.anEdge,n.anEdge);e.sweepEvent(t,r)}return t.event=t.dict.min().key.eUp.Org,e.debugEvent(t),e.doneEdgeDict(t),e.donePriorityQ(t),e.removeDegenerateFaces(t,t.mesh)?(i&&t.mesh.check(),!0):!1},e})(),VTe=(function(){function e(){this.mesh=new uj,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=Sr.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return e.prototype.dot_=function(t,i){return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]},e.prototype.normalize_=function(t){var i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(!i)throw"Zero-size vector!";i=Math.sqrt(i),t[0]/=i,t[1]/=i,t[2]/=i},e.prototype.longAxis_=function(t){var i=0;return Math.abs(t[1])>Math.abs(t[0])&&(i=1),Math.abs(t[2])>Math.abs(t[i])&&(i=2),i},e.prototype.computeNormal_=function(t){var i,r,n,s,a,o,l=[0,0,0],u=[0,0,0],c=[0,0,0],h=[0,0,0],d=[0,0,0],p=[null,null,null],m=[null,null,null],v=this.mesh.vHead;i=v.next;for(var g=0;g<3;++g)s=i.coords[g],u[g]=s,m[g]=i,l[g]=s,p[g]=i;for(i=v.next;i!==v;i=i.next)for(var w=0;w<3;++w)s=i.coords[w],s<u[w]&&(u[w]=s,m[w]=i),s>l[w]&&(l[w]=s,p[w]=i);var S=0;if(l[1]-u[1]>l[0]-u[0]&&(S=1),l[2]-u[2]>l[S]-u[S]&&(S=2),u[S]>=l[S]){t[0]=0,t[1]=0,t[2]=1;return}for(o=0,r=m[S],n=p[S],c[0]=r.coords[0]-n.coords[0],c[1]=r.coords[1]-n.coords[1],c[2]=r.coords[2]-n.coords[2],i=v.next;i!==v;i=i.next)h[0]=i.coords[0]-n.coords[0],h[1]=i.coords[1]-n.coords[1],h[2]=i.coords[2]-n.coords[2],d[0]=c[1]*h[2]-c[2]*h[1],d[1]=c[2]*h[0]-c[0]*h[2],d[2]=c[0]*h[1]-c[1]*h[0],a=d[0]*d[0]+d[1]*d[1]+d[2]*d[2],a>o&&(o=a,t[0]=d[0],t[1]=d[1],t[2]=d[2]);o<=0&&(t[0]=t[1]=t[2]=0,t[this.longAxis_(c)]=1)},e.prototype.checkOrientation_=function(){for(var t=this.mesh.fHead,i,r=this.mesh.vHead,n,s=0,a=t.next;a!==t;a=a.next)if(n=a.anEdge,!(n.winding<=0))do s+=(n.Org.s-n.Dst.s)*(n.Org.t+n.Dst.t),n=n.Lnext;while(n!==a.anEdge);if(s<0){for(i=r.next;i!==r;i=i.next)i.t=-i.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},e.prototype.projectPolygon_=function(){var t=this.mesh.vHead,i=[0,0,0],r,n,s=!1;i[0]=this.normal[0],i[1]=this.normal[1],i[2]=this.normal[2],!i[0]&&!i[1]&&!i[2]&&(this.computeNormal_(i),s=!0),r=this.sUnit,n=this.tUnit;var a=this.longAxis_(i);r[a]=0,r[(a+1)%3]=1,r[(a+2)%3]=0,n[a]=0,n[(a+1)%3]=0,n[(a+2)%3]=i[a]>0?1:-1;for(var o=t.next;o!==t;o=o.next)o.s=this.dot_(o.coords,r),o.t=this.dot_(o.coords,n);s&&this.checkOrientation_();for(var l=!0,u=t.next;u!==t;u=u.next)l?(this.bmin[0]=this.bmax[0]=u.s,this.bmin[1]=this.bmax[1]=u.t,l=!1):(u.s<this.bmin[0]&&(this.bmin[0]=u.s),u.s>this.bmax[0]&&(this.bmax[0]=u.s),u.t<this.bmin[1]&&(this.bmin[1]=u.t),u.t>this.bmax[1]&&(this.bmax[1]=u.t))},e.prototype.addWinding_=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.prototype.tessellateMonoRegion_=function(t,i){var r,n;if(r=i.anEdge,!(r.Lnext!==r&&r.Lnext.Lnext!==r))throw"Mono region invalid";for(;ai.vertLeq(r.Dst,r.Org);r=r.Lprev);for(;ai.vertLeq(r.Org,r.Dst);r=r.Lnext);n=r.Lprev;for(var s=void 0;r.Lnext!==n;)if(ai.vertLeq(r.Dst,n.Org)){for(;n.Lnext!==r&&(ai.edgeGoesLeft(n.Lnext)||ai.edgeSign(n.Org,n.Dst,n.Lnext.Dst)<=0);)s=t.connect(n.Lnext,n),n=s.Sym;n=n.Lprev}else{for(;n.Lnext!==r&&(ai.edgeGoesRight(r.Lprev)||ai.edgeSign(r.Dst,r.Org,r.Lprev.Org)>=0);)s=t.connect(r,r.Lprev),r=s.Sym;r=r.Lnext}if(n.Lnext===r)throw"Mono region invalid";for(;n.Lnext.Lnext!==r;)s=t.connect(n.Lnext,n),n=s.Sym;return!0},e.prototype.tessellateInterior_=function(t){for(var i,r=t.fHead.next;r!==t.fHead;r=i)if(i=r.next,r.inside&&!this.tessellateMonoRegion_(t,r))return!1;return!0},e.prototype.discardExterior_=function(t){for(var i,r=t.fHead.next;r!==t.fHead;r=i)i=r.next,r.inside||t.zapFace(r)},e.prototype.setWindingNumber_=function(t,i,r){for(var n,s=t.eHead.next;s!==t.eHead;s=n)n=s.next,s.Rface.inside!==s.Lface.inside?s.winding=s.Lface.inside?i:-i:r?t.delete(s):s.winding=0},e.prototype.getNeighbourFace_=function(t){return!t.Rface||!t.Rface.inside?-1:t.Rface.n},e.prototype.outputPolymesh_=function(t,i,r,n){var s,a=0,o=0,l;r>3&&t.mergeConvexFaces(r);for(var u=t.vHead.next;u!==t.vHead;u=u.next)u.n=-1;for(var c=t.fHead.next;c!==t.fHead;c=c.next)if(c.n=-1,!!c.inside){s=c.anEdge,l=0;do{var u=s.Org;u.n===-1&&(u.n=o,o++),l++,s=s.Lnext}while(s!==c.anEdge);if(l>r)throw"Face vertex greater that support polygon";c.n=a,++a}this.elementCount=a,i===is.CONNECTED_POLYGONS&&(a*=2),this.elements=[],this.elements.length=a*r,this.vertexCount=o,this.vertices=[],this.vertices.length=o*n,this.vertexIndices=[],this.vertexIndices.length=o;for(var u=t.vHead.next;u!==t.vHead;u=u.next)if(u.n!==-1){var h=u.n*n;this.vertices[h+0]=u.coords[0],this.vertices[h+1]=u.coords[1],n>2&&(this.vertices[h+2]=u.coords[2]),this.vertexIndices[u.n]=u.idx}for(var d=0,c=t.fHead.next;c!==t.fHead;c=c.next)if(c.inside){s=c.anEdge,l=0;do{var u=s.Org;this.elements[d++]=u.n,l++,s=s.Lnext}while(s!==c.anEdge);for(var p=l;p<r;++p)this.elements[d++]=-1;if(i===is.CONNECTED_POLYGONS){s=c.anEdge;do this.elements[d++]=this.getNeighbourFace_(s),s=s.Lnext;while(s!==c.anEdge);for(var m=l;m<r;++m)this.elements[d++]=-1}}},e.prototype.outputContours_=function(t,i){var r,n,s=0,a=0;this.vertexCount=0,this.elementCount=0;for(var o=t.fHead.next;o!==t.fHead;o=o.next)if(o.inside){n=r=o.anEdge;do this.vertexCount++,r=r.Lnext;while(r!==n);this.elementCount++}this.elements=[],this.elements.length=this.elementCount*2,this.vertices=[],this.vertices.length=this.vertexCount*i,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var l=0,u=0,c=0;s=0;for(var o=t.fHead.next;o!==t.fHead;o=o.next)if(o.inside){a=0,n=r=o.anEdge;do this.vertices[l++]=r.Org.coords[0],this.vertices[l++]=r.Org.coords[1],i>2&&(this.vertices[l++]=r.Org.coords[2]),this.vertexIndices[u++]=this.vertexIdCallback?this.vertexIdCallback(r):r.Org.idx,a++,r=r.Lnext;while(r!==n);this.elements[c++]=s,this.elements[c++]=a,s+=a}},e.prototype.addContour=function(t,i){this.mesh===null&&(this.mesh=new uj),t<2&&(t=2),t>3&&(t=3);for(var r=null,n=0;n<i.length;n+=t)r===null?(r=this.mesh.makeEdge(),this.mesh.splice(r,r.Sym)):(this.mesh.splitEdge(r),r=r.Lnext),r.Org.coords[0]=i[n+0],r.Org.coords[1]=i[n+1],t>2?r.Org.coords[2]=i[n+2]:r.Org.coords[2]=0,r.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(r),r.winding=1,r.Sym.winding=-1},e.prototype.tesselate=function(t,i,r,n,s,a){if(t===void 0&&(t=Sr.ODD),i===void 0&&(i=is.POLYGONS),a===void 0&&(a=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,s&&(this.normal[0]=s[0],this.normal[1]=s[1],this.normal[2]=s[2]),this.windingRule=t,n<2&&(n=2),n>3&&(n=3),!this.mesh)return!1;this.projectPolygon_(),UTe.computeInterior(this,a);var o=this.mesh;return i===is.BOUNDARY_CONTOURS?this.setWindingNumber_(o,1,!0):this.tessellateInterior_(o),a&&o.check(),i===is.BOUNDARY_CONTOURS?this.outputContours_(o,n):this.outputPolymesh_(o,i,r,n),!0},e})();function mp(e){var t=e.windingRule,i=t===void 0?Sr.ODD:t,r=e.elementType,n=r===void 0?is.POLYGONS:r,s=e.polySize,a=s===void 0?3:s,o=e.vertexSize,l=o===void 0?2:o,u=e.normal,c=u===void 0?[0,0,1]:u,h=e.contours,d=h===void 0?[]:h,p=e.strict,m=p===void 0?!0:p,v=e.debug,g=v===void 0?!1:v;if(!d&&m)throw new Error("Contours can't be empty");if(d){var w=new VTe;e.edgeCreateCallback&&(w.edgeCreateCallback=e.edgeCreateCallback),e.vertexIdCallback&&(w.vertexIdCallback=e.vertexIdCallback);for(var S=0;S<d.length;S++)w.addContour(l||2,d[S]);return w.tesselate(i,n,a,l,c,m),{vertices:w.vertices,vertexIndices:w.vertexIndices,vertexCount:w.vertexCount,elements:w.elements,elementCount:w.elementCount,mesh:g?w.mesh:void 0}}}Sr.ODD;Sr.NONZERO;Sr.POSITIVE;Sr.NEGATIVE;Sr.ABS_GEQ_TWO;is.POLYGONS;is.CONNECTED_POLYGONS;is.BOUNDARY_CONTOURS;var GL=class{constructor(e=256,t=!1){this.capacity=e,this.size=0,this.debug=t,this.debug&&console.log(`allocating with cap ${e}`);let i=e*GL.eSize;this.buffer=new ArrayBuffer(i);let r=Float32Array.BYTES_PER_ELEMENT,n=0;this.positions=new Float32Array(this.buffer,n*r,3*e),n+=3*e,this.normals=new Float32Array(this.buffer,n*r,3*e),n+=3*e,this.uvs=new Float32Array(this.buffer,n*r,2*e)}realloc(e,t=!1){if(e<this.size)throw Error("cannot shrink buffer");if(e<=this.capacity&&!t)return;this.debug&&console.log(`resizing from ${this.capacity}  ${e}`);let i=e*GL.eSize,r=new ArrayBuffer(i),n=Float32Array.BYTES_PER_ELEMENT,s=0,a=new Float32Array(r,s*n,3*e);s+=3*e;let o=new Float32Array(r,s*n,3*e);s+=3*e;let l=new Float32Array(r,s*n,2*e);t?(a.set(this.positions.subarray(0,this.size*3)),o.set(this.normals.subarray(0,this.size*3)),l.set(this.uvs.subarray(0,this.size*2))):(a.set(this.positions),o.set(this.normals),l.set(this.uvs)),this.buffer=r,this.positions=a,this.normals=o,this.uvs=l,this.capacity=e}get(e=1){let t=this.size+e;if(t>this.capacity){let r=this.capacity;for(;t>r;)r*=2;this.realloc(r)}let i=this.size;return this.size=t,i}reserve(e){let t=this.size+e;t>this.capacity&&this.realloc(t)}shrink(){this.debug&&console.log(`shrinking ${this.capacity}  ${this.size}`),this.realloc(this.size,!0)}},UY=GL;UY.eSize=8*Float32Array.BYTES_PER_ELEMENT;var jTe=class{constructor(e=[],t=(i,r)=>i<r?-1:i>r?1:0){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;let e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:t,compare:i}=this,r=t[e];for(;e>0;){let n=e-1>>1,s=t[n];if(i(r,s)>=0)break;t[e]=s,e=n}t[e]=r}_down(e){let{data:t,compare:i}=this,r=this.length>>1,n=t[e];for(;e<r;){let s=(e<<1)+1,a=s+1;if(a<this.length&&i(t[a],t[s])<0&&(s=a),i(t[s],n)>=0)break;t[e]=t[s],e=s}t[e]=n}};function HTe(e,t,i=1,r=!1){let n=1/0,s=1/0,a=-1/0,o=-1/0;for(let[S,_]of e[0])S<n&&(n=S),_<s&&(s=_),S>a&&(a=S),_>o&&(o=_);let l=a-n,u=o-s,c=Math.max(i,Math.min(l,u));if(c===i){let S=[n,s];return S.distance=0,S.distance}let h=new jTe([],(S,_)=>_.max-S.max),d=GTe(e),p=new $2(n+l/2,s+u/2,0,e);p.d>d.d&&(d=p);let m=2;function v(S,_,A){let C=new $2(S,_,A,e);if(m++,C.max>d.d+i&&h.push(C),C.d>d.d&&(d=C,r&&console.log(`found best ${Math.round(1e4*C.d)/1e4} after ${m} probes`),d.d>t))return t}let g=c/2;for(let S=n;S<a;S+=c)for(let _=s;_<o;_+=c)v(S+g,_+g,g);for(;h.length;){let{max:S,x:_,y:A,h:C}=h.pop();if(S-d.d<=i)break;g=C/2,v(_-g,A-g,g),v(_+g,A-g,g),v(_-g,A+g,g),v(_+g,A+g,g)}r&&console.log(`num probes: ${m}
best distance: ${d.d}`);let w=[d.x,d.y];return w.distance=d.d,w.distance}function $2(e,t,i,r){this.x=e,this.y=t,this.h=i,this.d=WTe(e,t,r),this.max=this.d+this.h*Math.SQRT2}function WTe(e,t,i){let r=!1,n=1/0;for(let s of i)for(let a=0,o=s.length,l=o-1;a<o;l=a++){let u=s[a],c=s[l];u[1]>t!=c[1]>t&&e<(c[0]-u[0])*(t-u[1])/(c[1]-u[1])+u[0]&&(r=!r),n=Math.min(n,qTe(e,t,u,c))}return n===0?0:(r?1:-1)*Math.sqrt(n)}function GTe(e){let t=0,i=0,r=0,n=e[0];for(let a=0,o=n.length,l=o-1;a<o;l=a++){let u=n[a],c=n[l],h=u[0]*c[1]-c[0]*u[1];i+=(u[0]+c[0])*h,r+=(u[1]+c[1])*h,t+=h*3}let s=new $2(i/t,r/t,0,e);return t===0||s.d<0?new $2(n[0][0],n[0][1],0,e):s}function qTe(e,t,i,r){let n=i[0],s=i[1],a=r[0]-n,o=r[1]-s;if(a!==0||o!==0){let l=((e-n)*a+(t-s)*o)/(a*a+o*o);l>1?(n=r[0],s=r[1]):l>0&&(n+=a*l,s+=o*l)}return a=e-n,o=t-s,a*a+o*o}var sB={vertices:[160,160,-160,160,-160,-160,160,-160],vertexIndices:[1,0,3,2],vertexCount:4,elements:[0,4],elementCount:1,mesh:void 0},VY={vertices:[],vertexIndices:[],vertexCount:0,elements:[],elementCount:0,mesh:void 0},jY={vertices:[-160,160,160,-160,160,160,-160,-160],vertexIndices:[1,3,0,2],vertexCount:4,elements:[0,1,2,1,0,3],elementCount:2,mesh:void 0},dD=(e,t)=>([i,r])=>(r<i&&(r+=t),(e>=i?e:e+t)<=r),aB=class extends Kt{constructor(e,t,i=0,r=12,n=3,s=Sr.ODD,a=!1){super(),this.forPathBevel=a,this.type="ShapeGeometry",this.vertexCache={},this._shape=e,this._depth=t,this._curveSegments=r,this._bevelSegmentsInput=n;let o=this._shape.extractShapePointsToFlatArray([],r),l=this._shape.shapeHoles.map(D=>{let L=D.extractShapePointsToFlatArray([],r),z=[];for(let G=L.length-1;G>=1;G-=2){let V=L[G-1],j=L[G-0];z.push(V,j)}return z}),u=[],c=[];for(let D=0;D<o.length;D+=2)c.push([o[D],o[D+1]]);u.push(c);for(let D=0;D<l.length;D++){let L=l[D],z=[];for(let G=0;G<L.length;G+=2)z.push([L[G],L[G+1]]);u.push(z)}let h;e.isText?h=new lk().setFromPoints(e.points.map(D=>D.position)).getSize(new Pe).length()*.1:u[0].length===0?h=i:i>0?h=HTe(u,i):h=1e-5,i<=0?(this._bevel=0,this._bevelSegments=0):(this._bevel=Math.min(i,h,t/2),this._bevelSegments=Math.floor(n));let d;try{d=mp({windingRule:s,elementType:is.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[o]})}catch{d=sB}let p;try{p=mp({windingRule:Sr.ODD,elementType:is.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...l]})}catch{p=VY}if(!d)throw new Error("error generating geometry");let m=d.elementCount;if(p){d.elementCount+=p.elementCount;for(let D=0;D<p.elements.length;D++){let L=p.elements[D],z=D%2===0?d.vertexCount:0;d.elements.push(L+z)}for(let D=0;D<p.vertexIndices.length;D++){let L=p.vertexIndices[D],z=d.vertexCount;d.vertexIndices.push(L+z)}for(let D=0;D<p.vertices.length;D++){let L=p.vertices[D];d.vertices.push(L)}}let v=1/0,g=-1/0,w=1/0,S=-1/0;for(let D=0,L=d.vertexCount;D<L;D++){let z=D*2,G=d.vertices[z+0],V=d.vertices[z+1];G<v&&(v=G),G>g&&(g=G),V<w&&(w=V),V>S&&(S=V)}this._minX=v,this._minY=w,this._width=g-v,this._height=S-w,this._buffer=new UY(this._computeBufferEstimatedSize(d));let _=[],A=[];for(let D=d.elementCount-1;D>=0;D--){let L=D>=m,z=D*2,G=d.elements[z+0],V=d.elements[z+1],j=G+V,J={start:G,count:V,normals:[],continuous:[],concave:[]},ne=G,K=j-1,B=G+1,Z=this._shape.roundedCurves.length;do{let oe=ne-G,re=d.vertices[K*2+0],ue=d.vertices[K*2+1],me=d.vertices[ne*2+0],he=d.vertices[ne*2+1],Ce=d.vertices[B*2+0],Ae=d.vertices[B*2+1],Ie=me-re,Me=he-ue,De=Math.sqrt(Ie*Ie+Me*Me);Ie/=De,Me/=De;let Ve=me-Ce,Ge=he-Ae,Qe=Math.sqrt(Ve*Ve+Ge*Ge);Ve/=Qe,Ge/=Qe,J.normals[oe*2+0]=-Ge,J.normals[oe*2+1]=Ve,J.concave[oe]=Ie*Ge-Me*Ve>0;let ot=d.vertexIndices[ne];if(Array.isArray(ot))J.continuous[oe]=!1;else{let[$e,Ke]=this._shape.getCurveIndexFromVertexId(ot-1,!0);if(Ke>0&&Ke<1)J.continuous[oe]=!0;else{let bt=Ke===1?$e+1:$e-1;bt=(bt+Z)%Z;let xt=Ke===1?0:1,q=this._shape.roundedCurves[$e].getTangent(Ke),N=this._shape.roundedCurves[bt].getTangent(xt);J.continuous[oe]=q.dot(N)>.95}}L&&(J.normals[oe*2+0]*=-1,J.normals[oe*2+1]*=-1),[K,ne,B]=[ne,B,B+1],B>=j&&(B-=V)}while(B!==G+1);let F=[];F.push({bevelI:0,angle:0,size:0,boundary:{vertices:d.vertices.slice(G*2,j*2),vertexCount:V,vertexIndices:new Array(V).fill(!0).map((oe,re)=>[re,re]),elements:[0,V],elementCount:1,mesh:null},reverseMap:[],insetPoints:d.vertices.slice(G*2,j*2)});let X=0;for(let oe=1;oe<=this._bevelSegments;oe++){let re=oe/this._bevelSegments*Math.PI/2,ue=(1-Math.cos(re))*this._bevel,me=[],he=[],Ce=0;for(let Ie=0;Ie<V;Ie++){let Me=Ie*2,De=(Ie-1+V)%V*2,Ve=d.vertices[J.start*2+Me+0],Ge=d.vertices[J.start*2+Me+1],Qe=-J.normals[De+0]*ue,ot=-J.normals[De+1]*ue,$e=-J.normals[Me+0]*ue,Ke=-J.normals[Me+1]*ue;if(J.concave[Ie]||!J.concave[Ie]&&L){let bt=Math.atan2(ot,Qe),xt=Math.atan2(Ke,$e);xt>bt&&(xt-=Math.PI*2);let q=xt-bt;if(J.continuous[Ie]||L){let N=bt+q/2,de=Math.cos(N)*ue,ze=Math.sin(N)*ue;me[2*Ce+0]=Ve+de*(L?-1:1),me[2*Ce+1]=Ge+ze*(L?-1:1),he[Ce]=Ie,Ce++}else{let N=Math.max(1,Math.floor(r/4*Math.abs(q)/Math.PI));for(let de=0;de<=N;de++){let ze=bt+q*(de/N),$=Math.cos(ze)*ue,Ue=Math.sin(ze)*ue;me[2*Ce+0]=Ve+$,me[2*Ce+1]=Ge+Ue,he[Ce]=Ie,Ce++}}}else me[2*Ce+0]=Ve+Qe,me[2*Ce+1]=Ge+ot,he[Ce]=Ie,Ce++,me[2*Ce+0]=Ve,me[2*Ce+1]=Ge,he[Ce]=Ie,Ce++,me[2*Ce+0]=Ve+$e,me[2*Ce+1]=Ge+Ke,he[Ce]=Ie,Ce++}let Ae=mp({windingRule:Sr.POSITIVE,elementType:is.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[me],edgeCreateCallback:Ie=>{let Me=Ie.Org.idx,De=he[Me],Ve=he[(Me+1)%he.length];Ie.idx=[De,Ve],Ie.Sym.idx=[Ve,De]},vertexIdCallback:Ie=>{let Me=Ie.Lprev.idx;return[Me?Me[1]:0,Ie.idx?Ie.idx[0]:0]}});if(!Ae)throw console.log("Error"),new Error(`error generating bevel geometry for ${oe}'th loop`);if(!Ae.vertexCount){let Ie=(oe-1)/this._bevelSegments*Math.PI/2;X=(1-Math.sin(Ie))*this._bevel;break}for(let Ie=0;Ie<Ae.vertexIndices.length;Ie++){let[Me,De]=Ae.vertexIndices[Ie];if(Me===De)continue;let Ve=De;De<Me&&(Ve+=V);for(let Ge=Me;Ge<Ve;Ge++){let Qe=Ge%V,ot=(Ge+1)%V;if(!J.continuous[Qe]||!J.continuous[ot]){Ae.vertexIndices[Ie]=[Me,Qe],Ae.vertexIndices.splice(Ie+1,0,[ot,De]),Ae.vertices.splice((Ie+1)*2,0,Ae.vertices[Ie*2],Ae.vertices[Ie*2+1]);break}}}F.push({bevelI:oe,angle:re,size:ue,boundary:Ae,reverseMap:he,insetPoints:me})}let Y=(oe,re,ue)=>{let me=0,he=oe.boundary.vertexIndices.length;for(;me<he&&ue(oe.boundary.vertexIndices[re]);)re=(re+1)%he,me++;return me},le=_.length;for(let oe=1;oe<F.length;oe++){let re=F[oe-1],ue=F[oe],me=re.boundary.vertexIndices.length,he=ue.boundary.vertexIndices.length;if(!me||!he)break;let Ce=J.concave.length,Ae=0,Ie=dD(Ae,V);for(;!re.boundary.vertexIndices.filter(Ie).length||!ue.boundary.vertexIndices.filter(Ie).length;)Ae++,Ie=dD(Ae,V);let Me=re.boundary.vertexIndices.findIndex(Ie),De=ue.boundary.vertexIndices.findIndex(Ie);do Me=(Me+1)%me;while(Ie(re.boundary.vertexIndices[Me]));do De=(De+1)%he;while(Ie(ue.boundary.vertexIndices[De]));Ae=(Ae+1)%V;let Ve=Ae,Ge=0,Qe=this._buildBevelVert(J,re,(Me-1+me)%me,void 0,Ge),ot=this._buildBevelVert(J,ue,(De-1+he)%he,void 0,Ge),$e=Qe,Ke=ot,bt,xt,q=!1;do{Ge=(Ae||Ce)/Ce,Ie=dD(Ae,V);let N=Y(re,Me,Ie),de=Y(ue,De,Ie),ze=q;if(q=!1,N&&!de){for(let $=0;$<N;$++)bt=this._buildBevelVert(J,re,(Me+$)%me,$/(N-1),Ge),_.push($e.topN,bt.topP,Ke.topN),a===!1&&_.push(bt.bottomP,$e.bottomN,Ke.bottomN),$e=bt;q=!0}else if(!N&&de)for(let $=0;$<de;$++)xt=this._buildBevelVert(J,ue,(De+$)%he,$/(de-1),Ge),_.push(Ke.topN,$e.topP,xt.topP),a===!1&&_.push($e.bottomP,Ke.bottomN,xt.bottomP),Ke=xt;else if(N&&de)if(bt=this._buildBevelVert(J,re,Me,0,Ge),xt=this._buildBevelVert(J,ue,De,0,Ge),ze?(_.push($e.topN,xt.topP,Ke.topN),_.push($e.topN,bt.topP,xt.topP),a===!1&&(_.push(xt.bottomP,$e.bottomN,Ke.bottomN),_.push(xt.bottomP,bt.bottomP,$e.bottomN))):(_.push(Ke.topN,$e.topN,bt.topP),_.push(Ke.topN,bt.topP,xt.topP),a===!1&&(_.push(bt.bottomP,$e.bottomN,Ke.bottomN),_.push(bt.bottomP,Ke.bottomN,xt.bottomP))),$e=bt,Ke=xt,N===de)for(let $=1;$<N;$++)bt=this._buildBevelVert(J,re,(Me+$)%me,$/(N-1),Ge),xt=this._buildBevelVert(J,ue,(De+$)%he,$/(de-1),Ge),_.push($e.topN,bt.topP,Ke.topN),_.push(Ke.topN,bt.topP,xt.topP),a===!1&&(_.push(bt.bottomP,$e.bottomN,Ke.bottomN),_.push(bt.bottomP,Ke.bottomN,xt.bottomP)),$e=bt,Ke=xt;else if(N>de){let $=N/de,Ue=0;for(let rt=1;rt<N;rt++)bt=this._buildBevelVert(J,re,(Me+rt)%me,rt/(N-1),Ge),_.push($e.topN,bt.topP,Ke.topN),a===!1&&_.push(bt.bottomP,$e.bottomN,Ke.bottomN),$e=bt,rt>(Ue+1)*$&&(Ue++,xt=this._buildBevelVert(J,ue,(De+Ue)%he,Ue/(de-1),Ge),_.push(Ke.topN,bt.topP,xt.topP),a===!1&&_.push(bt.bottomP,Ke.bottomN,xt.bottomP),Ke=xt)}else{let $=de/N,Ue=0;for(let rt=1;rt<de;rt++)xt=this._buildBevelVert(J,ue,(De+rt)%he,rt/(de-1),Ge),_.push(Ke.topN,bt.topP,xt.topP),a===!1&&_.push(bt.bottomP,Ke.bottomN,xt.bottomP),Ke=xt,rt>(Ue+1)*$&&(Ue++,bt=this._buildBevelVert(J,re,(Me+Ue)%me,Ue/(N-1),Ge),_.push($e.topN,bt.topP,Ke.topN),a===!1&&_.push(bt.bottomP,$e.bottomN,Ke.bottomN),$e=bt)}Me=(Me+N)%me,De=(De+de)%he,Ae=(Ae+1)%Ce}while(Ae!==Ve)}if(a===!1&&this._depth>this._bevel*2&&this._buildWall(F,J,_),L){let oe=[];for(let re=_.length-1;re>=le+2;re-=3){let ue=_[re-2],me=_[re-1],he=_[re-0];oe.push(he,me,ue)}_.splice(le,_.length-le,...oe)}if(L){let oe=[];for(let re=F[F.length-1].boundary.vertices.length-1;re>=1;re-=2){let ue=F[F.length-1].boundary.vertices[re-1],me=F[F.length-1].boundary.vertices[re-0];oe.push(ue,me)}A.push(oe)}if(!L){let oe=F[F.length-1],re;try{re=mp({windingRule:F.length>1?Sr.POSITIVE:Sr.ODD,elementType:is.POLYGONS,vertexSize:2,strict:!0,contours:[oe.insetPoints,...A]})}catch{re=jY}if(!re)throw new Error("Error generating geometry for surface");l.length===0&&this._bevel<h&&Object.assign(this,{useNgonForTopBottomFaceDuringBake:!0});for(let ue=0;ue<re.elementCount*3;ue+=3){let me=this._buildSurfaceVert(re,re.elements[ue+0],X),he=this._buildSurfaceVert(re,re.elements[ue+1],X),Ce=this._buildSurfaceVert(re,re.elements[ue+2],X);_.push(me.top,he.top,Ce.top),a===!1&&_.push(Ce.bottom,he.bottom,me.bottom)}}this.vertexCache={}}this._buffer.shrink();let C=new hi(Uint32Array.from(_),1),E=new hi(this._buffer.positions,3),I=new hi(this._buffer.normals,3),T=new hi(this._buffer.uvs,2);E.needsUpdate=!0,I.needsUpdate=!0,T.needsUpdate=!0,C.needsUpdate=!0,this.setAttribute("position",E),this.setAttribute("normal",I),this.setAttribute("uv",T),this.setIndex(C)}_computeBufferEstimatedSize(e){return e.vertexCount*2*(2+this._bevelSegments)}_buildWall(e,t,i){let r=e[0];for(let n=0,s=r.boundary.vertexCount;n<s;n++){let a=this._buildBevelVert(t,r,n),o=this._buildBevelVert(t,r,(n+1)%s);i.push(o.topP,a.topN,a.bottomN),i.push(o.topP,a.bottomN,o.bottomP)}}_buildSurfaceVert(e,t,i){let r=t.toString();if(r in this.vertexCache)return this.vertexCache[r];let n=e.vertices[t*2+0],s=e.vertices[t*2+1],a=(n-this._minX)/this._width,o=(s-this._minY)/this._height;this.forPathBevel&&(o=1);let l=this._buffer.get(this.forPathBevel?1:2),u=l*3,c=l*2,h={top:l+0,bottom:l+1};return this._buffer.positions[u+0]=n,this._buffer.positions[u+1]=s,this._buffer.positions[u+2]=this.forPathBevel?this._bevel:this._depth-i,this._buffer.normals[u+0]=0,this._buffer.normals[u+1]=0,this._buffer.normals[u+2]=1,this._buffer.uvs[c+0]=a,this._buffer.uvs[c+1]=o,this.forPathBevel===!1&&(this._buffer.positions[u+3]=n,this._buffer.positions[u+4]=s,this._buffer.positions[u+5]=i,this._buffer.normals[u+3]=0,this._buffer.normals[u+4]=0,this._buffer.normals[u+5]=-1,this._buffer.uvs[c+2]=a,this._buffer.uvs[c+3]=o),this.vertexCache[r]=h,h}_buildBevelVert(e,t,i,r=1,n){let s=`${t.bevelI}:${i}`;if(s in this.vertexCache&&n!==0&&n!==1&&(!n||n===this.vertexCache[s].pathBevelUCoord))return this.vertexCache[s];let[a,o]=t.boundary.vertexIndices[i],l,u,c,h;a!==o?(u=a,l=o,h=!1,c=e.continuous[u]&&e.continuous[l]):(l=a,u=(l-1+e.count)%e.count,h=e.concave[l]&&t.bevelI>0,c=e.continuous[l]||h);let d=Math.cos(t.angle),p=Math.sin(t.angle),m=i*2,v=l*2,g=u*2,w=t.boundary.vertices[m+0],S=t.boundary.vertices[m+1],_=(1-p)*this._bevel,A=(w-this._minX)/this._width,C=(S-this._minY)/this._height;this.forPathBevel&&(n!==void 0&&(A=n),C=1);let E=e.normals[v+0],I=e.normals[v+1],T=e.normals[g+0],D=e.normals[g+1];if(h){let j=T-E,J=D-I;E=E+j*(1-r),I=I+J*(1-r);let ne=Math.sqrt(E*E+I*I);E/=ne,I/=ne}let L=this.forPathBevel?this._buffer.get(c?1:2):this._buffer.get(c?2:4),z=L*3,G=L*2,V={i,fi:l,topP:L+0,topN:L+0,bottomP:L+1,bottomN:L+1,pathBevelUCoord:n};return this._buffer.positions[z+0]=w,this._buffer.positions[z+1]=S,this._buffer.positions[z+2]=(this.forPathBevel?this._bevel:this._depth)-_,this._buffer.normals[z+0]=E*d,this._buffer.normals[z+1]=I*d,this._buffer.normals[z+2]=p,this._buffer.uvs[G+0]=A,this._buffer.uvs[G+1]=C,this.forPathBevel===!1&&(this._buffer.positions[z+3]=w,this._buffer.positions[z+4]=S,this._buffer.positions[z+5]=_,this._buffer.normals[z+3]=E*d,this._buffer.normals[z+4]=I*d,this._buffer.normals[z+5]=-p,this._buffer.uvs[G+2]=C,this._buffer.uvs[G+3]=A),c||(this.forPathBevel?(L+=1,z+=3,G+=2):(L+=2,z+=6,G+=4),V.topP=L+0,V.bottomP=L+1,this._buffer.positions[z+0]=w,this._buffer.positions[z+1]=S,this._buffer.positions[z+2]=(this.forPathBevel?this._bevel:this._depth)-_,this._buffer.normals[z+0]=T*d,this._buffer.normals[z+1]=D*d,this._buffer.normals[z+2]=p,this._buffer.uvs[G+0]=A,this._buffer.uvs[G+1]=C,this.forPathBevel===!1&&(this._buffer.positions[z+3]=w,this._buffer.positions[z+4]=S,this._buffer.positions[z+5]=_,this._buffer.normals[z+3]=T*d,this._buffer.normals[z+4]=D*d,this._buffer.normals[z+5]=-p,this._buffer.uvs[G+2]=C,this._buffer.uvs[G+3]=A)),this.vertexCache[s]=V,V}clone(){let e=new aB(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=JC(this.userData),e}},HY=class extends Kt{constructor(e,t=12,i={}){super(),this.type="ShapeGeometry",this.windingRule=Sr.ODD,this.elementType=is.POLYGONS,this.polySize=3,this.vertexSize=2,this.strict=!0,this._shape=e,this._curveSegments=t,this._triangulationOptions=Object.assign({windingRule:Sr.ODD,elementType:is.POLYGONS,polySize:3,vertexSize:2,strict:!0},i);let r=this._shape.extractShapePointsToFlatArray([],this._curveSegments),n=this._shape.shapeHoles.map(d=>d.extractShapePointsToFlatArray([],this._curveSegments)),s,a=!0,o=!0,l,u;for(let d=0,p=r.length/2;d<p;d++){let m=d*2,v=r[m+0],g=r[m+1];if(l!==void 0&&v!==l&&(a=!1),u!==void 0&&g!==u&&(o=!1),l=v,u=g,!a&&!o)break}if(!a&&!o)try{s=mp({contours:[r,...n],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict})}catch{s=sB}let c=s?.vertexCount??1,h=s?.elementCount??1;if(this._positionAttribute=new hi(new Float32Array(c*3),3),this._normalAttribute=new hi(new Float32Array(c*3),3),this._uvAttribute=new hi(new Float32Array(c*2),2),this._indexAttribute=new hi(new Uint32Array(h*3),1),s){let d=1/0,p=-1/0,m=1/0,v=-1/0;for(let S=0,_=c;S<_;S++){let A=S*2,C=s.vertices[A+0],E=s.vertices[A+1];C<d&&(d=C),C>p&&(p=C),E<m&&(m=E),E>v&&(v=E)}let g=p-d,w=v-m;for(let S=0,_=c;S<_;S++){let A=S*2,C=s.vertices[A+0],E=s.vertices[A+1],I=(C-d)/g,T=(E-m)/w;this._positionAttribute.setXYZ(S,C,E,0),this._normalAttribute.setXYZ(S,0,0,1),this._uvAttribute.setXY(S,I,T)}for(let S=0,_=h;S<_;S++){let A=S*3,C=s.elements[A+0],E=s.elements[A+1],I=s.elements[A+2];this._indexAttribute.setX(A+0,C),this._indexAttribute.setX(A+1,E),this._indexAttribute.setX(A+2,I)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,(s?.elementCount??1)*3)}clone(){let e=new HY(this._shape,this._curveSegments);return e.userData=JC(this.userData),e}},WY=class extends aB{constructor(e,t,i=0,r=12,n=3,s=Sr.ODD){super(e,t,i,r,n,s),this.type="ShapeGeometry"}_computeBufferEstimatedSize(e){return e.vertexCount*2*(2+this._bevelSegments)}_buildWall(e,t,i){let r=e[0];for(let n=0,s=r.boundary.vertexCount;n<s;n++){let a=this._buildBevelVert(t,r,n),o=this._buildBevelVert(t,r,(n+1)%s);i.push(o.topP,a.topN,a.bottomN),i.push(o.topP,a.bottomN,o.bottomP)}}clone(){let e=new WY(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=JC(this.userData),e}},cv=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:Sr.ODD},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),a=e.shape??t?.shape,o=a?.roundness??i.roundness;a!==void 0&&(a instanceof wn?(a.width!==r||a.height!==n)&&a.applySize(r,n):a=new wn(r,n).fromJSON(a),e.parameters?.roundness!==void 0&&e.parameters?.roundness>0&&a.update());let l=a??new wn(r,n);return{parameters:Object.assign(i,{width:r,height:n,depth:s,roundness:o}),shape:l}}static build(e){let{depth:t,extrudeBevelSize:i,extrudeBevelSegments:r,subdivisions:n,roundness:s,windingRule:a}=e.parameters;e.shape.roundness=s;let o;return t<=0?o=new HY(e.shape,n,{windingRule:a}):o=new WY(e.shape,t,i,n,r,a),Object.assign(o,{userData:{...e,type:"VectorGeometry"}})}},GY=Math.PI*2,oB=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return i.angle=Ot.clamp(i.angle,0,360),{shape:e.shape&&e.shape instanceof wn?e.shape:new wn,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,spikes:r,angle:n,innerRadius:s,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}=e.parameters,u=e.shape,c=t*.5,h=i*.5,d=XTe(u,c,h,n*Math.PI/180,r,s);u.isClosed=!0,u.update();let p;return n===0?(p=new Kt,p.setAttribute("position",new kt([],3))):p=cv.create({shape:u,parameters:{subdivisions:d,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}}),Object.assign(p,{userData:{...e,type:"EllipseGeometry"}})}};function XTe(e,t,i,r,n,s){if(r>=GY)return n>30||n%4===0?(QTe(e,t,i,s),Math.round(n/4)):fj(e,r,n,t,i,s);r=Math.max(r,.001);let a={x:0,y:i},o=r+Math.PI*.5,l={x:Math.cos(o)*t,y:Math.sin(o)*i},u=BTe({px:a.x,py:a.y,cx:l.x,cy:l.y,rx:t,ry:i,largeArcFlag:r>Math.PI,sweepFlag:!0});return n>30||n%u.length===0?YTe(e,a.x,a.y,u,n,t,i,s):fj(e,r,n,t,i,s)}function YTe(e,t,i,r,n,s,a,o){let l=Math.round(n/r.length);e.addPoint(Xy(t,i));for(let u=0,c=r.length;u<c;u++){let h=r[u],d=e.points[u],p=Xy(h.x,h.y);d.controls[1].position.set(h.x1,h.y1),p.controls[0].position.set(h.x2,h.y2),e.addPoint(p)}return o>0?qY(e,s,a,o):e.addPoint(Xy(0,0)),l}function fj(e,t,i,r,n,s){let a=-t/i;for(let o=0;o<=i;o++){let l=a*o,u=Math.sin(l)*r,c=Math.cos(l)*n;e.addPoint(Xy(u,c))}return t<GY?s>0?qY(e,r,n,s):e.addPoint(Xy(0,0)):(e.removePoint(e.points[e.points.length-1]),s>0&&XY(e,r,n,s)),1}function QTe(e,t,i,r=0,n=0,s=0){let a=.5522847498,o=t*a,l=i*a;e.addPoint(BA(n-t,s,n-t,s-l,n-t,s+l)),e.addPoint(BA(n,s+i,n-o,s+i,n+o,s+i)),e.addPoint(BA(n+t,s,n+t,s+l,n+t,s-l)),e.addPoint(BA(n,s-i,n+o,s-i,n-o,s-i)),r>0&&XY(e,t,i,r)}function Xy(e,t){return new qy(Ot.generateUUID(),new Pe(e,t))}function BA(e,t,i,r,n,s){let a=Xy(e,t);return a.controls[0].position.set(i,r),a.controls[1].position.set(n,s),a}function qY(e,t,i,r){YY(e,t,i,r).forEach(n=>e.addPoint(n))}function XY(e,t,i,r){let n=YY(e,t,i,r),s=new wn;n.forEach(a=>s.addPoint(a)),s.isClosed=!0,e.shapeHoles.push(s)}function YY(e,t,i,r){let n=r*t/100,s=n*(Math.abs(i)/Math.abs(t)),a=new Pe(n/t,s/i),o=e.points.map(l=>{let u=l.clone();return u.uuid=Ot.generateUUID(),u}).reverse();return o.forEach(l=>{l.position.multiply(a);let u=l.controls[0].position.clone().multiply(a),c=l.controls[1].position.clone().multiply(a);l.controls[0].position.copy(c),l.controls[1].position.copy(u)}),o}var KTe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??r),s=Math.abs(i.depth??r),a=Math.abs(Math.min(r,s))/2;return{parameters:Object.assign(i,{width:r,height:n,depth:s,radius:a,segments:Math.round(i.segments),pathSegments:Math.round(i.pathSegments),cornerSegments:Math.round(i.cornerSegments)})}}static build(e){let{width:t,height:i,depth:r,radius:n,revolutions:s,segments:a,pathRadius:o,pathType:l,pathSegments:u,cornerRadius:c,cornerSegments:h}=e.parameters,d=new QY(!1,t,i,r,n,s,a,o,l,u,c,h);return Object.assign(d,{userData:{...e,type:"HelixGeometry"}})}},fD=new Vy([0,0,0],1),QY=class extends Kt{constructor(e=!0,t=1,i=1,r=1,n=1,s=1,a=1,o=1,l=1,u=1,c=1,h=1){if(super(),s===0)return;let d=e&&s===1;d&&(h=0),c>100&&(c=100),c===0&&(h=0);let p=()=>new H,m=new H,v=p(),g=p(),w=p(),S,_,A,C,E,I,T,D,L=p(),z=p(),G=p(),V=p(),j=p(),J=p(),ne=p(),K=p(),B=i-2*o+.001,Z=B/s,F=Math.ceil(a*s),X=F+1,Y=B/F,le=-B/2,oe=u+1,re=2*Math.PI/u,ue=Math.PI/2/h,me=.01,he=Math.min((1-c/100)*o,o-me),Ce=o-he,Ae=0,Ie=2,Me=h*Ie+Ie,De=oe*Me/Ie,Ve=De+oe*X,Ge=Math.max(0,oe*(X+Me)),[Qe,ot,$e]=[3,3,2].map(Ee=>Array(Ge*Ee).fill(0)),Ke=[],bt=n-o;function xt(Ee,lt){let et=Math.PI/2;I=lt*Y,D=2*Math.PI*(I%Z)/Z+et,I+=le,T=Math.sin(D)*bt,E=Math.cos(D)*bt,e?Ee.set(E,T,I):Ee.set(E,I,T)}xt(m,-1e-10),xt(v,0),L.copy(m),xt(m,1);let q=m.distanceTo(v),N=d?0:Ce+he,de=q*F+2*N,ze=he,$=de-N;for(let Ee=0;Ee<=F;Ee++){xt(g,Ee),K.subVectors(g,L).normalize(),L.copy(g),J.copy(g).setComponent(+e+1,0).normalize(),ne.crossVectors(K,J).normalize();let lt=Ee===0,et=Ee===F,pt=lt?3*Math.PI/2:ue,mt=lt?ze:$,dt=lt?oe:Ve,_e=lt?0:Ge-oe,it=K.clone().multiplyScalar(lt?-Ce:Ce).add(g),At=K.clone().multiplyScalar(lt?-1:1).normalize();for(let ie=0;ie<oe;ie++){let we=ie*re;if(z.addVectors(m.copy(J).multiplyScalar(o*Math.cos(we)),v.copy(ne).multiplyScalar(o*Math.sin(we))),G.copy(z).normalize(),lt||et){d||(Ae=_e+ie,[0,1,2].forEach(Re=>{Qe[Ae*3+Re]=it.getComponent(Re),ot[Ae*3+Re]=At.getComponent(Re)}),$e[Ae*2]=+et,$e[Ae*2+1]=ie/u),v.copy(G).multiplyScalar(he),w.addVectors(g,v);for(let Re=0;Re<h;Re++){let We=Re*ue+pt;V.addVectors(m.copy(K).multiplyScalar(Ce*Math.sin(We)),v.copy(G).multiplyScalar(Ce*Math.cos(We))),j.copy(V).normalize(),v.addVectors(w,V),V.normalize(),Ae=dt+Re*oe+ie,[0,1,2].forEach(Ut=>{Qe[Ae*3+Ut]=v.getComponent(Ut),ot[Ae*3+Ut]=j.getComponent(Ut)});let ct=+lt+Math.sin(We);$e[Ae*2]=(mt+Ce*ct)/de,$e[Ae*2+1]=ie/u}}v.addVectors(g,z),Ae=De+Ee*oe+ie,[0,1,2].forEach(Re=>{Qe[Ae*3+Re]=v.getComponent(Re),ot[Ae*3+Re]=G.getComponent(Re)}),$e[Ae*2]=(N+Ee*q)/de,$e[Ae*2+1]=ie/u}}let Ue=X+2*h+Ie,[rt,Ye]=[+d,Ue-1];for(let Ee=rt;Ee<=Ye-1;Ee++){let lt=d&&Ee===Ye-1;for(let et=0;et<oe-1;et++)S=Ee*oe+et,_=S+1,A=(lt?et:S)+oe,C=(lt?et+1:_)+oe,Ee===0?Ke.push(_,C,A):Ee===Ue-2?Ke.push(S,_,A):Ke.push(S,_,A,_,C,A)}this.setIndex(Ke),this.setAttribute("position",new kt(Qe,3)),this.setAttribute("normal",new kt(ot,3)),this.setAttribute("uv",new kt($e,2))}getClosedTorusIndicesForBooleanOrSubdiv(){let e=this.userData.parameters,t=Math.ceil(e.tubularSegments),i=e.radialSegments+1,r=Array.from(this.getIndex().array),n,s,a,o,l=6*(t-1)*e.radialSegments,u=t,c=u===t;for(let h=0;h<e.radialSegments;h++)n=u*i+h,s=n+1,a=(c?h:n)+i,o=(c?h+1:s)+i,r[l++]=n,r[l++]=s,r[l++]=a,r[l++]=s,r[l++]=o,r[l++]=a;return r.length=l,fD.array=r,fD.count=r.length,fD}},ZTe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,detail:n,corner:s,cornerSides:a}=e.parameters,o=n===0&&s!==0?new KY(t*.5,s,a):new Eq(t*.5,n);return o.scale(1,i/t,r/t),Object.assign(o,{userData:{...e,type:"IcosahedronGeometry"}})}},KY=class extends iB{constructor(e=1,t=.2,i=4){let r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a="IcosahedronGeometry";super(n,s,a,e,t,i),this.type=a}static fromJSON(e){return new KY(e.radius,e.corner,e.cornerSides)}},JTe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){(e.parameters?.points??[]).forEach(r=>{Array.isArray(r)&&(r.x=r[0],r.y=r[1])});let i=Object.assign({},t?.parameters??{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{points:t,segments:i,verticalSegments:r}=e.parameters,n=new d2;n.moveTo(t[0].x,t[0].y),n.bezierCurveTo(t[1].x,t[1].y,t[2].x,t[2].y,t[3].x,t[3].y);let s=new wq(n.extractPoints(r).shape,i);return s.rotateZ(Math.PI),Object.assign(s,{userData:{...e,type:"LatheGeometry"}})}},wc=new yt,pD=new vr,NA=new H,eC=class extends Ys{constructor(){super(),this.uuid=Ot.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(e){let t=new rs().getNormalMatrix(e);for(let i=0,r=this.vertices.length;i<r;i++)this.vertices[i].applyMatrix4(e);for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i];n.normal.applyMatrix3(t).normalize();for(let s=0,a=n.vertexNormals.length;s<a;s++)n.vertexNormals[s].applyMatrix3(t).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(e){return wc.makeRotationX(e),this.applyMatrix4(wc),this}rotateY(e){return wc.makeRotationY(e),this.applyMatrix4(wc),this}rotateZ(e){return wc.makeRotationZ(e),this.applyMatrix4(wc),this}translate(e,t,i){return wc.makeTranslation(e,t,i),this.applyMatrix4(wc),this}scale(e,t,i){return wc.makeScale(e,t,i),this.applyMatrix4(wc),this}lookAt(e){return pD.lookAt(e),pD.updateMatrix(),this.applyMatrix4(pD.matrix),this}fromBufferGeometry(e){let t=this,i=e.index!==null?e.index:void 0,r=e.attributes;if(r.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let n=r.position,s=r.normal,a=r.color,o=r.uv,l=r.uv2;l!==void 0&&(this.faceVertexUvs[1]=[]);for(let h=0;h<n.count;h++)t.vertices.push(new H().fromBufferAttribute(n,h)),a!==void 0&&t.colors.push(new li().fromBufferAttribute(a,h));function u(h,d,p,m){let v=a===void 0?[]:[t.colors[h].clone(),t.colors[d].clone(),t.colors[p].clone()],g=s===void 0?[]:[new H().fromBufferAttribute(s,h),new H().fromBufferAttribute(s,d),new H().fromBufferAttribute(s,p)],w=new qL(h,d,p,g,v,m);t.faces.push(w),o!==void 0&&t.faceVertexUvs[0].push([new Pe().fromBufferAttribute(o,h),new Pe().fromBufferAttribute(o,d),new Pe().fromBufferAttribute(o,p)]),l!==void 0&&t.faceVertexUvs[1].push([new Pe().fromBufferAttribute(l,h),new Pe().fromBufferAttribute(l,d),new Pe().fromBufferAttribute(l,p)])}let c=e.groups;if(c.length>0)for(let h=0;h<c.length;h++){let d=c[h],p=d.start,m=d.count;for(let v=p,g=p+m;v<g;v+=3)i!==void 0?u(i.getX(v),i.getX(v+1),i.getX(v+2),d.materialIndex):u(v,v+1,v+2,d.materialIndex)}else if(i!==void 0)for(let h=0;h<i.count;h+=3)u(i.getX(h),i.getX(h+1),i.getX(h+2));else for(let h=0;h<n.count;h+=3)u(h,h+1,h+2);return this.computeFaceNormals(),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(NA).negate(),this.translate(NA.x,NA.y,NA.z),this}normalize(){this.computeBoundingSphere();let e=this.boundingSphere.center,t=this.boundingSphere.radius,i=t===0?1:1/t,r=new yt;return r.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix4(r),this}computeFaceNormals(){let e=new H,t=new H;for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i],s=this.vertices[n.a],a=this.vertices[n.b],o=this.vertices[n.c];e.subVectors(o,a),t.subVectors(s,a),e.cross(t),e.normalize(),n.normal.copy(e)}}computeVertexNormals(e=!0){let t=new Array(this.vertices.length);for(let i=0,r=this.vertices.length;i<r;i++)t[i]=new H;if(e){let i=new H,r=new H;for(let n=0,s=this.faces.length;n<s;n++){let a=this.faces[n],o=this.vertices[a.a],l=this.vertices[a.b],u=this.vertices[a.c];i.subVectors(u,l),r.subVectors(o,l),i.cross(r),t[a.a].add(i),t[a.b].add(i),t[a.c].add(i)}}else{this.computeFaceNormals();for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i];t[n.a].add(n.normal),t[n.b].add(n.normal),t[n.c].add(n.normal)}}for(let i=0,r=this.vertices.length;i<r;i++)t[i].normalize();for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i],s=n.vertexNormals;s.length===3?(s[0].copy(t[n.a]),s[1].copy(t[n.b]),s[2].copy(t[n.c])):(s[0]=t[n.a].clone(),s[1]=t[n.b].clone(),s[2]=t[n.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){let i=this.faces[e],r=i.vertexNormals;r.length===3?(r[0].copy(i.normal),r[1].copy(i.normal),r[2].copy(i.normal)):(r[0]=i.normal.clone(),r[1]=i.normal.clone(),r[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let t=0,i=this.faces.length;t<i;t++){let r=this.faces[t];r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]);for(let n=0,s=r.vertexNormals.length;n<s;n++)r.__originalVertexNormals[n]?r.__originalVertexNormals[n].copy(r.vertexNormals[n]):r.__originalVertexNormals[n]=r.vertexNormals[n].clone()}let e=new eC;e.faces=this.faces;for(let t=0,i=this.morphTargets.length;t<i;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];let n=this.morphNormals[t].faceNormals,s=this.morphNormals[t].vertexNormals;for(let a=0,o=this.faces.length;a<o;a++){let l=new H,u={a:new H,b:new H,c:new H};n.push(l),s.push(u)}}let r=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let n=0,s=this.faces.length;n<s;n++){let a=this.faces[n],o=r.faceNormals[n],l=r.vertexNormals[n];o.copy(a.normal),l.a.copy(a.vertexNormals[0]),l.b.copy(a.vertexNormals[1]),l.c.copy(a.vertexNormals[2])}}for(let t=0,i=this.faces.length;t<i;t++){let r=this.faces[t];r.normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals}}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Nn),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Wo),this.boundingSphere.setFromPoints(this.vertices)}merge(e,t,i=0){if(!(e&&e.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}let r,n=this.vertices.length,s=this.vertices,a=e.vertices,o=this.faces,l=e.faces,u=this.colors,c=e.colors;t!==void 0&&(r=new rs().getNormalMatrix(t));for(let h=0,d=a.length;h<d;h++){let p=a[h].clone();t!==void 0&&p.applyMatrix4(t),s.push(p)}for(let h=0,d=c.length;h<d;h++)u.push(c[h].clone());for(let h=0,d=l.length;h<d;h++){let p=l[h],m,v,g=p.vertexNormals,w=p.vertexColors,S=new qL(p.a+n,p.b+n,p.c+n);S.normal.copy(p.normal),r!==void 0&&S.normal.applyMatrix3(r).normalize();for(let _=0,A=g.length;_<A;_++)m=g[_].clone(),r!==void 0&&m.applyMatrix3(r).normalize(),S.vertexNormals.push(m);S.color.copy(p.color);for(let _=0,A=w.length;_<A;_++)v=w[_],S.vertexColors.push(v.clone());S.materialIndex=p.materialIndex+i,o.push(S)}for(let h=0,d=e.faceVertexUvs.length;h<d;h++){let p=e.faceVertexUvs[h];this.faceVertexUvs[h]===void 0&&(this.faceVertexUvs[h]=[]);for(let m=0,v=p.length;m<v;m++){let g=p[m],w=[];for(let S=0,_=g.length;S<_;S++)w.push(g[S].clone());this.faceVertexUvs[h].push(w)}}}mergeMesh(e){if(!(e&&e.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)}mergeVertices(e=4){let t={},i=[],r=[],n=Math.pow(10,e);for(let o=0,l=this.vertices.length;o<l;o++){let u=this.vertices[o],c=Math.round(u.x*n)+"_"+Math.round(u.y*n)+"_"+Math.round(u.z*n);t[c]===void 0?(t[c]=o,i.push(this.vertices[o]),r[o]=i.length-1):r[o]=r[t[c]]}let s=[];for(let o=0,l=this.faces.length;o<l;o++){let u=this.faces[o];u.a=r[u.a],u.b=r[u.b],u.c=r[u.c];let c=[u.a,u.b,u.c];for(let h=0;h<3;h++)if(c[h]===c[(h+1)%3]){s.push(o);break}}for(let o=s.length-1;o>=0;o--){let l=s[o];this.faces.splice(l,1);for(let u=0,c=this.faceVertexUvs.length;u<c;u++)this.faceVertexUvs[u].splice(l,1)}let a=this.vertices.length-i.length;return this.vertices=i,a}setFromPoints(e){this.vertices=[];for(let t=0,i=e.length;t<i;t++){let r=e[t];this.vertices.push(new H(r.x,r.y,r.z||0))}return this}sortFacesByMaterialIndex(){let e=this.faces,t=e.length;for(let o=0;o<t;o++)e[o]._id=o;function i(o,l){return o.materialIndex-l.materialIndex}e.sort(i);let r=this.faceVertexUvs[0],n=this.faceVertexUvs[1],s,a;r&&r.length===t&&(s=[]),n&&n.length===t&&(a=[]);for(let o=0;o<t;o++){let l=e[o]._id;s&&s.push(r[l]),a&&a.push(n[l])}s&&(this.faceVertexUvs[0]=s),a&&(this.faceVertexUvs[1]=a)}toJSON(){let e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.parameters!==void 0){let p=this.parameters;for(let m in p)p[m]!==void 0&&(e[m]=p[m]);return e}let t=[];for(let p=0;p<this.vertices.length;p++){let m=this.vertices[p];t.push(m.x,m.y,m.z)}let i=[],r=[],n={},s=[],a={},o=[],l={};for(let p=0;p<this.faces.length;p++){let m=this.faces[p],v=!0,g=!1,w=this.faceVertexUvs[0][p]!==void 0,S=m.normal.length()>0,_=m.vertexNormals.length>0,A=m.color.r!==1||m.color.g!==1||m.color.b!==1,C=m.vertexColors.length>0,E=0;if(E=u(E,0,0),E=u(E,1,v),E=u(E,2,g),E=u(E,3,w),E=u(E,4,S),E=u(E,5,_),E=u(E,6,A),E=u(E,7,C),i.push(E),i.push(m.a,m.b,m.c),i.push(m.materialIndex),w){let I=this.faceVertexUvs[0][p];i.push(d(I[0]),d(I[1]),d(I[2]))}if(S&&i.push(c(m.normal)),_){let I=m.vertexNormals;i.push(c(I[0]),c(I[1]),c(I[2]))}if(A&&i.push(h(m.color)),C){let I=m.vertexColors;i.push(h(I[0]),h(I[1]),h(I[2]))}}function u(p,m,v){return v?p|1<<m:p&~(1<<m)}function c(p){let m=p.x.toString()+p.y.toString()+p.z.toString();return n[m]!==void 0||(n[m]=r.length/3,r.push(p.x,p.y,p.z)),n[m]}function h(p){let m=p.r.toString()+p.g.toString()+p.b.toString();return a[m]!==void 0||(a[m]=s.length,s.push(p.getHex())),a[m]}function d(p){let m=p.x.toString()+p.y.toString();return l[m]!==void 0||(l[m]=o.length/2,o.push(p.x,p.y)),l[m]}return e.data={},e.data.vertices=t,e.data.normals=r,s.length>0&&(e.data.colors=s),o.length>0&&(e.data.uvs=[o]),e.data.faces=i,e}clone(){return new eC().copy(this)}copy(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;let t=e.vertices;for(let h=0,d=t.length;h<d;h++)this.vertices.push(t[h].clone());let i=e.colors;for(let h=0,d=i.length;h<d;h++)this.colors.push(i[h].clone());let r=e.faces;for(let h=0,d=r.length;h<d;h++)this.faces.push(r[h].clone());for(let h=0,d=e.faceVertexUvs.length;h<d;h++){let p=e.faceVertexUvs[h];this.faceVertexUvs[h]===void 0&&(this.faceVertexUvs[h]=[]);for(let m=0,v=p.length;m<v;m++){let g=p[m],w=[];for(let S=0,_=g.length;S<_;S++){let A=g[S];w.push(A.clone())}this.faceVertexUvs[h].push(w)}}let n=e.morphTargets;for(let h=0,d=n.length;h<d;h++){let p={};if(p.name=n[h].name,n[h].vertices!==void 0){p.vertices=[];for(let m=0,v=n[h].vertices.length;m<v;m++)p.vertices.push(n[h].vertices[m].clone())}if(n[h].normals!==void 0){p.normals=[];for(let m=0,v=n[h].normals.length;m<v;m++)p.normals.push(n[h].normals[m].clone())}this.morphTargets.push(p)}let s=e.morphNormals;for(let h=0,d=s.length;h<d;h++){let p={};if(s[h].vertexNormals!==void 0){p.vertexNormals=[];for(let m=0,v=s[h].vertexNormals.length;m<v;m++){let g=s[h].vertexNormals[m],w={};w.a=g.a.clone(),w.b=g.b.clone(),w.c=g.c.clone(),p.vertexNormals.push(w)}}if(s[h].faceNormals!==void 0){p.faceNormals=[];for(let m=0,v=s[h].faceNormals.length;m<v;m++)p.faceNormals.push(s[h].faceNormals[m].clone())}this.morphNormals.push(p)}let a=e.skinWeights;for(let h=0,d=a.length;h<d;h++)this.skinWeights.push(a[h].clone());let o=e.skinIndices;for(let h=0,d=o.length;h<d;h++)this.skinIndices.push(o[h].clone());let l=e.lineDistances;for(let h=0,d=l.length;h<d;h++)this.lineDistances.push(l[h]);let u=e.boundingBox;u!==null&&(this.boundingBox=u.clone());let c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}toBufferGeometry(){let e=new $Te().fromGeometry(this),t=new Kt,i=new Float32Array(e.vertices.length*3);if(t.setAttribute("position",FA.call(new hi(i,3),e.vertices)),e.normals.length>0){let r=new Float32Array(e.normals.length*3);t.setAttribute("normal",FA.call(new hi(r,3),e.normals))}if(e.colors.length>0){let r=new Float32Array(e.colors.length*3);t.setAttribute("color",pj.call(new hi(r,3),e.colors))}if(e.uvs.length>0){let r=new Float32Array(e.uvs.length*2);t.setAttribute("uv",mj.call(new hi(r,2),e.uvs))}if(e.uvs2.length>0){let r=new Float32Array(e.uvs2.length*2);t.setAttribute("uv2",mj.call(new hi(r,2),e.uvs2))}t.groups=e.groups;for(let r in e.morphTargets){let n=[],s=e.morphTargets[r];for(let a=0,o=s.length;a<o;a++){let l=s[a],u=new kt(l.data.length*3,3);u.name=l.name,n.push(FA.call(u,l.data))}t.morphAttributes[r]=n}if(e.skinIndices.length>0){let r=new kt(e.skinIndices.length*4,4);t.setAttribute("skinIndex",gj.call(r,e.skinIndices))}if(e.skinWeights.length>0){let r=new kt(e.skinWeights.length*4,4);t.setAttribute("skinWeight",gj.call(r,e.skinWeights))}return e.boundingSphere!==null&&(t.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(t.boundingBox=e.boundingBox.clone()),t}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(e){let t=new Kt,i=e.geometry;if(e.isPoints||e.isLine){let r=new kt(i.vertices.length*3,3),n=new kt(i.colors.length*3,3);if(t.setAttribute("position",FA.call(r,i.vertices)),t.setAttribute("color",pj.call(n,i.colors)),i.lineDistances&&i.lineDistances.length===i.vertices.length){let s=new kt(i.lineDistances.length,1);t.setAttribute("lineDistance",ePe.call(s,i.lineDistances))}i.boundingSphere!==null&&(t.boundingSphere=i.boundingSphere.clone()),i.boundingBox!==null&&(t.boundingBox=i.boundingBox.clone())}else e.isMesh&&(t=i.toBufferGeometry());return t}};eC.prototype.isGeometry=!0;var $Te=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){let t=[],i,r,n,s=e.faces;for(r=0;r<s.length;r++){let a=s[r];a.materialIndex!==n&&(n=a.materialIndex,i!==void 0&&(i.count=r*3-i.start,t.push(i)),i={start:r*3,materialIndex:n})}i!==void 0&&(i.count=r*3-i.start,t.push(i)),this.groups=t}fromGeometry(e){let t=e.faces,i=e.vertices,r=e.faceVertexUvs,n=r[0]&&r[0].length>0,s=r[1]&&r[1].length>0,a=e.morphTargets,o=a.length,l;if(o>0){l=[];for(let g=0;g<o;g++)l[g]={name:a[g].name,data:[]};this.morphTargets.position=l}let u=e.morphNormals,c=u.length,h;if(c>0){h=[];for(let g=0;g<c;g++)h[g]={name:u[g].name,data:[]};this.morphTargets.normal=h}let d=e.skinIndices,p=e.skinWeights,m=d.length===i.length,v=p.length===i.length;i.length>0&&t.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let g=0;g<t.length;g++){let w=t[g];this.vertices.push(i[w.a],i[w.b],i[w.c]);let S=w.vertexNormals;if(S.length===3)this.normals.push(S[0],S[1],S[2]);else{let A=w.normal;this.normals.push(A,A,A)}let _=w.vertexColors;if(_.length===3)this.colors.push(_[0],_[1],_[2]);else{let A=w.color;this.colors.push(A,A,A)}if(n===!0){let A=r[0][g];A!==void 0?this.uvs.push(A[0],A[1],A[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",g),this.uvs.push(new Pe,new Pe,new Pe))}if(s===!0){let A=r[1][g];A!==void 0?this.uvs2.push(A[0],A[1],A[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",g),this.uvs2.push(new Pe,new Pe,new Pe))}for(let A=0;A<o;A++){let C=a[A].vertices;l[A].data.push(C[w.a],C[w.b],C[w.c])}for(let A=0;A<c;A++){let C=u[A].vertexNormals[g];h[A].data.push(C.a,C.b,C.c)}m&&this.skinIndices.push(d[w.a],d[w.b],d[w.c]),v&&this.skinWeights.push(p[w.a],p[w.b],p[w.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this}},qL=class{constructor(e,t,i,r,n,s=0){this.a=e,this.b=t,this.c=i,this.normal=r&&r.isVector3?r:new H,this.vertexNormals=Array.isArray(r)?r:[],this.color=n&&n.isColor?n:new li,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=s}clone(){return new this.constructor().copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}};function ePe(e){return this.array.set(e),this}function pj(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),s=new li),t[i++]=s.r,t[i++]=s.g,t[i++]=s.b}return this}function mj(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),s=new Pe),t[i++]=s.x,t[i++]=s.y}return this}function FA(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),s=new H),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z}return this}function gj(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),s=new bi),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z,t[i++]=s.w}return this}var tPe=["a","b","c"];function iPe(e,t){switch(t){case"c":return e.c;case"b":return e.b;case"a":default:return e.a}}function mD(e,t,i){let r=Math.min(e,t),n=Math.max(e,t),s=r+"_"+n;return i.get(s)}function gD(e,t,i,r,n,s){let a=Math.min(e,t),o=Math.max(e,t),l=a+"_"+o,u;if(r.has(l))u=r.get(l);else{let c=i[a],h=i[o];u={a:c,b:h,newEdge:null,faces:[]},r.set(l,u)}u.faces.push(n),s[e].edges.push(u),s[t].edges.push(u)}function rPe(e,t,i,r){let n,s,a;for(n=0,s=e.length;n<s;n++)i[n]={edges:[]};for(n=0,s=t.length;n<s;n++)a=t[n],gD(a.a,a.b,e,r,a,i),gD(a.b,a.c,e,r,a,i),gD(a.c,a.a,e,r,a,i)}function UA(e,t,i,r,n){e.push(new qL(t,i,r,void 0,void 0,n))}function J0(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function VA(e,t,i,r){e.push([t.clone(),i.clone(),r.clone()])}var nPe=class{constructor(e=1){this.subdivisions=e}modify(e){e instanceof Kt?e=new eC().fromBufferGeometry(e):e=e.clone(),e.mergeVertices();let t=this.subdivisions;for(;t-- >0;)this._smooth(e);return e.computeFaceNormals(),e.computeVertexNormals(),e}_smooth(e){let t=new H,i,r,n,s,a,o=e.vertices,l=e.faces,u=e.faceVertexUvs[0],c=u!==void 0&&u.length>0,h=[],d=new Map;rPe(o,l,h,d);let p=[],m,v,g,w,S,_,A;for(let me of Array.from(d.keys())){for(v=d.get(me),g=new H,S=3/8,_=1/8,A=v.faces.length,A!=2&&(S=.5,_=0,A!=1),g.addVectors(v.a,v.b).multiplyScalar(S),t.set(0,0,0),s=0;s<A;s++){for(w=v.faces[s],a=0;a<3&&(m=o[iPe(w,tPe[a])],!(m!==v.a&&m!==v.b));a++);m&&t.add(m)}t.multiplyScalar(_),g.add(t),v.newEdge=p.length,p.push(g)}let C,E,I,T,D,L,z,G=[];for(r=0,n=o.length;r<n;r++){for(L=o[r],D=h[r].edges,i=D.length,i==3?C=3/16:i>3&&(C=3/(8*i)),E=1-i*Number(C),I=C,i<=2&&(i==2?(E=3/4,I=1/8):i==1||i==0),z=L.clone().multiplyScalar(E),t.set(0,0,0),s=0;s<i;s++)T=D[s],m=T.a!==L?T.a:T.b,t.add(m);t.multiplyScalar(Number(I)),z.add(t),G.push(z)}let V=G.concat(p),j=G.length,J,ne,K,B=[],Z=[],F,X,Y,le,oe=new Pe,re=new Pe,ue=new Pe;for(r=0,n=l.length;r<n;r++)w=l[r],J=Number(mD(w.a,w.b,d).newEdge)+j,ne=Number(mD(w.b,w.c,d).newEdge)+j,K=Number(mD(w.c,w.a,d).newEdge)+j,UA(B,J,ne,K,w.materialIndex),UA(B,w.a,J,K,w.materialIndex),UA(B,w.b,ne,J,w.materialIndex),UA(B,w.c,K,ne,w.materialIndex),c&&(F=u[r],X=F[0],Y=F[1],le=F[2],oe.set(J0(X.x,Y.x),J0(X.y,Y.y)),re.set(J0(Y.x,le.x),J0(Y.y,le.y)),ue.set(J0(X.x,le.x),J0(X.y,le.y)),VA(Z,oe,re,ue),VA(Z,X,oe,ue),VA(Z,Y,re,oe),VA(Z,le,ue,re));e.vertices=V,e.faces=B,c&&(e.faceVertexUvs[0]=Z)}},ms=new H,sPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=e.geometry??t?.geometry??new Kt().copy(new Wu(100,100,100)),r;t===void 0?(i.computeBoundingBox(),i.boundingBox.getSize(ms),r={width:ms.x,height:ms.y,depth:ms.z,subdivisions:0}):r=t.parameters;let n={...r,...e.parameters};return{parameters:{width:Math.abs(n.width),height:Math.abs(n.height),depth:Math.abs(n.depth),subdivisions:Math.abs(n.subdivisions)},geometry:i}}static build(e){let{width:t,height:i,depth:r,subdivisions:n}=e.parameters,s=e.geometry??new Kt().copy(new Wu(100,100,100)),a=s.userData.parameters;a===void 0?(s.computeBoundingBox(),s.boundingBox.getSize(ms)):ms.set(a.width,a.height,a.depth),(t!==ms.x||i!==ms.y||r!==ms.z)&&s.scale(ms.x===0?1:t/ms.x,ms.y===0?1:i/ms.y,ms.z===0?1:r/ms.z);let o=s.originalGeometry;try{n>0?(o===void 0||a?.subdivisions!==n)&&(o===void 0&&(o=s),s=new nPe(n).modify(o).toBufferGeometry()):(o!==void 0&&(s=o),o=void 0,s.getAttribute("normal")===void 0&&s.computeVertexNormals())}catch{o!==void 0&&(s=o),o=void 0,s.getAttribute("normal")===void 0&&s.computeVertexNormals()}return o!==void 0&&Object.assign(s,{originalGeometry:o}),delete e.geometry,Object.assign(s,{userData:{...e,type:"NonParametricGeometry"}})}static loadFromUrl(e,t,i){new zq(i).load(e,r=>{let n=this.normalizeInputs({geometry:r});r.boundingBox.getSize(ms);let s=100/ms.x;Object.assign(n.parameters,{width:100,height:ms.y*s,depth:ms.z*s}),t(this.build(n))})}},ZY=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters);return{shape:e.shape&&e.shape instanceof wn?e.shape:new wn,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,spikes:r,cornerRadius:n,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}=e.parameters,l=e.shape,u=t*.5,c=i*.5,h=0,d=0,p=2*Math.PI/r;for(let v=0;v<r;v++){let g=p*v,w=h+Math.sin(g)*u,S=d+Math.cos(g)*c;l.addPoint(l.createPoint(w,S))}l.isClosed=!0;for(let v=0,g=l.points.length;v<g;v++)l.points[v].roundness=n;l.roundness=n,l.update();let m=cv.create({shape:l,parameters:{roundness:n,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}});return Object.assign(m,{userData:{...e,type:"PolygonGeometry"}})}},aPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,radialSegments:n,heightSegments:s,openEnded:a,cornerRadius:o,cornerSegments:l}=e.parameters,u=new lPe(t*.5,i,n,s,a,o,l);return u.scale(1,1,r/t),Object.assign(u,{userData:{...e,type:"PyramidGeometry"}})}};function Sw(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function vD(e,t,i,r,n,s){let a=t.clone().sub(e),o=i.clone().sub(e),l=a.angleTo(o);if(a.normalize(),o.normalize(),r===n){let u=a.add(o).normalize();s.copy(e).addScaledVector(u,r/Math.sin(l/2))}else{let u=a.angleTo(o);s.copy(e),s.addScaledVector(a,n/Math.sin(u)),s.addScaledVector(o,r/Math.sin(u))}}function oPe(e,t,i){let r=e.clone().sub(t),n=i.clone().sub(t);return r.projectOnVector(n),r.add(t)}var lPe=class extends Kt{constructor(e=.5,t=1,i=4,r=1,n=!1,s=0,a=4){super(),i=Math.floor(Math.max(3,i)),r=Math.floor(r),a=Math.floor(a);let o=[],l=[],u=[],c=[],h=0,d=t/2,p=Math.PI/i,m=e*Math.cos(Math.PI/i),v=2*Math.PI/i,g=(i-2)*Math.PI/i,w=Math.PI-g,S=new H(0,-d,0),_=new H(0,d,0),A=new Pe(e,-d),C=new Pe(m,-d),E=new Pe(0,_.y).sub(C),I=new Pe(0,_.y).sub(A),T=new Pe(E.y,-E.x).normalize(),D=new Pe(I.y,-I.x).normalize(),L=e*Math.cos(Math.PI/i)*Math.tan((Math.PI-E.angle())/2)-1e-8;s=Math.min(s,L);let z;{let K=new H(T.x,T.y,0),B=new H(Math.cos(v)*K.x,K.y,Math.sin(v)*K.x);z=K.angleTo(B)}let G=s/Math.tan((Math.PI-E.angle())/2),V=s/Math.tan((Math.PI-z)/2),j=new H;if(!n){l.push(S.x,S.y,S.z),u.push(0,-1,0),c.push(0,0);let K=h++,B=[],Z=A.clone(),F=G/Math.cos(Math.PI/i);Z.x-=F;for(let X=0;X<i;X++){let Y=X/i*Math.PI*2+p,le=new Pe(Math.sin(Y),Math.cos(Y));Sw(Z,le,j),l.push(j.x,j.y,j.z),u.push(0,-1,0),c.push(0,0),B.push(h++)}for(let X=0;X<B.length;X++)o.push(B[X],K,B[(X+1)%B.length])}{let K=new H,B=new H,Z=new H,F=new H,X=new H,Y=new H;for(let le=0;le<i;le++){let oe=le/i*Math.PI*2+p,re=(le+.5)/i*Math.PI*2+p,ue=(le+1)/i*Math.PI*2+p,me=new Pe(Math.sin(oe),Math.cos(oe)),he=new Pe(Math.sin(re),Math.cos(re)),Ce=new Pe(Math.sin(ue),Math.cos(ue));Sw(A,me,B),Sw(A,Ce,Z),Sw(T,he,K),vD(_,B,Z,V,V,F),l.push(F.x,F.y,F.z),vD(B,_,Z,V,G,X),l.push(X.x,X.y,X.z),vD(Z,B,_,G,V,Y),l.push(Y.x,Y.y,Y.z),u.push(K.x,K.y,K.z),u.push(K.x,K.y,K.z),u.push(K.x,K.y,K.z),c.push(0,0),c.push(0,0),c.push(0,0);let Ae=h++,Ie=h++,Me=h++;if(o.push(Ae,Ie,Me),s>0){{let Ge=B.clone().add(Z).multiplyScalar(.5),Qe=_.clone().sub(Ge).normalize(),ot=S.clone().sub(Ge).normalize().add(Qe).normalize().multiplyScalar(-1),$e=Y.clone().sub(X);J(Ge,$e,ot,E.angle())}let De,Ve;{let Ge=new H;Sw(D,Ce,Ge);let Qe=Y.clone().add(F).multiplyScalar(.5);Qe=oPe(Qe,Z,_);let ot=Y.clone().sub(F);[De,Ve]=J(Qe,ot,Ge,z,F.y)}{let Ge=De,Qe=Ge.clone().setY(0).normalize(),ot=new H(0,-1,0),$e=Qe.clone().cross(ot);ne(Ge,Qe,ot,$e)}{let Ge=E.angle(),Qe=Math.PI-Ge,ot=_.clone();ot.y-=s/Math.sin(Ge-Math.PI/2);let $e=new H,Ke=[];for(let xt=0;xt<a;xt++){let q=[],N=Math.PI/2-Qe*xt/a,de=Math.cos(N),ze=Math.sin(N),$=re;for(let Ue=0;Ue<=xt;Ue++){let rt=Math.cos($),Ye=Math.sin($);K.x=de*Ye,K.y=ze,K.z=de*rt,$e.copy(ot).addScaledVector(K,s),l.push($e.x,$e.y,$e.z),u.push(K.x,K.y,K.z),c.push(0,0),q.push(h++),$+=Math.PI*2/xt/i}Ke.push(q)}Ve.reverse(),Ke.push(Ve);let bt=Ke.length-1;for(let xt=0;xt<bt;xt++){let q=Ke[xt],N=Ke[xt+1],de=q.length-1;o.push(N[1],q[0],N[0]);for(let ze=1;ze<=de;ze++)o.push(q[ze],q[ze-1],N[ze]),o.push(N[ze+1],q[ze],N[ze])}}}}}this.setIndex(o),this.setAttribute("position",new kt(l,3)),this.setAttribute("normal",new kt(u,3)),this.setAttribute("uv",new kt(c,2));function J(K,B,Z,F,X){let Y=-F/2,le=(Math.PI-F)/2,oe=B.clone().normalize().cross(Z);K.addScaledVector(Z,-s/Math.sin(le));let re=new H,ue=new H,me=1,he=h,Ce=[];for(let Ae=0;Ae<=a;Ae++){let Ie=Y+Ae/a*F;ue.set(0,0,0),ue.addScaledVector(oe,Math.sin(Ie)),ue.addScaledVector(Z,Math.cos(Ie));for(let Me=0;Me<=me;Me++){let De=Me/me-.5;if(re.copy(K),re.addScaledVector(B,De),re.addScaledVector(ue,s),X!=null){let Ve=Math.max(0,re.y-X);re.addScaledVector(B,-Ve/B.y)}l.push(re.x,re.y,re.z),u.push(ue.x,ue.y,ue.z),c.push(0,0),Me===0&&Ce.push(h),h++}}for(let Ae=0;Ae<a;Ae++)for(let Ie=0;Ie<me;Ie++){let Me=he+Ie+(me+1)*Ae,De=Me+(me+1),Ve=De+1,Ge=Me+1;o.push(Me,De,Ge),o.push(De,Ve,Ge)}return[K.clone().addScaledVector(B,.5),Ce]}function ne(K,B,Z,F){let X=Math.PI/2,Y=I.angle()-X,le=[],oe=new H,re=new H;for(let me=0;me<=a;me++){let he=[],Ce=me/a;for(let Ae=0;Ae<=me;Ae++){let Ie=((me?Ae/me:0)-.5)*w,Me=Math.cos(Ie),De=Math.sin(Ie),Ve=Math.atan(Math.tan(Y)*Me),Ge=(X+Ve)*Ce,Qe=Math.cos(Ge),ot=Math.sin(Ge);oe.set(0,0,0),oe.addScaledVector(B,ot*Me),oe.addScaledVector(Z,Qe),oe.addScaledVector(F,ot*De),re.copy(K).addScaledVector(oe,s),l.push(re.x,re.y,re.z),u.push(oe.x,oe.y,oe.z),c.push(0,0),he.push(h++)}le.push(he)}let ue=le.length-1;for(let me=0;me<ue;me++){let he=le[me],Ce=le[me+1],Ae=he.length-1;o.push(he[0],Ce[1],Ce[0]);for(let Ie=1;Ie<=Ae;Ie++)o.push(he[Ie-1],he[Ie],Ce[Ie]),o.push(he[Ie],Ce[Ie+1],Ce[Ie])}}}},lB=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters),r=Object.assign(t?.ui??{enabledIndieCorners:!1},e.ui);return{shape:e.shape&&e.shape instanceof wn?e.shape:new wn,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)}),ui:r}}static build(e){let t=e.shape,{width:i,height:r,cornerRadius:n,cornerType:s,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}=e.parameters,u={x:i*.5,y:r*.5},c={x:-u.x,y:-u.y},h={x:u.x,y:u.y};function d(A,C,E){return C>i&&E>r?Math.min(A*i/C,A*r/E):C>i?A*i/C:E>r?A*r/E:A}let p=[];p[0]=n[0]===0?0:d(n[0],n[0]+n[3],n[0]+n[1]),p[1]=n[1]===0?0:d(n[1],n[1]+n[2],n[1]+n[0]),p[2]=n[2]===0?0:d(n[2],n[2]+n[1],n[2]+n[3]),p[3]=n[3]===0?0:d(n[3],n[3]+n[0],n[3]+n[2]);let m=c.x,v=h.x,g=h.y,w=c.y;t.addPoint(t.createPoint(m,g)),t.addPoint(t.createPoint(v,g)),t.addPoint(t.createPoint(v,w)),t.addPoint(t.createPoint(m,w)),t.isClosed=!0;let S=!0;for(let A=0,C=t.points.length;A<C;A++)t.points[A].roundness=p[A],A>0&&p[A]!==p[A-1]&&(S=!1);S&&(t.roundness=p[0]),t.useCubicForRoundedCorners=s!==1,t.update();let _=cv.create({shape:t,parameters:{depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}});return Object.assign(_,{userData:{...e,type:"RectangleGeometry"}})}},uPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180},e.parameters);return i.thetaLength=Ot.clamp(i.thetaLength,0,180),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t=100,height:i=t,depth:r=t,widthSegments:n=64,heightSegments:s=64,phiStart:a,phiLength:o,thetaStart:l,thetaLength:u}=e.parameters,c;return u===0?(c=new Kt,c.setAttribute("position",new kt([],3))):c=new jy(.5*t,n,s,a,o,l,u*Ot.DEG2RAD),c.scale(1,i/t,r/t),Object.assign(c,{userData:{...e,type:"SphereGeometry"}})}},cPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0,widthSegments:8,heightSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:0})}}static build(e){let{width:t=100,height:i=t,widthSegments:r=8,heightSegments:n=8}=e.parameters,s=new Zc(t,i,r,n);return s.scale(1,1,1),Object.assign(s,{userData:{...e,type:"PlaneGeometry"}})}},hPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,angle:90,cornerRadius:24,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,angle:n,cornerRadius:s,cornerSegments:a}=e.parameters,o=new dPe(t,i,r,n,s,a);return Object.assign(o,{userData:{...e,type:"BackdropGeometry"}})}},dPe=class extends Kt{constructor(e=1,t=1,i=1,r=90,n=10,s=24){super(),this.type="BackdropGeometry";let a=[],o=[],l=[],u=.001;n==0&&(s=1),s=Math.max(1,Math.floor(s)),n=Math.min(n,100),r=Math.min(180-u,r),r*=Math.PI/180;let c=[],h=Math.PI/2,d=(me=0,he=0,Ce=0)=>new H(me,he,Ce),p=d(),m=d(),[v,g,w]=[t/2,e/2,i/2],S=-g,_=+g,[A,C,E]=[d(S,-v,+w),d(S,-v,-w),d(S,+v,-w)],I=(me,he=!1)=>Math.sin(me-Math.PI/(1+ +he)),T=(me,he=!1)=>Math.cos(me-Math.PI/(1+ +he));E.y=Math.sin(r)*t-v;let D=Math.cos(r)*t-w,L=A.z-u;r<=h?(E.z=Math.min(D,L),E.z==L&&(E.y-=(D-L)/Math.tan(h-r))):C.z=Math.min(C.z-D-w,A.z-u),p.subVectors(A,C),m.subVectors(E,C);let z=Math.min(p.length(),m.length())*n/100,G=z*Math.tan(r/2),V=z/Math.cos(r/2),j=p.clone().normalize().add(m.normalize()).setLength(V).add(C);p.set(0,I(r,!0),T(r,!0)),c.push([E,p.clone()]);let J=(Math.PI-r)/s;for(let me=0;me<=s;me++){let he=h+r+me*J;p.set(0,Math.sin(he)*G,Math.cos(he)*G),p.add(j),m.set(0,I(he),T(he)),c.push([p.clone(),m.clone()])}c.push([A,d(0,1,0)]);let ne=Math.sin(J/2)*G*2,K=c.length-1,B=c[0][0].distanceTo(c[1][0]),Z=c[K-1][0].distanceTo(c[K][0]),F=B+ne*s+Z;c[0].push(1);for(let me=0;me<=s;me++)c[me+1].push(1-(B+me*ne)/F);c[K].push(0);let[X,Y,le]=c[0],oe,re,ue;for(let me=1;me<c.length;me++)[oe,re,ue]=c[me],a.push(S,X.y,X.z,S,oe.y,oe.z,_,X.y,X.z,_,X.y,X.z,S,oe.y,oe.z,_,oe.y,oe.z),o.push(0,Y.y,Y.z,0,re.y,re.z,0,Y.y,Y.z,0,Y.y,Y.z,0,re.y,re.z,0,re.y,re.z),l.push(0,le,0,ue,1,le,1,le,0,ue,1,ue),[X,Y,le]=[oe,re,ue];this.setAttribute("position",new kt(a,3)),this.setAttribute("normal",new kt(o,3)),this.setAttribute("uv",new kt(l,2))}},JY=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof wn?e.shape:new wn,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,innerRadiusPercent:r,spikes:n,cornerRadius:s,angle:a,depth:o,extrudeBevelSize:l,extrudeBevelSegments:u}=e.parameters,c=e.shape,h=t*.5,d=i*.5,p=0,m=0,v=a*Math.PI/360/n,g=Math.PI/2*3*-1,w=h*r/100,S=d*r/100;if(n===3&&r===50){v=2*Math.PI/n;for(let A=0;A<n;A++){let C=v*A,E=p+Math.sin(C)*h,I=m+Math.cos(C)*d;c.addPoint(c.createPoint(E,I))}}else for(let A=0;A<n;A++){let C=p+Math.cos(g)*h,E=m+Math.sin(g)*d;c.addPoint(c.createPoint(C,E)),g+=v,C=p+Math.cos(g)*w,E=m+Math.sin(g)*S,c.addPoint(c.createPoint(C,E)),g+=v}c.isClosed=!0;for(let A=0,C=c.points.length;A<C;A++)c.points[A].roundness=s;c.roundness=s,c.update();let _=cv.create({shape:c,parameters:{roundness:s,depth:o,extrudeBevelSize:l,extrudeBevelSegments:u}});return Object.assign(_,{userData:{...e,type:"StarGeometry"}})}},fPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i}=e.parameters,r=new Zc(t,i);return Object.assign(r,{userData:{...e,type:"TextFrameGeometry"}})}},pPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,radialSegments:32,tubularSegments:64,arc:360,cornerRadius:30,cornerSegments:8},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width);i.shapeBlendNode&&(n=r);let s=Math.round(Math.abs(i.depth??i.width*.25));return{parameters:Object.assign(i,{width:r,height:n,depth:s})}}static build(e){let{width:t,height:i,depth:r,radialSegments:n,tubularSegments:s,arc:a,cornerRadius:o,cornerSegments:l}=e.parameters,u=mPe(t,i,r,t*.5,a,s,0,0,n,o,l);return u.scale(1,i/t,1),Object.assign(u,{userData:{...e,type:"TorusGeometry"}})}};function mPe(e,t,i,r,n,s,a,o,l,u,c){[t,i]=[i,t],a=t/2;let h=Ot.clamp(n/360,0,1);if(h===0){let d=new Kt;return d.setAttribute("position",new kt([],3)),d}return h===1&&(u=0),new QY(!0,e,t,i,r,h,s,a,o,l,u,c)}var gPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width),tube:i.tube??i.width*.125})}}static build(e){let{width:t,tube:i,tubularSegments:r,radialSegments:n,p:s,q:a}=e.parameters,o=t*.5;o!==i&&(o-=i);let l=new Tq(o,i,r,n,s,a);return Object.assign(l,{userData:{...e,type:"TorusKnotGeometry"}})}},vPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},e.parameters);return{shape:e.shape&&e.shape instanceof wn?e.shape:new wn,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width*(i.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t=100,height:i,cornerRadius:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a,isRect:o}=e.parameters,l=e.shape,u=t*.5,c=i*.5;o?(l.addPoint(l.createPoint(-u,c)),l.addPoint(l.createPoint(u,-c)),l.addPoint(l.createPoint(-u,-c))):(l.addPoint(l.createPoint(0,c)),l.addPoint(l.createPoint(u,-c)),l.addPoint(l.createPoint(-u,-c))),l.isClosed=!0;for(let d=0,p=l.points.length;d<p;d++)l.points[d].roundness=r;l.roundness=r,l.update();let h=cv.create({shape:l,parameters:{roundness:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a}});return Object.assign(h,{userData:{...e,type:"TriangleGeometry"}})}};function yPe(e,t){let i=2*Math.PI;return(e%i+i)%i===(t%i+i)%i}function xPe(e){return/^(rgba)?\(\s*(\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(e.toLowerCase())}function wPe(e,t,i){let r,n,s,a=Math.floor(e*6),o=e*6-a,l=i*(1-t),u=i*(1-o*t),c=i*(1-(1-o)*t);switch(a%6){case 0:r=i,n=c,s=l;break;case 1:r=u,n=i,s=l;break;case 2:r=l,n=i,s=c;break;case 3:r=l,n=u,s=i;break;case 4:r=c,n=l,s=i;break;case 5:default:r=i,n=l,s=u;break}return{r:r*255,g:n*255,b:s*255}}function bPe(e,t,i){e/=255,t/=255,i/=255;let r=Math.max(e,t,i),n=Math.min(e,t,i),s=r,a=r-n,o=r==0?0:a/r,l;if(r==n)l=0;else{switch(r){case e:l=(t-i)/a+(t<i?6:0);break;case t:l=(i-e)/a+2;break;case i:default:l=(e-t)/a+4;break}l/=6}return{h:l,s:o,v:s}}function _Pe(e){return e=Math.floor(e),{r:e>>16&255,g:e>>8&255,b:e&255}}function SPe(e,t,i){return(e<<16)+(t<<8)+i}function MPe(e,t,i){return e=Math.round(e),t=Math.round(t),i=Math.round(i),"#"+[e,t,i].map(r=>r.toString(16).padStart(2,"0")).join("").toUpperCase()}function APe(e){let t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,(r,n,s,a)=>String(n+n+s+s+a+a));let i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null}var EPe={parseRgba:xPe,hsvToRgb:wPe,rgbToHsv:bPe,hexToRgb:_Pe,rgbToHex:SPe,rgbToHexString:MPe,hexStringToRgb:APe},CPe=class{add(e,t,i){if(typeof arguments[0]!="string")for(let r in arguments[0])this.add(r,arguments[0][r],arguments[1]);else(Array.isArray(e)?e:[e]).forEach(function(r){this[r]=this[r]||[],t&&this[r][i?"unshift":"push"](t)},this)}run(e,t){this[e]=this[e]||[],this[e].forEach(function(i){i.call(t&&t.context?t.context:t,t)})}},TPe=class{constructor(e){this.jsep=e,this.registered={}}register(...e){e.forEach(t=>{if(typeof t!="object"||!t.name||!t.init)throw new Error("Invalid JSEP plugin format");this.registered[t.name]||(t.init(this.jsep),this.registered[t.name]=t)})}},nt=class{static get version(){return"1.3.8"}static toString(){return"JavaScript Expression Parser (JSEP) v"+nt.version}static addUnaryOp(e){return nt.max_unop_len=Math.max(e.length,nt.max_unop_len),nt.unary_ops[e]=1,nt}static addBinaryOp(e,t,i){return nt.max_binop_len=Math.max(e.length,nt.max_binop_len),nt.binary_ops[e]=t,i?nt.right_associative.add(e):nt.right_associative.delete(e),nt}static addIdentifierChar(e){return nt.additional_identifier_chars.add(e),nt}static addLiteral(e,t){return nt.literals[e]=t,nt}static removeUnaryOp(e){return delete nt.unary_ops[e],e.length===nt.max_unop_len&&(nt.max_unop_len=nt.getMaxKeyLen(nt.unary_ops)),nt}static removeAllUnaryOps(){return nt.unary_ops={},nt.max_unop_len=0,nt}static removeIdentifierChar(e){return nt.additional_identifier_chars.delete(e),nt}static removeBinaryOp(e){return delete nt.binary_ops[e],e.length===nt.max_binop_len&&(nt.max_binop_len=nt.getMaxKeyLen(nt.binary_ops)),nt.right_associative.delete(e),nt}static removeAllBinaryOps(){return nt.binary_ops={},nt.max_binop_len=0,nt}static removeLiteral(e){return delete nt.literals[e],nt}static removeAllLiterals(){return nt.literals={},nt}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(e){this.expr=e,this.index=0}static parse(e){return new nt(e).parse()}static getMaxKeyLen(e){return Math.max(0,...Object.keys(e).map(t=>t.length))}static isDecimalDigit(e){return e>=48&&e<=57}static binaryPrecedence(e){return nt.binary_ops[e]||0}static isIdentifierStart(e){return e>=65&&e<=90||e>=97&&e<=122||e>=128&&!nt.binary_ops[String.fromCharCode(e)]||nt.additional_identifier_chars.has(String.fromCharCode(e))}static isIdentifierPart(e){return nt.isIdentifierStart(e)||nt.isDecimalDigit(e)}throwError(e){let t=new Error(e+" at character "+this.index);throw t.index=this.index,t.description=e,t}runHook(e,t){if(nt.hooks[e]){let i={context:this,node:t};return nt.hooks.run(e,i),i.node}return t}searchHook(e){if(nt.hooks[e]){let t={context:this};return nt.hooks[e].find(function(i){return i.call(t.context,t),t.node}),t.node}}gobbleSpaces(){let e=this.code;for(;e===nt.SPACE_CODE||e===nt.TAB_CODE||e===nt.LF_CODE||e===nt.CR_CODE;)e=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");let e=this.gobbleExpressions(),t=e.length===1?e[0]:{type:nt.COMPOUND,body:e};return this.runHook("after-all",t)}gobbleExpressions(e){let t=[],i,r;for(;this.index<this.expr.length;)if(i=this.code,i===nt.SEMCOL_CODE||i===nt.COMMA_CODE)this.index++;else if(r=this.gobbleExpression())t.push(r);else if(this.index<this.expr.length){if(i===e)break;this.throwError('Unexpected "'+this.char+'"')}return t}gobbleExpression(){let e=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",e)}gobbleBinaryOp(){this.gobbleSpaces();let e=this.expr.substr(this.index,nt.max_binop_len),t=e.length;for(;t>0;){if(nt.binary_ops.hasOwnProperty(e)&&(!nt.isIdentifierStart(this.code)||this.index+e.length<this.expr.length&&!nt.isIdentifierPart(this.expr.charCodeAt(this.index+e.length))))return this.index+=t,e;e=e.substr(0,--t)}return!1}gobbleBinaryExpression(){let e,t,i,r,n,s,a,o,l;if(s=this.gobbleToken(),!s||(t=this.gobbleBinaryOp(),!t))return s;for(n={value:t,prec:nt.binaryPrecedence(t),right_a:nt.right_associative.has(t)},a=this.gobbleToken(),a||this.throwError("Expected expression after "+t),r=[s,n,a];t=this.gobbleBinaryOp();){if(i=nt.binaryPrecedence(t),i===0){this.index-=t.length;break}n={value:t,prec:i,right_a:nt.right_associative.has(t)},l=t;let u=c=>n.right_a&&c.right_a?i>c.prec:i<=c.prec;for(;r.length>2&&u(r[r.length-2]);)a=r.pop(),t=r.pop().value,s=r.pop(),e={type:nt.BINARY_EXP,operator:t,left:s,right:a},r.push(e);e=this.gobbleToken(),e||this.throwError("Expected expression after "+l),r.push(n,e)}for(o=r.length-1,e=r[o];o>1;)e={type:nt.BINARY_EXP,operator:r[o-1].value,left:r[o-2],right:e},o-=2;return e}gobbleToken(){let e,t,i,r;if(this.gobbleSpaces(),r=this.searchHook("gobble-token"),r)return this.runHook("after-token",r);if(e=this.code,nt.isDecimalDigit(e)||e===nt.PERIOD_CODE)return this.gobbleNumericLiteral();if(e===nt.SQUOTE_CODE||e===nt.DQUOTE_CODE)r=this.gobbleStringLiteral();else if(e===nt.OBRACK_CODE)r=this.gobbleArray();else{for(t=this.expr.substr(this.index,nt.max_unop_len),i=t.length;i>0;){if(nt.unary_ops.hasOwnProperty(t)&&(!nt.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!nt.isIdentifierPart(this.expr.charCodeAt(this.index+t.length)))){this.index+=i;let n=this.gobbleToken();return n||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:nt.UNARY_EXP,operator:t,argument:n,prefix:!0})}t=t.substr(0,--i)}nt.isIdentifierStart(e)?(r=this.gobbleIdentifier(),nt.literals.hasOwnProperty(r.name)?r={type:nt.LITERAL,value:nt.literals[r.name],raw:r.name}:r.name===nt.this_str&&(r={type:nt.THIS_EXP})):e===nt.OPAREN_CODE&&(r=this.gobbleGroup())}return r?(r=this.gobbleTokenProperty(r),this.runHook("after-token",r)):this.runHook("after-token",!1)}gobbleTokenProperty(e){this.gobbleSpaces();let t=this.code;for(;t===nt.PERIOD_CODE||t===nt.OBRACK_CODE||t===nt.OPAREN_CODE||t===nt.QUMARK_CODE;){let i;if(t===nt.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==nt.PERIOD_CODE)break;i=!0,this.index+=2,this.gobbleSpaces(),t=this.code}this.index++,t===nt.OBRACK_CODE?(e={type:nt.MEMBER_EXP,computed:!0,object:e,property:this.gobbleExpression()},this.gobbleSpaces(),t=this.code,t!==nt.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):t===nt.OPAREN_CODE?e={type:nt.CALL_EXP,arguments:this.gobbleArguments(nt.CPAREN_CODE),callee:e}:(t===nt.PERIOD_CODE||i)&&(i&&this.index--,this.gobbleSpaces(),e={type:nt.MEMBER_EXP,computed:!1,object:e,property:this.gobbleIdentifier()}),i&&(e.optional=!0),this.gobbleSpaces(),t=this.code}return e}gobbleNumericLiteral(){let e="",t,i;for(;nt.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);if(this.code===nt.PERIOD_CODE)for(e+=this.expr.charAt(this.index++);nt.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);if(t=this.char,t==="e"||t==="E"){for(e+=this.expr.charAt(this.index++),t=this.char,(t==="+"||t==="-")&&(e+=this.expr.charAt(this.index++));nt.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);nt.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+e+this.char+")")}return i=this.code,nt.isIdentifierStart(i)?this.throwError("Variable names cannot start with a number ("+e+this.char+")"):(i===nt.PERIOD_CODE||e.length===1&&e.charCodeAt(0)===nt.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:nt.LITERAL,value:parseFloat(e),raw:e}}gobbleStringLiteral(){let e="",t=this.index,i=this.expr.charAt(this.index++),r=!1;for(;this.index<this.expr.length;){let n=this.expr.charAt(this.index++);if(n===i){r=!0;break}else if(n==="\\")switch(n=this.expr.charAt(this.index++),n){case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:e+=n}else e+=n}return r||this.throwError('Unclosed quote after "'+e+'"'),{type:nt.LITERAL,value:e,raw:this.expr.substring(t,this.index)}}gobbleIdentifier(){let e=this.code,t=this.index;for(nt.isIdentifierStart(e)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(e=this.code,nt.isIdentifierPart(e));)this.index++;return{type:nt.IDENTIFIER,name:this.expr.slice(t,this.index)}}gobbleArguments(e){let t=[],i=!1,r=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let n=this.code;if(n===e){i=!0,this.index++,e===nt.CPAREN_CODE&&r&&r>=t.length&&this.throwError("Unexpected token "+String.fromCharCode(e));break}else if(n===nt.COMMA_CODE){if(this.index++,r++,r!==t.length){if(e===nt.CPAREN_CODE)this.throwError("Unexpected token ,");else if(e===nt.CBRACK_CODE)for(let s=t.length;s<r;s++)t.push(null)}}else if(t.length!==r&&r!==0)this.throwError("Expected comma");else{let s=this.gobbleExpression();(!s||s.type===nt.COMPOUND)&&this.throwError("Expected comma"),t.push(s)}}return i||this.throwError("Expected "+String.fromCharCode(e)),t}gobbleGroup(){this.index++;let e=this.gobbleExpressions(nt.CPAREN_CODE);if(this.code===nt.CPAREN_CODE)return this.index++,e.length===1?e[0]:e.length?{type:nt.SEQUENCE_EXP,expressions:e}:!1;this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:nt.ARRAY_EXP,elements:this.gobbleArguments(nt.CBRACK_CODE)}}},PPe=new CPe;Object.assign(nt,{hooks:PPe,plugins:new TPe(nt),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},right_associative:new Set,additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"});nt.max_unop_len=nt.getMaxKeyLen(nt.unary_ops);nt.max_binop_len=nt.getMaxKeyLen(nt.binary_ops);var xx=e=>new nt(e).parse(),DPe=Object.getOwnPropertyNames(nt);DPe.forEach(e=>{xx[e]===void 0&&e!=="prototype"&&(xx[e]=nt[e])});xx.Jsep=nt;var RPe="ConditionalExpression",IPe={name:"ternary",init(e){e.hooks.add("after-expression",function(t){if(t.node&&this.code===e.QUMARK_CODE){this.index++;let i=t.node,r=this.gobbleExpression();if(r||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===e.COLON_CODE){this.index++;let n=this.gobbleExpression();if(n||this.throwError("Expected expression"),t.node={type:RPe,test:i,consequent:r,alternate:n},i.operator&&e.binary_ops[i.operator]<=.9){let s=i;for(;s.right.operator&&e.binary_ops[s.right.operator]<=.9;)s=s.right;t.node.test=s.right,s.right=t.node,t.node=i}}else this.throwError("Expected :")}})}};xx.plugins.register(IPe);function uT(e){return{all:e=e||new Map,on:function(t,i){var r=e.get(t);r?r.push(i):e.set(t,[i])},off:function(t,i){var r=e.get(t);r&&(i?r.splice(r.indexOf(i)>>>0,1):e.set(t,[]))},emit:function(t,i){var r=e.get(t);r&&r.slice().map(function(n){n(i)}),(r=e.get("*"))&&r.slice().map(function(n){n(t,i)})}}}var $Y=class{constructor(e,t,i){this.id=e,this.userAPI=t,this.result=void 0,this.error="null",this.isPrefetched=!1,this.isLoading=!1,this.isLoaded=!1,this.prefetchPromise=new Promise(r=>r()),this.emitter=uT(),this._innerCallUserAPI=async r=>{this.emitter.emit("start",{userAPIId:this.id}),this.isLoading=!0,this.isLoading=!1;try{this.result=await BPe(this.userAPI,r),this.error="null",this.emitter.emit("success",{userAPIId:this.id})}catch(n){let s=n.message?.split("_:_")?.[0]?.replace("status:","")??"null";this.error=s,this.result=null,this.emitter.emit("error",{userAPIId:this.id})}this.isLoading=!1,this.isPrefetched=!0,this.isLoaded=!0},t?.integration?.type==="OpenAI"?this.result={content:""}:t.method==="GET"&&t.url!==""&&(this.prefetchPromise=this.prefetch(i)),this._debouncedCallUserAPI=this._innerCallUserAPI,this._updateDebouncedCallUserAPI(),this._debouncedPrefetch=Zb(this.prefetch,1e3,{trailing:!0})}_updateDebouncedCallUserAPI(){this._debouncedCallUserAPI=this.userAPI.debounce!==void 0&&this.userAPI.debounce>0?Zb(this._innerCallUserAPI,this.userAPI.debounce,{leading:!0,trailing:!0}):this._innerCallUserAPI}async prefetch(e){await this.callUserAPI(e)}async callUserAPI(e){await this._debouncedCallUserAPI(e)}update(e,t,i=!0){this.userAPI=e,this._updateDebouncedCallUserAPI(),this.userAPI.url!==""&&this.userAPI.method==="GET"&&i&&this._debouncedPrefetch(t)}retrieveValue(e){if(this.result)try{return bs.zoom(this.result,e)}catch(t){console.error(t)}}retrieveZoomedKeyValues(e){if(this.result){let t=e&&e.length?bs.zoom(this.result,e):this.result;if(kPe(t))return Object.entries(t);if(zPe(t))return t.map((i,r)=>[r.toString(),i]);throw OPe(t)?new Error("This path points to a value, use retrieveValue() instead. "+e?.join(".")):new Error("Path error"+e?.join("."))}}dispose(){}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}get autostart(){return this.userAPI.autoStart}};function LPe(e){let t=new Headers;return e.headers.forEach(i=>{i.data.key!==""&&t.append(i.data.key,i.data.value)}),t}function OPe(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||e===null}function zPe(e){return Array.isArray(e)}function kPe(e){return typeof e=="object"&&e!==null}async function BPe(e,t,i=new AbortController){let r,n=e.url,s=e.proxy?.enabled??!1,a;if(e.integration?.type==="OpenAI"){let l=Gw(e.integration.prompt===""?[]:JSON.parse(e.integration.prompt),t),u=e.integration.behavior===""?[]:Gw(JSON.parse(e.integration.behavior),t);a=`{
		"model": "${e.integration.model}",
		"messages": [${e.integration.useBehavior?`
		{
			"role": "system",
			"content": "${u}"
		},`:""}
		{
			"role": "user",
			"content": "${l}"
		}
		]
	}`}if(s){n=`https://apis.spline.design/file/${e.proxy.fileId}/external-api/request?uuidexternalapi=${e.proxy.proxyId}`;let l;a!==void 0?l=a:e.method==="POST"&&e.body&&(l=Gw(JSON.parse(e.body),t)),l!==void 0&&(n+=`&data=${encodeURIComponent(l.replace(/(\r\n|\n|\r|\t)/gm,""))}`)}else e.integration?.type==="OpenAI"?r=a:e.method==="POST"&&e.body&&(r=Gw(JSON.parse(e.body),t));let o=await fetch(n,{method:s?"GET":e.method,headers:s?void 0:LPe(e),signal:i.signal,body:r});if(!o.ok)throw new Error("status:"+o.status+"_:_"+o.statusText);if(e.integration?.type==="OpenAI"){let l=await o.json();return s&&(l=l.response),{content:l.choices[0].message.content}}else{let l=await o.json();return s&&(l=l.response),l}}var eQ=(e,t)=>{if(typeof e=="string"){let i=t.getVariable(e);if(i)return eQ(i,t)}return va.isBoolean(e)?va.getDisplayedValue(e).toLowerCase():va.getDisplayedValue(e)},Gw=(e,t)=>e.map((i,r)=>{if("text"in i)return i.text;if("type"in i){if(i.type==="paragraph")return(r>0?`
`:"")+Gw(i.children,t);if(i.type==="variable"){let n=t.getVariable(i.variableId);if(n!==void 0)return eQ(n,t)}}return""}).join(""),NPe=["+","-","*","/","(",")","==","!=",">","<",">=","<=","and","or","!","%","^",","],FPe=["0","1","2","3","4","5","6","7","8","9","."],UPe=["sin","cos","tan","asin","acos","atan","atan2","sqrt","abs","log","exp","floor","ceil","round","min","max","random"];function VPe(e){return typeof e!="string"?!1:!isNaN(e)&&!isNaN(parseFloat(e))}xx.addBinaryOp("^",11,!0);function tQ(e,t,i="number"){let r="";for(let a=0;a<e.length;a++){let o=e[a];if("objType"in o&&o.objType==="api"){let l=JSON.parse(o.id),u=l[0],c=t.getUserAPI(u);if(c!==void 0&&c instanceof $Y){let h=c.retrieveValue(l.slice(1));h!==void 0&&(r+=h)}continue}if("objType"in o&&o.objType==="webhook"){let l=JSON.parse(o.id),[u,c]=l,h=t.getUserWebhook(u);if(h!==void 0){let d=h.getParameterValue(c);d!==void 0&&(r+=d)}continue}if("objType"in o&&o.objType==="aiAssistant"){let l=t.openAIRealtime;if("objId"in o&&o.objId!==void 0){let u;if(t.scene.data.objects.traverse((c,h)=>{let d=h.events?.find(p=>p.id===o.objId);d&&(u=d)}),u!==void 0&&u.data.type==="AIAssistantListener"){let c=l?.computeAnalysisForListenerEvent(u.data);if(c!==void 0){r+=c;continue}}}r+=l?.voice??0;continue}if("id"in o){let l=e[a-1];if(a>0&&"id"in l){console.error("Two variables in a row",e);return}let u=t.getVariable(o.id),c=va.getDisplayedValue(u);i==="number"&&va.isTextValue(u)&&Array.isArray(u.textValue)&&u.textValue.length===1?c=parseFloat(c).toString():i==="boolean"&&va.isBoolean(u)?c=u?"true":"false":i==="boolean"&&va.isTextValue(u)&&!Array.isArray(u.textValue)&&(c='"'+c+'"'),r+=c;continue}else if(i==="string"){o.name!=='"'&&(o.name!=="+"||o.escaped)&&(r+=o.name),o.name==="+"&&!o.escaped&&r[r.length-1]==="\\"&&(r=r.slice(0,-1)+o.name);continue}if(o.name==="and"){r+="&&";continue}if(o.name==="or"){r+="||";continue}if(o.name==="True"){r+="true";continue}if(o.name==="False"){r+="false";continue}if(i==="boolean"&&!VPe(o.name)&&!FPe.includes(o.name)&&!NPe.includes(o.name)&&!UPe.includes(o.name.replace(/\($/g,""))){r+='"'+o.name+'"';continue}r+=o.name}if(i==="string")return r;if(e.length===0){if(i==="number")return 0;if(i==="boolean")return!1}let n;try{n=xx(r)}catch(a){console.error(r,a);return}let s;try{s=nr(n)}catch(a){console.error(r,n,a)}return s}function nr(e){switch(e.type){case"BinaryExpression":switch(e.operator){case"==":return+(nr(e.left)===nr(e.right));case"!=":return+(nr(e.left)!==nr(e.right));case">":return+(nr(e.left)>nr(e.right));case">=":return+(nr(e.left)>=nr(e.right));case"<":return+(nr(e.left)<nr(e.right));case"<=":return+(nr(e.left)<=nr(e.right));case"+":return nr(e.left)+nr(e.right);case"-":return nr(e.left)-nr(e.right);case"*":return nr(e.left)*nr(e.right);case"/":return nr(e.left)/nr(e.right);case"%":return nr(e.left)%nr(e.right);case"&&":return nr(e.left)&&nr(e.right);case"||":return nr(e.left)||nr(e.right);case"^":return Math.pow(nr(e.left),nr(e.right));default:throw new Error("Unknown operator: "+e.operator)}case"UnaryExpression":switch(e.operator){case"-":return-nr(e.argument);case"!":return+!nr(e.argument);default:throw new Error("Unknown operator: "+e.operator)}case"Identifier":throw new Error("Unknown identifier: "+e.name);case"Literal":return e.value;case"CallExpression":if(e.callee.type==="Identifier"){if(e.callee.name==="random"){let t=0,i=1;if(e.arguments.length>=1)try{t=nr(e.arguments[0])}catch(r){console.warn(r)}if(e.arguments.length>=2)try{i=nr(e.arguments[1])}catch(r){console.warn(r)}return t=Math.min(i,t),i=Math.max(i,t),t+Math.random()*(i-t)}return Math[e.callee.name].apply(null,e.arguments.map(nr))}else throw new Error("Unknown node");default:throw new Error("Unknown node type: "+e.type)}}var jPe=new yt,HPe=new yt;function WPe(e,t,i){let r=[new H,new H,new H],n=[new H,new H,new H];return e.extractBasis(r[0],r[1],r[2]),t.extractBasis(n[0],n[1],n[2]),r.forEach((s,a)=>{let o=n[a],l=Ot.lerp(s.length(),o.length(),i);s.lerp(o,i).setLength(l)}),new yt().makeBasis(r[0],r[1],r[2])}var GPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,height:100,depth:1,subdivisions:12,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),a=t?.shapeData??oB.create({parameters:aY}).userData.shape;return{path:e.path??B2.defaultData(),parameters:Object.assign(i,{width:r,height:n,depth:s,extrusion:{...oY,...i.extrusion}}),shapeData:a}}static build(e){if(e.path.points.length>=2){let t=new qPe(e);return Object.assign(t,{userData:{...e,type:"PathGeometry"}})}else return Object.assign(new Kt,{userData:{...e,type:"PathGeometry"}})}},qPe=class extends Kt{constructor(e){super(),this.type="PathExtrusionGeometry",this.inputs=e,this.build()}_isGeometryClosed(){return this.inputs.path.isClosed&&this.inputs.parameters.extrusion.depth===1}_isOpenEnded(){let e=this.inputs.parameters.extrusion;return!(this.inputs.path.isClosed&&e.depth===1)||!yPe(e.twist,0)||e.startScale!==e.endScale}build(){let e=this._extractPathPoints();if(e.length<2)return;let t=this._computeBasisMatrices(e),{depth:i,offset:r}=this.inputs.parameters.extrusion;i=Math.max(0,Math.min(i,1)),r=Math.max(0,Math.min(r,1));let n=this.inputs.path.isClosed?e.length:e.length-1,s=Math.floor(r*n),a=this.inputs.path.isClosed?Math.ceil((i+r)*n):Math.ceil(Math.min(1,i+r)*n),o=Math.min(Math.max(2,a-s+1),n+2),l=[],u=[];for(let K=0;K<o;K++){let B=this.inputs.path.isClosed?(K+s)%e.length:Math.min(K+s,e.length-1);l.push(e[B].clone()),u.push(t[B].clone())}let c=(K,B,Z)=>{l[K]=l[K].clone().lerp(l[B],Z),u[K]=WPe(u[K],u[B],Z)},h=0,d=r*n%1;(!this.inputs.path.isClosed||i<=1)&&(d||r===0)&&(h=d,c(0,1,h));let p=0,m=(r+i)*n%1;if((this.inputs.path.isClosed&&i<=1||!this.inputs.path.isClosed&&r+i<1)&&m&&(p=m,c(l.length-1,l.length-2,1-p)),i===0){let K=l.length-1;l[K].copy(l[0]),u[K].copy(u[0])}this._applyPathModifiers(u,h,p);let{bevel:v,bevelSides:g}=this.inputs.parameters.extrusion,w=v>0?this.inputs.parameters.extrusion.capType:"flat",S=5;this.inputs.parameters.extrusion.shape.type==="Custom"&&(S=this.inputs.parameters.extrusion.shape.shapeQuality==="low"?5:12);let{regions:_,infos:A,vertices:C}=this._computeShapePoints(S),E=0,I;w==="round"&&(I=new aB(this.inputs.shapeData,2*v,v,S,g,void 0,!0),E=I.getAttribute("position").count);let T=0,D=0;A.sort((K,B)=>K.start-B.start),A.forEach(K=>{K.verticesStart=T,K.verticesCount=K.continuous.reduce((B,Z,F)=>B+(F===0||!Z?2:1),0),D+=K.verticesCount,T=D});let L=D*o,z,G=0;if(this._isOpenEnded()&&w==="flat"){try{z=mp({windingRule:Sr.ODD,elementType:is.POLYGONS,polySize:3,vertexSize:2,strict:!0,contours:_})}catch{z=jY}G=z.vertexCount}let V=L+2*G+E*2,j=L+2*G,J={positions:new Float32Array(V*3),normals:new Float32Array(V*3),uvs:new Float32Array(V*2)},ne=[];if(A.forEach(K=>{this._extrudeRegion(K,C,u,l,J,ne,this._isGeometryClosed()&&!this._isOpenEnded())}),z&&(this._closeEnd(z,L,ne,J,u[0],l[0],!1),this._closeEnd(z,L+G,ne,J,u[u.length-1],l[l.length-1],!0)),I){J.positions.set(I.getAttribute("position").array,j*3),J.normals.set(I.getAttribute("normal").array,j*3),J.uvs.set(I.getAttribute("uv").array,j*2);for(let F=j;F<j+E;F++)J.uvs[F*2+1]=1e-4;let K=ne.length;ne.push(...I.getIndex().array.map(F=>F+j)),j+=E,J.positions.set(I.getAttribute("position").array,j*3),J.normals.set(I.getAttribute("normal").array,j*3),J.uvs.set(I.getAttribute("uv").array,j*2);let B=ne.length;ne.push(...I.getIndex().array.map(F=>F+j)),this.setAttribute("position",new hi(J.positions,3)),this.setAttribute("normal",new hi(J.normals,3)),this.setAttribute("uv",new hi(J.uvs,2)),this.setIndex(ne);let Z=jPe;Z.copy(u[u.length-1]).setPosition(l[l.length-1]),this.applyMatrix4OnRange(Z,j,V),Z.copy(u[0]).setPosition(l[0]).multiply(HPe.makeScale(1,1,-1)),this.applyMatrix4OnRange(Z,j-E,j),this.reverseIndicesOnRange(K,B)}else this.setAttribute("position",new hi(J.positions,3)),this.setAttribute("normal",new hi(J.normals,3)),this.setAttribute("uv",new hi(J.uvs,2)),this.setIndex(ne)}_extractPathPoints(){let e=IY(this.inputs.path).getPoints(this.inputs.path.subdivisions);if(e.length<2)return[];let t=[e[0]];return e.forEach(i=>{t[t.length-1].distanceToSquared(i)>.001&&t.push(i)}),this.inputs.path.isClosed&&t[t.length-1].distanceTo(t[0])<.001&&t.pop(),t}_computeBasisMatrices(e){let t=[],i=e.length,r=this.inputs.path.isClosed,n=new H,s=new H,a=new H,o=new H,l=new H(0,1,0);for(let m=0;m<i;m++){let v=e[m],g;m===0?g=r?e[e.length-2]:v.clone().multiplyScalar(2).sub(e[1]):g=e[m-1];let w;m===i-1?w=r?e[1]:v.clone().multiplyScalar(2).sub(e[m-1]):w=e[m+1];let S=v.clone().sub(g).normalize(),_=w.clone().sub(v).normalize(),A=S.clone().add(_).normalize();a.copy(A),m===0&&(A.equals(l)||A.clone().negate().equals(l))&&l.set(0,0,1);let C=l.clone().cross(A).normalize(),E=A.clone().cross(C).normalize();l.copy(E),o.copy(C),m===0&&(n.copy(E),s.copy(A));let I=new yt().makeBasis(C,E,A);t.push(I)}let u=r?s:a,c=r?n:new H(0,1,0),h=u.clone().cross(o).normalize(),d=Math.acos(c.dot(h));if(isNaN(d))return t;let p=c.clone().cross(h);u.dot(p)>0&&(d*=-1);for(let m=1;m<t.length;m++){let v=new yt().makeRotationZ(d*m/t.length);t[m].multiply(v)}return t}_applyPathModifiers(e,t,i){let r=e.length,{angle:n,twist:s,startScale:a,endScale:o}=this.inputs.parameters.extrusion,l=new yt,u=new yt;return e.forEach((c,h)=>{let d=h===0?0:h===r-1?1:(h-t)/(r-(i===0?0:1)-(t+(1-i)));l.makeRotationZ(Ot.lerp(n,n+s,d)*Ot.DEG2RAD);let p=Ot.lerp(a,o,d);u.makeScale(p,p,p),c.multiply(l).multiply(u)}),e}_computeShapePoints(e=12,t=Sr.ODD){let i=this.inputs.shapeData,r=i.extractShapePointsToFlatArray([],e),n=i.shapeHoles.map(u=>{let c=u.extractShapePointsToFlatArray([],e),h=[];for(let d=c.length-1;d>=1;d-=2){let p=c[d-1],m=c[d-0];h.push(p,m)}return h}),s;try{s=mp({windingRule:t,elementType:is.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[r]})}catch{s=sB}let a;try{a=mp({windingRule:Sr.ODD,elementType:is.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...n]})}catch{a=VY}if(!s)throw new Error("error generating geometry");let o=s.elementCount;if(a){s.elementCount+=a.elementCount;for(let u=0;u<a.elements.length;u++){let c=a.elements[u],h=u%2===0?s.vertexCount:0;s.elements.push(c+h)}for(let u=0;u<a.vertexIndices.length;u++){let c=a.vertexIndices[u],h=s.vertexCount;s.vertexIndices.push(c+h)}for(let u=0;u<a.vertices.length;u++){let c=a.vertices[u];s.vertices.push(c)}}for(let u=0,c=s.vertexCount;u<c;u++){let h=u*2;s.vertices[h+0],s.vertices[h+1]}let l=[];for(let u=s.elementCount-1;u>=0;u--){let c=u>=o,h=u*2,d=s.elements[h+0],p=s.elements[h+1],m=d+p,v={start:d,count:p,normals:[],isHole:c,continuous:[],verticesStart:0,verticesCount:0};l.push(v);let g=d,w=m-1,S=d+1,_=i.roundedCurves.length;do{let A=g-d;s.vertices[w*2+0],s.vertices[w*2+1];let C=s.vertices[g*2+0],E=s.vertices[g*2+1],I=s.vertices[S*2+0],T=s.vertices[S*2+1],D=C-I,L=E-T,z=Math.sqrt(D*D+L*L);D/=z,L/=z,v.normals[A*2+0]=-L,v.normals[A*2+1]=D;let G=s.vertexIndices[g];if(Array.isArray(G))v.continuous[A]=!1;else{let[V,j]=i.getCurveIndexFromVertexId(G-1,!0);if(j>0&&j<1)v.continuous[A]=!0;else{let J=j===1?V+1:V-1;J=(J+_)%_;let ne=j===1?0:1,K=i.roundedCurves[V].getTangent(j),B=i.roundedCurves[J].getTangent(ne);v.continuous[A]=K.dot(B)>.95}}c&&(v.normals[A*2+0]*=-1,v.normals[A*2+1]*=-1),[w,g,S]=[g,S,S+1],S>=m&&(S-=p)}while(S!==d+1)}return{regions:[r,...n],infos:l,vertices:s.vertices}}_insertVertex(e,t,i,r,n){let s=t*2,a=t*3;e.positions[a+0]=i.x,e.positions[a+1]=i.y,e.positions[a+2]=i.z,e.normals[a+0]=r.x,e.normals[a+1]=r.y,e.normals[a+2]=r.z,e.uvs[s+0]=n.x,e.uvs[s+1]=n.y}_extrudeRegion(e,t,i,r,n,s,a){let o=new H,l=new H,u=new H,c=new H,h=new Pe;i.forEach((p,m)=>{let v=r[m],g=e.verticesStart*i.length+e.verticesCount*m;for(let w=0;w<e.count;w++){let S=(e.start+w)*2;if(o.set(t[S+0],t[S+1],0),u.copy(o).applyMatrix4(p).add(v),e.continuous[w])c.set(e.normals[w*2+0],e.normals[w*2+1],0);else{let _=w===0?(e.start+e.count-1)*2:S-2;l.set(t[_+0],t[_+1],0),c.copy(o).sub(l),c.set(-c.y,c.x,0),e.isHole||c.negate()}if(c.applyMatrix4(p).normalize(),h.set(w===0?1:w/e.count,m/(i.length-1)),this._insertVertex(n,g,u,c,h),g++,!e.continuous[w]||w===0){if(w===0)c.set(e.normals[w*2+0],e.normals[w*2+1],0),h.set(0,m/(i.length-1));else{let _=w===e.count-1?e.start*2:S+2;l.set(t[_+0],t[_+1],0),c.copy(l).sub(o),c.set(-c.y,c.x,0),e.isHole||c.negate()}c.applyMatrix4(p).normalize(),this._insertVertex(n,g,u,c,h),g++}}});let d=i.length-1;for(let p=0;p<d;p++){let m=e.verticesStart*i.length+e.verticesCount*p,v=e.verticesStart*i.length+e.verticesCount*(p+1),g=0;for(let w=0;w<e.count;w++){(!e.continuous[w]||w===0)&&g++;let S=w===e.count-1?0:g+1,_=m+g,A=m+S,C=v+S,E=v+g;e.isHole?s.push(_,C,A,_,E,C):s.push(_,A,C,_,C,E),g++}}}_closeEnd(e,t,i,r,n,s,a){let o=e.vertexCount,l=new H(0,0,a?-1:1).applyMatrix4(n),u=new H,c=new Pe;for(let d=0;d<o;d++){let p=2*d;u.set(e.vertices[p+0],e.vertices[p+1],0).applyMatrix4(n).add(s),this._insertVertex(r,t+d,u,l,c)}let h=e.elements;for(let d=0;d<e.elementCount;d++){let p=3*d,m=h[p+0]+t,v=h[p+(a?1:2)]+t,g=h[p+(a?2:1)]+t;i.push(m,v,g)}}applyMatrix4OnRange(e,t,i){let r=e.elements,n=new rs().getNormalMatrix(e).elements,s,a,o,l,u=this.attributes.position,c=this.attributes.normal;if(!u||!c)return;let h=u.array,d=c.array,p=u.itemSize;for(let m=t*p,v=i*p;m<v;m+=p){if(m===t)debugger;s=h[m+0],a=h[m+1],o=h[m+2],l=1/(r[3]*s+r[7]*a+r[11]*o+r[15]),h[m+0]=(r[0]*s+r[4]*a+r[8]*o+r[12])*l,h[m+1]=(r[1]*s+r[5]*a+r[9]*o+r[13])*l,h[m+2]=(r[2]*s+r[6]*a+r[10]*o+r[14])*l,s=d[m+0],a=d[m+1],o=d[m+2],d[m+0]=n[0]*s+n[3]*a+n[6]*o,d[m+1]=n[1]*s+n[4]*a+n[7]*o,d[m+2]=n[2]*s+n[5]*a+n[8]*o}u.needsUpdate=!0,c.needsUpdate=!0}reverseIndicesOnRange(e,t){let i=this.index;if(i){for(let r=e;r<t;r+=3){let n=i.getX(r),s=i.getX(r+1),a=i.getX(r+2);i.setXYZ(r,a,s,n)}i.needsUpdate=!0}}};function iQ(){let e=new Kt;return e.setAttribute("position",new hi(new Float32Array([]),3)),e.setIndex(new hi(new Uint16Array([]),1)),e}var XPe=iQ().attributes,YPe=12,QPe=1,XL=class extends Kt{constructor(e,t){super(),this.charWidths=[],this.charCoords=[],this.wrappedText=[],this.isLowResolution=!1,this.vectorShapes=[],Object.assign(this.attributes,XPe),this.userData={parameters:e,type:"TextGeometry"};let i=t.getFont(e.font);i?.isLoaded?(this.font=i,this.update(e,t)):this.updateFont(e.font,t).then(()=>{this.update(e,t),t?.requestRender()})}async updateFont(e,t){let i=t.getFont(e);i&&(this.font=i,await i.loadingPromise)}update(e,t){let i=this.font;if(this.userData={parameters:e,type:"TextGeometry"},!i?.isLoaded){console.warn("Cannot update text because its font is not loaded");return}let{width:r,height:n,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o,text:l,textTransform:u}=e,c=va.getDisplayedValue(l),h=u===2?c.toUpperCase():u===3?c.toLowerCase():c,d=KPe(e,i,h,t),{shapes:p,charWidths:m,charCoords:v}=i.generateShapes(d,e,t),g=(typeof r=="number"?r:Number(t.getVariable(r)))*.5,w=(typeof n=="number"?n:Number(t.getVariable(n)))*.5,S=p.map(C=>new wn().fromShape(C,!0));this.vectorShapes=S;let _=S.map(C=>cv.create({shape:C,parameters:{depth:s,extrudeBevelSegments:o,extrudeBevelSize:a,windingRule:s<=0?Sr.NONZERO:Sr.ODD,subdivisions:this.isLowResolution&&s>0?QPe:YPe}})),A=_.length?xg(_):iQ();A.translate(-g,w,0),this.dispose(),this.wrappedText=d,this.charCoords=v,this.charWidths=m,this.deleteAttribute("extrudeNormal"),Object.entries(A.attributes).forEach(([C,E])=>{this.setAttribute(C,E)}),this.setIndex(A.index),this.computeBoundingSphere()}clone(){let e=Go(new Kt,XL.prototype);return e.copy(this),console.log("CloneGeometry",this,e),e}copy(e){return Object.entries(e.attributes).forEach(([t,i])=>{this.setAttribute(t,i)}),this.setIndex(e.index),this.userData={parameters:{...e.userData.parameters},type:"TextGeometry"},this}async setText(e,t){this.font&&await this.font.loadingPromise,await this.update({...this.userData.parameters,text:{textValue:e}},t)}get text(){return this.userData.parameters.text??""}};function KPe(e,t,i,r){let n=typeof e.width=="string"?Number(r.getVariable(e.width)):e.width,s=[""],a="";for(let o of i)a+=o,o===" "||o===`
`?(s[s.length-1]+=a,a="",o===`
`&&s.push("")):t.getTextWidth(s[s.length-1]+a,e)>n&&(s[s.length-1].length&&s.push(""),t.getTextWidth(s[s.length-1]+a,e)>n&&(a.length===1?(s[s.length-1]+=a,a=""):(s[s.length-1]+=a.slice(0,-1),a=a[a.length-1],s.push(""))));return s[s.length-1]+=a,s}var rQ,nQ=new Promise(e=>{rQ=e}),vj=!1,jA;function ZPe(e){if(vj)return;if(jA)return jA;async function t(){let i=e??"https://unpkg.com/@splinetool/modelling-wasm@1.12.5/build",r=Vd(()=>import("./process-VPR0TfJD.js"),[]),[n,s]=await Promise.all([r,fetch(`${i}/process.wasm`).then(l=>l.arrayBuffer())]),a=n.default,o=await a({wasmBinary:s});rQ(o),vj=!0}return jA=t(),jA}var JPe=["font"];function wx(e,t,i,r){let n,s,a;e.type==="PathGeometry"?(s=JSON.parse(JSON.stringify(e)),a=[[],["extrusion"]]):(s={...e},a=[[]]);for(let u of a){let c=s;for(let h of u)c=c[h];for(n in c){let h=c[n];a6(h)&&!JPe.includes(n)&&(c[n]=t.getVariable(h,[r.uuid,"geometry",...u,n]),a6(c[n])&&(c[n]=1))}}let o={parameters:s,type:s.type};if(s.type==="PathGeometry")o.path=s.path;else if(s.type==="VectorGeometry"){let u=wn.createFromState(s.shape,s.width,s.height);o.shape=u}else if(s.type==="NonParametricGeometry"){if(s.data.groups&&s.data.groups?.forEach(u=>u.materialIndex=Math.max(u.materialIndex??0,0)),o.geometry=new zq().parse(s),o.geometry.groups.length===0){let u=o.geometry;u.addGroup(0,Math.max(u.getIndex()?.count??0,u.getAttribute("position").count),0)}}else if(s.type==="SubdivGeometry"){let u=new no(s,i);return u.data=e,u}else{if(s.type==="TextGeometry")return new XL(s,t);if(s.type==="InputGeometry")return new XL(s,t);if(s.type==="UIGeometry")return lB.create({parameters:{width:s.width,height:s.height,cornerRadius:s.cornerRadius,cornerType:s.cornerType}})}let l;try{l=_j(o)}catch(u){console.error(u),console.error(`Error generating geometry with inputs: ${o}`);let c=wn.createFromState(k2.defaultData(),100,100);o.shape=c,o.type="VectorGeometry",l=_j(o)}return l}var $Pe=new yt;function YL(e,t,i,r){let n=e.position.array,s=e.normal.array,a=$Pe.makeScale(t,i,r).invert().elements,o,l,u;for(var c=0,h=n.length;c<h;c+=3)n[c]*=t,n[c+1]*=i,n[c+2]*=r,o=s[c],l=s[c+1],u=s[c+2],s[c]=a[0]*o+a[4]*l+a[8]*u,s[c+1]=a[1]*o+a[5]*l+a[9]*u,s[c+2]=a[2]*o+a[6]*l+a[10]*u;e.position.needsUpdate=!0,e.normal.needsUpdate=!0}var HA=new Nn,$0=new H,di;nQ.then(e=>{di=e});var yj=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),xj=new Uint32Array([0,1,2,3]),wj=new Uint8Array([4]),no=class extends Kt{constructor(e,t){super(),this.data=e,this.flatShading=t,this.subdivPointer=0,this.rebuild(),this.freeSubdivPointer()}mutateDirectlyScaleBaked(e,t){this.freeSubdivPointer();let i=this.data.scaleBaked,r=Sp.div(t,i);if(r.every(a=>a===1))return;this.subdividedGeometry&&YL(this.subdividedGeometry.attributes,...r),this.originalGeometry&&YL(this.originalGeometry.attributes,...r),this.data=e;let n=this.userData.parameters;this.userData.parameters={width:n.width*r[0],height:n.height*r[1],depth:n.depth*r[2]},this.originalGeometry.boundingSphere.center.multiply($0.fromArray(r));let s=$0.set(n.width,n.height,n.depth).length();this.originalGeometry.boundingSphere.radius=s/2}ensureSubdivPointer(){return this.subdivPointer===0&&this.rebuild(),this.subdivPointer}rebuild(){let e,t,i;try{({originalGeometry:e,subdividedGeometry:t,subdivPointer:i}=no.build(this.data,void 0,!this.flatShading,void 0))}catch{e=new Wu(100,100,100),i=0}this.subdivPointer=i,this.originalGeometry=e,this.subdividedGeometry=t??void 0;let r=this.subdividedGeometry??this.originalGeometry;Object.assign(this,r),this.calcBoundingBox()}freeSubdivPointer(){this.subdivPointer&&(no.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0)}dispose(){super.dispose(),this.freeSubdivPointer()}calcBoundingBox(){let e=this.originalGeometry;e.boundingSphere===null&&(e.boundingSphere=new Wo,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,i=e.boundingSphere.center;HA.setFromBufferAttribute(t),HA.getCenter(i),e.boundingSphere.radius=i.distanceTo(HA.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),HA.getSize($0);let r={width:$0.x,height:$0.y,depth:$0.z};return this.userData.parameters=r,r}static build(e,t,i,r){let n,s,a,o=e?.phongAngle??35;i===!1&&(o=-1),t&&(di.free_bvh(t),di.free_subdivision_surface(t));try{n=no.allocate(e,r)}catch(l){console.error(l,e),n=no.allocate({positionWASM:yj,indexWASM:xj,verticesPerFaceWASM:wj},r)}if(di.set_destination_refinement_level(n,0),s=no.buildLevel(n,!0,o),e.subdivisions>0)try{di.set_destination_refinement_level(n,e.subdivisions),a=no.buildLevel(n,!1,o)}catch{try{di.set_destination_refinement_level(n,e.subdivisions-1),a=no.buildLevel(n,!1,o)}catch{a=null}}else a=null;return{subdivPointer:n,originalGeometry:s,subdividedGeometry:a}}static primitiveToQuads(e,t,i){e.widthSegments>16&&(e.widthSegments=16),e.heightSegments>16&&(e.heightSegments=16),e.depthSegments>16&&(e.depthSegments=16),e.radialSegments>16&&(e.radialSegments=16),e.type==="DodecahedronGeometry"&&(e.detail=0);let r=e.shape!==void 0||e.path!==void 0?t.geometry:wx(e,i,!1,t),n;e.type==="TorusGeometry"&&e.arc===Math.PI*2?n=r.getClosedTorusIndicesForBooleanOrSubdiv():n=r.getIndex();let s,a,o,l;({positions:s,triIndices:l}=cT(r.getAttribute("position"),n));let u;if(e.type==="CylinderGeometry"&&e.cornerRadius===0&&e.hollow===0&&e.openEnded===!1){let c=e.radialSegments*e.heightSegments*3*2,h=c+e.radialSegments*3;u=[c,h]}return{indices:a,verticesPerFace:o}=sQ(s,l,r,u),{positions:s,indices:a,verticesPerFace:o}}static allocate(e,t){let i,r,n,s=[],a=[];e.positionWASM&&e.positionWASM.length>0?(i=e.positionWASM,r=e.indexWASM,n=e.verticesPerFaceWASM):(i=yj,r=xj,n=wj);let o=i.length,l=r.length,u=n.length,c=i.length+s.length+a.length,h=r.length+n.length,d=c*Float32Array.BYTES_PER_ELEMENT+h*Uint32Array.BYTES_PER_ELEMENT,p=c*Float32Array.BYTES_PER_ELEMENT,m=di._malloc(d),v=new Float32Array(di.HEAPF32.buffer,m,c),g=new Uint32Array(di.HEAPU32.buffer,m+p,h);v.set(i,0),v.set(s,i.length),v.set(a,i.length+s.length),g.set(r,0),g.set(n,r.length);let w;e?.scaleBaked?.some(_=>_!==1)&&(w=new yt().makeScale(...e.scaleBaked)),t&&(w?w.premultiply(t):w=t);let S=w?di.alloc_subdivision_surface2(m,o,m+p,l,m+p+r.length*Uint32Array.BYTES_PER_ELEMENT,u,w.elements):di.alloc_subdivision_surface(m,o,m+p,l,m+p+r.length*Uint32Array.BYTES_PER_ELEMENT,u);return di._free(m),S}static buildLevel(e,t,i,r,n){let s=n?di.get_mesh_data2(e,t?di.Level.CONTROL:di.Level.REFINED,i,n.elements):di.get_mesh_data(e,t?di.Level.CONTROL:di.Level.REFINED,i),a=8,o=di.HEAPU32.subarray(s>>2,(s>>2)+a),l=o.subarray(4,8),u=0,c=di.HEAPU32[o[u]>>2],h=di.HEAPF32.subarray(c>>2,(c>>2)+l[u]);u++;let d=di.HEAPU32[o[u]>>2],p=di.HEAPF32.subarray(d>>2,(d>>2)+l[u]);u++;let m=di.HEAPU32[o[u]>>2],v=di.HEAPU32.subarray(m>>2,(m>>2)+l[u]);u++;let g=di.HEAPU32[o[u]>>2],w=di.HEAPU32.subarray(g>>2,(g>>2)+l[u]);if(u++,r===void 0){let S=new Kt;if(S.setIndex(new Vy(w,1)),S.setAttribute("position",new kt(h,3)),S.setAttribute("normal",new kt(p,3)),t){S.setAttribute("faceMap",new Vy(v,1));let _=new Float32Array(p.length/3*4).fill(0);S.setAttribute("color",new hi(_,4))}return di.free_mesh_data(s),S.userData.type="SubdivGeometry",S}r.getAttribute("position").copyArray(h),r.getAttribute("normal").copyArray(p),r.attributes.position.needsUpdate=!0,r.attributes.normal.needsUpdate=!0,di.free_mesh_data(s)}static freeSubdivPointer(e){di.free_bvh(e),di.free_subdivision_surface(e)}static buildControlCageWireframe(e,t,i){let r=di.get_wireframe_data_for_base_level(e),n=4,s=di.HEAPU32.subarray(r>>2,(r>>2)+n),a=s.subarray(2,4),o=0,l=di.HEAPU32[s[o]>>2],u=di.HEAPF32.subarray(l>>2,(l>>2)+a[o]);o++;let c=di.HEAPU32[s[o]>>2],h=di.HEAPU32.subarray(c>>2,(c>>2)+a[o]);if(t===void 0){let d=new Kt;d.setAttribute("position",new kt(u,3));let p=new Float32Array(u.length);for(let m=0,v=u.length;m<v;)p[m++]=i.r,p[m++]=i.g,p[m++]=i.b;return d.setAttribute("color",new hi(p,3)),d.setIndex(new Vy(h,1)),di.free_wireframe_data_for_base_level(r),d}t.getAttribute("position").copyArray(u),t.attributes.position.needsUpdate=!0,di.free_wireframe_data_for_base_level(r)}static updateCollabMesh(e,t,i){let r=t===0;r||di.set_destination_refinement_level(e,t);let n=i?di.get_topological_data2(e,r?di.Level.CONTROL:di.Level.REFINED,i.elements):di.get_topological_data(e,r?di.Level.CONTROL:di.Level.REFINED),s=6,a=di.HEAPU32.subarray(n>>2,(n>>2)+s),o=a.subarray(3,6),l=0,u=di.HEAPU32[a[l]>>2],c=new Float32Array(di.HEAPF32.subarray(u>>2,(u>>2)+o[l]));l++;let h=di.HEAPU32[a[l]>>2],d=new Uint32Array(di.HEAPU32.subarray(h>>2,(h>>2)+o[l]));l++;let p=di.HEAPU32[a[l]>>2],m=new Uint8Array(di.HEAPU32.subarray(p>>2,(p>>2)+o[l]));return di.free_topological_data(n),{positions:c,indices:d,verticesPerFace:m}}},bj=["getX","getY","getZ"];function cT(e,t){let i={},r=t?t.count:e.count,n=0,s=[],a=[],o=1e4;for(let u=0;u<r;u++){let c=t?t.getX(u):u,h="";for(let d=0;d<3;d++)h+=`${~~(e[bj[d]](c)*o)},`;if(h in i)s.push(i[h]);else{for(let d=0;d<3;d++)a.push(e[bj[d]](c));i[h]=n,s.push(n),n++}}let l=[];for(let u=0;u<s.length;u+=3)s[u]===s[u+1]||s[u]===s[u+2]||s[u+1]===s[u+2]||l.push(s[u],s[u+1],s[u+2]);return{positions:a,triIndices:l}}var WA=new H,yD=new H,xD=new H,wD=new H;function sQ(e,t,i,r){let n=[],s=[];if(i.userData.shape!==void 0&&i.userData.parameters.depth===0&&i.userData.shape.shapeHoles.length===0){let l=i.userData.shape.extractShapePointsToFlatArray([]),u=i.userData.parameters.spikes;if(i.userData.type==="EllipseGeometry"&&u<=24&&u%4===0&&i.userData.parameters.angle>=360){let d=l.length/2/u;l=l.filter((p,m)=>Math.floor(m/2)%d===0)}let c=0;for(let d=0;d<l.length;d+=2)c+=(l[d]-l[(d===0?l.length:d)-2])*(l[d+1]+l[(d===0?l.length:d)-1]);e.length=0;let h=0;if(c<0)for(let d=0;d<l.length;d+=2)e.push(l[d],l[d+1],0),n.push(h++);else for(let d=l.length-2;d>=0;d-=2)e.push(l[d],l[d+1],0),n.push(h++);return s.push(h),{indices:n,verticesPerFace:s}}let a=new Float32Array([i.userData.parameters.depth])[0],o=0;for(;o<t.length;){if(i.useNgonForTopBottomFaceDuringBake){let l=0;if((e[t[o]*3+2]===a||e[t[o]*3+2]===0)&&l++,(e[t[o+1]*3+2]===a||e[t[o+1]*3+2]===0)&&l++,(e[t[o+2]*3+2]===a||e[t[o+2]*3+2]===0)&&l++,l===3)break}if(t[o+1]===t[o+3]&&t[o+2]===t[o+5]||t[o+0]===t[o+3]&&t[o+2]===t[o+4]){WA.set(e[t[o]*3],e[t[o]*3+1],e[t[o]*3+2]),yD.set(e[t[o+1]*3],e[t[o+1]*3+1],e[t[o+1]*3+2]),xD.set(e[t[o+4]*3],e[t[o+4]*3+1],e[t[o+4]*3+2]),wD.set(e[t[o+5]*3],e[t[o+5]*3+1],e[t[o+5]*3+2]),yD.sub(WA).normalize(),xD.sub(WA).normalize(),wD.sub(WA).normalize();let l=yD.cross(xD).dot(wD);Math.abs(l)>.005||r&&r.some((u,c)=>c%2===1?!1:o>=r[c]&&o<r[c+1])?(n.push(t[o],t[o+1],t[o+2]),s.push(3),o+=3):(n.push(t[o],t[o+1],t[o+4],t[o+5]),s.push(4),o+=6)}else n.push(t[o],t[o+1],t[o+2]),s.push(3),o+=3}if(i.useNgonForTopBottomFaceDuringBake){let l=[],u=[],c=0;for(let h=0,d=0;h<e.length;h+=3,d++)e[h+2]===0&&(l.push(d),c++),e[h+2]===a&&u.push(d);if(i.userData.parameters.extrudeBevelSize===0){let h=u[0];u[0]=u[1],u[1]=h}l.reverse(),n.push(...l,...u),s.push(c,c)}return{indices:n,verticesPerFace:s}}var td={};che(td,{calcBoolean:()=>n3e,calcBooleanTopological:()=>r3e,freeMeshSet:()=>l3e,getMeshSet:()=>s3e,hasOpenEdges:()=>a3e,transformMeshSet:()=>o3e});var aQ,e3e=new Promise(e=>{aQ=e}),GA;function t3e(e){if(GA)return GA;async function t(){let i=e??"https://unpkg.com/@splinetool/boolean-wasm@1.12.5/build",r=Vd(()=>import("./boolean-DnW06Vcs.js"),[]),[n,s]=await Promise.all([r,fetch(`${i}/boolean.wasm`).then(l=>l.arrayBuffer())]),a=n.default,o=await a({wasmBinary:s});aQ(o)}return GA=t(),GA}var qi,Yy;e3e.then(e=>qi=e);function i3e(e,t,i){let r,n;e.userData.parameters.type==="TorusGeometry"&&e.userData.parameters.arc===Math.PI*2?n=e.getClosedTorusIndicesForBooleanOrSubdiv():n=e.getIndex();let{positions:s,triIndices:a}=cT(e.getAttribute("position"),n),o;if(t&&i){let{indices:l,verticesPerFace:u}=sQ(s,a,e);o=u.length,r=[];for(let c=0,h=0;c<o;c++){r.push(u[c]);for(let d=0;d<u[c];d++)r.push(l[h++])}}else{let l=a.length;r=Array(l+l/3),o=0;for(let u=0,c=0;c<r.length;)r[c++]=3,o++,r[c++]=a[u++],r[c++]=a[u++],r[c++]=a[u++]}return{positions:s,faceIndices:r,nFaces:o}}function oQ(e){let t=e.length,i=t*Uint32Array.BYTES_PER_ELEMENT,r=t*Float32Array.BYTES_PER_ELEMENT,n=Number.isInteger(e[0])?i:r,s=qi._malloc(n);return(Number.isInteger(e[0])?new Uint32Array(qi.HEAPU32.buffer,s,t):new Float32Array(qi.HEAPF32.buffer,s,t)).set(e,0),s}function lQ(e){switch(e){case 0:return qi.OP.UNION;case 1:return qi.OP.INTERSECTION;case 2:return qi.OP.A_MINUS_B;default:throw new Error("Unknown boolean operation "+e)}}function r3e(e,t){Yy===void 0&&(Yy=qi.init_csg());let i=oQ(e),r=qi.csg_calc_topological(Yy,i,e.length,lQ(t));qi._free(i);let n=6,s=qi.HEAPU32.subarray(r>>2,(r>>2)+n),a=s.subarray(3,6),o=0,l=qi.HEAPU32[s[o]>>2],u=new Float32Array(qi.HEAPF32.subarray(l>>2,(l>>2)+a[o]));o++;let c=qi.HEAPU32[s[o]>>2],h=new Uint32Array(qi.HEAPU32.subarray(c>>2,(c>>2)+a[o]));o++;let d=qi.HEAPU32[s[o]>>2],p=new Uint8Array(qi.HEAPU32.subarray(d>>2,(d>>2)+a[o]));return qi.free_mesh_data(r),{positions:u,indices:h,verticesPerFace:p}}function n3e(e,t,i,r){Yy===void 0&&(Yy=qi.init_csg());let n=oQ(e),s=qi.csg_calc(Yy,n,e.length,r,lQ(t));qi._free(n);let a=5,o=qi.HEAPU32.subarray(s>>2,(s>>2)+a),l=o.subarray(2,5),u=0,c=qi.HEAPU32[o[u]>>2],h=qi.HEAPF32.subarray(c>>2,(c>>2)+l[u]);u++;let d=qi.HEAPU32[o[u]>>2],p=qi.HEAPF32.subarray(d>>2,(d>>2)+l[u]);u++;let m=l[u];i.setAttribute("position",new kt(h,3)),i.setAttribute("normal",new kt(p,3));let v=qi.HEAPF32.subarray((s>>2)+5,(s>>2)+5+6);return i.boundingSphere===null&&(i.boundingSphere=new Wo),i.boundingSphere.center.set(v[0],v[1],v[2]),i.boundingSphere.radius=(v[3]**2+v[4]**2+v[5]**2)**.5,i.userData.parameters={width:v[3]*2,height:v[4]*2,depth:v[5]*2},qi.free_mesh_data(s),m}function s3e(e,t,i){if(qi===void 0)return-1;let r,n,s;if(t&&e.userData.positions!==void 0){let g=e.userData;s=g.verticesPerFace.length,r=g.positions,n=Array(g.verticesPerFace.reduce((w,S)=>w+S,0)+s);for(let w=0,S=0,_=0;w<g.verticesPerFace.length;w++){n[_++]=g.verticesPerFace[w];for(let A=0;A<g.verticesPerFace[w];A++)n[_++]=g.indices[S++]}}else({positions:r,faceIndices:n,nFaces:s}=i3e(e,t,i));let a=r.length,o=n.length,l=r.length,u=n.length,c=l*Float32Array.BYTES_PER_ELEMENT+u*Uint32Array.BYTES_PER_ELEMENT,h=l*Float32Array.BYTES_PER_ELEMENT,d=qi._malloc(c),p=new Float32Array(qi.HEAPF32.buffer,d,l),m=new Uint32Array(qi.HEAPU32.buffer,d+h,u);p.set(r,0),m.set(n,0);let v=qi.get_csg_mesh(d,a,d+h,o,s);return qi._free(d),v}function a3e(e){return qi.has_open_edges(e)}function o3e(e,t){qi.transform_csg_mesh(e,t.elements)}function l3e(e){qi.free_csg_mesh(e)}var u3e={ConeGeometry:hTe,CubeGeometry:dTe,CylinderGeometry:LY,DodecahedronGeometry:pTe,EllipseGeometry:oB,HelixGeometry:KTe,IcosahedronGeometry:ZTe,LatheGeometry:JTe,NonParametricGeometry:sPe,PolygonGeometry:ZY,PyramidGeometry:aPe,RectangleGeometry:lB,SphereGeometry:uPe,PlaneGeometry:cPe,BackdropGeometry:hPe,StarGeometry:JY,TextFrameGeometry:fPe,TorusGeometry:pPe,TorusKnotGeometry:gPe,TriangleGeometry:vPe,PathGeometry:GPe,VectorGeometry:cv},_j=e=>u3e[e.type].create(e);function ey(e){return e!==null&&"booleanOp"in e}var uQ=class extends tB(zr){constructor(){super(...arguments),this.booleanMeshSetAddress=-1,this.booleanWasTransformed=!1,this.booleanMatrixInvOld=new yt}updateVisible(e){super.updateVisible(e),this.visible=!ey(this.parent)&&this.visible,ey(this.parent)&&this.parent.invalidateDownstreamBooleanData()}freeBooleanPointer(){this.booleanMeshSetAddress!==-1&&(td.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(e=!1){return e?this.booleanWasTransformed=!0:this.freeBooleanPointer(),ey(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){this.freeBooleanPointer();for(let e of this.children)e instanceof uQ&&(e.freeBooleanPointer(),ey(e)&&e.invalidateUpstreamBooleanData())}updateTransformState(e,t){let i=super.updateTransformState(e,t);return i&&ey(this.parent)&&this.invalidateDownstreamBooleanData(!0),i}onVariableUpdate(e=!1){super.onVariableUpdate(e),ey(this.parent)&&this.invalidateDownstreamBooleanData(!0)}},qA=new Nn;function uB(e,t=0,i=e.count,r,n){let s=1/0,a=1/0,o=1/0,l=-1/0,u=-1/0,c=-1/0;for(let h=t;h<i;h++){let d=e.getX(h),p=e.getY(h),m=e.getZ(h);d<s&&(s=d),p<a&&(a=p),m<o&&(o=m),d>l&&(l=d),p>u&&(u=p),m>c&&(c=m)}qA.min.set(s,a,o),qA.max.set(l,u,c),qA.getCenter(r),qA.getSize(n).multiplyScalar(.5)}var c3e=new Kt,h3e=new Dd,xa=class extends uQ{constructor(e,t){super(c3e,h3e),this.super_Entity(e,t)}updateState(e,t){this.updateState_Entity(e,t)}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?uB(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},Jf=class{constructor(e){if(this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},Jf.uuidContext===null)throw new Error("plz startContext");Jf.uuidContext===Jf.globalContext?this.uuid="_gid"+Jf.uuidContext.nodeContextUuid++:this.uuid="_uid"+Jf.uuidContext.nodeContextUuid++,this.type=e,this.name=""}static startContext(e){this.uuidContext===null||this.uuidContext===Jf.globalContext?this.uuidContext=e:console.error("Can't start context twice")}static endContext(e){this.uuidContext!==e&&console.error("Can't end context twice"),this.uuidContext=null}analyze(e,t){t=t??{},e.analyzing=!0,this.build(e.addFlow(t.slot,t.cache,t.context),"v4"),e.clearVertexNodeCode(),e.clearFragmentNodeCode(),e.removeFlow(),e.analyzing=!1}analyzeAndFlow(e,t,i){return i=i??{},this.analyze(e,i),this.flow(e,t,i)}flow(e,t,i){i=i??{},e.addFlow(i.slot,i.cache,i.context);let r={result:this.build(e,t),code:e.clearNodeCode(),extra:e.context.extra};return e.removeFlow(),r}build(e,t,i){t=t??this.getType(e,t);let r=e.getNodeData(i??this);return e.analyzing&&this.appendDepsNode(e,r,t),e.nodes.indexOf(this)===-1&&e.nodes.push(this),this.updateFrame!==void 0&&e.updaters.indexOf(this)===-1&&e.updaters.push(this),this.generate(e,t,i)}updateFrame(e){}generateReadonly(e,t,i,r,n,s){return""}generate(e,t,i,r,n){return""}parse(e,t,i,r){}appendDepsNode(e,t,i){t.deps=(t.deps||0)+1;let r=e.getTypeLength(i);(r>(t.outputMax||0)||this.getType(e,i))&&(t.outputMax=r,t.output=i)}setName(e){this.name=e}getName(){return this.name}getType(e,t){return t==="sampler2D"||t==="samplerCube"?t:this.type}},xs=Jf;xs.globalContext={nodeContextUuid:0},xs.uuidContext=Jf.globalContext;var Sj=class{constructor(e){e=e??{},this.name=e.name,this.type=e.type,this.node=e.node,this.size=e.size,this.needsUpdate=e.needsUpdate}get value(){return this.node.value}set value(e){this.node.value=e}},d3e=class{constructor(){this.nodes={},this.keywords={}}add(e){this.nodes[e.name]=e}addKeyword(e,t,i){i=i!==void 0?i:!0,this.keywords[e]={callback:t,cache:i}}remove(e){delete this.nodes[e.name]}removeKeyword(e){delete this.keywords[e]}get(e){return this.nodes[e]}getKeyword(e,t){return this.keywords[e].callback(t)}getKeywordData(e){return this.keywords[e]}contains(e){return this.nodes[e]!==void 0}containsKeyword(e){return this.keywords[e]!==void 0}},No=new d3e,Mr=class extends xs{constructor(e,t){super(e),this.scope="",t=t??{},this.shared=t.shared!==void 0?t.shared:!0,this.unique=t.unique!==void 0?t.unique:!1}build(e,t,i,r){if(t=t??this.getType(e),this.getShared(e,t)){let n=this.getUnique(e,t);n&&this.uuid===void 0&&(this.uuid=Ot.generateUUID()),i=e.getUUID(i??this.getUUID(),!n);let s=e.getNodeData(i),a=s.output||this.getType(e);if(e.analyzing)return(s.deps||0)>0||this.getLabel()?(this.appendDepsNode(e,s,t),this.generate(e,t,i)):super.build(e,t,i);if(n)return s.name=s.name||super.build(e,t,i),s.name;if(!this.getLabel()&&(!this.getShared(e,a)||e.context.ignoreCache||s.deps===1))return super.build(e,t,i);i=this.getUUID(!1);let o=this.getTemp(e,i);if(o)return e.format(o,a,t);{o=super.generate(e,t,i,s.output,r);let l=this.generate(e,a,i);return e.addNodeCode(o+" = "+l+";"),e.format(o,a,t)}}return super.build(e,t,i)}getShared(e,t){return t!=="sampler2D"&&t!=="samplerCube"&&this.shared}getUnique(e,t){return this.unique}setLabel(e){return this.label=e,this}getLabel(){return this.label}getUUID(e){let t=this.uuid;return typeof this.scope=="string"&&(t=this.scope+"-"+t),t}getTemp(e,t){t=t||this.uuid;let i=e.getVars()[t];return i?i.name:void 0}generate(e,t,i,r,n){return this.getShared(e,t)||console.error("TempNode is not shared"),i=i??this.uuid,e.getTempVar(i,r??this.getType(e),n,this.getLabel()).name}},qo=class extends Mr{constructor(e,t){t=t??{},t.shared=t.shared!==void 0?t.shared:!1,super(e,t),this.readonly=!1}setReadonly(e){return this.readonly=e,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(e,t,i,r,n,s){i=e.getUUID(i??this.getUUID()),r=r??this.getType(e);let a=e.getNodeData(i);return this.getReadonly()&&this.generateReadonly!==void 0?this.generateReadonly(e,t,i,r,n,s):e.isShader("vertex")?(a.vertex||(a.vertex=e.createVertexUniform(r,this,n,s,this.getLabel())),e.format(a.vertex.name,r,t)):(a.fragment||(a.fragment=e.createFragmentUniform(r,this,n,s,this.getLabel())),e.format(a.fragment.name,r,t))}},ha=class extends qo{constructor(e=0,t){super("v2"),this.nodeType="Vector2",this.value=e instanceof Pe?e:new Pe(e,t)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}generateReadonly(e,t,i,r,n,s){return e.format("vec2("+this.value.x+", "+this.value.y+")",r,t)}},Ol=class extends qo{constructor(e=0,t,i){super("v3"),this.nodeType="Vector3",this.value=e instanceof H?e:new H(e,t,i)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}get z(){return this.value.z}set z(e){this.value.z=e}generateReadonly(e,t,i,r,n,s){return e.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",r,t)}},id=class extends qo{constructor(e){super("v4"),this.nodeType="Vector4",this.value=e instanceof Gs?e:new Gs(e.r,e.g,e.b,e.a)}generateReadonly(e,t,i,r,n,s){return e.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",r,t)}},f3e=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,Mj=/[a-z_0-9]+/gi,Lt=class extends Mr{constructor(e,t,i,r,n){super(n),this.src="",this.nodeType="Function",this.useKeywords=!0,this.includes=[],this.extensions={},this.keywords={},this.isMethod=n===void 0,this.isInterface=!1,this.parse(e,t,i,r)}getShared(e,t){return!this.isMethod}getType(e){return e.getTypeByFormat(this.type)}getInputByName(e){if(this.inputs){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}}getIncludeByName(e){if(this.includes){let t=this.includes.length;for(;t--;)if(this.includes[t].name===e)return this.includes[t]}}generate(e,t,i,r,n){let s,a=0,o=this.src;if(this.includes)for(let u=0;u<this.includes.length;u++)e.include(this.includes[u],this);for(let u in this.extensions)e.extensions[u]=!0;let l=[];for(;s=Mj.exec(this.src);)l.push(s);for(let u=0;u<l.length;u++){let c=l[u],h=c[0],d=this.isMethod?!this.getInputByName(h):!0,p=h;if(this.keywords[h]||this.useKeywords&&d&&No.containsKeyword(h)){let m=this.keywords[h];if(!m){let v=No.getKeywordData(h);v.cache&&(m=e.keywords[h]),m=m||No.getKeyword(h,e),v.cache&&(e.keywords[h]=m)}p=m.build(e)}h!==p&&o[c.index+a-1]!=="."&&(o=o.substring(0,c.index+a)+p+o.substring(c.index+h.length+a),a+=p.length-h.length),this.getIncludeByName(p)===void 0&&No.contains(p)&&e.include(No.get(p))}return t==="source"?o:this.isMethod?(this.isInterface||e.include(this,void 0,o),this.name):e.format("( "+o+" )",this.getType(e),t)}parse(e,t,i,r){if(this.src=e||"",this.includes=t??[],this.extensions=i??{},this.keywords=r??{},this.isMethod){let n=f3e.exec(this.src);if(this.inputs=[],n&&n.length==4){this.type=n[1],this.name=n[2];let s=n[3].match(Mj);if(s){let a=0;for(;a<s.length;){let o=s[a++],l;o==="in"||o==="out"||o==="inout"?l=s[a++]:(l=o,o="");let u=s[a++];this.inputs.push({name:u,type:l,qualifier:o})}}this.isInterface=this.src.indexOf("{")===-1}else this.type="",this.name=""}}},p3e=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,cQ=class extends Mr{constructor(e="",t){super(),this.src="",this.useDefine=!1,this.nodeType="Const",this.parse(e||cQ.PI,void 0,void 0,void 0,t)}getType(e){return e.getTypeByFormat(this.type)}parse(e,t,i,r,n){this.src=e||"";let s,a,o="",l=p3e.exec(e);this.useDefine=n??this.src.charAt(0)==="#",l&&l.length>1?(a=l[1],s=l[2],o=l[3]):(s=this.src,a="f"),this.name=s,this.type=a,this.value=o}build(e,t){if(t==="source"){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return e.include(this),e.format(this.name,this.getType(e),t)}generate(e,t,i,r,n){return e.format(this.name,this.getType(e),t)}},pr=cQ;pr.PI="PI",pr.PI2="PI2",pr.RECIPROCAL_PI="RECIPROCAL_PI",pr.RECIPROCAL_PI2="RECIPROCAL_PI2",pr.LOG2="LOG2",pr.EPSILON="EPSILON";var m3e=new RegExp(`^structs*([a-z_0-9]+)s*{s*((.|
)*?)}`,"gim"),g3e=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),hQ=class extends Mr{constructor(e=""){super(),this.inputs=[],this.src="",this.nodeType="Struct",this.parse(e)}getType(e){return e.getTypeByFormat(this.name)}getInputByName(e){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}generate(e,t,i,r,n){return t==="source"?this.src+";":e.format("( "+this.src+" )",this.getType(e),t)}parse(e=""){this.src=e,this.inputs=[];let t=m3e.exec(e);if(t){let i=t[2],r;for(;r=g3e.exec(i);)this.inputs.push({type:r[1],name:r[2]});this.name=t[1]}else this.name="";this.type=this.name}},cB=class extends Mr{constructor(e){super("v2",{shared:!1}),this.nodeType="UV",this.index=e??0}generate(e,t){e.requires.uv[this.index]=!0;let i=this.index>0?this.index+1:"",r=e.isShader("vertex")?"uv"+i:"vUv"+i;return e.format(r,this.getType(e),t)}};No.addKeyword("uv",function(){return new cB});No.addKeyword("uv2",function(){return new cB(1)});var yy=class extends Mr{constructor(e,t){super("v4"),this.nodeType="ColorSpace",this.input=e,this.method=t??yy.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(e){switch(e){case Hu:return["Linear"];case Ri:return["sRGB"];default:return[]}}generate(e,t){let i=this.input.build(e,"v4"),r=this.getType(e),n=yy.Nodes[this.method],s=e.include(n);if(s===yy.LINEAR_TO_LINEAR)return e.format(i,r,t);if(n.inputs?.length===2){let a=this.factor.build(e,"f");return e.format(s+"( "+i+", "+a+" )",r,t)}else return e.format(s+"( "+i+" )",r,t)}fromEncoding(e){let t=yy.getEncodingComponents(e);this.method="LinearTo"+t[0],this.factor=t[1]}fromDecoding(e){let t=yy.getEncodingComponents(e);this.method=t[0]+"ToLinear",this.factor=t[1]}},Vc=yy;Vc.Nodes={LinearToLinear:new Lt(["vec4 LinearToLinear( in vec4 value ) {","	return value;","}"].join(`
`)),sRGBToLinear:new Lt(["vec4 sRGBToLinear( in vec4 value ) {","	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join(`
`)),LinearTosRGB:new Lt(["vec4 LinearTosRGB( in vec4 value ) {","	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join(`
`))},Vc.LINEAR_TO_LINEAR="LinearToLinear",Vc.SRGB_TO_LINEAR="sRGBToLinear",Vc.LINEAR_TO_SRGB="LinearTosRGB";var Vr=class extends Lt{constructor(e="",t,i,r,n){super(e,n,r,i,t),this.nodeType="Expression"}},dd=class extends qo{constructor(e=new tn,t,i,r){super("v4",{shared:!0}),this.nodeType="Texture",this.value=e,this.uv=t??new cB,this.bias=i,this.project=r!==void 0?r:!1}getTexture(e,t){return super.generate(e,t,this.value.uuid,"t")}generate(e,t){if(t==="sampler2D")return this.getTexture(e,t);let i=this.getTexture(e,t),r=this.uv.build(e,this.project?"v4":"v2"),n=this.bias?this.bias.build(e,"f"):void 0;n===void 0&&e.context.bias&&(n=e.context.bias.setTexture(this).build(e,"f"));let s,a;this.project?s="texture2DProj":s=n?"tex2DBias":"tex2D",n?a=s+"( "+i+", "+r+", "+n+" )":a=s+"( "+i+", "+r+" )";let o={include:e.isShader("vertex"),ignoreCache:!0},l=this.getType(e);return e.addContext(o),this.colorSpace=this.colorSpace??new Vc(new Vr("",l)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(a),a=this.colorSpace.build(e,l),e.removeContext(),e.format(a,l,t)}},Ft=class extends qo{constructor(e){super("f"),this.nodeType="Float",this.value=e??0}generateReadonly(e,t,i,r,n,s){return e.format(this.value+(this.value%1?"":".0"),r,t)}},Aj=class extends Mr{constructor(e,t){super(),this.inputs=[],this.nodeType="FunctionCall",this.value=e,this.inputs=t??[]}getFunction(){return this.value}getType(e){return this.value.getType(e)}generate(e,t,i,r,n){r=this.getType(e);let s=this.value,a=s.build(e,t)+"( ",o=[];if(s.inputs){for(let l=0;l<s.inputs.length;l++){let u=s.inputs[l],c=this.inputs[l]||this.inputs[u.name];o.push(c.build(e,e.getTypeByFormat(u.type)))}a+=o.join(", ")+" )"}return e.format(a,r,t)}},dQ=class extends Mr{constructor(e,t,i=dQ.ADD){super(),this.nodeType="Operator",this.type=e.type,this.a=e,this.b=t,this.op=i}getType(e){let t=this.a.getType(e),i=this.b.getType(e);return e.isTypeMatrix(t)?"v4":e.getTypeLength(i)>e.getTypeLength(t)?i:t}generate(e,t){let i=this.getType(e);this.type=i;let r=this.a.build(e,i),n=this.b.build(e,i);return e.format("( "+r+" "+this.op+" "+n+" )",i,t)}},Lo=dQ;Lo.ADD="+",Lo.SUB="-",Lo.MUL="*",Lo.DIV="/";var wr=class extends Mr{constructor(e,t=wr.ABS,i,r){super(),this.nodeType="Math",this.a=e,typeof t!="string"?this.b=t:r=t,typeof i!="string"?this.c=i:r=i,this.method=r,this.hashProperties=["method"]}getNumInputs(e){switch(this.method){case wr.MIX:case wr.CLAMP:case wr.REFRACT:case wr.SMOOTHSTEP:case wr.FACEFORWARD:return 3;case wr.MIN:case wr.MAX:case wr.MOD:case wr.STEP:case wr.REFLECT:case wr.DISTANCE:case wr.DOT:case wr.CROSS:case wr.POW:return 2;default:return 1}}getInputType(e){let t=e.getTypeLength(this.a.getType(e)),i=this.b?e.getTypeLength(this.b.getType(e)):0,r=this.c?e.getTypeLength(this.c.getType(e)):0;return t>i&&t>r?this.a.getType(e):i>r?this.b.getType(e):this.c.getType(e)}getType(e){switch(this.method){case wr.LENGTH:case wr.DISTANCE:case wr.DOT:return"f";case wr.CROSS:return"v3"}return this.getInputType(e)}generate(e,t){let i,r,n,s=this.a?e.getTypeLength(this.a.getType(e)):0,a=this.b?e.getTypeLength(this.b.getType(e)):0,o=this.c?e.getTypeLength(this.c.getType(e)):0,l=this.getInputType(e),u=this.getType(e);switch(this.type=u,this.method){case wr.NEGATE:return e.format("( -"+this.a.build(e,l)+" )",l,t);case wr.INVERT:return e.format("( 1.0 - "+this.a.build(e,l)+" )",l,t);case wr.CROSS:i=this.a.build(e,"v3"),r=this.b.build(e,"v3");break;case wr.STEP:i=this.a.build(e,s===1?"f":l),r=this.b.build(e,l);break;case wr.MIN:case wr.MAX:case wr.MOD:i=this.a.build(e,l),r=this.b.build(e,a===1?"f":l);break;case wr.REFRACT:i=this.a.build(e,l),r=this.b.build(e,l),n=this.c.build(e,"f");break;case wr.MIX:i=this.a.build(e,l),r=this.b.build(e,l),n=this.c.build(e,o===1?"f":l);break;default:i=this.a.build(e,l),this.b&&(r=this.b.build(e,l)),this.c&&(n=this.c.build(e,l));break}let c=[];c.push(i),r&&c.push(r),n&&c.push(n);let h=this.getNumInputs(e);if(c.length!==h)throw Error(`Arguments not match used in "${this.method}". Require ${h}, currently ${c.length}.`);return e.format(this.method+"( "+c.join(", ")+" )",u,t)}},Pi=wr;Pi.RAD="radians",Pi.DEG="degrees",Pi.EXP="exp",Pi.EXP2="exp2",Pi.LOG="log",Pi.LOG2="log2",Pi.SQRT="sqrt",Pi.INV_SQRT="inversesqrt",Pi.FLOOR="floor",Pi.CEIL="ceil",Pi.NORMALIZE="normalize",Pi.FRACT="fract",Pi.SATURATE="saturate",Pi.SIN="sin",Pi.COS="cos",Pi.TAN="tan",Pi.ASIN="asin",Pi.ACOS="acos",Pi.ARCTAN="atan",Pi.ABS="abs",Pi.SIGN="sign",Pi.LENGTH="length",Pi.NEGATE="negate",Pi.INVERT="invert",Pi.MIN="min",Pi.MAX="max",Pi.MOD="mod",Pi.STEP="step",Pi.REFLECT="reflect",Pi.DISTANCE="distance",Pi.DOT="dot",Pi.CROSS="cross",Pi.POW="pow",Pi.MIX="mix",Pi.CLAMP="clamp",Pi.REFRACT="refract",Pi.SMOOTHSTEP="smoothstep",Pi.FACEFORWARD="faceforward";var qw=class extends Mr{constructor(e,t,i){super("v4"),this.nodeType="TextureCubeUV",this.value=e,this.uv=t,this.bias=i}bilinearCubeUV(e,t,i,r){let n=new Aj(qw.Nodes.bilinearCubeUV,[t,i,r]);this.colorSpaceTL=this.colorSpaceTL??new Vc(new Vr("","v4")),this.colorSpaceTL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(n.build(e)+".tl"),this.colorSpaceTR=this.colorSpaceTR??new Vc(new Vr("","v4")),this.colorSpaceTR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(n.build(e)+".tr"),this.colorSpaceBL=this.colorSpaceBL??new Vc(new Vr("","v4")),this.colorSpaceBL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(n.build(e)+".bl"),this.colorSpaceBR=this.colorSpaceBR??new Vc(new Vr("","v4")),this.colorSpaceBR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(n.build(e)+".br");let s={include:e.isShader("vertex"),ignoreCache:!0};e.addContext(s),this.colorSpaceTLExp=new Vr(this.colorSpaceTL.build(e,"v4"),"v4"),this.colorSpaceTRExp=new Vr(this.colorSpaceTR.build(e,"v4"),"v4"),this.colorSpaceBLExp=new Vr(this.colorSpaceBL.build(e,"v4"),"v4"),this.colorSpaceBRExp=new Vr(this.colorSpaceBR.build(e,"v4"),"v4"),e.removeContext();let a=new Vr("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return a.keywords.cubeUV_TL=this.colorSpaceTLExp,a.keywords.cubeUV_TR=this.colorSpaceTRExp,a.keywords.cubeUV_BL=this.colorSpaceBLExp,a.keywords.cubeUV_BR=this.colorSpaceBRExp,a.keywords.cubeUV=n,a}generate(e,t){if(e.isShader("fragment")){let i=this.uv,r=this.bias||e.context.roughness,n=new Aj(qw.Nodes.roughnessToMip,[r]),s=new Pi(n,qw.Nodes.m0,qw.Nodes.cubeUV_maxMipLevel,Pi.CLAMP),a=new Pi(s,Pi.FLOOR),o=new Pi(s,Pi.FRACT),l=this.bilinearCubeUV(e,this.value,i,a),u=this.bilinearCubeUV(e,this.value,i,new Lo(a,new Ft(1).setReadonly(!0),Lo.ADD)),c=new Pi(l,u,o,Pi.MIX);return e.format(c.build(e),"v4",t)}else return console.warn("TextureCubeUVNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)}},QL=qw;QL.Nodes=(function(){let e=new hQ(`struct TextureCubeUVData {
			vec4 tl;
			vec4 tr;
			vec4 br;
			vec4 bl;
			vec2 f;
		}`),t=new pr("float cubeUV_maxMipLevel 8.0",!0),i=new pr("float cubeUV_minMipLevel 4.0",!0),r=new pr("float cubeUV_maxTileSize 256.0",!0),n=new pr("float cubeUV_minTileSize 16.0",!0),s=new Lt(`float getFace(vec3 direction) {
				vec3 absDirection = abs(direction);
				float face = -1.0;
				if (absDirection.x > absDirection.z) {
					if (absDirection.x > absDirection.y)
						face = direction.x > 0.0 ? 0.0 : 3.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				} else {
					if (absDirection.z > absDirection.y)
						face = direction.z > 0.0 ? 2.0 : 5.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				}
				return face;
		}`);s.useKeywords=!1;let a=new Lt(`vec2 getUV(vec3 direction, float face) {
				vec2 uv;
				if (face == 0.0) {
					uv = vec2(direction.z, direction.y) / abs(direction.x); // pos x
				} else if (face == 1.0) {
					uv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y
				} else if (face == 2.0) {
					uv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z
				} else if (face == 3.0) {
					uv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x
				} else if (face == 4.0) {
					uv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y
				} else {
					uv = vec2(direction.x, direction.y) / abs(direction.z); // neg z
				}
				return 0.5 * (uv + 1.0);
		}`);a.useKeywords=!1;let o=new Lt(`TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
			float face = getFace(direction);
			float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
			mipInt = max(mipInt, cubeUV_minMipLevel);
			float faceSize = exp2(mipInt);
			float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
			vec2 uv = getUV(direction, face) * (faceSize - 1.0);
			vec2 f = fract(uv);
			uv += 0.5 - f;
			if (face > 2.0) {
				uv.y += faceSize;
				face -= 3.0;
			}
			uv.x += face * faceSize;
			if(mipInt < cubeUV_maxMipLevel){
				uv.y += 2.0 * cubeUV_maxTileSize;
			}
			uv.y += filterInt * 2.0 * cubeUV_minTileSize;
			uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
			uv *= texelSize;
			vec4 tl = texture2D(envMap, uv);
			uv.x += texelSize;
			vec4 tr = texture2D(envMap, uv);
			uv.y += texelSize;
			vec4 br = texture2D(envMap, uv);
			uv.x -= texelSize;
			vec4 bl = texture2D(envMap, uv);
			return TextureCubeUVData( tl, tr, br, bl, f );
		}`,[e,s,a,t,i,r,n]);o.useKeywords=!1;let l=new pr("float r0 1.0",!0),u=new pr("float v0 0.339",!0),c=new pr("float m0 -2.0",!0),h=new pr("float r1 0.8",!0),d=new pr("float v1 0.276",!0),p=new pr("float m1 -1.0",!0),m=new pr("float r4 0.4",!0),v=new pr("float v4 0.046",!0),g=new pr("float m4 2.0",!0),w=new pr("float r5 0.305",!0),S=new pr("float v5 0.016",!0),_=new pr("float m5 3.0",!0),A=new pr("float r6 0.21",!0),C=new pr("float v6 0.0038",!0),E=new pr("float m6 4.0",!0),I=[l,u,c,h,d,p,m,v,g,w,S,_,A,C,E],T=new Lt(`float roughnessToMip(float roughness) {
			float mip = 0.0;
			if (roughness >= r1) {
				mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
			} else if (roughness >= r4) {
				mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
			} else if (roughness >= r5) {
				mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
			} else if (roughness >= r6) {
				mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
			} else {
				mip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25
			}
			return mip;
		}`,I);return{bilinearCubeUV:o,roughnessToMip:T,m0:c,cubeUV_maxMipLevel:t}})();var xy=class extends Mr{constructor(e){super("v3"),this.nodeType="Normal",this.scope=e??xy.VIEW}getShared(){return this.scope===xy.WORLD}build(e,t,i,r){let n=e.context[this.scope+"Normal"];return n?n.build(e,t,i,r):super.build(e,t,i)}generate(e,t,i,r,n){let s;switch(this.scope){case xy.VIEW:e.isShader("vertex")?s="transformedNormal":s="geometryNormal";break;case xy.LOCAL:e.isShader("vertex")?s="objectNormal":(e.requires.normal=!0,s="vObjectNormal");break;case xy.WORLD:e.isShader("vertex")?s="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(e.requires.worldNormal=!0,s="vWNormal");break}return e.format(s,this.getType(e),t)}},Fo=xy;Fo.LOCAL="local",Fo.WORLD="world",Fo.VIEW="view",Fo.NORMAL="normal";No.addKeyword("viewNormal",function(){return new Fo(Fo.VIEW)});No.addKeyword("localNormal",function(){return new Fo(Fo.NORMAL)});No.addKeyword("worldNormal",function(){return new Fo(Fo.WORLD)});var $h=class extends Mr{constructor(e){super("v3"),this.nodeType="Position",this.scope=e??$h.LOCAL}getType(){switch(this.scope){case $h.PROJECTION:return"v4"}return this.type}getShader(){switch(this.scope){case $h.LOCAL:case $h.WORLD:return!1}return!0}generate(e,t,i,r,n){let s;switch(this.scope){case $h.LOCAL:e.isShader("vertex")?s="transformed":(e.requires.position=!0,s="vPosition");break;case $h.WORLD:if(e.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";e.requires.worldPosition=!0,s="vWPosition";break;case $h.VIEW:s=e.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case $h.PROJECTION:s=e.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )";break}return e.format(s,this.getType(),t)}},Bu=$h;Bu.LOCAL="local",Bu.WORLD="world",Bu.VIEW="view",Bu.PROJECTION="projection";No.addKeyword("position",function(){return new Bu});No.addKeyword("worldPosition",function(){return new Bu(Bu.WORLD)});No.addKeyword("viewPosition",function(){return new Bu(Bu.VIEW)});var Tc=class extends Mr{constructor(e){super("v3"),this.nodeType="Reflect",this.scope=e??Tc.CUBE}getUnique(e){return!e.context.viewNormal}getType(){switch(this.scope){case Tc.SPHERE:return"v2"}return this.type}generate(e,t){let i=this.getUnique(e);if(e.isShader("fragment")){let r;switch(this.scope){case Tc.VECTOR:{let n=new Fo(Fo.VIEW),s=e.context.roughness,a=n.build(e,"v3"),o=new Bu(Bu.VIEW).build(e,"v3"),l=s?s.build(e,"f"):void 0,u=`reflect( -normalize( ${o} ), ${a} )`;l&&(u=`normalize( mix( ${u}, ${a}, ${l} * ${l} ) )`);let c=`inverseTransformDirection( ${u}, viewMatrix )`;i?(e.addNodeCode(`vec3 reflectVec = ${c};`),r="reflectVec"):r=c;break}case Tc.CUBE:{let n=new Tc(Tc.VECTOR).build(e,"v3"),s="vec3( -"+n+".x, "+n+".yz )";i?(e.addNodeCode(`vec3 reflectCubeVec = ${s};`),r="reflectCubeVec"):r=s;break}case Tc.SPHERE:{let n="normalize( ( viewMatrix * vec4( "+new Tc(Tc.VECTOR).build(e,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";i?(e.addNodeCode(`vec2 reflectSphereVec = ${n};`),r="reflectSphereVec"):r=n;break}}return e.format(r,this.getType(),t)}else return console.warn("ReflectNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.type,t)}},Qy=Tc;Qy.CUBE="cube",Qy.SPHERE="sphere",Qy.VECTOR="vector";var v3e=class extends Mr{constructor(e=new dd,t,i){super("v4"),this.nodeType="TextureCube",this.value=e,this.radianceNode=new QL(this.value,t??new Qy(Qy.VECTOR),i),this.irradianceNode=new QL(this.value,new Fo(Fo.WORLD),new Ft(1).setReadonly(!0))}generate(e,t){return e.isShader("fragment")?(e.require("irradiance"),e.context.bias&&e.context.bias.setTexture(this.value),(e.slot==="irradiance"?this.irradianceNode:this.radianceNode).build(e,t)):(console.warn("TextureCubeNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t))}},y3e=class extends qo{constructor(e=new Kz,t,i){super("v4",{shared:!0}),this.nodeType="CubeTexture",this.value=e,this.uv=t??new Qy,this.bias=i}getTexture(e,t){return super.generate(e,t,this.value.uuid,"tc")}generate(e,t){if(t==="samplerCube")return this.getTexture(e,t);let i=this.getTexture(e,t),r=this.uv?.build(e,"v3"),n=this.bias?this.bias.build(e,"f"):void 0;n===void 0&&e.context.bias&&(n=e.context.bias.setTexture(this).build(e,"f"));let s;n?s="texCubeBias( "+i+", "+r+", "+n+" )":s="texCube( "+i+", "+r+" )";let a={include:e.isShader("vertex"),ignoreCache:!0},o=this.getType(e);return e.addContext(a),this.colorSpace=this.colorSpace??new Vc(new Vr("",o)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(s),s=this.colorSpace.build(e,o),e.removeContext(),e.format(s,o,t)}},x3e=`
uniform int frameIndex;
uniform vec2 resolution;
uniform mat4 previousModelViewMatrix;
uniform mat4 previousProjectionMatrix;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
`,w3e=`
layout(location = 1) out vec4 gVelocity;

uniform int frameIndex;
uniform vec2 resolution;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;

const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

vec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {
  const float goldenAngle = 2.399963f; // radians
  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));
  float theta = float(sampleIndex) * goldenAngle + angle;
  float sine = sin(theta);
  float cosine = cos(theta);
  return vec2(cosine, sine) * r;
}

// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso
float getNoiseInterleavedGradient(vec2 screenPos) {
    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);
    return fract(magic.z * fract(dot(screenPos, magic.xy)));
}

`,b3e=`
// TODO: This could be generated CPU side and passed to the shader every frame
const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

// TODO: Pass correct view size
vec2 offset = haltonSequence[frameIndex];
offset.x /= resolution.x;
offset.y /= resolution.y;

vec4 currentPosition = gl_Position;
vec4 currentPositionJittered = currentPosition + (vec4(offset.x, offset.y, 0.0, 0.0) * currentPosition.w);

// We want to calculate the velocity with unjittered positions
// so that things that are not moving get a velocity = 0
vCurrentPosition = currentPosition;
vPreviousPosition = previousProjectionMatrix * previousModelViewMatrix * vec4(transformed, 1.0);
#ifdef OUTLINE_COMPENSATION
vPreviousPosition.xy += OUTLINE_COMPENSATION;
#endif
gl_Position = currentPositionJittered;

`,_3e=`
vec2 oldPos = vPreviousPosition.xy;
    oldPos /= vPreviousPosition.w;
    oldPos.xy = (oldPos.xy+1.)/2.0;

vec2 newPos = vCurrentPosition.xy;
    newPos /= vCurrentPosition.w;
    newPos.xy = (newPos.xy+1.)/2.0;

vec2 velocity = (newPos - oldPos);

// Discard fully transparent pixels 
if (gl_FragColor.a <= 0.0) discard;

gVelocity = vec4(velocity, 0.0, 1.0);
`,S3e=`
layout(location = 1) out vec4 gVelocity;
`,M3e=`
    // Discard fully transparent pixels 
    if (gl_FragColor.a <= 0.0) discard;

    gVelocity = vec4(0.0, 0.0, 0.0, 1.0);
`,Ej=["x","y","z","w"],A3e=["float","vec2","vec3","vec4"],E3e={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},C3e={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},fQ=class{constructor(){this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.needsJitter=!0,this.getIncludesCode=(function(){function e(t,i){return t.deps.length-i.deps.length}return function(t,i){let r=this.getIncludes(t,i);if(!r)return"";let n="";r=r.sort(e);for(let s=0;s<r.length;s++)r[s].src&&(n+=r[s].src+`
`);return n}})(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCube(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif",`
			// NOTE: Include Spline's blending modes. This could be part of BlendNode
			#define SPE_BLENDING_NORMAL 0
			#define SPE_BLENDING_MULTIPLY 1
			#define SPE_BLENDING_SCREEN 2
			#define SPE_BLENDING_OVERLAY 3

			vec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, b, alpha );
			}

			vec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, a * b, alpha );
			}

			vec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );
				return mix( a, tmp, alpha );
			}

			vec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );
				return clamp( mix( a, tmp, alpha ), 0.0, 1.0 );
			}

			vec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {
				if ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );
				return vec3( 1.0 );
			}
			`,"#include <packing>","#include <common>"].join(`
`),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join(`
`),fragment:["float accumAlpha = 0.0;",`void accumulateAlpha(float alpha) {
					accumAlpha += (1.0 - accumAlpha) * alpha;
				}`,""].join(`
`)},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(e,t){this.addVertexParsCode(x3e),this.addFragmentParsCode(w3e),this.buildShader("vertex",e),this.buildShader("fragment",t);for(let i=0;i<this.requires.uv.length;i++)if(this.requires.uv[i]){let r=i>0?i+1:"";this.addVaryCode("varying vec2 vUv"+r+";"),i>0&&this.addVertexParsCode("attribute vec2 uv"+r+";"),this.addVertexFinalCode("vUv"+r+" = uv"+r+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode(`
				#ifndef SHAPEBLEND 
					vObjectNormal = normal;
				#else
					vObjectNormal = objectNormal;
				#endif
			`)),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this.needsJitter&&(this.addVertexFinalCode(b3e),this.addFragmentFinalCode(_3e)),this}buildShader(e,t){this.resultCode[e]=t.build(this.setShader(e),"v4")}setMaterial(e,t){return this.defines={},this}addFlow(e,t,i){return this.addSlot(e).addCache(t).addContext(i)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(e){return this.cache=e??"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(e){return this.context=Object.assign({},this.context,e),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(e){return this.slot=e||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(e,t){this.fragmentVariables[e]===void 0&&(this.addFragmentCode(`${t} ${e};`),this.fragmentVariables[e]="")}addFragmentParsVariable(e,t){this.fragmentParsVariables[e]===void 0&&(this.addFragmentParsCode(`${t} ${e};`),this.fragmentParsVariables[e]="")}addVertexParsVariable(e,t){this.vertexParsVariables[e]===void 0&&(this.addVertexParsCode(`${t} ${e};`),this.vertexParsVariables[e]="")}addVertexCode(e){this.addCode(e,"vertex")}addFragmentCode(e){this.addCode(e,"fragment")}addCode(e,t){this.code[t??this.shader]+=e+`
`}addVertexNodeCode(e){this.addNodeCode(e,"vertex")}addFragmentNodeCode(e){this.addNodeCode(e,"fragment")}addNodeCode(e,t){this.nodeCode[t??this.shader]+=e+`
`}clearNodeCode(e){e=e??this.shader;let t=this.nodeCode[e];return this.nodeCode[e]="",t}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(e){this.addFinalCode(e,"vertex")}addFragmentFinalCode(e){this.addFinalCode(e,"fragment")}addFinalCode(e,t){this.finalCode[t??this.shader]+=e+`
`}addVertexParsCode(e){this.addParsCode(e,"vertex")}addFragmentParsCode(e){this.addParsCode(e,"fragment")}addParsCode(e,t){this.parsCode[t??this.shader]+=e+`
`}addVaryCode(e){this.addVertexParsCode(e),this.addFragmentParsCode(e)}isCache(e){return this.caches.indexOf(e)!==-1}isSlot(e){return this.slots.indexOf(e)!==-1}define(e,t){this.defines[e]=t===void 0?1:t}require(e){this.requires[e]=!0}isDefined(e){return this.defines[e]!==void 0}getVar(e,t,i,r="varying",n="V",s=""){let a=this.getVars(r),o=a[e];if(!o){let l=a.length;o={name:i||"node"+n+l+(s?"_"+s:""),type:t},a.push(o),a[e]=o}return o}getTempVar(e,t,i,r){return this.getVar(e,t,i,this.shader,"T",r)}getAttribute(e,t){if(!this.attributes[e]){let i=this.getVar(e,t);this.addVertexParsCode("attribute "+t+" "+e+";"),this.addVertexFinalCode(i.name+" = "+e+";"),this.attributes[e]={varying:i,name:e,type:t}}return this.attributes[e]}getCode(e){return[this.prefixCode,this.parsCode[e],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[e],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[e],"uniform"),this.getIncludesCode("consts",e),this.getIncludesCode("structs",e),this.getIncludesCode("functions",e),"void main() {",this.getVarListCode(this.getVars(e)),this.code[e],this.resultCode[e],this.finalCode[e],"}"].join(`
`)}getVarListCode(e,t){t=t??"";let i="";for(let r=0,n=e.length;r<n;++r){let s=e[r],a=s.type,o=s.name,l=s.size,u=this.getFormatByType(a);if(u===void 0)throw new Error("Node pars "+u+" not found.");u.includes("[]")?i+=t+" "+u.substring(0,u.length-2)+" "+o+`[${l}];
`:i+=t+" "+u+" "+o+`;
`}return i}getVars(e){return this.inputs.vars[e??this.shader]}getNodeData(e){let t=e instanceof xs?e.uuid:e;return this.nodeData[t]=this.nodeData[t]||{}}createUniform(e,t,i,r,n,s){if(t.includes("[]")){let a=this.inputs.arrayUniforms,o=a.list.length,l=new Sj({type:t,size:i.size,name:r||"nodeUA"+o+(s?"_"+s:""),node:i,needsUpdate:n});return a.list.push(l),a[e].push(l),a[e][l.name]=l,this.uniforms[l.name]=l,l}else{let a=this.inputs.uniforms,o=a.list.length,l=new Sj({type:t,name:r||"nodeU"+o+(s?"_"+s:""),node:i,needsUpdate:n});return a.list.push(l),a[e].push(l),a[e][l.name]=l,this.uniforms[l.name]=l,l}}createVertexUniform(e,t,i,r,n){return this.createUniform("vertex",e,t,i,r,n)}createFragmentUniform(e,t,i,r,n){return this.createUniform("fragment",e,t,i,r,n)}include(e,t,i){let r;if(e=typeof e=="string"?No.get(e):e,this.context.include===!1)return e.name;e instanceof Lt?r=this.includes.functions:e instanceof pr?r=this.includes.consts:e instanceof hQ&&(r=this.includes.structs);let n=r[this.shader]=r[this.shader]||[];if(e){let s=n[e.name];if(s||(s=n[e.name]={node:e,deps:[]},n.push(s),s.src=e.build(this,"source")),e instanceof Lt&&t&&n[t.name]&&n[t.name].deps.indexOf(e)===-1&&(n[t.name].deps.push(e),e.includes?.length)){let a=0;do this.include(e.includes[a++],t);while(a<e.includes.length)}return i&&(s.src=i),e.name}else throw new Error("Include not found.")}colorToVectorProperties(e){return e.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(e){return e.replace(/c/g,"v3")}getIncludes(e,t){return this.includes[e][t||this.shader]}getConstructorFromLength(e){return A3e[e-1]}isTypeMatrix(e){return/^m/.test(e)}getTypeLength(e){return e==="f"?1:parseInt(this.colorToVector(e).substr(1))}getTypeFromLength(e){return e===1?"f":"v"+e}findNode(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(i?.isNode)return i}}resolve(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(i!==void 0){if(i.isNode)return i;if(i.isTexture)switch(i.mapping){case Hg:case Wg:return new y3e(i);case F_:return new v3e(new dd(i));default:return new dd(i)}else{if(i.isVector2)return new ha(i);if(i.isVector3)return new Ol(i);if(i.isVector4)return new id(i)}}}}format(e,t,i){switch(this.colorToVector(i+" <- "+t)){case"f <- v2":return e+".x";case"f <- v3":return e+".x";case"f <- v4":return e+".x";case"f <- i":case"f <- b":return"float( "+e+" )";case"v2 <- f":return"vec2( "+e+" )";case"v2 <- v3":return e+".xy";case"v2 <- v4":return e+".xy";case"v2 <- i":case"v2 <- b":return"vec2( float( "+e+" ) )";case"v3 <- f":return"vec3( "+e+" )";case"v3 <- v2":return"vec3( "+e+", 0.0 )";case"v3 <- v4":return e+".xyz";case"v3 <- i":case"v3 <- b":return"vec2( float( "+e+" ) )";case"v4 <- f":return"vec4( "+e+" )";case"v4 <- v2":return"vec4( "+e+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+e+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+e+" ) )";case"i <- f":case"i <- b":return"int( "+e+" )";case"i <- v2":return"int( "+e+".x )";case"i <- v3":return"int( "+e+".x )";case"i <- v4":return"int( "+e+".x )";case"b <- f":return"( "+e+" != 0.0 )";case"b <- v2":return"( "+e+" != vec2( 0.0 ) )";case"b <- v3":return"( "+e+" != vec3( 0.0 ) )";case"b <- v4":return"( "+e+" != vec4( 0.0 ) )";case"b <- i":return"( "+e+" != 0 )"}return e}getTypeByFormat(e){return E3e[e]||e}getFormatByType(e){return C3e[e]||e}getUUID(e,t){return t=t!==void 0?t:!0,t&&this.cache&&(e=this.cache+"-"+e),e}getElementByIndex(e){return Ej[e]}getIndexByElement(e){return Ej.indexOf(e)}isShader(e){return this.shader===e}setShader(e){return this.shader=e,this}mergeDefines(e){for(let t in e)this.defines[t]=e[t];return this.defines}mergeUniform(e){for(let t in e)this.uniforms[t]=e[t];return this.uniforms}getTextureEncodingFromMap(e){let t;return e?e.isTexture&&(t=e.encoding):t=Hu,t===Hu&&this.context.gamma&&(t=Ri),t}},bn=class extends qo{constructor(e=0,t,i,r){super("c"),this.nodeType="Color",this.value=e instanceof Gs?e:new Gs(e||0,t,i,r)}setRGBA(e){this.value.setRGBA(e.r,e.g,e.b,e.a)}generate(e,t,i,r,n,s){i=e.getUUID(i??this.getUUID()),r=r??this.getType(e);let a=e.getNodeData(i),o=this.getReadonly()&&this.generateReadonly!==void 0;if(this.alpha){let l=this.alpha.build(e,"f");e.addFragmentNodeCode(`accumAlpha += ( 1.0 - accumAlpha ) * ${l};`)}return o?this.generateReadonly(e,t,i,r,n,s):e.isShader("vertex")?(a.vertex||(a.vertex=e.createVertexUniform(r,this,n,s,this.getLabel())),e.format(a.vertex.name,r,t)):(a.fragment||(a.fragment=e.createFragmentUniform(r,this,n,s,this.getLabel())),e.format(a.fragment.name,r,t))}generateReadonly(e,t,i,r,n,s){return e.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",r,t)}},Pr=class extends qo{constructor(e){super("i"),this.nodeType="Int",this.value=Math.floor(e??0)}generateReadonly(e,t,i,r,n,s){return e.format(this.value.toString(),r,t)}},za=class extends qo{constructor(e){super("b"),this.nodeType="Bool",this.value=e??!1}generateReadonly(e,t,i,r){return e.format(this.value?"true":"false",r,t)}},Zm=class extends qo{constructor(e=1,t){super("f[]"),this.nodeType="FloatArray",this.size=e,this.value=Array.isArray(t)?t:typeof t=="number"?new Array(e).fill(t):new Array(e).fill(0)}},hB=class extends qo{},T3e=class extends hB{constructor(e){super("v3"),this.image=e,this._value=new H}get value(){return this._value.x=this.image.isVideo?this.image.img.videoWidth??0:this.image.img.width,this._value.y=this.image.isVideo?this.image.img.videoHeight??0:this.image.img.height,this._value}},KL=class extends hB{constructor(e,t,i=1008,r=1006){super("t"),this.image=e,this.wrap=t,this.minFilter=i,this.magFilter=r}get value(){return this.image.getTexture(this.wrap,this.minFilter,this.magFilter)}},pQ=class extends qo{constructor(e){super("m3"),this.nodeType="Matrix3",this.value=e??new rs}generateReadonly(e,t,i,r,n,s){return e.format("mat3("+this.value.elements.join(", ")+")",r,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}},eh=class extends qo{constructor(e){super("m4"),this.nodeType="Matrix4",this.value=e??new yt}generateReadonly(e,t,i,r,n,s){return e.format("mat4("+this.value.elements.join(", ")+")",r,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}};function Cj(e,t,i,r=0){e.setUvTransform(i[0],i[1],t[0],t[1],0,0,0).premultiply(new rs().makeRotation(r*Ot.DEG2RAD))}var P3e=class extends pQ{constructor(e,t,i=0){super(new rs),this.repeat=e,this.offset=t,this.rotation=i,Cj(this.value,e,t,i)}updateMatrix(){Cj(this.value,this.repeat,this.offset,this.rotation)}},Jm=class extends qo{constructor(e=1,t){super("v4[]"),this.nodeType="Vector4Array",this.size=e,this.value=Array.isArray(t)?t:t instanceof bi?new Array(e).fill(t):new Array(e).fill(new bi(0))}},Tj=class extends Mr{constructor(e,t,i,r){super("v3"),this.nodeType="Blend",this.a=e,this.b=t,this.alpha=i,this.mode=r}generate(e,t){if(e.isShader("fragment")){let i=[];return i.push(this.a.build(e,"c")),i.push(this.b.build(e,"c")),i.push(this.alpha.build(e,"f")),i.push(this.mode.build(e,"i")),e.format("spe_blend("+i.join(",")+")",this.getType(e),t)}else return console.warn("BlendNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},mQ=class extends Mr{constructor(e,t){super("v3"),this.nodeType="CustomColor",this.color=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let i=e.include(mQ.Nodes.customColor);e.addFragmentVariable(this.calpha,"float");let r=[];return r.push(this.color.build(e,"v3")),r.push(this.mask?`luminance(${this.mask.build(e,"v3")})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("CustomColorNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},ZL=mQ;ZL.Nodes=(function(){return{customColor:new Lt(`vec3 customColor(vec3 color, float mask, float alpha, out float calpha) {
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color;
			}`)}})();var gQ=class extends Mr{constructor(e,t){super("v3"),this.nodeType="CustomNormal",this.cnormal=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let i=e.include(gQ.Nodes.customNormal);e.addFragmentVariable(this.calpha,"float");let r=[];return r.push(this.cnormal.build(e,"v3")),r.push("normal"),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("CustomNormalNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},vQ=gQ;vQ.Nodes=(function(){return{customNormal:new Lt(`vec3 customNormal(vec3 cnormal, vec3 norm, float mask, float alpha, out float calpha) {
				vec3 normal = packNormalToRGB( norm ).rgb;
				normal *= step( vec3(0.5), cnormal );

				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;

				return normal;
			}`)}})();var Xw=class extends Mr{constructor(e,t,i,r,n,s,a,o,l,u,c,h){super("v3"),this.nodeType="CustomTexture",this.texture=e,this.textureSize=t,this.crop=i,this.projection=r,this.axis=n,this.side=s,this.size=a,this.blending=o,this.mat=l,this.isMask=h,this.alpha=u,this.mode=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){e.require("position"),e.require("normal"),e.require("uv"),e.requires.uv=[!0],e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0;let i=`g${this.uuid.toString().replace(/-/g,"")}`,r;switch(this.projection.value){case 3:r=e.include(Xw.Nodes.cylindrical);break;case 2:r=e.include(Xw.Nodes.spherical);break;case 1:let s=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],a=["zy","xz","xy"][this.axis.value],o=new Lt(`
		vec3 ${i}_planarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 projected = (1. + (position.${a})) / 2.;
				vec2 uvs = ( mat * vec3( (projected * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				${this.side.value===2?"":`lalpha *= step(0.0, ${this.side.value===1?"-1.0 * ":""}dot(vObjectNormal, ${s}));`}

				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`);r=e.include(o);break;case 4:r=e.include(Xw.Nodes.triplanar);break;default:r=e.include(Xw.Nodes.uv);break}e.addFragmentVariable(this.calpha,"float");let n=[];if(n.push("normal"),n.push(this.texture.generate(e,"t")),n.push(this.textureSize.build(e,"v2")),n.push(this.crop.build(e,"f")),n.push(this.mat.build(e,"mat3")),n.push(this.size.build(e,"v2")),n.push(this.blending.build(e,"f")),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.mode.build(e,"i")),n.push(this.calpha),this.projection.value===4){let s=`${i}_writeUvs`,a=s+"0",o=s+"1",l=s+"2",u=`${i}_triplanarWeights`;e.addFragmentVariable(a,"vec2"),e.addFragmentVariable(o,"vec2"),e.addFragmentVariable(l,"vec2"),e.addFragmentVariable(u,"vec3"),n.push(a),n.push(o),n.push(l),n.push(u)}else{let s=`${i}_writeUvs`;e.addFragmentVariable(s,"vec2"),n.push(s)}return e.format(r+"("+n.join(",")+")",this.getType(e),t)}},dB=Xw;dB.Nodes=(function(){let e=new Lt(`
vec3 cylindricalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(position);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float scaledHeight = position.y / (size.y * 0.5);
                float v =  (scaledHeight / 2.) + .5;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;

				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),t=new Lt(`
vec3 sphericalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(vPosition);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float v = 0.5 + asin(posN.y) / 3.1415;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;
				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),i=new Lt(`vec3 uvTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;

				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`),r=new Lt(`vec3 triplanarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUvs0, out vec2 writeUvs1, out vec2 writeUvs2, out vec3 writeWeights) {
				vec3 p = position;
				vec2 uv0 = (1.0 + p.xy) / 2.0;     
				vec2 uv1 = (1.0 + p.zy) / 2.0;		
				vec2 uv2 = (1.0 + p.xz) / 2.0;		
	
				uv0 = (mat * vec3((uv0 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv1 = (mat * vec3((uv1 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv2 = (mat * vec3((uv2 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;

				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));

				// Write out all sets of UVs that we generated
				writeUvs0 = uv0;
				writeUvs1 = uv1;
				writeUvs2 = uv2;
				writeWeights = weights;

				// Derivatives for LOD
				vec2 df0 = fwidth(uv0);
				vec2 df1 = fwidth(uv1);
				vec2 df2 = fwidth(uv2);
				if (df0.x > 0.5) df0.x = 0.0;
				if (df1.x > 0.5) df1.x = 0.0;
				if (df2.x > 0.5) df2.x = 0.0;

				#ifdef GL_EXT_shader_texture_lod
                	vec4 tmp = 
						texture2DLodEXT(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						texture2DLodEXT(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						texture2DLodEXT(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#else
                	vec4 tmp = 
						textureLod(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						textureLod(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						textureLod(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;

				// Apply cropping across all 3 planes
				if ( crop > 0.5 ) {
					if ( uv0.x < 0.0 || uv0.x > 1.0 || uv0.y < 0.0 || uv0.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv1.x < 0.0 || uv1.x > 1.0 || uv1.y < 0.0 || uv1.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv2.x < 0.0 || uv2.x > 1.0 || uv2.y < 0.0 || uv2.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;//n * 0.5 + 0.5;
			}			
			`);return{cylindrical:e,spherical:t,uv:i,triplanar:r}})();var Yw=class extends Mr{constructor(e,t,i,r,n,s,a,o,l,u,c,h){super("v3"),this.nodeType="Depth",this.gradientType=e,this.smooth=t,this.near=i,this.far=r,this.isVector=n,this.isWorldSpace=s,this.origin=a,this.direction=o,this.colors=l,this.steps=u,this.isMask=h,this.alpha=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let i=`g${this.uuid.toString().replace(/-/g,"")}`,r=new Lt(`vec3 ${i}_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[${i}_MAX_COLORS], float steps[${i}_MAX_COLORS], bool isMask, float mask, float alpha, out float calpha) {
               vec4 color = colors[0];
               #ifdef ${i}_IS_VECTOR
                   #ifdef ${i}_LINEAR
                       #ifdef ${i}_WORLDSPACE
                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);
                       #else
                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);
                       #endif
                   #else
                       #ifdef ${i}_WORLDSPACE
                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);
                       #else
                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);
                       #endif
                   #endif
               #else
                   float dist = length(vWPosition - cameraPosition);
			       float depth = ( dist - near ) / ( far - near );
               #endif


              float p;
              #ifdef ${i}_SMOOTH
				for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
						p = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}
              #else
                for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);
                   color = mix(color, colors[i], p);
                 }
              #endif

               float lalpha = alpha * color.a * mask;
               calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
			   accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
			   
               return color.rgb;
			}`,[Yw.Nodes.vectorLinearWorldSpaceDepth,Yw.Nodes.vectorLinearObjectSpaceDepth,Yw.Nodes.vectorSphericalObjectSpaceDepth,Yw.Nodes.vectorSphericalWorldSpaceDepth]);if(e.isShader("fragment")){e.define(`${i}_MAX_COLORS`,this.colors.value.length),this.smooth.value&&e.define(`${i}_SMOOTH`),this.isVector.value>.5&&e.define(`${i}_IS_VECTOR`),this.gradientType.value===0&&e.define(`${i}_LINEAR`),this.isWorldSpace.value>.5&&e.define(`${i}_WORLDSPACE`),e.require("worldPosition"),e.addFragmentVariable(this.calpha,"float");let n=e.include(r),s=[];return s.push(this.near.build(e,"f")),s.push(this.far.build(e,"f")),s.push(this.origin.build(e,"v3")),s.push(this.direction.build(e,"v3")),s.push(this.colors.build(e,"v4[]")),s.push(this.steps.build(e,"f[]")),s.push(this.isMask.build(e,"b")),s.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),s.push(this.alpha.build(e,"f")),s.push(this.calpha),e.format(n+"("+s.join(",")+")",this.getType(e),t)}else return console.warn("DepthNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},yQ=Yw;yQ.Nodes=(function(){let e=new Lt(`float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),t=new Lt(`float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),i=new Lt(`float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(vWPosition - origin);
               return ( dist - near ) / ( far - near );
            }`),r=new Lt(`float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(position - origin);
               return ( dist - near ) / ( far - near );
            }`);return{vectorLinearWorldSpaceDepth:e,vectorLinearObjectSpaceDepth:t,vectorSphericalWorldSpaceDepth:i,vectorSphericalObjectSpaceDepth:r}})();var D3e=class extends Mr{constructor(e,t,i,r,n,s,a,o){super("v3"),this.nodeType="Fresnel",this.color=e,this.bias=t,this.scale=i,this.intensity=r,this.factor=n,this.isMask=o,this.alpha=s,this.mode=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=new Lt(`vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, bool isMask, float mask, float alpha, int mode, out float calpha) {
					float fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );

					float lalpha = clamp(fresnel, 0.0, 1.0) * alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return color;
				}`),r=e.include(i),n=[];return n.push(this.color.build(e,"c")),n.push(this.bias.build(e,"f")),n.push(this.scale.build(e,"f")),n.push(this.intensity.build(e,"f")),n.push(this.factor.build(e,"f")),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.mode.build(e,"i")),n.push(this.calpha),e.format(r+"("+n.join(",")+")",this.getType(e),t)}else return console.warn("FresnelNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},xQ=class extends Mr{constructor(e,t,i,r,n,s,a,o,l){super("v3"),this.nodeType="Gradient",this.gradientType=e,this.smooth=t,this.colors=i,this.steps=r,this.offset=n,this.morph=s,this.angle=a,this.isMask=l,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.define("GRAD_MAX",10),e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(xQ.Nodes.gradient),r=[];return r.push(this.gradientType.build(e,"i")),r.push(this.smooth.build(e,"b")),r.push(this.colors.build(e,"v4[]")),r.push(this.steps.build(e,"f[]")),r.push(this.offset.build(e,"v2")),r.push(this.morph.build(e,"v2")),r.push(this.angle.build(e,"f")),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("GradientNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},wQ=xQ;wQ.Nodes=(function(){return{gradient:new Lt(`vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, bool isMask, float mask, float alpha, out float calpha) {
				vec4 color = colors[0];
				vec2 m = morph / vUv.xy;
				vec2 rot = vec2( 0.5 + m.x, m.y );
				vec2 dt = vec2(
					cos( angle ) * rot.x - sin( angle ) * rot.y,
					sin( angle ) * rot.x + cos( angle ) * rot.y
				);
				vec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;
				float t = dot( pt, dt ) / dot( dt, dt );
				if ( gradientType == 1 ) {
					t = distance (
						( vUv + morph ) * 3.0,
						( vUv + offset ) + 1.0
					) + angle;
				} else if ( gradientType == 2 ) {
					float polar = atan(
						vUv.x + morph.x - 0.5 + offset.x,
						vUv.y + morph.y - 0.5 + offset.y
					) * -1.0;
					t = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );
				}

				float p;
				if (smoothed) {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}

				} else {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], p);
					}
				}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
				
				return color.xyz;
			}`)}})();var bQ=class extends Mr{constructor(e,t,i,r,n){super("v3"),this.nodeType="Matcap",this.texture=e,this.isMask=r,this.alpha=t,this.mode=i,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`,this.rotation=n}generate(e,t){if(e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=e.include(bQ.Nodes.matcap);e.require("normal"),e.requires.normal=!0;let r=[];return r.push(this.texture.generate(e,"t")),r.push("normal"),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),r.push(this.calpha),r.push(this.rotation.build(e,"f")),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("MatcapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},_Q=bQ;_Q.Nodes=(function(){return{matcap:new Lt(`vec3 matcap(sampler2D matcapTex, vec3 normal, bool isMask, float mask, float alpha, int mode, out float calpha, float rotation) {
					vec3 viewDir = normalize( vViewPosition );
					vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
					vec3 y = cross( viewDir, x );
					vec2 uv = vec2( dot( x, normal ), dot( y, normal ) );
					uv = mat2( cos(rotation), sin(rotation), -sin(rotation), cos(rotation) ) * uv;
					uv = uv * 0.495 + 0.5;
					vec4 matcapColor = texture2D( matcapTex, uv );

					float lalpha = alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
					
					return matcapColor.rgb;
            	}`)}})();var zo=(function(){let e=new Lt(`vec3 random3(vec3 c) {
			float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
			vec3 r;
			r.z = fract(512.0*j);
			j *= .125;
			r.x = fract(512.0*j);
			j *= .125;
			r.y = fract(512.0*j);
			return r-0.5;
		}`),t=new Lt(`float simplexFast(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 mediump vec3 x = p - s + dot(s, vec3(G3));
			 mediump vec3 hs = s;
			 
			 mediump vec3 e = step(vec3(0.0), x - x.yzx);
			 mediump vec3 i1 = e*(1.0 - e.zxy);
			 mediump vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 mediump vec3 x1 = x - i1 + G3;
			 mediump vec3 x2 = x - i2 + 2.0*G3;
			 mediump vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 mediump vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(hs), x);
			 d.y = dot(random3(hs + i1), x1);
			 d.z = dot(random3(hs + i2), x2);
			 d.w = dot(random3(hs + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[e]);t.keywords.F3=new pr("float F3 0.3333333"),t.keywords.G3=new pr("float G3 0.1666667");let i=new Lt(`float simplexPrecise(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 vec3 x = p - s + dot(s, vec3(G3));
			 
			 vec3 e = step(vec3(0.0), x - x.yzx);
			 vec3 i1 = e*(1.0 - e.zxy);
			 vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 vec3 x1 = x - i1 + G3;
			 vec3 x2 = x - i2 + 2.0*G3;
			 vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(s), x);
			 d.y = dot(random3(s + i1), x1);
			 d.z = dot(random3(s + i2), x2);
			 d.w = dot(random3(s + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[e]);i.keywords.F3=new pr("float F3 0.3333333"),i.keywords.G3=new pr("float G3 0.1666667");let r=new Lt(`float simplexFractal(vec3 m) {
			mat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);
			mat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);
			mat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);
			return 0.5333333 * simplexFast(m * rot1)
				 + 0.2666667 * simplexFast(2.0 * m * rot2)
				 + 0.1333333 * simplexFast(4.0 * m * rot3)
				 + 0.0666667 * simplexFast(8.0 * m);
		}`,[t]),n=new Lt("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),s=new Lt("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),a=new Lt(`float simplexAshima(vec3 v) {
		  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
		  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
		  vec3 i  = floor(v + dot(v, C.yyy) );
		  vec3 x0 =   v - i + dot(i, C.xxx) ;
		  vec3 g = step(x0.yzx, x0.xyz);
		  vec3 l = 1.0 - g;
		  vec3 i1 = min( g.xyz, l.zxy );
		  vec3 i2 = max( g.xyz, l.zxy );
		  vec3 x1 = x0 - i1 + 1.0 * C.xxx;
		  vec3 x2 = x0 - i2 + 2.0 * C.xxx;
		  vec3 x3 = x0 - 1. + 3.0 * C.xxx;
		  i = mod(i, 289.0 ); 
		  vec4 p = permute( permute( permute( 
					 i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
				   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) 
				   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
		  float n_ = 1.0/7.0; // N=7
		  vec3  ns = n_ * D.wyz - D.xzx;
		  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)
		  vec4 x_ = floor(j * ns.z);
		  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
		  vec4 x = x_ *ns.x + ns.yyyy;
		  vec4 y = y_ *ns.x + ns.yyyy;
		  vec4 h = 1.0 - abs(x) - abs(y);
		  vec4 b0 = vec4( x.xy, y.xy );
		  vec4 b1 = vec4( x.zw, y.zw );
		  vec4 s0 = floor(b0)*2.0 + 1.0;
		  vec4 s1 = floor(b1)*2.0 + 1.0;
		  vec4 sh = -step(h, vec4(0.0));
		  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
		  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
		  vec3 p0 = vec3(a0.xy,h.x);
		  vec3 p1 = vec3(a0.zw,h.y);
		  vec3 p2 = vec3(a1.xy,h.z);
		  vec3 p3 = vec3(a1.zw,h.w);
		  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
		  p0 *= norm.x;
		  p1 *= norm.y;
		  p2 *= norm.z;
		  p3 *= norm.w;
		  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
		  m = m * m;
		  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), 
										dot(p2,x2), dot(p3,x3) ) );
		}`,[n,s]),o=new Lt("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),l=new Lt("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[o]),u=new Lt(`float noise(vec3 p){
			vec3 a = floor(p);
			vec3 d = p - a;
			d = d * d * (3.0 - 2.0 * d);
			vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);
			vec4 k1 = perm(b.xyxy);
			vec4 k2 = perm(k1.xyxy + b.zzww);
			vec4 c = k2 + a.zzzz;
			vec4 k3 = perm(c);
			vec4 k4 = perm(c + 1.0);
			vec4 o1 = fract(k3 * (1.0 / 41.0));
			vec4 o2 = fract(k4 * (1.0 / 41.0));
			vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);
			vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);
			return o4.y * d.y + o4.x * (1.0 - d.y);
		}`,[l]),c=new Lt(`float fbm(vec3 x) {
			float v = 0.0;
			float a = 0.5;
			vec3 shift = vec3(100);
			for (int i = 0; i < NUM_OCTAVES; ++i) {
				v += a * noise(x);
				x = x * 2.0 + shift;
				a *= 0.5;
			}
			return v;
		}`,[u]);c.keywords.NUM_OCTAVES=new pr("int NUM_OCTAVES 5");let h=new Lt("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),d=new Lt(`float perlin(vec3 P){
		  vec3 Pi0 = floor(P);
		  vec3 Pi1 = Pi0 + vec3(1.0);
		  Pi0 = mod(Pi0, 289.0);
		  Pi1 = mod(Pi1, 289.0);
		  vec3 Pf0 = fract(P);
		  vec3 Pf1 = Pf0 - vec3(1.0);
		  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
		  vec4 iy = vec4(Pi0.yy, Pi1.yy);
		  vec4 iz0 = Pi0.zzzz;
		  vec4 iz1 = Pi1.zzzz;
		  vec4 ixy = permute(permute(ix) + iy);
		  vec4 ixy0 = permute(ixy + iz0);
		  vec4 ixy1 = permute(ixy + iz1);
		  vec4 gx0 = ixy0 / 7.0;
		  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;
		  gx0 = fract(gx0);
		  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
		  vec4 sz0 = step(gz0, vec4(0.0));
		  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
		  gy0 -= sz0 * (step(0.0, gy0) - 0.5);
		  vec4 gx1 = ixy1 / 7.0;
		  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;
		  gx1 = fract(gx1);
		  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
		  vec4 sz1 = step(gz1, vec4(0.0));
		  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
		  gy1 -= sz1 * (step(0.0, gy1) - 0.5);
		  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
		  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
		  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
		  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
		  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
		  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
		  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
		  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);
		  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
		  g000 *= norm0.x;
		  g010 *= norm0.y;
		  g100 *= norm0.z;
		  g110 *= norm0.w;
		  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
		  g001 *= norm1.x;
		  g011 *= norm1.y;
		  g101 *= norm1.z;
		  g111 *= norm1.w;
		  float n000 = dot(g000, Pf0);
		  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
		  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
		  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
		  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
		  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
		  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
		  float n111 = dot(g111, Pf1);
		  vec3 fade_xyz = fade(Pf0);
		  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
		  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
		  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
		  return 2.2 * n_xyz;
		}`,[n,s,h]),p=new Lt(`float hashwithoutsine13(vec3 p3)
		{
			p3  = fract(p3 * .1031);
			p3 += dot(p3, p3.yzx + 33.33);
			return fract((p3.x + p3.y) * p3.z);
		}`),m=new Lt(`vec3 hashwithoutsine33(vec3 p3)
		{
			p3 = fract(p3 * vec3(.1031, .1030, .0973));
			p3 += dot(p3, p3.yxz+33.33);
			return fract((p3.xxy + p3.yxx)*p3.zyx);
		}`),v=new Lt(`float metric(in vec3 p)
		{
			// L2 
			return length(p);

			// Chebyshev 
			// vec3 a = abs(p);
			// return max(a.x, max(a.y, a.z));
		}`),g=new Lt(`float smin( float a, float b, float k )
		{
			float h = smoothstep(0.0, 1.0, 0.5 + 0.5 * (b - a) / k);
			float correction = k * h * (1.0 - h);
			return mix(b, a, h) - correction;
		}`),w=new Lt(`float smax( float a, float b, float k )
		{
			float h = smoothstep(1.0, 0.0, 0.5 + 0.5 * (a - b) / k);
			float correction = k * h * (1.0 - h);
			return mix(a, b, h) + correction;
		}`),S=new Lt(`float remap(float value, float input_min, float input_max, float output_min, float output_max) {
			// Compute width of each interval
			float input_width = input_max - input_min;
			float output_width = output_max - output_min;
		
			// Convert input range into a 0-1 range 
			float scaled = (value - input_min) / input_width;
		
			// Convert the 0-1 range into a value in output range
			return output_min + (scaled * output_width);
		}`),_=new Lt(`float voronoi(in vec3 x, in int style, in float smoothness, in float seed, in int quality) 
		{
			// Integer and fractional parts of this point's coordinates
			ivec3 p = ivec3(floor(x));
			vec3 f = fract(x);

			// Different variables that we will use to construct noise:
			//
			// f1: distance to the closest feature point
			// f2: distance to the second closest feature point
			// e: distance to the closest edge (cell boundary)
			//
			// We also compute "smooth" versions of all of the above quantites, essentially
			// replacing "hard" minimums with "smooth" minimums (described by IQ)
			float f1_smooth = 8.0;
			float f1 = 8.0;
			float f2_smooth = 8.0;
			float f2 = 8.0;
			float e_smooth = 8.0;
			float e = 8.0;

			// Variables stored from closest cell
			ivec3 mb;
			vec3 mr; 

			int steps = quality;
			
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				ivec3 b = ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d = length(r);
				
				f1_smooth = smin(d, f1_smooth, smoothness);

				// Store un-smoothed distances too 
				if (d < f1) 
				{
					f2 = f1;
					f1 = d;

					mb = ivec3(x, y, z);
					mr = r;
				} 
				else if (d < f2) 
				{
					f2 = d;
				}
			}	
			
			// Second pass for edge distance  
			// skip for styles don't need
			if (style != 0 &&  style != 5 && style != 7)
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				// Start search at the cell that contains the closest point to "x" (found in 1st pass)
				ivec3 b = mb + ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d1 = dot(0.5 * (mr + r), (r - mr)); 				// IQ normalizes "r - mr" but that breaks things for the smooth version?
				float d2 = dot(0.5 * (mr + r), normalize(r - mr));

				e_smooth = smin(d1, e_smooth, smoothness);

				e = min(e, d2);

				// Also compute a smooth version of F2 in this pass
				{
					ivec3 b = ivec3(x, y, z);
					if (b != mb) 
					{
						vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
						float d = length(r);

						f2_smooth = smin(d, f2_smooth, smoothness);
					}
				}
			}

			// Different visualization modes 
			if (style == 0) 
			{
				return f1_smooth;
			}
			if (style == 1) 
			{
				return f2_smooth;
			}
			if (style == 2) 
			{
				return f2_smooth - f1_smooth;
				
				// "Pebbles" also cool
				//return step(0.2, f2_smooth - f1_smooth);
			}
			if (style == 3) 
			{
				// This one is really good for rock / stone effects
				float a = f1; 
				float b = f2;
				float k = 3.0;
				float h = max(k - abs(a - b), 0.0) / k;
				float final = min(a, b) - h * h * k * (1.0 / 4.0);
				return final;
			}
			if (style == 4) 
			{
				// Some random adjustments to make this style stand out more 
				return exp(5.0 * e_smooth);
			}
			if (style == 5) 
			{
				return pow(f1_smooth, 3.0);
			}
			if (style == 6) 
			{				
				const float eps = 0.0125;

				// Thicker lines as the user increases the smoothness slider
				float thickness = smoothness * 0.25 + eps;

				// Blurrier lines as the user increases the smoothness slider
				float blur = pow(smoothness, 3.0) * 0.25 + eps;

				return smoothstep(
					thickness - thickness * blur, 
					thickness + thickness * blur, 
					e
				);
			}
			if (style == 7) 
			{
				return hashwithoutsine13(vec3(p + mb) + seed);
			}
		}
	`,[p,m,v,g,w,S]);return{simplexFast:t,simplexPrecise:i,simplexFractal:r,simplexAshima:a,fbm:c,perlin:d,voronoi:_}})(),SQ=class extends Mr{constructor(e,t,i,r,n,s,a,o,l,u,c,h,d,p,m,v,g,w,S){super("v3"),this.nodeType="Noise",this.scale=e,this.size=t,this.move=i,this.fA=r,this.fB=n,this.distortion=s,this.colorA=a,this.colorB=o,this.colorC=l,this.colorD=u,this.noiseType=h,this.voronoiStyle=p,this.highCut=m,this.lowCut=v,this.smoothness=g,this.seed=w,this.quality=S,this.isMask=d,this.alpha=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t,i,r,n){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let s=["simplexFast","simplexFractal","simplexAshima","fbm","perlin","voronoi"][this.noiseType.value],a=s=="voronoi"?`
		float v = ${s}(st + move, voronoiStyle, smoothness, seed, quality);

		// Apply clipping to colors
		v = remap(v, lowCut, highCut, 0.0, 1.0);
		v = smax(v, 0.0, smoothness * 0.25);
		v = smin(v, 1.0, smoothness * 0.25);

		// Note that the voronoi mode only uses colors "A" and "C" from the UI 
		vec4 color = mix(colorA, colorC, v); 
		`:`
		vec3 q = vec3(${s}(st),
					   ${s}(st + vec3(1.0)),
					   ${s}(st + vec3(1.0)));
		vec3 r = vec3(${s}(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),
					  ${s}(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), 
					  ${s}(st * q));
		float f = ${s}(st + r);
		vec4 color;
		color = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));
		color = mix(color, colorC, clamp(length(q), 0.0, 1.0));
		color = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));
		`,o=new Lt(`vec3 ${s}customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, int voronoiStyle, float highCut, float lowCut, float smoothness, float seed, int quality, bool isMask, float mask, float alpha, out float calpha) 
			{
                // Prevent scale of zero 
				scale = max(abs(scale), 0.001);

				vec3 st = position / size;
				st /= scale;

				${a}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return clamp(color, 0.0, 1.0).rgb;
			}`,[zo.simplexFast,zo.simplexFractal,zo.simplexAshima,zo.fbm,zo.perlin,zo.voronoi]),l=e.include(o),u=[];return u.push(this.scale.build(e,"f")),u.push(this.size.build(e,"v3")),u.push(this.move.build(e,"f")),u.push(this.fA.build(e,"v2")),u.push(this.fB.build(e,"v2")),u.push(this.distortion.build(e,"v2")),u.push(this.colorA.build(e,"v4")),u.push(this.colorB.build(e,"v4")),u.push(this.colorC.build(e,"v4")),u.push(this.colorD.build(e,"v4")),u.push(this.voronoiStyle.build(e,"i")),u.push(this.highCut.build(e,"f")),u.push(this.lowCut.build(e,"f")),u.push(this.smoothness.build(e,"f")),u.push(this.seed.build(e,"f")),u.push(this.quality.build(e,"i")),u.push(this.isMask.build(e,"b")),u.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),u.push(this.alpha.build(e,"f")),u.push(this.calpha),e.format(l+"("+u.join(",")+")",this.getType(e),t)}};SQ.numOctaves=5;var MQ=class extends Mr{constructor(e,t,i,r,n,s,a,o,l,u,c,h,d,p,m,v){super("v3"),this.nodeType="Outline",this.firstTime=!0,this.outlineColor=e,this.contourColor=t,this.outlineWidth=i,this.contourWidth=r,this.contourThreshold=n,this.outlineThreshold=s,this.contourFrequency=a,this.outlineSmoothing=o,this.contourDirection=l,this.positionalLines=u,this.compensation=c,this.resolution=h,this.normalMap=d,this.depthMap=p,this.pixelRatio=m,this.alpha=v,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let i=`g${this.uuid.toString().replace(/-/g,"")}`;if(e.require("vWorldViewDir"),e.require("worldNormal"),e.extensions.derivatives=!0,this.compensation.value&&e.define("OUTLINE_COMPENSATION",`${i}_offset`),this.firstTime){let r=this.outlineWidth.build(e,"f"),n=this.resolution.build(e,"v2"),s=this.compensation.build(e,"b"),a=this.pixelRatio.build(e,"f");e.addVertexParsVariable("randomColor","attribute vec3"),e.addVertexParsVariable("extrudeNormal","attribute vec3"),e.addVertexParsVariable(r,"uniform float"),e.addVertexParsVariable(n,"uniform vec2"),e.addVertexParsVariable(s,"uniform bool"),e.addVertexParsVariable(a,"uniform float"),e.addVertexParsVariable("vID","flat out float"),e.addFragmentParsVariable("vID","flat in float"),e.addVertexFinalCode(`
                vID = randomColor.r;
                vec2 ${i}_offset = vec2(0.0);
                if (${s}) {
                    vec4 ${i}_clipPosition = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));
                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the
                    // normals face the camera directly. So we hackily fix this by offsetting the normal
                    // by a tiny amount.
                    vec3 ${i}_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;
                    ${i}_offset = normalize(${i}_clipNormal.xy) / ${n} * (${r} / 2.0) * ${i}_clipPosition.w * 2.0 * ${a};
                    ${i}_clipPosition.xy += ${i}_offset;
                    // TODO(MAX): To handle multiple outline layers, we only want to extrude
                    // if this offset is the biggest of all the potential offsets
                    gl_Position = ${i}_clipPosition;
                }
            `)}if(e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let r=e.include(MQ.Nodes.outline),n=[];return n.push(this.outlineColor.build(e,"c")),n.push(this.contourColor.build(e,"c")),n.push(this.outlineWidth.build(e,"f")),n.push(this.contourWidth.build(e,"f")),n.push(this.contourThreshold.build(e,"f")),n.push(this.outlineThreshold.build(e,"f")),n.push(this.contourFrequency.build(e,"f")),n.push(this.outlineSmoothing.build(e,"f")),n.push(this.contourDirection.build(e,"v3")),n.push(this.positionalLines.build(e,"b")),n.push(this.resolution.build(e,"v2")),n.push(this.normalMap.getTexture(e,"t")),n.push(this.depthMap.getTexture(e,"t")),n.push(this.pixelRatio.build(e,"f")),n.push(this.compensation.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),this.firstTime=!this.firstTime,e.format(r+"("+n.join(",")+")",this.getType(e),t)}else return console.warn("OutlineNode is not compatible with "+e.shader+" shader."),""}},AQ=MQ;AQ.Nodes=(function(){let e=new Lt(`
float sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)
{
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    vec2 texelSize = (vec2(1.0) / resolution);
    vec2 offsetSize = texelSize * outlineWidth * pixelRatio;

    vec2 uvSamples[9];
    vec4 normalSamples[9];

	uvSamples[0] = uv + vec2( -offsetSize.x, -offsetSize.y) + (vogelDiskSample(0, 9, temporalAngle) * texelSize);
	uvSamples[1] = uv + vec2(0.0, -offsetSize.y) + (vogelDiskSample(1, 9, temporalAngle) * texelSize);
	uvSamples[2] = uv + vec2(  offsetSize.x, -offsetSize.y) + (vogelDiskSample(2, 9, temporalAngle) * texelSize);
	uvSamples[3] = uv + vec2( -offsetSize.x, 0.0) + (vogelDiskSample(3, 9, temporalAngle) * texelSize);
	uvSamples[4] = uv;
	uvSamples[5] = uv + vec2(  offsetSize.x, 0.0) + (vogelDiskSample(5, 9, temporalAngle) * texelSize);
	uvSamples[6] = uv + vec2( -offsetSize.x, offsetSize.y) + (vogelDiskSample(6, 9, temporalAngle) * texelSize);
	uvSamples[7] = uv + vec2(0.0, offsetSize.y) + (vogelDiskSample(7, 9, temporalAngle) * texelSize);
	uvSamples[8] = uv + vec2(  offsetSize.x, offsetSize.y) + (vogelDiskSample(8, 9, temporalAngle) * texelSize);


    normalSamples[0] = texture2D(t, uvSamples[0]);
    normalSamples[1] = texture2D(t, uvSamples[1]);
    normalSamples[2] = texture2D(t, uvSamples[2]);
    normalSamples[3] = texture2D(t, uvSamples[3]);
    normalSamples[4] = texture2D(t, uvSamples[4]);
    normalSamples[5] = texture2D(t, uvSamples[5]);
    normalSamples[6] = texture2D(t, uvSamples[6]);
    normalSamples[7] = texture2D(t, uvSamples[7]);
    normalSamples[8] = texture2D(t, uvSamples[8]);

    float depthBias = 0.0001;
    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!
    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }


    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    vec3 sobel_edge_h = normalSamples[2].rgb + (2.0*normalSamples[5].rgb) + normalSamples[8].rgb - (normalSamples[0].rgb + (2.0*normalSamples[3].rgb) + normalSamples[6].rgb);
  	vec3 sobel_edge_v = normalSamples[0].rgb + (2.0*normalSamples[1].rgb) + normalSamples[2].rgb - (normalSamples[6].rgb + (2.0*normalSamples[7].rgb) + normalSamples[8].rgb);

    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));
    return edgeNormal;
}
`);return{outline:new Lt(`vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float mask, float alpha, out float calpha) {
                vec3 result = outlineColor;
                float resultAlpha = 0.0;

                vec3 N = normalize(vWNormal);
                vec2 nuv = (gl_FragCoord.xy / resolution);
                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);
                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);

                //resultAlpha = 1.0;
                //result = vec3(sobelSample);

                float t = 1.0 - contourThreshold;
                if(positionalLines) {
                    vec3 NDir = position * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float f  = fract(NT * contourFrequency * 0.01);
                    float df = fwidth(NT * contourFrequency);

                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);
                    if (g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0;
                    }
                 }
                 else {
                    vec3 NDir = N * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float df = fwidth(NT * contourThreshold);
                    float f = sin(NT * 1.0 * contourFrequency);
                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);

                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0 - g;
                    }
                 }

                 float lalpha = alpha * resultAlpha * mask;
                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				 
                 return result;
             }`,[e])}})();var ed=class extends Mr{constructor(e,t,i,r,n,s,a,o,l,u,c,h,d,p,m,v,g,w){super("v3"),this.nodeType="Pattern",this.style=e,this.projection=t,this.axis=i,this.blending=r,this.offset=n,this.colorA=s,this.colorB=a,this.frequency=o,this.size=l,this.variation=u,this.smoothness=c,this.zigzag=h,this.rotation=d,this.vertical=p,this.horizontal=m,this.sides=v,this.isMask=w,this.alpha=g,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.require("position"),e.require("uv"),e.requires.uv=[!0],e.require("normal"),e.requires.normal=!0,e.addFragmentVariable(this.calpha,"float");let i;switch(this.style.value){case 0:i="circle";break;case 1:i="ring";break;case 2:i="polygon";break;case 3:i="xcross";break;case 4:i="diamond";break;case 5:i="checkerboard";break;case 6:i="line";break;case 7:i="wave";break;default:i="circle";break}let r=`g${this.uuid.toString().replace(/-/g,"")}`,n=new Lt(`float hashwithoutsine12(vec2 p)
				{
					vec3 p3 = fract(vec3(p.xyx) * .1031);
					p3 += dot(p3, p3.yzx + 33.33);
					return fract((p3.x + p3.y) * p3.z);
				}`),s=new Lt(`vec2 rotate_uv(in vec2 uv, float a, bool repeat) 
				{
					const float mid = 0.5;
					float radians = a * (PI / 180.0);
					vec2 rotated = vec2(
						cos(radians) * (uv.x - mid) + sin(radians) * (uv.y - mid) + mid,
						cos(radians) * (uv.y - mid) - sin(radians) * (uv.x - mid) + mid
					);
					return repeat ? fract(rotated): rotated;
				}`),a="";if(this.projection.value===4){let c=this.style.value===2?`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,h=this.style.value===2?`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,d=this.style.value===2?`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation)`;a=`
				vec3 p = position;
				float factor = 0.0125;
				vec2 uv0 = fract(p.xy * factor);
				vec2 uv1 = fract(p.zy * factor);
				vec2 uv2 = fract(p.xz * factor);
				
				uv0 = rotate_uv(uv0 + offset, rotation, true);
				uv1 = rotate_uv(uv1 + offset, rotation, true);
				uv2 = rotate_uv(uv2 + offset, rotation, true);
	
				float d0 = ${c};
				float d1 = ${h};
				float d2 = ${d};
				
				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));
				d0 *= weights.z;
				d1 *= weights.x;
				d2 *= weights.y;
				float draw = d0 + d1 + d2;
	
				vec2 custom_uv = uv0 * weights.z + uv1 * weights.x + uv2 * weights.y;
				`}else{let c=this.style.value===2?`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,h="";this.axis.value===0?h=`float radius = length(p);
					float theta = atan(p.y, p.z);
					float phi = acos(p.x / radius);`:this.axis.value===1?h=`float radius = length(p);
					float theta = atan(p.x, p.z);
					float phi = acos(p.y / radius);`:(this.axis.value,h=`float radius = length(p);
					float theta = atan(p.y, p.x);
					float phi = acos(p.z / radius);`);let d="";switch(this.projection.value){case 0:d="custom_uv = vUv.st;";break;case 1:break;case 2:d=`
							vec3 p = position;
							${h}
							custom_uv = vec2(theta, phi);
							custom_uv /= PI;
							`;break}a=`
				vec2 custom_uv;
				${d}
	
				custom_uv += offset;
				custom_uv = fract(custom_uv);
				custom_uv = rotate_uv(custom_uv, rotation, true);
	
				float draw = ${c};
				`}let o=new Lt(`vec3 ${r}_pattern(vec3 normal, float blending, int style, vec2 offset, vec4 colorA, vec4 colorB, vec2 frequency, float size, float variation, float smoothness, float zigzag, float rotation, vec2 vertical, vec2 horizontal, int sides, bool isMask, float mask, float alpha, out float calpha) {
					const float TWO_PI = PI * 2.0;
					float smoothness_remapped = pow(smoothness, 5.0);	

					${a}

					// Construct final output color
					vec4 color = mix(colorA, colorB, draw);
					color.a = clamp(color.a, 0.0, 1.0);

					// Apply cuts
					color.a *= 
						step(vertical.x, custom_uv.y) * 
						step(custom_uv.y, vertical.y);
					color.a *= 
						step(horizontal.x, abs(custom_uv.x)) * 
						step(abs(custom_uv.x), horizontal.y);

					// Accumulate alpha 
					float lalpha = alpha * clamp(color.a, 0.0, 1.0) * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return clamp(color, 0.0, 1.0).rgb;
				}`,[s,n,ed.DrawFunctions.circle,ed.DrawFunctions.ring,ed.DrawFunctions.polygon,ed.DrawFunctions.cross,ed.DrawFunctions.diamond,ed.DrawFunctions.checkerboard,ed.DrawFunctions.line,ed.DrawFunctions.wave]),l=e.include(o),u=[];return u.push("normal"),u.push(this.blending.build(e,"f")),u.push(this.style.build(e,"i")),u.push(this.offset.build(e,"v2")),u.push(this.colorA.build(e,"v4")),u.push(this.colorB.build(e,"v4")),u.push(this.frequency.build(e,"v2")),u.push(this.size.build(e,"f")),u.push(this.variation.build(e,"f")),u.push(this.smoothness.build(e,"f")),u.push(this.zigzag.build(e,"f")),u.push(this.rotation.build(e,"f")),u.push(this.vertical.build(e,"v2")),u.push(this.horizontal.build(e,"v2")),u.push(this.sides.build(e,"i")),u.push(this.isMask.build(e,"b")),u.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),u.push(this.alpha.build(e,"f")),u.push(this.calpha),e.format(l+"("+u.join(",")+")",this.getType(e),t)}else return console.warn("PatterNode is not compatible with "+e.shader+" shader."),e.format("vec3(0.0)",this.getType(e),t)}},EQ=ed;EQ.DrawFunctions=(function(){let e=new Lt(`float hashwithoutsine12(vec2 p) {
				vec3 p3 = fract(vec3(p.xyx) * 0.1031);
				p3 += dot(p3, p3.yzx + 33.33);
				return fract((p3.x + p3.y) * p3.z);
			}`),t=new Lt(`vec2 tile_and_center(in vec2 uv, in vec2 frequency, in float variation, in float zigzag, in float rotation) {
                // Create tiles in UV-space
                uv *= frequency;

                // Integer coords
                vec2 i = floor(uv);

                // Offset every other row based on zigzag param, then compute fractional coords
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = fract(uv);

				// Rotate the tile itself:
				// const float mid = 0.5;
				// f = vec2(
				// 	cos(rotation) * (f.x - mid) + sin(rotation) * (f.y - mid) + mid,
				// 	cos(rotation) * (f.y - mid) - sin(rotation) * (f.x - mid) + mid
				// );
				// f = fract(f);

                f = f * 2.0 - 1.0;

				// Recompute integer coords after shifting - then, random value per tile 
				i = floor(uv);
				float rand = (hashwithoutsine12(i) * 5.0 + 1.0);
				float jitter = mix(1.0, rand, variation);
				f *= jitter;

                return f;
            }`,[e]),i=new Lt(`float circle(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(
                    -smoothness, 
                     smoothness, 
                     length(f) - size
                );
            }`,[t]),r=new Lt(`float ring(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);

				float d = length(f);
                const float inner_width = 0.5;

                float outer = smoothstep(-smoothness, smoothness, d - size);
                float inner = smoothstep(-smoothness, smoothness, d - size * inner_width);
				return outer + (1.0 - inner);   
            }`,[t]),n=new Lt(`float sdf_ngon(in vec2 p, in float r, in int n) {
                float an = (PI * 2.0) / float(n);
                float he = r * tan(0.5 * an);
                
                // Rotate to first sector
                p = -p.yx; 
                float bn = an * floor((atan(p.y, p.x) + 0.5 * an) / an);
                vec2  cs = vec2(cos(bn), sin(bn));
                p = mat2(cs.x, -cs.y, cs.y, cs.x)*p;
            
                // Side of polygon
                return length(p - vec2(r, clamp(p.y, -he, he))) * sign(p.x - r);
            }
            
            float polygon(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation, in int sides) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_ngon(f, size, sides));
            }`,[t]),s=new Lt(`float sdf_cross(in vec2 p, in vec2 b, float r ) {
                p = abs(p); 
				p = (p.y > p.x) ? p.yx : p.xy;
                vec2  q = p - b;
                float k = max(q.y, q.x);
                vec2  w = (k > 0.0) ? q : vec2(b.y - p.x, -k);
                return sign(k) * length(max(w, 0.0)) + r;
            }
            
            // Avoid namespace conflicts 
            float xcross(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_cross(f, vec2(size, size * 0.25), smoothness));
            }`,[t]),a=new Lt(`float ndot(vec2 a, vec2 b) { 
                return a.x*b.x - a.y*b.y; 
            }
            
            float sdf_diamond(in vec2 p, in vec2 b) {
                p = abs(p);
                float h = clamp(ndot(b - 2.0 * p, b) / dot(b, b), -1.0, 1.0);
                float d = length(p - 0.5 * b * vec2(1.0 - h, 1.0 + h));
                return d * sign(p.x * b.y + p.y * b.x - b.x * b.y);
            }

            float diamond(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
	            return smoothstep(-smoothness, smoothness, sdf_diamond(f, vec2(size)));
            }`,[t]),o=new Lt(`float checkerboard(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                uv *= frequency;
                vec2 i = floor(uv);

                float offset = mod(i.y, 2.0);

                uv.x += offset + zigzag * offset;
                float x = floor(uv.x);
                
                return mod(x, 2.0);
            }`),l=new Lt(`float line(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, 0.0, zigzag, rotation);
				
				// Different approach for variation param here
				float row = floor(uv * frequency).y;
				float rand = hashwithoutsine12(vec2(row));
				float s = mix(size, size * rand, variation);

				return smoothstep(
					s - smoothness, 
					s + smoothness, 
					abs(f.y)
				);
            }`,[t]),u=new Lt(`// Uses bisection 
            float udf_cos(in vec2 p, in float a, in float b, in float c, in float d) {
                // Convert all data to a primitive cosine wave
                p = c * (p - vec2(d, a));
                
                const float TWO_PI = PI * 2.0;

                // Reduce to principal half cycle
                p.x = mod(p.x, TWO_PI); 
                if (p.x > PI) {
                    p.x = TWO_PI - p.x;
                }
            
                // Find zero of derivative (minimize distance)
                float xa = 0.0;
                float xb = TWO_PI;

                // 24 bit precision
                for (int i = 0; i < 24; i++) {
                    float x = 0.5 * (xa + xb);
                    float y = x - p.x + b * c * sin(x) * (p.y - b * c * cos(x));
                    if (y < 0.0) xa = x; 
                    else xb = x;
                }
                float x = 0.5 * (xa + xb);
                
                // Compute distance    
                vec2 q = vec2(x, b * c * cos(x));
                return length(p - q) / c;
            }

            float wave(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                float repeat = frequency.x;
                uv *= repeat;
                vec2 i = floor(uv);
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = vec2(uv.x, fract(uv.y));

                // Generalized cosine: y(x) = a + b * cos(cx + d)
                const float amplitude = 0.125;
                float wave_frequency = frequency.y * 0.1;
                float distance_estimate = udf_cos(f, 0.50, amplitude, wave_frequency * (2.0 * PI), 0.0);

				// Different approach for variation param here
				float rand = hashwithoutsine12(vec2(i.y));
				float s = mix(size, size * rand, variation);

                return smoothstep(-smoothness, smoothness, distance_estimate - s * 0.5);
            }`);return{tileAndCenter:t,circle:i,ring:r,polygon:n,cross:s,diamond:a,checkerboard:o,line:l,wave:u}})();var CQ=class extends Mr{constructor(e,t,i,r,n,s,a,o){super("v3"),this.nodeType="Rainbow",this.filmThickness=e,this.movement=t,this.wavelengths=i,this.noiseStrength=r,this.noiseScale=n,this.offset=s,this.isMask=o,this.alpha=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(CQ.Nodes.rainbow),r=[];return r.push(this.filmThickness.build(e,"f")),r.push(this.movement.build(e,"f")),r.push(this.wavelengths.build(e,"v3")),r.push(this.noiseStrength.build(e,"f")),r.push(this.noiseScale.build(e,"f")),r.push(this.offset.build(e,"v3")),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("RainbowNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},TQ=CQ;TQ.Nodes=(function(){let e=new Lt(`vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {
				float f = 0.0;
				
				if (noiseStrength != 0.0) {
					vec3 st = position / noiseScale;
					float noise = simplexFast(1.6 * st + vec3(1.8, 1.5, 1.9) * simplexFast(st) + vec3(1.7, 9.2, 1.0));
					f = noise * noiseStrength;
				}

				vec3 waves = wavelengths * vec3(1.0, 0.8, 0.6) + 1.0;
				float angle = dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal));

				mediump vec3 color = cos((((filmThickness + f) / waves) * angle) + movement);
				return .5 + .5 * color;
			 }`,[zo.simplexFast]);return{rainbow:new Lt(`vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, bool isMask, float mask, float alpha, out float calpha) {
				mediump vec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);

				float rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);

				float lalpha = alpha * rainbowContribution * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return res;
			 }`,[e])}})();var PQ=class extends Mr{constructor(e,t,i,r,n,s,a,o,l,u){super("v3"),this.nodeType="Toon",this.positioning=e,this.colors=t,this.steps=i,this.source=r,this.isWorldSpace=n,this.noiseStrength=s,this.noiseScale=a,this.shadowColor=o,this.offset=l,this.alpha=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("worldNormal"),e.require("worldPosition"),e.isShader("fragment")){e.define("COLORS_MAX",10),e.addFragmentVariable(this.calpha,"float");let i=e.include(PQ.Nodes.toon),r=[];return r.push(this.positioning.build(e,"i")),r.push(this.colors.build(e,"v4[]")),r.push(this.steps.build(e,"f[]")),r.push(this.source.build(e,"v3")),r.push(this.isWorldSpace.build(e,"b")),r.push(this.noiseStrength.build(e,"f")),r.push(this.noiseScale.build(e,"f")),r.push(this.shadowColor.build(e,"v4")),r.push(this.offset.build(e,"v3")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("ToonNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},DQ=PQ;DQ.Nodes=(function(){let e=new Lt(`float rand(float n) {
				return fract(sin(n) * 43758.5453123);
			}`),t=new Lt(`float hash1(float p) { 
				p = fract(p * 0.011); 
				p *= p + 7.5; 
				p *= p + p; 
				return fract(p); 
			}`),i=new Lt(`float valueNoise(vec3 x) {
				const vec3 step = vec3(110, 241, 171);
			
				vec3 i = floor(x);
				vec3 f = fract(x);
			 
				// For performance, compute the base input to a 1D hash from the integer part of the argument and the 
				// incremental change to the 1D based on the 3D -> 1D wrapping
				float n = dot(i, step);
			
				vec3 u = f * f * (3.0 - 2.0 * f);
				return mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),
						   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);
			}`,[t]),r=new Lt(`vec3 hash3(vec3 x) {
				x = vec3(dot(x,vec3(127.1, 311.7, 74.7)),
						 dot(x,vec3(269.5, 183.3, 246.1)),
						 dot(x,vec3(113.5, 271.9, 124.6)));
			
				return fract(sin(x)*43758.5453123);
			}`),n=new Lt(`vec3 voronoiNoise(in vec3 x)
			{
				vec3 p = floor(x);
				vec3 f = fract(x);

				float id = 0.0;
				vec2 res = vec2(100.0);

				for(int k=-1; k<=1; k++)
				for(int j=-1; j<=1; j++)
				for(int i=-1; i<=1; i++)
				{
					vec3 b = vec3(float(i), float(j), float(k));

					// Comment out the "+ hash(p + b);" part below to get "square" cells
					vec3 r = vec3(b) - f + hash3(p + b);
					float d = dot(r, r);

					if (d < res.x)
					{
						id = dot(p + b, vec3(1.0, 57.0, 113.0));
						res = vec2(d, res.x);			
					}
					else if (d < res.y)
					{
						res.y = d;
					}
				}

				return vec3(sqrt(res), abs(id));
			}
			`,[r]);return{toon:new Lt(`vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float mask, float alpha, out float calpha) {
				float t = 0.0;
				float shadow = 1.0;

				if (positioning == 0) {

					// Can't do this mode if lighting is "none"
					#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))

						// Algorithm from Chapter 10 of Graphics Shaders
						const vec3 weights = vec3(0.2125, 0.7154, 0.0721);
						vec3 lpos;
						vec3 l;
						float dproduct;

						#if (NUM_POINT_LIGHTS > 0)

							#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)
								PointLightShadow pointLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_POINT_LIGHTS; i++) {
								// Light positions are in view-space for some reason?
								lpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								
								// TODO: we want to use "intensity" but it isn't available in the shader code
								//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);

								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)
									pointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getPointShadow( 
											pointShadowMap[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowMapSize, 
											pointLightShadow.shadowBias, 
											pointLightShadow.shadowRadius,
											vPointShadowCoord[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowCameraNear, 
											pointLightShadow.shadowCameraFar);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_DIR_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)
								DirectionalLightShadow directionalLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_DIR_LIGHTS; i++) {
								// Use the direction vector for directional lights instead
								l = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;
		
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)
									directionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow( 
										UNROLLED_LOOP_INDEX,
										directionalShadowMap[UNROLLED_LOOP_INDEX], 
										directionalLightShadow.shadowMapSize, 
										directionalLightShadow.shadowBias, 
										directionalLightShadow.shadowRadius, 
										vDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_SPOT_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)
								SpotLightShadow spotLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {
								lpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)
									spotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow(
										UNROLLED_LOOP_INDEX,
										spotShadowMap[UNROLLED_LOOP_INDEX], 
										spotLightShadow.shadowMapSize, 
										spotLightShadow.shadowBias, 
										spotLightShadow.shadowRadius, 
										vSpotLightCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						t = clamp(t, 0.0, 1.0);
				
					#endif

				} else if (positioning == 1) {
					
					vec3 origin = mix(position, worldPosition, float(isWorldSpace));
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	

				} else {

					vec3 origin = worldPosition;
					vec3 source = cameraPosition - offset;
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	
					
				}

				if (noiseStrength > 0.0) {
					// Distort with noise
					vec3 st = position / noiseScale;
					
					// Voronoi "smooth" noise
					float noise = 1.0 - voronoiNoise(st).x;

					// Voronoi cellular noise
					//float noise = 1.0 - rand(voronoiNoise(st).z);

					// Position warp noise
					// vec3 offset = vec3(
					// 	simplexFast(st),
					// 	simplexFast(st + vec3(111.1, 143.89, 217.19)),
					// 	simplexFast(st + vec3(171.1, 247.89, 117.23))
					// );
					// st += offset;
					// float noise = valueNoise(st);

					t += noise * noiseStrength;
				}

				t = clamp(t, 0.0, 1.0);

				// Compute ramp color
				float p;
				vec4 color = colors[0];
				for (int i = 1; i < COLORS_MAX; i++) {
					p = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);
					color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
				}

				// Incorporate custom shadow color
				if (positioning == 0) {

					vec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);
					color.rgb = mix(blendedShadow, color.rgb, shadow);
				
				}

				// Accumulate alpha as usual
				float lalpha = alpha * color.a * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color.xyz;

            }`,[zo.simplexFast,e,i,n])}})();var R3e=(function(){return{textureBicubic:new Lt(`float w0( float a ) {
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
        }
    
        float w1( float a ) {
            return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
        }
    
        float w2( float a ){
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
        }
    
        float w3( float a ) {
            return ( 1.0 / 6.0 ) * ( a * a * a );
        }
    
        // g0 and g1 are the two amplitude functions
        float g0( float a ) {
            return w0( a ) + w1( a );
        }
    
        float g1( float a ) {
            return w2( a ) + w3( a );
        }
    
        // h0 and h1 are the two offset functions
        float h0( float a ) {
            return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
        }
    
        float h1( float a ) {
            return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
        }
    
        vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
            uv = uv * texelSize.zw + 0.5;
    
            vec2 iuv = floor( uv );
            vec2 fuv = fract( uv );
    
            float g0x = g0( fuv.x );
            float g1x = g1( fuv.x );
            float h0x = h0( fuv.x );
            float h1x = h1( fuv.x );
            float h0y = h0( fuv.y );
            float h1y = h1( fuv.y );
    
            vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
            vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
    
            return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) + 
                   g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
        }

        vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
            vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
            vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
            vec2 fLodSizeInv = 1.0 / fLodSize;
            vec2 cLodSizeInv = 1.0 / cLodSize;
            vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
            vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
            return mix( fSample, cSample, fract( lod ) );
        }`)}})();function I3e(e,t){return e>=t?new Pe(t/e,1):new Pe(1,e/t)}var RQ=class extends Mr{constructor(e,t,i,r,n,s,a,o){super("v3"),this.nodeType="Transmission",this.thickness=e,this.ior=t,this.roughness=i,this.transmissionSamplerSize=r,this.transmissionSamplerMap=n,this.transmissionDepthMap=s,this.aspectRatio=a,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0,e.isShader("fragment")){e.define("NUM_SAMPLES",6),e.define("BLUR_SLOD",Math.pow(2,oi.transmissionLod.value)),e.require("worldPosition"),e.requires.worldNormal=!0,e.requires.modelMatrix=!0,e.requires.projectionMatrix=!0,e.addFragmentVariable(this.calpha,"float");let i=e.include(RQ.Nodes.transmission),r=[];return r.push(this.thickness.build(e,"f")),r.push(this.ior.build(e,"f")),r.push(this.roughness.build(e,"f")),r.push(this.transmissionSamplerSize.build(e,"v2")),r.push(this.transmissionSamplerMap.getTexture(e,"t")),r.push(this.transmissionDepthMap.getTexture(e,"t")),r.push(this.aspectRatio.build(e,"v2")),r.push("normal"),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("TransmissionNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},IQ=RQ;IQ.Nodes=(function(){let e=new Lt(`vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {
                // Slightly modified version of this:
                // https://www.shadertoy.com/view/ltScRG

				// Special case for blur == 0.0
				if (lod == 0.0) {
					#ifdef TEXTURE_LOD_EXT
					return texture2DLodEXT( sp, U, 0.0).rgb;
					#else
					return textureLod( sp, U, 0.0).rgb;
					#endif
				}
				
				vec2 texelSize = vec2(1.0) / resolution;
                vec2 halton = haltonSequence[frameIndex];
                float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
                float temporalAngle  = temporalOffset * PI2;
				vec3 res = vec3(0.0);
                vec2 uv = vec2(0.0);
                vec2 offset = vec2(0.0);
                vec2 vogelSample = vec2(0.0);
                for (int i = 0; i < NUM_SAMPLES; i++) {
                    vogelSample =  vogelDiskSample(i, NUM_SAMPLES, temporalAngle) * texelSize;
                    offset = vogelSample * scale * (lod * 10.0); // TODO: used to be hardcoded to 20
                    uv = U + offset;
                    float opaqueDepth = unpackRGBAToDepth(textureLod(dm, uv, lod));
                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {
                        uv = unrefractedU;
                        lod = lod > 4.0 ? lod : lod / 2.0;
                    }
                    res += textureLod(sp, uv, lod).rgb;
                }
                return res / float(NUM_SAMPLES);
            }`),t=new Lt(`vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		        // Direction of refracted light.
		        vec3 refractionVector = refract( -v,  n, 1.0 / ior );
		        
				// Compute rotation-independant scaling of the model matrix.
		        vec3 modelScale;
		        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );

		        // The thickness is specified in local space
		        return normalize( refractionVector ) * thickness * modelScale;
	        }`),i=new Lt(`float applyIorToRoughness( float roughness, float ior ) {
				// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
				// an IOR of 1.5 results in the default amount of microfacet refraction.
				return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
			}`),r=new Lt(`vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {
				// Threejs exports do not pass a depth map to this shader, so we have to fallback to the "Threejs method of blurring" - see
				// also the code in convertTransmission.ts, which runs during export
				#ifdef IS_THREEJS_EXPORT
					float lod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness / 5.0, ior);
					return textureBicubic(transmissionSamplerMap, fragCoord.xy, lod).rgb;
				#else
					float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
					float lod = applyIorToRoughness(roughness, ior);
					return blur(transmissionSamplerMap, fragCoord, vec2(lod), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);
				#endif
			}`,[R3e.textureBicubic,i,e]),n=new Lt(`vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;

				// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
				vec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;

				vec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );
				vec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;
				unrefractedCoords += 1.0;
				unrefractedCoords /= 2.0;

				// Sample framebuffer to get pixel the refracted ray hits.
				return getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );
    		}`,[r,t]);return{transmission:new Lt(`vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float mask, float alpha, out float calpha) {
                vec3 v = vec3(0.);
                if (isOrthographic) {
                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
                } else {
                    v = normalize(vWPosition - cameraPosition);
                }
                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );
                
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * alpha;

				return transmission;
            }`,[n])}})();var JL=(e=>(e.NOISE="noise",e.MAP="map",e))(JL||{}),LQ=class extends Mr{constructor(e,t,i,r,n,s,a,o,l,u,c){super("v3"),this.displacementTypeIndex=new Pr(0),this.nodeType="VertexDisplacement",this.intensity=e,this.movementOrTexture=t,Object.values(JL)[this.displacementTypeIndex.value]==="map"&&(this.mat=new pQ(this.movementOrTexture.value.matrix)),this.cropOrOffset=i,this.scale=u,this.noiseFunctionIndex=c,this.voronoiStyle=r,this.smoothness=n,this.seed=s,this.highCut=a,this.lowCut=o,this.quality=l}generate(e,t){if(e.isShader("vertex")){e.define("USE_LAYER_DISPLACE");let i,r=[];switch(r.push("displaced_position"),r.push("displaced_normal"),Object.values(JL)[this.displacementTypeIndex.value]){case"map":{i=e.include(LQ.Nodes.map),r.push(this.movementOrTexture.getTexture(e,"t")),r.push("uv"),r.push(this.cropOrOffset.build(e,"f")),this.mat&&r.push(this.mat.build(e,"mat3"));break}case"noise":{let n=["simplexPrecise","simplexFractal","simplexAshima","fbm","perlin","voronoi"][this.noiseFunctionIndex.value],s=new Lt(`vec3 orthogonal(vec3 v) {
							return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
						}`),a=n=="voronoi"?`
					float v = ${n}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1), voronoiStyle, smoothness, seed, quality);
					v = remap(v, lowCut, highCut, 0.0, 1.0);
					v = smax(v, 0.0, smoothness * 0.25);
					v = smin(v, 1.0, smoothness * 0.25);

					return p + n * v * intensity;
					`:`
					return p + n * ${n}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;
					`,o=new Lt(`vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality) {
							${a}
						}`,[zo.simplexPrecise,zo.simplexFractal,zo.simplexAshima,zo.fbm,zo.perlin,zo.voronoi]),l=new Lt(`vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality, float intensity, out vec3 displaced_normal) {
							vec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 tangent1 = orthogonal(normal);
							vec3 tangent2 = normalize(cross(normal, tangent1));

                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.
                            // This caused some small oval/circular visual artifacts in the lighting.
                            // For now, simply using neighbors further away betters the problem,
                            // but we should figure out the underlying cause when we have some time.
                            // Maybe its related to how we calculate the tangent and bitangent?
							vec3 nearby1 = position + tangent1;
							vec3 nearby2 = position + tangent2;
							vec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
							return displaced_position;
						}`,[o,s]);i=e.include(l),r.push(this.scale.build(e,"f")),r.push(this.cropOrOffset.build(e,"v3")),r.push(this.movementOrTexture.build(e,"f")),r.push(this.voronoiStyle.build(e,"i")),r.push(this.smoothness.build(e,"f")),r.push(this.seed.build(e,"f")),r.push(this.highCut.build(e,"f")),r.push(this.lowCut.build(e,"f")),r.push(this.quality.build(e,"i"));break}}return r.push(this.intensity.build(e,"f")),r.push("displaced_normal"),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("VertexDisplacementNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},OQ=LQ;OQ.Nodes=(function(){let e=new Lt(`vec3 orthogonal(vec3 v) {
				return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
			}`),t=new Lt(`float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {
				vec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;
				vec4 tmp = texture2D(tex, uvs);
				vec3 col = tmp.rgb;
				if (crop > 0.5) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						return 0.0;
					}
				}
				return col.r;
			}`);return{map:new Lt(`vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {
				vec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;
				vec3 tangent1 = normalize(orthogonal(normal));
				vec3 tangent2 = normalize(cross(normal, tangent1));
				vec3 nearby1 = position + tangent1 * 0.1;
				vec3 nearby2 = position + tangent2 * 0.1;
				vec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				vec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
				return displaced_position;
			}`,[e,t])}})();var oi={normalRenderTarget:new dd,normalRenderTargetDepth:new dd,transmissionRenderTarget:new dd,aspectRatio:new ha,transmissionSize:new ha(2048,2048),transmissionRenderTargetDepth:new dd,aoRenderTarget:new dd,aoEnabled:new za,pixelRatioNode:new Ft(1),resolution:new ha,penumbraSize:new Zm(5,.5),frameIndex:new Pr(0),transmissionLod:new Pr(2),taaEnabled:new za(!0)};for(let e of Object.values(oi))e.isRenderGlobal=!0;var zQ={skiaWasmUrl:"https://unpkg.com/@splinetool/ui-wasm@1.12.5/build/ui.wasm"},fB=class extends xs{constructor(){super("basic"),this.nodeType="Basic",this.color=new bn(fl),this.shadingAlpha=new Ft(1),this.shadingBlend=new Pr(0),this.previousModelViewMatrix=new eh,this.previouseProjectionMatrix=new eh}get category(){return"phong"}generate(e){let t;if(e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:oi.frameIndex}),e.mergeUniform({resolution:oi.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(kx.merge([Dt.fog])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","	vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{this.color===void 0&&(this.color=new bn(fl)),this.color.analyze(e,{slot:"color"}),this.alpha&&this.alpha.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"});let i=this.color.flow(e,"c",{slot:"color"}),r=this.alpha?this.alpha.flow(e,"f"):void 0,n=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,s=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0;e.requires.transparent=r!==void 0,e.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join(`
`));let a=["#include <normal_fragment_begin>",i.code];r&&a.push(r.code,"#ifdef ALPHATEST"," if ( "+r.result+" <= ALPHATEST ) discard;","#endif"),s?a.push(s.code,`vec3 outgoingLight = ${i.result};`,`vec3 finalColor = spe_blend(outgoingLight, ${s.result}, 1.0, SPE_BLENDING_NORMAL);`):a.push(`vec3 finalColor = ${i.result};`);let o="1.0";this.mask&&(this.mask.analyze(e),o=`luminance(${this.mask.flow(e,"v3").result})`),r?a.push(`gl_FragColor = vec4( finalColor, accumAlpha * ${r.result} * ${o} );`):a.push("gl_FragColor = vec4("+i.result+", 1.0 );"),n&&a.push(`gl_FragColor.a *= ${n.result};`),a.push("#include <fog_fragment>","#include <dithering_fragment>"),t=a.join(`
`)}return t}},L3e=class extends xs{constructor(){super("lambert"),this.nodeType="Lambert",this.color=new bn(fl),this.emissive=new bn(0),this.emissiveIntensity=new Ft(1),this.previousModelViewMatrix=new eh,this.previouseProjectionMatrix=new eh,this.shadingAlpha=new Ft(1),this.shadingBlend=new Pr(0),this.occlusion=new za(!0)}get category(){return"lambert"}build(e){let t;if(e.define("LAMBERT"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:oi.frameIndex}),e.mergeUniform({resolution:oi.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(kx.merge([Dt.fog,Dt.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>",`
					vec3 diffuse = vec3( 1.0 );
					GeometricContext geometry;
					geometry.position = mvPosition.xyz;
					geometry.normal = normalize( transformedNormal );
					geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
				`),r.push(`
					GeometricContext backGeometry;
					backGeometry.position = geometry.position;
					backGeometry.normal = -geometry.normal;
					backGeometry.viewDir = geometry.viewDir;
					vLightFront = vec3( 0.0 );
					vIndirectFront = vec3( 0.0 );
					#ifdef DOUBLE_SIDED
						vLightBack = vec3( 0.0 );
						vIndirectBack = vec3( 0.0 );
					#endif
					IncidentLight directLight;
					float dotNL;
					vec3 directLightColor_Diffuse;
					vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
					vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
					#ifdef DOUBLE_SIDED
						vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
						vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
					#endif
					#if NUM_POINT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
							getPointLightInfo( pointLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_SPOT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
							getSpotLightInfo( spotLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_DIR_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
							getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_HEMI_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
							vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
							#ifdef DOUBLE_SIDED
								vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
							#endif
						}
						#pragma unroll_loop_end
					#endif
				`,"	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:oi.penumbraSize}),e.mergeUniform({frameIndex:oi.frameIndex}),e.mergeUniform({aoMap:oi.aoRenderTarget}),e.mergeUniform({aoEnabled:oi.aoEnabled}),this.color===void 0&&(this.color=new bn(fl)),this.color.analyze(e,{slot:"color"}),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),r=this.emissive.flow(e,"c",{slot:"emissive"}),n=this.emissiveIntensity.flow(e,"f",{slot:"emissive"}),s=this.occlusion.flow(e,"b",{slot:"occlusion"}),a=this.shadingAlpha.flow(e,"f"),o=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,u=this.alpha?this.alpha.flow(e,"f"):void 0,c=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=u!==void 0,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let h=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx, viewdy));
				bool isFrontFacing = (dot(normal, faceNormal) >= 0.0);
				`,"#include <clipping_planes_fragment>"];h.push(i.code,"vec3 diffuseColor = "+i.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),u&&h.push(u.code,"#ifdef ALPHATEST","if ( "+u.result+" <= ALPHATEST ) discard;","#endif"),h.push("#ifdef DOUBLE_SIDED","	reflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","	reflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","	reflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","	reflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),r&&h.push(r.code,"reflectedLight.directDiffuse += "+r.result+" * "+n.result+";"),h.push("vec3 ao = aoEnabled && "+s.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) ;");let d="1.0";this.mask&&(this.mask.analyze(e),d=`luminance(${this.mask.flow(e,"v3").result})`),h.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${d} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${d}, ${o.result} );

					outgoingLight *= ao;
				}
				`),l&&h.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),u?h.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${u.result} );`):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c&&h.push(`gl_FragColor.a *= ${c.result};`),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join(`
`)}return t}},bx=(function(){let e=new Lt(`vec2 dHdxy(sampler2D bumpMap, vec2 bumpMapUv, float bumpScale) {

            // Gradient of UVs w.r.t. X coordinate (in screen-space)
            vec2 dSTdx = dFdx(bumpMapUv);

            // Gradient of UVs w.r.t. Y coordinate (in screen-space)
            vec2 dSTdy = dFdy(bumpMapUv);
            
            // Forward differencing
            float Hll = bumpScale * luminance(texture(bumpMap, bumpMapUv).rgb);
            float dBx = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdx).rgb) - Hll;
            float dBy = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdy).rgb) - Hll;
            
            return vec2( dBx, dBy );
        }`),t=new Lt(`vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
            vec3 vSigmaX = dFdx( surf_pos.xyz );
            vec3 vSigmaY = dFdy( surf_pos.xyz );
            vec3 vN = surf_norm; // normalized
            
            vN = normalize(vN);

            vec3 R1 = cross( vSigmaY, vN );
            vec3 R2 = cross( vN, vSigmaX );

            R1 = normalize(R1);
            R2 = normalize(R2);
    
            float fDet = dot( vSigmaX, R1 ) * faceDirection;
    
            vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
            return normalize( abs( fDet ) * vN - vGrad );
        }`);return{dHdxy:e,perturbNormalArb:t}})(),O3e=class extends xs{constructor(){super("phong"),this.nodeType="Phong",this.color=new bn(fl),this.specular=new bn(1118481),this.shininess=new Ft(30),this.previousModelViewMatrix=new eh,this.previouseProjectionMatrix=new eh,this.shadingAlpha=new Ft(1),this.shadingBlend=new Pr(0),this.occlusion=new za(!0)}get category(){return"phong"}build(e){let t;if(e.define("PHONG"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:oi.frameIndex}),e.mergeUniform({resolution:oi.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(kx.merge([Dt.fog,Dt.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:oi.penumbraSize}),e.mergeUniform({frameIndex:oi.frameIndex}),e.mergeUniform({aoMap:oi.aoRenderTarget}),e.mergeUniform({aoEnabled:oi.aoEnabled}),this.color===void 0&&(this.color=new bn(fl)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e);let i=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let r=this.color.flow(e,"c",{slot:"color"}),n=this.specular.flow(e,"c"),s=this.shininess.flow(e,"f"),a=this.shadingAlpha.flow(e,"f"),o=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,u=this.alpha?this.alpha.flow(e,"f"):void 0,c=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=u!==void 0,e.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let h=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	BlinnPhongMaterial material;"];if(this.bumpMap){e.include(bx.dHdxy),e.include(bx.perturbNormalArb);let p=this.bumpMap.texture.flow(e,"t"),m=this.bumpMap.flow(e,"v3"),v=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",g="";this.bumpMap.projection.value===4?g=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${p.result}, uv0, ${v});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${p.result}, uv1, ${v});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${p.result}, uv2, ${v});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:g=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${p.result}, bumpMapCachedUv, ${v});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,h.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${m.result};
					${g}
					`)}h.push(r.code,"	vec3 diffuseColor = "+r.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","	vec3 totalEmissiveRadiance = emissive;",n.code,"	vec3 specular = "+n.result+";",s.code,"	float shininess = max( 0.0001, "+s.result+" );","	float specularStrength = 1.0;"),u&&h.push(u.code,"#ifdef ALPHATEST","if ( "+u.result+" <= ALPHATEST ) discard;","#endif"),h.push("material.diffuseColor = diffuseColor;"),h.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h.push("vec3 ao = aoEnabled && "+i.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;");let d="1.0";this.mask&&(this.mask.analyze(e),d=`luminance(${this.mask.flow(e,"v3").result})`),h.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${d} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${d}, ${o.result} );
					
					outgoingLight *= ao;
				}
				`),l&&h.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),u?h.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${u.result});`):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c&&h.push(`gl_FragColor.a *= ${c.result};`),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join(`
`)}return t}},z3e=class extends xs{constructor(){super("standard"),this.nodeType="Standard",this.color=new bn(fl),this.roughness=new Ft(.3),this.metalness=new Ft(0),this.reflectivity=new Ft(.5),this.previousModelViewMatrix=new eh,this.previouseProjectionMatrix=new eh,this.shadingAlpha=new Ft(1),this.shadingBlend=new Pr(0),this.occlusion=new za(!0)}get category(){return"physical"}build(e){let t;if(e.define("STANDARD"),e.requires.lights=!0,e.extensions.derivatives=!0,e.extensions.shaderTextureLOD=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:oi.frameIndex}),e.mergeUniform({resolution:oi.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(kx.merge([Dt.fog,Dt.lights])),Dt.LTC_1&&(e.uniforms.ltc_1={value:void 0},e.uniforms.ltc_2={value:void 0}),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:oi.penumbraSize}),e.mergeUniform({frameIndex:oi.frameIndex}),e.mergeUniform({aoMap:oi.aoRenderTarget}),e.mergeUniform({aoEnabled:oi.aoEnabled});let i={gamma:!0};this.color===void 0&&(this.color=new bn(fl)),this.color.analyze(e,{slot:"color",context:i}),this.roughness.analyze(e),this.metalness.analyze(e);let r=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e),this.reflectivity&&this.reflectivity.analyze(e);let n=this.color.flow(e,"c",{slot:"color",context:i}),s=this.roughness.flow(e,"f"),a=this.metalness.flow(e,"f"),o=this.shadingAlpha.flow(e,"f"),l=this.shadingBlend.flow(e,"i"),u=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0,h=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,d=this.reflectivity?this.reflectivity.flow(e,"f"):void 0;e.requires.transparent=c!==void 0,e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join(`
`));let p=["#include <clipping_planes_fragment>","	#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	PhysicalMaterial material;","	material.diffuseColor = vec3( 1.0 );"];if(this.bumpMap){e.include(bx.dHdxy),e.include(bx.perturbNormalArb);let v=this.bumpMap.texture.flow(e,"t"),g=this.bumpMap.flow(e,"v3"),w=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",S="";this.bumpMap.projection.value===4?S=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${v.result}, uv0, ${w});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${v.result}, uv1, ${w});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${v.result}, uv2, ${w});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:S=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${v.result}, bumpMapCachedUv, ${w});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,p.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${g.result};
					${S}
					`)}if(p.push(n.code,"	vec3 diffuseColor = "+n.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",a.code,"	float metalnessFactor = "+a.result+";"),this.roughnessMap){let v=this.roughnessMap.texture.flow(e,"t"),g=this.roughnessMap.flow(e,"v3"),w="";this.roughnessMap.projection.value===4?w=`
					float roughnessChange = 1.0;
					{
						vec2 uv0 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						float r0 = luminance(texture(${v.result}, uv0).rgb) * roughnessScale;
						float r1 = luminance(texture(${v.result}, uv1).rgb) * roughnessScale;
						float r2 = luminance(texture(${v.result}, uv2).rgb) * roughnessScale;

						roughnessChange = (r0 * weights.z + r1 * weights.x + r2 * weights.y);
					}
					float roughnessFactor = roughnessChange * ${s.result};
					`:w=`
					vec2 roughnessMapCachedUv = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs;

					vec4 vals = texture(${v.result},  roughnessMapCachedUv);
					float roughnessFactor = luminance(vals.rgb) * ${s.result};
					`,p.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${g.result};

					const float roughnessScale = 1.0;

					${w}
				`)}else p.push(s.code,"	float roughnessFactor = "+s.result+";");c&&p.push(c.code,"#ifdef ALPHATEST","	if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),p.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),p.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),d?p.push(d.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+d.result+" ) ), diffuseColor, metalnessFactor );"):p.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),p.push("#include <lights_fragment_begin>"),p.push("#include <lights_fragment_end>"),p.push("vec3 ao = aoEnabled && "+r.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular;");let m="1.0";this.mask&&(this.mask.analyze(e),m=`luminance(${this.mask.flow(e,"v3").result})`),p.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${o.result} * ${m} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${o.result} * ${m}, ${l.result} );
					
					outgoingLight *= ao;
				}
				`),u&&p.push(u.code,`outgoingLight = spe_blend(outgoingLight, ${u.result}, 1.0, SPE_BLENDING_NORMAL);`),c?p.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result} );`):p.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h&&p.push(`gl_FragColor.a *= ${h.result};`),p.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=p.join(`
`)}return t}},k3e=class extends xs{constructor(){super("toon"),this.nodeType="Toon",this.color=new bn(fl),this.specular=new bn(1118481),this.shininess=new Ft(30),this.previousModelViewMatrix=new eh,this.previouseProjectionMatrix=new eh,this.shadingAlpha=new Ft(1),this.shadingBlend=new Pr(0)}get category(){return"toon"}build(e){let t;if(e.define("TOON"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:oi.frameIndex}),e.mergeUniform({resolution:oi.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(kx.merge([Dt.fog,Dt.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <fog_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:oi.penumbraSize}),e.mergeUniform({frameIndex:oi.frameIndex}),e.mergeUniform({aoMap:oi.aoRenderTarget}),e.mergeUniform({aoEnabled:oi.aoEnabled}),this.color===void 0&&(this.color=new bn(fl)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),r=this.specular.flow(e,"c"),n=this.shininess.flow(e,"f"),s=this.shadingAlpha.flow(e,"f"),a=this.shadingBlend.flow(e,"i"),o=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(e,"f"):void 0,u=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=l!==void 0,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>",`
					varying vec3 vViewPosition;
					struct ToonMaterial {
						vec3	diffuseColor;
						vec3	specularColor;
						float	specularShininess;
						float	specularStrength;
					};
					void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
			
						reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
						reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
					}
					void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
					}
					#define RE_Direct				RE_Direct_Toon
					#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
					#define Material_LightProbeLOD( material )	(0)
					`,"#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join(`
`));let c=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	ToonMaterial material;"];if(this.bumpMap){e.include(bx.dHdxy),e.include(bx.perturbNormalArb);let d=this.bumpMap.texture.flow(e,"t"),p=this.bumpMap.flow(e,"v3"),m=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",v="";this.bumpMap.projection.value===4?v=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${d.result}, uv0, ${m});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${d.result}, uv1, ${m});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${d.result}, uv2, ${m});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:v=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${d.result}, bumpMapCachedUv, ${m});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,c.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${p.result};
					${v}
					`)}c.push(i.code,"	vec3 diffuseColor = "+i.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",r.code,"	vec3 specular = "+r.result+";",n.code,"	float shininess = max( 0.0001, "+n.result+" );","	float specularStrength = 1.0;"),l&&c.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),c.push("material.diffuseColor = diffuseColor;"),c.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),c.push("vec3 ao = aoEnabled ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * ao) + reflectedLight.directSpecular;");let h="1.0";this.mask&&(this.mask.analyze(e),h=`luminance(${this.mask.flow(e,"v3").result})`),c.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${s.result} * ${h} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${s.result} * ${h}, ${a.result} );
				}
				`),o&&c.push(o.code,`outgoingLight = spe_blend(outgoingLight, ${o.result}, 1.0, SPE_BLENDING_NORMAL);`),l?c.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${l.result} );`):c.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),u&&c.push(`gl_FragColor.a *= ${u.result};`),c.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=c.join(`
`)}return t}},B3e=class{constructor(e=1e3*10){this.timeout=e,this.cache=new Map,this.head={data:null,time:0,src:null,next:null,prev:null},this.tail={data:null,time:1/0,src:null,next:null,prev:null},this.hasClean=!1,this.head.next=this.tail,this.tail.prev=this.head}log(...e){}remove(e){let t=this.cache.get(e);t&&(this.dispose(e,t.data),this.cache.delete(e),t.prev.next=t.next,t.next.prev=t.prev)}scheduleCleanup(){this.hasClean||(this.log("scheduled cleanup"),this.hasClean=!0,setTimeout(()=>{this.hasClean=!1,this.log("cleaning");let e=Date.now(),t=this.head.next;for(;t.time<e-this.timeout;)this.dispose(t.src,t.data),this.cache.delete(t.src),t=t.next,t.prev=this.head,this.head.next=t;this.head.next!==this.tail?this.scheduleCleanup():this.log("no more cleanup")},this.timeout+1e3))}has(e){return this.cache.get(e)?.data}load(e){let t=Date.now(),i=this.cache.get(e);return i===void 0?(i={data:this.create(e),src:e,time:t,next:null,prev:null},this.cache.set(e,i)):(i.time=t,i.prev.next=i.next,i.next.prev=i.prev),i.prev=this.tail.prev,i.next=this.tail,this.tail.prev.next=i,this.tail.prev=i,this.scheduleCleanup(),i.data}},N3e=class extends B3e{create(e){return URL.createObjectURL(new Blob([e]))}dispose(e,t){URL.revokeObjectURL(t)}},bD;function F3e(e){return typeof e=="string"?e:(bD||(bD=new N3e),bD.load(e))}var U3e=class{constructor(e,t){this.data=e,this.cache=t,this.refCount=0}deref(){this.refCount,this.refCount-=1,this.refCount===0&&(this.cache.remove(this),this.dispose())}dispose(){this.refCount}},V3e=class{constructor(){this.cache=new Map}remove(e){this.cache.delete(e.data)}load(e){let t=this.cache.get(e);return t===void 0&&(t=this.create(e),this.cache.set(e,t)),t.refCount+=1,t}},kQ=class extends U3e{constructor(e,t){super(e,t.imageHolderCache),this.data=e,this.shared=t,this.loaded=!1,this.isVideo=!1,this.isBuffer=!1,this._cache={1e3:{},1001:{},1002:{}},this.isVideo=e.type==="video",this.isBuffer=e.isWebGLRenderTarget===!0,this.loadPromise=this.updateSrc(this.isBuffer?e:e.data)}async updateSrc(e){if(typeof document>"u")return;this.disposeTextures(),this.loaded=!1;let t=()=>{this.loaded=!0;for(let r of Object.values(this._cache))for(let n of Object.values(r))for(let s of Object.values(n))s&&(s.image=this.img,s.needsUpdate=!0);this.shared.requestRender()};if(this.isBuffer)this.img=e,this.loaded=!0;else if(this.isVideo){if(this.img=document.createElement("video"),this.img.preload="auto",this.img.playsInline=!0,this.img.currentTime=.01,typeof e!="string"){var i=new FileReader;i.readAsDataURL(new Blob([e],{type:"video/mp4"}));let r;await new Promise(n=>{i.onloadend=s=>{r=s.target?.result,n(null)}}),this.img.src=r}else this.img.src=e;this.img.onloadeddata=()=>{t()}}else this.img=new Image,this.img.src=F3e(e),this.img.onload=t,await new Promise(r=>{this.img.onload=()=>{t(),r(null)}})}getTexture(e,t=1008,i=1006){let r=this._cache[e]?.[t]?.[i];if(r)return r;{let n;return this.isBuffer?n=this.img.texture:this.isVideo?n=new Ave(this.img,void 0,e,e):n=new tn(this.img,void 0,e,e,i,t),this.loaded&&(n.needsUpdate=!0),this._cache[e]===void 0&&(this._cache[e]={}),this._cache[e][t]===void 0&&(this._cache[e][t]={}),this._cache[e][t][i]=n,n}}setNeedsUpdate(e){for(let t of Object.values(this._cache))for(let i of Object.values(t))for(let r of Object.values(i))r&&(r.needsUpdate=e)}disposeTextures(){for(let[e,t]of Object.entries(this._cache))for(let[i,r]of Object.entries(t))for(let[n,s]of Object.entries(r))s?.dispose(),this._cache[e]!==void 0&&this._cache[e][i]!==void 0&&(this._cache[e][i][n]=void 0)}dispose(){super.dispose(),this.disposeTextures()}},sp=class extends kQ{};function j3e(e,t){var i=q3e(t);return i.formatToParts?W3e(i,e):G3e(i,e)}var H3e={year:0,month:1,day:2,hour:3,minute:4,second:5};function W3e(e,t){try{for(var i=e.formatToParts(t),r=[],n=0;n<i.length;n++){var s=H3e[i[n].type];s>=0&&(r[s]=parseInt(i[n].value,10))}return r}catch(a){if(a instanceof RangeError)return[NaN];throw a}}function G3e(e,t){var i=e.format(t).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(i);return[r[3],r[1],r[2],r[4],r[5],r[6]]}var _D={};function q3e(e){if(!_D[e]){var t=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:"America/New_York",year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),i=t==="06/25/2014, 00:00:00"||t==="06/25/2014 00:00:00";_D[e]=i?new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}return _D[e]}function BQ(e,t,i,r,n,s,a){var o=new Date(0);return o.setUTCFullYear(e,t,i),o.setUTCHours(r,n,s,a),o}var Pj=36e5,X3e=6e4,SD={timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-]\d{2}):?(\d{2})$/};function NQ(e,t,i){var r,n;if(!e||(r=SD.timezoneZ.exec(e),r))return 0;var s;if(r=SD.timezoneHH.exec(e),r)return s=parseInt(r[1],10),Dj(s)?-(s*Pj):NaN;if(r=SD.timezoneHHMM.exec(e),r){s=parseInt(r[1],10);var a=parseInt(r[2],10);return Dj(s,a)?(n=Math.abs(s)*Pj+a*X3e,s>0?-n:n):NaN}if(K3e(e)){t=new Date(t||Date.now());var o=i?t:Y3e(t),l=$L(o,e),u=i?l:Q3e(t,l,e);return-u}return NaN}function Y3e(e){return BQ(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}function $L(e,t){var i=j3e(e,t),r=BQ(i[0],i[1]-1,i[2],i[3]%24,i[4],i[5],0).getTime(),n=e.getTime(),s=n%1e3;return n-=s>=0?s:1e3+s,r-n}function Q3e(e,t,i){var r=e.getTime(),n=r-t,s=$L(new Date(n),i);if(t===s)return t;n-=s-t;var a=$L(new Date(n),i);return s===a?s:Math.max(s,a)}function Dj(e,t){return-23<=e&&e<=23&&(t==null||0<=t&&t<=59)}var Rj={};function K3e(e){if(Rj[e])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:e}),Rj[e]=!0,!0}catch{return!1}}var Z3e=Hp(fhe(),1),Ij=Hp(phe(),1),J3e=/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/,$3e=J3e,MD=36e5,Lj=6e4,eDe=2,ao={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:$3e};function tDe(e,t){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(e===null)return new Date(NaN);var i={},r=i.additionalDigits==null?eDe:(0,Z3e.default)(i.additionalDigits);if(r!==2&&r!==1&&r!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]")return new Date(e.getTime());if(typeof e=="number"||Object.prototype.toString.call(e)==="[object Number]")return new Date(e);if(!(typeof e=="string"||Object.prototype.toString.call(e)==="[object String]"))return new Date(NaN);var n=iDe(e),s=rDe(n.date,r),a=s.year,o=s.restDateString,l=nDe(o,a);if(isNaN(l))return new Date(NaN);if(l){var u=l.getTime(),c=0,h;if(n.time&&(c=sDe(n.time),isNaN(c)))return new Date(NaN);if(n.timeZone||i.timeZone){if(h=NQ(n.timeZone||i.timeZone,new Date(u+c)),isNaN(h))return new Date(NaN)}else h=(0,Ij.default)(new Date(u+c)),h=(0,Ij.default)(new Date(u+c+h));return new Date(u+c+h)}else return new Date(NaN)}function iDe(e){var t={},i=ao.dateTimePattern.exec(e),r;if(i?(t.date=i[1],r=i[3]):(i=ao.datePattern.exec(e),i?(t.date=i[1],r=i[2]):(t.date=null,r=e)),r){var n=ao.timeZone.exec(r);n?(t.time=r.replace(n[1],""),t.timeZone=n[1].trim()):t.time=r}return t}function rDe(e,t){var i=ao.YYY[t],r=ao.YYYYY[t],n;if(n=ao.YYYY.exec(e)||r.exec(e),n){var s=n[1];return{year:parseInt(s,10),restDateString:e.slice(s.length)}}if(n=ao.YY.exec(e)||i.exec(e),n){var a=n[1];return{year:parseInt(a,10)*100,restDateString:e.slice(a.length)}}return{year:null}}function nDe(e,t){if(t===null)return null;var i,r,n,s;if(e.length===0)return r=new Date(0),r.setUTCFullYear(t),r;if(i=ao.MM.exec(e),i)return r=new Date(0),n=parseInt(i[1],10)-1,zj(t,n)?(r.setUTCFullYear(t,n),r):new Date(NaN);if(i=ao.DDD.exec(e),i){r=new Date(0);var a=parseInt(i[1],10);return lDe(t,a)?(r.setUTCFullYear(t,0,a),r):new Date(NaN)}if(i=ao.MMDD.exec(e),i){r=new Date(0),n=parseInt(i[1],10)-1;var o=parseInt(i[2],10);return zj(t,n,o)?(r.setUTCFullYear(t,n,o),r):new Date(NaN)}if(i=ao.Www.exec(e),i)return s=parseInt(i[1],10)-1,kj(t,s)?Oj(t,s):new Date(NaN);if(i=ao.WwwD.exec(e),i){s=parseInt(i[1],10)-1;var l=parseInt(i[2],10)-1;return kj(t,s,l)?Oj(t,s,l):new Date(NaN)}return null}function sDe(e){var t,i,r;if(t=ao.HH.exec(e),t)return i=parseFloat(t[1].replace(",",".")),AD(i)?i%24*MD:NaN;if(t=ao.HHMM.exec(e),t)return i=parseInt(t[1],10),r=parseFloat(t[2].replace(",",".")),AD(i,r)?i%24*MD+r*Lj:NaN;if(t=ao.HHMMSS.exec(e),t){i=parseInt(t[1],10),r=parseInt(t[2],10);var n=parseFloat(t[3].replace(",","."));return AD(i,r,n)?i%24*MD+r*Lj+n*1e3:NaN}return null}function Oj(e,t,i){t=t||0,i=i||0;var r=new Date(0);r.setUTCFullYear(e,0,4);var n=r.getUTCDay()||7,s=t*7+i+1-n;return r.setUTCDate(r.getUTCDate()+s),r}var aDe=[31,28,31,30,31,30,31,31,30,31,30,31],oDe=[31,29,31,30,31,30,31,31,30,31,30,31];function FQ(e){return e%400===0||e%4===0&&e%100!==0}function zj(e,t,i){if(t<0||t>11)return!1;if(i!=null){if(i<1)return!1;var r=FQ(e);if(r&&i>oDe[t]||!r&&i>aDe[t])return!1}return!0}function lDe(e,t){if(t<1)return!1;var i=FQ(e);return!(i&&t>366||!i&&t>365)}function kj(e,t,i){return!(t<0||t>52||i!=null&&(i<0||i>6))}function AD(e,t,i){return!(e!=null&&(e<0||e>=25)||t!=null&&(t<0||t>=60)||i!=null&&(i<0||i>=60))}function uDe(e,t,i){var r=tDe(e,i),n=NQ(t,r,!0),s=new Date(r.getTime()-n),a=new Date(0);return a.setFullYear(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate()),a.setHours(s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds(),s.getUTCMilliseconds()),a}function lo(e,t){return t.color(e)}function Bj(e=new Date,t){let i=t.format,r=e.getSeconds(),n=e;t&&t.timeZone!==null&&(n=uDe(new Date,t.timeZone));let s=n.getHours(),a=n.getMinutes(),o;t.format12h24h==="12ampm"&&(o=s>=12?"PM":"AM");let l=s;t.format12h24h!=="24"&&(l=s%12,l===0&&(l=12));let u,c;switch(i){case"HH:mm:ss":u=[l,a,r];break;case"HH:mm":u=[l,a];break;case"HH":u=[l],o=void 0;break;case"mm":u=[a],o=void 0;break;case"ss":u=[r],o=void 0;break;case"year":c=n.getFullYear();break;case"month":c=n.getMonth()+1;break;case"dayOfYear":c=Math.floor((n.getTime()-new Date(n.getFullYear(),0,0).getTime())/864e5);break;case"dayOfMonth":c=n.getDate();break;case"secondOfDay":c=s*60*60+a*60+r;break;default:console.error("Unknown time format",i),c=0;break}return u!==void 0?{textValue:u,suffix:o}:c}function cDe(e,t){switch(e.type){case"fresnel":return fDe(e,t);case"gradient":return pDe(e,t);case"depth":return mDe(e,t);case"normal":return gDe(e,t);case"noise":return vDe(e,t);case"rainbow":return yDe(e,t);case"toon":return xDe(e,t);case"outline":return wDe(e,t);case"transmission":return bDe(e,t);case"color":return dDe(e,t);case"pattern":return _De(e,t)}}function hDe(e){return{type:e.type}}function Yu(e,t){let{alpha:i,mode:r,isMask:n}=e,s=typeof i=="string"?(Number(t.getVariable(i))??100)/100:i;return{...hDe(e),alpha:s,mode:r,isMask:n}}function dDe(e,t){return{...Yu(e,t),color:lo(e.color,t)}}function fDe(e,t){let{bias:i,scale:r,intensity:n,factor:s,color:a}=e;return{...Yu(e,t),color:lo(a,t),bias:i,scale:r,intensity:n,factor:s}}function pDe(e,t){let{gradientType:i,smooth:r,colors:n,steps:s,angle:a,offset:o,morph:l}=e;return{...Yu(e,t),gradientType:i,smooth:r,colors:n.map(u=>new bi(u[0],u[1],u[2],u[3])),num:n.length,steps:s,offset:new Pe(...o),morph:new Pe(...l),angle:a}}function mDe(e,t){let{gradientType:i,near:r,far:n,isVector:s,isWorldSpace:a,origin:o,direction:l,colors:u,steps:c,smooth:h}=e;return{...Yu(e,t),gradientType:i,near:r,far:n,isVector:s,isWorldSpace:a,origin:new H(...o),direction:l?new H(...l):new H(1,0,0),colors:u.map(d=>d!==void 0?new bi(d[0],d[1],d[2],d[3]):new bi(0,0,0,0)),steps:c.slice(0,u.length),smooth:h}}function gDe(e,t){let{cnormal:i}=e;return{...Yu(e,t),cnormal:new H(i[0],i[1],i[2])}}function vDe(e,t){return{...Yu(e,t),scale:e.scale,move:e.move,fA:new Pe(...e.fA),fB:new Pe(...e.fB),size:new H(...e.size),distortion:new Pe(...e.distortion),colorA:lo(e.colorA,t),colorB:lo(e.colorB,t),colorC:lo(e.colorC,t),colorD:lo(e.colorD,t),noiseType:e.noiseType,voronoiStyle:e.voronoiStyle,highCut:e.highCut,lowCut:e.lowCut,smoothness:e.smoothness,seed:e.seed,quality:e.quality}}function yDe(e,t){return{...Yu(e,t),filmThickness:e.filmThickness,movement:e.movement,wavelengths:new H(...e.wavelengths),noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,offset:new H(...e.offset)}}function xDe(e,t){return{...Yu(e,t),positioning:e.positioning,colors:e.colors.map(i=>new bi(i[0],i[1],i[2],i[3])),num:e.colors.length,steps:e.steps,source:new H(...e.source),isWorldSpace:e.isWorldSpace,noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,shadowColor:lo(e.shadowColor,t),offset:new H(...e.offset)}}function wDe(e,t){return{...Yu(e,t),outlineColor:lo(e.outlineColor,t),contourColor:lo(e.contourColor,t),outlineWidth:e.outlineWidth,contourWidth:e.contourWidth,outlineThreshold:e.outlineThreshold,contourThreshold:e.contourThreshold,outlineSmoothing:e.outlineSmoothing,contourFrequency:e.contourFrequency,contourDirection:new H(...e.contourDirection),positionalLines:e.positionalLines,compensation:e.compensation}}function bDe(e,t){return{...Yu(e,t),thickness:e.thickness,ior:e.ior,roughness:e.roughness}}function _De(e,t){return{...Yu(e,t),style:e.style,projection:e.projection,axis:e.axis,blending:e.blending,offset:new Pe(...e.offset),colorA:lo(e.colorA,t),colorB:lo(e.colorB,t),frequency:new Pe(...e.frequency),size:e.size,variation:e.variation,smoothness:e.smoothness,zigzag:e.zigzag,rotation:e.rotation,vertical:new Pe(...e.vertical),horizontal:new Pe(...e.horizontal),sides:e.sides}}var tC=class extends Gs{},SDe={noise:["noiseType"],texture:["projection","axis","side"],video:["projection","axis","side"],displace:["noiseType"],light:["roughnessMap","bumpMap"],depth:["smooth","isWorldSpace","gradientType","isVector"],pattern:["style","projection","axis"]},MDe={depth:["colors"]};function ADe(e,t,i){if(t==="isMask")return!0;let r=SDe[e.type],n=MDe[e.type];if(n!==void 0){let s=e.color;if(n.includes(t)){let a=s[t]?.value?.length;if(a!==void 0&&a!==i.length)return!0}}return r!==void 0?r.includes(t):!1}function ED(e,t){if(Array.isArray(t)){if(!Array.isArray(e)||e.length!==t.length)return!1;for(let[n,s]of t.entries()){let a=e[n];if(typeof s=="string"||typeof s=="number"&&typeof a=="string")return!0}return!1}let i=typeof e=="string",r=typeof t=="string";return i!==r||i&&r}function pB(e,t,i){let r=i.uniforms[`f${i.id}_texture`];if(!r)return!1;let n=!1,s=e;if("image"in s){let a=s.image,o=t.image(a),l=r;l.image instanceof sp||l.image.deref(),l.image=o}if("video"in s){let a=s.video,o=t.video(a),l=r;l.image instanceof sp||l.image.deref(),l.image=o}if("wrapping"in s){let a=r;a.wrap=s.wrapping}if("minFilter"in s){let a=r;a.minFilter=s.minFilter}if("magFilter"in s){let a=r;a.magFilter=s.magFilter}if("rotation"in s&&i.uniforms[`f${i.id}_rotation`])return i.uniforms[`f${i.id}_rotation`].value=(fi(s.rotation??0,t)??0)*Ot.DEG2RAD,n;if("repeat"in s||"offset"in s||"rotation"in s){let a="mat",o=i.uniforms[`f${i.id}_${a}`];if(!o)return n;if("repeat"in s){let l=s.repeat;ED(i.data.texture.repeat,l)&&(n=!0),o.repeat=db(l,t).map((u,c)=>typeof l[c]=="string"?1/u:u)}if("offset"in s){let l=s.offset;ED(i.data.texture.offset,l)&&(n=!0),o.offset=db(l,t).map((u,c)=>typeof l[c]=="string"?-u:u)}if("rotation"in s){let l=i.data.texture.rotation,u=s.rotation??0;(l===void 0||ED(l,u))&&(n=!0),o.rotation=fi(u,t)??0}o.updateMatrix()}return n}function EDe(e,t,i,r){let n=!1;for(let[s,a]of Object.entries(e)){if(s==="bumpMap"||s==="roughnessMap"){n=!0;continue}if(!s||a===void 0)continue;if(VQ(s,i,r,t)){s==="visible"&&i.type==="light"&&(n=!0);continue}i.visible=r.visible;let o=i.uniforms[`f${i.id}_${s}`];if(o&&!(o instanceof hB))switch(n=n||ADe(i,s,a),o.constructor){case bn:if(typeof a=="string"){let l=t.getColor(a);l&&(o.value=l);break}else{let l=a;o.value instanceof tC?o.value=new Gs(l.r,l.g,l.b,l.a):o.setRGBA(l);break}case id:if(typeof a=="string"){let l=t.getColor(a);l&&(o.value=l);break}else{let l=a;o.value instanceof tC?o.value=new Gs(l.r,l.g,l.b,l.a):o.value.setRGBA(l.r,l.g,l.b,l.a);break}case ha:{let l=a;o.value.setX(l[0]),o.value.setY(l[1]);break}case Ol:{let l=a;o.value.setX(l[0]),o.value.setY(l[1]),o.value.setZ(l[2]);break}case dd:{pB(a,t,i);break}case Jm:{o.value=a.map(l=>new bi(...l));break}default:{o.value=a;break}}}return n}var Qg=(e,t,i)=>Math.max(0,Math.min(1,Number(t.getVariable(typeof e=="number"?e*100:e,i)??100)/100))??1,fi=(e,t,i)=>typeof e=="number"?e:t.getVariable(e,i),Vf=(e,t)=>(e||(e=new H),e.x=fi(e.x,t)??0,e.y=fi(e.y,t)??0,e.z=fi(e.z,t)??0,e),qh=(e,t)=>(e||(e=new Pe),e.x=fi(e.x,t)??0,e.y=fi(e.y,t)??0,e),db=(e,t)=>{let i=e.map(r=>fi(r,t)??0);return[i[0],i[1]]},Y_=class{constructor(e,t,i,r,n){this.id=e,this.uuid=t,this.data=i,this.uniforms={};for(let s in r)this.uniforms[`f${this.id}_${s}`]=r[s];for(let s in i)VQ(s,this,i,n)}get type(){return this.data.type}static create(e,t,i,r){if(i.type==="light")return Dc.createLightLayer(e,t,i,r);if(i.type==="texture"||i.type==="video"){let n=i.type==="texture"?r.uiBuffer(i.texture.image)??r.image(i.texture.image):r.video(i.texture.video),s=new KL(n,i.texture.wrapping,i.texture.minFilter??1008,i.texture.magFilter??1006),a=new T3e(n),o=new P3e(db(i.texture.repeat,r),db(i.texture.offset,r),fi(i.texture.rotation??0,r)),l=new Ft(i.crop?1:0),u=new Pr(i.projection??0),c=new Pr(["x","y","z"].indexOf(i.axis)??0),h=new Pr(i.side??0),d=new ha(i.size?new Pe(...db(i.size,r)):new Pe(100,100)),p=new Ft(i.blending??0),m=new Ft(Qg(i.alpha,r)),v=new Pr(i.mode??0),g=new za(i.isMask??!1),w=new dB(s,a,l,u,c,h,d,p,o,m,v,g),S=new Vr(w.calpha,"f");return new vn(e,t,i,{texture:s,textureSize:a,crop:l,projection:u,axis:c,side:h,size:d,blending:p,mat:o,alpha:m,mode:v,isMask:g},w,v,S,g,r)}else if(i.type==="matcap"){let n=r.image(i.texture.image),s=new KL(n,i.texture.wrapping,i.texture.minFilter??1008,i.texture.magFilter??1006),a=new Ft(Qg(i.alpha,r)),o=new Pr(i.mode??0),l=new za(i.isMask??!1),u=new Ft((fi(i.texture.rotation??0,r)??0)*Ot.DEG2RAD),c=new _Q(s,a,o,l,u),h=new Vr(c.calpha,"f");return new vn(e,t,i,{texture:s,alpha:a,mode:o,isMask:l,rotation:u},c,o,h,l,r)}else if(i.type==="displace")if(i.displacementType==="noise"){let n=new Ol(new H(...i.offset.map(g=>fi(g,r)??0))),s=new Ft(fi(i.scale,r)??10),a=new Ft(fi(i.intensity,r)??8),o=new Ft(fi(i.movement,r)??1),l=new Pr(i.noiseType??0),u=new Pr(i.voronoiStyle??0),c=new Ft(fi(i.smoothness,r)??.5),h=new Ft(fi(i.seed,r)??0),d=new Ft(fi(i.highCut,r)??1),p=new Ft(fi(i.lowCut,r)??0),m=new Pr(fi(i.quality,r)??1),v=new OQ(a,o,n,u,c,h,d,p,m,s,l);return new UQ(e,t,i,{offset:n,scale:s,intensity:a,movement:o,noiseType:l,voronoiStyle:u,smoothness:c,seed:h,highCut:d,lowCut:p,quality:m},v,r)}else throw new Error;else return PDe(e,t,i,r)}updateByOp(e,t,i){let r=e,n=!1;if(r.path[0]===void 0){for(let s of Object.keys(r.props))try{let a=this.data[s],o=t[s];if(Array.isArray(a)&&Array.isArray(o)){for(let[l,u]of o.entries()){let c=a[l];if(typeof u=="string"||typeof u=="number"&&typeof c=="string"){n=!0;break}}if(n)break}else if(typeof o=="string"&&typeof a=="number"||typeof o=="number"&&typeof a=="string"||typeof o=="string"&&typeof a=="string"&&o!==a){n=!0;break}}catch(a){console.error(a)}if(r.type===0)return"type"in r.props||"category"in r.props||"visible"in r.props||"noiseType"in r.props?(i.scene.markNeedsUpdateRendererDirty(),!0):EDe(r.props,i.shared,this,t)||n}else if(r.path[0]==="texture")return"texture"in t||"video"in t?pB(r.props,i.shared,this)||n:!0;return n}dispose(){if(CDe(this)){let e=this.uniforms[`f${this.id}_texture`];if(!e)return!1;let t=e;t.image instanceof sp||t.image.deref()}}hasValueByKey(e){return this.uniforms[e]!==void 0}hasValue(e){return this.hasValueByKey(`f${this.id}_${e}`)}setValue(e,t){let i=`f${this.id}_${e}`;this.hasValueByKey(i)&&t!==void 0&&(this.uniforms[i].value=t)}getNode(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t]}getValue(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t].value}getName(e){let t=/f\d+_(.*)/.exec(e);if(t&&t.length>1)return t[1];console.log(`Layer.getName: error ${e}`)}getNames(){let e=[];for(let t in this.uniforms){let i=this.getName(t);i&&e.push(i)}return e}},vn=class extends Y_{constructor(e,t,i,r,n,s,a,o,l){super(e,t,i,r,l),this.params=r,this.color=n,this.mode=s,this.alpha=a,this.isMask=o}},UQ=class extends Y_{constructor(e,t,i,r,n,s){super(e,t,i,r,s),this.position=n}},Dc=class extends Y_{constructor(e,t,i,r,n,s){super(e,t,i,n,s),this.node=r}static createLightLayer(e,t,i,r){let n,s=new Ft(Qg(i.alpha,r)),a=new Pr(i.mode),o=new Ft(i.bumpMapIntensity),l=new Ft(Qg(i.alphaOverride,r)),u;if(!i.visible)n=new fB,u={};else if(i.category==="lambert"){n=new L3e;let c=new bn(r.color(i.emissive)??0),h=new za(i.occlusion??!0);u={emissive:c,occlusion:h},n.emissive=c,n.occlusion=h}else if(i.category==="toon"){n=new k3e;let c=new Ft(i.shininess??30),h=new bn(r.color(i.specular)??1118481);u={shininess:c,specular:h},n.shininess=c,n.specular=h}else if(i.category==="physical"){n=new z3e;let c=new Ft(i.roughness??.3),h=new Ft(i.metalness??0),d=new Ft(i.reflectivity??.5),p=new za(i.occlusion??!0);u={roughness:c,metalness:h,reflectivity:d,occlusion:p},n.roughness=c,n.metalness=h,n.reflectivity=d,n.occlusion=p}else{n=new O3e;let c=new Ft(i.shininess??30),h=new bn(i.specular!==void 0?r.color(i.specular)??1118481:1118481),d=new za(i.occlusion??!0);u={shininess:c,specular:h,occlusion:d},n.shininess=c,n.specular=h,n.occlusion=d}return n.alpha=new Ft(1),n.shadingAlpha=s,n.shadingBlend=a,n.bumpMapIntensity=o,n.alphaOverride=l,u.alpha=n.shadingAlpha,u.mode=n.shadingBlend,u.bumpMapIntensity=n.bumpMapIntensity,u.alphaOverride=n.alphaOverride,new Dc(e,t,i,n,u,r)}get category(){return this.node.category}};function CDe(e){let t=e instanceof Y_?e.type:e;return t==="texture"||t==="video"||t==="displace_map"||t==="matcap"}function Pl(e){return{alpha:new Ft(e.alpha??1),mode:new Pr(e.mode??0),isMask:new za(e.isMask??!1)}}function TDe(e,t,i,r,n){switch(e.type){case"color":{let s=new bn(r.color??fl),a=Pl(r),o=new ZL(s,a.alpha),l=new Vr(o.calpha,"f");return new vn(t,i,e,{color:s,...a},o,a.mode,l,a.isMask,n)}case"fresnel":{let s=new bn(r.color??16777215),a=new Ft(fi(r.bias,n)??.1),o=new Ft(fi(r.scale,n)??1),l=new Ft(fi(r.intensity,n)??2),u=new Ft(fi(r.factor,n)??1),c=Pl(r),h=new D3e(s,a,o,l,u,c.alpha,c.mode,c.isMask),d=new Vr(h.calpha,"f");return new vn(t,i,e,{color:s,bias:a,scale:o,intensity:l,factor:u,...c},h,c.mode,d,c.isMask,n)}case"rainbow":{let s=new Ft(fi(r.filmThickness,n)??30),a=new Ft(fi(r.movement,n)??0),o=new Ol(Vf(r.wavelengths,n)),l=new Ft(fi(r.noiseStrength,n)??0),u=new Ft(fi(r.noiseScale,n)??1),c=new Ol(Vf(r.offset,n)),h=Pl(r),d=new TQ(s,a,o,l,u,c,h.alpha,h.isMask),p=new Vr(d.calpha,"f");return new vn(t,i,e,{filmThickness:s,movement:a,wavelengths:o,noiseStrength:l,noiseScale:u,offset:c,...h},d,h.mode,p,h.isMask,n)}case"transmission":{let s=new Ft(fi(r.thickness??10,n)),a=new Ft(fi(r.ior??1.5,n)),o=new Ft(fi(r.roughness??.5,n)),l=oi.transmissionSize,u=oi.transmissionRenderTarget,c=oi.transmissionRenderTargetDepth,h=window.innerWidth,d=window.innerHeight,p=h>=d?new ha(d/h,1):new ha(1,h/d),m=Pl(r),v=new IQ(s,a,o,l,u,c,p,m.alpha),g=new Vr(v.calpha,"f");return new vn(t,i,e,{thickness:s,ior:a,roughness:o,aspectRatio:p,...m},v,m.mode,g,m.isMask,n)}case"toon":{let s=new Pr(r.positioning??0),a;r.colors?a=new Jm(r.colors.length,r.colors):(a=new Jm(10,new bi(0,0,0,1)),a.value[1]=new bi(1,1,1,1));let o;r.steps?o=new Zm(r.steps.length,r.steps):(o=new Zm(10,1),o.value[0]=0);let l=new Ol(Vf(r.source??new H(0,0,0),n)),u=new za(r.isWorldSpace??!0),c=new Ft(fi(r.noiseStrength??0,n)),h=new Ft(fi(r.noiseScale??1,n)),d=new id(r.shadowColor),p=new Ol(Vf(r.offset??new H(0,0,0),n)),m=Pl(r),v=new DQ(s,a,o,l,u,c,h,d,p,m.alpha),g=new Vr(v.calpha,"f");return new vn(t,i,e,{positioning:s,colors:a,steps:o,source:l,isWorldSpace:u,noiseStrength:c,noiseScale:h,shadowColor:d,offset:p,...m},v,m.mode,g,m.isMask,n)}case"outline":{let s=new bn(r.outlineColor??16777215),a=new bn(r.contourColor??16777215),o=new Ft(fi(r.outlineWidth??.1,n)),l=new Ft(fi(r.contourWidth??.1,n)),u=new Ft(fi(r.outlineThreshold??.1,n)),c=new Ft(fi(r.contourThreshold??.1,n)),h=new Ft(fi(r.outlineSmoothing??.1,n)),d=new Ft(fi(r.contourFrequency??.1,n)),p=new Ol(Vf(r.contourDirection??new H(0,1,0),n)),m=new za(r.positionalLines??!1),v=new za(r.compensation??!0),g=oi.normalRenderTarget,w=oi.normalRenderTargetDepth,S=oi.pixelRatioNode,_=oi.resolution,A=Pl(r),C=new AQ(s,a,o,l,u,c,h,d,p,m,v,_,g,w,S,A.alpha),E=new Vr(C.calpha,"f");return new vn(t,i,e,{outlineColor:s,contourColor:a,outlineWidth:o,contourWidth:l,outlineThreshold:u,contourThreshold:c,outlineSmoothing:h,contourFrequency:d,contourDirection:p,positionalLines:m,compensation:v,...A},C,A.mode,E,A.isMask,n)}case"depth":{let s=new Pr(r.gradientType??0),a=new za(r.smooth??!1),o=new Ft(fi(r.near,n)??50),l=new Ft(fi(r.far,n)??200),u=new Ft(r.isVector??1),c=new Ft(r.isWorldSpace??0),h=new Ol(Vf(r.origin,n)),d=new Ol(Vf(r.direction,n)),p;r.colors?p=new Jm(r.colors.length,r.colors):(p=new Jm(2,new bi(0,0,0,1)),p.value[1]=new bi(1,1,1,1));let m;r.steps?m=new Zm(r.steps.length,r.steps):(m=new Zm(2,1),m.value[0]=0);let v=Pl(r),g=new yQ(s,a,o,l,u,c,h,d,p,m,v.alpha,v.isMask),w=new Vr(g.calpha,"f");return new vn(t,i,e,{gradientType:s,smooth:a,near:o,far:l,isVector:u,isWorldSpace:c,origin:h,direction:d,colors:p,steps:m,...v},g,v.mode,w,v.isMask,n)}case"noise":{let s=new Ft(fi(r.scale,n)??1),a=new Ol(Vf(r.size??new H(100,100,100),n)),o=new Ft(fi(r.move,n)??1),l=new ha(qh(r.fA??new Pe(1.7,9.2),n)),u=new ha(qh(r.fB??new Pe(8.3,2.8),n)),c=new ha(qh(r.distortion??new Pe(1,1),n)),h=new id(r.colorA),d=new id(r.colorB),p=new id(r.colorC),m=new id(r.colorD),v=new Pr(r.noiseType??0),g=new Pr(r.voronoiStyle??0),w=new Ft(fi(r.highCut,n)??1),S=new Ft(fi(r.lowCut,n)??0),_=new Ft(fi(r.smoothness,n)??.5),A=new Ft(fi(r.seed,n)??.5),C=new Pr(r.quality??1),E=Pl(r),I=new SQ(s,a,o,l,u,c,h,d,p,m,E.alpha,v,E.isMask,g,w,S,_,A,C),T=new Vr(I.calpha,"f");return new vn(t,i,e,{scale:s,size:a,move:o,fA:l,fB:u,distortion:c,colorA:h,colorB:d,colorC:p,colorD:m,noiseType:v,...E,voronoiStyle:g,highCut:w,lowCut:S,smoothness:_,seed:A,quality:C},I,E.mode,T,E.isMask,n)}case"normal":{let s=new Ol(r.cnormal??new H(1,1,1)),a=Pl(r),o=new vQ(s,a.alpha),l=new Vr(o.calpha,"f");return new vn(t,i,e,{cnormal:s,...a},o,a.mode,l,a.isMask,n)}case"gradient":{let s=new Pr(r.gradientType??0),a=new za(r.smooth??!1),o;r.colors?o=new Jm(r.colors.length,r.colors):(o=new Jm(10,new bi(0,0,0,1)),o.value[1]=new bi(1,1,1,1));let l;r.steps?l=new Zm(r.steps.length,r.steps):(l=new Zm(10,1),l.value[0]=0);let u=new ha(qh(r.offset??new Pe(0,0),n)),c=new ha(qh(r.morph??new Pe(0,0),n)),h=new Ft(fi(r.angle??0,n)),d=Pl(r),p=new wQ(s,a,o,l,u,c,h,d.alpha,d.isMask),m=new Vr(p.calpha,"f");return new vn(t,i,e,{gradientType:s,smooth:a,colors:o,steps:l,offset:u,morph:c,angle:h,...d},p,d.mode,m,d.isMask,n)}case"pattern":{let s=new Pr(r.style??0),a=new Pr(r.projection??0),o=new Pr(["x","y","z"].indexOf(r.axis)??0),l=new Ft(fi(r.blending??0,n)),u=new ha(qh(r.offset,n)),c=new id(r.colorA),h=new id(r.colorB),d=new ha(qh(r.frequency??new Pe(10,10),n)),p=new Ft(fi(r.size??.5,n)),m=new Ft(fi(r.variation??0,n)),v=new Ft(fi(r.smoothness??.5,n)),g=new Ft(fi(r.zigzag??0,n)),w=new Ft(fi(r.rotation??0,n)),S=new ha(qh(r.vertical??new Pe(0,1),n)),_=new ha(qh(r.horizontal??new Pe(0,1),n)),A=new Pr(r.sides??6),C=Pl(r),E=new EQ(s,a,o,l,u,c,h,d,p,m,v,g,w,S,_,A,C.alpha,C.isMask),I=new Vr(E.calpha,"f");return new vn(t,i,e,{style:s,projection:a,axis:o,blending:l,offset:u,colorA:c,colorB:h,frequency:d,size:p,variation:m,smoothness:v,zigzag:g,rotation:w,vertical:S,horizontal:_,sides:A,...C},E,C.mode,I,C.isMask,n)}default:{let s=new bn(1,0,0,1),a=Pl(r),o=new ZL(s,a.alpha),l=new Vr(o.calpha,"f");return new vn(t,i,e,{color:s,...a},o,a.mode,l,a.isMask,n)}}}function PDe(e,t,i,r){let n=cDe(i,r);return TDe(i,e,t,n,r)}function VQ(e,t,i,r){if(i.type==="displace"&&(e==="intensity"||e==="visible")){let n=t.uniforms[`f${t.id}_intensity`];return n?(n.value=(fi(i.intensity,r)??1)*(i.visible?1:0),n):void 0}if(i.type!=="displace"&&(e==="alpha"||e==="visible")){let n=t.uniforms[`f${t.id}_alpha`];if(!n)return;if(n.value=Qg(i.alpha,r)*(i.visible?1:0),i.type==="outline"&&e==="visible"){let s=t.uniforms[`f${t.id}_compensation`];s&&(s.value=i.compensation&&i.visible)}return n}}function Ro(e,t,i,r,n,s,a=[]){let o=i;for(let l of a)l in o&&(o=o[l]);for(let l of e)l in o&&n.getVariable(o[l],["material",s,"layer",r,...a,String(l)]);for(let l of t)l in o&&o[l].forEach((u,c)=>{n.getVariable(u,["material",s,"layer",r,...a,String(l),c===0?"x":c===1?"y":"z"])})}function Iy(e,t){let i=0,r=e.layers.find(n=>n.data.type==="light");if(r){let n=r.data,s=Number(t.getVariable(n.alphaOverride));if((typeof n.alphaOverride=="string"?s/100:n.alphaOverride)<1)return!0}for(let n of e.layers){if(n.data.type!=="displace"&&n.data.isMask)return!0;if(n.data.type!=="displace"&&"alpha"in n.data&&n.data.type!=="light"&&n.data.type!=="fresnel"&&n.data.type!=="texture"&&n.data.type!=="matcap"&&n.data.type!=="rainbow"&&n.data.type!=="outline"&&n.data.type!=="pattern"){let s=n.data.visible?n.data.alpha:0;if(typeof s=="string"&&(s=Math.max(0,Math.min(1,Number(t.getVariable(s)??100)/100))),s===1&&n.data.type==="depth"||n.data.type==="gradient"){for(let a of n.data.colors)if(a[3]<1){s=a[3];break}}else if(s===1&&n.data.type==="noise"){let a=t.color(n.data.colorA).a,o=t.color(n.data.colorB).a,l=t.color(n.data.colorC).a,u=t.color(n.data.colorD).a,c=Math.min(a,Math.min(o,Math.min(l,u)));c<1&&(s=c)}i+=(1-i)*s}}return i<1}var zd=class extends Zi{constructor(){super(void 0),this.flatShading=!1,this.needsJitter=!0,this.shadersPatchedForShapeBlend=!1,this.nodeContextUuid=0,this.fog=!0,this.dithering=!0,this.vertexColors=!0,this.transparent=!0}customProgramCacheKey(){return""}},DDe=class extends zd{constructor(e,t,i,r){super(),this.flatShading=e,this.side=t,this.wireframe=i,this.root=r}updateAfterBuild(){let e=this.root;this.lights=e.lights,this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader,Object.assign(this.defines,e.defines),Object.assign(this.uniforms,e.uniforms),this.extensions=e.extensions,this.transparent=e.transparent,this.cacheKey=e.customProgramCacheKey()+"flat"+this.flatShading+this.side}onBeforeCompile(e,t){this.root.onBeforeCompile(e)}get data(){return this.root.data}get category(){return this.root.category}get hasAO(){return this.root.hasAO}getFlavor(e,t,i,r){return this.root.getFlavor(e,t,i,r)}get layers(){return this.root.layers}get fragment(){return this.root.fragment}getLayersOfType(e){return this.root.getLayersOfType(e)}getLayerByUuid(e){return this.root.getLayerByUuid(e)}updateByOp(e,t,i){this.root.updateByOp(e,t,i)}nodeMaterialDispose(){this.root.nodeMaterialDispose()}},mB=class extends zd{constructor(e,t,i=!0){super(),this.data=e,this.allowVariableSaves=i,this.layerIdGen=0,this.flavors=[],this.masks={},this.type="NodeMaterial",this.updaters=[],this.needsJitter=t.shared.needsJitter,xs.startContext(this),this.reset0(e,t),xs.endContext(this)}get nodeMaterial(){return this}getFlavor(e,t,i,r){let n=i?6:(e?3:0)+t;if(n+=((r?.resolutionLevel??0)-(r?.useChildrenColors?4:0))*7,n===0)return this;this.flavors===void 0&&(this.flavors=[]),n-=1;let s=this.flavors[n];return s===void 0&&(s=new DDe(e,t,i,this),s.needsJitter=this.needsJitter,this.flavors[n]=s,s.flatShading=e,s.side=t,s.updateAfterBuild(),r&&(s.defines.SHAPEBLEND=r.resolutionLevel,s.defines.SHAPEBLEND_C=r.useChildrenColors?1:0)),s}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.category}get hasAO(){return this.lightLayer.getNode("occlusion")?.value??!1}reset(e,t,i=!1){xs.startContext(this),(this.data!==e||i)&&this.reset0(e,t),xs.endContext(this)}reset0(e,t){this.data=e;let i=e.layers??Vs.defaultTwoLayerData("phong").layers;try{this.layers=i.map(r=>Y_.create(this.layerIdGen++,r.id,r.data,t.shared))}catch{this.layers=[]}this.layers.reverse(),this.name=e.name??"Untitled Material",this.onUpdate(t.shared),this.transparent=Iy(e,t.shared),this.saveVariableLocations(t)}onVariableUpdate(e,t,i){if(e[0]==="alphaOverride")this.transparent=Iy(this.data,i.shared),this.lightLayer.setValue("alphaOverride",Math.max(0,Math.min(Number(t)/100,1)));else if(e[0]==="layer"){let r=e[1],n=e[2];if(r&&n){let s=this.layers.find(a=>a.uuid===r);if(s?.hasValue(n))if(n==="alpha")this.transparent=Iy(this.data,i.shared),s.setValue(n,Math.max(0,Math.min(Number(t)/100,1)));else{let a=s.getValue(n),o=e[3],l=e[4];if(a instanceof tn){let u=a[o],c;typeof u=="number"?c=Number(t):u.isVector2&&(c=u.toArray(),l==="x"?c[0]=Number(t):l==="y"&&(c[1]=Number(t))),pB({[o]:c},i.shared,s);return}(o==="x"||o==="y"||o==="z")&&a.isVector3||(o==="x"||o==="y")&&a.isVector2?a[o]=Number(t):s.setValue(n,t)}}}}saveVariableLocations(e){if(!this.allowVariableSaves)return;let t=this.data.layers.find(i=>i.data.type==="light");t&&e.shared.getVariable(t.data.alphaOverride,["material",this.uuid,"alphaOverride"]),this.data.layers.forEach(i=>{"alpha"in i.data&&typeof i.data.alpha=="string"&&e.shared.getVariable(i.data.alpha,["material",this.uuid,"layer",i.id,"alpha"]),i.data.type==="displace"?i.data.displacementType==="noise"?Ro(["intensity","scale","movement","smoothness","seed","highCut","lowCut"],["offset"],i.data,i.id,e.shared,this.uuid):Ro(["intensity"],[],i.data,i.id,e.shared,this.uuid):i.data.type==="depth"?Ro(["near","far"],["origin","direction"],i.data,i.id,e.shared,this.uuid):i.data.type==="fresnel"?Ro(["bias","scale","intensity","factor"],[],i.data,i.id,e.shared,this.uuid):i.data.type==="rainbow"?Ro(["filmThickness","movement","noiseStrength","noiseScale"],["offset","wavelengths"],i.data,i.id,e.shared,this.uuid):i.data.type==="noise"?Ro(["scale","move","seed","highCut","lowCut","smoothness"],["size","distortion","fA","fB"],i.data,i.id,e.shared,this.uuid):i.data.type==="pattern"?Ro(["blending","size","variation","smoothness","zigzag","rotation"],["offset","frequency","vertical","horizontal"],i.data,i.id,e.shared,this.uuid):i.data.type==="outline"?Ro(["outlineWidth","contourWidth","outlineThreshold","contourThreshold","outlineSmoothing","contourFrequency"],["contourDirection"],i.data,i.id,e.shared,this.uuid):i.data.type==="toon"?Ro(["noiseStrength","noiseScale"],["offset","source"],i.data,i.id,e.shared,this.uuid):i.data.type==="transmission"?Ro(["roughness","thickness","ior"],[],i.data,i.id,e.shared,this.uuid):i.data.type==="texture"||i.data.type==="video"?(Ro([],["size"],i.data,i.id,e.shared,this.uuid),Ro(["rotation"],["repeat","offset"],i.data,i.id,e.shared,this.uuid,["texture"])):i.data.type==="gradient"?Ro(["angle"],["offset","morph"],i.data,i.id,e.shared,this.uuid):i.data.type==="matcap"&&Ro(["rotation"],[],i.data,i.id,e.shared,this.uuid,["texture"])})}getLayersOfType(e){return this.layers.filter(t=>t.type===e)}getLayerByUuid(e){return this.layers.find(t=>t.uuid===e)}onUpdate(e){this.lightLayer=this.layers.find(t=>t instanceof Dc),this.lightLayer===void 0&&(this.lightLayer=new Dc(0,"",{...Jn.defaultData("light","phong"),visible:!1},new fB,{},e)),this.dispose();for(let t of this.flavors)t&&t.dispose();this.applyTextureMaps(),this.applyMasks(),this.blendColors(),this.blendAfterColors(),this.blendPositions(),this.build(),this.nodeContextUuid=0}applyTextureMaps(){let e=this.layers.find(n=>n instanceof Dc);if(!e)return;let t=e.data,i=t.bumpMap,r=t.roughnessMap;e.node.bumpMap=void 0,e.node.roughnessMap=void 0;for(let n=0;n<this.layers.length;++n){let s=this.layers[n];s instanceof vn&&s.color instanceof dB&&(s.uuid===i&&(e.node.bumpMap=s.color),s.uuid===r&&(e.node.roughnessMap=s.color))}}updateByOp(e,t,i){if(xs.startContext(this),t!==void 0?this.data=t:t=this.data,this.transparent=Iy(t,i.shared),e.path[0]==="layers"){let r=i.shared,n=e.path[1];if(n===void 0)i.scene.markNeedsUpdateRendererDirty(),this.reset0(t,i);else{e.type===0&&e.props.occlusion!==void 0&&i.scene.markNeedsUpdateRendererDirty();let s=this.layers.find(a=>a.uuid===n);if(s){let a=t.layers.data(n),o;e.type===0&&("alpha"in e.props||"alphaOverride"in e.props)&&("alpha"in e.props?o={...e.props,alpha:Qg(e.props.alpha,r,["material",this.uuid,"layer",n,"alpha"])}:o={...e.props,alphaOverride:Qg(e.props.alphaOverride,r,["material",this.uuid,"alphaOverride"])}),s.updateByOp({...e,...o?{props:o}:{},path:e.path.slice(2)},a,i)&&this.reset0(t,i)}}}else this.reset0(t,i);xs.endContext(this)}applyMasks(){for(let e=0;e<this.layers.length;++e){let t=this.layers[e];t instanceof vn?t.color.mask=void 0:t instanceof Dc&&(t.node.mask=void 0)}for(let e=0;e<this.layers.length;++e){let t=this.layers[e];if(t instanceof vn&&t.isMask.value&&t.data.visible&&e>0){let i=e-1,r=this.layers[i];r instanceof Dc?r.node.mask=new Lo(t.color,t.alpha,Lo.MUL):r instanceof vn&&(r.isMask.value||(r.color.mask=new Lo(t.color,t.alpha,Lo.MUL)))}}}blendColors(){let e=this.layers.findIndex(i=>i instanceof vn),t=this.layers.findIndex(i=>i instanceof Dc);if(e!==-1&&e<t){let i=this.layers[e].color;for(let r=e+1;r<t;++r){let n=this.layers[r];if(n instanceof vn){if(n.isMask.value)continue;i=new Tj(i,n.color,n.alpha,n.mode)}}this.fragment.color=i}else this.fragment.color=void 0}blendAfterColors(){let e=new Vr("outgoingLight","f"),t=this.layers.findIndex(i=>i instanceof Dc);if(this.layers.length>t+1){for(let i=t+1;i<this.layers.length;++i){let r=this.layers[i];if(r instanceof vn){if(r.isMask.value)continue;e=new Tj(e,r.color,r.alpha,r.mode)}}this.fragment.afterColor=e}else this.fragment.afterColor=void 0}blendPositions(){let e=this.layers.filter(t=>t instanceof UQ);if(e.length>0){let t=e[0].position;for(let i=1;i<e.length;++i)e[i]&&(t=new Lo(t,e[i].position,Lo.ADD),t=new Lo(t,new Ft(.5).setReadonly(!0),Lo.MUL));this.fragment.position=t}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}onBeforeCompile(e){this.shapeBlendhack&&this.shapeBlendhack(this),e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.extensionDerivatives=this.extensions.derivatives===!0,e.extensionFragDepth=this.extensions.fragDepth===!0,e.extensionDrawBuffers=this.extensions.drawBuffers===!0,e.extensionShaderTextureLOD=this.extensions.shaderTextureLOD===!0}clampUniformsForPreview(e,t){let i=(r,n,s)=>Math.min(Math.max(r,n),s);for(let r of this.layers)if(r.type==="displace"){let n=i(r.uniforms[`f${r.id}_intensity`].value,e,t);r.uniforms[`f${r.id}_intensity`].value=n}}updateFrame(e){for(let t=0;t<this.updaters.length;++t)e.updateNode(this.updaters[t])}build(){let e=new fQ;e.needsJitter=this.needsJitter,this.lights=this.lightLayer.data.visible,e.build(this.fragment,this.fragment),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.updaters=e.updaters;for(let t of this.flavors)t&&t.updateAfterBuild();return this.shadersPatchedForShapeBlend=!1,this}nodeMaterialDispose(){this.layers.forEach(e=>e.dispose()),super.dispose();for(let e of this.flavors)e&&e.dispose()}assetsLoaded(){for(let e of this.layers)if(e instanceof vn){let t=e.params.texture;if(t instanceof KL&&!t.image.loaded)return!1}return!0}};Object.defineProperties(zd.prototype,{properties:{get:function(){return this.fragment.properties}}});var eO=class extends mB{constructor(e,t,i){super(e,t,!1),this.uuid=i,this.allowVariableSaves=!0,this.saveVariableLocations(t)}},Nj=new Map;function RDe(e){if(typeof e=="string")return e;let t=Nj.get(e);return t||(t={url:URL.createObjectURL(new Blob([e]))},Nj.set(e,t)),t.url}var jQ,IDe=new Promise(e=>{jQ=e}),Fj=!1,XA;function LDe(){if(Fj)return;if(XA)return XA;async function e(){await Vd(()=>import("./howler-BkNbxYjt.js").then(t=>t.h),[]),jQ(window!==void 0?window:global),Fj=!0}return XA=e(),XA}var HQ;IDe.then(e=>HQ=e);function Uj(e,t){e.forEach(i=>{"dragDropActions"in i.data?(t.push(...i.data.dragDropActions.drag),t.push(...i.data.dragDropActions.drop)):"inActions"in i.data?(t.push(...i.data.inActions),t.push(...i.data.outActions)):"gameActions"in i.data?(t.push(...i.data.gameActions.idle),t.push(...i.data.gameActions.move),t.push(...i.data.gameActions.jump),t.push(...i.data.gameActions.run)):"breakpoints"in i.data?i.data.breakpoints.forEach(r=>{t.push(...r.data.actions)}):"actions"in i.data&&(t.push(...i.data.actions),i.data.actions.forEach(r=>{r.data.type==="Conditional"&&r.data.ifActions&&(t.push(...r.data.ifActions),t.push(...r.data.elseActions))}))})}function ODe(e){let t=!1,i=[];return e.scene.objects.traverse((r,n)=>{if(n.type==="Page"&&n.uiScene!==void 0&&n.uiScene.objects.traverse((s,a)=>{if(a.events===void 0||Array.isArray(a.events)===!1)return!0;Uj(a.events,i),t=t||i.some(o=>o.data.type==="Audio")}),n.events===void 0||Array.isArray(n.events)===!1)return!0;Uj(n.events,i),t=t||i.some(s=>s.data.type==="Audio")}),t}var Qw=class{constructor({src:e,volume:t,delay:i,loop:r}){this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._status="stopped",this.onEnd=()=>{this.loopsRemaining===1/0?this.replay():this.loopsRemaining>1?(this.replay(),this.loopsRemaining--):(this._status="stopped",this.loopsRemaining=this._loop)};let n;typeof e=="string"?n={src:e}:n={src:RDe(e),format:"wav"},this.sound=new HQ.Howl(n),this.sound.on("end",this.onEnd),this.src=e,t!==void 0&&(this.volume=t),i!==void 0&&(this.delay=i),r!==void 0&&(this.loop=r)}get status(){return this._status}get volume(){return this._volume}set volume(e){this._volume=e,this.sound.volume(e)}get loop(){return this._loop}set loop(e){this._loop=e,this.loopsRemaining=e}replay(){this.clearDelay(),this.delayTimerId=window.setTimeout(()=>{this.sound.play(),this.clearDelay()},this.delay)}fade(e,t=1e3){e?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout(()=>{this.sound.fade(this._volume,0,t),this.clearFade()},e)):this.sound.fade(this._volume,0,t)}on(e,t,i){this.sound.on(e,t,i)}off(e,t,i){this.sound.off(e,t,i)}play(){this._status==="playing"||this.sound.playing()||(this._status==="paused"?(this.sound.seek()===0?this.replay():this.sound.play(),this._status="playing"):this._status==="stopped"&&(this.replay(),this._status="playing"))}pause(){this._status==="playing"&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}stop(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(e=!1){this.off(),this.stop(),this.clearFade(),this.clearDelay()}},zDe=class{constructor(){this.type="ShapePath",this.color=new li,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new h2,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath?.lineTo(e,t),this}quadraticCurveTo(e,t,i,r){return this.currentPath?.quadraticCurveTo(e,t,i,r),this}bezierCurveTo(e,t,i,r,n,s){return this.currentPath?.bezierCurveTo(e,t,i,r,n,s),this}splineThru(e){return this.currentPath?.splineThru(e),this}toShapes(){let e={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},t={loc:e.ORIGIN,t:0};function i(p,m,v,g){let w=p.x,S=m.x,_=v.x,A=g.x,C=p.y,E=m.y,I=v.y,T=g.y,D=(A-_)*(C-I)-(T-I)*(w-_),L=(S-w)*(C-I)-(E-C)*(w-_),z=(T-I)*(S-w)-(A-_)*(E-C),G=D/z,V=L/z;if(z===0&&D!==0||G<=0||G>=1||V<0||V>1)return null;if(D===0&&z===0){for(let j=0;j<2;j++)if(r(j===0?v:g,p,m),t.loc===e.ORIGIN){let J=j===0?v:g;return{x:J.x,y:J.y,t:t.t}}else if(t.loc===e.BETWEEN){let J=+(w+t.t*(S-w)).toPrecision(10),ne=+(C+t.t*(E-C)).toPrecision(10);return{x:J,y:ne,t:t.t}}return null}else{for(let ne=0;ne<2;ne++)if(r(ne===0?v:g,p,m),t.loc===e.ORIGIN){let K=ne===0?v:g;return{x:K.x,y:K.y,t:t.t}}let j=+(w+G*(S-w)).toPrecision(10),J=+(C+G*(E-C)).toPrecision(10);return{x:j,y:J,t:G}}}function r(p,m,v){let g=v.x-m.x,w=v.y-m.y,S=p.x-m.x,_=p.y-m.y,A=g*_-S*w;if(p.x===m.x&&p.y===m.y){t.loc=e.ORIGIN,t.t=0;return}if(p.x===v.x&&p.y===v.y){t.loc=e.DESTINATION,t.t=1;return}if(A<-Number.EPSILON){t.loc=e.LEFT;return}if(A>Number.EPSILON){t.loc=e.RIGHT;return}if(g*S<0||w*_<0){t.loc=e.BEHIND;return}if(Math.sqrt(g*g+w*w)<Math.sqrt(S*S+_*_)){t.loc=e.BEYOND;return}let C;g!==0?C=S/g:C=_/w,t.loc=e.BETWEEN,t.t=C}function n(p,m){let v=[],g=[];for(let w=1;w<p.length;w++){let S=p[w-1],_=p[w];for(let A=1;A<m.length;A++){let C=m[A-1],E=m[A],I=i(S,_,C,E);I!==null&&v.find(T=>T.t<=I.t+Number.EPSILON&&T.t>=I.t-Number.EPSILON)===void 0&&(v.push(I),g.push(new Pe(I.x,I.y)))}}return g}function s(p,m,v){let g=new Pe;m.getCenter(g);let w=[];return v.forEach(S=>{S.boundingBox.containsPoint(g)&&n(p,S.points).forEach(_=>{w.push({identifier:S.identifier,isCW:S.isCW,point:_})})}),w.sort((S,_)=>S.point.x-_.point.x),w}function a(p,m,v,g,w){(w==null||w==="")&&(w="nonzero");let S=new Pe;p.boundingBox.getCenter(S);let _=[new Pe(v,S.y),new Pe(g,S.y)],A=s(_,p.boundingBox,m);A.sort((L,z)=>L.point.x-z.point.x);let C=[],E=[];A.forEach(L=>{L.identifier===p.identifier?C.push(L):E.push(L)});let I=C[0].point.x,T=[],D=0;for(;D<E.length&&E[D].point.x<I;)T.length>0&&T[T.length-1]===E[D].identifier?T.pop():T.push(E[D].identifier),D++;if(T.push(p.identifier),w==="evenodd"){let L=T.length%2===0,z=T[T.length-2];return{identifier:p.identifier,isHole:L,for:z}}else if(w==="nonzero"){let L=!0,z=null,G=null;for(let V=0;V<T.length;V++){let j=T[V];m[j]&&(L?(G=m[j].isCW,L=!1,z=j):G!==m[j].isCW&&(G=m[j].isCW,L=!0))}return{identifier:p.identifier,isHole:L,for:z}}else console.warn('fill-rule: "'+w+'" is currently not implemented.')}let o=0,l=999999999,u=-999999999,c=[];this.subPaths.forEach(p=>{let m=p.getPoints(),v=-999999999,g=999999999,w=-999999999,S=999999999;for(let _=0;_<m.length;_++){let A=m[_];A.y>v&&(v=A.y),A.y<g&&(g=A.y),A.x>w&&(w=A.x),A.x<S&&(S=A.x)}u<=w&&(u=w+1),l>=S&&(l=S-1),m.length&&c.push({curves:p.curves,points:m,isCW:Aq.isClockWise(m),identifier:o++,boundingBox:new lk(new Pe(S,g),new Pe(w,v))})});let h=c.map(p=>a(p,c,l,u,this.userData?.style.fillRule)),d=[];return c.forEach(p=>{let m=h[p.identifier];if(m&&!m.isHole){let v=new d2;v.curves=p.curves,h.filter(g=>g?.isHole&&g.for===p.identifier).forEach(g=>{if(g){let w=c[g.identifier],S=new h2;S.curves=w.curves,v.holes.push(S)}}),d.push(v)}}),d}},WQ=!1,GQ,Vj=new Promise(e=>{GQ=e}),jj=!1,YA;function kDe(){if(WQ=!0,jj)return;if(YA)return YA;async function e(){let t=await Vd(()=>import("./opentype-U-0Y99ve.js"),[]);GQ(t),jj=!0}return YA=e(),YA}var BDe=class{async load(e,t,i=()=>{}){let{load:r}=await Vj;r(e,(n,s)=>{n||!s?i(n??"Something went wrong"):t(s)})}async parse(e){let{parse:t,Bidi:i}=await Vj;try{let r=t(e),n=new i,s=a=>r.charToGlyphIndex(a.char);return n.registerModifier("glyphIndex",null,s),n.applyFeatures(r,r.defaultRenderOptions.features),{font:r,bidi:n}}catch(r){console.error(r)}}};async function NDe(e){return await(await fetch(e)).arrayBuffer()}var FDe=new BDe;async function Hj(e){let t,i,r=!1;if(e.url?(t=await NDe(e.url),i=e.url,r=e.url.startsWith("/")):e.data&&(t=e.data.buffer.slice(e.data.byteOffset,e.data.byteOffset+e.data.byteLength)),t)if(WQ){let n=await FDe.parse(t);if(n)return{font:n.font,url:i,intercepted:r,arr:t,bidi:n.bidi}}else return{font:void 0,url:i,intercepted:r,arr:t,bidi:null}}function UDe(e,t){return t.state.glyphIndex===e||t.state.fina===e||t.state.medi===e||t.state.init===e}var VDe=class{constructor(e){this._arrayBuffer=new ArrayBuffer(1),this._isLoaded=!1,this._intercepted=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=Hj(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}update(e){this._isLoaded=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=Hj(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}get url(){return this._url}get intercepted(){return this._intercepted}get isLoaded(){return this._isLoaded}get loadingPromise(){return this._loadingPromise}reverseLigaturesTable(e,t,i){if(!this._bidi)return[];let r=this._bidi;r.getTextGlyphs(t);let n=r.tokenizer.tokens,s=[],a=0,o=i.length===n.length;for(let l=0;l<i.length;l++){let u=i[l].index,c=String.fromCharCode(i[l].unicode),h=n[a];if(UDe(u,h)||o)s.push({char:c,index:u,replacements:[h.state.glyphIndex],replacementChars:[h.char]}),a++;else{let d=h.char,p="",m=[h.state.glyphIndex],v=[],g=!1;for(;!g;)a++,p=t.charAt(a),d+=p,m.push(e.charToGlyphIndex(p)),v=e.stringToGlyphs(d),v.length===1&&v[0].index===u&&(g=!0),a>t.length&&(g=!0);s.push({char:c,index:u,replacements:m,replacementChars:Array.from(d)}),a++}}return s}generateShapes(e,t,i){if(!this._isLoaded)return;let r=this.font,n=t.fontSize/this.unitsPerEm,s=t.fontSize*t.lineHeight,a=e.map(w=>this.getTextWidth(w,t)),o=typeof t.width=="string"?Number(i.getVariable(t.width)):t.width,l=typeof t.height=="string"?Number(i.getVariable(t.height)):t.height,u=this.getCharWidth(`
`,t),c=t.horizontalAlign===1?u:0,h=this.getLineInitialOffsetX(a[0],o,t.horizontalAlign,e[0],u),d=this.getLineInitialOffsetY(s,e.length,l,n,t.verticalAlign),p=[],m=e.map(w=>[]),v=e.map(w=>[]);for(let w=0;w<e.length;w++){let S=e[w],_={features:{liga:!0},letterSpacing:t.letterSpacing},A=[];try{A=r.stringToGlyphs(S,_)}catch(D){console.warn(D)}h=this.getLineInitialOffsetX(a[w],o,t.horizontalAlign,S,u);let C=[];try{C=this.reverseLigaturesTable(r,S,A)}catch(D){console.warn(D)}let E=this.computeSpaceWidthForLine(e,w,t,i),I=0,T=A[0];T&&t.horizontalAlign===2&&T.leftSideBearing!==void 0&&(h-=T.leftSideBearing*n),this.font?.forEachGlyph(S,h,d,t.fontSize,_,(D,L,z,G,V)=>{let j=D.index===0?`
`:D.unicode?String.fromCharCode(D.unicode):void 0,J=C[I],ne=0;if(j===`
`)ne=c;else if(j===" ")ne=E;else{let K=this.createPath(D,n,L,z,t);K&&(ne=K.offsetX,p.push(K.path))}if(J.replacements.length===1)v[w].push([L,z]),m[w].push(ne);else{let K=J.replacements.map(X=>(r.glyphs.get(X).advanceWidth??0)*n),B=K.reduce((X,Y)=>X+=Y,0),Z=K.map(X=>X/B),F=L;for(let X=0;X<Z.length;X++){let Y=ne*Z[X];v[w].push([F,z]),m[w].push(Y),F+=Y}}I++}),d-=s}let g=[];for(let w=0,S=p.length;w<S;w++)g.push(...p[w].toShapes());return{shapes:g,charWidths:m,lineWidths:a,charCoords:v}}get isUserFont(){return this._isUserFont}get arrayBuffer(){return this._arrayBuffer}get ascender(){return this.font?.ascender??0}get descender(){return this.font?.descender??0}get familyName(){return this.font?.names.fontFamily??""}get subfamilyName(){return this.font?.names.fontSubfamily??""}get unitsPerEm(){return this.font?.unitsPerEm??1}getLineInitialOffsetX(e,t,i,r,n){return(i===3||i===2)&&r.indexOf(`
`)>=0&&(e-=n),i===3?t*.5-e*.5:i===2?t-e:0}getLineInitialOffsetY(e,t,i,r,n){let s=t*e,a=Math.abs(this.ascender-this.descender)*r,o=e-a,l=-this.ascender*r-o/2;return n===3?-(i-s-l):n===2?-(i*.5-s*.5-l):l}createPath(e,t,i,r,n){let s=e.getPath(i,-r,n.fontSize,{kerning:!1,letterSpacing:n.letterSpacing});if(!s){console.error('THREE.Font: character "'+e+'" does not exists in font family '+this.familyName+".");return}let a=new zDe,o=(e.advanceWidth??1)*t;if(e)for(let l of s.commands){let u=a.currentPath?.currentPoint;if(!(u&&l.type!=="Z"&&u.x===l.x&&-u.y===l.y))switch(l.type){case"M":a.moveTo(l.x,-l.y);break;case"L":a.lineTo(l.x,-l.y);break;case"Q":a.quadraticCurveTo(l.x1,-l.y1,l.x,-l.y);break;case"C":a.bezierCurveTo(l.x1,-l.y1,l.x2,-l.y2,l.x,-l.y);break}}return a.subPaths.forEach(l=>{let u=jDe(l.curves);u!==void 0&&l.currentPoint.distanceTo(u)>0&&l.lineTo(u.x,u.y)}),{offsetX:o,path:a}}getCharWidth(e,t){return this.font?.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing})??0}getTextWidth(e,t){return this.font?.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing})??0}computeSpaceWidthForLine(e,t,i,r){let n=this.getCharWidth(" ",i),s=e[t];if(s){let a=this.countSpaces(s.trimEnd());if(i.horizontalAlign===4&&t<e.length-1&&a){let o=typeof i.width=="string"?Number(r.getVariable(i.width)):i.width,l=this.getTextWidth(s,i);return(o-(l-a*n))/a}}return n}countSpaces(e){return(e.match(/ /g)||[]).length}};function jDe(e){if(e.length){let t=e[0];if(t instanceof Fu)return t.v1;if(t instanceof zu||t instanceof Ip)return t.v0}}var HDe=class{constructor(){this.objects=new Map,this.unreachable=new Set}getCached(e){return this.objects.get(e)}get size(){return this.objects.size}get(e,t,i){let r=this.objects.get(e);return r===void 0?(r=this.createObject(e,t,i),this.objects.set(e,r)):r.isShared=!0,r}forceDelete(e){let t=this.objects.get(e);t&&(this.disposeObject(t),this.objects.delete(e))}mutateIfUnique(e,t){let i=this.objects.get(e);if(i&&i.isShared!==!0)return this.objects.delete(e),this.objects.set(t,i),i}startGc(){this.unreachable=new Set(this.objects.keys())}markAsReachable(e,t){let i=this.objects.get(e);t===i&&this.unreachable.delete(e)}endGc(){this.unreachable.forEach(e=>{this.disposeObject(this.objects.get(e)),this.objects.delete(e)}),this.unreachable.clear()}dispose(){this.objects.forEach(e=>{this.disposeObject(e)}),this.objects.clear()}},Wj=class extends HDe{constructor(e){super(),this.flatShading=e}disposeObject(e){e.dispose()}createObject(e,t,i){let r=wx(e,t,this.flatShading,i);return r.computeBoundingSphere(),r}},WDe={markNeedsUpdateRendererDirty:()=>{}},UE=1e3,Gj=512*UE;function GDe(e,t){let i=typeof e;return!!((t==="string"||t==="number")&&i===t||t==="boolean"&&(e==="true"||e==="false"||e===!0||e===!1)||t==="image"&&i==="string"&&e.startsWith("http"))}var qDe="https://hooks.spline.design",XDe=`${qDe}/events?hashFile=`,YDe=class{constructor(e,t){this.id=e,this.userWebhook=t,this.result=void 0,this._connected=!1,this.emitter=uT(),this.reconnectWaitFor=UE,this._onError=i=>{this.eventSource?.removeEventListener("message",this._onMessage),this.eventSource?.removeEventListener("error",this._onError),this.eventSource?.removeEventListener("open",this._onConnected),this._scheduleReconnect()},this._onConnected=i=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=UE,this._connected=!0},this._onDisconnected=()=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=UE,this._connected=!1},this._onMessage=i=>{let r=i.data,n;try{n=JSON.parse(r)}catch(s){console.error("Error parsing webhook message",s)}if(n){let s=!1;this.userWebhook.parametersSchemas.forEach(({data:a})=>{n[a.name]!==void 0&&GDe(n[a.name],a.type)&&(this.result===void 0&&(this.result={}),this.result[a.name]=n[a.name],s=!0)}),s&&this.emitter.emit("message",{userWebhookId:this.id})}}}connect(){clearTimeout(this.scheduledReconnectHandle),this.userWebhook.url&&(this.eventSource=new EventSource(XDe+this.userWebhook.url),this.eventSource.addEventListener("message",this._onMessage),this.eventSource.addEventListener("error",this._onError),this.eventSource.addEventListener("open",this._onConnected))}disconnect(){this.eventSource?.removeEventListener("message",this._onMessage),this.eventSource?.removeEventListener("error",this._onError),this.eventSource?.removeEventListener("open",this._onConnected),this.eventSource?.close(),this._onDisconnected(),clearTimeout(this.scheduledReconnectHandle)}_scheduleReconnect(){this.reconnectWaitFor*=2,this.reconnectWaitFor>Gj&&(this.reconnectWaitFor=Gj),clearTimeout(this.scheduledReconnectHandle),this.scheduledReconnectHandle=setTimeout(()=>{this.scheduledReconnectHandle=void 0,this.connect()},this.reconnectWaitFor)}update(e){this.userWebhook=e}dispose(){this._connected&&this.disconnect()}get connected(){return this._connected}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}getParametersKeys(){return this.userWebhook.parametersSchemas.map(e=>e.data.name)}getParameterValue(e){if(this.getParametersKeys().includes(e)){if(this.result)return this.result?.[e];for(let t of this.userWebhook.parametersSchemas)if(t.data.name===e)return ML.defaultParameterValueByType(t.data.type)}}},qj=[4186.01,4434.92,4698.63,4978.03,5274.04,5587.65,5919.91,6271.93,6644.88,7040,7458.62,7902.13],QDe=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],Ep=[],gB=[];for(let e=1;e<=8;e++)for(let t=0;t<qj.length;t++){let i=qj[t];Ep.push(i/Math.pow(2,8-e)),gB.push(QDe[t]+e)}var iC=[32,2e3],Xj=Ep.filter((e,t)=>Ep[t]>iC[0]&&Ep[t]<iC[1]),KDe=gB.filter((e,t)=>Ep[t]>iC[0]&&Ep[t]<iC[1]),ZDe=class{static getFrequencies(e,t,i,r="frequency",n=-100,s=-30){i||(i=new Float32Array(e.frequencyBinCount),e.getFloatFrequencyData(i));let a=t/2,o=1/i.length*a,l,u,c;if(r==="music"||r==="voice"){let d=r==="voice"?Xj:Ep,p=Array(d.length).fill(n);for(let m=0;m<i.length;m++){let v=m*o,g=i[m];for(let w=d.length-1;w>=0;w--)if(v>d[w]){p[w]=Math.max(p[w],g);break}}l=p,u=r==="voice"?Xj:Ep,c=r==="voice"?KDe:gB}else l=Array.from(i),u=l.map((d,p)=>o*p),c=u.map(d=>`${d.toFixed(2)} Hz`);let h=l.map(d=>Math.max(0,Math.min((d-n)/(s-n),1)));return{values:new Float32Array(h),frequencies:u,labels:c}}},JDe="gpt-4o-realtime-preview-2024-12-17",$De=()=>"https://relayserver.spline.design/";async function eRe(e){try{return(await(await fetch($De()+"session?uuidfile="+e)).json()).token}catch(t){console.error("Token generation error:",t)}}var tRe=class{constructor(e){this.value=0,this.frequencies=new Float32Array(0);let t=new AudioContext;this.source=t.createMediaStreamSource(e),this.analyser=t.createAnalyser(),this.source.connect(this.analyser),this.analyser.fftSize=8192,this.analyser.smoothingTimeConstant=.1}getFrequencies(e=-100,t=-30){if(!this.analyser)throw new Error("Not connected, please call .connect() first");return ZDe.getFrequencies(this.analyser,44100,void 0,"voice",e,t)}update(){let e=this.getFrequencies(),t=e.values.reduce((i,r)=>i+r,0)/e.values.length;this.value=t,this.frequencies=e.values}disconnect(){this.source.disconnect(),this.analyser.disconnect()}},Yj=class{constructor(e,t,i){this.data=e,this.id=t,this.shared=i,this.emitter=uT(),this.rafId=0,this.voice=0,this.frequencies=new Float32Array([0]),this.events=[],this.isConnected=!1,this.isToolsAdded=!1,this.tools=[],this.onMessage=r=>{let n=JSON.parse(r.data);if(this.appendEvent(n),n.type==="session.created"&&this.onSessionCreated(),n.type==="response.done"&&n.response?.output){for(let s of n.response.output)if(s.type==="function_call")for(let[a,o]of this.tools)s.name===a.name&&(o(JSON.parse(s.arguments)),setTimeout(()=>{this.sendClientEvent({type:"response.create",response:{instructions:"notice the user about what you just did"}})}))}},this.onSessionCreated=()=>{this.isToolsAdded||this.registerTools()},this.onOpen=()=>{this.events=[],this.isConnected=!0,this.sendClientEvent({type:"response.create",response:{instructions:"Say hi"}})},this.animate=()=>{if(this.rafId=requestAnimationFrame(this.animate),this.isConnected&&this.analyser){this.analyser.update();let r=this.analyser.value,n=this.analyser.frequencies;this.voice=r,this.frequencies=n,this.emitter.emit("voice",{value:r,frequencies:n})}}}update(e){this.data=e}setColorByName(e,t){let i=this.shared.getColorByName(e);if(i){let{id:r}=i,{r:n,g:s,b:a}=EPe.hexStringToRgb(t)??{r:0,g:0,b:0};this.shared.updateColor(r,{r:n/255,g:s/255,b:a/255})}}async connect(){if(this.isConnected)return;let e=await eRe(this.data.integration.hash);this.pc=new RTCPeerConnection,this.audioElement=document.createElement("audio"),this.audioElement.autoplay=!0,this.pc.ontrack=n=>{let s=n.streams[0];this.audioElement.srcObject=s,this.analyser=new tRe(s)};let t=await navigator.mediaDevices.getUserMedia({audio:!0});this.pc.addTrack(t.getTracks()[0]),this.dc=this.pc.createDataChannel("oai-events"),this.dc.addEventListener("message",this.onMessage),this.dc.addEventListener("open",this.onOpen);let i=await this.pc.createOffer();await this.pc.setLocalDescription(i);let r={type:"answer",sdp:await(await fetch(`https://api.openai.com/v1/realtime?model=${JDe}`,{method:"POST",body:i.sdp,headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/sdp"}})).text()};await this.pc.setRemoteDescription(r),this.animate()}appendEvent(e){this.events=[e,...this.events]}sendClientEvent(e){this.dc?(e.event_id=e.event_id||crypto.randomUUID(),this.dc.send(JSON.stringify(e)),this.appendEvent(e)):console.error("Failed to send message - no data channel available",e)}registerTools(){this.isToolsAdded=!0,this.registerTool({type:"function",name:"set_personality_color",description:"returns a color based on the voice personality of the ai assistant. This should be called by the voice assistant each time it is asks to speak differently. If a color cannot be associated to the personality, the color should be a neutral color.",parameters:{type:"object",properties:{color:{type:"string",description:"css hex color string, reflecting the personality"},personality:{type:"string",description:"the personality of the voice assistant"}},required:["color","personality"]}},({color:n})=>{this.setColorByName("Voice Assistant Color",n)});let e=this.shared.getVariablesNames().join(", ");this.registerTool({type:"function",name:"set_variable",description:"Sets a Spline variable value when asked by the user.",parameters:{type:"object",properties:{name:{type:"string",description:`The name of the variable that needs to be set. Here's a list of available variables: ${e}. It the variable does not exist, don't call the function and warn the user about it.`},value:{type:"string",description:"The new value for this variable, should always be a string even for number and boolean variables, assume that the value will be cast to the proper type afterwards."}},required:["name","value","type"]}},({name:n,value:s})=>{let a=this.shared.getVariableByName(n);if(a){let o=this.shared.getVariable(a.id),l;typeof o=="number"?l=parseFloat(s):typeof o=="boolean"?l=s.toLowerCase()==="true":l={textValue:s},this.shared.updateVariable(a.id,l)}});let t=this.shared.getColorNames().join(", ");this.registerTool({type:"function",name:"set_color",description:"Sets a Spline color asset value when asked by the user.",parameters:{type:"object",properties:{name:{type:"string",description:`The name of the color asset that needs to be set. Here's a list of available color assets: ${t}. It the color asset does not exist, don't call the function and warn the user about it.`},value:{type:"string",description:"css hex color string"}},required:["name","value"]}},({name:n,value:s})=>{this.setColorByName(n,s)});let i=this.shared.scene,r=[];i.traverseEntity(n=>{n.data.events.forEach(s=>{if(s.data.type==="AIAssistantTrigger"){let{description:a}=s.data;r.push(a)}})}),this.registerTool({type:"function",name:"trigger_event",description:"Trigger an event by name, here are the available events, please match what the user is asking for to one of these if it applies, otherwise don't call the function and warn the user.",parameters:{type:"object",properties:{description:{type:"string",description:`The name of the event that needs to be triggered. Here's a list of available events: ${JSON.stringify(r)}.`},direction:{type:"string",description:"default is forward, but can be forward or backward. Always set to forward unless the user ask to reverse or cancel the event, then set to backward."}},required:["description","direction"]}},({description:n,direction:s})=>{this.emitter.emit("trigger_event",{description:n,direction:s})}),this.sendClientEvent({type:"session.update",session:{tools:this.tools.map(([n])=>n)}})}registerTool(e,t){this.tools.push([e,t])}disconnect(){cancelAnimationFrame(this.rafId),this.analyser?.disconnect(),this.voice=0,this.isConnected=!1,this.isToolsAdded=!1,this.dc?.removeEventListener("message",this.onMessage),this.dc?.removeEventListener("open",this.onOpen),this.dc?.close(),this.pc?.getSenders().forEach(e=>{e.track&&e.track.stop()}),this.pc?.close(),this.pc=void 0}computeAnalysisForListenerEvent(e){if(e.analysis==="range"){let t=this.frequencies.slice(...e.analysisRange);return t.reduce((i,r)=>i+r,0)/t.length}return e.analysis==="single"?this.frequencies[e.analysisSingle]:this.voice}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}};function tO(e){return"variable_"+e}var iRe=class extends V3e{constructor(e){super(),this.shared=e}create(e){return new kQ(e,this.shared)}},vB=class{constructor(e,t={},i=!0,r=!1){if(this.data=e,this.needsJitter=i,this.enableLocalStorageForPersistentVariables=r,this.geometryCache=new Wj(!0),this.geometryCache2=new Wj(!1),this.imageHolderCache=new iRe(this),this.thisContext={scene:WDe,shared:this},this.deletedMaterial=new eO(Vs.defaultTwoLayerData("phong"),this.thisContext,""),this.deletedImage=new sp(CL.emptyImage,this),this.deletedVideo=new sp(z2.defaultVideo,this),this.materials={},this.images={},this.uiBuffers={},this.videos={},this.colors={},this.audios={},this.particles={},this.fonts={},this.timelineAnimations={},this.variables={},this.userAPIs={},this.userWebhooks={},this.mouseProperty=null,this.raycastProperty=null,this.requestRender=()=>{this._requestRender&&this._requestRender()},t.images)for(let[n,s]of Object.entries(t.images))this.addImage(n,s);if(t.videos)for(let[n,s]of Object.entries(t.videos))this.addVideo(n,s);if(t.audios)for(let[n,s]of Object.entries(t.audios))this.addAudio(n,s);if(t.particles)for(let[n,s]of Object.entries(t.particles))this.addParticle(n,s);this.reset(e)}setRequestRender(e){this._requestRender=e}getImageLoadPromises(){return Object.values(this.images).map(e=>e.loadPromise)}setEntityOpContext(e){this.entityOpContext=e}reset(e,t=!1,i=!1){this.data=e,this.resetLib(e.lib);for(let{id:r,data:n}of e.variables)this.addVariableHolder(r,n),t&&this.updateVariableHolder(r,n);for(let[r,n]of Object.entries(e.userAPIs??{}))this.addUserAPI(r,n);for(let[r,n]of Object.entries(e.userWebhooks??{}))this.addUserWebhook(r,n);if(!i){for(let[r,n]of Object.entries(e.images))this.addImage(r,n);for(let[r,n]of Object.entries(e.videos))this.addVideo(r,n)}for(let[r,n]of Object.entries(e.colors))this.addColor(r,n);for(let[r,n]of Object.entries(e.materials))this.addMaterial(r,n);for(let[r,n]of Object.entries(e.audios))this.addAudio(r,n);for(let[r,n]of Object.entries(e.particles))this.addParticle(r,n);for(let[r,n]of Object.entries(e.fonts))this.addFont(r,n);for(let[r,n]of Object.entries(e.timelineAnimations??{}))this.addAnimation(r,n)}addMaterial(e,t){if(this.materials[e]){let i=this.materials[e];i.reset(t,this.thisContext),i.dispose()}else{let i=new eO(t,this.thisContext,e);this.materials[e]=i}}deleteMaterial(e){this.materials[e]&&(this.materials[e].nodeMaterialDispose(),delete this.materials[e])}getMaterial(e){return this.materials[e]}getMaterialOrDeletedPlaceholder(e){return this.materials[e]??this.deletedMaterial}material(e){return typeof e=="string"?this.getMaterialOrDeletedPlaceholder(e):e==null?(console.error("material is undefined or null"),this.deletedMaterial):new mB(e,this.thisContext)}getMaterials(){return this.materials}addImage(e,t){return this.images[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.images[e].updateSrc(t.data),!0):(this.images[e]=new sp(t,this),!1)}deleteImage(e){let t=this.images[e];t&&(t.dispose(),delete this.images[e])}getDefaultImage(){return this.images.image_0}getImage(e){return this.images[e]??this.deletedImage}image(e){return typeof e=="string"?this.getImage(e):this.imageHolderCache.load(e)}addUIBuffer(e,t){return this.uiBuffers[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.uiBuffers[e].updateSrc(t),!0):(this.uiBuffers[e]=new sp(t,this),!1)}uiBuffer(e){return this.uiBuffers[e]}addVideo(e,t){return this.videos[e]?(this.videos[e].updateSrc(t.data),!0):(this.videos[e]=new sp(t,this),!1)}deleteVideo(e){let t=this.videos[e];t&&(t.dispose(),delete this.videos[e])}getVideo(e){return this.videos[e]??this.deletedVideo}video(e){return typeof e=="string"?this.getVideo(e):this.imageHolderCache.load(e)}addColor(e,t){return this.colors[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),"a"in t?this.colors[e].setRGBA(t.r,t.g,t.b,t.a):this.colors[e].setRGBA(t.r,t.g,t.b,1),!0):("a"in t?this.colors[e]=new tC(t.r,t.g,t.b,t.a):this.colors[e]=new tC(t.r,t.g,t.b,1),!1)}updateColor(e,t){if(this.colors[e]){this.onColorOrImageUpdate&&this.onColorOrImageUpdate();let i=this.colors[e];return this.colors[e].r=t.r??i.r,this.colors[e].g=t.g??i.g,this.colors[e].b=t.b??i.b,this.colors[e].a=t.a??i.a,!0}return!1}deleteColor(e){this.colors[e]&&delete this.colors[e]}getColor(e){return this.colors[e]}getColorNames(){return Object.values(this.data.colors).map(e=>e.name)}getColorByName(e){for(let t in this.data.colors)if(this.data.colors[t].name===e)return{color:this.colors[t],id:t}}color(e){let t;if(typeof e=="string"){let i=this.getColor(e);i?t=i:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),t=new Gs(0,0,0,0))}else return"a"in e?new Gs(e.r,e.g,e.b,e.a):new Gs(e.r,e.g,e.b,1);return t}addAudio(e,t){this.audios[e]=t}getAudio(e){let t=this.audios[e];if(t instanceof Qw)return t;{let i=new Qw({src:t.data});return this.audios[e]=i,i}}addParticle(e,t){this.particles[e]=t}getParticle(e){return this.particles[e]}deleteParticle(e){this.particles[e]&&delete this.particles[e]}deleteAudio(e){let t=this.audios[e];t&&(t instanceof Qw&&t.dispose(),delete this.audios[e])}addFont(e,t){this.fonts[e]=new VDe(t),this.fonts[e].loadingPromise.then(()=>this.requestRender())}getFont(e){return this.fonts[e]}deleteFont(e){this.fonts[e]&&delete this.fonts[e]}addAnimation(e,t){this.timelineAnimations[e]=t}getAnimation(e){return this.timelineAnimations[e]}deleteAniamtion(e){this.timelineAnimations[e]&&delete this.timelineAnimations[e]}dispose(){Object.keys(this.materials).forEach(e=>this.deleteMaterial(e)),this._requestRender=void 0,Object.values(this.audios).forEach(e=>{e instanceof Qw&&e.dispose()}),this.audios={},this.particles={},this.geometryCache.dispose(),this.geometryCache2.dispose()}addVariableHolder(e,t){if(this.variables[e]===void 0){let i=t.value;if(this.enableLocalStorageForPersistentVariables&&t.persistent){let r=localStorage.getItem(tO(e));i=r!==null?JSON.parse(r):t.value}return this.variables[e]={value:i,locations:[],persistent:t.persistent},"dynamicVariableType"in t&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0),!0}return this.variables[e].value=t.value,!1}resetDynamicVariablePlayState(){for(let e in this.variables)this.variables[e].dynamicVariablePlayState!==void 0&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0)}updateVariableHolder(e,t){this.updateVariable(e,t.value)}updateVariable(e,t){if(this.variables[e]===void 0)return!1;this.variables[e].value=t,this.enableLocalStorageForPersistentVariables&&this.variables[e].persistent&&localStorage.setItem(tO(e),JSON.stringify(t));let i=t;for(;typeof i=="string";)i=this.variables[i].value;let r=this.entityOpContext.scene;for(let n=this.variables[e].locations.length-1;n>=0;n--){let s=this.variables[e].locations[n];if(s[0]==="material"){let a=s[1],o=i,l={scene:r,shared:this},u=s.slice(2);r.traverseMaterial(h=>{let d=h.root??h;d.uuid===a&&d.onVariableUpdate(u,o,l)});let c=this.materials[a];c&&c.onVariableUpdate(u,o,l)}else{let a=r.find(s[0]);if(a===void 0){this.variables[e].locations.splice(n,1);continue}if(s[1]!=="geometry"&&s[1]!=="particles"){for(let o=1;o<s.length-1;o++)a=a[s[o]];s[1]==="rotation"?a[s[s.length-1]]=i*Ot.DEG2RAD:a[s[s.length-1]]=i}if(a=r.find(s[0]),a.type==="ParticleEmitter"&&a.updateVariableState(i,s),Xi.is(a))if(s[1]==="position"||s[1]==="rotation"||s[1]==="scale")a.onVariableUpdate();else if(s[1]==="geometry"){let o=a;a.component&&(o=a.component);let l=o.dataPatched;o.chooseGeoemtryCache(this).forceDelete(l.geometry),o.createGeometryDelayed(this.entityOpContext),o.onVariableUpdate(!0),o.invalidateDownstreamBooleanData(),o.instances.forEach(u=>{let c=u.dataPatched;u.chooseGeoemtryCache(this).forceDelete(c.geometry),u.createGeometryDelayed(this.entityOpContext),u.onVariableUpdate(!0),u.invalidateDownstreamBooleanData()})}else s[1]==="morphTargetInfluences"&&a.updateMorphInfluences(s[2],i)}}return this.requestRender(),!0}deleteVariable(e){this.variables[e]&&delete this.variables[e]}getVariable(e,t){if(Array.isArray(e)){if(e[0]==="mouse")return this.mouseProperty?.[e[1]]??0;if(e[0]==="raycast")return this.raycastProperty?.[e[1]]??0;let i=this.entityOpContext.scene.find(e[0]);if(e[1]==="width"||e[1]==="height"||e[1]==="depth")return i.geometry.userData.parameters[e[1]];for(let r=1;r<e.length;r++)i=i[e[r]];return e[1]==="rotation"&&(i*=Ot.RAD2DEG),i}for(let i in this.variables){if(t===void 0)break;let r=this.variables[i],n=r.locations?.findIndex(s=>bs.equal(s,t));n!==void 0&&n!==-1&&r.locations.splice(n,1)}if(typeof e=="string"){let i=e,r=e;do{if(r=i,this.variables[i]===void 0)break;let n=this.variables[i].value;t&&this.variables[r]!==void 0&&this.variables[r].locations.push(t),i=n}while(typeof i=="string");return i}else return e}getVariables(){return this.variables}getVariablesNames(){return this.data.variables.map(e=>e.data.name)}getVariableByName(e){for(let t of this.data.variables)if(t.data.name===e)return{variable:t.data,id:t.id}}getDynamicVariablePlayState(e){return this.variables[e]?.dynamicVariablePlayState}setDynamicVariablePlayState(e,t){this.variables[e]!==void 0&&(this.variables[e].dynamicVariablePlayState=t)}getDynamicVariableToggleIsForward(e){return this.variables[e]?.dynamicVariableToggleIsForward}setDynamicVariableToggleIsForward(e,t){this.variables[e]!==void 0&&(this.variables[e].dynamicVariableToggleIsForward=t)}resetLib(e){for(let[t,i]of Object.entries(e.images))this.addImage(t,i.asset);for(let[t,i]of Object.entries(e.audios))this.addAudio(t,i.asset);for(let[t,i]of Object.entries(e.particles))this.addParticle(t,i.asset);for(let[t,i]of Object.entries(e.colors))this.addColor(t,i.asset);for(let[t,i]of Object.entries(e.fonts))this.addFont(t,i.asset);for(let[t,i]of Object.entries(e.materials))this.addMaterial(t,i.asset);for(let[t,i]of Object.entries(e.videos))this.addVideo(t,i.asset);for(let[t,i]of Object.entries(e.variables))this.addVariableHolder(t,i.asset)}updateLibByOp(e,t){e.path[0]==="images"?e.path.length===1&&e.type===1?this.addImage(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteImage(e.id):e.path[0]==="videos"?e.path.length===1&&e.type===1?this.addVideo(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteVideo(e.id):e.path[0]==="audios"?e.path.length===1&&e.type===1?this.addAudio(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteAudio(e.id):e.path[0]==="particles"?e.path.length===1&&e.type===1?this.addParticle(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteParticle(e.id):e.path[0]==="colors"?e.path.length===1&&e.type===1?this.addColor(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteColor(e.id):e.path[0]==="materials"?e.path.length===1&&e.type===1?this.addMaterial(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteMaterial(e.id):e.path[0]==="fonts"?e.path.length===1&&e.type===1?this.addFont(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteFont(e.id):e.path[0]==="variables"?e.path.length===1&&e.type===1?this.addVariableHolder(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteVariable(e.id):e.path[0]==="components"&&t.updateByLibOp(e,this)}updateByOp(e,t,i){if(this.data=t,e.path[0]==="images")e.path.length===2&&e.type===0?e.props.data&&this.getImage(e.path[1]).updateSrc(e.props.data):e.path.length===1&&e.type===1?this.addImage(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteImage(e.id);else if(e.path[0]==="videos")e.path.length===2&&e.type===0?e.props.data&&this.getVideo(e.path[1]).updateSrc(e.props.data):e.path.length===1&&e.type===1?this.addVideo(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteVideo(e.id);else if(e.path[0]==="audios")e.path.length===2&&e.type===0?e.props.data&&this.addAudio(e.path[1],t.audios[e.path[1]]):e.path.length===1&&e.type===1?this.addAudio(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteAudio(e.id);else if(e.path[0]==="particles")e.path.length===2&&e.type===0?e.props.data&&this.addParticle(e.path[1],t.particles[e.path[1]]):e.path.length===1&&e.type===1?this.addParticle(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteParticle(e.id);else if(e.path[0]==="colors")e.path.length===2&&e.type===0?this.updateColor(e.path[1],e.props):e.path.length===1&&e.type===1?this.addColor(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteColor(e.id);else if(e.path[0]==="materials")e.path.length===1&&e.type===1?this.addMaterial(e.id,e.data):e.path.length===1&&e.type===2?this.deleteMaterial(e.id):e.path.length>1&&this.getMaterial(e.path[1]).updateByOp(Us.drop(e,2),t.materials[e.path[1]],{shared:this,scene:i});else if(e.path[0]==="fonts")e.path.length===2&&e.type===0?this.updateFont(e.path[1],e,i):e.path.length===1&&e.type===1?this.addFont(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteFont(e.id);else if(e.path[0]==="variables")e.path.length===2&&e.type===0?"value"in e.props?this.updateVariable(e.path[1],e.props.value):"persistent"in e.props&&(this.variables[e.path[1]].persistent=e.props.persistent):e.path.length===1&&e.type===4?this.addVariableHolder(e.id,e.data):e.path.length===1&&e.type===5&&this.deleteVariable(e.id);else if(e.path[0]==="userAPIs"){if(e.path.length===1&&e.type===1)this.addUserAPI(e.id,e.data);else if(e.path.length===1&&e.type===2)this.deleteUserAPI(e.id);else if(typeof e.path[1]=="string"){let r=t.userAPIs[e.path[1]];if(r){let n=e.type===0&&e.props.debounce===void 0,s=this.getUserAPI(e.path[1]);s instanceof Yj?s.update(r):s?.update(r,this,n)}}}else if(e.path[0]==="userWebhooks"){if(e.path.length===1&&e.type===1)this.addUserWebhook(e.id,e.data);else if(e.path.length===1&&e.type===2)this.deleteUserWebhook(e.id);else if(typeof e.path[1]=="string"){let r=t.userWebhooks[e.path[1]];r&&this.getUserWebhook(e.path[1])?.update(r)}}else e.path[0]==="lib"&&this.updateLibByOp(Us.drop(e,1),i)}updateFont(e,t,i){if(t.props.url){let r=this.getFont(e),n={...this.data.fonts[e],url:t.props.url};r.update(n),r.loadingPromise.then(()=>this.requestRender()),i.updateFont(e,this)}}addUserAPI(e,t){return this.userAPIs[e]?(this.userAPIs[e].update(t,this),!0):this.openAIRealtime?.id===e?(this.openAIRealtime.update(t),!0):t.integration?.type==="VoiceAssistant"?(this.openAIRealtime=new Yj(t,e,this),!1):(this.userAPIs[e]=new $Y(e,t,this),!1)}getUserAPI(e){return this.openAIRealtime?.id===e?this.openAIRealtime:this.userAPIs[e]}getUserAPIs(){return this.userAPIs}deleteUserAPI(e){let t=this.userAPIs[e];t&&(t.dispose(),delete this.userAPIs[e])}addUserWebhook(e,t){return this.userWebhooks[e]?(this.userWebhooks[e].update(t),!0):(this.userWebhooks[e]=new YDe(e,t),!1)}getUserWebhook(e){return this.userWebhooks[e]}getUserWebhooks(){return this.userWebhooks}deleteUserWebhook(e){let t=this.userWebhooks[e];t&&(t.dispose(),delete this.userWebhooks[e])}get scene(){return this.entityOpContext.scene}};new vB(Nl.emptyData());var Op=class extends xa{updateByPatchedOp(e,t,i){if(super.updateByPatchedOp(e,t,i),mEe(e.path,["materials"])!==null&&e.type===0&&Array.isArray(this.material))for(let[r,n]of Object.entries(e.props)){let s=i.shared.material(n);this.material[Number(r)]=s}else if(Dr(e.path,["material"])&&this.material instanceof zd)"material"in t&&typeof t.material!="string"&&this.material.updateByOp(Us.drop(e,1),t.material,i);else if(Dr(e.path,["materials","*"])&&Array.isArray(this.material)){let r=e.path[1];if("materials"in t&&r<this.material.length){let n=t.materials[r];typeof n!="string"&&this.material[r].updateByOp(Us.drop(e,2),n,i)}}}get needsAO(){return this.material!==void 0?(Array.isArray(this.material)?this.material[0]:this.material).hasAO:!1}updateState(e,t){super.updateState(e,t),e.castShadow!==void 0&&(this.castShadow=e.castShadow),e.receiveShadow!==void 0&&(this.receiveShadow=e.receiveShadow);let i=this.dataPatched;this.dataPatched.type==="Mesh"&&this.dataPatched.geometry.shapeBlendNode&&this.layers.set(9);let r;this.dataPatched.type==="Mesh"&&this.dataPatched.geometry.type==="ShapeBlendGeometry"&&(r={resolutionLevel:this.dataPatched.geometry.resolutionLevel,useChildrenColors:this.dataPatched.geometry.useChildrenColors}),e.geometry?.type!=="NonParametricGeometry"&&"material"in e&&e.material!==void 0&&(this.disposeMaterial(),this.material=t.shared.material(e.material).getFlavor(i.flatShading,i.side,i.wireframe,r),t.scene.markNeedsUpdateRendererDirty()),(e.geometry?.type==="NonParametricGeometry"||"materials"in e)&&("materials"in e&&e.materials!==void 0?(this.disposeMaterial(),this.material=e.materials.map(s=>t.shared.material(s).getFlavor(i.flatShading,i.side,i.wireframe)),t.scene.markNeedsUpdateRendererDirty()):"material"in e&&e.material!==void 0&&(this.disposeMaterial(),this.material=[t.shared.material(e.material).getFlavor(i.flatShading,i.side,i.wireframe)],t.scene.markNeedsUpdateRendererDirty()));let n=this.data;if(n.geometry?.type!=="NonParametricGeometry"&&"materials"in n&&n.materials!==void 0&&(this.disposeMaterial(),this.material=t.shared.material(n.materials[0]).getFlavor(i.flatShading,i.side,i.wireframe)),e.flatShading!==void 0||e.wireframe!==void 0||e.side!==void 0)if(Array.isArray(this.material))for(let s=0;s<this.material.length;s++)this.material[s]=this.material[s].getFlavor(i.flatShading,i.side,i.wireframe);else this.material=this.material.getFlavor(i.flatShading,i.side,i.wireframe,r)}disposeMaterial(){this.material&&RX(this.material).forEach(e=>{e instanceof zd&&(e instanceof eO||e.nodeMaterialDispose())})}dispose(){this.disposeMaterial(),super.dispose()}},Qj=new H,Kj=new bi,Zj=new bi,rRe=new H,Jj=new yt,kn=class extends Op{constructor(e,t,i){super(e,t),this.data=t,this.isSkinnedMesh=!1,this.localGeometry=void 0,t.bindMode&&t.bindMatrix&&(this.bindMode=t.bindMode,this.bindMatrix=new yt().fromArray(t.bindMatrix),this.bindMatrixInverse=new yt)}chooseGeoemtryCache(e){return e.geometryCache}markGeometryAsReachable(e){this.geometryCreateDeleyed instanceof Kt&&this.chooseGeoemtryCache(e).markAsReachable(this.dataPatched.geometry,this.geometryCreateDeleyed)}get geometry(){if(this.localGeometry!==void 0)return this.localGeometry;if(this.geometryCreateDeleyed instanceof vB){let e=this.geometryCreateDeleyed,t=this.chooseGeoemtryCache(e);this.geometryCreateDeleyed=t.get(this.dataPatched.geometry,e,this)}return this.geometryCreateDeleyed}set geometry(e){this.localGeometry=e}get is2DAndNoDepth(){let e=this.dataPatched.geometry;return N2.is2DParametricMesh(e.type)&&e.depth===0}get is2DType(){return N2.is2DParametricMesh(this.geometry.userData.type)}get isNonParametric(){return this.geometry.userData.type==="NonParametricGeometry"}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),Dr(e.path,["geometry"])&&this.updateByPatchedOpGeometry(Us.drop(e,1),t.geometry,i)}removeInteractionGeometry(e){this.localGeometry?.dispose(),this.localGeometry=void 0}updateGeometryInteractions(e,t){this.invalidateDownstreamBooleanData();let i=this.data.geometry.type;if(i==="NonParametricGeometry"||i==="SubdivGeometry"){let r=e;if(this.localGeometry===void 0){let l={...this.data.geometry,...r};this.localGeometry=wx(l,t,this.data.flatShading,this)}let n,s,a;r.scaleBaked?[n,s,a]=r.scaleBaked:{width:n,height:s,depth:a}=r;let o=this.localGeometry.userData;o.sxPrev!==void 0&&YL(this.localGeometry.attributes,n/o.sxPrev,s/o.syPrev,a/o.szPrev),o.sxPrev=n,o.syPrev=s,o.szPrev=a}else{let r={...this.data.geometry,...e};this.localGeometry?.dispose(),this.localGeometry=wx(r,t,this.data.flatShading,this)}}refreshAttachedClonersInteractions(){for(let e of this.attachedSurfaceCloners)e.update()}refreshAttachedCloners(e){for(let t of this.attachedSurfaceCloners)e.scene.addPendingUpdateCloner(t.object)}refreshAttachedPaths(e){for(let t of this.attachedPaths)e.scene.addPendingCommand(()=>t.updateShape())}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.refreshAttachedCloners(e),this.refreshAttachedPaths(e)}updateByPatchedOpGeometry(e,t,i){let r=!1;e.type===0&&e.path.length===0&&Object.keys(e.props).includes("scaleBaked")&&this.geometryCreateDeleyed instanceof no&&this.chooseGeoemtryCache(i.shared).mutateIfUnique(this.geometryCreateDeleyed.data,t)===this.geometryCreateDeleyed&&(r=!0,this.geometryCreateDeleyed.mutateDirectlyScaleBaked(t,e.props.scaleBaked),this.refreshAttachedCloners(i),this.refreshAttachedPaths(i)),r||(i.scene?.markGeometryCacheDirty(),this.createGeometryDelayed(i)),this.resetBBoxNeedsUpdate(),this.invalidateDownstreamBooleanData()}updateGeometryOnStateUpdate(e,t){this.createGeometryDelayed(t)}updateState(e,t){e.geometry!==void 0&&this.updateGeometryOnStateUpdate(e.geometry,t);let i=e.morphTargetInfluences;if(i){this.updateMorphTargets(),this.geometry.morphTargetsRelative=!0;for(let{data:{name:r,value:n}}of i)this.updateMorphInfluences(r,t.shared.getVariable(n,[this.uuid,"morphTargetInfluences",r]))}super.updateState(e,t)}updateMorphInfluences(e,t){if(this.morphTargetDictionary===void 0)return;let i=this.morphTargetDictionary[e];i!==void 0&&(this.morphTargetInfluences[i]=t)}updateGeometryGroupsIfNeeded(){Array.isArray(this.material)&&this.geometry.groups.length===0&&this.geometry.addGroup(0,Math.max(this.geometry.getIndex()?.count??0,this.geometry.getAttribute("position").count),0)}updateEntityBoxSize(e,t){let i=this.geometry.userData.parameters;this.is2DType?e.set(0,0,i.depth*.5):this.isNonParametric?(e.setScalar(0),this.geometry.boundingSphere&&e.copy(this.geometry.boundingSphere.center),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)):i.centerOffset?e.fromArray(i.centerOffset):e.setScalar(0),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}bind(e,t){this.skeleton=e,this.isSkinnedMesh=!0,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(e){let t=new bi,i=this.geometry.attributes.skinWeight;for(let r=0,n=i.count;r<n;r++){t.fromBufferAttribute(i,r);let s=1/t.manhattanLength();s!==1/0?t.multiplyScalar(s):t.set(1,0,0,0),i.setXYZW(r,t.x,t.y,t.z,t.w)}}boneTransform(e,t){let i=this.skeleton;if(i===void 0)return;let r=this.geometry;Kj.fromBufferAttribute(r.attributes.skinIndex,e),Zj.fromBufferAttribute(r.attributes.skinWeight,e),Qj.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let n=0;n<4;n++){let s=Zj.getComponent(n);if(s!==0){let a=Kj.getComponent(n);Jj.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),t.addScaledVector(rRe.copy(Qj).applyMatrix4(Jj),s)}}return t.applyMatrix4(this.bindMatrixInverse)}};function nRe(e){if(e.geometry.attributes.extrudeNormal||!e.geometry.attributes.position||!e.geometry.attributes.normal)return;let t=new Map,i=e.geometry.attributes,r=i.position.array,n=i.normal.array,s=new Float32Array(r.length);for(let a=0;a<r.length;a+=3){let o=`${r[a]}_${r[a+1]}_${r[a+2]}`,l=new H(n[a],n[a+1],n[a+2]);t.has(o)?t.get(o)?.normals.push(l):t.set(o,{normals:[l],result:new H})}t.forEach((a,o)=>{for(let l of a.normals)a.result.add(l);a.result.divideScalar(a.normals.length)});for(let a=0;a<r.length;a+=3){let o=`${r[a]}_${r[a+1]}_${r[a+2]}`,l=t.get(o)?.result;l&&(s[a]=l.x,s[a+1]=l.y,s[a+2]=l.z)}e.geometry.setAttribute("extrudeNormal",new kt(s,3))}function sRe(e){if(e.geometry.attributes.extrudeNormals||!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),r=new H;for(let n=0;n<t.length;n+=3)r.set(t[n],t[n+1],t[n+2]).normalize(),i[n]=r.x,i[n+1]=r.y,i[n+2]=r.z;e.geometry.setAttribute("extrudeNormal",new kt(i,3))}function yB(e){if(Array.isArray(e.material)){for(let t of e.material)if(t.getLayersOfType("outline").length===0)return}else if(!(e.material instanceof zd)||e.material.getLayersOfType("outline").length===0)return;e instanceof kn&&e.is2DAndNoDepth?sRe(e):nRe(e)}function xB(e){if(!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),r=parseInt(e.uuid.replace(/\D/g,"")),n=[Ot.seededRandom(r),Ot.seededRandom(r+1e4),Ot.seededRandom(r+2e4)];for(let s=0;s<t.length;s++)i[s]=n[s%3];e.geometry.setAttribute("randomColor",new hi(i,3))}var bc=new Nn,Mw=new H;function aRe(e){let t=!1;return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="SubdivGeometry"&&(t=!0)}),t}var u_=class extends kn{constructor(e,t,i){super(e,t,i),this.data=t,this.hiddenMatrixOld=new yt,this.smoothShading=!0,this.skipReactionUpdate=!1}chooseGeoemtryCache(e){return this.dataPatched.flatShading?e.geometryCache:e.geometryCache2}get subdivPointerNew(){return this.localGeometry!==void 0?this.subdivPointer:this.geometry.ensureSubdivPointer()}get originalGeometryNew(){return this.localGeometry!==void 0?this.originalGeometry:this.geometry.originalGeometry}get phongAngle(){return this.data.geometry.phongAngle??45}updateEntityBoxSize(e,t){let i=this.geometry.userData.parameters;e.copy(this.originalGeometryNew.boundingSphere.center),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}createGeometryByControls(e){if(this.skipReactionUpdate===!0)return;let t=this.localGeometry?.uuid,{originalGeometry:i,subdividedGeometry:r,subdivPointer:n}=no.build(e,this.subdivPointer,this.smoothShading,this.hasNonUniformScale?this.shearScale:void 0);this.subdivPointer=n,i!==void 0&&(this.originalGeometry?.dispose(),this.originalGeometry=i),r!==void 0&&(this.subdividedGeometry?.dispose(),this.subdividedGeometry=r??void 0),this.localGeometry=this.subdividedGeometry??this.originalGeometry,yB(this),xB(this),this.calcBoundingBox(),t&&(this.localGeometry.uuid=t)}updateState(e,t){if(super.updateState(e,t),e.flatShading!==void 0){let i=this.material;this.material=Array.isArray(i)?i.map(r=>r.getFlavor(!1,r.side,r.wireframe)):i.getFlavor(!1,i.side,i.wireframe),this.smoothShading=!e.flatShading,this.createGeometryDelayed(t)}}updateMesh(e=!1){no.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0),this.subdividedGeometry&&no.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0)}updateTopology(){this.originalGeometry.dispose(),this.originalGeometry=no.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=no.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.localGeometry=this.subdividedGeometry??this.originalGeometry}raycast(e,t){let i=this.localGeometry;this.localGeometry=this.originalGeometryNew,xa.prototype.raycast.call(this,e,t),this.localGeometry=i}activateSVDCompensation(){!this.hasNonUniformScale||(this.matrix.copy(this.matrixWorldRigid),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){!this.hasNonUniformScale||(this.updateMatrix(),this.hasNonUniformScale=void 0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let e=this.originalGeometry;e.boundingSphere===null&&(e.boundingSphere=new Wo,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,i=e.boundingSphere.center;bc.setFromBufferAttribute(t),bc.getCenter(i),e.boundingSphere.radius=i.distanceTo(bc.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),bc.getSize(Mw),this.hasNonUniformScale&&Mw.divide(this.scale);let r={width:Mw.x,height:Mw.y,depth:Mw.z};return this.geometry.userData.parameters=r,r}updateBoundingSphere(e){let t=this.originalGeometry;bc.min.set(e[0],e[2],e[4]),bc.max.set(e[1],e[3],e[5]),this.hasNonUniformScale&&(bc.min.applyMatrix4(this.shearScaleInv),bc.max.applyMatrix4(this.shearScaleInv)),t.boundingSphere===null&&(t.boundingSphere=new Wo);let i=t.boundingSphere.center;bc.getCenter(i),t.boundingSphere.radius=i.distanceTo(bc.max)}freeSubdivPointer(){this.subdivPointer&&(no.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0),this.localGeometry=void 0,this.originalGeometry?.dispose(),this.subdividedGeometry?.dispose()}dispose(){super.dispose(),this.freeSubdivPointer()}updateByPatchedOpGeometry(e,t,i){super.updateByPatchedOpGeometry(e,t,i),this.localGeometry&&this.createGeometryByControls(t)}},$j=-1,oRe=1,lRe={x:[1,0,0],"-x":[-1,0,0],y:[0,1,0],"-y":[0,-1,0],z:[0,0,1],"-z":[0,0,-1]},uRe={polygon_center:0,edge:1,vertex:2},QA=(e,t)=>(i,r)=>!t||i===0||e===0?0:e*r/100,Di=(e,t)=>{let i=Math.abs(t),r=i*-1;return(e-$j)*(i-r)/(oRe-$j)+r},cRe=new H,KA=new H,hRe=new H,dRe=new H;function Ky(e,t){let i=hRe.fromArray(e),r=dRe.fromArray(t);KA.copy(r).sub(i);let n=KA.length();return KA.normalize().multiplyScalar(n*.5),cRe.copy(i).add(KA).toArray()}var Fl=new pa,ZA=new H,rC=new H,ag=new H;function fRe(e){let t=[];for(let i=0;i<=e.index.count;i++)if(ZA.fromArray(e.index.array,i*3),Fl.setFromAttributeAndIndices(e.attributes.position,ZA.x,ZA.y,ZA.z),Fl.getNormal(rC),Fl.getMidpoint(ag),!(isNaN(ag.x)||isNaN(ag.y)||isNaN(ag.z))){let{a:r,b:n,c:s}=Fl,a=r.toArray(),o=n.toArray(),l=s.toArray(),u=r.distanceTo(n),c=n.distanceTo(s),h=s.distanceTo(r),d=Ky(a,o),p=Ky(o,l),m=Ky(l,a),v=[u,c,h],g=Math.max(...v),w=v.filter(A=>Math.round(A)===Math.round(g)).length>1,S=[],_=Fl.getMidpoint(ag).toArray();g===u&&!w&&(S=[p,m,m],_=d),g===c&&!w&&(S=[d,m,m],_=p),g===h&&!w&&(S=[d,p,p],_=m),w&&(S=[d,p,m]),t.push({vertices:[a,o,l],faceCenters:S,midpoint:_,norm:Fl.getNormal(rC).toArray()})}return t}function pRe(e){let t=[],{position:i}=e.attributes;for(let r=0;r<i.count;r++){Fl.setFromAttributeAndIndices(i,r*3,r*3+1,r*3+2),Fl.getNormal(rC),Fl.getMidpoint(ag);let n=Fl.a.toArray(),s=Fl.b.toArray(),a=Fl.c.toArray();t.push({vertices:[n,s,a],faceCenters:[Ky(n,s),Ky(s,a),Ky(a,n)],midpoint:ag.toArray(),norm:rC.toArray()})}return t}var mRe=4,gRe=.5,CD=e=>.5*(1-Math.cos(e*Math.PI)),vRe=class{constructor(){this.perlin=new Array(4096)}noise(e,t=0,i=0){if(this.perlin==null){this.perlin=new Array(4096);for(let g=0;g<4096;g++)this.perlin[g]=Math.random()}e<0&&(e=-e),t<0&&(t=-t),i<0&&(i=-i);let r=Math.floor(e),n=Math.floor(t),s=Math.floor(i),a=e-r,o=t-n,l=i-s,u,c,h=0,d=.5,p,m,v;for(let g=0;g<mRe;g++){let w=r+(n<<4)+(s<<8);u=CD(a),c=CD(o),p=this.perlin[w&4095],p+=u*(this.perlin[w+1&4095]-p),m=this.perlin[w+16&4095],m+=u*(this.perlin[w+16+1&4095]-m),p+=c*(m-p),w+=256,m=this.perlin[w&4095],m+=u*(this.perlin[w+1&4095]-m),v=this.perlin[w+16&4095],v+=u*(this.perlin[w+16+1&4095]-v),m+=c*(v-m),p+=CD(l)*(m-p),h+=p*d,d*=gRe,r<<=1,a*=2,n<<=1,o*=2,s<<=1,l*=2,a>=1&&(r++,a--),o>=1&&(n++,o--),l>=1&&(s++,l--)}return h}noiseSeed(e){let t=(()=>{let i,r;return{setSeed(n){r=i=(n??Math.random()*4294967296)>>>0},getSeed(){return i},rand(){return r=(1664525*r+1013904223)%4294967296,r/4294967296}}})();t.setSeed(e),this.perlin=new Array(4096);for(let i=0;i<4096;i++)this.perlin[i]=t.rand()}},yRe=vRe,eH=new H,tH=new yt,iH=new zx;function rH(e){let t=!1;return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&(r.geometry.type==="TextGeometry"||r.geometry.type==="InputGeometry")&&(t=!0)}),t}var wB=class extends kn{constructor(e,t,i){super(e,t,i),this.data=t}get textGeometry(){return this.geometry}get charWidths(){return this.textGeometry.charWidths}get charCoords(){return this.textGeometry.charCoords}get wrappedText(){return this.textGeometry.wrappedText}get font(){return this.textGeometry.font}get initialOffsetY(){let e=this.dataPatched;return this.font?.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,e.geometry.height,this.fontScale,e.geometry.verticalAlign)??0}get fontScale(){let e=this.dataPatched;return this.font?e.geometry.fontSize/this.font.unitsPerEm:1}get AD(){return Math.abs(this.ascender-this.descender)}get ascender(){return(this.font?.ascender??1)*this.fontScale}get descender(){return(this.font?.descender??1)*this.fontScale}get lineHeight(){let e=this.dataPatched;return e.geometry.fontSize*e.geometry.lineHeight}raycast(e,t){let{matrixWorld:i}=this;if(!(isNaN(e.ray.origin.x)||this.scale.x===0||this.scale.y===0||this.scale.z===0)&&(tH.copy(i).invert(),iH.copy(e.ray).applyMatrix4(tH),iH.intersectBox(this.singleBBox,eH))){let r=eH.applyMatrix4(i),n=e.ray.origin.distanceTo(r);t.push({distance:n,point:r.clone(),object:this})}}},eo=1e-4,_c,qQ,XQ,YQ,nH=new H,sH=new H;nQ.then(e=>{_c=e,qQ=[_c.get_face_center,_c.get_edge_midpoint,_c.get_vertex_position],XQ=[_c.get_face_normal,_c.get_edge_normal,_c.get_vertex_normal],YQ=[_c.face_count,_c.edge_count,_c.vertex_count]});var xRe=new yt,wRe=new yt,jf=new H,JA=new H,Aw=new H,TD=new H,bRe=new H,_Re=new H;function Jr(e,t){return[typeof e?.[0]=="number"?e[0]:typeof e?.[0]=="string"&&t?parseFloat(String(t.shared.getVariable(e[0])??"0")):0,typeof e?.[1]=="number"?e[1]:typeof e?.[1]=="string"&&t?parseFloat(String(t.shared.getVariable(e[1])??"0")):0,typeof e?.[2]=="number"?e[2]:typeof e?.[2]=="string"&&t?parseFloat(String(t.shared.getVariable(e[2])??"0")):0]}var SRe=class{constructor(e,t){this.data=e,this.is3D=t,this.perlin=new yRe,e.noiseType==="perlin"?(this.perlin.noiseSeed(e.seed),t?this.noise=(i,r,n)=>this.perlin.noise(i,r,n):this.noise=i=>this.perlin.noise(i)):t?this.noise=ZCe((0,UL.default)(e.seed)):this.noise=KCe((0,UL.default)(e.seed??""))}},jl=class extends eB(vr){constructor(e,t){super(),this.parameters=t,this.objectForSample=void 0,this._pendingMediaLoad=!1,this.random=null,this.object=e}resetOnMove(){this.removeFromParent(),this.parent=null}expandClones(e){if(this.parent===null)this.updateState(this.parameters,e);else for(let t of this.children)t instanceof ya&&t.expand()}invalidateTransform(e){this.matrixWorldNeedsUpdate=!0,this.traverse(t=>{t instanceof ya&&t.object===e&&(t.matrixWorldNeedsUpdate=!0)})}onObjUpdateMatrix(){this.parameters.type!=="toObject"&&(this.matrixWorldNeedsUpdate=!0)}update(e){switch(this._updateCount(e),this.parameters.type){case"radial":this._updateRadial(this.parameters,e);break;case"linear":this._updateLinear(this.parameters,e);break;case"grid":this._updateGrid(this.parameters,e);break;case"toObject":this._updateToObject(this.parameters,e)}for(let t of this.children)t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD())}_updateCount(e,t){let i;if(t!==void 0)i=t;else{let r=Jr(this.parameters.grid.count,e);i=this.parameters.type==="grid"?Math.round(r[0])*Math.round(r[1])*Math.round(r[2]):this.parameters.count}if(this.parameters.type==="toObject"){if(!this.parameters.toObject.object)i=0;else if(t===void 0&&this.parameters.toObject.spreadType!=="random")return}if(this.parameters.type==="toObject"&&this.objectForSample){let r=this.children;if(r.length===i)return;if(r.length<i)for(let n=0,s=i-r.length;n<s;++n){let a=new ya(this.object);a.expand(),this.add(a)}else for(let n=0,s=r.length-i;n<s;++n)this.remove(r[n])}else{if(this.children.length===i)return;if(this.children.length<i)for(let r=0,n=i-this.children.length;r<n;++r){let s=new ya(this.object);s.expand(),this.add(s)}else for(let r=0,n=this.children.length-i;r<n;++r)this.remove(this.children[r])}}getRandom(e,t=!1){return(this.random===null||this.random.data.seed!==e.seed||this.random.is3D!==t)&&(this.random=new SRe(e,t)),this.random}_updateRadial(e,t){let i=e.radial,r=i.start*Ot.DEG2RAD,n=i.end*Ot.DEG2RAD,s=r-n,a=Jr(i.rotation,t),o=new ws(a[0],a[1],a[2]),l;switch(i.axis){case"z":l=new H(0,0,1);break;case"y":l=new H(0,1,0);break;default:case"x":l=new H(1,0,0);break}let u=e.randomnessObject??hp.defaultData([1,1,1]).randomnessObject,c=this.getRandom(u),h=QA(u.strength,this.parameters.randomness);for(let[d,p]of this.children.entries()){let m=d*(u.freqScale/10)+u.movement,v=c.noise(m,m,m),g=d+1,w=Jr(i.scale,t),S=Jr(u.scale,t);p.scale.x=w[0]+h(g,Di(v,S[0]))||eo,p.scale.y=w[1]+h(g,Di(v,S[1]))||eo,p.scale.z=w[2]+h(g,Di(v,S[2]))||eo,p.position.setScalar(0);let _=s/e.count*d-r;switch(i.axis){case"x":p.rotation.set(0,_,0);break;case"y":p.rotation.set(0,0,_);break;case"z":p.rotation.set(_,0,0);break}p.translateOnAxis(l,i.radius);let A=Jr(i.position,t),C=Jr(u.position,t);p.position.x+=A[0]+h(g,Di(v,C[0])),p.position.y+=A[1]+h(g,Di(v,C[1])),p.position.z+=A[2]+h(g,Di(v,C[2]));let E=Jr(u.rotation,t),I=h(g,Di(v,E[0])),T=h(g,Di(v,E[1])),D=h(g,Di(v,E[2]));i.alignment===!0?(p.rotation.x+=o.x+I,p.rotation.y+=o.y+T,p.rotation.z+=o.z+D):p.rotation.set(o.x+I,o.y+T,o.z+D)}}_updateLinear(e,t){if(e.type!=="linear")throw new Error;let i=e.linear,r=Jr(i.rotation,t),n=Jr(i.scale,t),s=Jr(i.position,t),a=new ws(r[0]??0,r[1]??0,r[2]??0),o=e.randomnessObject??hp.defaultData([1,1,1]).randomnessObject,l=Jr(o.rotation,t),u=Jr(o.scale,t),c=Jr(o.position,t),h=this.getRandom(o),d=QA(o.strength,this.parameters.randomness);for(let[p,m]of this.children.entries()){let v=p*(o.freqScale/10)+o.movement,g=h.noise(v,v,v),w=p+1,S=d(w,Di(g,l[0])),_=d(w,Di(g,l[1])),A=d(w,Di(g,l[2]));m.scale.x=1+(n[0]-1)*p+d(w,Di(g,u[0]))||eo,m.scale.y=1+(n[1]-1)*p+d(w,Di(g,u[1]))||eo,m.scale.z=1+(n[2]-1)*p+d(w,Di(g,u[2]))||eo,m.rotation.x=a.x*p+S,m.rotation.y=a.y*p+_,m.rotation.z=a.z*p+A,m.position.x=s[0]*p+d(w,Di(g,c[0])),m.position.y=s[1]*p+d(w,Di(g,c[1])),m.position.z=s[2]*p+d(w,Di(g,c[2]))}}_updateGrid(e,t){let i=0,r=e.grid,n=e.randomnessObject??hp.defaultData([1,1,1]).randomnessObject,s=Jr(n.scale,t),a=Jr(n.rotation,t),o=Jr(n.position,t),l=this.getRandom(n,!0),u=QA(n.strength,this.parameters.randomness),c=Jr(r.count,t),h=Jr(r.size,t);if(r.useCenter===!0){let d={x:c[0]%2===0?2:1,y:c[1]%2===0?2:1,z:c[2]%2===0?2:1},p=new H(h[0]*(c[0]-d.x)*.5,h[1]*(c[1]-d.y)*.5,h[2]*(c[2]-d.z)*.5);for(let m=0;m<c[0];m++)for(let v=0;v<c[1];v++)for(let g=0;g<c[2];g++){let w=l.noise((m+1)*(n.freqScale/10)+n.movement,(v+1)*(n.freqScale/10)+n.movement,(g+1)*(n.freqScale/10)+n.movement),S=this.children[i++];S.scale.x=1+u(i,Di(w,s[0]))||eo,S.scale.y=1+u(i,Di(w,s[1]))||eo,S.scale.z=1+u(i,Di(w,s[2]))||eo;let _=u(i,Di(w,a[0])),A=u(i,Di(w,a[1])),C=u(i,Di(w,a[2]));S.rotation.set(_,A,C),S.position.x=h[0]*m-p.x+u(i,Di(w,o[0])),S.position.y=h[1]*v-p.y+u(i,Di(w,o[1])),S.position.z=h[2]*g-p.z+u(i,Di(w,o[2]))}}else for(let d=0;d<c[0];d++)for(let p=0;p<c[1];p++)for(let m=0;m<c[2];m++){let v=l.noise((d+1)*(n.freqScale/10)+n.movement,(p+1)*(n.freqScale/10)+n.movement,(m+1)*(n.freqScale/10)+n.movement),g=this.children[i++];g.scale.x=1+u(i,Di(v,s[0]))||eo,g.scale.y=1+u(i,Di(v,s[1]))||eo,g.scale.z=1+u(i,Di(v,s[2]))||eo;let w=u(i,Di(v,a[0])),S=u(i,Di(v,a[1])),_=u(i,Di(v,a[2]));g.rotation.set(w,S,_),g.position.x=h[0]*d+u(i,Di(v,o[0])),g.position.y=-h[1]*p+u(i,Di(v,o[1])),g.position.z=-h[2]*m+u(i,Di(v,o[2]))}}_updateToObject(e,t){if(e.type!=="toObject")throw new Error;let{toObject:i}=e,r=Jr(i.rotation,t),n=Jr(i.position,t),s=Jr(i.scale,t),a=new ws(r[0],r[1],r[2]),o=e.randomnessObject??hp.defaultData([1,1,1]).randomnessObject,l=Jr(o.rotation,t),u=Jr(o.position,t),c=Jr(o.scale,t),h=this.getRandom(o),d=QA(o.strength,this.parameters.randomness);if(!i.object){for(let[,w]of this.children.entries())w.position.set(0,0,0),w.scale.setScalar(1),w.rotation.set(0,0,0);this.objectForSample=void 0;return}if(!this.objectForSample)return;if(this.objectForSample instanceof wB)if(!this.objectForSample.font?.isLoaded||this.objectForSample.geometry.attributes.position===void 0){this._pendingMediaLoad=!0;return}else this._pendingMediaLoad=!1;if(this.objectForSample.geometry===void 0&&this.objectForSample.isAncestorOf(this.object.uuid)){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) seem to be a child/descendant of the object it's being cloned to. Please re-parent it so that they are siblings instead.`);return}let p=this.getSubdivData();if(p.length>0){let w=Math.round(p.length*i.count/100);this._updateCount(t,w)}else{let w=this.objectForSample.geometry.getAttribute("position");if(!w||isNaN(w.count)||w.count===0){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) cannot be cloned on the surface of "${this.objectForSample.name}" (${this.objectForSample.uuid}) because the latter does not have a valid geometry.`);return}}this.objectForSample.updateMatrixWorld();let m=new JCe(this.objectForSample).build(),v=lRe[i.axis],g=this.children;m.setRandomGenerator((0,UL.default)(this.object.uuid+i.seed));for(let[w,S]of g.entries()){let _=w*(o.freqScale/10)+o.movement,A=h.noise(_,_,_),C=w+1,E=d(C,Di(A,l[0])),I=d(C,Di(A,l[1])),T=d(C,Di(A,l[2]));i.spreadType==="random"?m.sample(Aw,TD):(p.length&&(Aw.fromArray(p[w].pos),TD.fromArray(p[w].norm)),this.objectForSample instanceof u_&&Aw.applyMatrix4(xRe.copy(this.objectForSample.matrixWorld).invert())),Aw.applyMatrix4(this.object.hiddenMatrix.clone().invert()),S.position.copy(Aw),jf.fromArray(v);let D=i.align==="normal"?TD:this.object.getWorldDirection(_Re),L=JA.fromArray(n);JA.x+=d(C,Di(A,u[0])),JA.y+=d(C,Di(A,u[1])),JA.z+=d(C,Di(A,u[2]));let z=Math.acos(D.dot(jf)),G=bRe.crossVectors(jf,D).normalize(),V=wRe.makeRotationAxis(G,z),j=D.clone().cross(this.object.up).normalize(),J=j.clone().cross(D).normalize(),ne=new yt().makeBasis(j,D,J),K=new H(jf.y,jf.z,jf.x).normalize(),B=K.clone().cross(jf).normalize(),Z=new yt().makeBasis(K,jf,B).invert(),F=new yt().multiplyMatrices(ne,Z);S.rotation.setFromRotationMatrix(F),L.applyMatrix4(V),S.position.add(L),S.rotation.x=S.rotation.x+a.x+E,S.rotation.y=S.rotation.y+a.y+I,S.rotation.z=S.rotation.z+a.z+T,S.scale.setScalar(1),S.scale.x=S.scale.x+s[0]+d(C,Di(A,c[0]))||eo,S.scale.y=S.scale.y+s[1]+d(C,Di(A,c[1]))||eo,S.scale.z=S.scale.z+s[2]+d(C,Di(A,c[2]))||eo,S.scale.multiply(this.object.scale),S.hiddenMatrix=this.object.hiddenMatrix}}getSubdivData(){if(!this.objectForSample)return[];let e=this.parameters.toObject.spreadType,t=new Map,i=(n,s)=>{let a=Math.round(n[0]*1e4)+"_"+Math.round(n[1]*1e4)+"_"+Math.round(n[2]*1e4),o=t.get(a);o?(o.pos[0]+=n[0],o.pos[1]+=n[1],o.pos[2]+=n[2],o.norm[0]+=s[0],o.norm[1]+=s[1],o.norm[2]+=s[2],o.count+=1):t.set(a,{pos:[...n],norm:[...s],count:1})};if(e==="random")return[];if(this.objectForSample instanceof u_){let n=this.objectForSample,s=uRe[e],a=YQ[s],o=qQ[s],l=XQ[s],u=a(n.subdivPointerNew);for(let c=0;c<=u-1;c++){let h=o(n.subdivPointerNew,c),d=l(n.subdivPointerNew,c);nH.fromArray(h).applyMatrix4(n.matrixWorld),sH.fromArray(d),i(nH.toArray(),sH.toArray())}}else(this.objectForSample.geometry.index?fRe(this.objectForSample.geometry):pRe(this.objectForSample.geometry)).forEach((n,s)=>{e==="polygon_center"&&i(n.midpoint,n.norm),e==="vertex"&&(i(n.vertices[0],n.norm),i(n.vertices[1],n.norm),i(n.vertices[2],n.norm)),e==="edge"&&(i(n.faceCenters[0],n.norm),i(n.faceCenters[1],n.norm),i(n.faceCenters[2],n.norm))});let r=Array.from(t.values());for(let n of r)n.pos[0]/=n.count,n.pos[1]/=n.count,n.pos[2]/=n.count,n.norm[0]/=n.count,n.norm[1]/=n.count,n.norm[2]/=n.count;return r}updateState(e,t){if(this.parameters=JC(e),this.parameters.type!=="toObject")(this.parent===null||this.parent!==this.object)&&(this.removeFromParent(),this.object.parent?.add(this),this.matrix=this.object.matrix,this.hiddenMatrix=this.object.hiddenMatrix,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1);else if(this.parent===null||this.parent.uuid!==this.parameters.toObject.object){this.removeFromParent();let i=t.scene.find(this.parameters.toObject.object);i instanceof xa?this.objectForSample=i:this.objectForSample=void 0,this.matrix=new yt,this.hiddenMatrix=new yt,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1,i&&i.add(this)}this.update(t)}get pendingMediaLoad(){return this._pendingMediaLoad}},Q_=e=>{var t;return t=class extends e{},t.geometryHelper=new Wu(30,30,30),t},$A=new zx,PD=new Wo,aH=new yt,K_=(e,t,i,r,n=!1,s=e)=>{let a=t,o=s.matrixWorld;if(a.boundingSphere===null&&a.computeBoundingSphere(),PD.copy(a.boundingSphere),PD.applyMatrix4(o),i.ray.intersectsSphere(PD)===!1||(aH.copy(o).invert(),$A.copy(i.ray).applyMatrix4(aH),a.boundingBox!==null&&$A.intersectsBox(a.boundingBox)===!1))return;let l,u,c,h,d=a.index,p=a.attributes.position,m=a.drawRange,v,g;if(n===!1){let S=Math.max(0,m.start),_=Math.min(d.count,m.start+m.count);for(v=S,g=_;v<g;v+=3)if(u=d.getX(v),c=d.getX(v+1),h=d.getX(v+2),l=w(e,i,$A,p,u,c,h),l){l.faceIndex=Math.floor(v/3),r.push(l);return}}else{let S=a.attributes.position,_=new H,A=new H,C=new H,E=new H,I=2,T=1/((s.scale.x+s.scale.y+s.scale.z)/3),D=T*T,L=Math.max(0,m.start),z=Math.min(S.count,m.start+m.count);for(let G=L,V=z-1;G<V;G+=I){if(_.fromBufferAttribute(S,G),A.fromBufferAttribute(S,G+1),$A.distanceSqToSegment(_,A,E,C)>D)continue;E.applyMatrix4(s.matrixWorld);let j=i.ray.origin.distanceTo(E);j<i.near||j>i.far||r.push({distance:j,point:C.clone().applyMatrix4(s.matrixWorld),object:e})}}function w(S,_,A,C,E,I,T){let D=new H,L=new H,z=new H,G=new H,V=new H;if(D.fromBufferAttribute(C,E),L.fromBufferAttribute(C,I),z.fromBufferAttribute(C,T),A.intersectTriangle(D,L,z,!1,G)===null)return null;V.copy(G),V.applyMatrix4(S.matrixWorld);let j=_.ray.origin.distanceTo(V);return j<_.near||j>_.far?null:{faceIndex:1,distance:j,point:V.clone(),object:S}}},eE=new H,Dl=new Wp,MRe=class extends V_{constructor(e){let t=new Kt,i=new Gp({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],n=[],s={},a=new li(15711266),o=new li(15711266),l=new li(2857471);u("n1","n2",a),u("n2","n4",a),u("n4","n3",a),u("n3","n1",a),u("f1","f2",a),u("f2","f4",a),u("f4","f3",a),u("f3","f1",a),u("n1","f1",a),u("n2","f2",a),u("n3","f3",a),u("n4","f4",a),u("p","n1",o),u("p","n2",o),u("p","n3",o),u("p","n4",o),u("u1","u2",l),u("u2","u3",l),u("u3","u1",l);function u(h,d,p){c(h,p),c(d,p)}function c(h,d){r.push(0,0,0),n.push(d.r,d.g,d.b),s[h]===void 0&&(s[h]=[]),s[h].push(r.length/3-1)}t.setAttribute("position",new kt(r,3)),t.setAttribute("color",new kt(n,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){let e=this.geometry,t=this.pointMap;Dl.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];let i=1,r=1,n=.8;Su("n1",t,e,Dl,-i,-r,n),Su("n2",t,e,Dl,i,-r,n),Su("n3",t,e,Dl,-i,r,n),Su("n4",t,e,Dl,i,r,n);let s=n;Su("f1",t,e,Dl,-i,-r,s),Su("f2",t,e,Dl,i,-r,s),Su("f3",t,e,Dl,-i,r,s),Su("f4",t,e,Dl,i,r,s);let a=s,o=.5;Su("u1",t,e,Dl,i*.7*o,r*1.1,a),Su("u2",t,e,Dl,-i*.7*o,r*1.1,a),Su("u3",t,e,Dl,0,r*(1.1+.9*o),a),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function Su(e,t,i,r,n,s,a){eE.set(n,s,a).unproject(r);let o=t[e];if(o!==void 0){let l=i.getAttribute("position");for(let u=0,c=o.length;u<c;u++)l.setXYZ(o[u],eE.x,eE.y,eE.z)}}var ARe=class extends Q_(MRe){constructor(e){super(e),this.object=e,this.object=e,this.name=`CombinedCameraHelper: ${e.uuid}`}updateMatrixWorld(e){super.updateMatrixWorld(e),this.updateTarget()}updateTarget(){let e=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(e)}raycast(e,t){K_(this.object,this.geometry,e,t,!0)}},iO;(e=>e.is=t=>"objectHelper"in t)(iO||(iO={}));var Kx=(e,t)=>class extends tB(e){constructor(){super(...arguments),this.objectHelper=new t(this),this.gizmos={}}get geometryHelper(){return t.geometryHelper}raycast(i,r){this.objectHelper.raycast(i,r)}showGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof v2&&(r.visible=!0)}}updateEntityBoxSize(i,r){this.objectHelper.visible&&this.geometryHelper instanceof Wu?(i.setScalar(0),r.set(this.geometryHelper.parameters.width,this.geometryHelper.parameters.height,this.geometryHelper.parameters.height).multiplyScalar(.5)):super.updateEntityBoxSize(i,r)}hideGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof v2&&(r.visible=!1)}}},tE=790,ty=new H,DD=new H,RD=new xi,ID=new H,Ew=new H,LD=new H,Ms=class extends Kx(Wp,ARe){constructor(e="",t={...i_.defaultData,name:""}){super(),this._cameraType="OrthographicCamera",this.targetOffset=dx.DefaultTargetOffset,this.isUpVectorFlipped=!1,this.angleOffsetFromUp=0,this.wasMovedByUser=!1,this.wasMovedBySwitchCameraAction=!1,this.super_Entity(e,t),this.previousProjectionMatrix=new yt,this.matrixAutoUpdate=!0,this.width=window.innerWidth,this.height=window.innerHeight;let i=this.width,r=this.height;this.orthoCamera=new jC(i*-.5,i*.5,r*.5,r*-.5,-5e4,1e4),this.perspCamera=new La(45,i/r,50,1e4),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.objectHelper.update()}get isPerspectiveCamera(){return this.cameraType==="PerspectiveCamera"}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}set fov(e){this.perspCamera.fov=e}get fov(){return this.perspCamera.fov}setNear(e,t){e==="PerspectiveCamera"?this.perspCamera.near=t:this.orthoCamera.near=t}setZoom(e,t){t>=0&&(e==="PerspectiveCamera"?this.perspCamera.zoom=t:this.orthoCamera.zoom=t)}set cameraType(e){e==="PerspectiveCamera"?this.toPerspective():e==="OrthographicCamera"&&this.toOrthographic()}get near(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.near:this.orthoCamera.near}set near(e){this._cameraType==="PerspectiveCamera"?this.perspCamera.near=e:this.orthoCamera.near=e}get zoom(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(e){e>=0&&(this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom=e:this.orthoCamera.zoom=e)}lookAt(e,t,i){typeof e=="number"&&(e=new H(e,t,i)),super.lookAt(e),this.getWorldPosition(ty),this.targetOffset=ty.distanceTo(e)}getTarget(e=new H){return this.getWorldDirection(DD),this.getWorldPosition(ty),DD.multiplyScalar(this.targetOffset),e.copy(ty).add(DD),e}getDistanceToTarget(){let e=this.getTarget();return this.getWorldPosition(ty),ty.distanceTo(e)}updateUp(){this.getWorldQuaternion(RD),ID.set(0,0,1).applyQuaternion(RD),Ew.copy(vr.DEFAULT_UP),this.isUpVectorFlipped&&Ew.negate(),Ew.applyQuaternion(RD),LD.copy(vr.DEFAULT_UP).projectOnPlane(ID),this.angleOffsetFromUp=LD.angleTo(Ew),this.angleOffsetFromUp*=LD.cross(Ew).dot(ID)>=0?1:-1}updateTransformState(e,t){let i=super.updateTransformState(e,t);return e.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateUp(),i}getViewFrontToObject(e){let t=e.getWorldPosition(new H),i=e.getWorldDirection(new H).multiplyScalar(this.targetOffset);return{position:t.clone().add(i),target:t}}getViewToTarget(e){let t=this.getWorldDirection(new H).multiplyScalar(this.targetOffset);return{position:e.clone().sub(t),target:e}}getViewToObject(e){let t=new H;return e.getWorldPosition(t),this.getViewToTarget(t)}setViewplaneSize(e,t,i=!1){if(this.aspect=e/t,i){let r=e>t?this.aspect:1,n=e>t?1:this.aspect;this.left=-tE*.5*r,this.right=tE*.5*r,this.top=tE*.5*(1/n),this.bottom=-tE*.5*(1/n)}else this.left=-e*.5,this.right=e*.5,this.top=t*.5,this.bottom=-t*.5;this.updateProjectionMatrix()}copyViewPlaneSize(e){this.aspect=e.aspect,this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(e){this.perspCamera.setFocalLength(e),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(e,t,i,r,n,s){this._cameraType==="PerspectiveCamera"?this.perspCamera.setViewOffset(e,t,i,r,n,s):this.orthoCamera.setViewOffset(e,t,i,r,n,s)}clearViewOffset(){this._cameraType==="PerspectiveCamera"?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}copyHistory(){this.previousProjectionMatrix&&this.previousProjectionMatrix.copy(this.projectionMatrix)}updateProjectionMatrix(){this._cameraType==="PerspectiveCamera"?this.toPerspective():this._cameraType==="OrthographicCamera"&&this.toOrthographic()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(e,t){return super.copy(e,t),this.parent=e.parent,this.orthoCamera.copy(e.orthoCamera),this.perspCamera.copy(e.perspCamera),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.far=e.far,this.view=e.view===null?null:Object.assign({},e.view),this._cameraType=e._cameraType,this.aspect=e.aspect,this.fov=e.fov,this.focus=e.focus,this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this.targetOffset=e.targetOffset,this.updateProjectionMatrix(),this}toCameraState(e=[]){let t={type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped};return GI(t,e)}updateCameraSubtype(e,t){let i=e==="perspective"?"PerspectiveCamera":"OrthographicCamera";t.zoom!==void 0&&this.setZoom(i,t.zoom),t.near!==void 0&&this.setNear(i,t.near),t.fov!==void 0&&i==="PerspectiveCamera"&&(this.fov=t.fov)}updateState(e,t){this.updateCameraState(e,t)}updateCameraState(e,t){this.updateState_Entity(e,t),e.far!==void 0&&(this.far=e.far),e.orthographic!==void 0&&this.updateCameraSubtype("orthographic",e.orthographic),e.perspective!==void 0&&this.updateCameraSubtype("perspective",e.perspective),e.type!==void 0&&(this.cameraType=e.type),e.up!==void 0&&this.up.fromArray(e.up),e.targetOffset!==void 0&&(this.targetOffset=e.targetOffset),e.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateProjectionMatrix()}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.path.length===1&&e.type===0&&this.updateCameraSubtype(e.path[0],e.props)}toState(e){return{...super.toState(e),...this.toCameraState(e),type:this.cameraType}}},iy=new yt,ERe=new yt;function oH(e){let t=!1;return e.scene.objects.traverse((i,r)=>{r.geometry?.type==="BooleanGeometry"&&(t=!0)}),t}var Kg=class extends Op{constructor(e,t,i){super(e,t),this.data=t,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry=new Kt,this.onAfterRender=(r,n,s,a,o,l)=>{super.onAfterRender(r,n,s,a,o,l),this.recomputeBoolean()},this.geometry.userData.parameters={width:0,height:0,depth:0}}get booleanOp(){return this.data.geometry.operation}get phongAngle(){return this.data.geometry.phongAngle??45}get isLOD(){return this.recomputeBoolean(),!1}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.path.length===1&&e.path[0]==="geometry"&&e.type===0&&e.props.operation!==void 0&&(this.freeBooleanPointer(),this.resetBBoxNeedsUpdate())}freeBooleanPointer(){super.freeBooleanPointer(),this.geometry.dispose()}recomputeBoolean(e,t=!0){if(this.booleanMeshSetAddress!==-1&&!e)return;for(let r=0;r<this.children.length;r++){let n=this.children[r];n instanceof Kg&&n.dataPatched.visible===!0&&n.recomputeBoolean(e===!0,t)}this.meshSetAddresses=[];for(let r=0;r<this.children.length;r++){let n=this.children[r];if(n instanceof xa&&n.dataPatched.visible===!0&&n.geometry.attributes.position?.count>0&&n.geometry.drawRange.count>0&&n.booleanMeshSetAddress!==0){iy.multiplyMatrices(n.hiddenMatrix,n.matrix);try{if(n.booleanMeshSetAddress===-1){if((n.geometry.index??n.geometry.getAttribute("position")).count/3<15e5&&(n.booleanMeshSetAddress=td.getMeshSet(n.geometry,e===!0,t)),n.booleanMeshSetAddress===-1)return;td.transformMeshSet(n.booleanMeshSetAddress,iy),n.booleanMatrixInvOld.copy(iy).invert(),n.booleanWasTransformed=!1}else n instanceof Kg&&n.needsTransformForDownstream===!0?(td.transformMeshSet(n.booleanMeshSetAddress,iy),n.needsTransformForDownstream=!1):n.booleanWasTransformed===!0&&(td.transformMeshSet(n.booleanMeshSetAddress,ERe.multiplyMatrices(iy,n.booleanMatrixInvOld)),n.booleanMatrixInvOld.copy(iy).invert(),n.booleanWasTransformed=!1)}catch(s){console.error(s),n.booleanMeshSetAddress=0,n.geometry.userData.booleanOperationDidFail=!0;continue}td.hasOpenEdges(n.booleanMeshSetAddress)===!1||r===this.children.length-1&&this.booleanOp===2?(this.meshSetAddresses.push(n.booleanMeshSetAddress),n.geometry.userData.booleanOperationDidFail=!1):n.geometry.userData.booleanOperationDidFail="openEdges"}}if(this.meshSetAddresses.length===0){this.geometry.setAttribute("position",new kt([],0)),this.geometry.setDrawRange(0,0);return}if(e===!0)return td.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let i=this.geometry;i.dispose(),this.geometry=new Kt,this.geometry.userData=i.userData,this.geometry.boundingSphere=i.boundingSphere;try{this.booleanMeshSetAddress=td.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(r){this.booleanMeshSetAddress=0,this.geometry.userData.booleanOperationDidFail=!0,console.error(r)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,yB(this),xB(this)}dispose(){super.dispose(),this.geometry.dispose()}},nC;(e=>{function t(i){return Xi.is(i)&&i instanceof W_}e.is=t})(nC||(nC={}));var bB=(e,t)=>class extends Kx(e,t){updateState_Light(i,r){this.updateState_Entity(i,r),i.color!==void 0&&(this.color=r.shared.color(i.color)),i.intensity!==void 0&&(this.intensity=i.intensity),i.depth!==void 0&&(this.shadow.camera.far=i.depth,this.shadow.needsUpdate=!0),i.shadows!==void 0&&(this.castShadow=i.shadows)}},Bc=e=>e instanceof xa,wd=e=>e!==null&&e instanceof Kg,rO=e=>iO.is(e),CRe=new H(1,1,1),lH=new H,TRe=new H,uH=new xi,Z_=class extends Q_(k0e){constructor(e,t=15){super(t),this.object=e,this.dummy=new yd,this.object.updateMatrixWorld(),this.name=`EmptyObjectHelper: ${e.uuid}`,this.matrix=this.dummy.matrixWorld,this.matrixAutoUpdate=!1,this.object.isBone&&(this.visible=!1)}raycast(e,t){K_(this.object,Z_.geometryHelper,e,t,!1,this.dummy)}update(){}updateMatrix(){}updateMatrixWorld(e){this.object.matrixWorld.decompose(lH,uH,TRe),this.matrix.compose(lH,uH,CRe),super.updateMatrixWorld(e)}updateWorldMatrix(e,t){}},Zy=class extends Kx(yd,Z_){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t),"buffer"in e&&Object.keys(e).length===1&&t.scene.reloadSplats()}},fb=class extends Kx(yd,Z_){constructor(e,t,i){super(),this.super_Entity(e,t),this.context=i,this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t)}},QQ={RED:0,GREEN:1},J_="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",PRe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;uniform vec4 kernel64[32];varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 CoCNearFar=texture2D(cocBuffer,vUv).rg;float CoC=CoCNearFar.r*scale;
#else
float CoC=texture2D(cocBuffer,vUv).g*scale;
#endif
if(CoC==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(CoC,CoCNearFar.g*scale);
#else
vec2 step=texelSize*CoC;
#endif
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;}}`,iE=class extends Zi{constructor(e=!1,t=!1){super({name:"BokehMaterial",defines:{PASS:e?"2":"1"},uniforms:{kernel64:new ut(null),kernel16:new ut(null),inputBuffer:new ut(null),cocBuffer:new ut(null),texelSize:new ut(new Pe),scale:new ut(1)},blending:ns,depthWrite:!1,depthTest:!1,fragmentShader:PRe,vertexShader:J_}),this.toneMapped=!1,t&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set cocBuffer(e){this.uniforms.cocBuffer.value=e}setCoCBuffer(e){this.uniforms.cocBuffer.value=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(e){return this.uniforms.scale.value=e}setScale(e){this.uniforms.scale.value=e}generateKernel(){let e=2.39996323,t=new Float32Array(128),i=new Float32Array(32),r=0,n=0;for(let o=0;o<80;++o){let l=o*e,u=Math.sqrt(o)/Math.sqrt(80),c=u*Math.cos(l),h=u*Math.sin(l);o%5===0?(i[n++]=c,i[n++]=h):(t[r++]=c,t[r++]=h)}let s=[],a=[];for(let o=0;o<128;)s.push(new bi(t[o++],t[o++],t[o++],t[o++]));for(let o=0;o<32;)a.push(new bi(i[o++],i[o++],i[o++],i[o++]));this.uniforms.kernel64.value=s,this.uniforms.kernel16.value=a}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}};function cH(e,t,i){return e*(t-i)-t}function nO(e,t,i){return Math.min(Math.max((e+t)/(t-i),0),1)}var DRe=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,RRe=class extends Zi{constructor(e){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new ut(null),focusDistance:new ut(0),focusRange:new ut(0),cameraNear:new ut(.3),cameraFar:new ut(1e3)},blending:ns,depthWrite:!1,depthTest:!1,fragmentShader:DRe,vertexShader:J_}),this.toneMapped=!1,this.uniforms.focalLength=this.uniforms.focusRange,this.adoptCameraSettings(e)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=jd){this.depthBuffer=e,this.depthPacking=t}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(e){this.uniforms.focusDistance.value=e}get worldFocusDistance(){return-cH(this.focusDistance,this.near,this.far)}set worldFocusDistance(e){this.focusDistance=nO(-e,this.near,this.far)}getFocusDistance(e){this.uniforms.focusDistance.value=e}setFocusDistance(e){this.uniforms.focusDistance.value=e}get focalLength(){return this.focusRange}set focalLength(e){this.focusRange=e}get focusRange(){return this.uniforms.focusRange.value}set focusRange(e){this.uniforms.focusRange.value=e}get worldFocusRange(){return-cH(this.focusRange,this.near,this.far)}set worldFocusRange(e){this.focusRange=nO(-e,this.near,this.far)}getFocalLength(e){return this.focusRange}setFocalLength(e){this.focusRange=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof La?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},IRe=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <encodings_fragment>
#include <dithering_fragment>
}`,LRe="uniform vec2 texelSize;uniform vec2 halfTexelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize*vec2(kernel)+halfTexelSize)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",hH=class extends Zi{constructor(e=new Pe){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new ut(null),texelSize:new ut(new Pe),halfTexelSize:new ut(new Pe),kernel:new ut(0),scale:new ut(1)},blending:ns,depthWrite:!1,depthTest:!1,fragmentShader:IRe,vertexShader:LRe}),this.toneMapped=!1,this.setTexelSize(e.x,e.y)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.halfTexelSize.value.copy(i.texelSize.value).multiplyScalar(.5)}},ORe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <encodings_fragment>
}`,zRe=class extends Zi{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new ut(null),opacity:new ut(1)},blending:ns,depthWrite:!1,depthTest:!1,fragmentShader:ORe,vertexShader:J_}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},kRe=`varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
#if EDGE_DETECTION_MODE == 1
#include <common>
#endif
#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}
#elif PREDICATION_MODE == 2
uniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}
#endif
#if PREDICATION_MODE != 0
vec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}
#endif
#if EDGE_DETECTION_MODE != 0
uniform sampler2D inputBuffer;
#endif
void main(){
#if EDGE_DETECTION_MODE == 0
const vec2 threshold=vec2(DEPTH_THRESHOLD);
#elif PREDICATION_MODE != 0
vec2 threshold=calculatePredicatedThreshold();
#else
const vec2 threshold=vec2(EDGE_THRESHOLD);
#endif
#if EDGE_DETECTION_MODE == 0
vec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 1
float l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 2
vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#endif
}`,BRe=`uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);
#if EDGE_DETECTION_MODE != 0
vUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,hT={COLOR:2},NRe={DISABLED:0},FRe=class extends Zi{constructor(e=new Pe,t=hT.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:Ox.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new ut(null),depthBuffer:new ut(null),predicationBuffer:new ut(null),texelSize:new ut(e)},blending:ns,depthWrite:!1,depthTest:!1,fragmentShader:kRe,vertexShader:BRe}),this.toneMapped=!1,this.edgeDetectionMode=t}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=jd){this.depthBuffer=e,this.depthPacking=t}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(e){this.defines.EDGE_DETECTION_MODE=e.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(e){this.edgeDetectionMode=e}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(e){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=e.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(e){this.localContrastAdaptationFactor=e}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(e){this.defines.EDGE_THRESHOLD=e.toFixed("6"),this.defines.DEPTH_THRESHOLD=(e*.1).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(e){this.edgeDetectionThreshold=e}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(e){this.defines.PREDICATION_MODE=e.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(e){this.predicationMode=e}set predicationBuffer(e){this.uniforms.predicationBuffer.value=e}setPredicationBuffer(e){this.uniforms.predicationBuffer.value=e}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(e){this.defines.PREDICATION_THRESHOLD=e.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(e){this.predicationThreshold=e}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(e){this.defines.PREDICATION_SCALE=e.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(e){this.predicationScale=e}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(e){this.defines.PREDICATION_STRENGTH=e.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(e){this.predicationStrength=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},URe=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}FRAGMENT_HEADvoid main(){FRAGMENT_MAIN_UVvec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGEgl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <encodings_fragment>
#endif
#include <dithering_fragment>
}`,VRe="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEADvoid main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORTgl_Position=vec4(position.xy,1.0,1.0);}",Mu={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},sO=class extends Zi{constructor(e,t,i,r,n=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:Ox.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new ut(null),depthBuffer:new ut(null),resolution:new ut(new Pe),texelSize:new ut(new Pe),cameraNear:new ut(.3),cameraFar:new ut(1e3),aspect:new ut(1),time:new ut(0)},blending:ns,depthWrite:!1,depthTest:!1,dithering:n}),this.toneMapped=!1,e&&this.setShaderParts(e),t&&this.setDefines(t),i&&this.setUniforms(i),this.adoptCameraSettings(r)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=jd){this.depthBuffer=e,this.depthPacking=t}setShaderParts(e){return this.fragmentShader=URe.replace(Mu.FRAGMENT_HEAD,e.get(Mu.FRAGMENT_HEAD)).replace(Mu.FRAGMENT_MAIN_UV,e.get(Mu.FRAGMENT_MAIN_UV)).replace(Mu.FRAGMENT_MAIN_IMAGE,e.get(Mu.FRAGMENT_MAIN_IMAGE)),this.vertexShader=VRe.replace(Mu.VERTEX_HEAD,e.get(Mu.VERTEX_HEAD)).replace(Mu.VERTEX_MAIN_SUPPORT,e.get(Mu.VERTEX_MAIN_SUPPORT)),this.needsUpdate=!0,this}setDefines(e){for(let t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(let t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(let t of e)this.extensions[t]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof La?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){let i=this.uniforms;i.resolution.value.set(e,t),i.texelSize.value.set(1/e,1/t),i.aspect.value=e/t}static get Section(){return Mu}},jRe=`#include <common>
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*l,l);
#else
gl_FragColor=vec4(l);
#endif
}`,HRe=class extends Zi{constructor(e=!1,t=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:Ox.replace(/\D+/g,"")},uniforms:{inputBuffer:new ut(null),threshold:new ut(0),smoothing:new ut(1),range:new ut(null)},blending:ns,depthWrite:!1,depthTest:!1,fragmentShader:jRe,vertexShader:J_}),this.toneMapped=!1,this.colorOutput=e,this.luminanceRange=t}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get threshold(){return this.uniforms.threshold.value}set threshold(e){this.smoothing>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=e}getThreshold(){return this.threshold}setThreshold(e){this.threshold=e}get smoothing(){return this.uniforms.smoothing.value}set smoothing(e){this.threshold>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=e}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(e){this.smoothing=e}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(e){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(e){e?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(e){return this.colorOutput}setColorOutputEnabled(e){this.colorOutput=e}get useRange(){return this.luminanceRange!==null}set useRange(e){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(e){e!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=e,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(e){this.luminanceRange=e}},WRe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,KQ={DISCARD:0,MULTIPLY:1},GRe=class extends Zi{constructor(e=null){super({name:"MaskMaterial",uniforms:{maskTexture:new ut(e),inputBuffer:new ut(null),strength:new ut(1)},blending:ns,depthWrite:!1,depthTest:!1,fragmentShader:WRe,vertexShader:J_}),this.toneMapped=!1,this.setColorChannel(QQ.RED),this.setMaskFunction(KQ.DISCARD)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set maskTexture(e){this.uniforms.maskTexture.value=e,delete this.defines.MASK_PRECISION_HIGH,e.type!==Ua&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(e){this.maskTexture=e}set colorChannel(e){this.defines.COLOR_CHANNEL=e.toFixed(0),this.needsUpdate=!0}setColorChannel(e){this.colorChannel=e}set maskFunction(e){this.defines.MASK_FUNCTION=e.toFixed(0),this.needsUpdate=!0}setMaskFunction(e){this.maskFunction=e}get inverted(){return this.defines.INVERTED!==void 0}set inverted(e){this.inverted&&!e?delete this.defines.INVERTED:e&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(e){this.inverted=e}get strength(){return this.uniforms.strength.value}set strength(e){this.uniforms.strength.value=e}getStrength(){return this.strength}setStrength(e){this.strength=e}},qRe=`#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)
#if __VERSION__ < 300
#define round(v) floor(v + 0.5)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);
#endif
}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);
#endif
}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){
#if !defined(DISABLE_DIAG_DETECTION)
weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){
#endif
vec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);
#if !defined(DISABLE_DIAG_DETECTION)
}else{e.r=0.0;}
#endif
}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}`,XRe="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",YRe=class extends Zi{constructor(e=new Pe,t=new Pe){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new ut(null),searchTexture:new ut(null),areaTexture:new ut(null),resolution:new ut(t),texelSize:new ut(e)},blending:ns,depthWrite:!1,depthTest:!1,fragmentShader:qRe,vertexShader:XRe}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(e){this.uniforms.searchTexture.value=e}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(e){this.uniforms.areaTexture.value=e}setLookupTextures(e,t){this.searchTexture=e,this.areaTexture=t}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(e){let t=Math.min(Math.max(e,0),112);this.defines.MAX_SEARCH_STEPS_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(e){this.orthogonalSearchSteps=e}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(e){let t=Math.min(Math.max(e,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(e){this.diagonalSearchSteps=e}get diagonalDetection(){return this.defines.DISABLE_DIAG_DETECTION===void 0}set diagonalDetection(e){e?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(e){this.diagonalDetection=e}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(e){let t=Math.min(Math.max(e,0),100);this.defines.CORNER_ROUNDING=t.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(t/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(e){this.cornerRounding=e}get cornerDetection(){return this.defines.DISABLE_CORNER_DETECTION===void 0}set cornerDetection(e){e?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(e){this.cornerDetection=e}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.resolution.value.set(e,t)}},QRe=new Wp,Hf=null;function KRe(){if(Hf===null){let e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]);Hf=new Kt,Hf.setAttribute!==void 0?(Hf.setAttribute("position",new hi(e,3)),Hf.setAttribute("uv",new hi(t,2))):(Hf.addAttribute("position",new hi(e,3)),Hf.addAttribute("uv",new hi(t,2)))}return Hf}var fo=class{constructor(e="Pass",t=new Ho,i=QRe){this.name=e,this.renderer=null,this.scene=t,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){let t=this.getFullscreenMaterial();t!==null&&(t.needsUpdate=!0),this.rtt=!e}}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new zr(KRe(),e),t.frustumCulled=!1,this.scene===null&&(this.scene=new Ho),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=jd){}render(e,t,i,r,n){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(t!==null&&typeof t=="object"&&typeof t.dispose=="function"){if(t instanceof Ho||t===this.renderer)continue;this[e].dispose()}}}},aO=class extends fo{constructor(e,t=!0){super("CopyPass"),this.fullscreenMaterial=new zRe,this.needsSwap=!1,this.renderTarget=e,e===void 0&&(this.renderTarget=new Ki(1,1,{minFilter:Li,magFilter:Li,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,i,r,n){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,t,i){i!==void 0&&(this.renderTarget.texture.type=i,i!==Ua?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":e.outputEncoding===Ri&&(this.renderTarget.texture.encoding=Ri))}},ZRe=class extends fo{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,i,r,n){let s=e.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},OD=new li,_B=class extends fo{constructor(e=!0,t=!0,i=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=i,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,i){this.color=e,this.depth=t,this.stencil=i}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,i,r,n){let s=this.overrideClearColor,a=this.overrideClearAlpha,o=e.getClearAlpha(),l=s!==null,u=a>=0;l?(OD.copy(e.getClearColor(OD)),e.setClearColor(s,u?a:o)):u&&e.setClearAlpha(a),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),l?e.setClearColor(OD,o):u&&e.setClearAlpha(o)}},Wf=-1,Uo=class extends Ys{constructor(e,t=Wf,i=Wf,r=1){super(),this.resizable=e,this.base=new Pe(1,1),this.preferred=new Pe(t,i),this.target=this.preferred,this.s=r}get width(){let{base:e,preferred:t,scale:i}=this,r;return t.width!==Wf?r=t.width:t.height!==Wf?r=Math.round(t.height*(e.width/Math.max(e.height,1))):r=Math.round(e.width*i),r}set width(e){this.preferredWidth=e}get height(){let{base:e,preferred:t,scale:i}=this,r;return t.height!==Wf?r=t.height:t.width!==Wf?r=Math.round(t.width/Math.max(e.width/Math.max(e.height,1),1)):r=Math.round(e.height*i),r}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferred.setScalar(Wf),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.base.width}set baseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseWidth(){return this.base.width}setBaseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get baseHeight(){return this.base.height}set baseHeight(e){this.base.height!==e&&(this.base.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){(this.base.width!==e||this.base.height!==t)&&(this.base.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get preferredWidth(){return this.preferred.width}set preferredWidth(e){this.preferred.width!==e&&(this.preferred.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferred.height}set preferredHeight(e){this.preferred.height!==e&&(this.preferred.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){(this.preferred.width!==e||this.preferred.height!==t)&&(this.preferred.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}copy(e){this.base.set(e.getBaseWidth(),e.getBaseHeight()),this.preferred.set(e.getPreferredWidth(),e.getPreferredHeight()),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height)}static get AUTO_SIZE(){return Wf}},zD=!1,dH=class{constructor(e=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=t=>{if(t.isMesh){let i;if(t.material.flatShading)switch(t.material.side){case Ba:i=this.materialsFlatShadedDoubleSide;break;case Hs:i=this.materialsFlatShadedBackSide;break;default:i=this.materialsFlatShaded;break}else switch(t.material.side){case Ba:i=this.materialsDoubleSide;break;case Hs:i=this.materialsBackSide;break;default:i=this.materials;break}this.originalMaterials.set(t,t.material),t.isSkinnedMesh?t.material=i[2]:t.isInstancedMesh?t.material=i[1]:t.material=i[0],++this.meshCount}}}setMaterial(e){if(this.disposeMaterials(),this.material=e,e!==null){let t=this.materials=[e.clone(),e.clone(),e.clone()];for(let i of t)i.uniforms=Object.assign({},e.uniforms),i.side=ju;t[2].skinning=!0,this.materialsBackSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.side=Hs,r}),this.materialsDoubleSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.side=Ba,r}),this.materialsFlatShaded=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r}),this.materialsFlatShadedBackSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r.side=Hs,r}),this.materialsFlatShadedDoubleSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r.side=Ba,r})}}render(e,t,i){let r=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,zD){let n=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,i);for(let s of n)s[0].material=s[1];this.meshCount!==n.size&&n.clear()}else{let n=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,i),t.overrideMaterial=n}e.shadowMap.enabled=r}disposeMaterials(){if(this.material!==null){let e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(let t of e)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return zD}static set workaroundEnabled(e){zD=e}},JRe=class extends fo{constructor(e,t,i=null){super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new _B,this.overrideMaterialManager=i===null?null:new dH(i),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){let e=this.overrideMaterialManager;return e!==null?e.material:null}set overrideMaterial(e){let t=this.overrideMaterialManager;e!==null?t!==null?t.setMaterial(e):this.overrideMaterialManager=new dH(e):t!==null&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,i,r,n){let s=this.scene,a=this.camera,o=this.selection,l=a.layers.mask,u=s.background,c=e.shadowMap.autoUpdate,h=this.renderToScreen?null:t;o!==null&&a.layers.set(o.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(h),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(e,s,a):e.render(s,a),a.layers.mask=l,s.background=u,e.shadowMap.autoUpdate=c}},fH=class extends fo{constructor(e,t,{resolutionScale:i=1,width:r=Uo.AUTO_SIZE,height:n=Uo.AUTO_SIZE,renderTarget:s}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new JRe(e,t,new pq({depthPacking:$7}));let a=this.renderPass;a.skipShadowMapUpdate=!0,a.ignoreBackground=!0;let o=a.getClearPass();o.overrideClearColor=new li(16777215),o.overrideClearAlpha=1,this.renderTarget=s,this.renderTarget===void 0&&(this.renderTarget=new Ki(1,1,{minFilter:Ni,magFilter:Ni,stencilBuffer:!1}),this.renderTarget.texture.name="DepthPass.Target");let l=this.resolution=new Uo(this,r,n,i);l.addEventListener("change",u=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,r,n){let s=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,s)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}},er={SKIP:0,ADD:1,ALPHA:2,AVERAGE:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,EXCLUSION:8,LIGHTEN:9,MULTIPLY:10,DIVIDE:11,NEGATION:12,NORMAL:13,OVERLAY:14,REFLECT:15,SCREEN:16,SOFT_LIGHT:17,SUBTRACT:18},$Re="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x+y,1.0)*opacity+x*(1.0-opacity);}",eIe="vec3 blend(const in vec3 x,const in vec3 y,const in float opacity){return y*opacity+x*(1.0-opacity);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){float a=min(y.a,opacity);return vec4(blend(x.rgb,y.rgb,a),max(x.a,a));}",tIe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y)*0.5*opacity+x*(1.0-opacity);}",iIe="float blend(const in float x,const in float y){return(y==0.0)?y:max(1.0-(1.0-x)/y,0.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",rIe="float blend(const in float x,const in float y){return(y==1.0)?y:min(x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",nIe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x,y)*opacity+x*(1.0-opacity);}",sIe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return abs(x-y)*opacity+x*(1.0-opacity);}",aIe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y-2.0*x*y)*opacity+x*(1.0-opacity);}",oIe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x,y)*opacity+x*(1.0-opacity);}",lIe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return x*y*opacity+x*(1.0-opacity);}",uIe="float blend(const in float x,const in float y){return(y>0.0)?min(x/y,1.0):1.0;}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",cIe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-abs(1.0-x-y))*opacity+x*(1.0-opacity);}",hIe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y*opacity+x*(1.0-opacity);}",dIe="float blend(const in float x,const in float y){return(x<0.5)?(2.0*x*y):(1.0-2.0*(1.0-x)*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",fIe="float blend(const in float x,const in float y){return(y==1.0)?y:min(x*x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",pIe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-(1.0-x)*(1.0-y))*opacity+x*(1.0-opacity);}",mIe="float blend(const in float x,const in float y){return(y<0.5)?(2.0*x*y+x*x*(1.0-2.0*y)):(sqrt(x)*(2.0*y-1.0)+2.0*x*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",gIe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x+y-1.0,0.0)*opacity+x*(1.0-opacity);}",vIe=new Map([[er.SKIP,null],[er.ADD,$Re],[er.ALPHA,eIe],[er.AVERAGE,tIe],[er.COLOR_BURN,iIe],[er.COLOR_DODGE,rIe],[er.DARKEN,nIe],[er.DIFFERENCE,sIe],[er.EXCLUSION,aIe],[er.LIGHTEN,oIe],[er.MULTIPLY,lIe],[er.DIVIDE,uIe],[er.NEGATION,cIe],[er.NORMAL,hIe],[er.OVERLAY,dIe],[er.REFLECT,fIe],[er.SCREEN,pIe],[er.SOFT_LIGHT,mIe],[er.SUBTRACT,gIe]]),yIe=class extends Ys{constructor(e,t=1){super(),this.f=e,this.opacity=new ut(t)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this.f}set blendFunction(e){this.f=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return vIe.get(this.blendFunction)}},qc={NONE:0,DEPTH:1,CONVOLUTION:2},sh=class extends Ys{constructor(e,t,{attributes:i=qc.NONE,blendFunction:r=er.SCREEN,defines:n=new Map,uniforms:s=new Map,extensions:a=null,vertexShader:o=null}={}){super(),this.name=e,this.renderer=null,this.attributes=i,this.fragmentShader=t,this.vertexShader=o,this.defines=n,this.uniforms=s,this.extensions=a,this.blendMode=new yIe(r),this.blendMode.addEventListener("change",l=>this.setChanged())}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,t=jd){}update(e,t,i){}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(t!==null&&typeof t=="object"&&typeof t.dispose=="function"){if(t instanceof Ho||t===this.renderer)continue;this[e].dispose()}}}};function pH(e,t,i){for(let r of t){let n="$1"+e+r.charAt(0).toUpperCase()+r.slice(1),s=new RegExp("([^\\.])(\\b"+r+"\\b)","g");for(let a of i.entries())a[1]!==null&&i.set(a[0],a[1].replace(s,n))}}function xIe(e,t,i,r,n,s,a){let o=new Map([["fragment",t.getFragmentShader()],["vertex",t.getVertexShader()]]),l=o.get("fragment")!==void 0&&/mainImage/.test(o.get("fragment")),u=o.get("fragment")!==void 0&&/mainUv/.test(o.get("fragment")),c=[],h=[],d=!1,p=!1;if(o.get("fragment")===void 0)console.error("Missing fragment shader",t);else if(u&&(a&qc.CONVOLUTION)!==0)console.error("Effects that transform UV coordinates are incompatible with convolution effects",t);else if(!l&&!u)console.error("The fragment shader contains neither a mainImage nor a mainUv function",t);else{let m=/(?:\w+\s+(\w+)\([\w\s,]*\)\s*{[^}]+})/g,v=sO.Section;if(u){let w=`	${e}MainUv(UV);
`;i.set(v.FRAGMENT_MAIN_UV,i.get(v.FRAGMENT_MAIN_UV)+w),d=!0}if(o.get("vertex")!==null&&/mainSupport/.test(o.get("vertex"))){let w=`	${e}MainSupport(`;w+=/mainSupport *\([\w\s]*?uv\s*?\)/.test(o.get("vertex"))?`vUv);
`:`);
`,i.set(v.VERTEX_MAIN_SUPPORT,i.get(v.VERTEX_MAIN_SUPPORT)+w),c=c.concat([...o.get("vertex").matchAll(/(?:varying\s+\w+\s+(\w*))/g)].map(S=>S[1])),h=h.concat(c).concat([...o.get("vertex").matchAll(m)].map(S=>S[1]))}h=h.concat([...o.get("fragment").matchAll(m)].map(w=>w[1])),h=h.concat([...t.defines.keys()].map(w=>w.replace(/\([\w\s,]*\)/g,""))),h=h.concat([...t.uniforms.keys()]),t.uniforms.forEach((w,S)=>s.set(e+S.charAt(0).toUpperCase()+S.slice(1),w)),t.defines.forEach((w,S)=>n.set(e+S.charAt(0).toUpperCase()+S.slice(1),w)),pH(e,h,n),pH(e,h,o);let g=t.blendMode;if(r.set(g.blendFunction,g),l){let w=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/,S=`${e}MainImage(color0, UV, `;(a&qc.DEPTH)!==0&&w.test(o.get("fragment"))&&(S+="depth, ",p=!0),S+=`color1);
	`;let _=e+"BlendOpacity";s.set(_,g.opacity),S+=`color0 = blend${g.blendFunction}(color0, color1, ${_});

	`,i.set(v.FRAGMENT_MAIN_IMAGE,i.get(v.FRAGMENT_MAIN_IMAGE)+S),S=`uniform float ${_};

`,i.set(v.FRAGMENT_HEAD,i.get(v.FRAGMENT_HEAD)+S)}i.set(v.FRAGMENT_HEAD,i.get(v.FRAGMENT_HEAD)+o.get("fragment")+`
`),o.get("vertex")!==null&&i.set(v.VERTEX_HEAD,i.get(v.VERTEX_HEAD)+o.get("vertex")+`
`)}return{varyings:c,transformedUv:d,readDepth:p}}var sC=class extends fo{constructor(e,...t){super("EffectPass"),this.fullscreenMaterial=new sO(null,null,null,e),this.effects=t.sort((i,r)=>r.attributes-i.attributes),this.skipRendering=!1,this.uniformCount=0,this.varyingCount=0,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){let t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}verifyResources(){let e=this.renderer.capabilities,t=Math.min(e.maxFragmentUniforms,e.maxVertexUniforms);this.uniformCount>t&&console.warn("The current rendering context doesn't support more than "+t+" uniforms, but "+this.uniformCount+" were defined"),t=e.maxVaryings,this.varyingCount>t&&console.warn("The current rendering context doesn't support more than "+t+" varyings, but "+this.varyingCount+" were defined")}updateMaterial(){let e=sO.Section,t=new Map([[e.FRAGMENT_HEAD,""],[e.FRAGMENT_MAIN_UV,""],[e.FRAGMENT_MAIN_IMAGE,""],[e.VERTEX_HEAD,""],[e.VERTEX_MAIN_SUPPORT,""]]),i=new Map,r=new Map,n=new Map,s=new Set,a=0,o=0,l=0,u=!1,c=!1;for(let d of this.effects)if(d.blendMode.blendFunction===er.SKIP)l|=d.getAttributes()&qc.DEPTH;else if((l&d.getAttributes()&qc.CONVOLUTION)!==0)console.error("Convolution effects cannot be merged",d);else{l|=d.getAttributes();let p="e"+a++,m=xIe(p,d,t,i,r,n,l);if(o+=m.varyings.length,u=u||m.transformedUv,c=c||m.readDepth,d.extensions!==null)for(let v of d.extensions)s.add(v)}let h=/\bblend\b/g;for(let d of i.values()){let p=d.getShaderCode().replace(h,`blend${d.blendFunction}`);t.set(e.FRAGMENT_HEAD,t.get(e.FRAGMENT_HEAD)+p+`
`)}(l&qc.DEPTH)!==0?(c&&t.set(e.FRAGMENT_MAIN_IMAGE,`float depth = readDepth(UV);

	`+t.get(e.FRAGMENT_MAIN_IMAGE)),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,u?(t.set(e.FRAGMENT_MAIN_UV,`vec2 transformedUv = vUv;
`+t.get(e.FRAGMENT_MAIN_UV)),r.set("UV","transformedUv")):r.set("UV","vUv"),t.forEach((d,p,m)=>m.set(p,d.trim().replace(/^#/,`
#`))),this.uniformCount=n.size,this.varyingCount=o,this.skipRendering=a===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderParts(t).setExtensions(s).setUniforms(n).setDefines(r)}recompile(){this.updateMaterial(),this.verifyResources()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e,t=jd){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;for(let i of this.effects)i.setDepthTexture(e,t)}render(e,t,i,r,n){for(let s of this.effects)s.update(e,t,r);if(!this.skipRendering||this.renderToScreen){let s=this.fullscreenMaterial;s.inputBuffer=t.texture,s.time+=r,e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(let i of this.effects)i.setSize(e,t)}initialize(e,t,i){this.renderer=e;for(let r of this.effects)r.initialize(e,t,i),r.addEventListener("change",n=>this.handleEvent(n));this.updateMaterial(),this.verifyResources(),i!==void 0&&i!==Ua&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(let e of this.effects)e.dispose()}handleEvent(e){switch(e.type){case"change":this.recompile();break}}},wIe=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],SB=class extends fo{constructor({resolutionScale:e=.5,width:t=Uo.AUTO_SIZE,height:i=Uo.AUTO_SIZE,kernelSize:r=dT.LARGE}={}){super("KawaseBlurPass"),this.renderTargetA=new Ki(1,1,{minFilter:Li,magFilter:Li,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";let n=this.resolution=new Uo(this,t,i,e);n.addEventListener("change",s=>this.setSize(n.baseWidth,n.baseHeight)),this.blurMaterial=new hH,this.ditheredBlurMaterial=new hH,this.ditheredBlurMaterial.uniforms.scale=this.blurMaterial.uniforms.scale,this.ditheredBlurMaterial.dithering=!0,this.dithering=!1,this.kernelSize=r}getResolution(){return this.resolution}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,r,n){let s=this.scene,a=this.camera,o=this.renderTargetA,l=this.renderTargetB,u=wIe[this.kernelSize],c=this.blurMaterial,h=t,d,p;for(this.fullscreenMaterial=c,d=0,p=u.length-1;d<p;++d){let m=(d&1)===0?o:l;c.kernel=u[d],c.inputBuffer=h.texture,e.setRenderTarget(m),e.render(s,a),h=m}this.dithering&&(c=this.ditheredBlurMaterial,this.fullscreenMaterial=c),c.kernel=u[d],c.inputBuffer=h.texture,e.setRenderTarget(this.renderToScreen?null:i),e.render(s,a)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let r=i.width,n=i.height;this.renderTargetA.setSize(r,n),this.renderTargetB.setSize(r,n),this.blurMaterial.setSize(r,n),this.ditheredBlurMaterial.setSize(r,n)}initialize(e,t,i){i!==void 0&&(this.renderTargetA.texture.type=i,this.renderTargetB.texture.type=i,i!==Ua?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.ditheredBlurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):e.outputEncoding===Ri&&(this.renderTargetA.texture.encoding=Ri,this.renderTargetB.texture.encoding=Ri))}static get AUTO_SIZE(){return Uo.AUTO_SIZE}},bIe=class extends fo{constructor({width:e=Uo.AUTO_SIZE,height:t=Uo.AUTO_SIZE,renderTarget:i,luminanceRange:r,colorOutput:n}={}){super("LuminancePass"),this.fullscreenMaterial=new HRe(n,r),this.needsSwap=!1,this.renderTarget=i,this.renderTarget===void 0&&(this.renderTarget=new Ki(1,1,{minFilter:Li,magFilter:Li,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target",this.renderTarget.texture.generateMipmaps=!1);let s=this.resolution=new Uo(this,e,t);s.addEventListener("change",a=>this.setSize(s.baseWidth,s.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(e,t,i,r,n){let s=this.fullscreenMaterial;s.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}initialize(e,t,i){i!==void 0&&i!==Ua&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},_Ie=class extends fo{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new _B(!1,!1,!0),this.inverse=!1}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,i,r,n){let s=e.getContext(),a=e.state.buffers,o=this.scene,l=this.camera,u=this.clearPass,c=this.inverted?0:1,h=1-c;a.color.setMask(!1),a.depth.setMask(!1),a.color.setLocked(!0),a.depth.setLocked(!0),a.stencil.setTest(!0),a.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),a.stencil.setFunc(s.ALWAYS,c,4294967295),a.stencil.setClear(h),a.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?u.render(e,null):(u.render(e,t),u.render(e,i))),this.renderToScreen?(e.setRenderTarget(null),e.render(o,l)):(e.setRenderTarget(t),e.render(o,l),e.setRenderTarget(i),e.render(o,l)),a.color.setLocked(!1),a.depth.setLocked(!1),a.stencil.setLocked(!1),a.stencil.setFunc(s.EQUAL,1,4294967295),a.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),a.stencil.setLocked(!0)}},Ul=class extends fo{constructor(e,t="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=e,this.inputBufferUniform=null,this.setInput(t)}setInput(e){if(this.inputBufferUniform=null,this.fullscreenMaterial!==null){let t=this.fullscreenMaterial.uniforms;t!==void 0&&t[e]!==void 0&&(this.inputBufferUniform=t[e])}}render(e,t,i,r,n){this.inputBufferUniform!==null&&t!==null&&(this.inputBufferUniform.value=t.texture),e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}initialize(e,t,i){i!==void 0&&i!==Ua&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},kD=1/1e3,SIe=1e3,MIe=class{constructor(){this.previousTime=0,this.currentTime=0,this.delta=0,this.fixedDelta=1e3/60,this.elapsed=0,this.timescale=1,this.fixedDeltaEnabled=!1,this.autoReset=!1}setFixedDeltaEnabled(e){return this.fixedDeltaEnabled=e,this}isAutoResetEnabled(e){return this.autoReset}setAutoResetEnabled(e){return typeof document<"u"&&document.hidden!==void 0&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this.autoReset=e),this}getDelta(){return this.delta*kD}getFixedDelta(){return this.fixedDelta*kD}setFixedDelta(e){return this.fixedDelta=e*SIe,this}getElapsed(){return this.elapsed*kD}getTimescale(){return this.timescale}setTimescale(e){return this.timescale=e,this}update(e){return this.fixedDeltaEnabled?this.delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=e!==void 0?e:performance.now(),this.delta=this.currentTime-this.previousTime),this.delta*=this.timescale,this.elapsed+=this.delta,this}reset(){return this.delta=0,this.elapsed=0,this.currentTime=performance.now(),this}handleEvent(e){document.hidden||(this.currentTime=performance.now())}dispose(){this.setAutoResetEnabled(!1)}},dT={MEDIUM:2,LARGE:3,HUGE:5},AIe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=clamp(texture2D(map,uv)*intensity,0.0,1.0);}`,EIe=class extends sh{constructor({blendFunction:e=er.SCREEN,luminanceThreshold:t=.9,luminanceSmoothing:i=.025,resolutionScale:r=.5,intensity:n=1,width:s=Uo.AUTO_SIZE,height:a=Uo.AUTO_SIZE,kernelSize:o=dT.LARGE}={}){super("BloomEffect",AIe,{blendFunction:e,uniforms:new Map([["map",new ut(null)],["intensity",new ut(n)]])}),this.renderTarget=new Ki(1,1,{minFilter:Li,magFilter:Li,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.renderTarget.texture.generateMipmaps=!1,this.uniforms.get("map").value=this.renderTarget.texture,this.luminancePass=new bIe({renderTarget:this.renderTarget,colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothingFactor=i,this.blurPass=new SB({resolutionScale:r,width:s,height:a,kernelSize:o});let l=this.blurPass.getResolution();l.addEventListener("change",u=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(e){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(e){this.uniforms.get("intensity").value=e}getIntensity(){return this.intensity}setIntensity(e){this.intensity=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}update(e,t,i){let r=this.renderTarget;this.luminancePass.enabled?(this.luminancePass.render(e,t,r),this.blurPass.render(e,r,r)):this.blurPass.render(e,t,r)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height),this.luminancePass.resolution.copy(i)}initialize(e,t,i){this.blurPass.initialize(e,t,i),i!==void 0&&(this.renderTarget.texture.type=i,e.outputEncoding===Ri&&(this.renderTarget.texture.encoding=Ri))}},CIe="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(min(color+vec3(0.5),1.0),inputColor.a);}",TIe=class extends sh{constructor({blendFunction:e=er.NORMAL,brightness:t=0,contrast:i=0}={}){super("BrightnessContrastEffect",CIe,{blendFunction:e,uniforms:new Map([["brightness",new ut(t)],["contrast",new ut(i)]])})}get brightness(){return this.uniforms.get("brightness").value}set brightness(e){this.uniforms.get("brightness").value=e}getBrightness(e){return this.brightness}setBrightness(e){this.brightness=e}get contrast(){return this.uniforms.get("contrast").value}set contrast(e){this.uniforms.get("contrast").value=e}getContrast(e){return this.contrast}setContrast(e){this.contrast=e}},PIe="void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(vec3(average(inputColor.rgb)),inputColor.a);}",DIe=class extends sh{constructor(e=er.NORMAL){super("ColorAverageEffect",PIe,{blendFunction:e})}},RIe="varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=texture2D(inputBuffer,vUvR).ra;vec2 ba=texture2D(inputBuffer,vUvB).ba;outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}",IIe="uniform vec2 offset;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vUvR=uv+shift;vUvB=uv-shift;}",LIe=class extends sh{constructor({blendFunction:e=er.NORMAL,offset:t=new Pe(.001,5e-4)}={}){super("ChromaticAberrationEffect",RIe,{vertexShader:IIe,blendFunction:e,attributes:qc.CONVOLUTION,uniforms:new Map([["offset",new ut(t)]])})}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}},OIe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);float CoCNear=texture2D(nearCoCBuffer,uv).r;CoCNear=min(CoCNear*scale,1.0);vec4 result=inputColor*(1.0-colorFar.a)+colorFar;result=mix(result,colorNear,CoCNear);outputColor=result;}`,zIe=class extends sh{constructor(e,{blendFunction:t=er.NORMAL,worldFocusDistance:i,worldFocusRange:r,focusDistance:n=0,focalLength:s=.1,focusRange:a=s,bokehScale:o=1,width:l=Uo.AUTO_SIZE,height:u=Uo.AUTO_SIZE}={}){super("DepthOfFieldEffect",OIe,{blendFunction:t,attributes:qc.DEPTH,uniforms:new Map([["nearColorBuffer",new ut(null)],["farColorBuffer",new ut(null)],["nearCoCBuffer",new ut(null)],["scale",new ut(1)]])}),this.camera=e,this.renderTarget=new Ki(1,1,{minFilter:Li,magFilter:Li,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTarget.texture.generateMipmaps=!1,this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new Ul(new RRe(e));let c=this.cocMaterial;c.focusDistance=n,c.focusRange=a,i!==void 0&&(c.worldFocusDistance=i),r!==void 0&&(c.worldFocusRange=r),this.blurPass=new SB({kernelSize:dT.MEDIUM,width:l,height:u});let h=this.blurPass.getResolution();h.addEventListener("change",p=>this.setSize(h.getBaseWidth(),h.getBaseHeight())),this.maskPass=new Ul(new GRe(this.renderTargetCoC.texture));let d=this.maskPass.fullscreenMaterial;d.maskFunction=KQ.MULTIPLY,d.colorChannel=QQ.GREEN,this.bokehNearBasePass=new Ul(new iE(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new Ul(new iE(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new Ul(new iE(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new Ul(new iE(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null,this.bokehScale=o}get cocTexture(){return this.renderTargetCoC.texture}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.circleOfConfusionMaterial}getBlurPass(){return this.blurPass}get resolution(){return this.blurPass.getResolution()}getResolution(){return this.blurPass.getResolution()}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(e){let t=[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];for(let i of t)i.fullscreenMaterial.setScale(e);this.maskPass.fullscreenMaterial.setStrength(e),this.uniforms.get("scale").value=e}getBokehScale(){return this.bokehScale}setBokehScale(e){this.bokehScale=e}getTarget(){return this.target}setTarget(e){this.target=e}calculateFocusDistance(e){let t=this.camera,i=t.position.distanceTo(e);return nO(-i,t.near,t.far)}setDepthTexture(e,t=jd){this.circleOfConfusionMaterial.depthBuffer=e,this.circleOfConfusionMaterial.depthPacking=t}update(e,t,i){let r=this.renderTarget,n=this.renderTargetCoC,s=this.renderTargetCoCBlurred,a=this.renderTargetMasked;if(this.target!==null){let o=this.calculateFocusDistance(this.target);this.circleOfConfusionMaterial.focusDistance=o}this.cocPass.render(e,null,n),this.blurPass.render(e,n,s),this.maskPass.render(e,t,a),this.bokehFarBasePass.render(e,a,r),this.bokehFarFillPass.render(e,r,this.renderTargetFar),this.bokehNearBasePass.render(e,t,r),this.bokehNearFillPass.render(e,r,this.renderTargetNear)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let r=i.width,n=i.height,s=[this.cocPass,this.blurPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];s.push(this.renderTargetCoC,this.renderTargetMasked),s.forEach(a=>a.setSize(e,t)),s=[this.renderTarget,this.renderTargetNear,this.renderTargetFar,this.renderTargetCoCBlurred],s.forEach(a=>a.setSize(r,n)),[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(a=>a.fullscreenMaterial.setSize(r,n))}initialize(e,t,i){[this.cocPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(r=>r.initialize(e,t,i)),this.blurPass.initialize(e,t,Ua),i!==void 0&&(this.renderTarget.texture.type=i,this.renderTargetNear.texture.type=i,this.renderTargetFar.texture.type=i,this.renderTargetMasked.texture.type=i,e.outputEncoding===Ri&&(this.renderTarget.texture.encoding=Ri,this.renderTargetNear.texture.encoding=Ri,this.renderTargetFar.texture.encoding=Ri,this.renderTargetMasked.texture.encoding=Ri))}};new H;new yt;var kIe="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",BIe=class extends sh{constructor({blendFunction:e=er.NORMAL,hue:t=0,saturation:i=0}={}){super("HueSaturationEffect",kIe,{blendFunction:e,uniforms:new Map([["hue",new ut(new H)],["saturation",new ut(i)]])}),this.hue=t}get saturation(){return this.uniforms.get("saturation").value}set saturation(e){this.uniforms.get("saturation").value=e}getSaturation(){return this.saturation}setSaturation(e){this.saturation=e}get hue(){let e=this.uniforms.get("hue").value;return Math.acos((e.x*3-1)/2)}set hue(e){let t=Math.sin(e),i=Math.cos(e);this.uniforms.get("hue").value.set((2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3)}getHue(){return this.hue}setHue(e){this.hue=e}};new li;var NIe=`void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*time));
#ifdef PREMULTIPLY
outputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);
#else
outputColor=vec4(noise,inputColor.a);
#endif
}`,FIe=class extends sh{constructor({blendFunction:e=er.SCREEN,premultiply:t=!1}={}){super("NoiseEffect",NIe,{blendFunction:e}),this.premultiply=t}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(e){this.premultiply!==e&&(e?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(e){this.premultiply=e}},UIe="uniform bool active;uniform vec2 d;void mainUv(inout vec2 uv){if(active){uv=vec2(d.x*(floor(uv.x/d.x)+0.5),d.y*(floor(uv.y/d.y)+0.5));}}",VIe=class extends sh{constructor(e=30){super("PixelationEffect",UIe,{uniforms:new Map([["active",new ut(!1)],["d",new ut(new Pe)]])}),this.resolution=new Pe,this.d=0,this.granularity=e}get granularity(){return this.d}set granularity(e){let t=Math.floor(e);t%2>0&&(t+=1),this.d=t,this.uniforms.get("active").value=t>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(e){this.granularity=e}setSize(e,t){this.resolution.set(e,t),this.uniforms.get("d").value.setScalar(this.d).divide(this.resolution)}};new H;new H;var mH="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",gH="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAYAAAABNmBHAAAgAElEQVR4Xuy9CbhlV1ktOvbpq09DkiIkUBI6kxASIH0DlAQiIK1wRfSJTx+i4JX7vKIigs8HXpXvqVcvrcC9agQ7IDTSSWgqCQQliDRBJKkkhDSkqVPNqVOnP+8b//rH3P+eZ+199tlznVTlvVrft7+1T7OaueZY42/m37QALKNk2wHg1pITlB17mC+Pp11W3X/LHyT32vhg48/5SOv+PnwpsHA70JoGlueB1iKApeqzvOzn44GatTB76Xzhd7suBR7+WWADgDEAwwCG/L54b/poDLrHuvvm70Z2Avhsc+PVcxscBU8F8C8ADg5+ipIjD/PlGwfgju8B924E5seARUfLsiNmqQW0IjL8+7L2NYD/7COBzfcCm+aB8SVgdAkYIRCXKyDax4EdAanL5PuNPllNvXDlAHwFgP8AcC2AhRIoDXbsYb48dl5WkVFTE3LGDcC9m4CZCWBuFFgeAZaGAYJQQCRqDHT+McJrVb8zwATUXH02MHYfMHEIGFsAxgjApQqACYQORjtd/B7Axt/z79sC0+cMPgjjlwPwVwHcA+DfAHzTxcVgWBroqMN8+cYBeM71wH0TwKExYHYUWCIAHYRLTlkCYgcIBcAgU/n3qy8GRu4HRgnAOWBkERhddPAJhGJDBxkvw7cqimr+zFM/ZLnZF64cgL8BYD+AWwB8x/dlWuWagHiYL984AJ/0RWBy1AE4AizyM1yxYAcTigW55xMbAkxEiwEdkJ/ZCQxPAiOHgBECcKEC4TBZcKkSv+mTieNcNPNC26mLNsj45QD8LQDTAO4GcJt/7iw2bfoG4WG+vAGwm9ExiEg69zpg/wgwPQLMjgALzn4E4aIzoJjQ9g4024uygkj+pyuAoX0VAIfngOH5NgCHMhAm8Sv2y3XDZeBhNIp8OzJE8OsBzAKYBHAXgDt8/4O+MVT0j4f58o0D8Pxrgf3DwMwIMEPQEYRkNwfgsuuDZLskip0No0gWMD/9HGDoADAkAC4Aw/wsAgZAgs2Z0ABI0GU6IVmKv+f28KDnHxkA/G0A8y6G73N9kOCjXnh/Ebb6OvgwX75xAF5wLTA1VIHPADgMLDj4yIA5AAm6aCUnv4oz46eeDwxNAUMzwJAz4BABSNDFTwSfg7DDKHE23MG5PqIY8A1u/dINs9dBdy8AgnGPM2NfUBrsnw7z5RsH4IXXAAcJviFgluAbygBINnSLWOAjGxJ4pgOKDV0v/OSLKp8iGXBovhLBBOCQM2ACoTOhnYrAdItYbCij5JFzRyIAqRccAnDAQUjg6UNQ7hsMXP0cRQAexss3DsCLCECCLwCQzMcPwUi2MwAScAKbfnY/YRLFQ8DHX+IAJAMSfDkAF13kLvleIjhjQQHxUVS3jjgGpKeeNzYVQEjgUS8k+PghONdhIwAP4+XXBYCHKIJbwJyDTgaIAdCBJx3Q2M8tYAHP9m4df/ylQOsQ0JqtRLCx30K1wtLBggScQOgsKBGcWHAJeOwRC0BSM1mQIKRbhh+Bj98JQP6t4U0APEyXXxcAEnxkQAFwoVUxID9kvQg+c1C7vidRbIDkc24B//hTQGumDcCWA5DgMxASdNIFBUI5pCML8v8API5zfEQx4BudgqiczviSnJhQwCP4BMCGl+wO8+U7AJi/W4O4YS6+pmK/2ciADsAOBhTIIiAJnPB7AvNjP+0AnANaYkAHX2JBAc+tYaJXOqBZv24Vc386XW5dtkHGW+4HFAJonpOe+YYQZAShgKjv3PNvPQaxVoI8zJdfFwASfPzMUwS3Kt1v0UFIlos6oDFdAGFcliMAP/ryAEAGNwQRnDOgLbdlIEwrIs6AZ/QgkMMHQF6ZAKQcJAsSYPwIeAIk9wJgoPK1gi7+PwF4GC/fOAAvIQPSs0URTPBJ/Pp3GSEGRHfBCIQ0xowBtUbcAj7ys5X4Jfu1HIAGQrIgQRXEsAFQIORDFhiDY/rMHmrU4QUgR08AkgUjCAW6CD6CkwBsAIQC4GG6fPMA3OXiNzCg2I9gNCMksmAAoemDzoimFwL48M85AKkiuQVMAAp8CYRRDAt8GQiJ67N6GJODAXAHlsGguscA2AJg1IPGYmxOpBxFWkRN9LsATgIwXnNs/v/5z/9XCf8BO3YAtxbc/46/KDt+5+ea1Yku2VUxHz/z0v24FwMGK1gWsK2OUUxHHdCBeRUB6OxHABr4ZICIBd0QWSF+XRdMTAjgCdTrG9cBNwE4F8CpDkICyYLGsuhFt6zs+gISwUen8zEAjgMw4cfx2H6O/90yAFo84Cbg4ID3/9TfLTt+5+ebnRABkODjx0SwPi5ec/FrYpmqSAxM8Dn60CsqAFI6GfhqAMiDE/gokmvEr0C4PgDkBQm40wE8zMFEUDKEVoxIMLl/KS73mE7H9d+vcKHQQcjwW0Yu9nP8m8sAmOIBuWY6wP2/4s0ezjjg8TuvaR6ABJ70vxUApGrm7EbGE+i472BAB+WHfqHS/eoAaEwY2E9+wLSXTqhI7CXgnB6LCoOJ4BiST+hTnG0HcCwAglCx3ARoZEVFXnBPp/O/A/hXACc7CPs9/i1lAOyIB+RDX+P9/+pbQjjjAMfv/PL6AFDs1wFAgs/9fgKfgdE/ZEpuiQlbwAde6QAMBgiRmsSwA9BY0JfjovGRDBMH4TlcXGhcBOc6HkF0gjPhZgchxTLZMAci/04W/B6Ab3t09EPXcPyflgFwRTwgJ2MN9/8bf5qFM67x+B/aW4XQz42FeL0YrRyikztUFw0704mf9kXgxhOAqc3AAsPyRxxQCs/PdXOFY0W1KHy3QIUGtx+6vdnx1vsB+dsTncm2AogglFgVEAlUWrOMB2RyEmMCGQ/Y7/HvKns6tfGAnJQ+r/9b76oJZ1zD8WdyQjYBh8aBhVEHjELouQ8ukQ7VRSCJAALwkr+sALhnGzDD3JAJYJHg9uhoi4bx8ytkWUtvHT/7+Zc4dw1uZ3612fH2dkQf7yxIEEockwkJQn4IQoq8unhAhmPRKKFx0uv4K8ueTs94wD7u//VX9ghn7OP4c+4G7h8HpseB+dF2AKlFLwuAIZ8jD6NPrOhAffmfA9/ZBuzZCkyRWSeqBCWyoYGQ5yQrBpDbum/ME1HoPo0XEkSD2zlfbna8q6+EUJcTCxKEtHL5EQjP6BEPyIgYAZBvYt3xHyx7OqvGA65y/7/9wVXCGVc5/sl7qxD66dEqiYgRzAqhN1A4CBNAAlDyAFI+iZ9/N3DLJuC+jcDUBmCWyUnOrmTYCMIOkNclLg0B8/RsNLg9+UvNjnd1APLmmQpFHyEBROuWACQT8nN+H/GAvY7/VNnT6SsesMf13/CpahGnZzhjj+PPmwX2MYdDIfQexWyBAwEUOQDrRDN/98p3A7dvAO6fAA5sqHJDBEAyoUVGkwEd6HR12XU4kwzfl6fCXTZzjy57vvnR513X7Hj7AyDvggAUi9EyFgiZqNxPQF6345nOWbD1HQ/Y5fpvuLa/2+82/vNHgAPDFQDnhoF5j2C2qBWCI8bw1eRw5CL5l94L3DEOTI4DB8Y9OWmsEu/zBJ3rgsaybqBob/7A4C7jtWcooRrczr+u2fH2D0AOQgAUCxKEP7aGgLy64+m6KdjWFA9Yc/03/Osa4glrjr+AupqHz1sEs0cxG0BC9HIePLoit9eNkVf9L+DuUWByDJgaq4ybGYLPAWgiXmLedUE7dwC7saL7CqfPKXi4NYdaykCD410bAHlDEsNiwZ9wAPYbkJcfz6T2gm3N8YDZ9d/wHxUA+739fPwXPrSKYGb+BuP3jAFDElFH9HIWwbzCIGkBr/or4J4RYO8oMOW6ZVcAuvi1Cgoha04BCwT5gfMKHm7NoRde2+x41w5A3hQZkADk5+cGiAeMx3+/7AENFA8Yrv/G71cAXFM4Yzj+otOAaQLQA0gZxaIIZtMDFTigKJV8H9Iq6aZ59ZXAvSPAvpEKgBTtBODcSCWCZeRYtpzrmLyeGNCAyFl1v+Hei8qeb370Rdc2O97BAMi7EgB/2QG41nhAHU9LuWAbOB7Qr//GPRUA13r7Gv9FZwIMoVcEswEwfDoimEP0shKKtIphaZQAXv1+YM+wA3DEdcvRKkGJADQQEsQuhi1Tjt95vBsh5nx2IO59SsHDrTmUOStNjndwAAqEry0IyCMICkOyiuIBNwBvPFQQT7gBuPjc9oRYAIHyOEL4vIFEYVNaOou5vCGE/tV/A0wOVcnpzI47NOri3QFIBpSeaSDUdYLOSWvYImSGgftpJDa4MWJbAGxivGUA5MAOc0Be6eVLj7/4Mk+hzCOYPYpZDBiNkLh+G/M3yFyv/ltgL3W3YQfgcFUhgRY2PwY+Z7/EhAR1SFyXCOb57r28QfQBsJQBMn5D4y0HYLPje9Cd7RIC0PM3EiMofF4gVCBp1P840ix/gyz56r+vAMjk9Gl375iB4+CzveuZdLkkEPJ8ZEfX/6R73vOjzT5Si9hucLxHAVg4PwJgRwh9CKOXK8YA4ZEqKZXSQWh5P+5AftXfA/uGKvYjCKn72cctbFrZNECka5L5CPwIPtMH3TVz17MLB5gdLgA2Nd6jACycHwLQxFEUSR5ASvARDB0h9AQb9bXIgCGk6lUfAPYTgEPAITKgg1BObk58srTJgG58WMkWMaAbQQT1nc8rHGANAJsc71EAFs4PAagQestgC1lsBJ4BMCSOK6dDUcwqqaFiQr/0QeAAAdjy+jBiQQeeMSBZT3nCPUDIa9z+/MIB1gCwyfEeBWDh/BCAeQSzgkjFfGLBBD5nxQ4DxN0wv3hVxX5TBGDwL5obxvVA5YqYL5BeMLd66YYxJpRB0gK+96LCAdYAsMnxHgVg4fwIgMrhUPKQ2C+Bz0PmBTqBMQehAbDlIjj4F80KJguSVZ0FuXpjoCOgXawLjALhbT9eOMAuAGxqvEcBWDg/l1IE05Ed0ygZnyHdz0VwCqEPIfNyx0QQvvLDFQCp+8nfZk5und8tXwIgWcHSNX0N2CJmnAl3v6RwgNnhl17T7HiPArBwfghAS7mV/hey2JS9FvM3BLpUUi1YwDRMXvkRYJoAlAh2l0dcZ04s6JUTDIjyBcrl4yDc/dLCAdYAsMnxHgVg4fxwKVwJgGEJNmWtxpQMpX9on2eRhVA+O56AjMfnP+e3Xvf3NwG4xIPTleiY55bpGh6UbafNU0l0z0p+5Jh5HqYJ6b51nP6XP8cx12XNHQVgIQB/bFPVg2OC7Q+WgVFWng/FvtWLI06uWh5oguKEcXVS/9sEAF//VGD7t4ETDgJbF4CNi8CGZWBs2fPL/H6Vwp2KEtVk4fJ+v/EIYPN9wKa5qu+IncfPwXHVZe/aOL3EbwS7xv8A1rQvnO0j8PArTgTGZ4BxFv9mIxhOCGsv+0OPYDRghcLfkWkEuq0+G00x4OtfDGz+d2DbHmDLjL8si8AYP/7CGIAiEEMTG92zXqSbH+d9R2aA0XnvO+JjthiIrOVDHHPOkBrzUQAWAPsZp3oPDpa/Xag6EVkLBK+5rAnJC3/nYk/APD704WiEAV8OTHwX2LQH2DgFbJgFNrBhjd8r79deGoEwsllgNBOzy8CdjweG9wBj08AIAci2D6HafmyAk4/Z7SJ72hGYRwFYAMDLTwOGp4FRFgD3HhzqRGQiyeurqOdG6r0Rm8IEZjzRlkiqCWoEgK8Axm4BJu4HJhyAbFhDxmbDGnZO4j0SgLGDkpibgEq66TJw/1nA0F5gdLpq+zDqFfd5LMeWqu5HNST0uJOIllg+qgMWgI+HPv0xwLA3gWHpW2sC441gCECbmKziaGrnUdMO4aHeh6MxAP4SMHI7ML4HGD8AjHvHJGNAgpDgY/ck3stipRemvVhc+uASMPUEYGh/9dIRgGx8Y+MNbR/00uVtH0wEx94j/v0oAxaA8Ed+GBieAYZZg5kADC0QWGOFzGJlcGPzl1BxNLXD8sk4xftwNAbA/wwM3wGMUmxOOQBnHXzetIYvibonmSiuYTNjriVg7glAiwBk0fNZH6+PmX9P6kfNmCXGpftJ7TgKwBIAnln14BAAYxMYm5C6RjCyCoOyr0qkD/c+HI0B8DXA8N3AyCQwesD1VQKH7EcASm1Q+y4CkN9pUKiVF5nLvy+fBbTUd8QBaH1HvNBROiZvfsNnrF4kcvPwpdsBLBeU18Nf7AB23Dp4ecHC8oBgUlJJecLS+7+WOpE3gbE+HKw+yoevCYkMGKqPJrdEKARutaFYRs1fiEZ0wP8CDN8LDO8FRqYq3W10pgKgfYLaYCzootgA6KXaTA90y374TKB1sBozy77xHFZ536utRgAmEaw6g5kUSFZwSXnA330qsOlfgHMPDlZesLA8IOjoLypPWHj/11EnCiVwkz7kAExtsGraYUWdSDX5TmsagL8KDBGA7Bd30JsW0oWivnEOQNP7yGTSBR101AlZSUtGyfgZDkCWY1HnJdcBVe6325hTvelg2CQjZNDygG/2An0j1wKnL6y9vGBheUC8prQ8YeH9X39OVQSc7Mc6fCaKvAeHdCIVf4yMYCynTpX+nb97NJmlSQb8r8DQHm9YOFUZTKOzoXGhs6AxF0HIexcLBvWBuiHN8s2ne98R3qc6L4Vyb2oBVjfm9MIFHbjDCh6kPOBbQoG+oW8CO5bWVl6wsDwgfr20PGHh/X/1iaEIuDcCTIW/1Q4rFv8OnYiW3c+W2iKwUjKbyjQNwL1uuR6sAEgDgq1brXOmV81PxhNB6DUDBSYzQJwFtz623XcktX1Q1VWKaTF/zZhVazBVYA1tX5MazsGvobwe/jQr0Ne6BTh5uf/ygoXlAfG60vKEhff/rSe1i4DnTWDUACY1guFTDqLYdCBvf6DJYSMYATBfOx1kLfj1v1axH10nQ3Sd0GUkBnTfpemtBJgseIKQAHLQcVxa2TnuMW0Aqui5es8xBIegVdVVE8VhzHnLh65WMB9An+X18K6aAn2tO4ETl6vqbKuVFywsDwhevqg8YeH93/Rk70JE90nowxZbIJjvS3WYNSGUwGHJTpPxwwcbBuBrgRYBeKACn7VtpdUu/c0NJxO9BIxcKu4TTODzbkonPLoaL0vyUQRb2y8HsL1ckfWzMeuFi40Qezqi+yiPhyt7FOjr6/gCFwgP7Xb5vssTFt7/nQRg6MGRWmDRoeyTlpgw68GRTwgZgo1gGmXAX6/8dtaylSKY/koyID9BhzML3q1gAos2AcOrZYSoq/pJp1VtODRm9Z3LS/7WjVkvXOzEtOpKyGrlAT+4SoG+VY8vBGCvy/dVnrDw/vee65NBJiAjBIVcAJQjOm+DkCZEeiGAMw6sAwDZsJrAdhFM9rPGhd4904Co5oVuCZPV6kD40Ec6+9W8dBTBsfdc3nkpvnB82fp2RPcs79dHgb51LA9ofsDV6vut5/3PnxcAmLVBiDqgevDaJLkYrpuQxzcNwN8AWgIgRbB8loEBzXDwl4cGiDGft58SCOWGedgjvOJ+bPvgRkiuA+ZjzhnQQOiFNVbloa7l/fos0LdO5QENgEXlCfs8Qbf7HyMA3QVjYihYhLENgjX9y/qwxQmRU/asfd0ZcLU2CHVGyusJQLKfVi98CS12T5f7iECkHpsMkAhCF8+nshWH2I/jXsOYO144GV/9ApAIrS3vt4YCfetQHtAA2G+/4PW4/2PPbzMgmUMi2NoeSCRxIt2/FvuxWURIWCXg357gfTjEDNIHnTRXRCpH5ugKwGl3HpMBXQc0v6WLYVm/5limj04rG762K2uYY9jBkr9+rI03NL5ZbczS/dJ+LQyoga4o77fGAn0NlwdMAOy3vl/T938KAcj121z8Bn+Y9eWQJRz8Y6kNagDh2ey5EvxjxQD8TWdAuneCCO4An1vw5vdzQMmdktwq7pLZQR+dM34+ZumAxvY1Y04uqOAJ6FsExzeto7zfAAX6GiwPaLWR1lrfr8n7f/Rl3QGzmsis+/uO71V9OFgP2gpPhgr7TGRqRUT6dyvr4aIs/pm/2zVUNbBSv6G8e5pEv0Cvec7Po7+bTtjlBRlkvAMBkDeQyvsNWKCvofKACYBrre/X1P0/oWEAnnFD1YdjhtXxR73mX10FfCHHE9pVWcGAI/S0gKsfA2y+twrFZw6Hxf/F0Pk8Ri/kpGSnMuDx5T0iACgQHioo0NdAecBUHW6QdsV2/cL7v/Cyqr5gnc42CCOcfX1VIZ/V8We9IDmTzVXwPDJiXuKXPxtDBma8+lzP4WAgKkPxCUAPE4v5GzEuMX0PYJPLhB6FJsc7MAMmkVxaYC/K9gG+F1++8AQ7Gwbgk78I7GFpXgIwFiRXOwaJZPUbiR0yCUDRk+cHf+YpwMj9HgfI8ClGPyvsSiH0WSKRuYlitLb/zHM/JOSs5C/YIC9cMQDZr/dwxgOW9gtGYUBi0wA8l304vDQvAchilFbpIBQhZ7Ejq6ZQ0/Yhil8y4j89Axie9DAsD6FX9HOK3QtROTFkviN83kG4felIY8DCeLrSeMDSfsEovAECUFsTjHD+tcB+tkFgcXKvBRir7qtFl9owmO4Xy/1G3bAFfPrZHorFNWBFwHjQAFctIghj2kBarw06If/+MM9ZqTN6DgsDojCerjQesLRfMApvoGkAWh8Ob/tgAPSKWCp8ngNQtadjmTdltvNvn3peFYhgQQgh+iUmEaUAUoXM1yRLmWuFLaE9Z+XIAWBhPF1pPGBpv2AU3kDTALzwmqo6qtVh9kJErAudABia38TC5wJgS2xIhAwBn3yhByL4EhzXfRXxYsDTJ4IvrNN2JFMxZcBzVo4cABbG05XGA5b2C0bhDTQNQLZBYH1AVsQSAAU+imI1obHyblnjG/kJk3U8BHz8xVUQAhnQIl5CyNgKAGp5LKSSCoAySh5Jj79vTagcxUaIBeRNe79g9gq+DXig4wGzy+PONfT7RWFA4noAkGXZVAhcBckJQgNgrLiaNb3paIDo1vHHX+oA9LQBi4DxJcOUPJUnTgU2NJUyROs8irGARxQAC+PpCtsFd40H/AEf0gMQkLgeACT41PiGoLOKqyrJq3K/Ya9mNyr5FusN/uPLPIeDa8Bc+w3rtyl4VFHaMZc3i9RWBM9jjzgAFsbTFbYLRmm/YBTeQNMAtD4cBKDXBTQGdAB2MGBo8SCLmEuS1AFVAJ3A/NhPt0PoCcA8bSDG76XI7aySg6JYuGfKwJHFgH0E5B3ueMCe/Y4L+xVHAOZ+9EHcEgQgwbeiEYx6jwTdz4qfu7EhEJqxGqruf/RnHIAEnxgwBM0aC8aUAYWNBRCmoIll4HTqO122QcZbrgMWxtMVtgvuOx6wa7/jwhtoGoDWh4MBJ16WN4lfr8AqI0TVV1O1fa9BbQzovkAy4Ed+NgCQUSxZCFWvCOaOFREXyUwZOPIA2GdA3uGOB6wPaOz+QPv5S+MA3OXiN9aclghW+d3IgupBF2pPqxcxGenDPxfSRh2ASiKKiVP2PaZScvAKoA0VDc6cOlIB2GdA3uGOB1zR77iwX/F6AFB9ONSOQW0frA50sILVcckWJyIDSgwPAVcJgFbYuZ3FJvAlEHbJ3IsgJLGedeBIA+AAAXmHOx6wo99xYb/i9QKg2iAIfDJEJHqj4SExbEty0gkdhB/6P9oZbBZIGiKYVb9GKaN50lRHBLOvhDxh/5EKwDUG5B3ueMB2QGM/grb7/6wHAPNGMAY+GSGUjC52VX2f2CD4+HO0gqkZfegXKgBaHkcWtS0AWii9xG1ImrLlN5XR8L8fmQD05BVrmEENmpYSP9QX+KHiqj2/82+HqqDWwnbBRfGATdzAegGwru2DpRq7Mzq2fpAf0Nq0Rl2wBXzglZ4yUAPAmDSVWDBPHQjLcgTqOZ6zUvdKHh4ruDCerox/Dnu7YqwXAC1NI/QcEQuK6WK/kdgCTGC0PYAP/KIDMBgglq+hIkrOfsaCviLSofcJgJ5AdM7kkSaCj/HqQKVIGvD4swF8bcBjmzjsaQ2H5D/6acBd9wALB4DFWWB5AVherMp4GKIYEOp7+26UF0aSfT/xYuDG7wDjrIpAERytXf2vajj7ueryQXSFl10K/ON3gIWDwCLvjfGB8Z54O+Ee4ve6513uB2R1yzsqC+twbC8HcNVhfAeaBuDP/TvwtS3A/ePAIfYFVlPq2HHTuyulZCTlhbjhETF5yxTQGgPGhoHhIWC4VSXGD3n0tLkMHXHxu+YyB+MlPwDuZs5K6FlsbCzdVO9DuKfkHM8AEkP7B8fOkwDcD+B7np42+JkGOvKdAL4E4K8P0zvQdET0b14D3DgB3D0B7B8HZka9WzrD88N6sFm+YcUjrn7E1ZDvMtF9DBgeAYaHgSGB0PNHCD4BLwLRsByAyX/ij0/dDUxuqlIG5hix7eFhvLcOVUAtyPSydAFmOQNe6EYGV/9ZESiKgIEgtbaD/gHALQC4ovY5r5KwtjOU/XfTAHzzLuCmIeDuMWDvKHBwpMoN0WQzNtAaYSs0K4ZlOSAjGG9kPjCBRwZ0ABKEBJexYAZEAU3A7Oi1BeDym4EDnjQ1TwCGWMW8MXcKks0YOyZNlQOQjcgYIUHllEzYQ0ktm+r6oz8G4F4AXwXwRd8/kO9A0wB8y65KmPxgGJgcqYJTKYpTv2CCzyddQJRDOjKivn+Deh8BF8BnwBtaCUA+YYEyAU8h+c6Az9gNHHRmrgOgmDA3jHQ+iWupCeUAvNSrA9HNwqx+muk9nJVNg/CTfrmbAPwbgK8D+PcHkIibjob5o13A3XypWsAkG1cPA9PDFQDZM1id0i1KxsWfOrKnAFXlifCFFMMRcASigOcs2MGAIfE9iWXplS6On7UbmPaUUTXQrgsVMzcRj5Folg2V5ayUA5BWYKwOxKUafnosWjcJwk+7W5F2EKvlE3xcXaNYfiCYsGkA/smuqug6hcleAnAImPbO6YwRpMgjCAVAm/yQmKTv5hNsAf/i7SyNBSl2a8Qv/4/M1yF+BZSYlNQCnnVrpbC+mToAACAASURBVJcaI7sOSEY2NpaDXLqpR+vE/OVksDgImgGgghHoYJbTWc7oJtFWc65/cg2AYvh2ALsB3AzgVv95nS/f4QdsIkT9T3cBrGtITWZfC5hqtQHInsEGQn3UDDvEDEY/ICf7SxMOrAg8T+c00JGkvHGd2DABUYZIAONzCUDppCFhSukCBsLQrFtZe/IixYQpSyEoJoqnuPWrVRAubQh83HNlZB23z7j1ywmj6CIIqUPxw2Xeu9bx2jx10wz4Z7sqTYZaDD8EIDuoE3hMVEphWg66JIp90k0sBxBcy+iPIIaT1RtEsHS/yIAqw+VSNPWQfe5tlVEk8auXgVa5BUsEJuT5uoliAbE5AGotmIAjCPnR9xDG3TQernYAUupTdBGEFMf83OkApHG+XlvTAPwfuyrgSZOhas3u6cwTsUBVn2gTwyFMi8wjHZAA1M9fYGHDULJD1m8Cpa8fRxDad+l+Ykf/3XNvd11U+qiL39SxXevSsshdDFvgbI1O2AwAtRZMZzTBRuDFjxe1Xg8QEIB8yyj5yYIUxfQIkfkIRnmHCM712JoG4FsdgHHp3ACoMH2G6jM4lWzoQarSvwQ6MSB/vporVaFkh+mCLlpVR8Z+dqDZLoDOpHSiQeAFDkBjPrlgCHgCUaFifg67H/9uYjn4Ai1vpTERTAASBaoQJBAKeNqHlL6mwPDZYAOROag/EYRkPX34MwHIvzW9rQcA+TLpI22G7EcQKlJGsYIJhC6ClUMiXfBTbFUQAej6nPS/OuAl9pOOqIc2BLzg++3VmWgIEUz82cRuCAtLIHQQm0gO52uOAb22sC3JEWgRfPpZf2sQBQIgLydPEIFGwPEj8MlF2bSbsulghLftqsCXq9HGgHysznrGgi5qzTUTFH8FLhAUn3hIJwCN0HLncw37qaF2zoYvuKNivmQIuUNc7GvWt6sHNs26twA6vhyq8NEMAHlyntFrDCcQehyaPTl+FwAbXDcmAKMRThakEk8Q8kPg8SPL0qzLBl+A9QCgR6uZGs3vfHz8TtBZvkgGQrEPBVAUg2Sij50QAOjiVKI3saADJRm7dSLYWfSFDkCem/dhZeMy9pPY5QvSDYQyUJoDIK8qMezh3wY6fSL49PcGgCAA8pScJLIgAUYQEmz8RPA17StvGoBv39W24eREiBoNQSgWNI1HBkdgxJSw1AI+dFIbgOYmkjimQ1r6XXC3rAbCHycAgytohf8vsB/r2KRaRq7zpZ+D37HMX0s3DDcCUGLYaw53MJ4YUODzusqlGCQAOQCejuxA8UULUkxIwAmMAp8Wa3qkN/R9W+sBwOhIEPjk5SLr8HeKFbTQfb77csPIMHGl/4MPbReslPhNe4+MiTpi9AFGV4nI7MfvagNQLh/pfrYnDAS8aJQ42A2w4em2cAyWQUuJVQTGWLs1uL7DG9J1RjhA+jvYk4t3KXeMqijpzrud4At9z3XtP16yGfjKZmCGooYh1tZzvv8xXPFl4PoJYC97k9FlwZWD+Azi/deMZWeP13eQCGEyoERudChIjbb3mJYwH7V0QIKuCwj/gfMj0asn2I0FXRSHXfL/iRkNgLyeVj8ccMY//J1fyxzTAXT2+xoQViKYD/1hDqLxPiYxTgSvQrphphG97tz4Slqafnj7uk1kIQDZrvWTw8B3jwEW+RLxPgSiCERdPwPR7+wCPg/gulFgfruDkOMQkFc5x84e708JAMmCuRNBXi4TIg5CGRzGiBGE/D4E/C2r2vcAYJoify62i0aJSMhB+2IHoNwu0fkcjQ85pu3ack5nIBREqneYFyWLkAXIJHESe00Cyx5QyeL6F/tyEcDcrOW2n7fX8df0mME+/vQ/PQjhoy3gzo3AISYf80MQaQx1peH9wb7v2mrtmCBkIMMejp3jIJD1MsaxaMZ8v5N/67INAsB3BAYU4JL4DSo1J15AFPAEwuQHZJzkKfUAtOHLJSOQRWndBYQvCQA01cfnNopfsaCJaD2baBn79QjSTiOEP1EcawIpkq2kegBTNgHWEpOKF8Uwq2NRFPM4AqCf46/rA2U9/uVDvurB01zvAJpiiwOl3fEeciCGF+Ij11f+QkbSfMPfIzqw57mEFZ9Dl3Ps5HXWAYByHJAJKV7N+s0cCQQhwSlfm4lGZ0KB8C/rABgZUS6ZHITBSEhCowUYAAksF7cStWREyxRwtuPpOlgw+5s9sq6OaIJIIlUgEhA1edoTgHxa9HVw5jibZNF+j/9yGQA/7pbujZ4bwv2+cWB6tFo0NzYnkxFA+cvEAo43VBoEo2e+48EMXEOmD9F6xhCE8RwZEJ80VblKvDlmzwicfqy93/o+8K8TwB2jVSgW138FrJQTXBNlnJgmrjZwanow9CBP/rL9wF0jwAGWDtFyoN9PHutnIHT05mPXz93dMGQAPniJsjiBXiTbxDZFMF9NLUPQxKR5qezz1Y6/YZDH0D6GkdAkYJIvRalAdHAMmPZoYhb6NhDWvEyf/ma737CXN7R1ZC7hUbPgcFgqt/ZZjADnM1xqEVhYBpb4CUk5UsL7jQvj///5buDrLeCOEeD+YQchYwG9VIfyg1NaZszFiCH6DkRGLze5/dgk8IMWcMCjdCiCzR8od1B8OTwvJM8JEShFut1fzMhi+eRJr6LI7hYP2M/xVLwKNoZjUTwRMAQQmYyhWGQxsSADOflZ4kukj7PhZ75bETjBpkAGahMkcrGgwhsXeCyBHBj1wmOBQwvAwqKzoFeRV8ZaerjKYAuirmPY/o9X7q5Cyr7fAvYMAftCPGAEoYlBiVtFwLjtp2U4irj7yOANbi+crHyrfCbTquJV44O0F1FrwQGIMZFqdQDyP/gGSZ8TC0ZRRsOlVzzgasd/u+zpMByLehAfCgMQCDyGZJHFCCgLZ2f8mgI5qauEcVx9e5vACTgCTwEMWr5TdIpWKJb5MvrnoocDswvAPAG4VLGg6UKeqmi4iuDz4er30oX0FP7u5moMvIf7W8B+jwlUNAzFnlZCIhvGFRCeWzrgXSSIBreXTFZSgVLHAp4UHOFuociEEsn2PJwl/XEk0dzfSojeerFg1IOo5BKAveIBex1P67lgUzgWQaJwLAKRH04i14ItgDKEtGsRnWx49b2Vkk9wUefTGrKCF7R0JxZMqxN8cmPAxWcAcxGABKEAKPA5u9lEaAbCmKMI+sDN1X3z+ro24wEZFc0VEE64ABgT180PF9ZdBcDb6JpqcPtPk+1ACbmKjJnllwyuILunEAWjZHkBsrsRUnfD0qEiC5IJfyisgMhzWhcP2O14Ro4WbASgAMQJ48SJwchmBCDFa8qpyBbSP7OvU4PQ0p2W7+LSnSJUFOrI4V7w5IoBTQQTfJ6oTSYk2mQcpGRyH2syGjIF6EM3V/fM++C1CfwUExhCsmzCaQT43lZC3e1hBpEHh36XEqrB7Scmq5dV0XZxmV8WuDFzAF9iwhow9seAGoBcGtKjqAc+1l9rLb/1igesO55ysmCrC8ei6IxRMAKTWNBi6Xw98xNTFUi0jEcmpYgRAPhddpVi9OIEPP5cYD4CcLkCooHPwaW9kV+iwWrQHT8uA1fd3F7DFvgUHUP2k8jTiogAqLoxFpDgbMj9jXSuN7i9dLIdaxzBp5XVBMIMgFEnFAPKT9qPd6A9BIGI7MfPmf4U+40HzI8nWgq2PBxL4FEkjKJixGRRFyQQPzzd1iAUzCAQas1YOmAEoFjwkecDC/PAwhKw6CxIkCXwOdVJLxTobMjBdyIgfvimNvNJ7Evf4jWtdnRYD1YNGVuG93VWuWs4Jf+mlZCCZxwP/cnJ6mXVKk2+tK8lQQVHRTGc64SDAZB3Ey3JcxyACkToJx4wHl+YwqloGDICmYmTFgMQFBET8yyYzyAG/AfWX8mCGQg0BTRoHwt9KVaPE/HQ890AIfgWK+CRAaMRYnVdxHbhdY8Wslw1V93UDsmPIj9GxgiAioRRMIJNvoti+SW/Ikd0gwAU8+XxJcbGITJPDvI6XdCFREFSknTB83xka40H1PGF9dnycCxFwygkK0bASJQSVAbAYeD98xUAe5U3jKIwBosSgNsuABYogl3/IwgFPrOIg1Xc4ZrpAsSrvruykl2ucykapkMMh4CExD5DwJfWAYAxwk4MKPAJgOIjGSEGwuCakRhemw6Yv0UUwRf7L00L9pnsNx6Qx4feY4O8pDEcixOjsoTKKpMYjSFYYjOC8Eq3Wnnr0YYS+0Tmi2HysrPGLqwASNYzBnT2Mz2QD91laxLB0gs12GAh81cf/o/OcHyJ+qj0S/zxnhUZbSyYWaL8+Rq2S29wowiWkJPan4MvgrDDGAlRe7KIywDIgR3meEDWg9HbJgApNTkXo8o0i7oVgxnEgFr8F7jEdnU5GvqfJQKQKyEOPlsNIQvyvupAGHS/Okv4qv9oh+PHxMLk8ggBCRxvAmEN+AiEzz2iQfQBeNmkh4K52hJBKOaNe/FSLobLRXCz43rQnu2yi9oMSMDxs2jo8303ERz1wsCGZECF4kd3DwEYYwJjhoNlQrgIjlYodbBPrwMAZfEmyzcIv27gs6XDzC/IR1DOgA9a6DRz4wZAsZ+LYXvQYsHoD4ziOFklna6YD3+nnU6dZ7bGDAcBUImIAmEUw/zbJ1i/scGNDJiLXmle3RhQ+l/aq57gUQCWzwwBKPeLsZ/LFrGg/ShRXAe64Ajkv30kALAjF8R11Dy3K7KRwJcsUTaqWScARou3w/INVnCH+A36n8RvM3nB5XP4oD6DATBYwGb5ajlOLOh6X8JaBKRG77+7ygGYp1bn+V25/01AzBnwQ1ypanD7KWfA1QDYC3zJIj7KgOUzc9nFbetX/r+O5biwNhyX5uSEDr5o0xsJwLp8/m4A7GaJUv/j3/5+HQFYJ3oFPPkho/hNeqBcMkcB2BAA6XrxmMBkfFAci/m0JpwzXw0TXvXtzrz+PKc/Ml/ugzM9MDqCAbz/keVjjGcQA/YLvjoguo1mRslRI6RwfsiA5nqhL5D6nscF8gfTdfxpS+/hLzvWfzMQCoB1Fq/8b3VWaPIDZqsRV64DALsZHVHs1gEvsqFAeBSApQC8pHK90Oql4UEAyvCwNeGcBXNLOPMLftgZsI75ouUr9ousp2TEyIJ/sU4AzC1e+WIFshyAHPZREVwItrrD3wGAhibTYBhxVpe/xePyrNBuWaoNp3DgFwC81O+RAepK/a5Lfe51jxr7JwA83nPXYgq1asl0yX5N48+f4VEGLATlK1vAo5YB1gBSRmsM+NFE57lcfPD5pPFWCJImtyvGgGfOAacBYO59zFglgHgPefZsXV6/gPXBYeC0RVgyJNOGYuJjPka9eHWgjL9bWzhWk0/n/wPn+k8bgFNmgYcsVflZnBRmIShtJM/m7JGibGBoOIIez9wKPP4AcNpylfbNlGfdI+9NjBjz8JVzppckZuJ+dBw4aQ44drk6j1LIY9JkPD7P4s2lwVEGLHwJnncscNIh4Nh5YMsSsHm5ndOu1BGFThJ8/K6JrZtoslST2+XHA6ftB05ZAE5crgAups5TfaL6EF+UyIif3gAcOwtsXep82eIYY9JkXpMgMp/AeZQBC2b8OduBYw8C2+aALQvARgJwGZhY7swEzbNa88IRvAVO1qkF91J36DNOBE7eD2yfB45fqphLnevzdGeBKBfL8UX5/CZgyyyweRHYsFwxYHzRNK6oetSBMDLjUQAWTPqPngpsnQK2zgKbCMAlYMMSME4ALrcnR6JYQIwsoUnjpDRstOLy7cBJB4CHUGwuAtuW2nUDVH1EFUhycSwWjGD64mZg0xywcaECoI0z5P3X5P6nWlHdgHgUgAUAfOYOYMtBYNMssHEe2LgITBCADkIzSJZXpCOnIg25uPrhgnupO/TyhwLHHwSOmwW2LVSik2pCrDsQskzNIBGIpBdGI+VfNgMb5oENCxX4yPRjPj4xaJ0+WGeEHRXBDUz2Mx4FbDoIbJypADixUAFwzAFI8KUJChMV2SUaAGc1cE/xFJef3FYRti64nkqWDrqqEhbrsm5zvZCdPCd8nHzJOLZuABRz9hTHZwPL7LnLnoNMIY2VyaKcjtZLHOAbNgNPngKe4BacfGF1pnydD+hphQ/8XV5UiEueLGnDN1tWXj/3/4cTwAUzwGPcRcFJiDpPt3FLmf5vjwE2HAQ2zPrEzDv7OQg5OSM+ScYQy5Xbo8465u/ZfLTJ7fKHAdumKxVh8wKwealSE6inEoSy2MWCdbUHIghv3AqMzwHji9VLZuDzD8cXxxWZs5c7apmW0fMBnIHKn5X7d6I5npvRz94O7LgXuGIReJSb+Xl1tzqflybwRwqf9i97BQRWomWJQ7oZVFtJoqDX/b/oGODsvcBTATB9gsfGqmzdjtVz+G+PAyamgYmZCoDjFE2anCVg1CeJwOMnTRB/DmUINVkkgia3y08BtkwDW+YqAFJFMD1VAAw6XG61R31O9/fdrcDYPDDmY0zjc1UjivBuAMx1QdMB+WAYXU8dhEU16dOSkppbcHFSrng8MHwnsGMPcN5ypURHp2xMIa7zDz2z8Gn/kVe0YomO0wEwBYKujL7v/zHA6C3AxfOVh58g5AsZxx4fZM7sf3h6BcDxWWeGBZ+cMEFiwGEHHRnDzun7ONHs/djkRgBunql0VDOSHIDU3cxSD4aEajhFXS4H4S1bgVGN0V8we7E0Fh9jVDG6Obr1LJMRwn+kOCaTEYT0dsfqZHXl/p7PrLi9wIY7gO0H2yAgCAWCWCowKrYE8nMLn/a7PQn9X7zIJPPkCcK+758y7x7guNsB6l98gZjLLYet3Ay5n0sv4R+fCYxPA2MOwLEAQLIDPyP8uBg2cRYmzFweAYilKkn+OC8/Fdh0CNhEA4nGA40kd6FES13WLO8v1qHKAfh9B+DoYjU2Ak/js/8NAIwg7OUb7LCC+WAfB4CpBJoIiTRNRmS1l13kqWh3Adv2A8cdqqp1MB+aIOSxWv6pq5D2kkIAvt8rF7BLJksN/jMqfa7v+7/Ak4B3A6ceqpasKMq5akAmlLWY37t8ZW97PDB2qALg2BxgAFwANEGcnI5JcrDZRPlkaXL4u1KJUAfAjbTQ59x6dSvdLPXAgGYshZWR6JIRaXB/NwFI8C1WwLMXzMeSwLfcXuKrA2G+wrLCDcN/IIg4ERRn0qvyySAQX6mG1XuA4fuAbTOVwktRRr2MLCoQyvEZ/UY/WwjAj3jtFJZkU79g1ghkgEBf98+0Umb/3A2M3lkBl/fOcdMok2EjkZyv8773LAfgHDDKjwNwxEUw9yailpwdxBAEYhBbAuGzG3aKkQEJwAkCkOCjlb7Y6SYyf2UwlAS+vKYnAXjfNmDEX7DEfA5CjUcsnzvbu1nDtUMmCDkRZEEyGdlAk6G6lQTSa6m0MP6HuY73AxNTlcJLZ6WOJYC5/CNxLpHMgdKIKNl69Qvu6/75AjHOiTU87gKOOViJb748BKCWrnK/maTA+58AjM0Ao7PA6Lx/xBAupoYDC9okBRAmPdBZ47lNA/DhwMRsxX7mPgl+SrmK5EaRNRslXFQ9CKB9DkADn79cZtkHFkysJ103eBbqlh97DpmTQTYgk9VNxu+xYbXKU3lhFoJPOgdFGY+lPkgQxokkgF9Xgj4AvfoFs84eX4Ke9x9fIC+tRfDxvvniif358sSir2LCj5wNjBKAc8CIi2AxxLCzIAGY9L7AhGIKgpATw4l8wToB0JjPrfTkp+SLQbHrOqm5jNyajS6VCMIpApDAWwQ4LrGgXqzIfnq5cv0vN0ZXHTInME5GBNLb1DGdOYQsI7AfGKFjlgqve8wJwG4T+fuFAFytXzCLb+VgWnH/fIGYfc46Hs7iHC8ZkPcdXx4VfVXJw8+cA4wIgM6AHSLKWZCTESfLfg7WsIyRF3ckiRQ+HACXkwHptyP4KHrpJvKVGnOhRF9eBF9wE0mUEogz2wC+WGI/vVxiQQIxAs9+rmHA6E1YFYB8DJwQMZl0OrLZ++i7sfT8zroYHLS9df4RACWKxSZvLXzG/fQLZqk2gqn2/vUCUQ9UZaM9wDaPeSPrC4A5C1KV+NITKwCS/SiCR/jRBDlLmP7nHynsxno1IPwJSyRpbiMADXzuPDYfZfBTEoAmcuVQdiaW0zwXwQsCYDYmMaDA1wG8TBSvaoR0G77EcGSET6hjOvVApfRPAUN0zjr45JzVcSqiTxD+VeGzXku/4Nr7JwDJOkxFIwt6j6+RqUrlkO4bXzp1gCAAv04AzgLDDsBhKugLFUvQUhTwCEKbnKCw14HwJ9cDgGQ9WegRgDI8XEcVEDvAl7lVlglAgi+I4CR+Zf1mLGgMmDFhBGFfDCicRJFERviSABjLS7FC0MFKMU+07wOPE0kGvaoQgGvtF9z1/iODkwn3VWoEXxres5ib9xx1wZufBAwLgAQexbAD0JiQwJOuJBA68/H3Zhk6+3CifqqwWNMKN8wjKgbk6gWJgC+FMaBb5vJVmsUbV2vCqo3cRWZcCIACoax53+ulkqNd7iqOcU1WcC9cxEm5kQBUdZ+sTnSL/jEtTWngi21jhJNJBivZBukXvOL+yYBkcOqxKjJ4AGgxzMrBVwdAMmHrZOAYF2l6y/mwV6xD17zmWo6MbRyeWtOHwxJ91IIhr6rqZS70DPPLXDVUrfBwzHKr1EUp6/h0T/6L/GcCqslt4IhoTcwdAqDSs7I60WQH6R329pHuFyuXDJmEjuOSbdB+wSvuP5bGUjmsA5XoUvcvBXKKAQnApUdXwah0b8jXR2YzJTsC0ZHB33FL+2yiX3h/1YeD1fFZGT81g/H6yqkVa9YEpqMhTADle8erHA6t7Mh6j4ZBXdBGjFyO4CSIm9wGBiBvgqxwIAJQlXIyEJLyI/i0SkAG/FbhaEr6BXfcv+5dLKhCg4z1C1HEBJ8+BODQGZXfk/quAZC6ketAZEQCTWAU8PIJt0fgwHzZvVWNaKqi7JLOmtDWFy42g1FxH/XfqGkII0C+a0tnDkfsGxQjn3VPsk7tXmuy+Xp0JhtoJosAaFcUAJUYKiYJxcqHqKAH9rPlG2cMrmCUbMX9guMLpGTcCMKDlZGhMK8IPnPIn1X5PA2AwegwEEYmDGBMjOI5whGQP3NPBT7VJlRNaKvF4t2IWHbDErtDlSk1p4lJ7/zd246tglGZryIfrFhQ7pU8WCAX0ZENG+57U14Z4YrCeLrSxXdev6TfLwrbxT7znMrfKQXfHLQCnyvmRIv0Q3430ezMmL98P393G3wqz6am1NYzzoGn+svqRmTAU2citctqAX/2EI8F9ACEmLHXLZGoFxtSl2xyK2bAYwrj6Xr12+1noL/jUTCD9vvFrn6u0v1/nvGkaoVBAQi0eummMAuXQHMWJAA7gCixG8U0gFfcXdlBKk4Z6zELgAJfZEKrxpC1xOIl/+Sk7jkcdYlSco90y9+gK6vJrRiADD0piad7RuFo3udNCgft94vCdrGXn+tujgV3QAcHLcFnroelivHkchEL8ue0uQ74S3eubAITS3IQhKkMRjBMokgWG3L//2z3VSnP4VDgQWxUEEUxAZFHL0eR3HDfm3IRbDHkBfF0zy4EIKNhSvr9goGEBdvTz/MIYQLQdVsTwRTFDj5jQmdArRDYJQNDSs961R3tPhx5NXoVgoxleHnarjohgLec3D2HI492yQNvIwvqO9fJm9zKGbAwnu6FhaP5pFuMg/b7tTbpBdvTz68cz/zI8azVj8iAHTqgmFHXDUB89R2dtaC7tUGw4kDOgFb0R2wYRDGZ8g9O8aU4XwPOczhiwGlMjqqLWiFYGu570wADFsbTvaxg8nkow7E8nM/atfKzln6/1mS4YHv6BQ4+Z0BbqHcd0NwwYbVD3+1yWhXJxPBrbq8AqE/XApSqAxiBV2MZ/54DMOZwKE00rnDUWcR5KiV/brjtSAMALIyn+/mCyeehjIYp6fdrvVELth8RAClyHXxmhPi6r1m8FM0ucgk8+y4RHC1kAK/5XgW+2hZYofafWcPq1B5AqDqEYsQ3nepR2gqhV2yiol1COkD0C+aOaoGx4aL7DQCwMJ7uVwomn4fm7VrX2u/XAlELth+5sHPtN+l/Ap6sX2dCsZ/phZkIJgv9l++1wbcq+2WFv2NXIjNKAPzuw7MUAV8DTuynFIEsQy83RgTAhiv+NgBABaQOGE/3mwWTLwAqHnaQfr9GnwUbARgDNBUlkpzQboyYCyYDYdILdf0l4NduW9kGoa4geNdazLElKoA3Prx7DofiETtC6XvE7hGEzJlpcis3Qgrj6d5UOJoYDcMglrX2+y0NPtl5UZUjkfx/Hqbecoe0OZzdF1gHQrln9Bhee4s3f3Zxm4MvAk9VSFdUIw0i+Q2PaBtISiBSSFgCYMjMW00MP7pwvvLDmwFgQTzdHxcOSGvBg/b7ZRZByWYAlOERluKM3Ra9CKWc0q73dTBhMFT4ZwIw9l5Lrpes+HjeBiGCUOKXeuBvPcKTiEIOR0f+RhDBMYi0Lhea4GTaa5NbOQAVDzhgPB1La5RssV3rIP1+7yy5OAADoAchEHBkFbKfGRpiweAPtMs5IFNokyOGk/7rAYC9OhBFwNXVY1at5tftCBHaWVS2AJdEcEinrDNC+Lumiyc1B8AB4+muLARAXTDCWvr93lR4/Z0Xt6ODFQkj8WtumEwHTKDLQejAfN3uds/dfjoQdatGLxb8jQBAYz6/boxiFgAVudzNIc2/s3xLk1szAORoB4yn+2DhaATAGJCtbpkCYq9+v4V+aBgAQ4i66XtaC85YkDog/zdZvzUgfN1N7a633Xqv6fe9msDIHfNaB6Ay2JRE1AHAEDIfI5nzZCLeN4Nbm9yaA+CA8XSsul6yqV0rJ2WQfr+splCyCYBR/HJyKX4phs0PKBZ0lqOYTpvniAiUAmAd+HKjo1cvDjHgr+3wPJQsVCymUZrPMuRsRBDG4AQCsunyJtFGHwAAIABJREFUcc0BUJlxQoH62q8ST8cggpKNAFRGwCD9fkuvbwAkyGgJE3C+Nz1P1q9/T3F1EZBxvZh50s6AEYC5yyUHXt5/Q8zI5/KrAmAIkkipkyGPYwXz1aRT8v5ZO6jJrRyAvKOvNXlLazsXs9bo/ztc29Pohgotp5J49Rcj/pzfIwGS//3OM4CNd1dpntQpFUmjEH4LYIgnyn/OLjL8FeDGhwJbNgFjI8DIEDA8BAy1PFK7FSKf43cNKrvHx+8C/vmxwMgmYHgEaA35J0StpvvzL/nP8RbLAfhyT207TChgDRiu/ZL9DsfWNABvYzbhCDBKoBAk/pEobGWTqp819hzQ1/0k0PoaMDEJbJjxVZFgDad0SaUO5LksWVj+XScDmw5UEUDJ6U4d0nVbC91S3ovfVHp5al64cgC+k7mZAP768KCA0WD3A/ieLz090CDceVmlAuhBljLgrfcAw6PAyDAwPFwBkCAbItM4a/FiNtERjBl76W9ffD2AbwJDdwFj+6syImRXrd5Y2FjIYcnzWPLEqnsfC0zsr6qBMQmfIDR/pyJ6xMhKyMrSDiKD2xja6TADTt0/AGAs1KcAUCFrOLF6tbtiRVFavT/wuMCa7MfVTlH098YBeBcwNAIMEYAUlS4uBULOmK3LCnwOPANlEIOSoF9+C4DvVoWXhvdWZVOYqWgi3vOXDUQhgieB0EElViMYJ08HxqeqnG8D4IIDkAzo51DKQQJvBKUmKACzbM4+5hUivwrgiwC4LzvjmgCh6nBcgiMTcv9Abo0D8E6g5eCjfpUA6AxoQIzgi8ALmWwC4z//DxcPPwBak8DQFDB8yJPpPZHeGCyC0KN5DFCByfh9/+OAsekKgEzCTwD047X0SCPM1IYQjCv2E/MJoGVwUUQoPboq0MdqkWVn7RtDDMahB4g+P6qhXFpjVtkDtRGA2nKjos7IyOyHFUbIrXe0FXsTuzIYfNb4O2M3ATGIYQOmPn6hG6gi3eUkQQAeAIYOAUOzALMVh2pAlESqGFBAXAYOMQVjxll03iO/yYKRAT0FQXkwZkjp1pz51LO2XAT3KtD3AIAwj4Wg05kfiuUHYlsXAJLVnP0INLM0OYFx78AzcRySeTsw2AJueI+Dj2Fne4EWKz5MA0MzDkCCkAByUWqsJzarEanzj2zXwjEGFHuGY+pYsMojzZL1G9EBexXou339IRBrC3lJGmNDuSHX+w7WC4Cm6wWxm8DngLTImgC8pBcGBuTXf/1fXnyTugnFwxTQOgi0CECyIFlsvvJfEnh0mhsYI/s5uxFYi1xZof7oOqSAawwYjRGBzYGXbtWXaCIrlvHUagX6SP/ruMVYCEbEqECXAMjfree2HgA0ESur1/0vtnNwGSsG0RsZME20/+/XWH6Mugk/yngPAGy5GDYALjiIHIgRUIrsZjM7Ax+BSx1S4pfffQVIep8dL7dMDsTGjJB+CvQxTHmdtrw4l0CovFruC2NOe975egDQsCXRK/eK634JhBK90q2C7I1i+Gt0jxF40k1cPJAB7UP2m3MGJAAFQrGei9iUTH9yBUDTHfU3B5+BOIKQ43BWtNtPcWIOzEZE8FoK9K0DCGNxLi3FqaKA9gTgeoFwPQAoI0OulWT11oEwiFz7cwbErzNxWtEYBB+VY76Vh4DWrH8IOoGQ7Ocg1CqMRLPltmxvs1/SHaP4dcAJePYyyUCRIzrTB8tE8FoL9DUMwl61kQQ87Rmy2PS2rgB0a1ci18RudEJH57OsY02y/+83/sZdBKr4FXQTApBvprGgQCg9UEAM+h9F6ugJDkC3gJPBEvRGrYoYCBX9IxEcS5K4i6cZAHIw8oXQ4mLBb35YH5d7OekadtTV1UZSjaEIPH4nQzYNwgjAHNwDuWGYpZc7lzPfX1cQur5oBorfzDf+zi0yVTuSkuxBI2Q+PhQDIUEnMLo1TBCZLufGw/ixbQa0KB8CTODjPohdY78IQmfDjmW7Yo/doAX6GqIiAtDHaYswSmeMubV81kp11L6hy2PdAcgblfslOKC1IiKRmyRxZgV/8++DS8BFrxXi5Hd/U6MeSKdqEsEKhpBRsgRMbAtuG4KU/+9ry5brzP/lPVMv1EPOQegharrVcgZUhVHFxNPcp9VFtlOWkL437C0WABWypFRGsV0sb5Hn2zYBwvUGoKl10v1knDgo0y7XA8Pfv0UACnjaK33Co9gJQAOe64FkNvtZAHQdjz9v2Nz2GSa3jYej2W3KGuZ9ixGdIVSoKT13B2s5AHkGheST6qn0erHv5AIgAAU+LVfw/wq3CEAV7clBKDDGZG9/5oVXx/oyYARczcqH5GyH8eFplTawFvAtrtXLGpNrQDGbejupB3omlIHQGc/ErzOcGSRs8zrhAbbuL1Tco/JfbLlNwHOmi2kIcs3owbdwNpYtynDQhsFcgvuG9/YapGFvYX22zZcAU0/GwA2LJ/4AmGF9mwEbBu98Y3cMF+uAGQCj2HVp3BbPuo3IlqxAy5wHAq4OfARmEBXGfNIBa0BIsG0ecwC67merHgRpZLwocrWaovuTxew/V0txJQ2DWeae3WAGbdhb2DB4+wRw7w5g8Qpv88liyGtoWHzMi4C9fAEHbBi8kwUKu2xNAdBxaGBLbJdZux1LwAGECYAEm6wyfpelJrEgFnRDxESwgyUxIUsVMwjVy5AYO0bG89Auu1/5BF38KqjBHlUAYXsteNCGwTeWNuwtk4JMkrlzGNizA1hm69g1Nix+zDOBW0aBeRZZGqBh8M4emfWNADDT+zqMjQyESdQFHfDbZECCLRgdHeCTe8CBaKJY1rDnBRCIAuGW4TYAZeFG8ZuMkGiQ1IEwGCJtHZBmy1obBsvVMnDD3jIAerti3LEBOMjGcOpa3WfD4ic9t6oveDtLfw7QMHjnH6wPAybW6yaG4+8D4HIQfvtDIVtLejpBFsVvUI7NIBHw3DUjRzL3rDVtsYPOkAScuX3coNDynT2VYJCkn+PjqvUD8hVbS8NgjphGxcANe8sAGNoVY/824BCBtIaGxRe8pLKZdpMkTvXiJ2toGHzSNHDPScAyq3er4qPyGaNc7JCRXWLT2TjwGmCOeQashq6+qSpZmp8vojQpheF58ncdZVjLnjWPHr4VWKTKxrHGUqq97qXu3jp0wPy+eEC/DYNZsZAO6IEb9pY9lNCuGPcNV830ZmkM9dmw+OKfbdcXvJMPdY0Ng0/7GnDXKcDMccBS7MwdKz8KCAKQIgY0MWGCtr4TOHAasMwOkTqf6unyuLykfd254nkb7qsw/iVg7jhgmSX31Vpd9yRHeLx+zRhjEGRbB6wDYT8NdymyubzDzCCGfpMJWfSRYfr9HP/aMgBm7YoxNQHMbQHm+ID6aFh8yS93tAvGQb7da2gYfPoXgbtPAqaPA+a3AEubgGU1RM6B060fgkRoCzj+TcD+04CFE4BldZdRc4/YxlxgjJMewSiwN1zWfsOngdljq3EmY08vm5i/7j5yIMqpvupKyGoNg9lngYosl9wY/0dZdrMzYl8Ne8sAWNOu2MA3zw/F2CoNiy99XbvftrcLriz6PhsGn3U9cM9xMODObQYWCMANwPJ49UliuW6SaqqBn/gGYP8pwPyJwNIxwDK76ahDeN6uXYCuYyABkEza4LbpY5WEWdSLxjF26/dQB0SJ6r4ByAN6NQxmkWcqrnQ00x1DEDJFjR8CcNWGvWVPp6ZdMQ6OVOCb3wAscPJ6NCy+7PerkP5Q3tBY1PrT9tEw+JwbgPu2AlNbgVkCcCOwtAFYcgAuiwWlM/XqDjMEbP9t4MB2YO54YJFMo/5gHIcALV1TRZ17FXOhPtvgtvkqf9H4kvHDlyKK4l6VzvVSBF22uwjOb7pbw+CfcwBSkyeFEHAUx/yw9JTyEbo27C17Ol3aFWNuAlgIn9QxO2tYfNlbK6MvaxeMRYquvL9rTcPgJ30TuH8LcHAzMOugX3QALo21WXBZLEHwRF1OgHS2eOgbgIPHA7PHAezNu7QFWFZ7JnXJ5rnqxHEulvlzwyVNN3+wern5Yovl7SXLGwvn4riLWO4fgMRJXcPd/+pmOymELEhRzBxJAo9gVL4kwVnbsLccgHEpWi3epocCAMeBRU5eTcPiy/6qtl0wpvhA+2gYfO7NwOQm4OBGYGaDs+5ExYDGgqP+ccAkINaVpB8GTv4d4OBxwNw2YGFrxYCmV0YxLNYheCXau7EhV3ga3Lb8g4+R45uoGLADgHWqhsBXA8K1AZADyRvuvtkBSArh+i9DsQhCOtf0UUgW/7aiYW/Z0+nRrhizoxXwFhyAi5y4rGHxU66qAFhT3rDSIVdpGHzencDejcDBDcDsBDBP1uX1CMJRwFiQIBzxieL3KIY1YW5MPOxNwLRb8gs0aghAss1GZ1O+SFHsdRPt0i/PLHu++dFb/x4mXfhcbWxhfCtYMFr/uWvKxfDaAcg7ipPCvFOVpuo3HrCjYW/ZA+rRrti6TS6MVQ+L4NPH2nx698GnXF0BsKa8Iab4dFZpGHz+JLBvApieqAA4J8CPOQuOBBAOV0CUYbIskRkAecrvAdNbXc/aDCxSpyT4CEIyTgRgneiLIp3nP6fs+a4A4N8B8/48CUC+ZGJA29fpuLmxJW+5h5kNFg2jiWHSi0r0Uv4pCoZsxw8DUfnhd4Vk0XGdGvaWPaBV2hVjdjgA0BlpkQ/K9bmn/HOVqtClvKEBqlfD4AtmgP3jDsBxB6DA7tdbcvYzJvQJkii2n4NOeMpbgJktbYPGACiF3wFoEx1ZMNe/4jnPLXu+KwD4t/5SO/iMBcXuesHylyACMBPDgzGg7opM8mEHIGdwrfGA1rC37AH10a64Yr4APvvOSdwEPOVbKxu+K2pdKRTmdI3dqkPPVgbSTBGAY8AsATjWniBdx0QxJylOFCcr6HBiw1P/CDgU3EgEIMW52M8YkLolQRddIN1AyKWiBretf9MJQN6HsaCPxe4rvgDdHOcOxDIAcmDFDXvLnk4f7Yqt63gEIB/Yoj+4p9xaAbBHeUPM8qF2aRh84QQwNQYcGgdmx4C50WqCFngNsgSvQ+Dxu4MuiawhwIAXVk1O+e/A7CZgThY1dcno1nHL2oDIyZULpBsAFTBZ9pjT0QQgn2V6ufRicS8QRgbs5ZYpEsENDejBfpoLrwAOjgIzZMBRZ0AHoUC+SOA56xJwNlEyTFw5FxBPeWvlzpnbANCdQ1eSGTRybMuydgMggVBsKmtYoC6Mt8znZxsZMLzAxoAOvsh+ydDqtXx4FIDl8L/omQ7A0QqA82S/ERdTI22mNfaTuBIIxR4BhKe+y61punQC+MytI/Zz/c9EuvyBeetLAfGZ5WOMZ9j2/gqABB1fMLsHAVBqhfTcyH5d9MByEdzs+B50Z7voGZX+NzNSsd8cwUcG5ASRKYbdHRNYwhhDIHRgGmO0gFP+HJh15jOXjnyKblVT5Cbfoq+yJOszF8P8+VnNPlICkMAzds/YLxlYznrJwIpO6egTPMqA5ZNDAB6iCCYAyYBcBqTRQ0e4630SxZyQJQIvMJ8mSeLrYe+p/GzGfnTpEIBy6US/out+K1wg+brs88rHmDOgAVCMnrEfxxMte1Mt6j7u9zzKgIXzczEBOJIB0BnCJoqgIfDEhM58SWzJEPGJe9hfVH42un/Mfxl9bgSiBySIBWnAJBDGEDAB8QWFA8wO3/a+wH4+rg4RLPYLul8tCI8CsJmJMQAOuwFC9qMI9g9Z0CxhZz65K0wfFBPqu7PEyVdWAOTHVlTcpxhXHZLz1w0ZA6EDLhkCskRf0sw4dRYC0PQ/vVSRAYPo7QCdj7GqVOSMeBSAzUzMxZcDMwLgcKX/zbv45SQlHXDIgagJc+bjZBqAWhUoH/Y+B2D0J7rFa6LYDRmzomsAaOeKqxEvbWacHQB08JkRIteSXiSBLYJOLB+X4xrzAzY7vgfd2S4RAKkDDgPzNEAIxMASSWF38WsgkuXLyXTRSRCe/DduSZMBMwe6ObTd8JBj24Aot07uDObPP9XsIzUGFPs5+JJ/M6oT4buxHv9X7BeY8KgOWDg/Z58GTC9Xq5FxTXOw9c3Cm6k5fPcjgbHbgAlvVG2tH1T3Oavoq6BlniZ+12n5u/2sDbOvasqoFg8x2Lnbcd1GdhSAhXN+7qMrAC4sA8sORJ6yHwD28z+Ft4fdv8UyqUDrDmCEBcpZ39kLS6aq9l4D2rLb/KYsFTPWdfbvh86vQu2s1K/K+zIjTsXIVQ9a59Egs4Y6sZfIA/EcSp/jEXv8BWcAhxaA+SVgSQAkGAMICcwVlNLlqTc9Gbv/HAA7MrL4+f1VlXwrUq7SvCoyGcrrWpGhuur2fNGYwM8YT67hT3s1LaZvqn5MLM0bzmHMmIFSgdFNj/mIBct63NhFZwEzDsBFgpDPeanNgATfCtGsX9TIKwNrg9tuVkhlng7TI/YArX1VkXKrEe1l2SynN1RCsFJsqnQv3UIMxhwIRjU5AGN9QUteVz3BUAvahuNgjC3HxLAND7nBp/cgONXF5wCz8xUDGgCjKPbvevlzcKUHH2ag6cnYzepYBB9Zi2FxDJdjoXJv1WDFiLJ6MKqKZUzoQFTfj2HmwTKcTpVWvcxHKm6kKgoORAEvVclPD6NdzLXpMT8IYNPcLV7yJGB2AVhYrAC4SNA5AxKM9ryDPE5fs6eeVKWGZ2M3S3MQfEyJUKV8L1ZpJXpVJ9pLilmlAxWkVJHKwIhjjD9TtVXVm1HdOy/pJiaMFRWM+bo0rWl4yM1N7oPhTJecC8wRgAttBjQWdBBGESwgSiV0Pb9DRgu0TY19N+M1mRKh8niqFx3rRDsLqjgl9yaGXT80vcL1wnE252PAZCzAHQCoiqoW3yYWFIt664fUpKaREr1NPakH6XkuOQ+YDwy4FMSwgU8GSRSz0UJx3Vx/5vFNbrs/EiLRY+v4ACITww6iJEodQKwBIyBRv9vwhKzUW6z66TUGEwhDS3ezqusAyNxnJn8xa1KRPSFts9YfFB/QDZcAm78CnDBT5U8rCqjfc3yh8Gn/hGd/MsKf1+QzYJ4891Jye13iy1cAE9cDJ+6FpYrEkidxDN3OtXR+FwBGMezoMmxJLOumAuD4J4rxJrfdH/XCoLGFVKiUbw+LAPQqWWaMMLrd6/+JycSIm85w9lOpt1j1MwAwFTiqAWEUxeYH5ENn/jInUVHeMXQ/f/jRePvCa4DhTwLHfBc4frGqqaNJzLPw6iZxV+HTplFGvZrXZT45N39+HW3TujlZv8D6fp8HRq8Dts9XIOR5YtakgBgdrrrt5Qsq8Ssd0BhQ4HMwmVitAWHAY/LbLDQNQDaTVJ8Q6W4qVB51OOqDZDPVB3TLOBepW5jmqaLbec3jGgBGMSxvvemDYkQ9GoKF1ShUCSKCqBeQrvmfVZPC1keBjXcCmw911tTJ8q5XgOLaQgA+x/OdWA2EGZ98gbjleTHdQHQN+2iwls3nK3/Zhj3VeQhovYzdxmArSwQgDRA3QiSCJUrTnjfl4KozRCSCCeYmt90EoJJbVCk/1+FiCwFZxLk4dRfLFia6x8LbYkD9v9cXtLG6+O4AYQRfrgPygVIcqyhTXcWFOJH8fh3rz7EKwnUArq8mcGwK2MCC1i7WY7Zenh56feHT/jE3yliE4TZncd636gPFCKWavGhcRx2J+cvs9MlSw0Ty3cCm+c7n0G0MExdW4BMIbTXE9UCynvyCCX+Ovm4gbByA/xisVgJPpXrzLj4EoRJjJIZrWHArS9iprK+KcefgiyB0XVKGjOmCmW9xhRVMUSyRFnNeFGEdI2q+/HFXclkp9WsAbgTG9wGj08CI64WxRk/OTDcUAvBHXSLQxcVCDMQSWbzv+1e7WVbz+k5w2tJtsbcCYV6WJY7hmAsDA7r1Sz3OgOgoM+KTOJbcjSI5yGIaNE1uuwlAAU/MF+tF5/0sIghVLdVdM2S0bSzHx2Mi+FTxXf8X925NC4BycK8QwfmgVX1LlcFiykEMcL2BndJJ7aQfijKfxLGDwAhByM7aC5U4qwPzNwufNnNuOH4VZaCPlPo2AahqFqoPVFc14ga2m+WEEL0cAz9kdPrOmMu8r1o/rTsXz7f9oswFs+jO6LAqkvC3Ggg5Fg6mwW03CUI6X12h8lyfcz3QHqr3DIl64DbqaQKc9mI87QXACD6vpJqY0EVxz2CEyCI5eMSGX2e7VtI5J4yTRyZhscrvt1nQuivOAaNLlYESwcySgiVbr37Bfd0/u31yEgg2FVaiPCeVOguqAfGov0iR0R9JABJ0bnwk9nMxw+fOh55EbgRhzozrBUA1polN9CLwok5HEEUQBjFMQB7D+j656PW+IrJ8O/bBCo4sGFdGejqiyYCx3mKe9/JtTiBvmI5OFiTisg9LtJFF7gZGDrUbHKs79+hyu5hSaUvh1foFr3r/6vZJCiXgCDwVVFJ7MVmRLsrGltuFCc68yFdACMDAflwR4QM3HPoKgIExt4gz42SuaQb8hBOE2oZmlu+KFlKR3QSssMJxDPWbbjpfLoJrxG8CYT8MKGZSVTCxYFTIb84nkCxCIPLDiby30gXFghaF4c2ReR466Uu2fvoFr3r/fKAEFxvpqMcd9yonIrkuK5LLV7MVCM+/uDJCyIC2J8a0z1iwqyESgMl15Sa33QKgmtPEBnp11mwuXgO70Ud4DHWzfgDYC3zBEOk7HlA6XKyHQzb8HgGoCSQLqsxorIy1Bxie7Wx0rFaf+wr9Xv32C+56/7HbJ5VHtRYT+GJrsehHcya57PyKAQk6+vBkBZPpjPEExlwU59awg3C24W6KBsC6tqHR+MidyVG3i3rdAnAsH2T093XT+zLr197MTA80h3SfsZP2UqpCrPQ46oF317VrpeiKXTJ9MhMLkgGdCacKG/mupV9w1/vnwyGgCDCKWzJe3lqsyzLWZWe6/kc/oKzgKH4jC7oolhdC4jiuzM0WPo+cPQ2AsX1obFCTO5Jzn566PwbReiwnfTWjI4KvDoh1juh+aT+WKSYD3i8Aql2rJk+VsVQly5kkddv2FvHT61icqO7Fr71/IkLNXOi0FQjV0046oBy6wZ922Q95ICqDEaL4XWw3COcf9Mw73DFB9AqE6wZAAS8XuzGQIDKf+oVkqxt00ttAc+YT0PJ9qRFSB8xoye5Xu1ZVeCSgCLbYLVNswoncHxoeLwCzBGjBNki/4BX3z9lXgUCyIIGmhova83cRgO5Te9yLgP3MfmsBS8xs8/U67ePQOqy9umBUruDchqo8sHSd3PMfT5ifo+ack8eFHI6QEcnT5GvdOnVdXof+ptJ+BVPWceiaRHA8Us/nkACo8mzqlqmWrbFDppT5A5UIZm7CPA2Vgm3QfsEd909kKIqB1qJAKCBG8ZstZz3xHOAAiwmpDIdng1maZQAkZzsHZ537YfQrwNyxoQ+HakrnS0h1mUA1C96TdJTmORyhC3oeqdwROi+GDhkFI6bYNrcNDEDeAkXwQizPRpmnIs3OdqZPSaRFUcbchHlgie6agq2kX7Dd/+d8lUJVXuUzk8ERmS+2vfd4uvN2VOV5rSwb0y3JhgIh9wJeN3YMQCIgR78Q+nDEVYBYZUrUpbXFnM7COSdf7N4IPvtDnT2BY/h8Chh10MXQeYGS+7GGjaQiABpuNIFiECnzdWJMIUHcazLptC7YivsF8/7FgLFMqpiQL5TuNbKfA/DC46rqqAbAwIKWK+timRUBEiNGsOQsyQm+Gpjd4n046hbT84KPuYjOmHHyp92gcgDS2OoIuVIeh/xyUkaVwyEWdLrewHE3uBUDcKIwnq40HpDXL+n3CzbaKdguel5VnFJl2awaghLQBTzteZ0cjLq2A2n0M6EPh2pC57Wg41poLzZsAZNso0Hw6eVR/J8bF9YjWGmVCpGKwQLBRCcrbiSxNLgVAxCF8XSl8YDHHFPW7xeFBRwv/rGqOKUBkODzqgdWPYAM53vTASMQu4Bx9J+69OHIF+N71F1O1gUB+AsBfFqKC+4Wi4BWX+CYgOTAU36wdMVNVKka3MoBWBhPxyiuko3xkSX9fvGMkqsDlzzHC1N6SQ4DoINOe7KelWWTheziObeKCdARApD1AdVnRH048gKUAmAEYi6Oh4DJV4VoGDWqjq4XLbO5o1jBoimEPhPJmwu9FvnTLgdgYTwd2wyXbMyRKen3i2eXXB245FlVYUpVxUpGiLtmGBlrTEhVUwV8dEkVKAq3MHJ1uzRbRx+OOgDWFX6MsXJU/36lJoEoA2AKvw8+uwTEDIBbStdOs8ddDsDCeDom7ZdszBIs6fcL9ror2C75US9IxJJsEsHdGFBil4yYuUwknofJgF4XcEUfjrz+X7fKo4EJJ//PkMORO6FrVjQMeL5kJhZMMXzLwNZCt1nzDFgYT8cQwpLt4hDON0i/X7ys5OrAJVe0S/ISgFY7j9ZvnQ7I3+lyqpYaL98CWp/N+nDkZdhi6bW8An1kP3fRTLKVWlwF6RZCH2L4zDDR0k1IqeTNb2OQSYNbOQMWxtMxeqtkY6I+ny9VEz6btfb7xc+XXB249AoXv85+tIBVgJJ6n4lf6oV+mfjdDJNMH0wAVFX90GMk1f5TxlS3Fggh92DyN0IORy5665KIfCktsl+K3VsGtpVOWOMiuDCerlSnjQ2rB+n3C+pIBdulz8wqonrNPLKgwKaC5B3s53qhXVq6oDNg6sOhqvqhEr3V2VNLBjmnSSNdrOLJ1zkAu6VPRjFcFz4fXDJ8i45hG94Gt3IGjOFYA8TTlQZ/qGH1oP1+8ZtlT1MAtHK8mQg25zOZUSCLIliWcbw8wfW5Ln04ssqnHX04euiCk6/3de66MPpuAQVZAEFkw2MKFw6a1wEL4+lSBvmAOMhD8vkOkFX77feLNw14YT/ssmc4A6oOdHBEkwXlgjH2k4Nal6wB4fIuX9LzZjAmorNeHMo5Tc0OewHwDTUh9HXxfGJsYkAbAAAgAElEQVS/uvCpoAcew6zBBrdyBlQwwoDxdLZWXLDFkHyF8xGE/fb7xR8XXByAAVC1oB18HQYIT+8uGfP75SCUs1o64he8v4j6cIQ+IqkPhxrBCHjdjBH6AblQkAeY1ondukSiELmsUPpjbyp7XuvDgAXxdNZVvWCLIfmKg6Bbhrjup98v3lVwcQLw8gqA5v9zC9jErutltg8gMxDWWMBaMVkmANWFyEV6R0uH2I1IzW7ypbkQOTP5f2ch9KsFkwp0kQlDAOmxzHpscGuGAQvi6VD4RgmAg/b7xZVlT5MATNXwqQc6KGwf2U2uGV2uzg3D4ua7fDnPwZcKgIdq9GaIBPZb0YdD7hgyIFWMXiH0eQ5vXS5HcMkc++9lz2t9GLAgns7KxxZsCkgdtN8vWD+vYDMAUpcja7lOR9eLVcIP4tcuob/3AOHCdW02VTX62ApB4Mv1v24gnPy9HiH03fJ366KYHYTHsgBBg1s5AxbG0+HLZaOp65i+ln6/YM5EwdYBwGj1cmUkE7+8THLNdAHhwrUOXtcrO/pwhF4cct2oN68BMDCfmsJM/n6PEPoYPp8bH3kCkbtjji2tJJA962YAWBBPZ0WBCrbYsFoOf9pDAiENk179fkuvf9nTXewKcBSjsn7ldonWbgQpx+26otaLIwAlfi2QQSJY3Yjy5i9dmsFM/oEDMM/Z7Uf0RiYUA7J+ToNbOQC3e0WBBm9qLad6HICG1ZK1XB5PoxnuOOIcxSXe/Of8xHV/P+FpwN47gKUpYHmuSve0pKZgCKSq5wqniWE1WZz/xouBm74KTMwBI17lVBXwtWSs+8/vL45Ff3vhpcAnvwos8d48DZX3M2hx9XIAnu0IIO0chu35AOgLL0yuG/jOmwbg028G/mNz1YWdETbm4I5BrFlov+EtD2wIo7l+Atg8D2xY7iw3V5diEqO54mnj6XdMAYcU+6gon7A3NSO2qFjlyZYDkAX6uD5Iam44YaUfVNDNxaJcLIPXcGGpfi6PnZdVD1wPspQBX/wl4OaNwN6Jqg+xwrxslcVFuYJblehkcYYZGPS3L20BxueBcS8nwg5H5kZkx6TQSbXFZcCQKadx5Cz5mPurAFxrRaa17pAR2PFC+ElSHKQ/0QjQcgCyGyM9v3SnsDBRJgL6msWCf6IfWeUJac8UFlpY8500DcCfvgb43hiwZwyYVhd2D/VSrKGAmIDnBkiafEcN9cprHgKMzgNjS1V7rRjRlceyrqif6KAkMgXIM+6tAnDl+zSL36O9+U8p9jGHQo285/2XA/AnXeNnKAorDXH/AILwbSvLEz6Ql2+cAf/3XcCdw8DkKHBwpOpFbE2wadzIdyh3jjNQirYWEwYq+/zJwMh8pf+xKNSwM6DZMmzNRRbM2K+2Ii6TlFrAWfd5V3i/F7IgT2LBF5LbIdkqxLPWvtzlAGQ3RpU3Y7AiixMxLOUB2t7pKQ8M0qCTnp8HkojJgNqaMEJesQv4AR3Iw8DB4QqAs+6SWRiqgJgY0HVDAdBA4Ba4xN7ndlSFAAjAYX4IPO5dBDMAdS2i+Jx7XTf1eEdTDfgAQnR34p/wQkRmjNAoByDT/ugFphXAmjAEn8qaPQAgZCs0lSckCNmVigEbFMsPBBE3DcBX7gLuawH7hoAD7EM8DMw48AhATrjtQwiXoqkTEwWd7LOneXNCbz6Tiq/TInb2M8ZzIFrTQbGiy92oGz7pXl/7jvdAJnb2470IbB3T77Sai+hyAP5voTqW6sKwFAc/TAdc5+3dvcsTrvPVYSK4SQb8xV3+6IaAqSHg0FDVh3iOIFTIFxtit9orL5Z/LD1Q4s+B8OnHVuXwhhdd5DoLGsgCCJ04q66X/Ju/vSaeAxDPvbdtmdtKDV90gVEPIl/xySkviOhmAEjrlzSkwj40SlQZYZ39I+8JBMx8mZryhOsKwqYB+KpdVSDFvhYwPVR9BD7uyX4SwRS59nNI+bRck/DzJ05v12M0nY8fAk8iWL5BB5qASPGRCi8EVjzv3mqpkC9ACrrwhKukB67GhpqRRowQMqCiYbj8oOoHeUWpdYIBAUj8c8WjrjyhNIJ1unzjDPjqXdUjJAAP8TMEzLYq9uOHICQALe/EwWe+QgddAqCzzD8+vgIgg0qp+5nYjaDzCgjmnCYone0klqP4JSgvvK+6LoFPoFMlkPGh+0rPWta4RHTNJJQz4M8EAGoNTPVU8opS64CC9zoAWTFChcq7lCdch6s3L4J/2QFIEBKA1P9mHIBmhPh3Ai354RyAAmWsR/PRs6vOR8Z8FMPS97yxtIlYgVB/I7jC0rIKSfLXF1EEB+BFFjQ3jCLA49OWsRTTEPzvzQEwry7VrZ5KwzAQAPssT9jw1dcHgCrORQCS/bgn+1HsCYQSveaHkzvGv1scgU/6R55Y1YIxhvOm1EZekQWl8wVDxJgwc88QiJc6AKX/meHDawX9z16M/Em7bO8Q08GBP/jEkAEVjMBoAFWXUjRA3KtNwOBXW3EkAZhrALktpC6lKtTV4OU7RHB+3kHWgv/zrnYZl2kCkF4uF8MGQGc+MqEYUCA0n1tkwxbw4ScHAHr71Q7W4++c8czwcBAmHVB/c7Bcek9b3FuwbdD/kjGWgzJjQ3thGmVA3jhfOyU+RxB6FamOFp8NrhsTgLy8Cpzm5QlVptAU+6CiNgXCaIQ0BcDYV8b0P4pi30vfIxD5+w72C9aliegW8MHzqrmh/meuFhYi0pKbs6D9fsh/n1XFMrYMbPgUByCZz6J+uEknDA9AornWFRb01WZEsACoHhOqyC7wdetT0QAK2KqOb5MCUvPyhLE0oQxzqaYNXL5xBvyVXe12vByLADjXAvgxBvSPGFGMIjCmJbEW8HfntxtQmxT0cmxp9UPAdKAZ1upA6EB7qgDo6oCUxXRtPVSpAwJpnUhuxAqWCCYK1MBExZljY5S8SYr+pxAFAuBayhNG26jw8usCQLX0SAAkwwcAEngyQizaXoziIli+Oe7/9kJvNk1LmBMe9ECO3XRB7aPeF0EYHNVPdT8gj016YBcWtBfBVYJuz7mF7VgGY/pO8f5WdQ1/7U67nIKNS7j0wIbDPFZsyNHHY7od/xdlEHj8CcC3TgCWHgGAPSxiSdt4312u/8SPAl8/Dlh4pDeZW2PD4J1c9+uyDaIDkgEJQKnTfG/N8nUAmu5HUnMW5ARbPfEuIHy/ACjRK7FL5pOR4RaxgTHofKl8r/S1ZWBnAGDKefbn3AFIPRPXB7sFiVQimKVgGdl5ooNwLQ1/1U+DQGSXQ9r5Evy1q9rZbP1lGQDZsPpzI8APHgXgod7qUx11YtBbFzC+/C+BL7SAWwhgdoLkONSLqy5oLogYft3ZI1F7EAC+phsAnekokhP4HIzml/PvthQWmPB9LJ7jxkcSr14jWj4/0wFlgJD5eoDw6fe4DzAYPHokWhHJZ3TFSkn4h7YOSOBwEtiMTv1aY0uktFYTmI2/43EMQmCuAJmUE0gmVD8EFdPpdnxhVhqzDr8F4NMtYM9Jfg98EVTeNu9Q2OFZBX7vr9vtgm/lcezczZ61ZNN8DCvilYCdPXqNDQpAlfGTKm0M6AA0PTAyoMSx64cRfPQHXsniOTI+fEWDFGp+Qb9BeySRBV2kpl0QxxGAlHDmkI56X6z+EP7UDYSdRgh/IouwIZ36lHabBE0GJ0r10Rgb/xA/tt/j/6aMAf+7R4CxzuBXWRGULwBfIrY6UNfpvLae7n0I+LO/reoLMqiVMbW38oUhkNkQIzZO7tIweGePcmWlAFTjAYHPVGwXxWoLYblEDkLuTT8MDPhXLJ4jALpaJB+ggU6xfgJknT7IKXIQXh4Y0FZCog+wxiUTwSkXUbSMV1rB/A31OXWuFpPUda/mRHKi1e6U+hA7Zq7l+A+UAfDtHg/LrptkQpZ727cRWOL9542Pa3rOvuOqagUltgtmJM08j4/PILbIDKz6w5PAHsbraTnMGdZWIwIzxIfeK0rn578J3LAVuH8CODRahV/FFQ/1IumIvXP1QudNfyNT8oVqcHviPcBd48A0g2RDuoDqHdb2SalZAdG9dnfDkAE0gXnH5ijWCDbKCq5/MRiV0QD8HgHQ63jG0hdsLGxA3x9Bw1Asli7hO3BwApgng/Gjvq01IHrXJ7q3Cz7E++YziF2rs1ZLZ+8H9jJsSoECWXj6igmR87aLgfbGq4GvbgLu2gjsHwdmCEIPSI1h+SkCRjpfUC3iNWcpoRrcnrYbuGsUOMBo7QBCxSTG/igxVcBIVGPWM1h1JYQPnyKNExGZMDIJ9b66eEBGxPDY1Y5nv+GCjfGAxD+DDpiawphABWZPjwNzNLAEIH4XCH0M7/5c93bBfI8Yk2cgVAdvdT10ifDkBWC/r9lGH51NhIsnsWHOfPmEUKT94WeAG8eAO8aAfWPAwVEHISNQlKQUglJjJExqC+H6Nq93kOpUg9szbwLuHa66QzFWkaFieXxi6hgVHOMCYGRuJ+5V4jYJIDKI9KlsAvFDq8QDrnb8NWVPh9EwdFkQ79TlSMIsN0Mi5s9MoOGno4U6f3YAvefL7Y7rvdoFLxOANSA8f7xSgWmd0kCQbmZ6mTLEnJ0UqWLhUkxlrBn6n3wWuGkYuGukCsufGq2iojnRFpafsU7MDxErJuZhYCsJosHtWTcBe1oeq+hxigJgXBrMmTBPnJKLrr+VED54ibHYvZos8sO+DNcrHrDX8YVVyglAKud0LtMjFPtNMz6QLDY7VomLJd671AEH4Xu+3g7nWq28ISvX58/hguOBg8vtFQvV/hEzxfqOevuTfpjri8vAWz8L3NYCfjBc6ZYHmBcitnFd06pxyb8W4gPlgonBqffTtdTg9pybqiVNBssyUsdUD7eGO9amnf3sXtxQipl7Wg/sD4A8AwHIyZMYky50Tp/xgN2OL8y051qw2hXzwRCEdT2nmck1RxHG+w5jeO9NFQBpR6ldMIMXlFWgVndqF2dVFsJzuOgRwMElB6DcI6rznemD0RnbwQiSRS3g7Z+tVIl7PC9kahiYZm6IizuLigliT/VoUog+p8P9l3wJ7qGEanB77k3VczroUToWLCsABud4ypaLCUoxf9i/9w9ADiICULrQRWuIB6w7nuZrwaZwLBGwClSqSyz3AhHbaRGEFGOmC44D72UVgjW2C2Z4lIF4ArjodODQcqUGqAxfcpG4mJVuVqcL5tbs2z/veV0tYK/nhTAqesYNHdO5PCJZos+WuzxHJIViuXFyJxupNLg976ZK2lizUKodilGUgzyGhokF8yw5Mf+qRkjdjfuDtwkkm7DTkNaBaQ2ox1q3eMD8+B6O3H6em8Kx1Ccx9ptWl9iYIUAAWrI3I3nHgPdOtsO5eOuxXXBdj0V1vOL/so3Cxef60tlSpYwveKf0pAu6ohfdJ8k4CUqgvr5jV6VGTBKALeCAh+VbZLTnh5gu6D44A6H8cVlkNK95O1WkBrfn31R5HSy+JCwPplAxRegE/2T+AloGncNmbQyogUQx/KwB4gHj8YWNTwRAOW0FIIIndoqNkTAxz/bd09XDGLBdMM6/pLKi5whAX60gCK2ujxzEAqGL2pQ1Jis5AJEAFHvTujYAKjRf+SEugm1d2COQLU/DAwQ44caEw8AtZzSIPgAvuKkdrWMM6M7xCMBoiBn4YpCE2NCfxWAA5MEuwvCCEICwlnhAHV+YORfDsWJGgPpMKwg1b9QpFnzHbD2BK2JGul9s8KkYW17vLALQRTCBpzXZpS4gtCXXMAkduuAy8E7PijPWprXJ5CR38ygw1fJDohh2BlRAgq2OeN7uTWc1D0AFNtmL54ESBsCaJcLkDajxj5ZXRiCIGA0waDwgjy8sk5+HY+X9ppUbJSCp6TnFCMXwny1WAFQ8rUAc2wUrRL6mXTAefWnFfnz3FpbagQKLAqAzoZjAKkkpXkNO5GCEvOMLFXOnnC4xIKOjnQGNdWSM+GqHQGd7JSsxUf+JzQLwhTdV4je1nQvr1MkPGtlf9yP2Dy+gAqZ6rQytfvdHSDxgLwBF8AmAYjHWluEDiKGMiqOVvtejXTBOuRSYJwDJAARgZAGWL9Nk+IM3SzgTydE4eec1nZHbtDaNAf1Dpd/SMx2END6kD0oXtFhBXmcY+OY6AFChnKnzl7NfdMR3qCAae2B+VVMYXASvDs3/X/zHJZcB84vuiqABEo0QPnhnwqQLyRURmZBPytnwHde0M1vN2lR6picoKULaxHDIEdHkW2iWg4/7b5zb7DSQAVd0/griV2JYojfpwRGEYsGBrOBmx/OgP5sAKANkcbFzNWTRnX/GSGImMYH/LYlk+gGvdT+bW+SWH+Ig1GqL5QeTtR2EYj5LVHfjw/ZDwL8yJ6TB7UU3VVoTjTYxYDK+Ivv7dzNAZIxpZSiU8jjKgIWTcykZkBawDBBnQdMr5QeTKI5iWCB09AmEb7+ucnOQ/aTPWn6wuzyS4u+R0Ob6CUGqJpIDA97AdqINbgRgBJ69CG4Jp6q/ckjXqB/RKla4WpkO2ODgHoynigA0JiLwaNiEt95YQKJ4FRC+7brKzRH9jZbN6iJYuSHm9I5iOAOhHNJfZkh+gxsBKPbLu3+JgaWDdojhMO5kkDWSlNTg4B6MpyIAjf3IggJgMD4MCARjFMU9QCgAykhSKnUCYHB9JB0wy5aTRUxmup4h+Q1uAmDs+hpXgFLnB6ULONOn5xACNJqxghsc3IPxVBGAiQG9aLeilWUJW1FvVXEN0TKp1C6At19TMSCBpz1dHtT/JH7N9yaxp6QkF73KBxYIr10nAMproB44qQGTj6sjUrtOFPtLeFQHLES9AdDFrq1E6M13MaxVCTNAXNFThIylLcor40zxtgDAPKuVwDMrOKw+SBTbtR2MND7sZwC7Qvm4wqHa4T/uIrhb+7n0EgbQdTijoyg+agWXT8llDsAFWr/B8qP1K7bT0pvtVwHhW6+t2C/m8svvZlawi2CKe37nhFtapkDnILRqBQA+v04AjMyn79EIkXO/DnzyCBwVweX4wxs9B4rRZgyPVFqykgDd+5JSpBU5r0vHyHz+jsc3ub0KABsZMCyQgeExKyFPVIz3lmcM6OfPAGCADYPE67Jfs6h7G0o+xvi7oyK4cLZfOgpsXwC2Lq9MwuuVERonKn4nSJrcXnQKcM7dwMMXgYcsVxkSebJgzOWPqdB1ad2f3gpsnwK2LXWeR9m3danUIV1lBSCPArBwtp+7DThuBti6UDWDmWA/DvXk8LRptfPtNUlihYZTOPCi04GH3wFsnwGOW6iAs5n3GeJJ+KLoE+9VDClQ8R6vOQHYegDYwuY3S6H/iJ8jb11ck0q9Qhoc9QMWgPBZJwFbpoFN88DGRWBiqQIgWyJY3lPozaGJ1KTEPh36zpTkJrcXPRE44S7g+Cng2DlgyyKwaclfFoIwvCwx9Zn3Q1DmIPx/2/sSaMuusszvjfXq1ZRUElJkKsBEGQyYhJCBSkUqAW1tsBdpuxEVaBzowXZqe1g90G2LotjQdmMjKqtBxQERdAWUAkUlZNBGkQRNyIAEMAkxpFKpqjfUG3t9//m/c/+737njPq9uVeqcte66b7jnnn32/s6///3v//++Tz0dmD0KzC4DM6vAFpd/0L3Gh6yTDgnvLwKzAWDGiH/ThcC2OWDrErB1pRgQisIQhAa+AED+HEEY6uNLyrRnZLSl6tSbrgLOeBQ44yiw8ziwfaV4UGbdegmA5QMTLFlqsfn7XecDW+eAmePAltXiXnkuZSBkRcm4UGXtU2uo3xsAZgz6y54JzMwDWzkgBOAqMMVBCSAUObh8QuN/CiTgcWAuyWhL1amvvBbY+VgxbW477paa7gIBqCnUrbUBiQuhAKDUot13IbBlDtiyBEyvtO5VDxvvVfxW/JkWNFrCeK8NAGsY7BsvKQC4hQCkJNaKy2LRIsg6SJ3IQSe1onKKC2CsOYMeN+0Dtj0ObDsGbFsEZmWp5S74g2Ir2uA22BScAJGA+dJFwPQ8ML0ETAUAkgDTPq9zdK/+sMWpPF19NxYwA4g3PtsHxAE4SQC6FdSgmGWRRIJLZJll8EGKjHiX1jwaN10HzD4BbD0GzC4WrsKMW2pNobZoCu6CLCDfCTqzgg6sr+wFphaAKQfgZHKvpRSYg7HN5XCL2AbAZwPrZGaj6ippXhgn0kqmU1woxnHedg5AATuWHig2FE1uVRwoxoX+Wcbg89S3AqCKPONcCi8oPtVP+9++G3j+oSK2xRBFDElUxbTS+3nvc4FpDsjxllXQoJg8FgdCQoGJJTTicLcQ6vPL6wbg9cDM4cJv27oAzFA5ky9/UOSvmg8oP86n0dICBn25JwjARWDSAUgBHN6vfdbv10AbARh8X91vDM2ss+NvAECKPVLCsHoyUgRqrlbnRwB933OBc+4DXrIC0IEmiLnE75di8HsyAcjzWUVGUi6uICMpVwwJVMXdeOk3XAxc+Hng+vV2esAYw+sWoP31r3eLcLwQBeQUrEHh4Jo2h4vDmJPuAyMLGAeEn7uqbgB+I7DlSWBGCwe31Gb9aL20kGDb/EGRxY6WTz8f2wtM8l4pgL1SgM8esHCvsuylME4nn9cfQLtldg6TZ0kUKorAfij23vAPCmqp3fcCl60XFINid1PlZrf41/dnApB6wSQjutUfIDJR8CGIQOwWEH7DywpKrWc8CFzqRLHkVYrB2jS2FQH5vkuBycXCAlIUUAAkCM2iRBA6+ARCe7DjYmQduLYTleiQ/XTTS4DpI+6nLhZW2nzVCEBaMLd+soIGqjD1ampdugiYWCpeBKA9bBJC9ActAk8LES26SqsftInLZ44dQif4Igdhym5WLrPDyuYH/7HTCNwDnPko8LXrBccjQaioe6BiKad3+QY/MGTH6rS3OBvCnQDuAIyqhiDkQ9RX+29yE3on8IwjxQPI8zkTiApGU3oVkD/4fGDieAuAdMw5MFQjEgg1DYsUku+a3uI0TGBfV7PotwHwaOEmbHEATvuDIutni6UAQoFRIFRYhfe/dhEw7tbe9Of0Si1g8HkrwRcevDajz07gIJ7n05rYyWIpb4ya/7vv8PRdFpj/LXDmkQLAnA4jCCOlTBRN/rFMAJKgkkVHpGUjySSBSFeg7/azqk8EgbSEq8UDRACLKDXSyaQ7Br//DcA4LSCtwnKhTEkQcmAIQhtM+Uaajl0uS9NatITXWzpzfcdNB4DpY+6nBgDaCtanYLN6fCj4u1ay0QIqtML/EYC61wSA9tAJeP6eWsAoDysFpg1eB0HIQRCIIkVeCqQf/05P3WCB+UPA+CPAzvmCaFWDKEuYcl1yMN+Y2dckqGTeHPEvvWDSNhOAfbefX0A6rS8CUw8X9066bFIfdqMHJID++DJgLACQumyc3gyAEYRRKFCLD1eu5ODLF6QvXedx0w3A1BwwxdAJLTXjd8seQnGrZ9bPFxLyA7WIKON63tYtCQBN/sv9QPm6BkLp0vl9t/m6ietR6fbyBA4gnXtORwRRpNnTtPpW6gWLH83lKqcOFTEnDiKtoHwy8RNFhrefyeztbnrBfbWfgttsP+kIyO32ELD1cHHvInrlvWs6TsnB7qAUlg/suFtAWkE55zYQ0QpqcALoNCXTEt7A3KoaDwGQfqoAOEUBa7fUbKctltwCajVbxvSiyvoasM0BaBKwwdKb9fN7NfcqBWGiSWykWXER0umeacUEonQgCKRfIgDFjya5yq8Wfsfs8dYgiuMxgpAg/vnMzu6mF0z6Zj5APdvPQec0TEosnvQosGOhaLuIYvnwEYSithE52F1XFAA0p5yigD4otCqygFKnpHUpLYP0OcKURYv6Mj4MNR433QhM0gL6QongawOg+6rl9CswKoSkEIxPyTsuAPigCYBmAXVfYcVf+n0SRYw6dP1YwNgHsgSajiJP429RrpWOM6cxDiJB6NINM4w7LbUGMQUwB/M9mZ3dSy+YVG0EoBiDBST5ddZ+PkCsAiIlQZDa3LVatJ0WXG2PbL98AB+4omB3oP/HgTUhmGgBfRqWf2TTrUSjExDSP/qWzQDgfAFAWyzR8rkFtDAKX75jo6nUguZxZ8NByHbvvqBQ36T1swcsBaBAGGRg40Ir+rt9WUDhQ5ZAU7Es2e9LLzglqHRxNkbeuW+oQRRls5jaMjnK0a9ecNf2R4LAwO829kQB3LTtEYQPUwzQAWgW0AGo8AQH0ljp/V17pm0KRcEifGuNOnocO1rACQbKPXhs8TtNwVr5uh+n6Zf3wDgu29g2FdMtOc8B6PdpFj08ZFrplw+ZA5FTvAQQ0/BT36FPDkRqBT9Jag7xYlQItY0f88j78sZzCcKPZlrAQfSCK9uvB4h577SCotUiEJ8opq8IQFl/PUBPEoBLxbRE62LSqG4dFB8r5bHcOtiOQSqT5T7RKzYDgJx+BUCCTxZQCwhaQc9oKcEnEBKknj5FsJ1LAPo9xoWWPWDy+6IIoqbeaO0VA+zHB0zxIQDKkn1GgtXiRxMIAx0Vn0Db+lkuFjLRCt5WEwD71Qvu2H5OfekD5FaciQay/GIbFgBXriwAyGmJADR1ck3DwTE3TQ4B0LetzBJErTYAr2BBSI3HTS8tLKBZPo/fWQDZp197Z3scjGb5BDp/L3+njMweB6B83Gj9wj3atOsPWin9WgXCFlVO/3ctf4iD8XkBkH5USlAZlNPZAQqARr5vxu1yjmH0givbX0UQKI63o0Wun/xHuR8E4VnPK5JQLd4VNttTBvK2uoiKOUf/f+GjwMNBh0NMV6J0c0NpcRv7mrYv3kh8/uHxYp+bVpwLp3R7sts2YzouSq3KGa+q7+x7Co4nazAerRKsVlV1QitF59dyyFZaYY0HMu9mWL3gtvZXMbymBIFMZ1ov2h0B+LTLisxgW+Eq5uU92iZ72ud9vvR+4JFp4NjkRh2ONi0OB1/UBCkvEYRhfuNs4OmhhiPKnFQlx6aAjMnSXJUAACAASURBVPjmz1w41nnwO4cCIBvBwZgTAOUHRq3gyDExD4zRGVYEnpm5LqmQc0M5esFt7acFl0SlHiBxuTkYxxdaihUC4QVXFu5FCUD5QtJl85sjGA0ziQxqeu/fem+hw0F2fLLQGxFlYMRvo7v1WmIVtpt1DFkXvOR7LwJ2HSkyoZmEypoVVe8p7b6qEMnidGG/Vl/L2aPOIwuA1pAIQE3DAmFa4j9f7CPaFpCHKujr5xzZesGdHqAqKz5X+FLRAl58le+jui+kTBALMcgZ73CDBkpN2/7+bfcWOhwUyCEAjQTcAVhKdjkPc2RajewKyu/n1//qJcA2uhBMRGXQOcn9U6JIOjXHQqSYOsVoQp1HNgAvz8yny80H5PVz9H6RqVd849WtXQ/zA0Ow2ayGLJ474L0G79vvbulwkJi8BGCg4S01SKqofoNvSIC+5zkhFUupV8rUTpJN06KpaBkFQm5M1HlkA3AyM5/u9Zl38zrk6f0iU6/4hmscgK5ISUtCTowyDqb7UxwsqFJW3fo/vbuIBJEZ1YRgyHwQKNi0KEl1OKTCZJdxtPDn//v8ooaDaVgqFyiTD2IKfcjZS4Fo+7g+HXOPv84jG4DIzKfLzQf8KVfI/FNKrQ6h94tfz+vOA9cGAAbrpylY2SDlVTTt+uCnV3/V3a7DQQAysJAwobZJgUXi78Qayhd812WeiOAZzEyUiAkHMeu5BF5FwZQAWLPwknkLQy9CrPMy8+lIHZFzvN3T+YbV+8X7c64OHHix74V6zIxB+RJ0wQ+UU992tYoFy3fcXcTDxQkoPsCUhFIczKVCegSg5B8A/PILN9ZwxBSxtiKiUAOi7JW0dLTustF8AGbm0/1o3vjjnSGdj+lYlGwdRO8XN+c1wABIoHk6k61yuSCJITq3jDY9Vx0BqK++uwAfX6JkI/hME0SC1EGguiQ+isqcQRLrF6/0jO2w+6FMnZhyZYsQ1W50qOHgPX1NXndtODsfgMwHzMin+0+ZN0S9YOllMzWfLwKQSS396P3iY3kNOLDPM1y065H4gOW3p4uTDkB8zWdb7FgbdDhEgJkCUDRvogTmd/vPv3BVAUBuvylNzAAYi4hisVQnEHoIqWblrxqm4Mx8ujfljT+YjsWBYgIOc0oJPsq1slCpH71fKybJOEoAuuVTRSCnYlmU6P/Z4iSJEcbLv+Yu9/1EAh7JKEXDKxq4ChUiKymRbwjgHdcUWTARgLYXHSr2LOU+BV7MVwzxwOfkOWybYAGZD5iRT0edjpxD6VhcOQ6j94tP51wdOHBdMeXa9OqWRcmWXA1XLUIUH6zyCwlAs3z+YBkfs1u+VIejJEF3ckrjI9T0y/aMA2+/tgAg08VURKT8vbKMUgAMIGzzAcOi5HknHQAz8+l+MW/829KxhtH7tTz+jIMAJPCYMULAWd6fvi+EY9ouoZBM/Kx/4LUBgFLgNC5o16FrE8JJVJgkiFhaQQBv3+dVbMrWVsC8UxFRkjjaVsW2DtRdOJ/vAyohVYK7A+bTvTdj8HlqTMcaRu/XxHkzjgNkIOWuDr8jnYYDKDutgpUhra0uAlAyCCUAK8BXcjBXgLCk/h0D/hcByDxFAdAzoFUqUBYRJTUcMWdPP7ONL6i5bLQeALJRQ+bT/W7G4AuAOXq/lsGdcRgAY+glLkYclJVTsa6ptCX3uQjAKINQstFrAZKIwWxQIhIJuovB/Nx+r2LzFCwlj8Y0evl/MYk0kieVtcvrwGUnHQCVjjVkPl3mItQsIPuElx9G79dOzDgMgGkAWlNyBJn8xKprBRC+zgEo4LWRgcdVcOCjjlNvmx84DrzNAahaFZWLygKWxUNibIhTcPD9BMLLa65bzreAMSGVoXvJ/Cgh1WUfO+XTZS5CDYDs9GH1fnOrIDcAkABTTDCCLYK0Cwi/586WcKJUiEpC8CCBYDsiiSplqUIUmOjf+o2tIiKVUJbgU5uSWl4DWwX4+PcXnrQATBNS+8yny1yEopdcay+930y5YhgAg+9n2OoUeI5TdQer+32fdhmGoOBZanBo+g1yEKU4dYgFSvqB//vZBIBt9RshkTbW8ZZZ2hUgvDL3iU3uux4LSBM0ZD7dPRnTH08VAIfV+2XAOucQAMuVcKfFSD/+IAABsEoGwYAoHZIKEEYxRIHwLS8pUuhjFVs6/ZZhIVWyxVKBBIRXnbQATBNS+8ynI4tBzkEACv+chlUVIKE/5cRGsWmlKfIzudc3APLQSlg3E2OCyVRc1kpU3DgBmKoQsWtlBcswjPu+nfTYtBL+GQdgOf16GCZW6pXlBCqWSgqJypoOAFfXXDifbwFJLvi5HAjlnUsiIe6AjOp4iQNQHRlT2PlgJCUbbc2s+v/hFwFb/q7gm6HlYpBbmTV2sscQyy/qFBj2v0/cAdz/HGD7NDA1AUyOOU+1CwWOewNjKj6/O03F1/WuugW4/XJgfBoYmwDGdH7IxB5kLPIB+I8AfNwZgga5ck2fJbEm8V9zNWPfrasbgMuPAcuseJ8Exsb9FdBhA+7gaQNKB6TfcgCYug+YJT+g89aoBDMmIMScP12uTKj13uDv8zsKig/uJ1uQOsnojm3qB5P5ACRBH3OhPuzzRN9DV88HqQLEWPJnvTy5nm/t/1s4BcuSpRZtGAu4fi+wtBVYEyccrYwn6hF8/FkJp9bKxAKVFsn/d8urgbHPA9NPOEOWl4+2cfoFHhfVrJTZPKHSj5daOtup6JyCpPx8rHWRVQ7WOlrYCMx8AHIzlxkALPD9c0VB+x/A3E/+E2fUYHXdF7KTGwdvTd0AHP9r4PgWYG0KWBdfsBdsMPfPrKKsoL9XAVLAvO2fFylCE4cKliyrDVZNcGS1CqEYhWFiAZV+XntaURdTLmpCEbpchTYLqi6NrkMCzLzt5Xc4HwyJmmkJ+Z73jQOh4NWeDUZiK1K08f0EXt7CMHVawIk7gaVpYJUA9LI1Ao8bzKX1cytoFtFfpdCIWz7rgzHgth8u0oPGDwETc8CEMySUzFaikgtlpW1Ta8JqNba7lVljSRgW+Q6ZP/57WQvj6fydBjXfAjKbgEvMLwWCvhNoipgNpnQshlS4IGFWzIk6ylWwAz93ETLxGWB5ClidLABoIOS7pmGfG+33YAG5mND0G8F4678vkiPJczNOAC4UyQm2N8w94kirFlfIAl7i402d6dbPWWAtrsjOFiuCvAJZOQE0pHTFsckHYDeCvhNgipQNxoAz8/8IPr5nbvH2jd+6AThJAE4AqwTdZKEBLDoDgU4+YVkPHIBoPwareOt/BkDexsMFAFnbzNJYm0IDnVwbt4uyur1kwL7Tp+iZM/08WT9Rc7DHUmuYTr/x+6o4ovvu9fjBbgR9JyA+omwwxvZI5ULg6ZW7y9FPf9QNwKm/CgCcKABovh8ByVy/UCtJq2f+X1yYJPGU27lIZLbuEWDsWBHesZeDz4iURLUWa1TE47LqK12fZmd3OXidFctqm92KatVs1jAEsNv6sdymaa2g8+xUL4I+Pn2beCgbLGWHI/h8G3oTr45iK86POlbBU9yKI/AcfLR+ouQwH9BfmmbLlTHboOnZ/T9+5vaf8FUaAThXsFOQ45mUcgZCWTAxe0UQ+urYMO1/37GtxQmoLCBtRSp30LrDp2SFdzYMgk/R+VNwvwR9mwQDsaspGSfJgYDYNTbp8psCQFJxEIBkQjDrxt8dXCUIY+COH5MVFPi8SOn2n/QYLZ9Gp0cxANIP5IvAkzVzxivRydnKNzBa8fddM84b6AFyAriMF2pajk9kYIeoClXmA3AQgr5NQEHMBqMVFMNaIOayNRL/vhlH3RZwmhbQQUcAasrVVGz4EtjCu/3dfb/ID3PbT7uKAZ/MhcIC0vqRTo4W0IBIEAmEtFwCYqjW03bcmdwBYeoWgetUbrR8snrloiR2drpACf+rD4D9EvTVjIJu7HBV+781X752Czj9lwUZkTEgcPoNPp5Nv4oBRhCG6dd+1DkMz1JIhR1BAHJ7zwqO3fIRRM5tmDK5CoQKsSgOeBYBKFZULTqcB9r6Ni5KYmd3WKDUA0BlhNLM8EbT1QBXBU72aI5ZjUcVOxz7WLkQ8d37vsart/uA6RcPsxNSAtAXHDYNC1AEpf9s01kKwuBwGU7HgVt/1jtD1e60fgQigSe/j5bQp+KYpGB+H62jT7P8/ZypBIC8Dhcx8eY9wF015abhmnoAyJ5WSrKeNgKO9SHxnT/LSasJBim5lRjWBEIVeROInKL1qunybRawLgASdEy74qjaNNzJCgqEEYzBGvK0297mAFSHEIB6ebKDgc8J1ksmV8t29f1en6L5v6cxIK5iK6Xne/5jCTiFcTqVn/r/tWDPWwXnEPTVgIKUHU7ljASawKefIwDpMdRxRB+wFgD+RREDJABpwSzz2c0LfxczVjkVKwaYgtBBezu3SvX08d39P5uO3QKahXMQciourZRAGKZWar/YZ1xXRPe8wQr2AUK7TvbOVTZBXx4MBECRnConUBSFEXT6mf/TK+/qmzAF/0UBOPqBZYF52HrTFCw2LH5G8UCzJEko5nZqmRnPh/uCXmpnVpDTsIPPwKApOaSA2QLDLSHf97iPx0tpISLfz7bl4iFfsUsnj+HZWEeOYDCDnDmCvZkEgedcCjxGseIhBYt3vx049HwMLRh8gA9gh2MoH9ABqKJzxf0McO7XlSAU4HzhYYFq+5D7hwBu/98OQLlIBCKnW39SlXNY+nqeiq2dkQg+gnGPb9/ZpT0lq6MV5D96gLCwgDmCwbdnCvZmCgY/dxy47xxg5SWuUjigYPHFbwA+fyGwfr2rXrMvPB+vp3L3GHCgi9JOHQCkRVPppeUBigXLFymyejYTB4YsgfA20ofRAlYB0FfAlvQqP0/TsX5PLOB5DNu471cmIwiBaRww/F01J+mz2pqChxUMZvpJlmBv3iTocsW4dzewfhkGFix+2febXDAeJO/YEILBB7pU1g8LQFo98QASVGYNQ6DZfEG3fnEqrgLhbf/HV15anbkFNCvohWSl9XPQ2XTM/2s3I4DwPIZwBEDfgitH0Ek6N6x+u/iD7T4g/YdBBYPpWHEaHlqwNw+AQa4Yj54JrJO+aQDB4pt+oCAyYvOPEIQDCgYfeF/9U3AbAMX7ItAlVtAspKZdz5SOlvA2pstxjES3wJ+92NgAGK2gwi78QoVfEhBeQACqNNP1RdoA18kKdgDhxkUI/zKIYDCnqyzB3jwAJnLFOEIW7QEEi1/1Y21ywVglCAcQDD5/Efj7M4CVrZ5AKlkhxeQUaxBI4nvFzxf8IfCVC4HV7cC6ZEX5nen3VX1vAGLZq8ysrvHY+QBwbGfI2E6JpLvdX+ksthpUvQrmX/sVDGZVUJZgb17vJHLFeGQcmCdVb5+Cxd/5xjZ6QzzMLOQBBIOfTV2Ps4HFHQ7CLQUQmUrV0rgKJMsCjsxGAqTn/hzw0EXA4tnAyg5gbTYBorKkUyLnkB9YVhTxu+kT13iccwtwdBewPAus+b2ar9xJAafqfgMQO4dh+J9+BHe5gqZZZzYok1JJUcpaR6bp93P+W/N6p0KuGIemgEWKgPQhWPxdP7NBLhiHKYHUp2DwpZ8rLOD8tmJQVplOLxAqmbRKC6EDYC7/CeCRPcCx3cDSrsISrs04CPm9ArZk55UvKAspYLqPaPdR4/H0g8DRHcDyVr/X6VabLHk2PhjpPVZY7d5xwF6CwS9y/4LbbVyQsEKIufGiKe0p2JvXOx3kinF0GjhOQY+oNRtljji9TQPf/fOV9IZY4Gq4D8Hgy/4W+Oo2YG5bUUy04vUcLCqSJVRWszJbNgxSmMau+q/Ao2cBR88EjtOqbgNWWaTkIFz3YiWrF4nAjtN0nBZrJnU+/8PA3CxwfMYB6LUra3oglL0tps6wlVha5rLiqd9AdDfB4Je6U0s/0BXTDYh80Sr2FOzNA2AXuWIszABL1JaKWq1R+nwGeM17OsoFY5XTVw/B4Cv+Djg0C8xvLYqJCECzgsxmZlq9T8e0XGUyaUizavPtxoFr/zvw2BnA0Z3A8e2FVV3x6c4sqwObckeyhiXAowUSADhD1XhceDMwx37lvU4XxVN2n3rJIocygkr/Vbs7fe+EdBLcfaXXQ3IPWIrpBB6XlnwpR76jYG9e7/SQKzarxM7qJFj8mg8UarMV9IZ4gvNDD8HgKx8HDs8A8zMFAFnPYQPDl0Co2g4fpDZLqKCxT0/7fhJ4fCdwbFvhRiwRgJruCOwUgCpeCvUjZmEFxhfk9W969kW/B8xvKQqnVgg+B6CB0MsI7P70AHgmd2n1NQ0rv7FvALIlVYK73MnQCDLThSGZoDpuP7uCeuX5n8zroB5yxThGnQ0CgyBMxY63Aq/5aBHG6EBviDlOLV0Eg1+0AByZLgbl+HRxnZXJoqqttA4ODovlJZVuSjTQFtq+NwNPbHMAzramdVpVs6wEoPtdNg37wJfvsYiJP9NFqvHY+7vAwjSwxAeNxVO8T6aNVRRRlT6hHrJ0Ovaw0WDJCKng7g86APvNB9wg2JvXO33IFWOBgn8EIf2nRLD4tbe1+AU7yAWbZeskGHwVdd2mgAUCcNKnJgLQrZ/V9/Jnn5JUYmnAE3hCmv3+t8AWQfSzyPK/POOgJgDdsgqA5nfJAvLdLV+bz0kK4RqPZ3wQWJxyAPqDVhZQyQr7gyaXI9axWCFVAGLvRUhV46PgLnUWBs0HbBPszeudPuWKsTRZAJDTo8l8ui/42juL5veQC7ZpsEow+OrZQlqVVuH4FLA8WVyDAOTAmHUQCAWQkOlsQAwDt/9/AE8SgPQpNa07+AhAA6HLXbb5Xr4IaAMfv/eGvP5NzyYA7UGjBWTWjh40v9fSyscHLtaxhJWxFVsNNAXH1khw983+DYPmA5aCvXkdNIBccemfceooAfhAAcA+6A2xLuAGucxrzgKOMexDfV9OwbS2BB/BEoqLSrBoYGgJ3E8qLcIEsP/ngCPuUy7S13L3wb6PU56/m/Xj4Ps0TKCXQA6AXuNeZY3HMz5QANAeND1kwcKXlj6wOZQ+b7R+Pi0PD0DeFAfk590CKg8qncfoFzIRVWVqfFfBhgn25vXOAHLFWCDbvPstBsJZ4LUPt+jdesgFg+qVptWq11bg2gtgfuLiRAAgQeg+oEmsOujsXb5SsAoCIN/3vx04OlNM6Yv0tdx1MKvK7/TFjVmeCD4HQQQhf159eV7/pmc/kwCcKABoeYvR0oept7SEoZQ0Tr1lPuPQFlAtO0nyAcWhpzw/FSjFzGjLx+RGvxzoSeC1hwsA9klvaFN5FAy+9mJgnhaQ0qqagglADo4c9AhCDpJPl5ZommQ8738HcGw6AJBW1VecZv0cePwOY0/wl1lAD/WUCx0mMlDLr8bjmb+Dwp3x4nkDYbD0thIO5aNtfmDi/xGEeRawxhs7Vb/q2huABQJwAlhyy2cC0xoggjAAUCWWAkksOiIY978TmOOqeqqwqAx3WGhHK06n7TDwOcAV/iipPAKjwgrZm2o8nkUA0gKmAHTrp+o9MTrEYvq44o9pZIOtgmu8mafCV72YAKT/RwAy5OPOuVlAAk9Oule6xQRTWUKlWtkU/IvAHAHti5oIwDK841ZPFtCmdr0U8PaC9hVultd4CIC8P2Ztt/m5/qC11TJXlJDGGpfGAmYODgFoCxACkLpuWh3KCgqE8gNVZK4KtxgjJAB/2X1Krao1rfN7CWZf3LSBT4uAEIyWBVpipL7GgwA0AW25GbGENBTRx3rm1M2w39mmrFVwjTd1Kn+VAZALEE5LtIDyMWUBvbLNLGHgd5H/V07BDp7r3uU+Jadgn3ptxekA5MBri0/Wp4wzBjDbCnkMWMqVpE8GJwLQqvfc0pqbkVj5aNk7gbCxgJno30cAjntowtXNaZ1suvSKNhsYTcVKmw9F5xGE+94dfEoP+JYhD/8OC8eIPUsUHokVVKB78XszbzAF4Pvd//PCKVGIpOAr78mn4DZOm8YC1jco+w6EFTDDPJqeCEBZBa5GffVbhmQ8DtZW5TYOvPhXip0GTuu22lTMLSw+aAVl9QhEWjurI/aQiLJkTMLsX9R3r/ymZ73fp1+37OU9hunXSkdl7T3QrhKCtlCM59k2i5CMMSIAGdqxEIwrmptzTsCEut5yilKoJLAcxCq3fe8tLCDBFwO+tKjyuxSCMdYEXoeDrHcHvu0tTwLzmwHA4N/Gh6zNCqqeOSxC2lb8tQSiMwbuqXIqAcjFh2JjBKGJyShQG6ygVbfJegULWBYcMR3rvb6oCRaQwFPgl1M5rR7/JtBZOIZWx/0+s4QeY5z/1/X2tFnAxPpFELaVkdLN8MWGVr4pCBsfMHN8bmTKfCjZ0Ncp456/x58zLzfw6Qf3ABd8pUgEYmqk5bGyek06IQl1bkXScnlN/u8L24Gdx1qVq91KQvrpgwaAAw9p+wnXPw1YjyWMGtDo2ASOFGMU7SIEUzdYD34vMPmXwLbHgdkFYAtlGiim6DpxJtvq9LtlVr/aWKEB8pUXAOOPAFPzwBTZ9r04vdQ9Ts4pAZ3cd+yHxgfMAOH+vcA69/9Uxijmz/AerYpdar1lNSMYzV+vWY/34I8DY58Gph8Bpo8A04vAFEFIknIHohGVR62QhFRSYjQE6qFri2z3iaPAhHNNlxKwArI0Q1IAxwfReacbC5gBPp66/5ICgLKCtqnsrKKlrFZUFPKOr7osMTtdsxzqQRZ93Q1MPARMPllohUxRqkEK6gShOP0S+dY2hlRv99y+ovRi7IiTnTvLqmg6xDPYpqAUgRgsoR7MxgJmgHD/c4E1FXu7FRRbvEgd7evXWlbPpp9EgUjiJpwe6zwOMlvpAWCMVusJYPIYMOlSDZRpoGiNxKzbdIQlXONMWJbGtw4svdgz3El47nzTRvPrrKptAJT6ZrzfintvAJgx4vsvdQvIXK5VYF3sUZxmJUvgA1FOvwF8spKyBtM1y6EepI4LqVMedbEaTp0EIKdPKh5FqYYqSxgo2jgFr13j6XXHnOiSZOeBVSvyC8qC2r05FVvVw9cAMAOA178AWPMp2LJaaekiCPXExwHw660n1oB/niGQazwOkkSepbJ/72I1x4CJ+cJ6lYI1riccrVicUuVSmIW82pkwnHHVOKbFsOozQGkFkwewnBES37ABYMaAX39ZAUCCb82nIlo+40p2gNnvsoKunxH1xGwA/LOzdQOQJPIuHzV2GBg7Cow7AI0l33XfjOsv6oVodes6ISbBsAZMX+kJxU56KY7pkmFVhOciuvTzSt05v0+ryuT/9gDrZNe4wPMsI7VJP3GcP7gUOOdvgL1rRYJ0ZI5IV3hV4/wrGYPPU3/AiRhYusy2K7mU999P+z90ObD7LuBZK0Xdkeq9NSX2+o4HLwfWlopFCC0fgciBMtAFC8CGrYXVoVjnU2G7rTXrzh4kfRzLY1kyGwBoeiGcPiXb5eAzdXWnazPCSScb4j3xfmav8Cx2p50lAMW0VXINitCogl2r9H2dcctWwQxQsn6ZTBbMNtcgdKIbiZj51VcBk38CXPxoQcfCUg8pjcYgZScw/momACnXyr4leBhs5QaBTHpf7X8dMPYJYO8XgAv9e8QJlAZZq8D4xSuANYKPJQn0AR2AHKy1MACKe9nfFI6IEqduEWoHIJ9wlsVKLekoMCa9EAegSTYQeM4TXco2SEMkAHEbBZoj4bbYtdyCVrFqGXgTSxgXYTZeHLi9AMjEQRCVUXP/n4KUaaT8vVTi+Rtg7GPAuYcAWlMCgUVkQfJ2Q12yBvPXMwHImhDWwf81imsTiLSEvHZkr+jY/p9CQRD4p8DOBwteItai05qn31FFdfLlFxYWgCDUIkRkj/TxbCEi/89jfPZ3X2VqYSJQbmUNQY3HQT7hbv2sLoerVwKQHNEEoCsm8R4MhPRjXUGzVEIKIoY7yaEYuY4dgGb5RXruoSgtSCLLarkICQ9f6QNykGjFdjsIBaI4kGlt8W+Rg5g0HJ8qAp47nihAzFpuWtPIMBZJlASILvR6fQ0DCVbJCkJOJCqnk4pGpb99tZ8MopyiKDX7WWDiwYKXiEQOehCrgKh+eJQ+EQHo1Lby/zRlyf8TIbf9XS5ftIb8I92YugH4ay2pLusorl7dAoonWtMwQSTdOFuQSLTGHyIC8kxSIQuA4hwU2WUAoO4/grBcDbsfWElSzg+JCoYDoEGM1ixSkHzgF/wG7y8sIa3J7JPAGWuFJSQIaU01iJHUiYP4e33BrPOHmG/JMaOfTZVYRhwGav87vWKPJ9/rSH4IOGO5sITqg/ggxXs4TOaBAECbeoOsgfl+DrQShFqcEIhyyt0MbMusEkx76iAZXKM8BvXiZAGlF+KaIbaadYpem4aDgpJZQz6YJABV5VcHAJZ0v4FxX6KG5UpYs0KnqjhRuagEVgPglYAl9ciHf8mdUrJh0Qx9vkDBzBywfbkYQIGwahA/kglATsHsDzKA0BATiPyZ4NEDwIeoa/uFYKKXL2f24nQoIgd9R3yQCMTFqwIAfdBWI7+yB5ZLECYLETd85YJl+2YAUNosLIel/xYlu4Jsl6bhNhD6it4WJCvA2Zc4Gxo73RcgJeOqFmGR6rcChLYACyGojmEYdj59KnZ+tIQRhH9IvWA2hiREjDeRI9Cly7fMF3EtWRFawhQIf5IJwE56wdTIYdt7tp9ys1K8JnoJvod9Wn682PNkP4hUy1ndWgstAtBDMLYN5/6PAc5DGNoF4SrZfN+4+IhT8jqwg2Cp8ThIJ5vfSWBXAVCrWN9SMxDK+skaOvhoAc8me654pmUB3f0wyt+E8FyRAGmPlOEoiSD2qgvmAKoOm52fAuiTDHSyIRxx+lI0QxxADubfF5vffMmSajrWlP7nmZ3dSy+4r/ZzAUEHnQ8R70HsXlK+PgJsW68G4XYGZj0EY2EYATCAT6tAhmE0DXcC4faapcwMgAIfLb0kuzT9Qmw5uwAAIABJREFUSi+EfeALkSrpBovbrQDnkm8wAo8/E3i+CCsZ98NCpAp8cUekZyBavI4ET/TnaAk/RQCyAXy6uNSPA0i+wMeB6ePA5HFgZq2wpNGK3FUDAHmv3fSCe7afX8CB4UNEEOolVi/3obastNwJ9cO5BOBKEQMsAcifHWzRAigWWAlCn5K2bQYAOe1KMjTIR2kRUhKVS7IrLia0v+3xwHMZMCbYNP0KfG79zAqK5DxOvyEuWu6VD5KSHy2YAEQAfpaRdl5UkuUctIpBnCIIl4psD03FtIIP1ADAlBuJM47EqqUX3LX9kSBQcuuyftK78xUkHyQ+RLqHZ3Fv1KcgLj5kAQ1s0Qo6IA1nHhNLQzA8ZxvBXuNx8DcS5UYpNnoYxsCnUIqvZo0F3wPTMa7Hv53HOJVbS/l+5bumX7d+5WLE44hxIRJB2NMCqj9ixwuE90svWCaIA6bAp959EKeWChAyA0PTOV2unGMQveCO7bfqHbcS4rJR7Ewqnw5AWhLuImg2uFQAXAVs8RGmntW4+g2hB3P79L/EJ9zGvqrxOPibiVihAOgrWQOf/EBfBcsPNBBqW9Hv6zzGqFzmoXz3B9AePgXiq6bgiv4YOB9QHS8AfpkAFMMjrWAcQA0iO9XJiQyAnos2vV7ESHOOQfWCO7Zf7F40mZFQScRKAYBaSU6vAVcTgN7xXHiUFpDTMK2dFh56912BTiDcvpkATIXzCL4g3WXTZ4jpGfjoF/oihL+fx+0yWUABLwIwtYKKIabgCzHQvi2ggBKn0McEQDaKT5cGkIOo6SuyYzEfjQB0EM5nZgAPoxe8of3sgSqCQM3jkdFLvpRvR13+7UVRuhUFSavNO6otwp88ZZ3+t4M6HLtch6OT9AG/q9cmtf//gV1JDYcnQ2zY6/YakfSrU+Pg1M45NqPt3IEtoM7WFHokyrWKkooglCMWLYjiUXMtK3g8Uzd1WL3gDe3vRRCoUEYCwGtYFxxqgA2E/jI20F5hhmQod98BHNnlxOTig1aGiDanO21yV4DygWuB8YeB6fnC9WEtiKVVKeE0ZGiXWczeJoWMIig5a9V5DA1ANoKDeDylZ9NSXxyAsiKawrQqmCv2HVf5e8aRoxfc1n7xs+khItAUvojvyWryxVcWJZksVSyZoQRA3dcAoHzax4Gj2wtu6FVKM7gMgti02jbV476oUJJs1j/AbA1mQ3Pm8eTRsoZDtR+xZKCiEKmMXTIeXHPGdhYArX8FwG4DGMEnAHIK4yvT58nWC2b73cexaZgWWaEKgU1gjNbPP7PvOYGsUSBkv3hBtmRWNzxjTk9RWktvxp6POj0vARjY9sWkFel8RWxegjIF4RjwAOnZWMPBTGjqvHmszxJOBUD3xyznL2bqROvoP3N3q84jG4C7M/PpcvMBef0cvV9k6hXv+2Yno5QfGArRbaCC0mWv2YtF3ecerNDhkNZIIsXQRv5dlTtGADJSz2gEE1EJQM//026HdIEZLC8B6A0tk0g1Ja8DuzJdphS82QBEZj5dbj7gxZN5er/IZI+67pscgE7QaDOUMyC0Wb8+gXjuR4F5J6YsaXnFhBoAGEVvUhb60jISgCQnoh/OLBgvIrL8v7DdFkEYM5dtNg97tvz5zJqzdfIBmJlPl5sP+DJP5xtW7xffnzeh7H+Z+3+RpkyWT1YxuURJYVtx6T0fCTocouQV85VkHRIGegEuEv/YKpkA/JceVmL8kv6t5/9pu62tfiPWcFQVEa0DZ9WcLJEPwMx8uvfnjT9IgZyj94t/ldeA/S9tMaGa9SNdmsIxbvVscVJ1GScoMt4UPwhAsmMZ0aXzQBsvdGRBjQz0FUpEJRAJQOq4KAnBdz+sfiPJ3bOYn8fsykyVWMfiN3BOzckS+QDMzKe7OW/88aqQzsfE5kH1fvGjeQ0wADodmVGwOeiMsUqHrGOnS4UFy9P/wAEojkEnI+IqOIJQNLgpCXhcmLAtD/D+kgQE235L93tj+YBqgTX9BiCeW/NedT4AmQ+YkU/3sbzxBymQuZhm8g1T+QbV+wWFdjKO/Te2mEFNlCb6gPF708VJ1TXHgKd91GnZpDfi1k/gM2vqU3DUnCuBmNQe3P9vw6pe229KOvB0K1k+ZS+rnrfM2AlA3JMZtah/EZKZT3drxuDz1O/yxAwu9JgJxr3lQfR+8aa8Buy/wdWQZAVl+ZzCrG3q9c/YrkmHy3IRYryAAqAkEBIlopJxNNUbER+fA/H+/+AAdP9PmS9dazicJybm7mlB8nR2dI1HvgVkOlZGPt2nM29GCamcGZjAwlQ+vvrV+8X/zGsAAUiLVPp/wd+zaTMFWw+/kAA0GQQnpCw5mDsAMIrcRB5mC/+MAffTwgfwKY2KfmCZ6ZIkUShrxXxBX4yYaV8Hzmcn13jUA8CMfDqWYeQcSkhVOl8U6uxH7xekrsg49h8oiCENgC5TUG5vKxxT8f2aRtOtcAKQ1s8soPuOVUIwpchNlEEIOyNSIrrvv3hwnckWIZPZsnbcDyzTpvg3lU8mpZQqozyfK74aj3wAKh1LgrsD5tMxiz/nkGD1sHq/YNFOxkEAcuW7oqmXlisuQOT7VV2jwi/kTgj1RkoZhBje8Z83SCAEEJZW0C3gff8tADCt4VASaWIBK0HI9q8BF5yUAMzIp8tNx5Jg9bB6v/jdDPSRns0BWIZeUitIo9IhHmhXTvzCPQddccnZ76U1V/IvC4SBCFyg26DFNg7c++Mhhb6qiCikT7WVUmr6lYn2nRKyrdZ51GMBlZIc07GUBdMjny6XCiUmpA6j94vMZbgBMFo552pu27PXAqXTyAUQcitOQjAm9xX0N9pIwIPmSCmH5QuPqER0L4kDYgp9zOUL6fYxkbZcFceyAreAF3GlV+NRDwAz8uksnT3jiILVSmpWNlhMze+k94vMZfgGAPJeHDjpCrgM01Tdry9OzvmYAzAqLVWIwEShwzbRwwSEn+MqP6bQK5tZlWyhjCCCsC19Xv7gOnBRbgp7cu/5AOyVjqVMmA75dJZ9nHF0yohWNlhMxKnS+0XmMtwAmFq4imnYbrEqNJPc+9kfd62RKh0On8qV9hXZ9askEPgAfI56ziocUgVbzGT28lEtRMoKtg7lBHtznfZNA+CQ+XQWM8k4uglWK/NLYKzS+8U9GReXD0g/Tyvh4Ne17Yb4Zbr6g6y7/aNWcoPpjKRTsJIags5IJwkEAv6en05S6GUBfRWsUExZyVZVQCQwrgN7Wfdd41GPBczIp8ODeXfTSbBa6YYxlY8/p3q/udc3C+jTbtvqt2oadnB2m4oNgMn0W0p+hYWHWbwg9yU/0Kb9EIy+5y2hiCit4UgKyTeAkN8Valk4Le/ldlONRz4AWWBRM6fdIPfHstw/G+SE5rMnVQ/kA5AkLHS0ak7V7reXfhgACaBqDtD3e/nmc5k9kA/A80JReq+U38zGVp3ObJo/BvAOD3dtwiWar9zEHsgHIGlFubqSx7+Jja36anLLcDvvgwA+NDpDfILv+qlzuXwAXuSjrkKemlO2e3U1uWUYnL8dwB/5e2apca9LNv+vsQfyAUheX4VguB+mzIsaG9ntqxhF4Xbe3QD+n7/uHLAW9wQ1tblMRQ/UA0CaHC7plXEh+q4T0OWcfhleYTSHBK0EH/mi+fcRuKQn4I6fWpeoB4AevCz3HOOm9yb3F5mBlZBNclYCj1aRfyfrbgPCTR6AzK+vD4CyglX7jpmN7HY66d1E0ctdIrEEE4wEIMlam+Pk7YF6AMj7EwAVbU82vTerCwhAXopJN9zVI+AYrOeULLZgErY2x8nZA/kAJGWr0naUWdFpy2cT+oCWjpdjLFxE5UzYIBBpEUX5nLnlvAktb76SPVAfAOUHpiAMm96bsVtCAMaKALICMyxDq6cXfycA+b/mOLl6oF4AiqBRIEzBp7/X2Af0+fi1XIioMIlAI+AIPIGPmeROWV3j1Zuvyu2B+gHoFfZiDS2lC0LiY52WUADkQoTTMH1BFSYRdHoRfKSu5v9qrizMHYPT+vx6ARhSuDcAzzmDo5ZGHT1PAKYMwQxME2jiSo/gEwBrrq+u41ZOy++oD4BaCcsXTPiSI3ey8s4KGoG8QwCMFM+0ggQhLR0BF19SXuD/ayakz7uR0/TsMcxg3SjfqWNA0hsrga/ojaq/8WPcC+YIk4Ke4CMSuB2XVht1Oj8zIfXlU8BtU8DhmYRXWdfrdF1fgr3+S8At48CD04DVjXQSDO70PTUnaJ5uOCwsIIFHSSFy1pKPWCDsZxCpw8UVgKSPxLXM937OzxxAljzcPAbcswU4Qh4V3UN8mKoeKm/bu78IfKJQa8VD48CylHQiL3O3/qg5Rf30BKACMtJXjXKQcfBSK8Dfqc3KVCwuN2VFGRnm/yKZtq4Re5ifyQQgM2A+BeB3GHaZBo5MAIue0l7Kt3cC4xhw+5eL7TuCkJk1jBtyerbUfYG5ExjZ/pqrxE5fAOrOq5SmowVIrRp1IyT2R6+fg0bgVYG4CsyZe2UsaiOGKXr4Sfp9k8CxCYAFSKyvXeY1o1BxQux91yMtfsHPutgnnyUuUvhc0ZsgUXib+nVkq6+ZKaABIHsgVZnuwD9sVo66rrR4ImdhLGSQ8zPL/JgBQxeU1ouWkO9PTgDzbgmXxrzMkatl3keivfG5x4r4IRcz5BfkO5vEZ0kgpIfBZ8yKjlL17syy0tMNcOn9dl4Fy6dLFabj1Mpvow9Ify+I4Nlo9Xt+ZqU9VdJpqZh4QDDyxUyYOYJwHDg+DhgI/WUVZl7aSEt93+GO9Ia2iuZKOfA7lhp9JpvAVy61w2mOwO5hmCgMHC1H9O24gu6UD9jP+ZmbtLRaSsei9SL4XDPbAEh/kGQ/pSUcc0lbApFWb67lQUhpVnLBsoKqqZclFMmUtrxPcwxl3X7vOCAtYLSCcugFQmqhdssH7HU+RznjiOlYXA8wqkOfkItTAom+oKygca4ES8jY+N3z7fSG4hfUtp3ihUHruVSsFy1iRvNP+1N7A5BdJACmVpAgZPhGOyCigEjlPLudn7kvFtOxuB4g6OjD8UWLRkCZFRwrLCEXJQQhp2K+37lQeBCRX1A7KPQto1prFEmSYn2mB9EAsO+kYfk8KQhZF8yjVz5gp/MztyOUjiW9bCUhEBhKRCCgSis45uQ/PhX/xfFWMgOnWu2gxB0TF/o0kEZ/kCDM1Ts+3RHYnwVUL6XhDFrAswfIB6w6P1MrTulY0sum1VICglKwCEACqvQFCUK3gHcsFQCM/ILayqP1k9JshVqrncMalOYYvgcGAyCvIwuod8YBJQmZpmGJeyRwkGw4n8jJOJQNw3idLFhMRNB0SgASTJyKoy/4ieXCeFfJBUeV2SoAclFyR0bbm1OHTUiN0/DTAwD7zQeM52dqj8VsGEkVE2jKetG7AEhQ0frJAv6RC0trC1skl+IWlNinGLbSaZg7Mc0xfA8MbgF1LQV1z08A2G8+oM7PVF9Ms2GUE0gQyp+Lwu2yagLgR9ZaYpkSypQ6a6Q2DCqzpkvietXIFdoZfuieGmcOD0DeP0HEbBhNwYPmA/L8zJQsATAKnguEqS+XTqkE4YfWWwCUFZTksYAYwZfIBeN9Tw0cjOwu8gDIZqsoSSvhEeQDiiGYFoyWiSDRypWgi69UP5sc5fIcquSCNeXqe2X9ZAHfM7Khe2pcOB+AT41+aO5iRD3QAHBEHd9ctuiBBoANEkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cvAFgg4GR9kADwJF2f3PxBoANBkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cfOxqYJ2au9RdPtdp/khoEOlglDYT39V1PzQFXLsMXAlgt9PCxJKPbufyf8/KHIPfBPAZABf79Xc5XQ0ZQ1Q7360NbxoHrlsDvs5ZRsgo0une06by6X1mZvtP99PNAp4F4LsBXA5gjw8EGTeqaGF4QhzQF80CX7cAvGIdeDYAfhdZ2sTKUcVrpE7nd31N5gj8e2dIo2osk7NZpMdK0Z19tv+bJ4F9K8D1ACj8yfNSikHeg+5Z969m57Y/8/ZP+dPLKZhP/rcA+AYAF7g1oRUhEMUzFMt6eSJfX78b2DkPfM0i8GIAX+uWlAMppreUUErn8p2gzTl+2flg/sDbTkvIOik+CP20//mzwAXzwDcCuNTPJeFXpEpM6QEjIHm/zTF8D7T5gATYNQCe69aAloRTGulfBESBSYNyxR5g/Bhw7hKwZwl4vk9LnM5JmsBzUyDGAX3B8G23Mz/g9BuUa/0IiutfMkj7zwKmngAuXSvOpUvAWYBtF4BTnspIj/O8zPaf7qdvWITw6eZA0JLQEhKEGgxZhUj/dz3NzSKwbR44exnYvVKcy+mM5Km0JhxInUtrGkmzCPicg3W5LMGkQiZZTm9xS9Z3+4m2o8C5c4X15pTKW2Lb+fCx7WLtjYxzqiql29Icw/dA5SqYf6RTTilg+lYCIXmICKQ4IK9wxfSJY8AZK8CuFWDnanEua9ZTAMsaCog3Dt92O/MvnRGBtGwkqKRmMEkqCaa+2k+0LQDTh4rP88UHj74kF1WaATo9QHQ7mmP4HugYhtEKj4PB6ZQ+FS0hQahpldPya1kXTOqNY8DscgG+HavAttUCvBxInitrkgL4lcO33c7spBdM3kAuSnq2nx9gQfAh4JyVwvrxwel2z3p4aMlzH6DM2z/lT+8aB+Q/OT4EEqckWQSBkGD6EQKQnDCLwBSnYgcf32fXioGUFawC4esyu7CXXnDP9tOCsyD4KLB1rmgvX7zfbu2WG/Jtme0/3U/vKxBNAMoi0KcjkATCN3HOEr3UAjDrwOP71rXixYEkeKMFlSX8ocwR6KUXTJ7AaNE2tF8WfA4Ye7Kw1mwvX/yZn+eKnvcrfzC6IK/ObP/pfnpfAGQnySoISBqUXyAASS1AK0JfagWYcRDOrAF66TxZQU7jBOEbM0egH71gcgXSFZAV54NQtj9YcNIpbONCyh8Ygi8CVospApDuB63g92W2/3Q/vW8AsqM4gLIKBBIH8bcJwMCNMX68BTqBb8s6sGWtsIA6jwDk662ZI9CvXjA5A6NVa2t/IAicnC/aGV+8T74IQPm/AmGuBc+8/VP+9IEAyLslAKMV/LgAyIUInfnjwPQqMOOgI/DstQ5Mr7UAqMF8V2YXDqoXXNl+EQQ6N9v29aKdesUpWJZbAPyPme0/3U8fGIDssDid/pUASCvCaXgJmFguAEfgEXT27gDkuwaUg/nbmSMwjF7whvbLhSDL5TwwvdRqo9oqHzACkCB8U2b7T/fThwIgO01T1IMCoAZxGRhbKoAXQUcQTjkI+a4B5e5FzjGsXvCG9gdqrLGFYrpVG/UuHzBOw2/LaXxzbh43DKeoJwlAHqLndSs4udoCoIBHQE45EPk3DuitmYOQoxdctp8+rFwIWsGFYiFFoLGNchcEQC6e+OJC5J2Z7T/dTx/aApYdJ37AyJK/DIwvFxYvWr0IwEn/H1Opco5sveDUhSAAF4HJpQJkWixp6k2n4IYfMGf0amDHev2I8+l4/UbvNw8Eozw72wJePOJ8und7EkKj9ztKGA1/7WwATo44n45pWI3e7/AAGPWZ2QBkYHCU+XTMfGGQmYIxjd7vqOE0+PXzATjifDrKtTZ6v4MP/MlyRj4AR5xPF+VaqZLJF1UzKdPV6P2eLDDr3I58AI44n07ZMARbo/d78gMubWE+AEecT8e9YOn2Uheu0fs9tUCYD8AR59MpG6bR+z21gKfW1gNAz4geRT5dTEZo9H5PPRDmAzBmRM8BJzqfLiYjSKKr0fs9dYBYDwBHmE9XtRfMsIz04aQZ1+j9npygrA+Akqs8wfl0BCCTWRq935MTYL1aVQ8Ao1zlAnAi8+kEQGZTNXq/vYb75Pt/fQAcUT5dBGCj93vyAaxXi+oDoFLyT3A+3Rcavd9eY3xS/z8fgCQX/LPR3SOzkon55jg1eyAfgD8M4NcAPD6aDmBtB1e4NMDNcer1QD4AbwbwxwDe4UvRE9wHZG1gNSXDLlwLNcep1QP5APxzzwj9IIAPnXhT5ORc5EYCA9HNcWr1QD4AmRH6FQBMTSZZH98ZmD5Bh5g1FopiNns1x6nTA/kAvAfAEwDudnI+EvQxPfkEzYfaCXRSBluQMB7YHKdGD+QDsBNBH/9+AkAobqTADGK7Inw1x8nfA/kA7EXQt8kgrGAGMfBxZ5Cv5ji5eyAfgL0I+r68uR0QmUFoBQU8vfNvzXHy9kA9AORoMw7CdGQCjoUZDwL4kv/+8OZ1gJhBIjGDgMh3vTavBc035/RAPgD7JegjODfhiMwgoqeJwNPPTaB6Ezq/hq+sB4AcXeXEP+ZhGVo9vRimIQD5v5oPAZCupgDI9wg8/qz/1Xz55usyeyAfgMMQ9GU2Op4eAchpOIJQQEz/VuPlm6/K7IH6AMjgGzdl6QtyX5jWjpQFevF3lq3xf6yhrOlIAUgQCojR8gmE+l9Nl2++JrMH6gEgR5UA5KYsc+AZmCbQCDi+IvgEQMob1XBEAHIajgBMLV+0kCdws6aGu3zqfkV9AGTwjftg3JRVVRAtHQEXX/wbAcoXP5d5CID8GoJKvqDAloKOoIz/y7x8c3pmD4zhaqwjRzCYyQg5gr2ZgsFTLweWr8XQgsXjbwLWrnNtMlKgNoLBmZAa7PTCAuYIBlMvlWQswwr2UlUw45jdDSx8HbD+Ctd+HVCwePKbgJV9aASDM8Yg59TWFDysYPBtmYK91IbNOHaPA/M7gUXKXA4hWDz79cA8+W0aweCMURj+1HYfcBjBYO54MMY3tGDv8I3nmWSHOzYOLJ0LLPGXAQWLz3oB8MQUsEa16kYwOG8whjh74yJkUMFgbsNlCfYO0epwissVY34bsHw2sEIRkAEEi/dcU0SP5qhF1ggG5w3GEGdXr4L5134Fg4kAjuDQgr1DtDqcUmZETwArZwAru4BVqsv0KVh8/o3F4v0QXZBGMDhvMIY4u3MYhv95Zh+Cu1xBcxuOU/HfeDIq5cv7FuwdotXhlCBXjOXZAnyrO4BV6in0IVh8wStLuWCsUAyvEQzOG5ABz+4eB+R/ewnu/kOP/3G/l4kJTERlljQtIot2e53/IwO2OPl4FLtcnCqAp9cahT56CBZf+LpSLhhz1N5qBIPzBmTAs/sLRHcTDKbiNHdBGGymOC/3hglEvgjAnoK9A7Y4+XgiV4zVWYDAs/etxaubYPFFP1QkLtCIP8neaASD8wZkwLP7AyC/tJNg8L/xLNBu+YBdBXsHbHEFAINcMVamgdWZAoRrfPdXm8KitLdmgYveWAq+2y7iMqfuRjA4b1AGOLt/APJLqwSD3+y5T1yI0AoSbAxMMzGV1o8/My2ro2DvAK2t+GgiV4zj4+3AIwDXtwBrVJeuECze+9aW4Dut4PxkIhYsdetGMDhvoDqcPRgA+SWp4O4veQ5Uv/mAGwR78+6rQq4Yq9PAOi2fA4/vBkKudKVU7VZw77uKvWFuZbtcMNb5v0YwOG9g+jx7cADyi6Pg7gccgIxlcA5TKhaD01yYKBmVFpBZMfx/m2Bvny3t8LGqoqTliZbVI+gMgHwnMAnCIFi897cLAAZ6QyzFzzSCwXkD1OPs4QDIL5XgLmk5JHk/SD5gKdibd38VcsVYGmuBTaAzEHLHgyCcaokB7/1IkUET5IKxwF5pBIPzBqbPs4cHIC/AaeqvPL9pmHxAE+zts6VdLCD/lcgVY3UyWD0Bj1ZwqgCggXA7sPfWAoAJvaEtZBrB4Lyx6efsPADyCtmCvf00s/NnOsgVY3m8BTRZPZuGBUACdArY+5lWDqGmYbIrLHEx0ggG5w1OH2fnA7CPizQfaXqgUw80AGywMdIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0BxoAjrT7m4s3AGwwMNIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0B8ZYNMbkX+ZekpuIiOQrPar+xs889HJg6jZg5jAwvVZ8B+ll9PlO5/Fc/o+ECjnHfi8zYfkvM5ulmp4qJXVqx5deD4zfAkw/CGxdAZgoHfuh131QkaI5hu8Bs4Ds8B0AWLnIRGCBsFfn87JffDMwdjOw5R5g8giwZa34jnQQUwDo99wBfJ4TM7COiNdlaj2rA/jeV/vfDeATAP4UGH8I2Lrc6gc+SHqY4oMZ74VSKM0xfA+UUzB/oBUUCKMl6zSQ/PsXqZD5KQC/A0w/DEwcAcYXgYnVwppwADuBkefnCim90FmBWXwnK87Uen53BI8sbuwqaz9p5UgnQhBS+ZN1zE8Ak0utviCwq8DI8/nx5hi+Bzb4gJzKZE1SEFZZgS9/2pWR/gTAJ4HJQ8DEMWB8ARhfBsaWCwDquwQKvvNgHXvOcYVbPFJPkw+dDxC/W1Y4tWDpw/Rlgo4lo1T4/KxTihDNpJwj3/UiMLXemprjffC7eWpzDN8DlYsQDiKtVxzEqoHkyX9HRizW+nIgaQnvAiaeBCbmC0s4tgSMu2rMePAR9X252jXklaTFU108K0MHav/nvJ6ZxVVk9OI7GR2IZoGQNc/HgbHgIwqILIVujuF7oOMqWFawCoRxkfEIB5CWgkREBCNf9wMTc8A4QciBWyoGz16rwNgaML5eWKpctYZL3N+TWLX0gvtuP0HHk2n16JDyxXmVhfU0qywbJbr5GSuXKxA/sV5Y9UYWdnjwyS3qKKgarWA69Wg6fjQOIK0HadnIjPVFB+AiME4AuiUkCFnESyCSkmAuU7Cjm15wX+2X2ifBRn9A8mKcW2UFjULVQcgVDl80u40SYh763FfvquhLCxitoBYUsoJfjXKttByMq9CKcHn4sPuCbgXNJwyWkECcz5Q376UX3LNncZyQAAADEklEQVT9fFgIJs6lBBwtn3Tt6FpIz4RWnuQxPh2XIGzm4CwQ9hWIFgBTK0gQHiIAJddKq0ELQh+KL1qUR4MvSEsoENIKrgALHNiMox+94K7tl9qnnMio8MSf6SNwGpYVjCDk/Ju7isq496fCqX0BkDeqlWwKwic1gAQSpzGREnFgREz01eALLvvq2Kfi45m6cf3qBXdsfxRbJMho8dimqOhEK8cXQRr9QVpvPoDNMXQP9A3ACELFxPh+jACkP0fLIKFCCRRqKuPUdqjlC9o07JZwKVNHeBC94DQcZO0XAAkmgotAk9QYrR9f/BvByYfMSATDVMzwTXMM3QMDAVAgVHCZ7/MaQK4QZUHiNCbBQlqUw74YCb7gcmYkelC9YFlwvVv7RRAorTuBkECU9asCID9/x9B935zYzyKkqpfiNHxcA0gLQgvBAaPVkCqm3h2AtC5m/RyEqzw/4xhGL3hD++MmslgqCbgUfLKAcRrmTlBzDN0DA1tAXUlWcDm1IOIIJAjlT/Fd05lbFQFwjdtgGcewesFt7Rc/Gx8iWjUCjGCT1YvWT1MwgUqrf3NG45tTbcu0aximWx9xENcEQHGbcYAEwtSXSqY0gnCdgeuMI0cvuGx/FUGgFhwEYrR80QckWN+X0fjm1DwAWv8RgJFilJZBznz0pQg+AZAAlVWh1GvGka0XzB0cCQi30aSGVa9AF62fLOB7MhrfnJoPwPER59Px+o3e76mL5Kwp2G57xPl0kxc3er+nLvyKtLmhfUC78RHn081ONnq/pzcAR5xPR9mRRu/31IVgvgUccT4dNaobvd/TGYAjzqejumqj93s6A3DE+XRUg2VSCjdaGr3fUw+I+VPwiPPpqJjO8J1Nw43e7ymHwHoAKMFd7QErAeEE5NNJMb3R+z3lsGcNzgfgiPPpomJ6o/d76oGwPgCOKJ8uKqY3er+nKwBHmE+noqRG7/fUA199U/AI8+kEwEbv93QHoEhZTnA+nYqSGr3fBoAtaiqBUImdm5hPJwA2er+nKwBHnE+X1gUzSbnR+z11wPj/AeCpPDD3t7rvAAAAAElFTkSuQmCC",jIe="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",HIe="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",og={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},ZQ=class extends sh{constructor({preset:e=og.MEDIUM,edgeDetectionMode:t=hT.COLOR,predicationMode:i=NRe.DISABLED}={}){super("SMAAEffect",jIe,{vertexShader:HIe,blendFunction:er.NORMAL,attributes:qc.CONVOLUTION|qc.DEPTH,uniforms:new Map([["weightMap",new ut(null)]])});let r,n;arguments.length>1&&(r=arguments[0],n=arguments[1],arguments.length>2&&(e=arguments[2]),arguments.length>3&&(t=arguments[3])),this.renderTargetEdges=new Ki(1,1,{minFilter:Li,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new _B(!0,!1,!1),this.clearPass.overrideClearColor=new li(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new Ul(new FRe),this.edgeDetectionMaterial.edgeDetectionMode=t,this.edgeDetectionMaterial.predicationMode=i,this.weightsPass=new Ul(new YRe);let s=new Lq;s.onLoad=()=>{let a=new tn(r);a.name="SMAA.Search",a.magFilter=Ni,a.minFilter=Ni,a.generateMipmaps=!1,a.needsUpdate=!0,a.flipY=!0,this.weightsMaterial.searchTexture=a;let o=new tn(n);o.name="SMAA.Area",o.magFilter=Li,o.minFilter=Li,o.generateMipmaps=!1,o.needsUpdate=!0,o.flipY=!1,this.weightsMaterial.areaTexture=o,this.dispatchEvent({type:"load"})},s.itemStart("search"),s.itemStart("area"),r!==void 0&&n!==void 0?(s.itemEnd("search"),s.itemEnd("area")):typeof Image<"u"&&(r=new Image,n=new Image,r.addEventListener("load",()=>s.itemEnd("search")),n.addEventListener("load",()=>s.itemEnd("area")),r.src=mH,n.src=gH),this.applyPreset(e)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(e){this.edgeDetectionMaterial.edgeDetectionThreshold=e}setOrthogonalSearchSteps(e){this.weightsMaterial.orthogonalSearchSteps=e}applyPreset(e){let t=this.edgeDetectionMaterial,i=this.weightsMaterial;switch(e){case og.LOW:t.edgeDetectionThreshold=.15,i.orthogonalSearchSteps=4,i.diagonalDetection=!1,i.cornerDetection=!1;break;case og.MEDIUM:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=8,i.diagonalDetection=!1,i.cornerDetection=!1;break;case og.HIGH:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=16,i.diagonalSearchSteps=8,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break;case og.ULTRA:t.edgeDetectionThreshold=.05,i.orthogonalSearchSteps=32,i.diagonalSearchSteps=16,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break}}setDepthTexture(e,t=jd){this.edgeDetectionMaterial.depthBuffer=e,this.edgeDetectionMaterial.depthPacking=t}update(e,t,i){this.clearPass.render(e,this.renderTargetEdges),this.edgeDetectionPass.render(e,t,this.renderTargetEdges),this.weightsPass.render(e,this.renderTargetEdges,this.renderTargetWeights)}setSize(e,t){this.edgeDetectionMaterial.setSize(e,t),this.weightsMaterial.setSize(e,t),this.renderTargetEdges.setSize(e,t),this.renderTargetWeights.setSize(e,t)}dispose(){let{searchTexture:e,areaTexture:t}=this.weightsMaterial;e!==null&&t!==null&&(e.dispose(),t.dispose()),super.dispose()}static get searchImageDataURL(){return mH}static get areaImageDataURL(){return gH}},WIe=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,rE={DEFAULT:0,ESKIL:1},GIe=class extends sh{constructor({blendFunction:e=er.NORMAL,technique:t=rE.DEFAULT,eskil:i=!1,offset:r=.5,darkness:n=.5}={}){super("VignetteEffect",WIe,{blendFunction:e,defines:new Map([["VIGNETTE_TECHNIQUE",t.toFixed(0)]]),uniforms:new Map([["offset",new ut(r)],["darkness",new ut(n)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(e){this.technique!==e&&(this.defines.set("VIGNETTE_TECHNIQUE",e.toFixed(0)),this.setChanged())}get eskil(){return this.technique===rE.ESKIL}set eskil(e){this.technique=e?rE.ESKIL:rE.DEFAULT}getTechnique(){return this.technique}setTechnique(e){this.technique=e}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}get darkness(){return this.uniforms.get("darkness").value}set darkness(e){this.uniforms.get("darkness").value=e}getDarkness(){return this.darkness}setDarkness(e){this.darkness=e}},Hd=class{constructor(e,t){this.enabled=!1,this.effect=new e(t),Object.defineProperty(this,"opacity",{enumerable:!0,set(i){this.effect.blendMode.opacity.value=i},get(){return this.effect.blendMode.opacity.value}}),Object.defineProperty(this,"blendFunction",{enumerable:!0,set(i){this.effect.blendMode.setBlendFunction(Number(i))},get(){return this.effect.blendMode.blendFunction}}),this.blendFunction=er.NORMAL}},qIe=class extends Hd{constructor(){super(EIe),this.blendFunction=er.SCREEN}set intensity(e){this.effect.intensity=e}get intensity(){return this.effect.intensity}set luminanceThreshold(e){this.effect.luminanceMaterial.threshold=e}get luminanceThreshold(){return this.effect.luminanceMaterial.threshold}set luminanceSmoothing(e){this.effect.luminanceMaterial.smoothing=e}get luminanceSmoothing(){return this.effect.luminanceMaterial.smoothing}set blurScale(e){this.effect.blurPass.scale=e}get blurScale(){return this.effect.blurPass.scale}set kernelSize(e){this.effect.blurPass.kernelSize=e}get kernelSize(){return this.effect.blurPass.kernelSize}},XIe=class extends Hd{constructor(){super(TIe)}set contrast(e){this.effect.uniforms.get("contrast").value=e}get contrast(){return this.effect.uniforms.get("contrast").value}set brightness(e){this.effect.uniforms.get("brightness").value=e}get brightness(){return this.effect.uniforms.get("brightness").value}},YIe=class extends Hd{constructor(){super(LIe),this.effect.offset=new Pe(.01,.01)}set offset(e){this.effect.offset.set(e[0]/1e3,e[1]/1e3)}get offset(){return[this.effect.offset.x*1e3,this.effect.offset.y*1e3]}},QIe=class extends Hd{constructor(){super(DIe)}},KIe=class extends Hd{constructor(){super(BIe),this._hue=0}set hue(e){this._hue=e,this.effect.setHue(e)}get hue(){return this._hue}set saturation(e){this.effect.uniforms.get("saturation").value=e}get saturation(){return this.effect.uniforms.get("saturation").value}},ZIe=class extends Hd{constructor(){super(FIe),this.blendFunction=er.OVERLAY}},JIe=class extends Hd{constructor(){super(GIe)}get eskil(){return this.effect.eskil}set eskil(e){this.effect.eskil=e}get darkness(){return this.effect.uniforms.get("darkness").value}set darkness(e){this.effect.uniforms.get("darkness").value=e}get offset(){return this.effect.uniforms.get("offset").value}set offset(e){this.effect.uniforms.get("offset").value=e}},$Ie=class extends Hd{constructor(e){super(zIe)}set focalLength(e){this.effect.circleOfConfusionMaterial.uniforms.focalLength.value=e/2e3}get focalLength(){return this.effect.circleOfConfusionMaterial.uniforms.focalLength.value}set focusDistance(e){this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value=this.isPerspectiveCamera?e/2e3:(e+992)/2e3}get focusDistance(){return this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value}get bokehScale(){return this.effect.bokehScale}set bokehScale(e){this.effect.bokehScale=e}setCamera(e){let t=!1;(e.isPerspectiveCamera&&this.isPerspectiveCamera===!1||!e.isPerspectiveCamera&&this.isPerspectiveCamera===!0)&&(t=!0),e.isPerspectiveCamera?(this.effect.circleOfConfusionMaterial.adoptCameraSettings(e.perspCamera),this.isPerspectiveCamera=!0):(this.effect.circleOfConfusionMaterial.adoptCameraSettings(e),this.isPerspectiveCamera=!1),t&&this.effect.setChanged()}},eLe=class extends Hd{constructor(){super(VIe)}get granularity(){return this.effect.getGranularity()}set granularity(e){this.effect.setGranularity(e)}},tLe=`#define GLSLIFY 1
varying vec2 vUv;varying vec2 vTexCoords[9];uniform vec2 resolution;void main(){vUv=position.xy*0.5+0.5;vec2 texelSize=vec2(1.0)/resolution;vTexCoords[0]=vUv+vec2(-texelSize.x,-texelSize.y);vTexCoords[1]=vUv+vec2(0.0,-texelSize.y);vTexCoords[2]=vUv+vec2(texelSize.x,-texelSize.y);vTexCoords[3]=vUv+vec2(-texelSize.x,0.0);vTexCoords[4]=vUv+vec2(0.0,0.0);vTexCoords[5]=vUv+vec2(texelSize.x,0.0);vTexCoords[6]=vUv+vec2(-texelSize.x,texelSize.y);vTexCoords[7]=vUv+vec2(0.0,texelSize.y);vTexCoords[8]=vUv+vec2(texelSize.x,texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}`,iLe=`#define GLSLIFY 1
#include <common>
varying vec2 vUv;varying vec2 vTexCoords[9];uniform sampler2D inputBuffer;uniform sampler2D historyBuffer;uniform sampler2D velocityBuffer;uniform sampler2D depthBuffer;uniform vec2 resolution;
#define USE_YCOCG
#define USE_CATMULL_ROM
const float feedback_min=0.5;const float feedback_max=0.95;vec3 RGB_YCoCg(vec3 c){return vec3(c.x/4.0+c.y/2.0+c.z/4.0,c.x/2.0-c.z/2.0,-c.x/4.0+c.y/2.0-c.z/4.0);}vec3 YCoCg_RGB(vec3 c){return clamp(vec3(c.x+c.y-c.z,c.x+c.z,c.x-c.y-c.z),vec3(0.0),vec3(1.0));}vec4 sample_color(sampler2D tex,vec2 uv){
#ifdef USE_YCOCG
vec4 c=texture(tex,uv);return vec4(RGB_YCoCg(c.rgb),c.a);
#else
return texture(tex,uv);
#endif
}vec4 sample_catmull_rom(sampler2D tex,vec2 uv,vec2 texSize){vec2 samplePos=uv*texSize;vec2 texPos1=floor(samplePos-0.5)+0.5;vec2 f=samplePos-texPos1;vec2 w0=f*(-0.5+f*(1.0-0.5*f));vec2 w1=1.0+f*f*(-2.5+1.5*f);vec2 w2=f*(0.5+f*(2.0-1.5*f));vec2 w3=f*f*(-0.5+0.5*f);vec2 w12=w1+w2;vec2 offset12=w2/(w1+w2);vec2 texPos0=texPos1-1.0;vec2 texPos3=texPos1+2.0;vec2 texPos12=texPos1+offset12;texPos0/=texSize;texPos3/=texSize;texPos12/=texSize;vec4 result=vec4(0.0);result+=texture2D(tex,vec2(texPos12.x,texPos0.y))*w12.x*w0.y;result+=texture2D(tex,vec2(texPos0.x,texPos12.y))*w0.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos12.y))*w12.x*w12.y;result+=texture2D(tex,vec2(texPos3.x,texPos12.y))*w3.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos3.y))*w12.x*w3.y;return result;}vec3 choose_motion_vector(){
#ifdef CHOOSE_LONGEST_MOTION_VECTOR
float longest=-1.0;vec3 v_choose=vec3(-1.0);for(int i=0;i<9;i++){vec3 v=texture2D(velocityBuffer,vTexCoords[i]).rgb;float l=length(v.xy);if(l>longest){longest=l;v_choose=v;}}return v_choose;
#else
float closest_depth=1000.0;vec2 closest_uv_offset=vec2(0.0);for(int i=0;i<9;i++){float neighbor_depth=texture2D(depthBuffer,vTexCoords[i]).r;if(neighbor_depth<closest_depth){closest_uv_offset=vTexCoords[i];closest_depth=neighbor_depth;}}return texture2D(velocityBuffer,closest_uv_offset).rgb;
#endif
}vec4 clipAabb(vec3 aabb_min,vec3 aabb_max,vec4 avg,vec4 input_texel){const float FLT_EPS=0.00000001;vec3 p_clip=0.5*(aabb_max+aabb_min);vec3 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=input_texel-vec4(p_clip,avg.w);vec3 v_unit=v_clip.xyz/e_clip;vec3 a_unit=abs(v_unit);float ma_unit=max(a_unit.x,max(a_unit.y,a_unit.z));if(ma_unit>1.0){return vec4(p_clip,avg.w)+v_clip/ma_unit;}else{return input_texel;}}vec3 clip_aabb_variance(in vec3 cOld,in vec3 cNew,in vec3 centre,in vec3 halfSize){if(all(lessThanEqual(abs(cOld-centre),halfSize))){return cOld;}vec3 dir=(cNew-cOld);vec3 near=centre-sign(dir)*halfSize;vec3 tAll=(near-cOld)/dir;float t=0.0001;for(int i=0;i<3;i++){if(tAll[i]>=0.0&&tAll[i]<t){t=tAll[i];}}if(t>=0.0001){return cOld;}return cOld+dir*t;}void main(){vec3 v=choose_motion_vector();vec2 velocity=v.rg;vec2 previousPixelPos=vUv-velocity;vec4 currentColor=sample_color(inputBuffer,vUv);
#ifdef USE_CATMULL_ROM
vec4 previousColor=sample_catmull_rom(historyBuffer,previousPixelPos,resolution);
#else
vec4 previousColor=sample_color(historyBuffer,previousPixelPos);
#endif
#ifdef USE_YCOCG
previousColor=vec4(RGB_YCoCg(previousColor.rgb),previousColor.a);
#endif
vec4 ctl=sample_color(inputBuffer,vTexCoords[0]);vec4 ctc=sample_color(inputBuffer,vTexCoords[1]);vec4 ctr=sample_color(inputBuffer,vTexCoords[2]);vec4 cml=sample_color(inputBuffer,vTexCoords[3]);vec4 cmc=sample_color(inputBuffer,vTexCoords[4]);vec4 cmr=sample_color(inputBuffer,vTexCoords[5]);vec4 cbl=sample_color(inputBuffer,vTexCoords[6]);vec4 cbc=sample_color(inputBuffer,vTexCoords[7]);vec4 cbr=sample_color(inputBuffer,vTexCoords[8]);vec4 cmin=min(ctl,min(ctc,min(ctr,min(cml,min(cmc,min(cmr,min(cbl,min(cbc,cbr))))))));vec4 cmax=max(ctl,max(ctc,max(ctr,max(cml,max(cmc,max(cmr,max(cbl,max(cbc,cbr))))))));vec4 cavg=(ctl+ctc+ctr+cml+cmc+cmr+cbl+cbc+cbr)/9.0;vec4 cmin5=min(ctc,min(cml,min(cmc,min(cmr,cbc))));vec4 cmax5=max(ctc,max(cml,max(cmc,max(cmr,cbc))));vec4 cavg5=(ctc+cml+cmc+cmr+cbc)/5.0;cmin=0.5*(cmin+cmin5);cmax=0.5*(cmax+cmax5);cavg=0.5*(cavg+cavg5);
#ifdef USE_YCOCG
vec2 chroma_extent=vec2(0.25*0.5*(cmax.r-cmin.r));vec2 chroma_center=currentColor.gb;cmin.yz=chroma_center-chroma_extent;cmax.yz=chroma_center+chroma_extent;cavg.yz=chroma_center;
#endif
vec4 previousColorClipped=clamp(previousColor,cmin,cmax);
#ifdef LUMINANCE_DIFFERENCES
#ifdef USE_YCOCG
float lum0=currentColor.r;float lum1=previousColorClipped.r;
#else
float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColorClipped.rgb);
#endif
float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.0-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedback_min,feedback_max,unbiased_weight_sqr);vec4 result=mix(currentColor,previousColorClipped,vec4(k_feedback));
#else
const float alpha=0.1;vec4 result=mix(currentColor,previousColorClipped,1.0-alpha);
#endif
#ifdef USE_YCOCG
gl_FragColor=vec4(YCoCg_RGB(result.rgb).rgb,result.a);
#else
gl_FragColor=result;
#endif
}`,rLe=`#define GLSLIFY 1
varying vec2 vUv;void main(){gl_Position=vec4(position.xy,1.0,1.0);vUv=position.xy*0.5+0.5;}`,nLe=`#define GLSLIFY 1
layout(location=1)out vec4 gVelocity;varying vec2 vUv;uniform sampler2D inputBuffer;void main(){gl_FragColor=texture2D(inputBuffer,vUv);gVelocity=vec4(0.0);}`,oO=class extends Zi{constructor(){super({name:"PassthroughMaterial",uniforms:{inputBuffer:new ut(null)},blending:ns,depthWrite:!1,depthTest:!1,vertexShader:rLe,fragmentShader:nLe})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}},sLe=class extends fo{constructor(){super("TAAResolvePass"),this.MRTCompatible=!0,this.needsSwap=!1,this.passThroughMaterial=new oO,this.resolutionVector=new Pe,this.resolveMaterial=new Zi({name:"TAAResolveMaterial",uniforms:{inputBuffer:new ut(null),historyBuffer:new ut(null),velocityBuffer:new ut(null),depthBuffer:new ut(null),resolution:new ut(new Pe)},blending:ns,depthWrite:!1,depthTest:!1,vertexShader:tLe,fragmentShader:iLe}),this.historyRenderTarget=new Ki(1024,1024,{minFilter:Li,stencilBuffer:!1,depthBuffer:!1}),this.historyRenderTarget.texture.name="TAA.History",this.resultRenderTarget=new Ki(1024,1024,{minFilter:Li,stencilBuffer:!1,depthBuffer:!1}),this.resultRenderTarget.texture.name="TAA.Output"}setSize(e,t){this.historyRenderTarget.setSize(e,t),this.resultRenderTarget.setSize(e,t)}render(e,t){this.fullscreenMaterial=this.resolveMaterial,this.resolveMaterial.uniforms.inputBuffer.value=t.texture[0],this.resolveMaterial.uniforms.velocityBuffer.value=t.texture[1],this.resolveMaterial.uniforms.depthBuffer.value=t.depthTexture,this.resolveMaterial.uniforms.historyBuffer.value=this.historyRenderTarget.texture,this.resolveMaterial.uniforms.resolution.value.set(t.width,t.height),e.setRenderTarget(this.resultRenderTarget),e.render(this.scene,this.camera),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(this.historyRenderTarget),e.render(this.scene,this.camera);let i=this.renderToScreen?null:t;this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(i),e.render(this.scene,this.camera)}dispose(){this.resultRenderTarget.dispose(),this.historyRenderTarget.dispose(),this.resolveMaterial.dispose(),this.passThroughMaterial.dispose()}},aLe=class extends fo{constructor(e,t,i){super("TransmissionPass",void 0,t),this.MRTCompatible=!0,this.depthPass=new fH(e,t,{renderTarget:i.transmissionDepthTarget}),this.passThroughMaterial=new oO,this.splineScene=e,this.needsSwap=!1}updatePasses(e){this.passThroughMaterial=new oO,this.depthPass=new fH(this.splineScene,this.camera,{renderTarget:e.transmissionDepthTarget})}setCamera(e){this.camera=e}setScene(e){this.splineScene=e}render(e,t,i){let r=this.camera.layers.mask,n=e;n.setRenderTarget(n.transmissionRenderTarget),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=t.texture[0],n.clear(),n.render(this.scene,this.camera),this.camera.layers.disable(3),this.depthPass.render(e,t,i),n.shadowMap.needsUpdate=!1,n.shadowMap.autoUpdate=!1;let s=this.renderToScreen?null:t;this.camera.layers.set(3),e.setRenderTarget(s),e.render(this.splineScene,this.camera),this.camera.layers.mask=r}},vH=new Ho,oLe=new Zi({transparent:!0,vertexShader:`
        void main() {
            gl_Position = vec4(0.0);
        }
    `,fragmentShader:`
        layout(location = 1) out vec4 gVelocity;

        void main() {
            gl_FragColor = vec4(0.0);
			gVelocity = vec4(0.0);
        }
    `}),lO=class extends fo{constructor(e,t,i){super("OpaquePass",t??vH,i),this.MRTCompatible=!0,this.originalMaterials=[],this.hasTransmissionPass=!1,this.clear=!0,this.clearColorOnly=!1,this.clearDepth=!1,this.needsSwap=!1,this.MRTCompatible=e}setCamera(e){this.camera=e}setScene(e){this.scene=e??vH}getScene(){return this.scene}render(e,t){this.camera.layers.enable(3),this.hasTransmissionPass&&(this.originalMaterials.length=0,this.scene.traverse(r=>{r.layers.isEnabled(3)&&r instanceof xa&&(this.originalMaterials.push([r,r.material]),r.material=oLe)}),e.shadowMap.needsUpdate=!0,e.shadowMap.autoUpdate=!0),this.camera.layers.enable(8);let i=this.renderToScreen?null:t;e.setRenderTarget(i),this.clearColorOnly&&e.clear(!0,!1,!0),this.clear&&e.clear(),e.render(this.scene,this.camera),this.clearDepth&&e.clear(!1,!0,!1),this.hasTransmissionPass&&this.originalMaterials.forEach(r=>{r[0].material=r[1]})}},lLe=class{constructor(e,{depthBuffer:t=!0,stencilBuffer:i=!1,multisampling:r=0,frameBufferType:n=0}={}){this.renderer=e,this.helperStartIndex=0,this.copyPass=new aO,this.depthTexture=null,this.timer=new MIe,this._width=1,this._height=1,this.passes=[],this.helperPasses=[],this.autoRenderToScreen=!0,this.inputBuffer=this.createBuffer(t,i,n,r,!0,"input buffer mrt"),this.inputBufferSingle=this.createBuffer(t,i,n,r,!1," input buffer single"),this.inputBufferSingle.texture.dispose(),this.inputBufferSingle.depthTexture.dispose(),this.inputBufferSingle.texture=this.inputBuffer.texture[0],this.inputBufferSingle.depthTexture=this.inputBuffer.depthTexture,this.outputBuffer=this.inputBuffer.clone(),this.outputBuffer.name="output buffer mrt",this.outputBufferSingle=this.createBuffer(t,i,n,r,!1,"output buffer single"),this.outputBufferSingle.texture.dispose(),this.outputBufferSingle.depthTexture.dispose(),this.outputBufferSingle.texture=this.outputBuffer.texture[0],this.outputBufferSingle.depthTexture=this.outputBuffer.depthTexture,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){let t=this.inputBuffer,i=this.multisampling;i>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("creating new input buffer"),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e,!0,"new input buffer"),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(this.renderer=e,e!==null){let t=e.getSize(new Pe),i=e.getContext().getContextAttributes()?.alpha??!1,r=this.inputBuffer.texture[0].type;r===Ua&&e.outputEncoding===Ri&&(this.inputBuffer.texture[0].encoding=Ri,this.outputBuffer.texture[0].encoding=Ri,this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("doing some kinda dispose??")),e.autoClear=!1,this.setSize(t.width,t.height,!1);for(let n of this.passes)n.initialize(e,i,r)}}replaceRenderer(e,t=!0){let i=this.renderer,r=i.domElement.parentNode;return this.setRenderer(e),t&&r!==null&&(r.removeChild(i.domElement),r.appendChild(e.domElement)),i}createDepthTexture(){let e=this.depthTexture=new ox(this._width,this._height);return this.inputBuffer.depthTexture=e,this.inputBuffer.stencilBuffer?(e.format=Gg,e.type=Dg):e.type=gd,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(let e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,i,r,n,s){let a=this.renderer,o=a===null?new Pe:a.getDrawingBufferSize(new Pe),l={minFilter:Li,magFilter:Li,wrapS:Yr,wrapT:Yr,stencilBuffer:t,depthBuffer:e},u;return r>0?(u=new Ki(o.width,o.height,l),u.samples=r):(n?(u=new aq(o.width,o.height,2,l),u.texture[1].type=Pd):u=new Ki(o.width,o.height,l),u.depthTexture=new ox(2048,2048),u.depthTexture.type=br),i===Ua&&a!==null&&a.outputEncoding===Ri&&(Array.isArray(u.texture)?u.texture.forEach(c=>c.encoding=Ri):u.texture.encoding=Ri),Array.isArray(u.texture)?u.texture.forEach((c,h)=>{c.name=`EffectComposer.Buffer ${n} ${h}`,c.generateMipmaps=!1}):(u.texture.name=`EffectComposer.Buffer ${n}`,u.texture.generateMipmaps=!1),u.name=s,u}addPass(e,t){let i=this.passes,r=this.renderer,n=r.getDrawingBufferSize(new Pe),s=r.getContext().getContextAttributes()?.alpha??!1,a;if(e.MRTCompatible&&(a=this.inputBuffer.texture[0].type),e.MRTCompatible||(a=this.inputBuffer.texture.type),e.setRenderer(r),e.setSize(n.width,n.height),e.initialize(r,s,a),this.autoRenderToScreen&&(i.length>0&&(i[i.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),t!==void 0?i.splice(t,0,e):i.push(e),this.autoRenderToScreen&&(i[i.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){let o=this.createDepthTexture();for(e of i)e.setDepthTexture(o)}else e.setDepthTexture(this.depthTexture)}setHelperStartIndex(e){this.helperStartIndex=e}removePass(e){let t=this.passes,i=t.indexOf(e);if(i!==-1&&t.splice(i,1).length>0){if(this.depthTexture!==null){let r=(n,s)=>n||s.needsDepthTexture;t.reduce(r,!1)||e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null)}this.autoRenderToScreen&&i===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){let e=this.passes;e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){let t=this.renderer,i=this.copyPass,r=this.inputBuffer,n=this.outputBuffer,s=this.inputBufferSingle,a=this.outputBufferSingle,o=!1,l,u,c,h;e===void 0&&(e=this.timer.update().getDelta());for(let d of this.passes)d.enabled&&(d.MRTCompatible?d.render(t,r,n,e,o):d.render(t,s,a,e,o),d.needsSwap&&(o&&(i.renderToScreen=d.renderToScreen,l=t.getContext(),u=t.state.buffers.stencil,u.setFunc(l.NOTEQUAL,1,4294967295),i.render(t,r,n,e,o),u.setFunc(l.EQUAL,1,4294967295)),c=r,h=s,r=n,s=a,n=c,a=h),d instanceof _Ie?o=!0:d instanceof ZRe&&(o=!1))}setSize(e,t,i){let r=this.renderer;if(this._width=e,this._height=t,e===void 0||t===void 0){let s=r.getSize(new Pe);e=s.width,t=s.height}r.setSize(e,t,i);let n=r.getDrawingBufferSize(new Pe);this.inputBuffer.setSize(n.width,n.height),this.outputBuffer.setSize(n.width,n.height),this.inputBufferSingle.setSize(n.width,n.height),this.outputBufferSingle.setSize(n.width,n.height);for(let s of this.passes)s.setSize(n.width,n.height)}reset(){let e=this.timer.isAutoResetEnabled();this.dispose(),this.autoRenderToScreen=!0,this.timer.setAutoResetEnabled(e)}dispose(){for(let e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.inputBufferSingle!==null&&this.inputBufferSingle.dispose(),this.outputBufferSingle!==null&&this.outputBufferSingle.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},uLe=new Zi({name:"CombineMaterial",uniforms:{inputBufferA:new ut(null),inputBufferB:new ut(null)},blending:ns,depthWrite:!1,depthTest:!1,vertexShader:`
varying vec2 vUv;
void main() {
    gl_Position = vec4(position.xy, 1.0, 1.0);
    vUv = position.xy * 0.5 + 0.5;
}
`,fragmentShader:`
    varying vec2 vUv;
    uniform sampler2D inputBufferA;
    uniform sampler2D inputBufferB;

    // TODO: Why do we need these when postpro of framemode is enabled???
    layout(location = 1) out vec4 gVelocity;

    void main() {
	vec4 resA = texture2D(inputBufferA, vUv);
	vec4 resB = texture2D(inputBufferB, vUv);
    float a = resA.a + resB.a * ( 1.0 - resA.a );

	vec4 res;
	res.rgb =  resA.rgb + (resB.rgb * (1.0 - resA.a));
	res.a = resA.a + resB.a * (1.0 - resA.a);
	gl_FragColor = res;
    gVelocity = vec4(0.0);
    }
`}),cLe=class extends fo{constructor(e){super("HelperPass",void 0,e),this.MRTCompatible=!1,this.fullscreenMaterial=uLe,this.helperPass=new lO(!1,void 0,this.camera),this.helperPass.hasTransmissionPass=!1,this.helperPass.clear=!1,this.helperPass.renderToScreen=!1,this.helperPassOnTop=new lO(!1,void 0,this.camera),this.helperPassOnTop.hasTransmissionPass=!1,this.helperPassOnTop.clear=!1,this.helperPassOnTop.renderToScreen=!1;let t=new ZQ({preset:og.LOW,edgeDetectionMode:hT.COLOR});this.effectPass=new sC(this.camera,t),this.rt=new Ki(10,10,{minFilter:Li,magFilter:Li,wrapS:Yr,wrapT:Yr,depthBuffer:!0})}setSize(e,t){this.rt.setSize(e,t),this.effectPass.setSize(e,t)}set sceneHelpers(e){this.helperPass.setScene(e)}get sceneHelpers(){return this.helperPass.getScene()}set sceneHelpersOnTop(e){this.helperPassOnTop.setScene(e)}get sceneHelpersOnTop(){return this.helperPassOnTop.getScene()}setCamera(e){this.helperPass.setCamera(e),this.helperPassOnTop.setCamera(e)}initialize(e,t,i){super.initialize(e,t,i),this.effectPass.initialize(e,t,i)}dispose(){super.dispose(),this.rt.dispose(),this.effectPass.dispose()}render(e,t,i){this.rt.depthTexture=t.depthTexture;let r=e.getClearAlpha();e.setClearAlpha(0),this.helperPass.clearDepth=!0,this.helperPass.clearColorOnly=!0,this.helperPass.render(e,this.rt),this.helperPassOnTop.render(e,this.rt),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.rt,i),this.fullscreenMaterial.uniforms.inputBufferA.value=i.texture,this.fullscreenMaterial.uniforms.inputBufferB.value=t.texture,e.setClearAlpha(r),e.setRenderTarget(null),e.clear(),e.render(this.scene,this.camera)}},hLe=`#define GLSLIFY 1
#include <skinning_pars_vertex>
#include <morphtarget_pars_vertex>
out vec3 n;void main(){
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
vec4 view_space=viewMatrix*modelMatrix*vec4(transformed,1.0);gl_Position=projectionMatrix*view_space;n=normalize(transformedNormal);}`,dLe=`#define GLSLIFY 1
in vec3 n;void main(){gl_FragColor=vec4(n,1.0);}`,fLe=`#define GLSLIFY 1
out vec2 v_uv;void main(){v_uv=uv;gl_Position=vec4(position.xy,1.0,1.0);}`,pLe=`#define GLSLIFY 1
in vec2 v_uv;const float pi=3.14159265;const float num_steps=4.0;const float num_directions=4.0;uniform float near;uniform float far;uniform float fov;uniform vec4 proj_info;uniform bool is_ortho;uniform vec2 resolution;uniform float radius_of_influence;uniform float radius_in_screen_space;uniform float exponent;uniform vec3 ao_color;uniform float bias;uniform sampler2D texture_depth;uniform sampler2D texture_normals;uniform sampler2D texture_blue_noise;uniform sampler2D texture_blue_noise_in_disk;uniform sampler2D texture_color_pass;uniform int frame_index;uniform bool fog_enabled;uniform float fog_near;uniform float fog_far;vec3 uv_to_view_space(vec2 uv,float eye_z){return vec3((uv*proj_info.xy+proj_info.zw)*(is_ortho ? 1.0 : eye_z),eye_z);}float linearize_depth(float depth_sampled){float z=is_ortho ? depth_sampled : depth_sampled*2.0-1.0;return mix((2.0*near*far)/(far+near-z*(far-near)),near+z*(far-near),float(is_ortho));}vec3 get_view_position(vec2 uv_coords){float linear_depth=linearize_depth(texture(texture_depth,uv_coords).x);return uv_to_view_space(uv_coords,linear_depth);}vec3 min_difference(vec3 p,vec3 right,vec3 left){vec3 v1=right-p;vec3 v2=p-left;return(dot(v1,v1)<dot(v2,v2))? v1 : v2;}vec3 rebuild_normal(in vec2 uv,in vec3 p){vec2 one_over_resolution=1.0/resolution;vec3 r=get_view_position(uv+vec2(one_over_resolution.x,0));vec3 l=get_view_position(uv+vec2(-one_over_resolution.x,0));vec3 t=get_view_position(uv+vec2(0,one_over_resolution.y));vec3 b=get_view_position(uv+vec2(0,-one_over_resolution.y));return normalize(cross(min_difference(p,r,l),min_difference(p,t,b)));}float falloff(float distance_squared){float neg_inv_r2=-1.0/(radius_of_influence*radius_of_influence);return distance_squared*neg_inv_r2+1.0;}float ao_contribution(vec3 P,vec3 N,vec3 S){vec3 to_sample=S-P;float norm_squared=dot(to_sample,to_sample);float norm=sqrt(norm_squared);float cos_theta=dot(N,to_sample)/norm;return clamp(cos_theta-bias,0.0,1.0)*clamp(falloff(norm_squared),0.0,1.0);}float compute_ambient_occlusion(vec2 uv,float radius_in_screen_space,vec3 pc,vec3 view_space_n){vec2 one_over_resolution=1.0/resolution;ivec2 noise_uv=ivec2(int(mod(gl_FragCoord.x,128.0)),int(mod(gl_FragCoord.y,128.0)));float noise=texelFetch(texture_blue_noise,noise_uv,0).r;noise=fract(noise+0.61803398875*float(frame_index));float theta=noise*2.0*3.1415;float ct=cos(theta);float st=sin(theta);float step_size=radius_in_screen_space/(num_steps+1.0);const float angle_step=2.0*pi/num_directions;float contribution=0.0;for(int i=0;i<int(num_directions);++i){float current_pixel=step_size+1.0;for(int j=0;j<int(num_steps);++j){int index=i*int(num_steps)+j;vec2 blue_noise_sample=texelFetch(texture_blue_noise_in_disk,ivec2(index,0),0).rg;vec2 disk_point;disk_point.x=blue_noise_sample.x*ct-blue_noise_sample.y*st;disk_point.y=blue_noise_sample.x*st+blue_noise_sample.y*ct;vec2 sample_direction=disk_point;vec2 snapped_uv=round(current_pixel*sample_direction)*one_over_resolution+uv;vec3 ps=get_view_position(snapped_uv);current_pixel+=step_size;contribution+=ao_contribution(pc,view_space_n,ps);}}float mult=1.0/(1.0-bias);contribution*=mult/(num_directions*num_steps);return clamp(1.0-contribution*2.0,0.0,1.0);}
#define USE_GBUFFER_NORMALS
void main(){vec3 view_space_p=get_view_position(v_uv);
#ifdef USE_GBUFFER_NORMALS
vec3 view_space_n=texture(texture_normals,v_uv).rgb;view_space_n.z*=-1.0;
#else
vec3 view_space_n=-rebuild_normal(v_uv,view_space_p);
#endif
float radius_ss=radius_in_screen_space/(is_ortho ? 1.0 : view_space_p.z);float ao=compute_ambient_occlusion(v_uv,radius_ss,view_space_p,view_space_n);float final=pow(ao,exponent);if(view_space_p.z>=far){final=1.0;}vec3 color=mix(ao_color,vec3(1.0),final);if(fog_enabled){float fog_factor=smoothstep(fog_near,fog_far,view_space_p.z);color=mix(color,vec3(1.0),fog_factor);}gl_FragColor=vec4(color,1.0);}`,mLe=`#define GLSLIFY 1
out vec2 v_uv;void main(){gl_Position=vec4(position.xy,1.0,1.0);v_uv=uv;}`,gLe=`#define GLSLIFY 1
in vec2 v_uv;uniform sampler2D texture_ao_lrez;uniform sampler2D texture_depth_lrez;uniform sampler2D texture_depth_hrez;uniform float near;uniform float far;float linearize_depth(float depth_sampled){float z=depth_sampled*2.0-1.0;return(2.0*near*far)/(far+near-z*(far-near));}vec2 nearest_depth_filter(in vec2 uv){vec2 resolution=vec2(textureSize(texture_depth_lrez,0));vec2 texel_size=1.0/resolution;vec2 offset=uv-0.5*texel_size;float d_hrez=texture(texture_depth_hrez,uv).r;float a=abs(d_hrez-texture(texture_depth_lrez,offset).r);float b=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,0.0)).r);float c=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(0.0,texel_size.y)).r);float d=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,texel_size.y)).r);float min_diff=min(a,min(b,min(c,d)));if(min_diff==a)return offset;if(min_diff==b)return offset+vec2(texel_size.x,0.0);if(min_diff==c)return offset+vec2(0.0,texel_size.y);if(min_diff==d)return offset+vec2(texel_size.x,texel_size.y);}void main(){
#ifdef DEBUG
float d_lrez=texture(texture_depth_lrez,v_uv).r;float d_hrez=texture(texture_depth_hrez,v_uv).r;float output_d=mix(linearize_depth(d_lrez)/far,linearize_depth(d_hrez)/far,step(0.5,v_uv.x));gl_FragColor=vec4(vec3(output_d),1.0);
#else
vec2 filtered_uv=nearest_depth_filter(v_uv);vec4 ao=texture(texture_ao_lrez,filtered_uv);gl_FragColor=vec4(ao.rgb,1.0);gl_FragColor=ao;
#endif
}`,Cw=[[.478712,.875764],[-.337956,-.793959],[-.955259,-.028164],[.864527,.325689],[.209342,-.395657],[-.106779,.672585],[.156213,.235113],[-.413644,-.082856],[-.415667,.323909],[.141896,-.93998],[.954932,-.182516],[-.766184,.410799],[-.434912,-.458845],[.415242,-.078724],[.728335,-.491777],[-.058086,-.066401],[.20299,.686837],[-.808362,-.556402],[.507386,-.640839],[-.723494,-.22924],[.48974,.317826],[-.622663,.765301],[-.01064,.929347],[.663146,.647618],[-.096674,-.413835],[.525945,-.321063],[-.122533,.366019],[.195235,-.687983],[-.563203,.098748],[.418563,.561335],[-.378595,.800367],[.826922,.001024],[-.085372,-.766651],[-.92192,.183673],[-.590008,-.721799],[.167751,-.164393],[.032961,-.56253],[.6329,-.107059],[-.46408,.569669],[-.173676,-.958758],[-.242648,-.234303],[-.275362,.157163],[.382295,-.795131],[.562955,.115562],[.190586,.470121],[.770764,-.297576],[.237281,.93105],[-.666642,-.455871],[-.905649,-.298379],[.33952,.157829],[.701438,-.7041],[-.062758,.160346],[-.220674,.957141],[.642692,.432706],[-.77339,-.015272],[-.671467,.24688],[.158051,.062859],[.806009,.527232],[-.05762,-.247071],[.333436,-.51671],[-.550658,-.315773],[-.652078,.589846],[.008818,.530556],[-.210004,.519896]],vLe=new Zi({vertexShader:hLe,fragmentShader:dLe}),ry=new Zi({vertexShader:mLe,fragmentShader:gLe,uniforms:{texture_ao_lrez:new ut(null),texture_depth_lrez:new ut(null),texture_depth_hrez:new ut(null),near:new ut(null),far:new ut(null)}}),yLe=class extends fo{constructor(e,t){super("AmbientOcclusionPass",void 0,t),this.fogEnabled=!1,this.fogNear=1,this.fogFar=1e3,this.frameIndex=0,this._runHalfRes=!0,this._width=1,this._height=1;let i=1024,r=1024;this.gBuffer=new Ki(i,r,{type:Gx?Pd:br,depthTexture:new ox(i,r),minFilter:Li,magFilter:Li}),this.depthBufferHighRes=new Ki(i,r,{depthTexture:new ox(i,r)}),this.aoBuffer=new Ki(i,r,{minFilter:Li,magFilter:Li}),this.splineScene=e,this.splineCamera=t;let n=new Float32Array(Cw.length*2);for(let a=0;a<Cw.length;a++){let o=a*2;n[o+0]=Cw[a][0],n[o+1]=Cw[a][1]}this.blueNoiseInDiskTexture=new oo(n,Cw.length,1,n2,br),this.blueNoiseInDiskTexture.wrapS=md,this.blueNoiseInDiskTexture.wrapT=md,this.blueNoiseInDiskTexture.needsUpdate=!0,this.hbaoMaterial=new Zi({vertexShader:fLe,fragmentShader:pLe,uniforms:{near:new ut(null),far:new ut(null),fov:new ut(null),proj_info:new ut(new bi),is_ortho:new ut(!1),resolution:new ut(new Pe),radius_of_influence:new ut(8),radius_in_screen_space:new ut(1),exponent:new ut(1),ao_color:new ut(new H),bias:new ut(.5),texture_depth:new ut(null),texture_normals:new ut(null),texture_blue_noise:new ut(null),texture_blue_noise_in_disk:new ut(this.blueNoiseInDiskTexture),frame_index:new ut(0),fog_enabled:new ut(!1),fog_near:new ut(1),fog_far:new ut(1e3)}}),this.radius=128,this.aoColor={r:0,g:0,b:0},this.bias=.5,this.hbaoMaterial.uniforms.texture_depth.value=this.gBuffer.depthTexture,this.hbaoMaterial.uniforms.texture_normals.value=this.gBuffer.texture,this.needsSwap=!0,this.aaBuffer=new Ki(i,r,{minFilter:Li,magFilter:Li,wrapS:Yr,wrapT:Yr,depthBuffer:!1,type:br});let s=new ZQ({preset:og.ULTRA,edgeDetectionMode:hT.COLOR});this.effectPass=new sC(this.camera,s)}initialize(e,t,i){super.initialize(e,t,i),this.effectPass.initialize(e,t,i)}setBlueNoiseTexture(e){this.hbaoMaterial.uniforms.texture_blue_noise.value=e}setSize(e,t){this._width=e,this._height=t,this.depthBufferHighRes.setSize(e,t);let i=this._runHalfRes?.5:1,r=e*i,n=t*i;this.gBuffer.setSize(r,n),this.aoBuffer.setSize(r,n),this.hbaoMaterial.uniforms.resolution.value.set(r,n),this.aaBuffer.setSize(r,n),this.effectPass.setSize(r,n)}get runHalfRes(){return this._runHalfRes}set runHalfRes(e){this._runHalfRes=e,this.setSize(this._width,this._height)}setCamera(e){this.splineCamera=e}setScene(e){this.splineScene=e}setDepthTexture(e){this.depthBufferHighRes.depthTexture=e,ry.uniforms.texture_depth_hrez.value=e,ry.needsUpdate=!0}render(e,t,i){this.splineScene.overrideMaterial=vLe;let r=this.splineCamera.layers.mask;if(this.splineCamera.layers.set(5),e.setRenderTarget(this.gBuffer),e.clear(),e.render(this.splineScene,this.splineCamera),e.setRenderTarget(this.depthBufferHighRes),e.clear(),e.render(this.splineScene,this.splineCamera),this.splineScene.overrideMaterial=null,this.splineCamera.layers.mask=r,this.hbaoMaterial.uniforms.radius_of_influence.value=this.radius,this.hbaoMaterial.uniforms.ao_color.value.set(this.aoColor.r,this.aoColor.g,this.aoColor.b),this.hbaoMaterial.uniforms.bias.value=this.bias,this.hbaoMaterial.uniforms.fog_enabled.value=this.fogEnabled,this.hbaoMaterial.uniforms.fog_near.value=this.fogNear,this.hbaoMaterial.uniforms.fog_far.value=this.fogFar,this.hbaoMaterial.uniforms.frame_index.value=this.frameIndex,this.frameIndex++,this.splineCamera.isPerspectiveCamera){this.hbaoMaterial.uniforms.near.value=this.splineCamera.perspCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.perspCamera.far;let n=this.splineCamera.perspCamera.projectionMatrix.elements,s=2/n[0],a=2/n[5],o=-(1-n[8])/n[0],l=-(1+n[9])/n[5];this.hbaoMaterial.uniforms.proj_info.value.set(s,a,o,l);let u=this.splineCamera.perspCamera.fov*(Math.PI/180),c=this.hbaoMaterial.uniforms.resolution.value.y/(Math.tan(u*.5)*2),h=this.hbaoMaterial.uniforms.radius_of_influence.value*.5*c;this.hbaoMaterial.uniforms.radius_in_screen_space.value=h,this.hbaoMaterial.uniforms.is_ortho.value=!1}else{this.hbaoMaterial.uniforms.near.value=this.splineCamera.orthoCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.orthoCamera.far;let n=this.splineCamera.orthoCamera.projectionMatrix.elements,s=2/n[0],a=2/n[5],o=-(1+n[12])/n[0],l=-(1-n[13])/n[5];this.hbaoMaterial.uniforms.proj_info.value.set(s,a,o,l);let u=.5*(this.hbaoMaterial.uniforms.resolution.value.y/a),c=this.hbaoMaterial.uniforms.radius_of_influence.value*u;this.hbaoMaterial.uniforms.radius_in_screen_space.value=c,this.hbaoMaterial.uniforms.is_ortho.value=!0}this.runHalfRes?(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aoBuffer),e.clear(),e.render(this.scene,this.camera),this.fullscreenMaterial=ry,ry.uniforms.texture_ao_lrez.value=this.aoBuffer.texture,ry.uniforms.texture_depth_lrez.value=this.gBuffer.depthTexture,ry.uniforms.texture_depth_hrez.value=this.depthBufferHighRes.depthTexture,e.setRenderTarget(e.aoRenderTarget),e.clear(),e.render(this.scene,this.camera)):(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aaBuffer),e.clear(),e.render(this.scene,this.camera),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.aaBuffer,e.aoRenderTarget))}dispose(){this.gBuffer.dispose(),this.depthBufferHighRes.dispose(),this.aoBuffer.dispose()}},xLe=`
varying vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,wLe=`
uniform sampler2D tInput;
uniform sampler2D tMap;
uniform vec2 resolution;
varying vec2 vUv;

uniform vec2 uResolution;
uniform vec2 uCoords;

// Draws a rectangle at center <st> with size <size>
float rectangle(vec2 st, vec2 size) {
    size = vec2(0.5) - size * 0.5;
    vec2 uv = vec2(step(size.x, st.x), step(size.y, st.y));
    uv *= vec2(step(size.x, 1.0 - st.x), step(size.y, 1.0 - st.y));

    return uv.x * uv.y;
}

uniform vec2 uSize;
uniform float uScale;
uniform float uDPR;
uniform float uCurrent;
uniform vec3 uSceneColor;

void main() {
    vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
    screenUv *= 1.0 / uDPR;

    vec2 center = vec2(0.5, -0.5);
    vec2 outsideUv = screenUv;
    outsideUv += center;
    outsideUv -= uCoords.xy / uResolution.xy;
    outsideUv = (outsideUv - 0.5) + 0.5;
    outsideUv -= center;
    vec2 s = (uSize / uResolution) * uScale;
    float isOutside = 1.0 - rectangle(outsideUv, s);
    
    vec2 mid = vec2(0.5);
    vec2 insideUv = (screenUv - mid + s * mid) / s;
    vec4 background = texture2D(tInput, screenUv);
    vec4 image = texture2D(tMap, insideUv);
    gl_FragColor = mix(image, background, isOutside);
}
`,bLe=class extends Ul{constructor(){super(new Zi({vertexShader:xLe,fragmentShader:wLe,uniforms:{tInput:new ut(null),tMap:new ut(null),uResolution:new ut(new Pe),uSize:new ut(new Pe),uCoords:new ut(new Pe),uScale:new ut(1),uSceneColor:new ut(new li(16711680)),uDPR:new ut(1),uCurrent:new ut(0)}}),"tInput"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tMap.value}set texture(e){this.uniforms.tMap.value=e}},_Le=`
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,SLe=`
uniform sampler2D toScene;
uniform sampler2D fromScene;
uniform vec2 resolution;

uniform vec2 uResolution;
uniform float uDPR;

uniform float mixRatio;
uniform sampler2D tMixTexture;
uniform int useTexture;
uniform float threshold;

void main() {
	vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
	screenUv *= 1.0 / uDPR;

	vec4 texel1 = texture2D( fromScene, screenUv );
	vec4 texel2 = texture2D( toScene, screenUv );

	if (useTexture==1) {
		
		vec4 transitionTexel = texture2D( tMixTexture, screenUv );
		float r = mixRatio * (1.0 + threshold * 2.0) - threshold;
		float mixf=clamp((transitionTexel.r - r)*(1.0/threshold), 0.0, 1.0);
		
		gl_FragColor = mix( texel1, texel2, mixf );
	} else {
		
		gl_FragColor = mix( texel1, texel2, mixRatio );
		
	}
}
`,MLe=[],ALe=class extends Ul{constructor(){super(new Zi({vertexShader:_Le,fragmentShader:SLe,uniforms:{toScene:new ut(null),fromScene:new ut(null),uResolution:new ut(new Pe),uDPR:new ut(1),mixRatio:new ut(0),threshold:new ut(.1),useTexture:new ut(0),tMixTexture:{value:MLe[0]}}}),"toScene"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.fromScene.value}set texture(e){this.uniforms.fromScene.value=e}},ELe=`
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,CLe=`
uniform sampler2D inputBuffer;
uniform sampler2D blurredInputBuffer;
uniform sampler2D overlay;
uniform float blurIntensity;

uniform vec2 uResolution;
uniform float uDPR;

void main() {
	vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
	screenUv *= 1.0 / uDPR;

	vec4 texel1 = texture2D( overlay, screenUv );
	vec4 texel2 = texture2D( inputBuffer, screenUv );
	vec4 texel3 = texture2D( blurredInputBuffer, screenUv );

	float blurMask2 = max(sign(texel1.a), 0.0) * blurIntensity;
    gl_FragColor = mix( mix(texel2, texel3, blurMask2), texel1, texel1.a );
}
`,TLe=class extends Ul{constructor(){super(new Zi({vertexShader:ELe,fragmentShader:CLe,uniforms:{inputBuffer:new ut(null),blurredInputBuffer:new ut(null),overlay:new ut(null),uResolution:new ut(new Pe),uDPR:new ut(1),blurIntensity:new ut(0)}})),this._blurEnabled=!1,this.blurTarget=new Ki(1,1,{minFilter:Li,magFilter:Li,wrapS:Yr,wrapT:Yr}),this.blurPass=new SB({width:window.innerWidth,height:window.innerHeight,kernelSize:dT.HUGE,resolutionScale:.25}),this.blurPass.renderToScreen=!1,this.uniforms.blurredInputBuffer.value=this.blurTarget.texture}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.overlay.value}set texture(e){this.uniforms.overlay.value=e}setResolution(e,t,i=1){this.uniforms.uResolution.value.set(e,t),this.uniforms.uDPR.value=i,this.blurPass.setSize(e,t),this.blurTarget.setSize(e,t),this.blurPass.setSize(e,t)}get uiCanvas(){return this._uiCanvas}set uiCanvas(e){this._uiCanvas=e,e.texture&&(this.uniforms.overlay.value=e.texture);let t=e.frame;if(t){let i=t.data.backgroundBlur,r=i.radius;this._blurEnabled=i.enabled,this.uniforms.blurIntensity.value=this._blurEnabled?1:0,this.blurPass.scale=r/3}}render(e,t,i,r,n){this._blurEnabled&&(this.blurPass.setDepthTexture(this.getDepthTexture()),this.blurPass.render(e,t,this.blurTarget,r,n)),super.render(e,t,i,r,n)}},PLe=`
varying vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,DLe=`
uniform sampler2D tInput;
uniform sampler2D tOverlayImage;
varying vec2 vUv;
uniform vec2 uResolution;
uniform vec2 uRightBottom;
uniform vec2 uImageSize;
uniform float uScale;
uniform float uDPR;

vec3 blendNormal(vec3 base, vec3 blend) {
	return blend;
}

vec3 blendNormal(vec3 base, vec3 blend, float opacity) {
	return (blendNormal(base, blend) * opacity + base * (1.0 - opacity));
}

vec4 drawFixedSizeImage(sampler2D image, vec2 screenUV, vec2 imageSize, vec2 imageCoords, vec2 screenSize, float dpr) {
	vec2 uv = (screenUV * screenSize * dpr - imageCoords) / (imageSize * dpr);
	if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {
		return vec4(0.0);
	}
	return texture2D(image, uv);
}

void main() {
    vec2 screenUV = gl_FragCoord.xy / (uResolution.xy * uDPR);
	vec2 imageCoords = vec2(uResolution.x * uDPR - uImageSize.x * uScale * uDPR - uRightBottom.x * uDPR, uRightBottom.y * uDPR);
    vec4 background = texture2D(tInput, screenUV);
    vec4 image = drawFixedSizeImage(tOverlayImage, screenUV, uImageSize * uScale, imageCoords, uResolution, uDPR);
    gl_FragColor = vec4(blendNormal(background.rgb, image.rgb, image.a), max(background.a, image.a));
}
`,RLe=class extends Ul{constructor(){super(new Zi({vertexShader:PLe,fragmentShader:DLe,uniforms:{tInput:new ut(null),tOverlayImage:new ut(null),uResolution:new ut(new Pe),uImageSize:new ut(new Pe),uRightBottom:new ut(new Pe(20,20)),uScale:new ut(.25),uDPR:new ut(1)}}),"tInput")}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tOverlayImage.value}set texture(e){this.uniforms.tOverlayImage.value=e,this.uniforms.uImageSize.value.set(e.image.width,e.image.height)}};function yH(e,t){return t&&t.enabled&&e.push(t.effect),e}var ILe=e=>Object.values(er).includes(e)?e:er.NORMAL,LLe=class extends Ys{constructor(e,t){super(),this._needsDOFResize=t,this.postprocessingState=F2.defaultData,this._scene=new Ho,this._camera=new Ms,this.effects=new Map,this.blueNoiseTexture=new oo,this._renderToScreen=!0,this._isUIOverlayEnabled=!1,this.clock=new x0e,this.renderer=e,this.debug=!1,this.effects.set("bloom",new qIe),this.effects.set("chromaticAberration",new YIe),this.effects.set("vignette",new JIe),this.effects.set("noise",new ZIe),this.effects.set("colorAverage",new QIe),this.effects.set("hueSaturation",new KIe),this.effects.set("brightnessContrast",new XIe),this.effects.set("depthOfField",new $Ie),this.effects.set("pixelation",new eLe),this.effectComposer=new lLe(this.renderer),this.effectComposer.autoRenderToScreen=!1,this.opaquePass=new lO(!0,this.scene,this.camera),this.opaquePass.clear=!0,this.transmissionPass=new aLe(this.scene,this.camera,this.renderer),this.aoPass=new yLe(this.scene,this.camera),this.taaPass=new sLe,this.taaPass.renderToScreen=!1,this.helperPass=new cLe(this.camera),this.helperPass.renderToScreen=!1,this.stylesOverlayPass=new bLe,this.stylesOverlayPass.enabled=!1,this.uiOverlayPass=new TLe,this.uiOverlayPass.enabled=!1,this.logoOverlayPass=new RLe,this.logoOverlayPass.enabled=!1,this.sceneTransitionPass=new ALe,this.sceneTransitionPass.enabled=!1,this._initCopyPass(),this._initPasses()}set overlayTexture(e){e!==void 0?(this.stylesOverlayPass.texture=e,this.stylesOverlayPass.enabled=!0):this.stylesOverlayPass.enabled=!1}get overlayTexture(){return this.stylesOverlayPass.texture}set sceneHelpers(e){this.helperPass.sceneHelpers=e}get sceneHelpers(){return this.helperPass.sceneHelpers}set sceneHelpersOnTop(e){this.helperPass.sceneHelpersOnTop=e}get sceneHelpersOnTop(){return this.helperPass.sceneHelpersOnTop}get scene(){return this._scene}set scene(e){this._scene=e,this.opaquePass.setScene(e),this.transmissionPass.setScene(e),this.aoPass.setScene(e)}get camera(){return this._camera}set camera(e){let t=this._camera!==e;this._camera=e,this.opaquePass.setCamera(e),this.transmissionPass.setCamera(e),t&&this.transmissionPass.updatePasses(this.renderer),this.aoPass.setCamera(e),this.helperPass.setCamera(e),this.effects.get("depthOfField").setCamera(e)}updateRenderToScreen(){let e=!1;for(let t=this.effectComposer.passes.length-1;t>=0;t--){let i=this.effectComposer.passes[t];if(i.enabled===!0&&!e&&this._renderToScreen){i.renderToScreen=!0,e=!0;continue}i.renderToScreen=!1}}get isUIOverlayEnabled(){return this._isUIOverlayEnabled}disableUIOverlay(){this._isUIOverlayEnabled=!1}enableUIOverlay(){this._isUIOverlayEnabled=!0}disableHelpers(){this.helperPass.enabled=!1,this.updateRenderToScreen()}enableHelpers(){this.helperPass.enabled=!0,this.updateRenderToScreen()}updateBlueNoiseTexture(e){this.blueNoiseTexture=new oo(e,128,128),this.blueNoiseTexture.wrapS=md,this.blueNoiseTexture.wrapT=md,this.blueNoiseTexture.minFilter=Ni,this.blueNoiseTexture.magFilter=Ni,this.blueNoiseTexture.needsUpdate=!0}setAmbientOcclusionParams(e,t,i,r,n,s,a,o){this.aoPass.enabled=e,this.aoPass.radius=t,this.aoPass.bias=i,this.aoPass.aoColor=r,this.aoPass.fogEnabled=n,this.aoPass.fogNear=s,this.aoPass.fogFar=a,this.aoPass.runHalfRes!==!o&&(this.aoPass.runHalfRes=!o)}setTransmissionPassEnabled(e){this.transmissionPass.enabled=e,this.opaquePass.hasTransmissionPass=e}_initPasses(){if(this.uvEffectPass?.dispose(),this.effectPass?.dispose(),this.effectComposer.removeAllPasses(),this.transmissionPass.updatePasses(this.renderer),this.effectComposer.addPass(this.aoPass),this.effectComposer.addPass(this.opaquePass),this.effectComposer.addPass(this.transmissionPass),this.effectComposer.addPass(this.taaPass),this.postprocessingState.enabled){let e=[this.effects.get("pixelation")].reduce(yH,[]);e.length>0&&(this.uvEffectPass=new sC(this.camera,...e),this.uvEffectPass.renderToScreen=!1,this.effectComposer.addPass(this.uvEffectPass));let t=[this.effects.get("chromaticAberration"),this.effects.get("bloom"),this.effects.get("depthOfField"),this.effects.get("colorAverage"),this.effects.get("hueSaturation"),this.effects.get("brightnessContrast"),this.effects.get("vignette"),this.effects.get("noise")].reduce(yH,[]);if(t.length>0&&(this.effectPass=new sC(this.camera,...t),this.effectPass.renderToScreen=!1,this.effectComposer.addPass(this.effectPass),this._needsDOFResize&&this.effects.get("depthOfField")?.enabled&&window!==void 0)){let i=this.renderer.viewportWidth,r=this.renderer.viewportHeight;this.renderer.setSize(i-1,r-1),this.renderer.setSize(i,r)}}this.effectComposer.addPass(this.stylesOverlayPass),this.effectComposer.addPass(this.uiOverlayPass),this.effectComposer.addPass(this.sceneTransitionPass),this.effectComposer.addPass(this.helperPass),this.effectComposer.addPass(this.logoOverlayPass)}_initCopyPass(){if(this._savePass)return;let e=new Pe;this.renderer.getDrawingBufferSize(e),this._rt=new Ki(e.x,e.y,{depthBuffer:!1,stencilBuffer:!1,wrapS:md,wrapT:md}),this._rt.samples=0,this._savePass=new aO(this._rt,!1),this._savePass.renderToScreen=!1}setCopyPass(e){this._rt=e,this._savePass=new aO(this._rt,!1),this.renderToScreen=!1}get renderToScreen(){return this._renderToScreen}set renderToScreen(e){if(this._renderToScreen===e)return;let t=this.effectComposer;!t||(e===!0?t.removePass(this._savePass):t.addPass(this._savePass),this._renderToScreen=e,this.updateRenderToScreen())}set sceneTransitionFromTexture(e){e!==this.sceneTransitionPass.texture&&(e!==null?this.sceneTransitionPass.enabled=!0:(this.sceneTransitionPass.enabled=!1,this.updateRenderToScreen()),this.sceneTransitionPass.texture=e)}setWatermark(e){this.logoOverlayPass.enabled=e!==null,e&&(this.logoOverlayPass.texture=e)}get texture(){return this._rt&&this._rt.texture}get renderTarget(){return this._rt}updatePostprocessing(e){let{enabled:t,...i}=e,r=!1;t!==this.postprocessingState.enabled&&(r=!0);for(let n of Object.entries(i)){let s=n[1],a=this.effects.get(n[0]);if(a){a.enabled!==s.enabled&&(r=!0),a.enabled=s.enabled;for(let[o,l]of Object.entries(s))o==="blendFunction"?a.blendFunction=ILe(l):a[o]=l}}this.postprocessingState=e,r&&this._initPasses()}render(){this.effectComposer.render(this.clock.getDelta())}setScissor(e,t,i,r){e instanceof bi?(this.effectComposer.inputBuffer.scissor.set(e.x,e.y,e.z,e.w),this.effectComposer.outputBuffer.scissor.set(e.x,e.y,e.z,e.w)):(this.effectComposer.inputBuffer.scissor.set(e,t,i,r),this.effectComposer.outputBuffer.scissor.set(e,t,i,r));let n=this.renderer.getPixelRatio();this.effectComposer.inputBuffer.scissor.multiplyScalar(n),this.effectComposer.outputBuffer.scissor.multiplyScalar(n),this.renderer.setScissor(e,t,i,r)}setScissorTest(e){this.effectComposer.inputBuffer.scissorTest=e,this.effectComposer.outputBuffer.scissorTest=e,this.renderer.setScissorTest(e)}setViewport(e,t,i,r){e instanceof bi?(this.effectComposer.inputBuffer.viewport.copy(e),this.effectComposer.outputBuffer.viewport.copy(e)):(this.effectComposer.inputBuffer.viewport.set(e,t,i,r),this.effectComposer.outputBuffer.viewport.set(e,t,i,r))}resize(e,t,i){if(this.effectComposer.setSize(e,t,i),this._rt){let r=this.renderer.getPixelRatio();this._rt.setSize(e*r,t*r)}}dispose(){this.uvEffectPass?.dispose(),this.effectPass?.dispose(),this.effectComposer.dispose()}},OLe=e=>`

// PCSS implementation based on:
// https://www.gamedev.net/articles/programming/graphics/contact-hardening-soft-shadows-made-fast-r4906/
// NOTE: This number affects how big the shadow blur can
// possibly get. Bigger number == bigger blur, but less precise results

const float  gPenumbraFilterSize = 80.0;
const int   gPenumbraSamples = ${e};
const int gShadowSamples = ${e};
const float gShadowSamplesRpc = 1.0f / float(gShadowSamples);

#ifdef USE_SHADOWMAP
    #if NUM_DIR_LIGHT_SHADOWS > 0

        uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];

        struct DirectionalLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];

    #endif

    #if NUM_SPOT_LIGHT_SHADOWS > 0

        uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
        varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_SHADOWS ];

        struct SpotLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];

    #endif

    #if NUM_POINT_LIGHT_SHADOWS > 0

        uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
        varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];

        struct PointLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
            float shadowCameraNear;
            float shadowCameraFar;
        };

        uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];

    #endif

    /*
    #if NUM_RECT_AREA_LIGHTS > 0

        // TODO (abelnation): create uniforms for area light shadows

    #endif
    */

float computePenumbra(int index, sampler2D shadowMap, float temporalAngle, float texelSize, vec2 uv, float compare, float texelScalar, float shadowRadius)
{
    float penumbra = 1.0;
    float blockerDepthAvg = 0.0;
    float blockerCount = 0.0;

    #pragma unroll_loop_start
    for(int i = 0; i < gPenumbraSamples; i ++)
    {
        vec2 offset = (vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize) * texelScalar;
        float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) );

        if(depth < compare + 0.0001)
        {
            blockerDepthAvg += depth;
            blockerCount++;
        }
    }
    #pragma unroll_loop_end

    if (blockerCount > 0.0)
    {
        blockerDepthAvg /= blockerCount;

        // Compute penumbra
        penumbra = (compare - blockerDepthAvg) / (blockerDepthAvg);
        penumbra *= penumbra;
        penumbra *= 200.0 * penumbraSize[min(index, 5 - 1)]; // Magic number that affects how quickly the penumbra grows

        return clamp(penumbra, 0.00, 1.0);
    }
    return 0.0;
}

float vogelShadow(int index, sampler2D shadowMap, vec2 uv, float texelSize, float compare, float shadowRadius)
{
    float shadow         = 0.0f;

    // NOTE: When using TAA, we should use screen space interleaved gradient noise
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    float texelScalar = (gPenumbraFilterSize) / (texelSize * 1024.);
    float penumbra = computePenumbra(index, shadowMap, temporalAngle, texelSize, uv, compare, texelScalar, shadowRadius);
    if (penumbra == -1.0) {
        return 1.0;
    }

    #pragma unroll_loop_start
    for (int i = 0; i < gShadowSamples; i++)
    {
        vec2 vogelSample =  vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;
        // Overall blurring offset
        vec2 offset = vogelSample * (shadowRadius * 2.);

        // Penumbra offset
        offset += vogelSample * (penumbra * texelScalar);

        shadow += step( compare, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
    }
    #pragma unroll_loop_end

    return shadow * gShadowSamplesRpc;
}


    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {

        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );

    }

    vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {

        return unpackRGBATo2Half( texture2D( shadow, uv ) );

    }

    float VSMShadow (sampler2D shadow, vec2 uv, float compare ){

        float occlusion = 1.0;

        vec2 distribution = texture2DDistribution( shadow, uv );

        float hard_shadow = step( compare , distribution.x ); // Hard Shadow

        if (hard_shadow != 1.0 ) {

            float distance = compare - distribution.x ;
            float variance = max( 0.00000, distribution.y * distribution.y );
            float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality
            softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed
            occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );

        }
        return occlusion;

    }

    float getShadow( int i, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {

        float shadow = 1.0;

        shadowCoord.xyz /= shadowCoord.w;
        shadowCoord.z += shadowBias;

        // if ( something && something ) breaks ATI OpenGL shader compiler
        // if ( all( something, something ) ) using this instead

        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
        bool inFrustum = all( inFrustumVec );

        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );

        bool frustumTest = all( frustumTestVec );

        if ( frustumTest ) {

        #if defined( SHADOWMAP_TYPE_PCF )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            return vogelShadow(i, shadowMap, shadowCoord.xy, texelSize.x, shadowCoord.z, shadowRadius );

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            float dx = texelSize.x;
            float dy = texelSize.y;

            vec2 uv = shadowCoord.xy;
            vec2 f = fract( uv * shadowMapSize + 0.5 );
            uv -= f * texelSize;

            shadow = (
                texture2DCompare( shadowMap, uv, shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
                          f.x ),
                     mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
                          f.x ),
                     f.y )
            ) * ( 1.0 / 9.0 );

        #elif defined( SHADOWMAP_TYPE_VSM )

            shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );

        #else // no percentage-closer filtering:

            shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );

        #endif

        }

        return shadow;

    }

    // cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D
    // vector suitable for 2D texture mapping. This code uses the following layout for the
    // 2D texture:
    //
    // xzXZ
    //  y Y
    //
    // Y - Positive y direction
    // y - Negative y direction
    // X - Positive x direction
    // x - Negative x direction
    // Z - Positive z direction
    // z - Negative z direction
    //
    // Source and test bed:
    // https://gist.github.com/tschw/da10c43c467ce8afd0c4

    vec2 cubeToUV( vec3 v, float texelSizeY ) {

        // Number of texels to avoid at the edge of each square

        vec3 absV = abs( v );

        // Intersect unit cube

        float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
        absV *= scaleToCube;

        // Apply scale to avoid seams

        // two texels less per square (one texel will do for NEAREST)
        v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );

        // Unwrap

        // space: -1 ... 1 range for each square
        //
        // #X##         dim    := ( 4 , 2 )
        //  # #         center := ( 1 , 1 )

        vec2 planar = v.xy;

        float almostATexel = 1.5 * texelSizeY;
        float almostOne = 1.0 - almostATexel;

        if ( absV.z >= almostOne ) {

            if ( v.z > 0.0 )
                planar.x = 4.0 - v.x;

        } else if ( absV.x >= almostOne ) {

            float signX = sign( v.x );
            planar.x = v.z * signX + 2.0 * signX;

        } else if ( absV.y >= almostOne ) {

            float signY = sign( v.y );
            planar.x = v.x + 2.0 * signY + 2.0;
            planar.y = v.z * signY - 2.0;

        }

        // Transform to UV space

        // scale := 0.5 / dim
        // translate := ( center + 0.5 ) / dim
        return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );

    }

    float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {

        float shadow = 1.0;
        vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );

        // for point lights, the uniform @vShadowCoord is re-purposed to hold
        // the vector from the light to the world-space position of the fragment.
        vec3 lightToPosition = shadowCoord.xyz;

        // dp = normalized distance from light to fragment position
        float compare = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?
        compare += shadowBias;

        // bd3D = base direction 3D
        vec3 bd3D = normalize( lightToPosition );

        vec2 halton = haltonSequence[frameIndex];
        float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
        float temporalAngle  = temporalOffset * PI2;

        #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_VSM )
            for (int i = 0; i < gShadowSamples; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                // NOTE: Removed for now
                // Penumbra offset
                //offset += vec3(vogelSample.x, vogelSample.y, vogelSample.y)  * (penumbra * gPenumbraFilterSize);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * gShadowSamplesRpc;

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )
            for (int i = 0; i < 16; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * (1.0 / 16.0);
        #else // no percentage-closer filtering

            return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), compare );

        #endif

    }

#endif
`,zLe=Ii.lights_fragment_begin,kLe=Ii.shadowmask_pars_fragment,xH=null,BLe=e=>{switch(e){case"low":return 8;case"medium":return 16;case"high":return 32;default:return 16}},NLe=(e="medium")=>{if(xH===e)return!1;xH=e;let t=BLe(e);Ii.shadowmap_pars_fragment=OLe(t);let i=zLe.slice();i=i.replace("getShadow( spotShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX + 3, spotShadowMap[ i ]"),i=i.replace("getShadow( directionalShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX, directionalShadowMap[ i ]"),Ii.lights_fragment_begin=i;let r=kLe.slice();return r=r.replaceAll("getShadow(","getShadow( UNROLLED_LOOP_INDEX, "),Ii.shadowmask_pars_fragment=r,!0},FLe=`
attribute vec3 randomColor;
varying vec3 vNormal;
flat out vec3 vColor;
#include <skinning_pars_vertex>
#include <morphtarget_pars_vertex>
	
void main()
{
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
vec3 transformed = vec3(position);
#include <morphtarget_vertex>
#include <skinning_vertex>

vNormal = normal;
vColor = randomColor;
gl_Position = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));
}
`,ULe=`
uniform float depthContrast;
varying vec3 vNormal;
flat in vec3 vColor;
void main()
{
vec3 normal = (normalize(vNormal)).rgb;

float contrastDepth = (gl_FragCoord.z - 0.5) * depthContrast + 0.5;

vec3 resultColor = mix(mix(vColor, normal, 0.2), vec3(contrastDepth), 0.4);
gl_FragColor = vec4(resultColor, vColor.r);
gl_FragColor = vec4(resultColor, vColor.r);
}
`,BD=new Zi({vertexShader:FLe,fragmentShader:ULe,uniforms:{depthContrast:{value:1}}}),wH=new tn,bH=new Pe,VLe=class extends mq{constructor(e){super(e),this._pixelRatio=this.getPixelRatio(),this.viewportWidth=1,this.viewportHeight=1,this.resolution=new Pe,this.dummyCamera=new Ms,this.sceneTransitionDuration=0,this.sceneTransitionTimeRemaining=-1,this.isXRCopyPassSet=!1,this.clear=(n=!0,s=!0,a=!0)=>{let o=this.getContext(),l=0;n&&(l|=o.COLOR_BUFFER_BIT),s&&(l|=o.DEPTH_BUFFER_BIT),a&&(l|=o.STENCIL_BUFFER_BIT),o.clear(l),o.clearBufferfv(o.COLOR,1,[0,0,0,1])},this.pipeline=new LLe(this,e?.needsDOFResize??!1),this.autoClear=!1;let t=this.setPixelRatio.bind(this),i=this.setSize.bind(this);this.shadowMap.enabled=!0,this.shadowMap.type=Gz,this.dummyCamera.matrixAutoUpdate=!1,this.domElement.removeAttribute("data-engine");let r=this.getContext();if(r&&"drawingBufferColorSpace"in r)try{r.drawingBufferColorSpace="display-p3"}catch(n){console.warn(n)}this.setPixelRatio=n=>{this._pixelRatio!==n&&(this._pixelRatio=n,t(n))},this.setSize=(n,s,a=!0)=>{(this.viewportWidth!==n||this.viewportHeight!==s)&&(this.viewportWidth=n,this.viewportHeight=s,i(n,s,a),this.normalRenderTarget?.setSize(n*this._pixelRatio,s*this._pixelRatio),this._resizeTransmission(n,s),this.transmissionDepthTarget?.setSize(n*this._pixelRatio/2,s*this._pixelRatio/2),this.pipeline.resize(n,s,a))},this._superDispose=this.dispose,this.dispose=this._currentDispose}createAORenderTarget(){this.aoRenderTarget===void 0&&(this.aoRenderTarget=new Ki(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:Li,magFilter:Li,wrapS:Yr,wrapT:Yr,depthBuffer:!1}))}_resizeTransmission(e,t){this.transmissionRenderTarget?.setSize(e*this._pixelRatio/(this.hdTransmission?1:2),t*this._pixelRatio/(this.hdTransmission?1:2)),this.aoRenderTarget?.setSize(e*this._pixelRatio/1,t*this._pixelRatio/1)}get hdTransmission(){return oi.transmissionLod.value===1}set hdTransmission(e){oi.transmissionLod.value=e===!0?1:2,this._resizeTransmission(this.viewportWidth,this.viewportHeight)}createTransmissionRenderTarget(){this.transmissionRenderTarget===void 0&&(this.transmissionRenderTarget=new Ki(this.viewportWidth*this._pixelRatio/(this.hdTransmission?1:2),this.viewportHeight*this._pixelRatio/(this.hdTransmission?1:2),{generateMipmaps:!0,minFilter:sx,magFilter:Li,wrapS:Yr,wrapT:Yr,depthBuffer:!1}),this.transmissionDepthTarget=new Ki(this.viewportWidth*this._pixelRatio/2,this.viewportHeight*this._pixelRatio/2,{minFilter:Ni,magFilter:Ni,depthBuffer:!1}))}createNormalRenderTarget(){this.normalRenderTarget===void 0&&(this.normalRenderTarget=new Ki(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:Ni,magFilter:Ni,type:br,depthTexture:new ox(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio)}))}renderNormal(e,t,i){this.normalRenderTarget&&(this.setClearColor(0),i.layers.enable(8),i.layers.disable(0),i.layers.disable(3),t.traverseEntity(r=>{r.layers.isEnabled(8)&&(r.copyPreviousMatrix=!1)}),this.setRenderTarget(this.normalRenderTarget),this.clear(),i instanceof Ms?BD.uniforms.depthContrast.value=(i.far-i.near)/1e4:BD.uniforms.depthContrast.value=1,t.overrideMaterial=BD,this.render(t,i),this.setClearColor(t.bgColor,t.bgColor.a),this.setRenderTarget(null),t.overrideMaterial=e.wireframeState?mO:null,i.layers.enable(0),i.layers.enable(3),t.traverseEntity(r=>{r.layers.isEnabled(8)&&(r.copyPreviousMatrix=!0)}))}renderSplineSceneWithDummyCamera(e,t,i=1){this.dummyCamera.updateCameraState(t.dataPatched),this.dummyCamera.matrix.copy(t.matrixWorld);let r=t.height,n=t.width,s=this.viewportWidth/this.viewportHeight;n<r?n=r*s:r=n/s,this.dummyCamera.setViewplaneSize(n,r);for(let a=0;a<i;a++)this.renderSplineScene(e,this.dummyCamera)}renderSplineScene(e,t,{sceneHelpers:i=this.sceneHelpers,sceneHelpersOnTop:r=this.sceneHelpersOnTop,overrideTransmission:n=void 0,overrideNormal:s=void 0}={}){let a=e instanceof RB?e.activePage:e,o=a.visible;a.visible=!0;let l=a.scene;this.xr.enabled&&(this.isXRCopyPassSet===!1&&this.getRenderTarget()!==null&&(this.pipeline.setCopyPass(this.getRenderTarget()),this.isXRCopyPassSet=!0),this.xr.updateCamera(t)),this.setClearColor(a.bgColor,a.bgColor.a),a.penumbraSizeArray.forEach((d,p)=>{oi.penumbraSize.value[p]=d}),oi.pixelRatioNode.value=this.getPixelRatio(),this.resolution.x!==0&&this.resolution.y!==0?oi.resolution.value.set(this.resolution.x,this.resolution.y):oi.resolution.value.set(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio),s!==void 0?(oi.normalRenderTarget.value=s,oi.normalRenderTargetDepth.value=wH):l.needsNormal()&&(this.createNormalRenderTarget(),oi.normalRenderTarget.value=this.normalRenderTarget.texture,oi.normalRenderTargetDepth.value=this.normalRenderTarget.depthTexture,this.renderNormal(l,a,t));let u=a.data.ao,c=u.occlusion;if(c&&(this.createAORenderTarget(),oi.aoRenderTarget.value=this.aoRenderTarget.texture),oi.aoEnabled.value=c,this.pipeline.setAmbientOcclusionParams(u.occlusion,u.radius,u.bias,a.aoColor,a.fog!==null,a.backupFog.near,a.backupFog.far,u.aoFullRes&&!Gx),this.pipeline.aoPass.setBlueNoiseTexture(this.pipeline.blueNoiseTexture),this.pipeline.isUIOverlayEnabled&&a.uiCanvas?.enabled&&a.uiCanvas.texture&&a.uiCanvas.texture.image.width>0){let d=this.getSize(bH),p=this.getPixelRatio();(a.uiCanvas.width!==this.viewportWidth||a.uiCanvas.height!==this.viewportHeight||a.uiCanvas.dpr!==p)&&a.uiCanvas.applySize({width:this.viewportWidth,height:this.viewportHeight},p),a.uiCanvas.render(this),this.pipeline.uiOverlayPass.uiCanvas=a.uiCanvas,this.pipeline.uiOverlayPass.enabled=!0,this.pipeline.uiOverlayPass.setResolution(d.x,d.y,p),this.pipeline.updateRenderToScreen()}else this.pipeline.uiOverlayPass.enabled=!1,this.pipeline.updateRenderToScreen();if(this.pipeline.logoOverlayPass.enabled){let d=this.getSize(bH),p=this.getPixelRatio();this.pipeline.logoOverlayPass.uniforms.uResolution.value.set(d.x,d.y),this.pipeline.logoOverlayPass.uniforms.uDPR.value=p}let h=!1;if(n!==void 0)oi.transmissionRenderTarget.value=n,oi.transmissionRenderTargetDepth.value=wH,this.pipeline.setTransmissionPassEnabled(!1);else{let d=l.needsTransmission();d&&(this.transmissionRenderTarget===void 0&&(h=!0),this.createTransmissionRenderTarget(),oi.transmissionRenderTarget.value=this.transmissionRenderTarget.texture,oi.aspectRatio.value=I3e(this.viewportWidth,this.viewportHeight),oi.transmissionRenderTargetDepth.value=this.transmissionDepthTarget.texture),this.pipeline.setTransmissionPassEnabled(d)}t.layers.enable(3),t.layers.enable(8),this.pipeline.sceneHelpers=i,this.pipeline.sceneHelpersOnTop=r,this.pipeline.taaPass.enabled=oi.taaEnabled.value,this.pipeline.scene=a,this.pipeline.camera=t,h&&this.pipeline.transmissionPass.updatePasses(this),this.pipeline.postprocessingState!==a.postprocessing&&(this.pipeline.updatePostprocessing(a.postprocessing),!i&&!r&&this.pipeline.disableHelpers()),this.clearAlphaOverride!==void 0&&this.setClearAlpha(this.clearAlphaOverride),l.shapeBlendIntances.forEach(d=>{d.onBeforeShadowPass(this)}),a.overrideMaterial=l.wireframeState?mO:null,this.pipeline.render(),oi.taaEnabled.value&&(oi.frameIndex.value=(oi.frameIndex.value+1)%16),t instanceof Ms&&t.copyHistory(),a.visible=o}renderFromSceneForSceneTransitionPass(e,t,i){this.pipeline.renderToScreen=!1,this.pipeline.renderTarget,this.renderSplineScene(e,t),this.pipeline.sceneTransitionFromTexture=this.pipeline.renderTarget.texture,this.sceneTransitionDuration=i,this.sceneTransitionTimeRemaining=i,this.pipeline.renderToScreen=!0;let r=this.pipeline.sceneTransitionPass.uniforms;r.uDPR.value=window.devicePixelRatio,r.uResolution.value.set(this.domElement.width,this.domElement.height).divideScalar(window.devicePixelRatio)}_currentDispose(){this._superDispose(),this.pipeline.dispose(),this.aoRenderTarget?.dispose(),this.transmissionRenderTarget?.dispose(),this.transmissionDepthTarget?.dispose(),this.normalRenderTarget?.dispose(),this.normalRenderTarget?.depthTexture?.dispose()}},JQ=class extends Q_(z0e){constructor(e,t=15,i=10066329){super(e,t,i),this.object=e,this.added=!1,this.name=`DirectionalLightHelper: ${e.uuid}`}raycast(e,t){K_(this.object,JQ.geometryHelper,e,t)}},$Q=class extends Q_(O0e){constructor(e,t=15,i=6710886){super(e,t,i),this.object=e,this.name=`PointLightHelper: ${e.uuid}`}raycast(e,t){K_(this.object,$Q.geometryHelper,e,t)}},uO=class extends Q_(L0e){constructor(e,t=6710886){super(e,t),this.object=e,this.name=`SpotLightHelper: ${e.uuid}`}raycast(e,t){K_(this.object,uO.geometryHelper,e,t)}update(){if(this.object!==void 0){let e=uO._vector,t=this.object.distance?this.object.distance:1e3,i=t*Math.tan(this.object.angle);this.cone.scale.set(i,i,t),e.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(e);let r=this.color!==void 0?this.color:this.light.color;if(this.cone.material instanceof Array)for(let n=0,s=this.cone.material.length;n<s;n++)this.cone.material[n].color.set(r);else this.cone.material.color.set(r)}}},eK=uO;eK._vector=new H;var tK=class extends yd{constructor(){super(),this.caretIndex=0,this._caretVisibleAlpha=1,this._selectionVisibleAlpha=.3,this.current={start:0,end:void 0},this.matrixAutoUpdate=!1,this.caretMesh=new zr(new Zc(1,1),new Dd({transparent:!0,opacity:0,side:Ba})),this.add(this.caretMesh),this.selectionMesh=new zr(new Zc(1,1),new Dd({color:2857471,transparent:!0,depthTest:!1,depthWrite:!1,opacity:0,side:Ba})),this.add(this.selectionMesh),this.hide()}get caretHeight(){return this.object?.AD??0}show(e){this.visible=!0,this.object=e,this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.y=-this.caretHeight*.5,this.setCaretPosition(this.caretIndex),this.update()}hide(){this.visible=!1}update(){if(this.object===void 0)return;this.updateHelperMatrix();let{depth:e}=this.object.geometry.userData.parameters;this.caretMesh.position.z=e,this.selectionMesh.position.z=e}updateHelperMatrix(){if(this.object===void 0)return;let e=this.object,t=e.parent;t!==null&&t.updateWorldMatrix(!0,!1),e.matrixAutoUpdate&&e.updateMatrix(),t!==null?(this.matrixWorld.multiplyMatrices(t.matrixWorld,e.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,e.matrix)):this.matrixWorld.multiplyMatrices(e.hiddenMatrix,e.matrix),this.matrix.copy(this.matrixWorld);for(let i of this.children)i.matrixWorld.copy(this.matrixWorld);e.updateWorldMatrix(!0,!0)}setCaretColor(e){let t=this.caretMesh.material;t.color.setRGB(e.r,e.g,e.b);let i=this._caretVisibleAlpha===t.opacity;this._caretVisibleAlpha=e.a,i&&(t.opacity=this._caretVisibleAlpha)}setSelectionColor(e){this.selectionMesh.material.color.setRGB(e.r,e.g,e.b)}setCaretPosition(e,t={}){if(this.object===void 0)return;this.caretIndex=e;let i=this.object.wrappedText,[r,n]=aC(i,e),[s,a]=e>0?aC(i,e-1):[null,null];(e>0&&i.length?i[s].charAt(a):null)===`
`&&(r++,n=0),this.current.start=e,this.current.end=void 0;let[o,l]=ND(this.object,r,n),{AD:u,descender:c}=this.object,h=c+u*.5,{width:d,height:p,depth:m}=this.object.geometry.userData.parameters,v=typeof d=="string"?0:d,g=typeof p=="string"?0:p;this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.set(o-v*.5,l+h+g*.5,m),this.hideSelectionMesh(),this.showCaretMesh()}setSelection(e,t){if(this.object===void 0)return;let i=this.object.wrappedText;this.current.start=e,this.current.end=t;let r=[],n=[],s=jLe(i,e,t),{lineHeight:a,AD:o,descender:l}=this.object,u=l+o*.5-a*.5;for(let[g,w,S]of s)if(w!==S){let[_,A]=ND(this.object,g,w),[C,E]=ND(this.object,g,S);A+=u,E+=u,E+=a;let I=r.length/3;r.push(_,A,0),r.push(C,A,0),r.push(C,E,0),r.push(_,E,0),n.push(I+0,I+1,I+2),n.push(I+2,I+3,I+0)}let c=new Kt;c.setIndex(n),c.setAttribute("position",new kt(r,3));let{width:h,height:d,depth:p}=this.object.geometry.userData.parameters,m=typeof h=="string"?0:h,v=typeof d=="string"?0:d;this.selectionMesh.geometry.dispose(),this.selectionMesh.geometry=c,this.selectionMesh.position.x=-m*.5,this.selectionMesh.position.y=v*.5,this.selectionMesh.position.z=p,this.showSelectionMesh(),this.hideCaretMesh()}getSelectionFromPosition(e,t,i="previous"){if(this.object===void 0||this.object.font===void 0)return;let r=this.object.wrappedText,n=r.length,s=this.object.lineHeight,a=n*s,{height:o,verticalAlign:l}=this.object.geometry.userData.parameters,u=typeof o=="string"?0:o,c=0;l===3?c=u-a:l===2&&(c=u*.5-a*.5);let h=Math.min(Math.floor(Math.max(Math.min(-t-c,a),0)/s),n-1),d=this.object.charCoords[h],p=this.object.charWidths[h],m=0,v=!1;if(i==="previous"){for(let g=0;g<d.length;g++)if(d[g][0]+p[g]*.5-e>0){m=g,v=!0;break}}else if(i==="closest"){let g=1/0;for(let w=0;w<d.length;w++){let S=d[w][0]+p[w]*.5,_=Math.abs(S-e);_<g&&(g=_,m=w,v=!0)}}else for(let g=0;g<d.length;g++){let w=d[g][0],S=d[g][0]+p[g];if(e>=w&&e<S){m=g,v=!0;break}}return v||(m=d.length),{index:this.getGlobalIndexFromLineAndCharIndexes(r,h,m),lineIndex:h,characterIndex:m}}getGlobalIndexFromLineAndCharIndexes(e,t,i){return e.slice(0,t).reduce((r,n)=>r+=n.length,0)+i}showSelectionMesh(){this.selectionMesh.material.opacity=this._selectionVisibleAlpha}hideSelectionMesh(){this.selectionMesh.material.opacity=0}showCaretMesh(){this.caretMesh.material.opacity=this._caretVisibleAlpha}hideCaretMesh(){this.caretMesh.material.opacity=0}};function ND(e,t,i){let{charCoords:r,charWidths:n,initialOffsetY:s,lineHeight:a}=e;if(r[t]&&r[t].length===0||r.length===0){let c=0,{horizontalAlign:h}=e.data.geometry,d=e.wrappedText,{width:p}=e.geometry.userData.parameters;return d.length===1&&d[0].length===0&&(h===3?c=p*.5:h===2&&(c=p)),[c,s-a*t]}let o=r[t];if(o===void 0||o.length===0)return[0,0];let[l,u]=o[Math.min(i,o.length-1)];return i>=o.length&&(l+=n[t][i-1]),[l,u]}function aC(e,t){let i=0;for(let r=0;r<e.length;r++){let n=e[r],s=t-i;if(s<=n.length)return[r,s];i+=n.length}return[Math.max(0,e.length-1),e[e.length-1]?.length??0]}function jLe(e,t,i){let[r,n]=aC(e,t),[s,a]=aC(e,i),o=[];n>=e[r].length&&(r++,n=0);for(let l=r;l<=s;l++){let u=e[l],c=l===r?n:0,h=l===s?a:u.length;o.push([l,c,h])}return o}function HLe(e,t){let i=es.fromHex(3223857),r=.8;for(let n of e.layers){if(n.data.type==="light"||n.data.type==="displace"||n.data.type==="fresnel"||n.data.type==="matcap"||n.data.type==="texture"||n.data.type==="toon"||n.data.type==="outline"||n.data.type==="transmission"||n.data.type==="noise")continue;let s=typeof n.data.alpha=="string"?Number(t.getVariable(n.data.alpha)):n.data.alpha;if(n.data.type==="color"&&s>.3){i=WLe(n.data.color,t),r=s;break}else if((n.data.type==="depth"||n.data.type==="gradient")&&s>.3){let a=GLe(n.data);i={r:a[0],g:a[1],b:a[2]},r=typeof n.data.alpha=="string"?1:n.data.alpha;break}}return{...i,a:r}}function WLe(e,t){return typeof e=="string"?t.data.colors[e]:e}function GLe(e){return e.colors[0]}function qLe(e,t){e.shadow.camera.right=t/2,e.shadow.camera.left=-t/2,e.shadow.camera.top=t/2,e.shadow.camera.bottom=-t/2,e.shadow.needsUpdate=!0}var fT=class extends bB(y0e,JQ){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.top=1250,r.bottom=-1250,r.right=1250,r.left=-1250,r.near=-1e4,r.far=2500;let n=new g2(this.shadow.camera);n.visible=!1,this.gizmos.shadowmap=n}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof g2&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t);let i=e.depth!==void 0&&e.depth!==this.shadow.camera.far||e.size!==void 0&&e.size/2!==this.shadow.camera.right;e.size!==void 0&&qLe(this,e.size),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),e.penumbraSize!==void 0&&t.scene.markPenumbraSizeDirty(),i&&this.update()}},_H=new H,SH=new H,MH=new xi,pT=class extends bB(p0e,eK){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=Ot.RAD2DEG*2*this.angle,r.aspect=1,r.near=100,r.far=2500;let n=new g2(this.shadow.camera);n.visible=!1,this.gizmos.shadowmap=n,this.update()}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof g2&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),SH.setFromMatrixPosition(this.matrixWorld),MH.setFromRotationMatrix(this.matrixWorld),_H.copy(this.up).applyQuaternion(MH).negate().multiplyScalar(this.distance),this.target.position.copy(SH).add(_H),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.angle!==void 0&&(this.angle=e.angle),e.penumbra!==void 0&&(this.penumbra=e.penumbra),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.penumbraSize!==void 0&&t.scene.markPenumbraSizeDirty(),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}};function XLe(e){let t=(e[0][0]+e[1][1])/2,i=(e[0][0]-e[1][1])/2,r=(e[1][0]+e[0][1])/2,n=(e[1][0]-e[0][1])/2,s=Math.sqrt(t*t+n*n),a=Math.sqrt(i*i+r*r),o=s+a,l=s-a,u=Math.atan2(r,i),c=Math.atan2(n,t),h=(c-u)/2,d=(c+u)/2,p=[[Math.cos(d),Math.sin(d)],[-Math.sin(d),Math.cos(d)]],m=[[o,0],[0,l]],v=[[Math.cos(h),Math.sin(h)],[-Math.sin(h),Math.cos(h)]];return p[0][0]*=-1,p[0][1]*=-1,v[0][0]*=-1,v[1][0]*=-1,[p,m,v]}function VE(e,t){return[[e[0][0]*t[0][0]+e[0][1]*t[1][0],e[0][0]*t[0][1]+e[0][1]*t[1][1]],[e[1][0]*t[0][0]+e[1][1]*t[1][0],e[1][0]*t[0][1]+e[1][1]*t[1][1]]]}function AH(e){return[[e[0][0],e[1][0]],[e[0][1],e[1][1]]]}function YLe(e){let[t,i,r]=XLe(e),n=VE(t,AH(r)),s=VE(VE(r,i),AH(r)),a=Math.atan2(n[1][0],n[0][0]),o=[s[0][0],s[1][1]],l=[s[0][1]/s[1][1],s[1][0]/s[0][0]];return{rotation:a,scale:o,shear:l}}function QLe({rotation:e,scale:t,shear:i}){let r=Math.cos(e),n=Math.sin(e),s=[[r,-n],[n,r]],a=[[t[0],i[0]*t[1]],[i[1]*t[0],t[1]]],o=VE(s,a);return[o[0][0],o[1][0],o[0][1],o[1][1]]}var sr;(e=>{function t(){return[1,0,0,0,1,0,0,0,1]}e.identity=t;function i(E,I=e.identity()){for(let T=0,D=E.length;T<D;T++)I[T]=E[T];return I}e.copy=i;function r(E,I,T,D,L,z){return e.setAbcdef(e.identity(),E,I,T,D,L,z)}e.create=r;function n(E,I,T,D,L,z,G){return E[0]=I,E[1]=D,E[2]=z,E[3]=T,E[4]=L,E[5]=G,E}e.setAbcdef=n;function s(E,I){let[T,D,L,z,G,V]=o(E),[j,J,ne,K,B,Z]=o(I),F=j*T+J*L,X=j*D+J*z,Y=ne*T+K*L,le=ne*D+K*z,oe=B*T+Z*L+G,re=B*D+Z*z+V;return e.create(F,X,Y,le,oe,re)}e.append=s;function a(E,I){let[T,D,L,z,G,V]=o(E),[j,J,ne,K,B,Z]=o(I),F=T,X=D,Y=L,le=z;(j!==1||J!==0||ne!==0||K!==1)&&(F=T*j+D*ne,X=T*J+D*K,Y=L*j+z*ne,le=L*J+z*K);let oe=G*j+V*ne+B,re=G*J+V*K+Z;return e.create(F,X,Y,le,oe,re)}e.prepend=a;function o(E){return[E[0],E[3],E[1],E[4],E[2],E[5]]}e.getAbcdef=o;function l(E){let[I,T,D,L,z,G]=e.getAbcdef(E),V=I*L-T*D,j=L/V,J=-T/V,ne=-D/V,K=I/V,B=(D*G-L*z)/V,Z=-(I*G-T*z)/V;return e.create(j,J,ne,K,B,Z)}e.invert=l;function u([E,I],T){let[D,L,z,G,V,j]=e.getAbcdef(T);return[D*E+z*I+V,L*E+G*I+j]}e.apply=u;function c(E,I){let[T,D,L,z,G,V]=e.getAbcdef(I),j=1/(T*z+L*-D),[J,ne]=E;return[z*j*J+-L*j*ne+(V*L-G*z)*j,T*j*ne+-D*j*J+(-V*T+G*D)*j]}e.applyInverse=c;function h(E,I,T=I){let[D,L,z,G,V,j]=e.getAbcdef(E);return e.setAbcdef(E,D*I,L*T,z*I,G*T,V*I,j*T),E}e.scale=h;function d(E,I){let T=Math.cos(I),D=Math.sin(I),[L,z,G,V,j,J]=e.getAbcdef(E);return e.setAbcdef(E,L*T-z*D,L*D+z*T,G*T-V*D,G*D+V*T,j*T-J*D,j*D+J*T),E}e.rotate=d;function p(E,I,T){let[D,L]=T,z=e.translate(E,-D,-L);return z=e.rotate(z,I),z=e.translate(z,D,L),z}e.rotateAround=p;function m(E,I,T){let[D,L,z,G,V,j]=e.getAbcdef(E);return e.setAbcdef(E,D,L,z,G,V+I,j+T),E}e.translate=m;function v(E,I,T){let[D,L,z,G]=e.getAbcdef(E);return e.setAbcdef(E,D,L,z,G,I,T),E}e.setTranslate=v;function g(E,I,T){let[D,L,z,G]=e.getAbcdef(E);return e.setAbcdef(E,D,L,z,G,I,T),E}e.setPosition=g;function w(E){let[I,T,D,L]=e.getAbcdef(E),z=Math.sqrt(I*I+T*T),G=Math.sqrt(D*D+L*L);return[z,G]}e.getScale=w;function S(E){let[,,,,I,T]=e.getAbcdef(E);return[I,T]}e.getPosition=S;function _(E,I){return e.decompose(E,I).rotation}e.getRotation=_;function A(E,I){let[T,D,L,z,G,V]=e.getAbcdef(E),{rotation:j,scale:J,shear:ne}=YLe([[T,L],[D,z]]);return{position:[G+(I[0]*T+I[1]*L)-I[0],V+(I[0]*D+I[1]*z)-I[1]],scale:J,rotation:j,shear:ne,pivot:I}}e.decompose=A;function C(E,I,T,D,L=[0,0]){let[z,G]=E,[V,j]=D,[J,ne,K,B]=QLe({rotation:T,scale:I,shear:L}),Z=z-(V*J+j*K)+V,F=G-(V*ne+j*B)+j;return e.create(J,ne,K,B,Z,F)}e.compose=C})(sr||(sr={}));var KLe=Math.PI/180;function ZLe(e,t,i,r,n,s){let a=e-i,o=t-r;return a*a/(n*n)+o*o/(s*s)<=1}function JLe(e){return e*KLe}var qs=class{constructor(e,t,i){this.uuid=e,this.data=t,this.localMatrix=sr.identity(),this.worldMatrix=sr.identity(),this.ignoreCameraZoom=!1,this.visible=!0,this._singleBBox=new cO,this._recursiveBBox=new cO,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this.stateSelection=null,this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this.name="",this.position=[0,0],this.scale=[1,1],this.rotation=0,this.shear=[0,0],this.emitter=uT(),this.dpr=i.dpr??1,this.dataPatched=t}project(e,t){let i=this.worldMatrix;return t&&(i=sr.append(t.worldMatrix,i)),sr.applyInverse(e,i)}intersects(e,t,i,r=!1){return this.visible&&!this.data.raycastLock&&this.intersectsInLocalSpace(...this.project([e,t],i),r)}intersectsInLocalSpace(e,t,i=!1){let{min:r,max:n}=i?this.recursiveBBox:this.singleBBox;return e>=r[0]&&e<=n[0]&&t>=r[1]&&t<=n[1]}applyTransforms(e){e.setTransform(this.worldMatrix,this.ignoreCameraZoom)}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges()),this._recursiveBBox}updateLocalMatrix(){this.localMatrix=sr.compose(this.position,this.scale,JLe(this.rotation),Lg.getPivot(this.dataPatched),this.shear)}updateWorldMatrix(e,t,i){let r=this.parent;t&&r!==null&&r!==void 0&&r.updateWorldMatrix(e,!0,!1),e&&this.updateLocalMatrix(),this.parent?this.worldMatrix=sr.append(this.parent.worldMatrix,this.localMatrix):this.worldMatrix=sr.copy(this.localMatrix),this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}get pivot(){return Lg.getPivot(this.data)}getCenter(){return[0,0]}getHalfSize(){return[0,0]}get id(){return this.uuid}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(e=>{e.resetBBoxNeedsUpdateSelf()})}updateTransformState(e){let t=!1;e.position!==void 0&&(t=!0,this.position=e.position),e.rotation!==void 0&&(t=!0,this.rotation=e.rotation),e.scale!==void 0&&(t=!0,this.scale=e.scale),e.shear!==void 0&&(t=!0,this.shear=e.shear),t&&(this.updateWorldMatrix(!0,!1,!0),this.resetBBoxNeedsUpdate())}updateByOp(e,t,i){e.type===0&&e.props.visible!==void 0&&(this.visible=e.props.visible),this.data=t,this.data=t;let r=e,n=Dr(e.path,["states","*"]);if(n!==null){if(e.type===0){let[s]=n;if(this?.stateSelection===s){let a={...e.props};if(delete a.name,Object.values(e.props).some(o=>o===void 0)){let o=this.data;if(o!==void 0){let l=bs.zoom(o,e.path.slice(2));if(l)for(let u in e.props)e.props[u]===void 0&&u in l&&(a[u]=l[u])}}r={...e,props:a,path:e.path.slice(2)}}}}else if(e.type===0){let s=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(s!==void 0){if(e.props.name!==void 0&&s.name){let{name:o,...l}=s;s=l}let a=bs.removeOverridden(e.path,e.props,s);r={...e,props:a}}}this.updateByPatchedOpBase(r,yg.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),i)}changeSelectedState(e,t,i=!1){if(!(this.data.states.length===0&&!i)){for(let r of this.data.states)yg.toOps(this.data,r.data).forEach(n=>{let s=C2.replaceProps(n,this.data);this.dataPatched=this.data,this.updateByPatchedOp(s,this.data,t)});if(e!==null){let r=this.data.states.data(e);r&&(this.dataPatched=yg.patch(this.data,r),yg.toOps(this.data,r).forEach(n=>{this.updateByPatchedOp(n,this.dataPatched,t)}))}i&&this.updateTransformState(this.dataPatched),this.stateSelection=e}}updateState(e,t){e.name!==void 0&&(this.name=e.name),e.visible!==void 0&&(this.visible=e.visible),this.updateTransformState(e)}updateByPatchedOpBase(e,t,i){this.dataPatched=t,this.updateByPatchedOp(e,t,i)}updateByPatchedOp(e,t,i){e.path.length===0&&e.type===0&&this.updateState(e.props,i),this.requestRender()}traverseFrameAncestors(e){this.traverseAncestors(t=>{t.data.type==="frame2d"&&e(t)})}traverseAncestors(e){let t=this.parent;for(;t;)e(t),t=t.parent}requestRender(){this.traverseFrameAncestors(e=>{e.requestRender()})}clone(e){let t=new qs(this.uuid,this.data,e);return t.parent=void 0,t}addEventListener(e,t){this.emitter.on(e,t)}removeEventListener(e,t){this.emitter.off(e,t)}dispatchEvent(e){this.emitter.emit(e.type,{...e,target:e.target??this})}traverseSortNextHelper(){let e=this.parent;if(e){let t=e.children;if(t){let i=t.indexOf(this)+1;return t[i]?t[i]:e.traverseSortNextHelper()}}}sortNext(){let e=this.children;return e&&e.length>0&&e[0]?e[0]:this.traverseSortNextHelper()}isDescendantOf(e){e instanceof qs&&(e=e.uuid);let t=this;for(;t.parent;){if(t.parent.uuid===e)return!0;t=t.parent}return!1}},Ou=class extends qs{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.context=i,this.children=[]}add(e){e.parent&&e.parent instanceof Ou&&e.parent.remove(e),this.children.push(e),e.parent=this}remove(e){let t=this.children.indexOf(e);t>=0&&(this.children.splice(t,1),e.parent=void 0)}traverse(e){let t=e(this);if(t!==!0)for(let i of this.children)i instanceof Ou?i.traverse(e):t=e(i)}intersectsChildrenHelper(e,t,i,r,n){for(let s of this.children)if(s.intersects(e,t,i,!1)&&(n.push(s),r)||s instanceof Ou&&s.intersectsChildrenHelper(e,t,i,r,n))return!0;return!1}intersectsChildren(e,t,i,r=!1,n=[],s=!1){return this.intersectsChildrenHelper(e,t,i,r,n),n}intersectsChildrenHelperReverse(e,t,i,r,n){for(let s of this.children)if(s instanceof Ou&&s.intersectsChildrenHelperReverse(e,t,i,r,n)||s.intersects(e,t,i,!1)&&(n.push(s),r))return!0;return!1}intersectsChildrenReverse(e,t,i,r=!1,n=[],s=!1){return this.intersectsChildrenHelperReverse(e,t,i,r,n),n}updateWorldMatrix(e,t,i){if(super.updateWorldMatrix(e,t,i),i&&this.children)for(let r of this.children)r.updateWorldMatrix(e,!1,!0)}find(e){let t;return this.traverse(i=>{i.uuid===e&&(t=i)}),t}innerDrawChildren(e){for(let t=this.children.length-1;t>=0;t--)this.children[t].draw(e)}resetBBoxNeedsUpdate(){super.resetBBoxNeedsUpdate(),this.traverse(e=>{e.resetBBoxNeedsUpdateSelf()})}clone(e){let t=new Ou(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}},zp=class extends Ou{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.updateState(t,i)}draw(e){!this.visible||(e.save(),this.applyTransforms(e),this.innerDrawChildren(e),e.restore())}clone(e){let t=new zp(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}};function $Le(e,t){let[[i,r],[n,s]]=e,[[a,o],[l,u]]=t,c=(i-n)*(o-u)-(r-s)*(a-l);if(c===0)return!1;let h=((i-a)*(o-u)-(r-o)*(a-l))/c,d=-((i-n)*(r-o)-(r-s)*(i-a))/c;return h>=0&&h<=1&&d>=0&&d<=1}var iK=[[-1,1],[-1,-1],[1,-1],[1,1]],EH=(e,t,i)=>{let r=e.getCenter(),n=e.getHalfSize(),s=sr.append(t,e.worldMatrix);n[0]===0&&n[1]===0?i.push(sr.apply(r,s)):iK.forEach(a=>{let o=[a[0]*n[0]+r[0],a[1]*n[1]+r[1]];i.push(sr.apply(o,s))})},cO=class{constructor(){this.matrix=sr.identity(),this.min=[1/0,1/0],this.max=[-1/0,-1/0],this.vertices=[],this.edges=[]}setFromObjectSize(e,t=!1){e.updateWorldMatrix(),this.makeEmpty(),sr.copy(e.worldMatrix,this.matrix);let i=sr.invert(e.worldMatrix);this.expandByObjectSize(e,i,t)}expandByObjectSize(e,t,i=!1){let r=[];i===!0&&e instanceof Ou?e.traverse(n=>{n.visible&&EH(n,t,r)}):EH(e,t,r),this.setFromPoints(r)}setFromSize(e,t,i){this.makeEmpty(),sr.copy(i,this.matrix),this.expandBySize(e,t,i)}expandBySize(e,t,i){[sr.apply([0,0],i),sr.apply([0,t],i),sr.apply([e,t],i),sr.apply([e,0],i)].forEach(r=>this.expandByPoint(r))}getCenter(){let[e,t]=this.min,[i,r]=this.getHalfSize();return sr.apply([e+i,t+r],this.matrix)}getSize(){return[this.max[0]-this.min[0],this.max[1]-this.min[1]]}getHalfSize(){return[(this.max[0]-this.min[0])*.5,(this.max[1]-this.min[1])*.5]}makeEmpty(){this.min=[1/0,1/0],this.max=[-1/0,-1/0]}setFromPoints(e){this.makeEmpty();for(let t of e)this.expandByPoint(t)}expandByPoint(e){this.min=[Math.min(this.min[0],e[0]),Math.min(this.min[1],e[1])],this.max=[Math.max(this.max[0],e[0]),Math.max(this.max[1],e[1])]}computeVertices(){let[e,t]=this.getHalfSize(),i=this.getCenter(),[r,n,s,a]=sr.getAbcdef(this.matrix),o=sr.create(r,n,s,a,i[0],i[1]);this.vertices=iK.map(([l,u])=>sr.apply([l*e,u*t],o))}computeEdges(){this.edges=[];for(let e=0,t=this.vertices.length;e<t;++e)this.edges.push([this.vertices[e],this.vertices[(e+1)%t]])}project(e,t){let i=this.matrix;return t&&(i=sr.append(t.worldMatrix,i)),sr.applyInverse(e,i)}intersects(e,t,i){return this.intersectsInLocalSpace(...this.project([e,t],i))}intersectsInLocalSpace(e,t){let{min:i,max:r}=this;return e>=i[0]&&e<=r[0]&&t>=i[1]&&t<=r[1]}containsPoint(e){let[t,i]=e,[r,n]=this.min,[s,a]=this.max;return t>=r&&t<=s&&i>=n&&i<=a}intersectsBBox2D(e){for(let t=0,i=this.edges.length;t<i;t++){let r=this.edges[t];for(let n=0,s=e.edges.length;n<s;n++){let a=e.edges[n];if($Le(r,a))return!0}}for(let t=0,i=e.vertices.length;t<i;t++){let r=e.vertices[t];if(this.containsPoint(r))return!0}return!1}ensureMinMax(){let e=this.min,t=this.max;this.min=[Math.min(e[0],t[0]),Math.min(e[1],t[1])],this.max=[Math.max(e[0],t[0]),Math.max(e[1],t[1])]}copy(e){this.min=[...e.min],this.max=[...e.max],sr.copy(e.matrix,this.matrix),this.computeVertices(),this.computeEdges()}clone(){let e=new cO;return e.copy(this),e}},rK,eOe=new Promise(e=>{rK=e}),CH=!1,nE;function tOe(){if(CH)return;if(nE)return nE;async function e(){let t=await Vd(()=>import("./ui-CzK6-nAP.js"),[]);rK(t.default??t),CH=!0}return nE=e(),nE}function TH(e){let t=!1;return e.scene.objects.traverse((i,r)=>{(r.type==="Mesh"&&r.geometry.type==="UIGeometry"||r.type==="Page"&&r.uiFrame!==void 0)&&(t=!0)}),t}var Mi,FD;async function iOe(e){let t=await eOe;Mi||(FD||(FD=t({locateFile:()=>e})),Mi=await FD)}var PH=sr.identity(),nK=class{constructor(e,t=1){this.canvas=e,this._dpr=t,this._width=0,this._height=0,this._strokeMode="inside",this._layerBlur=0,this._backgroundBlur=0,this._dropShadowBlur=0,this._dropShadowOffsetX=0,this._dropShadowOffsetY=0,this._dropShadowColor=mr.transparent,this._innerShadowBlur=0,this._innerShadowOffsetX=0,this._innerShadowOffsetY=0,this._innerShadowSpread=0,this._innerShadowColor=mr.transparent,this._fonts=new Map,this._isSizeDirty=!1;try{let i=e.getBoundingClientRect();e.width=i.width*t,e.height=i.height*t}catch{console.log(e.width,t)}this._currentM3Transform=PH,this._currentTransform=new Float32Array(PH)}get dpr(){return this._dpr}set dpr(e){this._dpr=e,this._isSizeDirty=!0}async init(){if(!this.wasmURL)throw Error("Your must set the wasm binary url with renderer.wasmURL = ... before you can call renderer.init");await iOe(this.wasmURL),this._surface=Mi.MakeWebGLCanvasSurface(this.canvas),this.ctx=this._surface?.getCanvas(),this._paint=new Mi.Paint,this._paint.setAntiAlias(!0),this._paintFill=this._paint.copy(),this._paintFill.setStyle(Mi.PaintStyle.Fill),this._paintStroke=this._paint.copy(),this._paintStroke.setStyle(Mi.PaintStyle.Stroke),this.ctx?.scale(this.dpr,this.dpr)}get currentTransform(){return this._currentM3Transform}get currentTransformBuffer(){return this._currentTransform}set currentTransform(e){this._currentM3Transform=e,this._currentTransform.set(e)}async loadFont(e,t){let i=await(await fetch(e)).arrayBuffer();this.registerFont(i,t)}registerFont(e,t){if(this._fonts.has(t))return;let i=Mi.FontMgr.FromData(e);if(i)this._fonts.set(t,i);else throw new Error("Invalid font data for "+t)}get width(){return this._width}get height(){return this._height}set strokeColor(e){this._paintStroke&&this._paintStroke.setColor(sE(e),Mi.ColorSpace.DISPLAY_P3)}set fillColor(e){this._paintFill&&this._paintFill.setColor(sE(e),Mi.ColorSpace.DISPLAY_P3)}set lineWidth(e){this._paintStroke&&this._paintStroke.setStrokeWidth(this._strokeMode==="center"?e:e*2)}set strokeMode(e){this._strokeMode=e}set dropShadowBlur(e){this._dropShadowBlur=e}set dropShadowColor(e){this._dropShadowColor=e}set dropShadowOffsetX(e){this._dropShadowOffsetX=e}set dropShadowOffsetY(e){this._dropShadowOffsetY=e}set innerShadowBlur(e){this._innerShadowBlur=e}set innerShadowColor(e){this._innerShadowColor=e}set innerShadowOffsetX(e){this._innerShadowOffsetX=e}set innerShadowOffsetY(e){this._innerShadowOffsetY=e}set innerShadowSpread(e){this._innerShadowSpread=e}set layerBlur(e){this._layerBlur=e}set backgroundBlur(e){this._backgroundBlur=e}clear(){this.ctx?.clear(Mi.TRANSPARENT)}save(){this.ctx?.save()}restore(){this.ctx?.restore()}beginPath(){this._currentPath?.delete(),this._currentPath=new Mi.Path}closePath(){let e=this._currentPath;if(e){if(e.isEmpty())return;let t=e.getBounds();(t[3]-t[1]||t[2]-t[0])&&e.close()}}fill(){this._paintInner(this._paintFill,!0)}stroke(){this._paintInner(this._paintStroke,!1)}clipRect(e,t,i,r,n=0,s=0,a=0,o=0){let l=Mi.XYWHRect(e,t,i,r);if(n===0&&s===0&&o===0&&a===0)this.ctx?.clipRect(l,Mi.ClipOp.Intersect,!0);else{let u=Mi.RRectXY(l,n,n);u[4]=u[5]=n,u[6]=u[7]=s,u[8]=u[9]=a,u[10]=u[11]=o,this.ctx?.clipRRect(u,Mi.ClipOp.Intersect,!0)}}_applyShadowOffsetMatrix(){if(this.ctx){let e=sr.invert(this.currentTransform);this.ctx.concat(e);let t=sr.translate(sr.identity(),this._dropShadowOffsetX,this._dropShadowOffsetY);this.ctx.concat(t),this.ctx.concat(this._currentTransform)}}_applyEffectsToPaint(e,t,i=!0){if(this.ctx&&this._currentPath){let r,n=!1;if(i&&this._hasDropShadow()){let s=e.copy();s.setColor(sE(this._dropShadowColor));let a;this._dropShadowBlur>0&&(a=Mi.MaskFilter.MakeBlur(Mi.BlurStyle.Normal,this._dropShadowBlur*this.dpr*(this.camera?.scale??1),!1),s.setMaskFilter(a)),this.ctx.save(),this.ctx.clipPath(this._currentPath,Mi.ClipOp.Difference,!0),this._applyShadowOffsetMatrix(),t(s),this.ctx.restore(),s.delete(),a?.delete()}if(this._backgroundBlur>0&&i){this.ctx.save(),this.ctx.clipPath(this._currentPath,Mi.ClipOp.Intersect,!0);let s=Mi.ImageFilter.MakeBlur(this._backgroundBlur,this._backgroundBlur,Mi.TileMode.Clamp,null),a=e.copy();a.setImageFilter(s),a.setAlphaf(1);let o=this._currentPath.computeTightBounds();this.ctx.saveLayer(a,o,null,Mi.SaveLayerInitWithPrevious),this.ctx.drawColor(e.getColor()),this.ctx.restore(),this.ctx.restore(),a.delete(),s.delete(),n=!0}if(this._layerBlur>0){let s=e.copy();r=Mi.MaskFilter.MakeBlur(Mi.BlurStyle.Normal,this._layerBlur*this.dpr*(this.camera?.scale??1),!1),s.setMaskFilter(r),t(s),s.delete(),r.delete(),n=!0}if(n||t(e),i&&this._hasInnerShadow()){let s=new Mi.Paint;s.setAntiAlias(!0),s.setStyle(Mi.PaintStyle.Fill),s.setColor(sE(this._innerShadowColor));let a;this._innerShadowBlur>0&&(a=Mi.MaskFilter.MakeBlur(Mi.BlurStyle.Normal,this._innerShadowBlur*this.dpr*(this.camera?.scale??1),!1),s.setMaskFilter(a));let o=this._currentPath.computeTightBounds(),[l,u,c,h]=o,d=c-l,p=h-u;this.ctx.save(),this.ctx.clipPath(this._currentPath,Mi.ClipOp.Intersect,!0),this.ctx.saveLayer(s,o,null,Mi.SaveLayerInitWithPrevious),this.ctx?.translate(this._innerShadowOffsetX,this._innerShadowOffsetY),this.ctx.drawRect(Mi.XYWHRect(-1e3-this._innerShadowOffsetX,-1e3-this._innerShadowOffsetY,2e3+d+Math.abs(this._innerShadowOffsetX*2),2e3+p+Math.abs(this._innerShadowOffsetY*2)),s),s.setBlendMode(Mi.BlendMode.Clear),this.ctx.drawPath(this._currentPath,s),this.ctx.restore(),this.ctx.restore(),s.delete(),a?.delete()}}}_paintInner(e,t=!0){if(this.ctx&&this._currentPath&&e){let i=this.ctx,r=this._currentPath;this._applyEffectsToPaint(e,n=>{let s=!1;!t&&this._strokeMode!=="center"&&(i.save(),i.clipPath(r,this._strokeMode==="outside"?Mi.ClipOp.Difference:Mi.ClipOp.Intersect,!0),s=!0),i.drawPath(r,n),s&&i.restore()},t)}}_hasDropShadow(){return this._dropShadowColor?.a>0}_hasInnerShadow(){return this._innerShadowColor?.a>0}path(e){this._currentPath?.addPath(Mi.Path.MakeFromSVGString(e))}ellipse(e,t,i,r,n,s,a,o){if(!DH([e,t,i,r])||!this._currentPath)return;if(i<0||r<0)throw Error("radii cannot be negative");let l=Mi.XYWHRect(e-i,t-r,i*2,r*2);this._currentPath?.addOval(l)}rect(e,t,i,r,n=0,s=0,a=0,o=0){let l=Mi.XYWHRect(e,t,i,r);if(DH(l))if(n===0&&s===0&&o===0&&a===0)this._currentPath?.addRect(l);else{let u=Mi.RRectXY(l,n,n);u[4]=u[5]=n,u[6]=u[7]=s,u[8]=u[9]=a,u[10]=u[11]=o,this._currentPath?.addRRect(u)}}getHorizontalAlign(e){switch(e){case 2:return Mi.TextAlign.Right;case 3:return Mi.TextAlign.Center;case 4:return Mi.TextAlign.Justify;case 1:default:return Mi.TextAlign.Left}}drawTextInner(e,t,i,[r,n,s,a],o,l,u=!0){let c=0,{ctx:h}=this;if(!h)return c;let d=l.copy(),p=l.copy();return p.setAlphaf(0),this._applyEffectsToPaint(d,m=>{t.pushPaintStyle(i,m,p),t.addText(e);let v=t.build();v.layout(s);let g=n;o===2?g+=(a-v.getHeight())/2:o===3&&(g+=a-v.getHeight()),h.drawParagraph(v,r,g),c=v.getHeight(),t.reset(),v.delete()},u),d.delete(),p.delete(),c}drawText(e,t){let i=0,r=this._fonts.get(t.font),{ctx:n,_paintFill:s,_paintStroke:a}=this;if(r&&n){let o=new Mi.TextStyle({fontFamilies:[t.font],fontSize:t.fontSize,heightMultiplier:t.lineHeight,letterSpacing:t.letterSpacing}),l=new Mi.ParagraphStyle({textStyle:o,textAlign:this.getHorizontalAlign(t.horizontalAlign)}),u=Mi.XYWHRect(t.x,t.y,t.width,t.height),c=Mi.ParagraphBuilder.Make(l,r);s&&(i=this.drawTextInner(e,c,o,u,t.verticalAlign,s,!0)),a&&(i=this.drawTextInner(e,c,o,u,t.verticalAlign,a,!1)),c.delete()}return{height:i}}render(){this._surface?.flush()}moveTo(e,t){this._currentPath?.moveTo(e,t)}lineTo(e,t){this._currentPath?.lineTo(e,t)}bezierCurveTo(e,t,i,r,n,s){this._currentPath?.cubicTo(e,t,i,r,n,s)}quadraticCurveTo(e,t,i,r){this._currentPath?.quadTo(e,t,i,r)}setTransform(e,t=!1){if(!this.ctx)return;let i=this.ctx.getTotalMatrix(),r=sr.invert(i);if(r&&this.ctx.concat(r),this.ctx?.scale(this.dpr,this.dpr),this.camera?.enabled&&(this.ctx?.concat(this.camera.worldMatrix),t)){let n=sr.getScale(this.camera.worldMatrix);this.ctx?.scale(1/n[0],1/n[1])}this.ctx?.concat(e),this.currentTransform=e}transform(e){this.ctx?.concat(e)}setSize(e,t){!this._isSizeDirty&&e===this._width&&t===this._height||(this._isSizeDirty=!1,this._width=e,this._height=t,this.canvas.style.width=e+"px",this.canvas.style.height=t+"px",this.canvas.width=e*this.dpr,this.canvas.height=t*this.dpr,this._surface&&(this._surface=Mi.MakeWebGLCanvasSurface(this.canvas),this.ctx=this._surface?.getCanvas()))}};function DH(e){for(let t=0;t<e.length;t++)if(e[t]!==void 0&&!Number.isFinite(e[t]))return!1;return!0}function sE({r:e,g:t,b:i,a:r}){return Mi.Color4f(e,t,i,r)}var RH=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=mr.transparent,this.blurRadius=0,this.offset=[0,0],this.spread=0,this.update(t)}update(e){e.color!==void 0&&(this.color=e.color),e.enabled!==void 0&&(this.enabled=e.enabled),e.blurRadius!==void 0&&(this.blurRadius=e.blurRadius),e.offset!==void 0&&(this.offset=e.offset),e.spread!==void 0&&(this.spread=e.spread)}},IH=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.radius=0,this.update(t)}update(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.radius!==void 0&&(this.radius=e.radius)}},rOe=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=mr.transparent,this.update(t)}update(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.color!==void 0&&(this.color=e.color)}},nOe=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=mr.transparent,this.thickness=0,this.mode="inside",this.update(t)}update(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.color!==void 0&&(this.color=e.color),e.thickness!==void 0&&(this.thickness=e.thickness),e.mode!==void 0&&(this.mode=e.mode)}},Fs=class extends qs{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.autoClose=!0,this.fill=new rOe(e+"-fill",t.fill,i),this.stroke=new nOe(e+"-stroke",t.stroke,i),this.dropShadow=new RH(e+"-dropShadow",t.dropShadow,i),this.innerShadow=new RH(e+"-innerShadow",t.innerShadow,i),this.backgroundBlur=new IH(e+"-backgroundBlur",t.backgroundBlur,i),this.layerBlur=new IH(e+"-layerBlur",t.layerBlur,i)}applyFillStroke(e){e.fillColor=this.fill.enabled?this.fill.color:mr.transparent,e.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:mr.transparent,e.strokeMode=this.stroke.mode,e.lineWidth=this.stroke.thickness}applyFilters(e){this.layerBlur.enabled?e.layerBlur=this.layerBlur.radius*5:e.layerBlur=0,this.backgroundBlur.enabled?e.backgroundBlur=this.backgroundBlur.radius*5:e.backgroundBlur=0,this.dropShadow.enabled?(e.dropShadowBlur=this.dropShadow.blurRadius*5,e.dropShadowColor=this.dropShadow.color,e.dropShadowOffsetX=this.dropShadow.offset[0],e.dropShadowOffsetY=this.dropShadow.offset[1]):e.dropShadowColor=mr.transparent,this.innerShadow.enabled?(e.innerShadowSpread=this.innerShadow.spread,e.innerShadowBlur=this.innerShadow.blurRadius*5,e.innerShadowColor=this.innerShadow.color,e.innerShadowOffsetX=this.innerShadow.offset[0],e.innerShadowOffsetY=this.innerShadow.offset[1]):e.innerShadowColor=mr.transparent}innerDraw(e){}draw(e){!this.visible||(e.save(),this.applyTransforms(e),this.applyFilters(e),this.applyFillStroke(e),e.beginPath(),this.innerDraw(e),this.autoClose&&e.closePath(),this.fill.enabled&&e.fill(),this.stroke.enabled&&e.stroke(),e.restore())}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.type===0&&(Dr(e.path,["fill"])?this.fill.update(e.props):Dr(e.path,["stroke"])?this.stroke.update(e.props):Dr(e.path,["dropShadow"])?this.dropShadow.update(e.props):Dr(e.path,["innerShadow"])?this.innerShadow.update(e.props):Dr(e.path,["layerBlur"])?this.layerBlur.update(e.props):Dr(e.path,["backgroundBlur"])?this.backgroundBlur.update(e.props):this.resetBBoxNeedsUpdate())}updateState(e,t){super.updateState(e,t),e.fill!==void 0&&this.fill.update(e.fill),e.stroke!==void 0&&this.stroke.update(e.stroke),e.dropShadow!==void 0&&this.dropShadow.update(e.dropShadow),e.innerShadow!==void 0&&this.innerShadow.update(e.innerShadow),e.layerBlur!==void 0&&this.layerBlur.update(e.layerBlur),e.backgroundBlur!==void 0&&this.backgroundBlur.update(e.backgroundBlur)}clone(e){let t=new Fs(this.uuid,this.data,e);return t.parent=void 0,t}},MB=class extends Fs{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.width=0,this.height=0,this.updateState(t,i)}innerDraw(e){e.ellipse(this.width*.5,this.height*.5,this.width*.5,this.height*.5,0,0,Math.PI*2)}intersectsInLocalSpace(e,t){return ZLe(e,t,this.width*.5,this.height*.5,this.width*.5,this.height*.5)}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e)}clone(e){let t=new MB(this.uuid,this.data,e);return t.parent=void 0,t}},$_=class extends Fs{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.width=0,this.height=0,this.cornerRadius=[0,0,0,0],this.updateState(t,i)}innerDraw(e){e.rect(0,0,this.width,this.height,...this.cornerRadius)}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateCornerState(e){e.cornerRadius!==void 0&&(this.cornerRadius=e.cornerRadius)}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateCornerState(e)}clone(e){let t=new $_(this.uuid,this.data,e);return t.parent=void 0,t}},AB=class extends Fs{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this._textHeight=0,this._textHeightDirty=!0,this.width=0,this.height=0,this.updateState(t,i)}get textHeight(){return this._textHeight}applyFillStroke(e){e.fillColor=this.fill.enabled?this.fill.color:mr.transparent,e.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:mr.transparent,e.strokeMode="center",e.lineWidth=this.stroke.thickness}innerDraw(e){this._fontHolder?.arrayBuffer&&this._fontHolder.arrayBuffer.byteLength>1&&this.data.font&&e.registerFont(this._fontHolder.arrayBuffer,this.data.font);let t=this.data.textTransform,i=this.data.text.textValue.toString(),r=t===2?i.toUpperCase():t===3?i.toLowerCase():i,{height:n}=e.drawText(r,{x:0,y:0,width:this.width,height:this.height,fontSize:this.data.fontSize,lineHeight:this.data.lineHeight??1,letterSpacing:this.data.letterSpacing??0,horizontalAlign:this.data.horizontalAlign,verticalAlign:this.data.verticalAlign,font:this.data.font});this._textHeight=n}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateFontState(e,{shared:t}){e.font!==void 0&&(this._fontHolder=t.getFont(e.font),this._fontHolder&&!this._fontHolder.isLoaded&&this._fontHolder.loadingPromise.then(()=>{this.requestRender()}))}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateFontState(e,t)}clone(e){let t=new AB(this.uuid,this.data,e);return t.parent=void 0,t}},sK=class extends Fs{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.curves=[],this.extremasBBox={min:[0,0],max:[0,0]},this.updateState(t,i)}computeExtremas(){this.curves.length===0&&this.computeCurves();let e=this.curves.map(r=>oC.extremas(r)),t=[1/0,1/0],i=[-1/0,-1/0];for(let r=0,n=e.length;r<n;r++){let s=e[r];s[0][0]<t[0]&&(t[0]=s[0][0]),s[0][1]<t[1]&&(t[1]=s[0][1]),s[1][0]>i[0]&&(i[0]=s[1][0]),s[1][1]>i[1]&&(i[1]=s[1][1])}return this.extremasBBox.min=[t[0],t[1]],this.extremasBBox.max=[i[0],i[1]],this.extremasBBox}computeCurves(){this.curves=[];for(let i=1,r=this.data.points.length;i<r;i++){let n=this.data.points[i].data,s=this.data.points[i-1].data,a={start:s.position,cp1:s.controlNext.position,cp2:n.controlPrevious.position,end:n.position};this.curves.push(a)}let e=this.data.points[0].data,t=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let i={start:t.position,cp1:t.controlNext.position,cp2:e.controlPrevious.position,end:e.position};this.curves.push(i)}}getCenter(){let[e,t]=this.extremasBBox.min,[i,r]=this.getHalfSize();return[e+i,t+r]}getHalfSize(){let{min:e,max:t}=this.extremasBBox;return[(t[0]-e[0])*.5,(t[1]-e[1])*.5]}innerDraw(e){for(let r=0,n=this.data.points.length;r<n;r++){let s=this.data.points[r].data;if(r===0){let[a,o]=s.position;e.moveTo(a,o)}else{let a=this.data.points[r-1].data,[o,l]=a.controlNext.position,[u,c]=s.controlPrevious.position,[h,d]=s.position,p={start:a.position,cp1:a.controlNext.position,cp2:s.controlPrevious.position,end:s.position};oC.derive(p),e.bezierCurveTo(o,l,u,c,h,d)}}let t=this.data.points[0].data,i=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let[r,n]=i.controlNext.position,[s,a]=t.controlPrevious.position,[o,l]=t.position;e.bezierCurveTo(r,n,s,a,o,l)}}updateState(e,t){super.updateState(e,t),this.computeExtremas()}clone(e){let t=new sK(this.uuid,this.data,e);return t.parent=void 0,t}},oC;(e=>{function t(a){let o=a.start,l=a.cp1,u=a.cp2,c=a.end,h=[3*(l[0]-o[0]),3*(l[1]-o[1])],d=[3*(u[0]-l[0]),3*(u[1]-l[1])],p=[3*(c[0]-u[0]),3*(c[1]-u[1])],m={start:h,cp:d,end:p};return a.derivative=m,m.derivative=hO.derive(m),m}e.derive=t;function i(a,o,l,u=!1){let c=a-2*o+l;if(c!==0){let h=-Math.sqrt(Math.abs(o*o-a*l)),d=-a+o,p=-(h+d)/c,m=-(-h+d)/c;return[p,m]}else if(o!==l&&c===0)return[(2*o-l)/(2*(o-l))];return[]}function r(a){let o=a.derivative??e.derive(a),l=o.start,u=o.cp,c=o.end;return[i(l[0],u[0],c[0]),i(l[1],u[1],c[1])]}e.droot=r;function n(a){let[o,l]=e.droot(a),u=[a.start[0],a.end[0]],c=[a.start[1],a.end[1]];for(let h of o)u.push(e.compute(a,Math.min(1,Math.max(0,h)))[0]);for(let h of l)c.push(e.compute(a,Math.min(1,Math.max(0,h)))[1]);return u.sort((h,d)=>h-d),c.sort((h,d)=>h-d),[[u[0],c[0]],[u[u.length-1],c[c.length-1]]]}e.extremas=n;function s(a,o){if(o===0)return[...a.start];if(o===1)return[...a.end];let l=1-o,u=l*l,c=o*o,h=u*l,d=u*o*3,p=l*c*3,m=o*c;return[h*a.start[0]+d*a.cp1[0]+p*a.cp2[0]+m*a.end[0],h*a.start[1]+d*a.cp1[1]+p*a.cp2[1]+m*a.end[1]]}e.compute=s})(oC||(oC={}));var hO;(e=>{function t(n){let s=n.start,a=n.cp,o=n.end,l=[2*(a[0]-s[0]),2*(a[1]-s[1])],u=[2*(o[0]-a[0]),2*(o[1]-a[1])],c={start:l,end:u};return c.derivative=dO.derive(c),n.derivative=c,c}e.derive=t;function i(n){let s=n.derivative??e.derive(n),a=s.start,o=s.end;return[a[0]!==o[0]?a[0]/(a[0]-o[0]):0,a[1]!==o[1]?a[1]/(a[1]-o[1]):0]}e.droot=i;function r(n,s){if(s===0)return[...n.start];if(s===1)return[...n.end];let a=1-s,o=a*a,l=s*s,u=o,c=a*s*2,h=l;return[u*n.start[0]+c*n.cp[0]+h*n.end[0],u*n.start[1]+c*n.cp[1]+h*n.end[1]]}e.compute=r})(hO||(hO={}));var dO;(e=>{function t(r){let n=r.start,s=r.end,a=[s[0]-n[0],s[1]-n[1]];return r.derivative=a,r.derivative}e.derive=t;function i(r,n){if(n===0)return[...r.start];if(n===1)return[...r.end];let s=r.start,a=r.end;return[s[0]+(a[0]-s[0])*n,s[1]+(a[1]-s[1])*n]}e.compute=i})(dO||(dO={}));var Xc=class extends Ou{constructor(e,t,i){super(e,t,i),this.uuid=e,this.width=0,this.height=0,this.clipped=!0,this.background=new $_(e+"-background",s_.defaultData,i),this.background.parent=this,this.updateState(t,i)}get fill(){return this.background.fill}get stroke(){return this.background.stroke}get backgroundBlur(){return this.background.backgroundBlur}get layerBlur(){return this.background.layerBlur}get dropShadow(){return this.background.dropShadow}get innerShadow(){return this.background.innerShadow}get cornerRadius(){return this.background.cornerRadius}set cornerRadius(e){this.background.cornerRadius=e}updateLocalMatrix(){super.updateLocalMatrix(),this.background?.updateLocalMatrix()}updateWorldMatrix(e,t,i){super.updateWorldMatrix(e,t,i),this.background?.updateWorldMatrix(e,t,i)}draw(e){if(!this.visible)return;e.save();let t=this.width,i=this.height;this.applyTransforms(e),this.background.width=t,this.background.height=i,this.background.draw(e),this.clipped&&e.clipRect(0,0,t,i,...this.cornerRadius),this.innerDrawChildren(e),e.restore()}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateCornerState(e){e.cornerRadius!==void 0&&(this.cornerRadius=e.cornerRadius)}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateCornerState(e),e.fill!==void 0&&this.fill.update(e.fill),e.stroke!==void 0&&this.stroke.update(e.stroke),e.dropShadow!==void 0&&this.dropShadow.update(e.dropShadow),e.innerShadow!==void 0&&this.innerShadow.update(e.innerShadow),e.layerBlur!==void 0&&this.layerBlur.update(e.layerBlur),e.backgroundBlur!==void 0&&this.backgroundBlur.update(e.backgroundBlur),e.clipped!==void 0&&(this.clipped=e.clipped)}requestRender(){super.requestRender(),this.dispatchEvent({type:"render"})}dispose(){this.removeEventListener("render")}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.type===0&&(Dr(e.path,["fill"])?this.fill.update(e.props):Dr(e.path,["stroke"])?this.stroke.update(e.props):Dr(e.path,["dropShadow"])?this.dropShadow.update(e.props):Dr(e.path,["innerShadow"])?this.innerShadow.update(e.props):Dr(e.path,["layerBlur"])?this.layerBlur.update(e.props):Dr(e.path,["backgroundBlur"])?this.backgroundBlur.update(e.props):this.resetBBoxNeedsUpdate())}clone(e){let t=new Xc(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}},sOe=Hp(W7(),1),mT=class extends Fs{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this._pathBBox=new DOMRect,this.path="",this.updateState(t,i),this.autoClose=!1,this.computeSVGBBox()}computeSVGBBox(){let e=this.path;aK(this.path)&&(console.warn("Invalid SVG path",this.uuid),e="");let t=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","path");document.body.appendChild(t),i.setAttribute("d",e),t.appendChild(i),this._pathBBox=i.getBBox(),t.remove()}innerDraw(e){e.path(this.path)}intersectsInLocalSpace(e,t){return e>=this._pathBBox.x&&e<=this._pathBBox.x+this._pathBBox.width&&t>=this._pathBBox.y&&t<=this._pathBBox.y+this._pathBBox.height}getCenter(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}getHalfSize(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}updateState(e,t){super.updateState(e,t),e.path!==void 0&&(this.path=e.path,this.computeSVGBBox())}clone(e){let t=new mT(this.uuid,this.data,e);return t.parent=void 0,t}};function aK(e){return/NaN/.test(e)}function aOe(e,t=1,i=1){if(t<=0||i<=0)return e;if(aK(e))return console.warn("Cannot scale invalid path",e),UD([]);try{let r=(0,sOe.parseSVG)(e).map(n=>{let s={...n};return"x"in s&&(s.x=s.x*t),"y"in s&&(s.y=s.y*i),"x1"in s&&(s.x1=s.x1*t),"x2"in s&&(s.x2=s.x2*t),"y1"in s&&(s.y1=s.y1*i),"y2"in s&&(s.y2=s.y2*i),"rx"in s&&(s.rx=s.rx*t),"ry"in s&&(s.ry=s.ry*i),s});return UD(r)}catch(r){return console.warn("Error parsing SVG path",r),UD([])}}function UD(e){let t=["rx","ry","xAxisRotation","largeArc","sweep","x1","y1","x2","y2","x","y"],i;return e.map(r=>{let n=[];t.forEach(a=>{if(a in r){let o=r[a]*1;n.length&&o>=0&&n.push(","),n.push(o)}});let s=(i===r.code?n[0]<0?"":",":r.code)+n.join("");return i=r.code,s}).join("")}function oOe(e,t,i){switch(t.type){case"ellipse2d":return new MB(e,t,i);case"rectangle2d":return new $_(e,t,i);case"text2d":return new AB(e,t,i);case"vector2d":return new sK(e,t,i);case"path2d":return new mT(e,t,i);case"frame2d":return new Xc(e,t,i);case"group2d":default:return new zp(e,t,i)}}var oK=class{constructor(e,t,i){this.uuid=e,this.data=t,this.group=new zp(oK.GROUP_ID,{...X2.defaultData},i),this.createChildrenObjects(t.objects,this.group,i)}createObject(e,t,i,r,n,s){let a=oOe(e,t,s);a&&(r.add(a),r.children.splice(n,0,r.children.pop()),a.updateWorldMatrix(),i.length>0&&(a instanceof zp||a instanceof Xc)&&this.createChildrenObjects(i,a,s))}createChildrenObjects(e,t,i){let r=0;for(let n of e)this.createObject(n.id,n.data,n.children,t,r,i),r+=1}draw(e){this.group.draw(e)}updateEntityByOp(e,t,i,r){let n=this.find(e);if(n)try{n.updateByOp(t,i,{shared:r})}catch(s){console.error(s)}}updateTreeByOp(e,t){if(e.path.length===0&&e.type===7){let i=e.parent===null?this.group:this.find(e.parent);i!==void 0&&i instanceof Ou&&(this.createObject(e.id,e.data,e.children,i,e.localIndex,t),i.requestRender())}else if(e.path.length===0&&e.type===8){let i=this.find(e.id);if(i!==void 0&&i.parent!==void 0&&i.parent instanceof Ou){let r=i.parent;i.resetBBoxNeedsUpdate(),r?.remove(i),r?.requestRender()}}else if(e.path.length===0&&e.type===9){let i=this.find(e.id);if(i!==void 0){let r=i.parent,n=e.parent===null?this:this.find(e.parent);if(n instanceof Ou||n===this){n.add(i);let s=e.localIndex;n.children.splice(s,0,n.children.pop()),i.updateWorldMatrix(!0,!1,!0),r?.requestRender(),i.requestRender()}i.resetBBoxNeedsUpdate()}}}add(e){this.group.add(e)}remove(e){this.group.remove(e)}traverse(e){this.group.traverse(t=>{t!==this.group&&e(t)})}intersectsChildren(e,t,i,r=!1,n=[]){return this.group.intersectsChildren(e,t,i,r,n,!0)}intersectsChildrenReverse(e,t,i,r=!1,n=[]){return this.group.intersectsChildrenReverse(e,t,i,r,n,!0)}find(e){return this.group.find(e)}get children(){return this.group.children}project(e,t){return this.group.project(e,t)}getWithSortKey(e){let t=this.find(e);if(t===void 0)return;let i=[],r=t;for(;r!==this.group;){let n=r;r=r.parent;let s=r.children.indexOf(n);i.splice(0,0,s)}return{entity:t,sortKey:i}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push(r)}return t.sort((i,r)=>IX(i.sortKey,r.sortKey)),t.map(i=>i.entity)}},EB=oK;EB.GROUP_ID="scene2d";function lK({constraints:e,newParentWidth:t,newParentHeight:i,initialParentWidth:r,initialParentHeight:n,objectInitialWidth:s,objectInitialHeight:a,objectInitialPosition:o}){let{horizontalConstraint:l,verticalConstraint:u}=e,c=t-r,h=i-n,d=s,p=a,m=o[0],v=o[1];if(l!==0){if(l===1)m+=c;else if(l===3)m+=c/2;else if(l===2)d=Math.max(1,d+c);else if(l===4){let g=t/r;d*=g,m*=g}}if(u!==0){if(u===1)v+=h;else if(u===3)v+=h/2;else if(u===2)p=Math.max(1,p+h);else if(u===4){let g=i/n;p*=g,v*=g}}return{width:d,height:p,position:[m,v]}}Hp(W7(),1);var lOe=`
	varying vec2 vUv;
	void main() {
		vUv = uv;
		gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
	}`,uOe=`
	uniform sampler2D tDiffuse;
	varying vec2 vUv;
	void main() {
		vec4 texel = texture2D( tDiffuse, vUv );
		gl_FragColor = texel;
	}`,cOe=new jC(-1,1,1,-1,0,1),hOe=class extends Kt{constructor(){super(),this.setAttribute("position",new kt([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new kt([0,2,0,0,2,0],2))}},dOe=new hOe,fOe=class{constructor(e){this._mesh=new zr(dOe,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,cOe)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}},uK=new Zi({defines:{},uniforms:{tDiffuse:new ut(null)},vertexShader:lOe,fragmentShader:uOe}),pOe=new fOe(uK),VD=null,jD=null,mOe=()=>(VD===null&&(VD=document.createElement("canvas")),VD),gOe=e=>(jD===null&&(jD=new nK(e)),jD),vOe=sr.identity(),cK=class{constructor(e,t,i,r){this.uuid=e,this.width=t,this.height=i,this.context=r,this.enabled=!0,this.isScreenSpace=!1,this.dpr=window.devicePixelRatio,this.isFrameDirty=!1,this.onRenderRequestedDownstream=()=>{this.isFrameDirty=!0,this.context.shared.requestRender()},this._innerApplySize=()=>{let n=this.width,s=this.height,a=this.dpr;this.renderer.dpr=this.isScreenSpace?a:Math.floor(2048/Math.max(n,s)),this.renderer.setSize(n,s)},this.onFrameOverrideObjectEvent=n=>{if(n.target?.uuid!==void 0){let s=this.frameRoot?.find(n.target.uuid);s&&s.dispatchEvent({...n,target:s})}},this.scene2d=new EB(Ot.generateUUID(),LL.defaultData,{dpr:window.devicePixelRatio,shared:r.shared}),this.canvas=mOe(),this.renderer=gOe(this.canvas),this.promise=this.init(),this.renderTarget=new Ki(1,1,{type:Pd,stencilBuffer:!1,depthBuffer:!1}),r.shared.addUIBuffer(this.uuid,this.renderTarget),this.textureHolder=r.shared.uiBuffer(this.uuid)}get canvasTexture(){return this._canvasTexture||(this._canvasTexture=new Eve(this.canvas)),this._canvasTexture}async init(){this.renderer instanceof nK&&(this.renderer.wasmURL=zQ.skiaWasmUrl),await this.renderer.init()}render(e){if(this.isFrameDirty){this.isFrameDirty=!1,this._innerApplySize(),this.renderer.clear(),this.frameOverride?.draw(this.renderer),this.renderer.render(),uK.uniforms.tDiffuse.value=this.canvasTexture,this.canvasTexture.needsUpdate=!0;let t=e.getRenderTarget();e.setRenderTarget(this.renderTarget),e.clear(),pOe.render(e),e.setRenderTarget(t),this.textureHolder?.setNeedsUpdate(!0)}}updateEntity2DByOp(e,t,i,r){this.scene2d.updateEntityByOp(e,t,i,r),this.applySize()}updateTreeByOp(e,t){this.scene2d.updateTreeByOp(e,t),this.applySize()}applyOverrides(e){if(this.frameOverride&&this.frameRoot){this.frameOverride.position=[0,0],this.frameOverride.rotation=0;let t=e?.width??this.width,i=e?.height??this.height;this.frameOverride.width=t,this.frameOverride.height=i,this.frameOverride.localMatrix=vOe,this.isScreenSpace&&(this.frameOverride.fill.color=mr.from0to1([0,0,0,0])),this.frameOverride.data={...this.frameOverride.data,width:t,height:i},hK({objectOverride:this.frameOverride,objectRoot:this.frameRoot,newParentWidth:this.frameOverride.width,newParentHeight:this.frameOverride.height,initialParentWidth:this.frameRoot.width,initialParentHeight:this.frameRoot.height}),this.frameOverride.updateWorldMatrix(!0,!1,!0)}}applySize(e,t=window.devicePixelRatio){let i=Math.max(1,e?.width??this.width),r=Math.max(1,e?.height??this.height);this.dpr=t,this.width=i,this.height=r,this._innerApplySize();let n=1,s=512,a=512;(i*t<s||r*t<a)&&(n=Math.max(s/(i*t),a/(r*t))),this.renderTarget.setSize(i*t*n,r*t*n),this._canvasTexture?.dispose(),this._canvasTexture=void 0,this.applyOverrides(e),this.frameOverride?.requestRender()}applyFrame(e){let t=this.context.scene.find2D(e);if(!(!t||!(t instanceof Xc)))return this.disposeFrameOverride(),this.frameRoot=t,this.frameOverride=t.clone({dpr:this.renderer.dpr,shared:this.context.shared}),this.scene2d.add(this.frameOverride),this.applySize(),this.frame?.addEventListener("render",this.onRenderRequestedDownstream),this.frameOverride.traverse(i=>{i.addEventListener("beginState",this.onFrameOverrideObjectEvent)}),this.frameOverride.traverse(i=>{i.addEventListener("completeState",this.onFrameOverrideObjectEvent)}),this.frame?.requestRender(),t}get frame(){return this.frameOverride}get frameId(){return this.frame?.uuid}find(e){return this.scene2d.find(e)}get texture(){return this.textureHolder?.getTexture(1001)}disposeFrameOverride(){this.frameOverride?.removeEventListener("render",this.onRenderRequestedDownstream),this.frameOverride?.traverse(e=>{e.removeEventListener("beginStateChange",this.onFrameOverrideObjectEvent)}),this.frameOverride?.traverse(e=>{e.removeEventListener("completeState",this.onFrameOverrideObjectEvent)}),this.frameOverride&&this.scene2d.remove(this.frameOverride)}};function hK({objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s}){if(e instanceof Xc&&t instanceof Xc||e instanceof zp&&t instanceof zp)for(let a=0,o=e.children.length;a<o;a++){let l=e.children[a],u=t.children[a];l&&u&&l.uuid===u.uuid&&xOe({objectOverride:l,objectRoot:u,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s})}}function yOe(e){if(fO(e))return[e.width,e.height];if(e instanceof mT){let[t,i]=e.getHalfSize();return[t*2,i*2]}else if(e instanceof zp){let[t,i]=e.recursiveBBox.getHalfSize();return[t*2,i*2]}return[0,0]}function xOe({objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s}){let[a,o]=yOe(t),{width:l,height:u,position:c}=lK({constraints:e.data,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s,objectInitialWidth:a,objectInitialHeight:o,objectInitialPosition:t.position});if(e.position=c,e.data={...e.data,position:c},e.states)for(let h in e.states)wOe({stateId:h,objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s});if(fO(e)||e instanceof zp)fO(e)&&(e.width=l,e.height=u,e.data={...e.data,width:l,height:u}),hK({objectOverride:e,objectRoot:t,newParentWidth:l,newParentHeight:u,initialParentWidth:a,initialParentHeight:o});else if(e instanceof mT){let h=t,d=a!==0?l/a:1,p=o!==0?u/o:1;e.path=aOe(h.path,d,p),e.data={...e.data,path:e.path}}}function wOe({stateId:e,objectOverride:t,objectRoot:i,newParentWidth:r,newParentHeight:n,initialParentWidth:s,initialParentHeight:a}){let o=t.states?.[e],l=i.states?.[e];if(o&&l){let{width:u,height:c,position:h}=lK({constraints:t.data,newParentWidth:r,newParentHeight:n,initialParentWidth:s,initialParentHeight:a,objectInitialWidth:Lg.isResizeable(l)?l.width:0,objectInitialHeight:Lg.isResizeable(l)?l.height:0,objectInitialPosition:l.position});Object.assign(t.states[e],{position:h}),Lg.isResizeable(o)&&Object.assign(t.states[e],{width:u,height:c})}}function fO(e){return e instanceof $_||e instanceof Xc||e instanceof MB||e instanceof AB}var Ns=class extends tB(Ho){constructor(e,t,i){super(),this.data=t,this.bgColor=new Gs(1,1,1,1),this.fog=null,this.backupFog=new gq(16777215,.1,2e3),this.fogUseBGColor=!1,this.isActive=!1,this.aoColor=new li,this.penumbraSizeArrayCache=null,this.super_Entity(e,t),this.personalCamera=new Ms(Xx,{...i_.defaultData,...t.camera,name:"Personal Camera"}),this.personalCamera.objectHelper.visible=!1,this.add(this.personalCamera),this.activeCamera=this.personalCamera,this.ambientLight=new d0e(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.ambientLight.removeFromParent(),this.add(this.ambientLight),t.uiScene?this.uiScene=new EB((Array.isArray(e)?e[0]:e)+"-ui",t.uiScene,{dpr:window.devicePixelRatio,shared:i.shared}):t.uiFrame&&this.createUICanvas(t.uiFrame,i)}get scene(){return this.parent}get postprocessing(){return this.data.postprocessing}get frameId(){return this.data.uiFrame}get frame(){return this.uiCanvas?.frame}createUICanvas(e,t){this.uiCanvas=new cK(this.uuid+"-uiscreen",window.innerWidth,window.innerHeight,t),this.uiCanvas.isScreenSpace=!0,this.uiCanvas.promise.then(()=>{this.uiCanvas?.applyFrame(e),this.uiCanvas?.applySize()})}updateVisible(){}setBackgroundColor(e){this.bgColor=e,this.fogUseBGColor===!0&&(this.backupFog.color=e)}entityChildrenCount(){return this.uiScene?this.uiScene.children.length:super.entityChildrenCount()}updateAmbientLight(e,t){e.color!==void 0&&(this.ambientLight.color=lo(e.color,t)),e.intensity!==void 0&&(this.ambientLight.intensity=e.intensity),e.enabled!==void 0&&(e.enabled?this.add(this.ambientLight):this.remove(this.ambientLight))}onDeactive(){this.isActive=!1}onActive(e){this.isActive=!0,e.fog=this.fog,this.traverseEntity(t=>{t instanceof Kg&&t.recomputeBoolean()}),this.updateShadow(this.data.shadow)}forceMaterialsUpdate(){this.traverseEntity(e=>{if(e instanceof Op)if(Array.isArray(e.material))for(let t of e.material)t.needsUpdate=!0;else e.material.needsUpdate=!0,e.material.dispose()})}updateShadow(e){e.softShadowQuality!==void 0&&this.isActive&&NLe(e.softShadowQuality)&&this.forceMaterialsUpdate()}updateFog(e,t){if(e.enabled?this.fog=this.backupFog:this.fog=null,this.isActive){let i=this.scene;i.fog=this.fog}this.fogUseBGColor=e.useBackgroundColor,e.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=lo(e.color,t),this.backupFog.near=e.near,this.backupFog.far=e.far}updateAo(e,t){e.aoColor!==void 0&&(this.aoColor=lo(e.aoColor,t))}updateByOp(e,t,i,r){let n=this.data.uiFrame;super.updateByOp(e,t,i,r);let s=t;Dr(e.path,["fog"])?this.updateFog(s.fog,i.shared):Dr(e.path,["ao"])?this.updateAo(s.ao,i.shared):Dr(e.path,["ambient"])?this.updateAmbientLight(s.ambient,i.shared):Dr(e.path,["shadow"])?this.updateShadow(s.shadow):e.type===0&&e.path.length===0&&(e.props.uiFrame!==void 0||n!==s.uiFrame)&&this.updateUIFrame(e.props.uiFrame,i)}updateUIFrame(e,t){e?(this.uiCanvas||this.createUICanvas(e,t),this.uiCanvas.enabled=!0,this.uiCanvas.applyFrame(e)):this.uiCanvas&&(this.uiCanvas.enabled=!1)}updateState(e,t){this.updateState_Entity(e,t),e.backgroundColor!==void 0&&this.setBackgroundColor(lo(e.backgroundColor,t.shared)),e.fog!==void 0&&this.updateFog(e.fog,t.shared),e.ambient!==void 0&&this.updateAmbientLight(e.ambient,t.shared),e.ao!==void 0&&this.updateAo(e.ao,t.shared),e.shadow!==void 0&&this.updateShadow(e.shadow)}createFrame(e,t){}raycast(e,t){super.raycast(e,t)}switchActiveCamera(e){e&&e.isDescendantOf(this)&&(this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=e,e.objectHelper.visible=!1)}get playCamera(){return this.scene?.find(this.data.publish.playCamera)??this.personalCamera}switchToPlayCamera(){this.switchActiveCamera(this.playCamera)}get penumbraSizeArray(){return this.penumbraSizeArrayCache===null&&this.updatePenumbraSizeArray(),this.penumbraSizeArrayCache}updatePenumbraSizeArray(){this.penumbraSizeArrayCache=new Array(5).fill(.5);let e=0,t=0;this.traverseEntity(i=>{if(!i.visible)return!0;i instanceof fT&&i.visible&&e<3&&(this.penumbraSizeArrayCache[e]=i.data.penumbraSize??.5,e+=1),i instanceof pT&&i.visible&&e<2&&(this.penumbraSizeArrayCache[3+t]=i.data.penumbraSize??.5,t+=1)})}raycastWithClones(e){let t=[],i=r=>{for(let n of r.children){let s=n.cloner;Xi.is(n)&&(n.visible||s?.object.data.visible)&&((Bc(n)||rO(n)&&this.scene.enableHelpers&&n.objectHelper.visible)&&(e.intersectObject(n,!1,t),pO(n,e,t,!0)),i(n))}};return i(this),t}updateEntity2DByOp(e,t,i,r){this.uiCanvas?.updateEntity2DByOp(e,t,i,r)}},CB=class extends bB(g0e,$Q){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=90,r.aspect=1,r.near=100,r.far=2500;let n=new H(-r.far+this.position.x,-r.far+this.position.y,-r.far+this.position.z),s=new H(r.far+this.position.x,r.far+this.position.y,r.far+this.position.z),a=new Nn(n,s),o=new v2(a,new li(16755200));o.visible=!1,this.gizmos.shadowmap=o,this.update()}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this.gizmos))for(let e in this.gizmos){let t=this.gizmos[e];if(t instanceof v2){let i=this.shadow.camera,r=new H(-i.far+this.position.x,-i.far+this.position.y,-i.far+this.position.z),n=new H(i.far+this.position.x,i.far+this.position.y,i.far+this.position.z);t.box.set(r,n),t.updateMatrixWorld(!0)}}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},bOe=class extends kn{get forceComputeSize(){return!0}get shape(){return this.geometry.userData.shape}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?uB(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},gT=class extends kn{constructor(e,t,i){super(e,t,i),this._shapeId=null,this._context=i}updateState(e,t){super.updateState(e,t),this.updateShape(),this.refreshAttachedCloners(t)}updateShape(){let e={...this.data.geometry.extrusion.shape};for(let r in e)typeof e[r]=="string"&&(e[r]=this._context.shared.getVariable(e[r],[this.uuid,"geometry","extrusion","shape",r]));let t;if(e.type==="Custom"){let r=e.shapeId;if(r!==this._shapeId&&this.detachShape(),r){this._shapeId=r;let n=this._context.scene.find(r);n?.data&&(n.attachedPaths.add(this),t=n.geometry.userData?.shape),t||this._context.scene.addPendingCommand(()=>this.updateShape())}}else{let r;switch(e.type){case"Rectangle":r=lB;break;case"Ellipse":r=oB;break;case"Polygon":r=ZY;break;case"Star":r=JY;break;default:throw new Error(`Unknown shape type: ${e.type}`)}t=r.create({parameters:e}).userData.shape}let i=this.geometry;t&&i.inputs&&(i.inputs.shapeData=t,i.build())}detachShape(){this._shapeId!==null&&this._context.scene.find(this._shapeId)?.attachedPaths.delete(this)}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.updateShape(),this.refreshAttachedPaths(e)}updateTransformState(e,t){return super.updateTransformState(e,t)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.updateShape()}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?uB(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},TB=class extends wB{constructor(e,t,i){super(e,t,i),this.data=t}},Jy=class extends Kx(yd,Z_){constructor(e,t,i){super(),t.type==="Instance"&&typeof e=="string"&&(t=this.transformAssignData(t,i)),this.super_Entity(e,t),this.objectHelper.update()}get isComponentRoot(){return this.data.type==="Component"&&typeof this.identity=="string"}get isInstanceRoot(){return this.data.type==="Instance"&&typeof this.identity=="string"}transformAssignData(e,t){let i=vx.getComponentData({scene:t.scene.data,shared:t.shared.data},e.component);if(i){let r,n;for(let s of dp.rootOverrideProps)e[s]===void 0?(r===void 0&&(r={...e}),r[s]=i.data[s]):(n===void 0&&(n={}),n[s]=e[s],r===void 0&&(r={...e}),r[s]=bp.apply(i.data[s],e[s]));return this.overrideData=n,r}else return{..._s.defaultData,...e,...Gc(_s.defaultData,dp.rootOverrideProps)}}updateByOp(e,t,i,r){let n;if(this.isInstanceRoot&&!r){if(t=this.transformAssignData(t,i),e.type===0&&e.path.length===0&&this.component)for(let s of dp.rootOverrideProps)s in e.props&&e.props[s]===void 0&&(n===void 0&&(n={...e,props:{...e.props}}),n.props[s]=this.component.data[s]);else if(e.type===0&&e.path.length>0&&dp.rootOverrideProps.includes(e.path[0])){let s=e.path[0];n===void 0&&(n={...e,path:[],props:{[s]:t[s]}})}}super.updateByOp(n??e,t,i,r)}updateState(e,t){this.updateState_Entity(e,t)}expandInstanceChildren(e){let t=this.data;if(this.component===void 0){let i=e.scene.find(t.component)??null,r=!1;if(i!==this.oldComponent){if(this.oldComponent){let n=0;for(let s of this.children)if(Xi.is(s))e.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(s),PB(s),n+=1;else break;this.children.splice(0,n)}r=!0}if(i){let n={};dK(e,[this.uuid],t.overrides,this,i,i,0,r,n);for(let s of this.children)if(Xi.is(s)){let a=s.data;a.type==="Empty"&&a.animations&&s.traverseEntity(o=>{let l=o.dataPatched;if(o instanceof kn&&l.bones&&l.boneInverses){let u=o.dataPatched;if(u.bones&&u.boneInverses){let c=u.bones.map(p=>e.scene.find(n[p])),h=u.boneInverses.map(p=>new yt().fromArray(p)),d=new $z(c,h);o.bind(d,o.bindMatrix)}}else o.matrixAutoUpdate=!0})}}this.oldComponent=this.component}}};function PB(e){if(e.component){let t=e.component.instances.indexOf(e);t>=0&&e.component.instances.splice(t,1);for(let i of e.children)Xi.is(i)&&PB(i)}}function LH(e,t,i,r){return e.component===t&&Ak(e.identity,r)?e.overrideData===i?2:1:0}function dK(e,t,i,r,n,s,a,o,l){if(a>50)return!1;if(r.component!==n){if(r.component){let c=r.component.instances.indexOf(r);c>=0&&r.component.instances.splice(c,1)}n.instances.find(c=>c===r)||n.instances.push(r),r.component=n}n instanceof Jy&&n.isInstanceRoot&&n.expandInstanceChildren(e);let u=0;for(let c of n.children)if(Xi.is(c)){let h=[...t,...typeof c.identity=="string"?[c.identity]:c.identity],d=U2.resolve(i,h,1);d!=null&&!(d instanceof Sn)&&(Object.setPrototypeOf(d,Sn.prototype),console.error("wrong prototype"));let p=null,m;if(!o){let v=r.children[u];if(p=Xi.is(v)?v:null,p!==null){let g=LH(p,c,d,h);m=g>=1?p.stateSelection:void 0,g!==2&&(p=null)}if(p===null&&(p=e.scene.findInstance(h)??null,p!==null)){let g=LH(p,c,d,h);if(m=g>=1?p.stateSelection:void 0,g!==2)p=null;else{let w=p.parent.children.indexOf(p);p.parent.children.splice(w,1),r.children.splice(u,0,p),p.parent===r?w<=u&&console.error("not possible"):(p.parent=r,p.matrixWorldNeedsUpdate=!0,p.resetBBoxNeedsUpdate(),p.updateVisible(),e.pendingDeletes.delete(p))}}}if(p===null){let v=d?bp.apply(c.data,d):c.data;Xg.is(v.type)&&(v={...v,type:"Empty"}),p=pp.createEntity(h,v,e),p.overrideData=d,r.add(p),r.children.splice(r.children.length-1,1),r.children.splice(u,0,p),p.updateState(p.data,e),m&&p.changeSelectedState(m,e),e.scene.registerInstanceAndSetUuid(p)}if(p.isBone){let v=p.identity[p.identity.length-1];l[v]=p.uuid}u+=1,dK(e,t,i,p,c,s,a+1,o,l)}if(!o){let c=u;for(;;){let h=r.children[u];if(Xi.is(h))e.pendingDeletes.add(h);else break;u+=1}r.children.splice(c,u-c)}return!0}var _Oe=class extends Kx(vq,Z_){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update(),this.matrixAutoUpdate=!0}updateState(e,t){this.updateState_Entity(e,t)}},ka=class extends kn{constructor(e,t,i){super(e,t,i),this.onBeforeRender=r=>{this.uiCanvas.render(r)},this.uiCanvas=new cK(e+"-canvas",t.geometry.width,t.geometry.height,i),this.uiCanvas.promise.then(()=>{this.applyFrame(this.dataPatched.geometry.frame,i.shared)})}updateByPatchedOpGeometry(e,t,i){super.updateByPatchedOpGeometry(e,t,i),e.type===0&&(e.props.frame!==void 0&&this.applyFrame(e.props.frame,i.shared),(e.props.width!==void 0||e.props.height!==void 0)&&this.applySize(e.props,i.shared))}applySize(e,t){let i=e?.width??this.dataPatched.geometry.width,r=e?.height??this.dataPatched.geometry.height;this.uiCanvas.applySize({width:i,height:r}),this.applyGeometryParametersFromFrame(t)}applyFrame(e,t){this.uiCanvas.applyFrame(e),this.applyGeometryParametersFromFrame(t),this.applyMaterialParametersFromFrame({shared:t})}applyGeometryParametersFromFrame(e){let t=this.frame;t&&(Object.assign(this.data,{geometry:Object.assign(this.data.geometry,{cornerRadius:t.cornerRadius,cornerType:0})}),Object.assign(this.dataPatched,{geometry:Object.assign(this.dataPatched.geometry,{cornerRadius:t.cornerRadius,cornerType:0})}),this.localGeometry?.dispose(),this.localGeometry=wx(this.dataPatched.geometry,e,this.data.flatShading,this))}applyMaterialParametersFromFrame(e){let t=this.frame;if(t){let i=t.data.backgroundBlur;Object.assign(this.data.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.data.material.layers[1].data,{roughness:i.radius,alpha:i.enabled?1:0}),Object.assign(this.dataPatched.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.dataPatched.material.layers[1].data,{roughness:i.radius,alpha:i.enabled?1:0}),this.material.reset?.(this.dataPatched.material,e,!0)}}updateEntity2DByOp(e,t,i,r){this.uiCanvas.updateEntity2DByOp(e,t,i,r),e===this.frameId&&t.type===0&&(t.props.cornerRadius!==void 0?this.applyGeometryParametersFromFrame(r):Dr(t.path,["backgroundBlur"])&&this.applyMaterialParametersFromFrame({shared:r}))}get frame(){return this.uiCanvas.frame}get frameId(){return this.frame?.uuid}removeInteractionGeometry(e){super.removeInteractionGeometry(e),this.applySize({},e)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.applySize({width:e.width,height:e.height},t);let i={...this.data.geometry,...e};this.localGeometry?.dispose(),this.localGeometry=wx(i,t,this.data.flatShading,this)}},SOe=class{constructor(e,t,i){this.variables=[],this.currentTextureIndex=0;let r=br,n=new Ho,s=new Wp;s.position.z=1;let a={passThruTexture:{value:null}},o=c(d(),a),l=new zr(new Zc(2,2),o);n.add(l),this.setDataType=function(p){return r=p,this},this.addVariable=function(p,m,v){let g=this.createShaderMaterial(m),w={name:p,initialValueTexture:v,material:g,dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:Ni,magFilter:Ni};return this.variables.push(w),w},this.setVariableDependencies=function(p,m){p.dependencies=m},this.init=function(){if(i.capabilities.isWebGL2===!1&&i.extensions.has("OES_texture_float")===!1)return"No OES_texture_float support for float textures.";if(i.capabilities.maxVertexTextures===0)return"No support for vertex shader textures.";for(let p=0;p<this.variables.length;p++){let m=this.variables[p];m.renderTargets[0]=this.createRenderTarget(e,t,m.wrapS,m.wrapT,m.minFilter,m.magFilter),m.renderTargets[1]=this.createRenderTarget(e,t,m.wrapS,m.wrapT,m.minFilter,m.magFilter),this.renderTexture(m.initialValueTexture,m.renderTargets[0]),this.renderTexture(m.initialValueTexture,m.renderTargets[1]);let v=m.material,g=v.uniforms;if(m.dependencies!==null)for(let w=0;w<m.dependencies.length;w++){let S=m.dependencies[w];if(S.name!==m.name){let _=!1;for(let A=0;A<this.variables.length;A++)if(S.name===this.variables[A].name){_=!0;break}if(!_)return"Variable dependency not found. Variable="+m.name+", dependency="+S.name}g[S.name]={value:null},v.fragmentShader=`
uniform sampler2D `+S.name+`;
`+v.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){let p=this.currentTextureIndex,m=this.currentTextureIndex===0?1:0;for(let v=0,g=this.variables.length;v<g;v++){let w=this.variables[v];if(w.dependencies!==null){let S=w.material.uniforms;for(let _=0,A=w.dependencies.length;_<A;_++){let C=w.dependencies[_];S[C.name].value=C.renderTargets[p].texture}}this.doRenderTarget(w.material,w.renderTargets[m])}this.currentTextureIndex=m},this.getCurrentRenderTarget=function(p){return p.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(p){return p.renderTargets[this.currentTextureIndex===0?1:0]},this.dispose=function(){l.geometry.dispose(),l.material.dispose();let p=this.variables;for(let m=0;m<p.length;m++){let v=p[m];v.initialValueTexture&&v.initialValueTexture.dispose();let g=v.renderTargets;for(let w=0;w<g.length;w++)g[w].dispose()}};function u(p){p.defines.resolution="vec2( "+e.toFixed(1)+", "+t.toFixed(1)+" )"}this.addResolutionDefine=u;function c(p,m){m=m||{};let v=new Zi({uniforms:m,vertexShader:h(),fragmentShader:p});return u(v),v}this.createShaderMaterial=c,this.createRenderTarget=function(p,m,v,g,w,S){return p=p||e,m=m||t,v=v||Yr,g=g||Yr,w=w||Ni,S=S||Ni,new Ki(p,m,{wrapS:v,wrapT:g,minFilter:w,magFilter:S,format:$r,type:r,depthBuffer:!1})},this.createTexture=function(){let p=new Float32Array(e*t*4),m=new oo(p,e,t,$r,br);return m.needsUpdate=!0,m},this.renderTexture=function(p,m){a.passThruTexture.value=p,this.doRenderTarget(o,m),a.passThruTexture.value=null},this.doRenderTarget=function(p,m){let v=i.getRenderTarget(),g=i.xr.enabled,w=i.shadowMap.autoUpdate,S=i.outputEncoding,_=i.toneMapping;i.xr.enabled=!1,i.shadowMap.autoUpdate=!1,i.outputEncoding=Hu,i.toneMapping=Wc,l.material=p,i.setRenderTarget(m),i.render(n,s),l.material=o,i.xr.enabled=g,i.shadowMap.autoUpdate=w,i.outputEncoding=S,i.toneMapping=_,i.setRenderTarget(v)};function h(){return`void main()	{

	gl_Position = vec4( position, 1.0 );

}
`}function d(){return`uniform sampler2D passThruTexture;

void main() {

	vec2 uv = gl_FragCoord.xy / resolution.xy;

	gl_FragColor = texture2D( passThruTexture, uv );

}
`}}},la=new pa,aE=new H,MOe=class{constructor(e){let t=e.geometry;if(!t.isBufferGeometry||t.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(e){return this.weightAttribute=e?this.geometry.getAttribute(e):null,this}build(){let e=this.positionAttribute,t=this.weightAttribute,i=new Float32Array(e.count/3);for(let n=0;n<e.count;n+=3){let s=1;t&&(s=t.getX(n)+t.getX(n+1)+t.getX(n+2)),la.a.fromBufferAttribute(e,n),la.b.fromBufferAttribute(e,n+1),la.c.fromBufferAttribute(e,n+2),s*=la.getArea(),i[n/3]=s}this.distribution=new Float32Array(e.count/3);let r=0;for(let n=0;n<i.length;n++)r+=i[n],this.distribution[n]=r;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t,i){let r=this.distribution[this.distribution.length-1],n=this.binarySearch(this.randomFunction()*r);return this.sampleFace(n,e,t,i)}binarySearch(e){let t=this.distribution,i=0,r=t.length-1,n=-1;for(;i<=r;){let s=Math.ceil((i+r)/2);if(s===0||t[s-1]<=e&&t[s]>e){n=s;break}else e<t[s]?r=s-1:i=s+1}return n}sampleFace(e,t,i,r){let n=this.randomFunction(),s=this.randomFunction();return n+s>1&&(n=1-n,s=1-s),la.a.fromBufferAttribute(this.positionAttribute,e*3),la.b.fromBufferAttribute(this.positionAttribute,e*3+1),la.c.fromBufferAttribute(this.positionAttribute,e*3+2),t.set(0,0,0).addScaledVector(la.a,n).addScaledVector(la.b,s).addScaledVector(la.c,1-(n+s)),i!==void 0&&la.getNormal(i),r!==void 0&&this.colorAttribute!==void 0&&(la.a.fromBufferAttribute(this.colorAttribute,e*3),la.b.fromBufferAttribute(this.colorAttribute,e*3+1),la.c.fromBufferAttribute(this.colorAttribute,e*3+2),aE.set(0,0,0).addScaledVector(la.a,n).addScaledVector(la.b,s).addScaledVector(la.c,1-(n+s)),r.r=aE.x,r.g=aE.y,r.b=aE.z),this}};function AOe(e){let t=new Float32Array(e*e*2);for(let i=0;i<e;i++)for(let r=0;r<e;r++){let n=i*e+r;t[n*2+0]=i/(e-1),t[n*2+1]=r/(e-1)}return t}function EOe(e){let t=Math.ceil(Math.sqrt(e));return Math.max(t,1)}function COe(e,t){let i=new zr(e.geometry,e.material),r=[],n=[],s=new H,a=new H;i.geometry.index!==null&&(i.geometry=i.geometry.toNonIndexed());let o=new MOe(i).build();for(let c=0;c<t;c++)o.sample(s,a),r.push(s.x,s.y,s.z),n.push(a.x,a.y,a.z);let l=new Float32Array(r),u=new Float32Array(n);return{positions:l,normals:u}}function OH(e,t){let i=e,r=new Float32Array(4*t*t);for(let s=0;s<t*t;s++)r[4*s]=i[3*s],r[4*s+1]=i[3*s+1],r[4*s+2]=i[3*s+2],r[4*s+3]=0;let n=new oo(r,t,t,$r,br);return n.needsUpdate=!0,n}function TOe({size:e}){let t=new Float32Array(4*e*e);for(let r=0;r<e*e;r++)t[4*r]=r,t[4*r+1]=0,t[4*r+2]=0,t[4*r+3]=0;let i=new oo(t,e,e,$r,br);return i.needsUpdate=!0,i}function POe(e){let t=new Float32Array(4*e*e);for(let r=0;r<e*e;r++)t[4*r]=0,t[4*r+1]=0,t[4*r+2]=0,t[4*r+3]=0;let i=new oo(t,e,e,$r,br);return i.needsUpdate=!0,i}var DOe=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU
uniform sampler2D uOriginalPosition;
uniform float uTime;
uniform float uSpeed;     // update speed of the particles
uniform vec3 uWorldOffset;    
uniform vec4 uWorldQuaternion;
uniform float uMaxLifeTime;
uniform vec3 uEmitterSize;
uniform float uFPSRatio;     // 1  for 60 FPS

float random (vec2 st) {
    return fract(sin(dot(st.xy,
        vec2(12.9898,78.233)))*
        43758.5453123);
}
vec3 applyQuaternionToVector( vec4 q, vec3 v ){
    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
}

vec3 applyForce(vec3 force, float mass) {
    vec3 acceleration = force / mass;
    
    return acceleration;
  }
  

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;
    float currentLife = texture2D( uCurrentPosition, vUv ).w;   // from 1 to 0
    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).r;        // 1. = spawning, 0. = not spawning
    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;          // 1. = active, 0. = not active
    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;         // timeStart in seconds when the particle was emitted
    vec3 originalPosition = ((texture2D( uOriginalPosition, vUv ).xyz) * uEmitterSize);
    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;
    float collisionFlag = texture2D( uCurrentVelocity, vUv ).w;             // 1. = collided, 0. = not collided
    float lifeTime = uMaxLifeTime;

    // Calculate the position adjustment based on collision
    //     if (collisionFlag > .5) {  
    float isColliding = step(0.5, collisionFlag); // 1.0 if collisionFlag > 0.5, otherwise 0.0
    float bounceOffset = 3.0 * isColliding; // Becomes 3.0 if colliding, 0.0 otherwise
    vec3 collisionAdjustedVelocity = velocity * (1.0 + bounceOffset);

    // Update position based on collision or normal movement
    vec3 fpsVelocity = velocity * min(uFPSRatio, 5.0);
    position += mix(fpsVelocity, collisionAdjustedVelocity, isColliding);

    // EMISSION RATE - BIRTH
    // if (isSpawning == 1.0) {
    // Better Approach to avoid If statement
    vec3 newPosition = applyQuaternionToVector(uWorldQuaternion, originalPosition) + uWorldOffset;
    originalPosition = mix(originalPosition, newPosition, isSpawning);
    position = mix(position, originalPosition, isSpawning);;
    timeStart = mix(timeStart, uTime, isSpawning);

    // Calculate timeLeft for life normalization
    float timeLeft = max(lifeTime - (uTime - timeStart), 0.0);
    float life_Normalize = timeLeft / lifeTime;

    // Use isActive to blend between the calculated color and black
    vec4 activeColor = vec4(position, life_Normalize);
    // if (isActive == 1.0) {
    gl_FragColor = mix(vec4(0.0), activeColor, isActive);

}
`,ROe=`

    vec3 mod289(vec3 x) {
      return x - floor(x * (1.0 / 289.0)) * 289.0;
    }
    
    vec4 mod289(vec4 x) {
    return x - floor(x * (1.0 / 289.0)) * 289.0;
    }
    
    vec4 permute(vec4 x) {
        return mod289(((x*34.0)+1.0)*x);
    }
    
    vec4 taylorInvSqrt(vec4 r)
    {
    return 1.79284291400159 - 0.85373472095314 * r;
    }
    
    vec3 fade(vec3 t) {
  return t*t*t*(t*(t*6.0-15.0)+10.0);
}

    float snoise(vec3 v)
    {
    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
    vec3 i  = floor(v + dot(v, C.yyy) );
    vec3 x0 =   v - i + dot(i, C.xxx) ;
    vec3 g = step(x0.yzx, x0.xyz);
    vec3 l = 1.0 - g;
    vec3 i1 = min( g.xyz, l.zxy );
    vec3 i2 = max( g.xyz, l.zxy );
    vec3 x1 = x0 - i1 + C.xxx;
    vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y
    vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y
    
    // Permutations
    i = mod289(i);
    vec4 p = permute( permute( permute(
                i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
              + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))
              + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
    
    // Gradients: 7x7 points over a square, mapped onto an octahedron.
    // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)
    float n_ = 0.142857142857; // 1.0/7.0
    vec3  ns = n_ * D.wyz - D.xzx;
    
    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)
    
    vec4 x_ = floor(j * ns.z);
    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
    
    vec4 x = x_ *ns.x + ns.yyyy;
    vec4 y = y_ *ns.x + ns.yyyy;
    vec4 h = 1.0 - abs(x) - abs(y);
    
    vec4 b0 = vec4( x.xy, y.xy );
    vec4 b1 = vec4( x.zw, y.zw );
    
    vec4 s0 = floor(b0)*2.0 + 1.0;
    vec4 s1 = floor(b1)*2.0 + 1.0;
    vec4 sh = -step(h, vec4(0.0));
    
    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
    
    vec3 p0 = vec3(a0.xy,h.x);
    vec3 p1 = vec3(a0.zw,h.y);
    vec3 p2 = vec3(a1.xy,h.z);
    vec3 p3 = vec3(a1.zw,h.w);
    
    //Normalise gradients
    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
    p0 *= norm.x;
    p1 *= norm.y;
    p2 *= norm.z;
    p3 *= norm.w;
    
    // Mix final noise value
    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
    m = m * m;
    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),
                                  dot(p2,x2), dot(p3,x3) ) );
    }
    
    vec3 snoiseVec3( vec3 x ){
    
      float s  = snoise(vec3( x ));
      float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));
      float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));
      vec3 c = vec3( s , s1 , s2 );
      return c;
    
    }
    
      
    vec3 curlNoise( vec3 p, float seed){
      p += seed;
      const float e = .1;
      vec3 dx = vec3( e   , 0.0 , 0.0 );
      vec3 dy = vec3( 0.0 , e   , 0.0 );
      vec3 dz = vec3( 0.0 , 0.0 , e   );
    
      vec3 p_x0 = snoiseVec3( p - dx );
      vec3 p_x1 = snoiseVec3( p + dx );
      vec3 p_y0 = snoiseVec3( p - dy );
      vec3 p_y1 = snoiseVec3( p + dy );
      vec3 p_z0 = snoiseVec3( p - dz );
      vec3 p_z1 = snoiseVec3( p + dz );
    
      float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;
      float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;
      float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;
    
      const float divisor = 1.0 / ( 2.0 * e );
      return normalize( vec3( x , y , z ) * divisor );
    
    }


// Classic Perlin noise
float cnoise(vec3 P)
{
  vec3 Pi0 = floor(P); // Integer part for indexing
  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1
  Pi0 = mod289(Pi0);
  Pi1 = mod289(Pi1);
  vec3 Pf0 = fract(P); // Fractional part for interpolation
  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0
  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
  vec4 iy = vec4(Pi0.yy, Pi1.yy);
  vec4 iz0 = Pi0.zzzz;
  vec4 iz1 = Pi1.zzzz;

  vec4 ixy = permute(permute(ix) + iy);
  vec4 ixy0 = permute(ixy + iz0);
  vec4 ixy1 = permute(ixy + iz1);

  vec4 gx0 = ixy0 * (1.0 / 7.0);
  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;
  gx0 = fract(gx0);
  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
  vec4 sz0 = step(gz0, vec4(0.0));
  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
  gy0 -= sz0 * (step(0.0, gy0) - 0.5);

  vec4 gx1 = ixy1 * (1.0 / 7.0);
  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;
  gx1 = fract(gx1);
  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
  vec4 sz1 = step(gz1, vec4(0.0));
  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
  gy1 -= sz1 * (step(0.0, gy1) - 0.5);

  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);

  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
  g000 *= norm0.x;
  g010 *= norm0.y;
  g100 *= norm0.z;
  g110 *= norm0.w;
  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
  g001 *= norm1.x;
  g011 *= norm1.y;
  g101 *= norm1.z;
  g111 *= norm1.w;

  float n000 = dot(g000, Pf0);
  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
  float n111 = dot(g111, Pf1);

  vec3 fade_xyz = fade(Pf0);
  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
  return 2.2 * n_xyz;
}


vec3 fbm_vec3(vec3 p, float frequency, float offset)
{
  return vec3(
    cnoise((p+vec3(offset))*frequency),
    cnoise((p+vec3(offset+20.0))*frequency),
    cnoise((p+vec3(offset-30.0))*frequency)
  );
}

`,IOe=`
  #ifdef USE_COLLIDER
    float restitution = max(uBounce * 2., .01); // Energy Loss
    // SPHERE COLLIDER
    // **************************************************************
    #ifdef USE_SPHERE_COLLIDER       
      // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)
      vec3 radii = uColliderSize;
      // Adjust position relative to collider
      vec3 relPos = position - uColliderPos;
      // Apply rotation of the collider to the relative position
      relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
      // Scale relative position by radii (for ellipsoid collision detection)
      vec3 scaledPos = relPos / radii;
      // Calculate ellipsoidal distance
      float dist = length(scaledPos); // Distance in terms of ellipsoid
      
      // Check for collision
      if (dist <= 1. + particleSize / length(radii) && collisionFlag == 0.0) {
          // Compute the normal at the collision point, accounting for particle size
        vec3 adjustedPos = scaledPos * (1.0 + particleSize / length(radii));          
        // Compute the normal at the collision point
        vec3 normal = ellipsoidNormal(adjustedPos, radii);
        // Rotate the normal back to world space
        normal = applyQuaternionToVector(uColliderQuaternion, normal);
        // Reflect the velocity vector off the normal
        velocity = reflect(velocity, normal) * restitution;

        collisionFlag = 1.0;
      } else {
        collisionFlag = 0.0;
      }
    #endif

    // BOX COLLIDER or PLANE COLLIDER 
    // **************************************************************
    #ifdef USE_BOX_COLLIDER
      // Box dimensions and repulsion variables
      vec3 boxHalfSize = uColliderSize / 2.0;
      // Convert world position to box's local space
      vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
      // Collision detection
      vec3 localDistance = abs(localPos) - boxHalfSize;
      float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));    

      // Collision Detected
      if (distToSurface <= particleSize * 0.5 && collisionFlag == 0.0) {      
        // Find the nearest face normal for bounce direction
        vec3 normal;
        if (localDistance.x > localDistance.y && localDistance.x > localDistance.z) {
            normal = vec3(sign(localPos.x), 0.0, 0.0);
        } else if (localDistance.y > localDistance.z) {
            normal = vec3(0.0, sign(localPos.y), 0.0);
        } else {
            normal = vec3(0.0, 0.0, sign(localPos.z));
        }            
        // Rotate normal back to world space
        normal = applyQuaternionToVector(uColliderQuaternion, normal);      
        // Reflect velocity and apply repulsion force
        velocity = reflect(velocity, normal) * restitution;
        
        collisionFlag = 1.0;
      } else {
        collisionFlag = 0.0;
      }
    #endif      
  #endif      
  // END COLLIDER    
`,LOe=`
  #ifdef USE_ATTRACTOR

      #ifdef USE_SPHERE_COLLIDER      
        // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)
        vec3 radii = uColliderSize;
        // Adjust position relative to collider
        vec3 relPos = position - uColliderPos;
        // Apply rotation of the collider to the relative position
        relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
        // Scale relative position by radii (for ellipsoid collision detection)
        vec3 scaledPos = relPos / radii;
        // Calculate ellipsoidal distance
        float distToSurface = length(scaledPos); // Distance in terms of ellipsoid
        float insideCheck = 1.0;

      #endif


      #ifdef USE_BOX_COLLIDER
        // Box dimensions
        vec3 boxHalfSize = uColliderSize / 2.0;
        // Convert world position to box's local space
        vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
        vec3 localDistance = abs(localPos) - boxHalfSize;
        float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));
        float insideCheck = particleSize;
      #endif      
  
      // Apply vortex force inside the Helper
      #ifdef USE_FORCE_LOCAL_SPACE
        if (distToSurface <= insideCheck ) {    
            // Define parameters for the attractor field
            #ifdef USE_SPHERE_COLLIDER      
              float attractorStrength = (1.0 - distToSurface ) * uForceIntensity; // Adjust as needed
            #endif

            #ifdef USE_BOX_COLLIDER
              float attractorStrength = max((1.0 - insideCheck / distToSurface), 0.) * uForceIntensity; // Adjust as needed
              #endif

            float attractorDamping = uForceDamping;  // Adjust as needed (higher values will attenuate velocity more)
          
            // Use the same radii calculation code as for the collider
            vec3 attractorRadii = uColliderSize;
            // Adjust position relative to attractor center
            vec3 relPos = position - uColliderPos;
            // Apply rotation of the collider to the relative position
            relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
            // Scale relative position by radii (for ellipsoid attraction)
            vec3 scaledPos = relPos / attractorRadii;

            // Calculate ellipsoidal distance as attractor radius
            float attractorRadius = length(scaledPos);
            // Calculate the distance from the attractor center
            vec3 relativePosition = position - uColliderPos;
            // Calculate the force vector towards the attractor center
            vec3 attractorForce = normalize(relativePosition) * attractorStrength;
            // Apply the attractor force to the particle
            velocity -= attractorForce;
            // Attenuate the particle's velocity
            velocity *= attractorDamping;
        }
      #else 
            // Calculate the distance from the attractor center
            vec3 relativePosition = position - uColliderPos;
            // Calculate the force vector towards the attractor center
            vec3 attractorForce = normalize(relativePosition) * uForceIntensity;
            // Apply the attractor force to the particle
            velocity -= attractorForce;
            // Attenuate the particle's velocity
            velocity *= uForceDamping;
      #endif    
  #endif      
`,OOe=`
  #ifdef USE_VORTEX
    // Box dimensions
    vec3 boxHalfSize = uColliderSize / 2.0;
    // Convert world position to box's local space
    vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
    vec3 localDistance = abs(localPos) - boxHalfSize;
    float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));

    // Apply vortex force inside the box
    if (distToSurface <= particleSize) {
      float vortexStrength = uForceIntensity;
      vec3 localTopCenter = vec3(0.0, 0., 0.0);

      // Transform the local top center to the world space
      vec3 vortexCenter = uColliderPos + applyQuaternionToVector(uColliderQuaternion, localTopCenter);
      // Calculate the vector from particle to vortex center
      vec3 vortexVector = vortexCenter - position;

      // Calculate the rotation axis from the inverse of the collider's quaternion and the fixed up vector
      // Note: important to add a tiny z component to the up vector to avoid instability
      vec3 upVector = vec3(0.0, 1.0, 0.01);
      vec3 rotationAxis = cross(upVector, applyQuaternionToVector(uColliderQuaternion, vortexVector));
      rotationAxis = normalize(rotationAxis);

      // Add rotational component to velocity
      float rotationSpeed = length(vortexVector * vortexStrength * 3.0) ; 

      vec3 rotationVelocity = rotationAxis * rotationSpeed;
      // velocity += rotationVelocity * 0.005 ;
      velocity = rotationVelocity * 0.005 ;

      // Calculate vortex force
      // vec3 vortexForce = normalize(vortexVector) * uSpeed * .1 ;
      // Apply the vortex force to the particle
      vec3 originDirection = applyQuaternionToVector(uWorldQuaternion, directions);
      velocity += applyForce( originDirection * uSpeed * (1. - uForceDamping) , mass * .5);
    }
  #endif      
`,zOe=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU
uniform sampler2D uOriginalPosition;
uniform sampler2D uDirections;     
uniform vec3 uDirectionsAxis;
uniform vec4 uWorldQuaternion;
uniform vec3 uGravity;        
uniform float uNoiseStrength;     // Variation of the noise
uniform float uNoiseScale;        // Scale of the noise
uniform float uNoiseSeed;         // Seed of the noise
uniform float particleSize;
uniform float uSpeed;     // update speed of the particles
uniform float uRandomMassFactor;

// COLLIDER
uniform vec3 uColliderPos;                // Collider Position
uniform vec3 uColliderSize;               // Collider Dimension
uniform vec4 uColliderQuaternion;         // Collider Rotation
uniform vec4 uColliderQuaternionInvert;   // Collider Rotation
uniform float uBounce;                    // Bounce factor
uniform float uForceDamping;
uniform float uForceIntensity;


`+ROe+`
float rand(vec2 co){
    return fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453);
}
vec3 applyQuaternionToVector( vec4 q, vec3 v ){
    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
 } 
vec3 applyForce(vec3 force, float mass) {
  vec3 acceleration = force / mass;
  
  return acceleration;
}

vec4 conjugate(vec4 q) {
  return vec4(q.w, -q.x, -q.y, -q.z);
}

// Function to compute the normal of the ellipsoid at a given point
vec3 ellipsoidNormal(vec3 p, vec3 radii) {
  return normalize(p / (radii * radii));
}

float friction = .3;

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;
    vec3 originalPosition = texture2D( uOriginalPosition, vUv ).xyz;
    float timeLeft = texture2D( uCurrentPosition, vUv ).w;
    vec3 directions = texture2D( uDirections, vUv ).xyz;    
    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;
    float mass = rand(originalPosition.xy) * 0.5 + 0.5;
    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).x;        // 1. = spawning, 0. = not spawning
    float isActive = texture2D( uCurrentEmissionRate, vUv ).y;          // 1. = active, 0. = not active
    float collisionFlag =texture2D( uCurrentVelocity, vUv ).w;          // Indicate collision

    // Randomness Mass
    mass = (1.0 - (uRandomMassFactor * mass));
    
    if (isActive == 1.0) {
      // **************************************************************
      // FORCES NOISES
      // **************************************************************
      #ifdef USE_CURL_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = curlNoise(position * uNoiseScale * .002, uNoiseSeed) * ( uNoiseStrength + 1.0) * .05 * uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {
          velocity += curlNoise( position, uNoiseSeed)  * uNoiseStrength * 0.05 * uSpeed;
        }
      #endif
      // **************************************************************
      #ifdef USE_SIMPLEX_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = vec3(snoise(position * uNoiseScale * .001) * ( uNoiseStrength + 1.0) * .1);
          velocity *= uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0) {
          velocity += vec3(snoise(position * uNoiseStrength * .001) * .05 * uSpeed);
        }
      #endif
      // ************************************************************** 
      #ifdef USE_FBM_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = fbm_vec3(position * uNoiseScale * .001, ( uNoiseStrength + 1.0), uNoiseSeed);
          velocity *= uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {      
          velocity += fbm_vec3(position * uNoiseStrength * .001, ( uNoiseStrength + 1.0), uNoiseSeed) * .1 * uSpeed;
        }
      #endif

      // COLLIDER
      ${IOe}
      // ATTRACTION
      ${LOe}  
      // VORTEX
      ${OOe}
    } 
    // End isActive

    // SPAWN BIRTH 
    // **************************************************************
    // if (isSpawning == 1.)
    #ifdef USE_NORMALS
      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, directions) * uSpeed, isSpawning);
    #else
      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, uDirectionsAxis) * uSpeed, isSpawning);    
    #endif
    
    // if (collisionFlag == 0.0)
    velocity += applyForce(uGravity, mass * .5) * (1.0 - collisionFlag);

    gl_FragColor = vec4(velocity, collisionFlag);
}
`,fK=`

  // Linear Fade In
  float linearFadeIn(float t) {
    return t;
  }


  // linear fade out
  float linearFadeOut(float t) {
    return 1.0 - t;
  }
  
  float linearInOut(float t) {
    return t < 0.5 ? t :  (1.0 - t);  
  }

    // lerp
    float lerp(float a, float b, float t) {
      return a + (b - a) * t;
    }

  // Ease In Out Quart
  float exponentialInOut(float t) {
    return t < 0.4 ? lerp(0.0, 1.0, t / 0.4) :
    t > 0.6 ? lerp(1.0, 0.0, (t - 0.6) / 0.4) :
    1.0;
   }

  // constant
  float constant(float t) {
    return 1.0;
  } 
`,kOe=`

float rand(vec3 co){
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

vec3 applyQuaternionToVector( vec4 q, vec3 v ){
  return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
}

vec3 applyForce(vec3 force, float mass) {
  vec3 acceleration = force / mass;
    
  return acceleration;
}
`,BOe=`
vec3 rgb2xyz (in vec3 rgb) {
    float r = rgb.r;
	float g = rgb.g;
	float b = rgb.b;

	r = r > 0.04045 ? pow(((r + 0.055) / 1.055), 2.4) : (r / 12.92);
	g = g > 0.04045 ? pow(((g + 0.055) / 1.055), 2.4) : (g / 12.92);
	b = b > 0.04045 ? pow(((b + 0.055) / 1.055), 2.4) : (b / 12.92);

	float x = (r * 0.4124) + (g * 0.3576) + (b * 0.1805);
	float y = (r * 0.2126) + (g * 0.7152) + (b * 0.0722);
	float z = (r * 0.0193) + (g * 0.1192) + (b * 0.9505);
    
    vec3 xyz = vec3(
        (r * 0.4124) + (g * 0.3576) + (b * 0.1805) * 100.0,
        (r * 0.2126) + (g * 0.7152) + (b * 0.0722) * 100.0,
        (r * 0.0193) + (g * 0.1192) + (b * 0.9505) * 100.0
    );
    return(xyz);
}

vec3 xyz2lab (in vec3 xyz) {
	float x = xyz.x / 95.047;
	float y = xyz.y / 100.0;
	float z = xyz.z / 108.883;

	x = x > 0.008856 ? pow(x, 1.0 / 3.0) : (7.787 * x) + (16.0 / 116.0);
	y = y > 0.008856 ? pow(y, 1.0 / 3.0) : (7.787 * y) + (16.0 / 116.0);
	z = z > 0.008856 ? pow(z, 1.0 / 3.0) : (7.787 * z) + (16.0 / 116.0);

    vec3 lab = vec3((116.0 * y) - 16.0, 500.0 * (x - y), 200.0 * (y - z));
    return(lab);
}

vec3 rgb2lab(in vec3 rgb) {
    vec3 xyz = rgb2xyz(rgb);
    vec3 lab = xyz2lab(xyz);
    return(lab);
}

vec3 xyz2rgb (in vec3 xyz) {
	float x = xyz.x / 100.0;
	float y = xyz.y / 100.0;
	float z = xyz.z / 100.0;
	
    
	float r = (x *  3.2406) + (y * -1.5372) + (z * -0.4986);
	float g = (x * -0.9689) + (y *  1.8758) + (z *  0.0415);
	float b = (x *  0.0557) + (y * -0.2040) + (z *  1.0570);

	r = r > 0.0031308 ? ((1.055 * pow(r, 1.0 / 2.4)) - 0.055) : r * 12.92;
	g = g > 0.0031308 ? ((1.055 * pow(g, 1.0 / 2.4)) - 0.055) : g * 12.92;
	b = b > 0.0031308 ? ((1.055 * pow(b, 1.0 / 2.4)) - 0.055) : b * 12.92;

	r = min(max(0.0, r), 1.0);
	g = min(max(0.0, g), 1.0);
	b = min(max(0.0, b), 1.0);

	return(vec3(r, g, b));
}

vec3 lab2xyz (in vec3 lab) {
    float l = lab.x;
	float a = lab.y;
	float b = lab.z;

  	float y = (l + 16.0) / 116.0;
	float x = a / 500.0 + y;
	float z = y - b / 200.0;

	float y2 = pow(y, 3.0);
	float x2 = pow(x, 3.0);
	float z2 = pow(z, 3.0);

  	y = y2 > 0.008856 ? y2 : (y - 16.0 / 116.0) / 7.787;
	x = x2 > 0.008856 ? x2 : (x - 16.0 / 116.0) / 7.787;
	z = z2 > 0.008856 ? z2 : (z - 16.0 / 116.0) / 7.787;

	x *= 95.047;
	y *= 100.0;
	z *= 108.883;

	return(vec3(x, y, z));
}
vec3 lab2rgb (in vec3 lab) {
    vec3 xyz = lab2xyz(lab);
    vec3 rgb = xyz2rgb(xyz);
    return(rgb);
}

`,NOe=`
  uniform sampler2D uPosition;
  uniform float uSize;
  uniform float uSizeEnd;
  uniform vec3 uWorldOffset;
  uniform vec4 uWorldQuaternion;
  // Billboard Behavior - Currently at Zero, but we can change that
  uniform float uRotation;
  uniform float uRotationEnd;
  uniform vec2 center;

  // Randomness
  uniform float uRandScaleFactor;
  uniform float uRandRotationFactor;

  attribute vec2 ref;

  varying float v_LifeLeft;    // normalized lifetime 1 to 0
  varying vec2 vUv;
  varying vec2 vRef;

  ${kOe}
  ${fK}
`,FOe=({easeSize:e="linearFadeOut"})=>`
  vUv = uv;  
  vRef = ref;
  // Normalized LifeTime 1 to 0
  float lifeLeft = texture2D(uPosition, ref).w;
  v_LifeLeft = lifeLeft;
  // Position From DataTexture Simulation
  vec3 pos = texture2D(uPosition, ref).rgb - uWorldOffset;
  // Apply World Quaternion
  pos = applyQuaternionToVector(uWorldQuaternion, pos);  
            
  #ifdef  USE_SIZE_END
    // Scaled Over Time
    float t = 1. - lifeLeft;
    float currentSize = mix(uSize, uSizeEnd, t); // Linearly interpolate between uSize and uSizeEnd
    vec3 scaledPosition = position * vec3(currentSize);
  #else
    // Change Size Behavior over LifeTime
    float easeSize = ${e}(1. - lifeLeft);
    // Scaled Over Time
    vec3 scaledPosition = position * vec3(uSize * easeSize);
  #endif

  // Billboard Behavior
  vec2 scale;
  scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
  scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );    
  // Randomness 
  float randRef = rand(ref);
  scale *= (1.0 - (uRandScaleFactor * randRef));
  // Rotation
  float randRotation =  2.0 * PI * ( uRandRotationFactor * randRef);
  float originalRotation = (1.0 - uRotation) * 2.0 * PI;
  float originalRotationEnd = (1.0 - uRotationEnd) * 2.0 * PI;
  // OverTime
  float finalRotation = mix(originalRotation + randRotation, originalRotationEnd + randRotation, lifeLeft);

  vec2 alignedPosition = ( scaledPosition.xy - ( center - vec2( 0.5 ) ) ) * scale;
  vec2 rotatedPosition;
  rotatedPosition.x = cos( finalRotation ) * alignedPosition.x - sin( finalRotation ) * alignedPosition.y;
  rotatedPosition.y = sin( finalRotation ) * alignedPosition.x + cos( finalRotation ) * alignedPosition.y;
  
  mat4 instanceMatrix = mat4(
    vec4(1.0, 0.0, 0.0, 0.0),
    vec4(0.0, 1.0, 0.0, 0.0),
    vec4(0.0, 0.0, 1.0, 0.0),
    vec4(pos.x, pos.y, pos.z, 1.0)
  );  

  mvPosition = modelViewMatrix * instanceMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
  mvPosition.xy += rotatedPosition;
  gl_Position = projectionMatrix  * mvPosition;   
`,UOe=`
  uniform vec4 uColor;                // start color
  uniform vec4 uColor2;               // end color
  uniform sampler2D uTexture;         // texture
  varying float v_LifeLeft;   // normalized lifetime 1 to 0
  varying vec2 vUv;
  varying vec2 vRef;

  float random(vec2 co) {
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
  }
  `+fK+`  
  ${BOe}

`,VOe=({easeOpacity:e="linearFadeOut"})=>`  
  // if Particle is dead, hide it
  if (v_LifeLeft <= 0.005 ) {
    discard;
  }

  #ifdef USE_RANDOM_COLORING
    float randVal = random(vRef); // Generate a random value based on the reference
    vec4 color = mix(uColor, uColor2, randVal); // Interpolate between the two colors
  #else
    vec4 color = mix(uColor, uColor2, 1. - v_LifeLeft);
  #endif

  // Opacity over Life Time
  float finalAlpha = ${e}(1. - v_LifeLeft);  
  vec4 textureColor = texture2D(uTexture, vUv).rgba; 
  finalColor = textureColor.rgb * color.rgb;
  finalAlpha = color.a * textureColor.a * finalAlpha;
  
  gl_FragColor = vec4(finalColor, finalAlpha);     

`,jOe=class extends Zi{constructor(e,t){super(),this.needsJitter=!0,this.type="ParticleMaterial",this.easeOpacity="linearFadeIn",this.easeSize="linearFadeIn",this.useSizeEnd=!1,this.isColoringRandom=!1,this.init(e,t),this.context=t}reset(){}init(e,t){this.transparent=!0,this.depthTest=!0,this.depthWrite=!1,this.easeOpacity=e.ease,this.easeSize=e.easeSize,this.layers=[],xs.startContext(xs.globalContext),this.lightLayer=new Dc(0,"",{...Jn.defaultData("light","phong"),visible:!1},new fB,{},t.shared),xs.endContext(xs.globalContext),this.build()}updateState(e){e.coloring!==void 0&&(this.isColoringRandom=e.coloring==="random"),e.color!==void 0&&(e.color instanceof Array?this.uniforms.uColor.value=e.color:this.uniforms.uColor.value=this.context.shared.color(e.color)),e.color2!==void 0&&(e.color2 instanceof Array?this.uniforms.uColor2.value=e.color2:this.uniforms.uColor2.value=this.context.shared.color(e.color2)),e.size!==void 0&&(this.uniforms.uSize.value=e.size[0],this.uniforms.uSizeEnd.value=e.size[1],e.size[0]!==e.size[1]?this.useSizeEnd=!0:this.useSizeEnd=!1),e.ease!==void 0&&(this.easeOpacity=e.ease,this.build()),e.easeSize!==void 0&&(this.easeSize=e.easeSize,this.build()),this.needsUpdate=!0}onBeforeCompile(e){this.build(),e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader}build(){let e=new fQ;return e.needsJitter=this.needsJitter,e.addFragmentParsCode(S3e),e.buildShader("vertex",this.fragment),e.buildShader("fragment",this.fragment),e.addFragmentFinalCode(M3e),this.isColoringRandom&&e.define("USE_RANDOM_COLORING"),this.useSizeEnd&&e.define("USE_SIZE_END"),e.addVertexParsCode(NOe),e.addFragmentParsCode(UOe),e.addVertexFinalCode(FOe({easeSize:this.easeSize})),e.addFragmentFinalCode(VOe({easeOpacity:this.easeOpacity})),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms={...e.uniforms,...this.uniforms},this.extensions=e.extensions,this}get nodeMaterial(){return this}get fragment(){return this.lightLayer.node}getDefines(){return this.defines}nodeMaterialDispose(){this.layers.forEach(e=>e.dispose()),super.dispose()}},HD=class{constructor(e,t,i,r){this.type="SphereEmitterShape",this.targetMesh=void 0,this.size=e,this.type=i,this.textureSize=EOe(t);let n=1;this.targetMesh=r?.geometry.type==="BufferGeometry"||r?.type==="Mesh"&&r&&r.geometry.hasAttribute("position")&&r.geometry.hasAttribute("normal")?r:this.getMesh(i,n);let{positions:s,dataTexture:a,dataTextureNormals:o}=this.createPositions(this.textureSize,this.targetMesh??this.getMesh(i,n));this.positionsTexture=a,this.positionsAttribute=s,this.directionsTexture=o}createPositions(e,t){let{positions:i,normals:r}=COe(t,e*e),n=OH(i,e),s=OH(r,e);return{dataTexture:n,positions:i,dataTextureNormals:s}}getMesh(e,t){let i=null;switch(e){case"SphereEmitterShape":{i=new jy(t*.5,32,32);break}case"TorusEmitterShape":{i=new Cq(t*.5,.3,15,40);break}case"ConeEmitterShape":{i=new rk(t,t,15);break}case"BoxEmitterShape":{i=new Wu(t,t,t);break}case"PlaneEmitterShape":{i=new Zc(t,t),i.rotateX(-Math.PI/2);break}case"MeshEmitterShape":{i=new jy(t,32,32);break}default:{i=new jy(t,32,32);break}}return new zr(i,new Dd({color:16711680}))}applyToShader(e,t){this.size=new H().fromArray(t.size),e.uEmitterSize.value=this.size}dispose(){this.positionsTexture.dispose(),this.directionsTexture.dispose(),this.positionsAttribute=new Float32Array}};function wy(e){let t={...e},i=O2.defaultData;t.forceFieldObjectId&&(t.colliderEntityId=t.forceFieldObjectId);let r={...i.shape,...t.shape},n={...i.renderMaterial,...t.renderMaterial};return{...i,...t,shape:r,renderMaterial:n}}var HOe=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU

uniform sampler2D uIndex; // Texture with corresponding index
uniform float uLastIndexEmitted; // Last emitted index
uniform float uParticlesToEmit; // Number of particles to emit on that frame
uniform float uTime;

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    float particleIndex = texture(uIndex, vUv).x;
    float timeLeft = texture2D( uCurrentPosition, vUv ).w;
    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;    // 1. = active, 0. = not active
    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;


    // ********** Detect Colision to Create a flag and use it in position **********
    // We are doing this here, so

    // ********** Emit Particles **********
    // X = isSpawning 0.0 or 1.0
    // Y = isActive 0.0 or 1.0
    // Check if the vertex index is between the first value and the last value
    // if (particleIndex >= uLastIndexEmitted && particleIndex < uLastIndexEmitted + uParticlesToEmit) {
    //     // Emit a particle by writing 1 to the red channel of the color output
    //     // r: 1. == emit the particle
    //     // g: 1. == particle is now active
    //     timeStart = uTime;
    //     gl_FragColor = vec4(1.0, 1.0, timeStart, 1.0);
    // } else {
    //     // The Particle is either already emitted or not in the range of the particles to emit
    //     // Do not emit a particle by writing 0 to the red channel of the color output        
    //     gl_FragColor = vec4(0.0, isActive, timeStart, 1.0);
    // }
    // Determine if the particle is within the emission range
    float emitLowerBound = step(uLastIndexEmitted, particleIndex);
    float emitUpperBound = step(particleIndex, uLastIndexEmitted + uParticlesToEmit - 1.0);
    float emitParticle = emitLowerBound * emitUpperBound; // 1.0 if in range, 0.0 otherwise

    // Set timeStart and color
    timeStart = mix(timeStart, uTime, emitParticle);
    gl_FragColor = vec4(emitParticle, mix(isActive, 1.0, emitParticle), timeStart, 1.0);


}
`,WD=10,WOe=class extends vr{constructor(e,t){super(),this.type="ParticleEmitter",this.debugMode=!1,this.worldSpace=!0,this.rootObject=null,this.gpuCompute=null,this.positionSimRT=null,this.velocitySimRT=null,this.emissionRateSimRT=null,this.emitterShape=void 0,this.isEmitting=!1,this.hasBeenReset=!1,this.emittedParticlesAmount=0,this.lastEmitTime=0,this.globalTime=0,this.targetFPS=60,this.previousRatio=1,this.lerpFactor=.4,this.particlesAmount=0,this.noiseStrength=0,this.noiseScale=0,this.isBillboardBased=!0,this.simFeaturesDefinition={USE_COLLIDER:!1,USE_ATTRACTOR:!1,USE_VORTEX:!1,USE_SPHERE_COLLIDER:!1,USE_BOX_COLLIDER:!1,USE_FORCE_LOCAL_SPACE:!1,USE_NORMALS:!1,USE_CURL_NOISE:!0,USE_SIMPLEX_NOISE:!1,USE_FBM_NOISE:!1},this.textureLoader=new h0e,this.currentWorldPosition=new H,this.systemQuaternion=new xi,this.worldGravity=new H(0,0,0),this.directionAxis=new H(0,0,0),this.colliderV3=new H(0,0,0),this.colliderQuaternion=new xi(0,0,0,1),this.matrixAutoUpdate=!0,this.renderer=e,this.system=t,this.shared=t.context.shared;let i=t.data;this.material=new jOe(i.renderMaterial,t.context),this.material.uniforms={uSize:{value:0},uSizeEnd:{value:0},uColor:{value:i.renderMaterial.color},uColor2:{value:i.renderMaterial.color2},uPosition:{value:new H(0,0,0)},uEmissionData:{value:new H(0,0,0)},uTexture:{value:this.defaultTexture},uWorldOffset:{value:new H(0,0,0)},uWorldQuaternion:{value:new bi(0,0,0,1)},uRandScaleFactor:{value:i.randomScale??0},uRandRotationFactor:{value:i.randomRotation??0},uRotation:{value:i.renderMaterial.spriteRotation[0]??0},uRotationEnd:{value:i.renderMaterial.spriteRotation[1]??0}},this.setTexture(this.material.uniforms,i.renderMaterial.texture),this.init(i)}setTexture(e,t){let i=t.data;if(typeof t=="string"){let r=this.shared.image(t),n=new tn(r.img);n.needsUpdate=!0,e.uTexture.value=n;return}if(typeof i!="string"){let r=new Image;r.onload=()=>{let a=new tn(r);a.needsUpdate=!0,e.uTexture.value=a};let n=new Blob([i],{type:"image/*"}),s=URL.createObjectURL(n);r.src=s}}updateGeometryAttributes(e,t){let i=AOe(t);!this.emitterShape?.positionsAttribute||e.geometry.setAttribute("ref",new Wb(i,2))}applyWorldSpace(){if(!this.system.started||!this.worldSpace||!this.positionSimRT||!this.velocitySimRT)return;let e=this.system;e.getWorldQuaternion(this.systemQuaternion),this.systemQuaternion.invert(),e.getWorldPosition(this.currentWorldPosition),this.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.positionSimRT.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.systemQuaternion.invert(),this.positionSimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.velocitySimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize())}update(e,t){if(!this.gpuCompute||!this.positionSimRT||!this.velocitySimRT||!this.emissionRateSimRT||this.hasBeenReset)return;if(this.checkIfAllParticlesAreDead()&&!this.hasBeenReset){this.reset();return}this.applyWorldSpace(),this.globalTime=e,this.positionSimRT.material.uniforms.uTime.value=e,this.emissionRateSimRT.material.uniforms.uTime.value=e;let i=1e3/t,r=this.targetFPS/i,n=this.previousRatio+(r-this.previousRatio)*this.lerpFactor;this.positionSimRT.material.uniforms.uFPSRatio.value=n,this.previousRatio=n;let s=this.isEmitting?this.GoEmitSomeParticles(e,this.system.data.birthRatePerSec):0;this.emissionRateSimRT.material.uniforms.uLastIndexEmitted.value=this.emittedParticlesAmount,this.emissionRateSimRT.material.uniforms.uParticlesToEmit.value=s,this.material.uniforms.uPosition.value=this.gpuCompute.getCurrentRenderTarget(this.positionSimRT)?.texture,this.system.colliderEntities.length>0&&this.renderColliders(),this.gpuCompute.compute()}renderColliders(){if(!this.velocitySimRT)return;let e=this.system.colliderEntities[0],t=this.simFeaturesDefinition.USE_COLLIDER||this.simFeaturesDefinition.USE_ATTRACTOR||this.simFeaturesDefinition.USE_VORTEX;if(e.destroyedInAction&&t&&this.init(wy({...this.system.data,colliderEntityId:null})),!e||e.destroyedInAction)return;e.getWorldPosition(this.colliderV3),this.colliderV3.y===0&&(this.colliderV3.y=1e-4),this.velocitySimRT.material.uniforms.uColliderPos.value.copy(this.colliderV3);let i=e.data.size;this.colliderV3.fromArray(i),this.velocitySimRT.material.uniforms.uColliderSize.value.copy(this.simFeaturesDefinition.USE_SPHERE_COLLIDER?this.colliderV3.multiplyScalar(.5):this.colliderV3),e.getWorldQuaternion(this.colliderQuaternion),this.velocitySimRT.material.uniforms.uColliderQuaternion.value.copy(this.colliderQuaternion.normalize()),this.velocitySimRT.material.uniforms.uColliderQuaternionInvert.value.copy(this.colliderQuaternion.normalize().invert())}updateState(e){!this.velocitySimRT||!this.positionSimRT||(e.renderMaterial&&this.updateMaterialState(e.renderMaterial),this.updateParticleState(e))}updateVariableState(e,t){if(!this.velocitySimRT||!this.positionSimRT)return;t[2]==="size"&&this.material.updateState({size:[e,this.material.uniforms.uSizeEnd.value]}),t[2]==="sizeEnd"&&this.material.updateState({size:[this.material.uniforms.uSize.value,e]});let i=(r,n)=>{let s=[...this.system.data.shape.size];s[r]=n,this.updateParticleState({shape:{...this.system.data.shape,size:s}})};t[2]==="shape_size_0"&&i(0,e),t[2]==="shape_size_1"&&i(1,e),t[2]==="shape_size_2"&&i(2,e),t[2]==="speed"&&(this.velocitySimRT.material.uniforms.uSpeed.value=e/WD),t[2]==="gravity"&&this.worldGravity.set(0,e/100,0),t[2]==="noiseStrength"&&(this.noiseStrength=e,this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),t[2]==="noiseScale"&&(this.noiseScale=e,this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),t[2]==="direction_x"&&(this.directionAxis=this.getDirectionAxis([Number(e),this.system.data.direction[1],this.system.data.direction[2]])),t[2]==="direction_y"&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],Number(e),this.system.data.direction[2]])),t[2]==="direction_z"&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],this.system.data.direction[1],Number(e)]))}updateMaterialState(e){this.material.updateState({...e,size:e.size?[Number(this.shared.getVariable(e.size[0],[this.uuid,"particles","size"])),Number(this.shared.getVariable(e.size[1],[this.uuid,"particles","sizeEnd"]))]:[0,0]}),e.texture&&(this.setTexture(this.material.uniforms,e.texture),this.material.needsUpdate=!0)}updateParticleState(e){if(!(!this.positionSimRT||!this.velocitySimRT)){if(this.shouldReInitGPUCompute(e)&&this.init(wy(this.system.data)),e.life!==void 0&&(this.positionSimRT.material.uniforms.uMaxLifeTime.value=e.life),e.speed!==void 0&&(this.velocitySimRT.material.uniforms.uSpeed.value=Number(this.shared.getVariable(e.speed,[this.uuid,"particles","speed"]))/WD),e.collisionBounce!==void 0&&(this.velocitySimRT.material.uniforms.uBounce.value=e.collisionBounce),e.noiseStrength!==void 0&&(this.noiseStrength=Number(this.shared.getVariable(e.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),e.noiseScale!==void 0&&(this.noiseScale=Number(this.shared.getVariable(e.noiseScale,[this.uuid,"particles","noiseScale"])),this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),e.noiseSeed!==void 0&&(this.velocitySimRT.material.uniforms.uNoiseSeed.value=e.noiseSeed),e.randomMass!==void 0&&(this.velocitySimRT.material.uniforms.uRandomMassFactor.value=e.randomMass),e.renderMaterial?.size!==void 0){let t=this.shared.getVariable(e.renderMaterial.size[0],[this.uuid,"particles","size"]);this.velocitySimRT.material.uniforms.particleSize.value=Number(t)}if(e.renderMaterial?.spriteRotation!==void 0&&(this.material.uniforms.uRotation.value=e.renderMaterial.spriteRotation[0],this.material.uniforms.uRotationEnd.value=e.renderMaterial.spriteRotation[1]),e.shape!==void 0){let t=e.shape.size??this.system.data.shape.size,i=[Number(this.shared.getVariable(t[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(t[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(t[2],[this.uuid,"particles","shape_size_2"]))],r={...wy(this.system.data).shape,size:i};this.emitterShape?.applyToShader(this.positionSimRT.material.uniforms,r)}if(e.gravity!==void 0&&(this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.velocitySimRT.material.uniforms.uGravity={value:this.worldGravity}),e.direction!==void 0){let t=this.getDirectionFromVariable(e.direction);this.directionAxis=this.getDirectionAxis(t),this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis}e.randomRotation!==void 0&&(this.material.uniforms.uRandRotationFactor.value=e.randomRotation),e.randomScale!==void 0&&(this.material.uniforms.uRandScaleFactor.value=e.randomScale)}}updateForceFieldParameters(e){!this.velocitySimRT||(e.forceIntensity!==void 0&&(this.velocitySimRT.material.uniforms.uForceIntensity.value=e.forceIntensity),e.forceDambing!==void 0&&(this.velocitySimRT.material.uniforms.uForceDamping.value=e.forceDambing))}getDirectionAxis(e){let t=[Number(e[0])*Ot.DEG2RAD,Number(e[1])*Ot.DEG2RAD,Number(e[2])*Ot.DEG2RAD],i=new ws(t[0],t[1],t[2],"XYZ");return this.directionAxis.set(0,1,0).applyEuler(i).normalize(),this.velocitySimRT&&(this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis),this.directionAxis}shouldReInitGPUCompute(e){let{birthRatePerSec:t,rootObjectType:i,colliderEntityId:r,shape:n,emitTimeDuration:s,emitTimeCycle:a,life:o,directionMode:l,noiseType:u}=e;return t!==void 0||i!==void 0||r||r===null||a!==void 0||n!==void 0||o!==void 0||s!==void 0||l!==void 0||u!==void 0}init(e){this.dispose(),this.particlesAmount=this.getMaxParticlesAmount({birthRatePerSecond:e.birthRatePerSec,particleMaxLifeTime:e.life,loopDuration:e.emitTimeCycle==="infinity"?0:e.emitTimeDuration}),this.particlesAmount>1e5&&(console.warn("The maximum number of particles is limited to 100000."),this.particlesAmount=1e5),this.emitterShape=this.createShape(e.shape,this.particlesAmount);let t=setInterval(()=>{if(this.emitterShape)if(isNaN(this.emitterShape.positionsTexture.source.data.data[0])){this.init(e);return}else clearInterval(t)},100);if(!this.emitterShape)return;let i=new SOe(this.emitterShape.textureSize,this.emitterShape.textureSize,this.renderer),r=this.updateSimulationDefinition(e),n=i.addVariable("uCurrentPosition",r+DOe,this.emitterShape.positionsTexture),s=i.addVariable("uCurrentVelocity",r+zOe,this.emitterShape.directionsTexture),a=i.addVariable("uCurrentEmissionRate",HOe,POe(this.emitterShape.textureSize));i.setVariableDependencies(n,[n,s,a]),i.setVariableDependencies(s,[n,s,a]),i.setVariableDependencies(a,[n,s,a]);let o=TOe({size:this.emitterShape.textureSize}),l={uOriginalPosition:{value:this.emitterShape.positionsTexture},uWorldOffset:{value:new H(0,0,0)},uWorldQuaternion:{value:new bi(0,0,0,1)},uTime:{value:0},uFPSRatio:{value:1},uMaxLifeTime:{value:e.life},uEmitterSize:{value:new H(Number(this.shared.getVariable(e.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.shape.size[2],[this.uuid,"particles","shape_size_2"])))},particleSize:{value:0}};n.material.uniforms=l;let u=this.getDirectionFromVariable(e.direction);this.directionAxis=this.getDirectionAxis(u),this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.noiseStrength=Number(this.shared.getVariable(e.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.noiseScale=Number(this.shared.getVariable(e.noiseScale,[this.uuid,"particles","noiseScale"]));let c=e.colliderEntityId&&this.system.getColliderData(e.colliderEntityId),h={uOriginalPosition:{value:this.emitterShape.positionsTexture},uDirections:{value:this.emitterShape.directionsTexture},uDirectionsAxis:{value:this.directionAxis},uWorldQuaternion:{value:new bi(0,0,0,1)},uColliderPos:{value:new H(0,0,0)},uColliderSize:{value:new H(0,0,0)},uForceIntensity:{value:c?c.forceIntensity:0},uForceDamping:{value:c?c.forceDambing:0},uColliderQuaternion:{value:new bi(0,0,0,1)},uColliderQuaternionInvert:{value:new bi(0,0,0,1)},particleSize:{value:0},uGravity:{value:this.worldGravity},uNoiseStrength:{value:this.noiseStrength},uNoiseScale:{value:this.noiseScale},uNoiseSeed:{value:e.noiseSeed},uRandomMassFactor:{value:e.randomMass},uBounce:{value:e.collisionBounce},uSpeed:{value:Number(this.shared.getVariable(e.speed,[this.uuid,"particles","speed"]))/WD}};s.material.uniforms=h;let d={uIndex:{value:o},uTime:{value:0},uLastIndexEmitted:{value:0},uParticlesToEmit:{value:0}};a.material.uniforms=d;let p=[Number(this.shared.getVariable(e.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.shape.size[2],[this.uuid,"particles","shape_size_2"]))],m={...wy(this.system.data).shape,size:p};this.emitterShape.applyToShader(n.material.uniforms,m),i.init(),this.gpuCompute=i,this.positionSimRT=n,this.velocitySimRT=s,this.emissionRateSimRT=a,this.rootObject=this.createPrimaryEmitter(this.emitterShape.textureSize),this.add(this.rootObject),this.material.needsUpdate=!0}getDirectionFromVariable(e){let t=Number(this.shared.getVariable(e[0],[this.uuid,"particles","direction_x"])),i=Number(this.shared.getVariable(e[1],[this.uuid,"particles","direction_y"])),r=Number(this.shared.getVariable(e[2],[this.uuid,"particles","direction_z"]));return[t,i,r]}updateSimulationDefinition(e){if(this.simFeaturesDefinition.USE_COLLIDER=!1,this.simFeaturesDefinition.USE_ATTRACTOR=!1,this.simFeaturesDefinition.USE_VORTEX=!1,this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!1,this.simFeaturesDefinition.USE_BOX_COLLIDER=!1,this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!1,this.simFeaturesDefinition.USE_NORMALS=!1,this.simFeaturesDefinition.USE_CURL_NOISE=!1,this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!1,this.simFeaturesDefinition.USE_FBM_NOISE=!1,e.colliderEntityId&&this.system.colliderEntities.length>0){let i=this.system.getColliderData(e.colliderEntityId);switch(i?.forceType){case"attractor":this.simFeaturesDefinition.USE_ATTRACTOR=!0;break;case"collider":this.simFeaturesDefinition.USE_COLLIDER=!0;break;case"vortex":this.simFeaturesDefinition.USE_VORTEX=!0;break}let r=i?.colliderType;r==="sphere"&&(this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!0),r==="box"&&(this.simFeaturesDefinition.USE_BOX_COLLIDER=!0),i?.forceRange==="helper"&&(this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!0)}e.directionMode==="normals"&&(this.simFeaturesDefinition.USE_NORMALS=!0),e.noiseType==="curl"&&(this.simFeaturesDefinition.USE_CURL_NOISE=!0),e.noiseType==="simplex"&&(this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!0),e.noiseType==="fbm"&&(this.simFeaturesDefinition.USE_FBM_NOISE=!0);let t="";for(let[i,r]of Object.entries(this.simFeaturesDefinition))r&&(t+=`#define ${i}
`);return t}createShape(e,t){this.emitterShape&&this.emitterShape.dispose();let i=new H(Number(this.shared.getVariable(e.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.size[2],[this.uuid,"particles","shape_size_2"])));if(e.type==="MeshEmitterShape"){let r=null;return this.system.context.scene.traverseEntity(n=>{n.uuid===e.fromMeshId&&(r=n)}),r?new HD(i,t,e.type,r):new HD(i,t,"SphereEmitterShape")}else return new HD(i,t,e.type)}createPrimaryEmitter(e){let t,i=e*e;return t=new Mve(new Zc(1,1,1),this.material,i),this.updateGeometryAttributes(t,e),this.material.needsUpdate=!0,t.onBeforeRender=()=>{this.applyWorldSpace()},t}getMaxParticlesAmount({birthRatePerSecond:e,particleMaxLifeTime:t,loopDuration:i=0}){return Math.ceil(e*(t+i))}dispose(){!this.gpuCompute||(this.rootObject?.parent?.remove(this.rootObject),this.gpuCompute.dispose(),this.material.nodeMaterialDispose(),this.emitterShape?.dispose())}GoEmitSomeParticles(e,t){let i=e-this.lastEmitTime,r=1/t;if(i>=r){let n=Math.max(1,Math.floor(i/r));return this.lastEmitTime=e,this.emittedParticlesAmount+n>this.particlesAmount&&(this.emittedParticlesAmount=0),this.emittedParticlesAmount+=n,n}return 0}checkIfAllParticlesAreDead(){return this.lastEmitTime+this.system.data.life+1<this.globalTime}reset(){this.hasBeenReset=!0,this.lastEmitTime=0,this.emittedParticlesAmount=0,this.gpuCompute&&this.init(wy(this.system.data))}startEmitting(e){this.isEmitting=!0,this.hasBeenReset=!1,this.lastEmitTime=e}stopEmitting(){this.isEmitting=!1}},pb=class extends xa{constructor(e,t,i){super(e,t),this.type="ParticleSystem",this.geometry=new Kt,this.actualTime=0,this.currentLoopTime=0,this.started=!1,this.stopped=!1,this.timeoutId=void 0,this.isFrozen=!1,this.isIdle=!0,this.emitter=null,this.colliderEntities=[],this.renderer=null,this.isPreWarm=!1,this._hasOnAfterRenderBeenCalled=!1,this.onAfterRender=r=>{this._hasOnAfterRenderBeenCalled||(this._hasOnAfterRenderBeenCalled=!0,this.init(r))},this.context=i,this.data={...t,...wy(t)},this.geometry.setAttribute("position",new kt([],3)),this.material=new Dd({colorWrite:!1}),this.frustumCulled=!1}init(e){this.renderer=e,this.emitter=new WOe(e,this),this.add(this.emitter),this.updateParticleState(this.data)}update(e){if(!this.isReady||!this.started||this.isFrozen||this.isIdle)return;this.actualTime+=e,this.stopped||(this.currentLoopTime+=e);let t=this.data.emitTimeCycle==="one_time";if((this.data.emitTimeCycle==="loop"||t)&&this.currentLoopTime>this.data.emitTimeDuration*1e3&&(this.stopped||(this.stop(),t||this.start(this.data.emitTimeDelay*1e3))),this.emitter&&this.started){let i=this.actualTime/1e3;this.emitter.update(i,e)}this.scale.set(1,1,1),this.updateMatrix()}isReady(){return!!this.emitter}hasCollider(e){return this.colliderEntities.some(t=>t.identity===e)}getColliderData(e){let t=this.colliderEntities.find(i=>i.identity===e);return t?t.data:null}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),Dr(e.path,["renderMaterial"])&&this.updateParticleState({renderMaterial:{...this.data.renderMaterial,...Us.drop(e,1).props}}),Dr(e.path,["shape"])&&this.updateParticleState({shape:{...this.data.shape,...Us.drop(e,1).props}})}updateState(e,t){super.updateState(e,t),this.updateParticleState(e)}updateParticleState(e){if(this.emitter){if(e.colliderEntityId!==void 0&&e.colliderEntityId!==null){let t=this.context.scene.find(e.colliderEntityId);this.colliderEntities=t?[t]:[]}e.colliderEntityId===null&&(this.colliderEntities=[]),this.emitter.updateState(e),e.emitTimeCycle&&this.started&&this.start()}}updateFromColliderEntity(e){!this.emitter||(this.emitter.updateForceFieldParameters(e),this.stop(),this.start())}start(e=0){if(this.currentLoopTime=0,e){this.timeoutId=window.setTimeout(()=>{this.start(0)},e);return}this.started=!0,this.stopped=!1,this.isFrozen=!1,this.emitter?.startEmitting(this.actualTime/1e3)}froze(){this.isFrozen=!0}unFroze(){this.isFrozen=!1}stop(){this.stopped=!0,this.currentLoopTime=0,this.emitter?.stopEmitting(),clearTimeout(this.timeoutId)}reset(){this.started=!1,this.stopped=!1,this.emitter?.reset()}wakeUp(){this.isIdle=!1}sleep(){this.isIdle=!0,this.reset()}};function GOe(){try{let e=window.location.href;if(e.includes("reducesubdiv=")){let t=e.indexOf("reducesubdiv=")+13;return parseInt(e.slice(t,t+1))}}catch{}}var GD=GOe();function qOe(e,t,i){GD!==void 0&&(t?.geometry?.subdivisions??0)>GD&&(console.log("reducing subdivisions",t.name,t.geometry.subdivisions),t.geometry.subdivisions=GD);let r;return t.geometry.type==="TextGeometry"?new wB(e,t,i):t.geometry.type==="InputGeometry"?new TB(e,t,i):(t.geometry.type==="SubdivGeometry"?r=new u_(e,t,i):t.geometry.type==="PathGeometry"?r=new gT(e,t,i):t.geometry.type==="VectorGeometry"?r=new bOe(e,t,i):t.geometry.type==="BooleanGeometry"?r=new Kg(e,t,i):t.geometry.type==="ShapeBlendGeometry"?r=new Zg(e,t,i):t.geometry.type==="UIGeometry"?r=new ka(e,t,i):r=new kn(e,t,i),r)}function DB(e,t,i){return console.assert(t.type!==void 0),t.type==="Mesh"?qOe(e,t,i):t.type==="Empty"?new Zy(e,t):t.type==="Particle"?new pb(e,t,i):t.type==="ParticleCollider"?new fb(e,t,i):t.type==="Splat"?new Zy(e,t):t.type==="Bone"?new _Oe(e,t):t.type==="Page"?new Ns(e,t,i):t.type==="PointLight"?new CB(e,t,i):t.type==="SpotLight"?new pT(e,t,i):t.type==="DirectionalLight"?new fT(e,t,i):t.type==="Component"||t.type==="Instance"?new Jy(e,t,i):Xg.is(t.type)?new Ms(e,t):(console.error(t),new Zy(e,t))}pp.createEntity=DB;function XOe(e,t,i){let r=DB(e.identity,t,i),n=e.children,s=e.attachedPaths,a=e.parent,o=e.component,l=e.instances,u=e.overrideData,c=e.uuid,h=e.stateSelection;e.dispose();for(let d of Object.keys(e))delete e[d];Object.setPrototypeOf(e,Object.getPrototypeOf(r));for(let d of Object.keys(r))e[d]=r[d];e.children=[...e.children,...n],e.attachedPaths=s,e.parent=a,e.component=o,e.instances=l,e.uuid=c,e.overrideData=u,e.updateState(e.data,i),h&&e.changeSelectedState(h,i),e.resetBBoxNeedsUpdate()}pp.changeEntityProptotype=XOe;pp.Cloner=jl;function YOe(e,t,i,r){e.updateByOp(t,i,r,!1)}var lg=5,mb=new Kt;mb.setAttribute("position",new hi(new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),3));var jE=class extends t0e{constructor(e){super({...e,depthTest:!1,depthWrite:!1,glslVersion:EI,vertexShader:`
				precision highp float;
				in vec3 position;
				void main() {
					gl_Position = vec4(position, 1);
				}
			`})}customProgramCacheKey(){return""}};function QOe(){return{shapeInput:()=>`
			const float posRowCoord = ${.5/lg};  // vec4: px py pz opType
			const float quatRowCoord = ${1.5/lg};  // vec4: qx qy qz qw
			const float param1RowCoord = ${2.5/lg};// vec4: type param1 param2 param3
			const float param2RowCoord = ${3.5/lg};// vec4: blendRange roundness scale param4
			const float colorRowCoord = ${4.5/lg}; // vec4: r g b a
			uniform sampler2D shapesDataTexture;
			vec4 shapePos(float iin) { 
				vec4 r = texture(shapesDataTexture, vec2(iin, posRowCoord));
				return r;
			}
			vec4 shapeQuat(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, quatRowCoord));
				return r;
			}
			vec4 shapeParams1(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, param1RowCoord));
				return r;
			}
			vec4 shapeParams2(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, param2RowCoord));
				return r;
			}
			vec4 shapeColor(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, colorRowCoord));
				return r;
			}
		`,getxyzi:`
			// this code must complement lookup
			float xi = mod(gl_FragCoord.x - 0.5, VOXEL_RESOLUTION);
			float yi = mod(gl_FragCoord.y - 0.5, VOXEL_RESOLUTION);
			float zi = floor((gl_FragCoord.x - 0.5) * INV_VOXEL_RESOLUTION) + floor((gl_FragCoord.y - 0.5) * INV_VOXEL_RESOLUTION) * Z_LAYERS_PER_ROW;
		`,lookup:`
			uniform sampler2D potentialPassTexture;
			uniform sampler2D voxelPassTexture; // includes normal (in xyz) and key (in w)
			
			// box or marching cube lookup value in value texture, integer box coord inputs
			// this code must complement codebits.getxyzi
			vec4 look(float xi, float yi, float zi, sampler2D rt) {// range 0 .. numv etc
				vec2 uv = vec2(
					mod(zi, Z_LAYERS_PER_ROW) + (xi + 0.5) / VOXEL_RESOLUTION,
					floor(zi / Z_LAYERS_PER_ROW) + (yi + 0.5) / VOXEL_RESOLUTION
				); 
				uv /= Z_LAYERS_PER_ROW;
				return texture(rt, uv);
			}
		`,getpart:`
			float getpart(inout float a, float b) {
				float t = floor(a/b);
				float r = a - t*b;
				a = t;
				return r;
			}
		`,triTable:new Float32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,1,1,8,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,10,2,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,9,9,2,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,2,8,10,2,8,9,10,-1,-1,-1,-1,-1,-1,-1,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,0,0,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,11,3,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,1,11,9,1,11,8,9,-1,-1,-1,-1,-1,-1,-1,1,10,3,3,10,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,10,0,10,8,0,10,11,8,-1,-1,-1,-1,-1,-1,-1,0,9,3,9,11,3,9,10,11,-1,-1,-1,-1,-1,-1,-1,10,8,9,11,8,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,4,4,3,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,7,4,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,4,1,7,4,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,2,1,7,4,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,4,3,4,0,3,10,2,1,-1,-1,-1,-1,-1,-1,-1,10,2,9,2,0,9,7,4,8,-1,-1,-1,-1,-1,-1,-1,9,10,2,7,9,2,3,7,2,4,9,7,-1,-1,-1,-1,7,4,8,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,4,11,4,2,11,4,0,2,-1,-1,-1,-1,-1,-1,-1,1,0,9,7,4,8,11,3,2,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,9,2,11,9,1,2,9,-1,-1,-1,-1,1,10,3,10,11,3,4,8,7,-1,-1,-1,-1,-1,-1,-1,10,11,1,11,4,1,4,0,1,4,11,7,-1,-1,-1,-1,8,7,4,11,0,9,10,11,9,3,0,11,-1,-1,-1,-1,11,7,4,9,11,4,10,11,9,-1,-1,-1,-1,-1,-1,-1,4,5,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,9,3,8,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,0,0,5,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,8,5,3,8,5,1,3,-1,-1,-1,-1,-1,-1,-1,10,2,1,4,5,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,3,10,2,1,5,9,4,-1,-1,-1,-1,-1,-1,-1,10,2,5,2,4,5,2,0,4,-1,-1,-1,-1,-1,-1,-1,5,10,2,5,2,3,4,5,3,8,4,3,-1,-1,-1,-1,4,5,9,11,3,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,0,11,8,0,5,9,4,-1,-1,-1,-1,-1,-1,-1,4,5,0,5,1,0,11,3,2,-1,-1,-1,-1,-1,-1,-1,5,1,2,8,5,2,11,8,2,5,8,4,-1,-1,-1,-1,11,3,10,3,1,10,4,5,9,-1,-1,-1,-1,-1,-1,-1,5,9,4,1,8,0,1,10,8,10,11,8,-1,-1,-1,-1,0,4,5,11,0,5,10,11,5,3,0,11,-1,-1,-1,-1,8,4,5,10,8,5,11,8,10,-1,-1,-1,-1,-1,-1,-1,8,7,9,9,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,9,3,5,9,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,7,0,7,1,0,7,5,1,-1,-1,-1,-1,-1,-1,-1,3,5,1,7,5,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,7,9,7,5,9,2,1,10,-1,-1,-1,-1,-1,-1,-1,2,1,10,0,5,9,0,3,5,3,7,5,-1,-1,-1,-1,2,0,8,5,2,8,7,5,8,2,5,10,-1,-1,-1,-1,5,10,2,3,5,2,7,5,3,-1,-1,-1,-1,-1,-1,-1,5,9,7,9,8,7,2,11,3,-1,-1,-1,-1,-1,-1,-1,7,5,9,2,7,9,0,2,9,11,7,2,-1,-1,-1,-1,11,3,2,8,1,0,8,7,1,7,5,1,-1,-1,-1,-1,1,2,11,7,1,11,5,1,7,-1,-1,-1,-1,-1,-1,-1,8,5,9,7,5,8,3,1,10,11,3,10,-1,-1,-1,-1,0,7,5,9,0,5,0,11,7,10,0,1,0,10,11,-1,0,10,11,3,0,11,0,5,10,7,0,8,0,7,5,-1,5,10,11,5,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,6,10,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,0,9,6,10,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,1,8,9,1,6,10,5,-1,-1,-1,-1,-1,-1,-1,5,6,1,1,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,6,1,6,2,1,8,0,3,-1,-1,-1,-1,-1,-1,-1,5,6,9,6,0,9,6,2,0,-1,-1,-1,-1,-1,-1,-1,8,9,5,2,8,5,6,2,5,8,2,3,-1,-1,-1,-1,11,3,2,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,11,0,2,11,5,6,10,-1,-1,-1,-1,-1,-1,-1,9,1,0,11,3,2,6,10,5,-1,-1,-1,-1,-1,-1,-1,6,10,5,2,9,1,2,11,9,11,8,9,-1,-1,-1,-1,11,3,6,3,5,6,3,1,5,-1,-1,-1,-1,-1,-1,-1,11,8,0,5,11,0,1,5,0,6,11,5,-1,-1,-1,-1,6,11,3,6,3,0,5,6,0,9,5,0,-1,-1,-1,-1,9,5,6,11,9,6,8,9,11,-1,-1,-1,-1,-1,-1,-1,6,10,5,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,4,3,7,4,10,5,6,-1,-1,-1,-1,-1,-1,-1,0,9,1,6,10,5,7,4,8,-1,-1,-1,-1,-1,-1,-1,5,6,10,7,9,1,3,7,1,4,9,7,-1,-1,-1,-1,2,1,6,1,5,6,8,7,4,-1,-1,-1,-1,-1,-1,-1,5,2,1,6,2,5,4,0,3,7,4,3,-1,-1,-1,-1,7,4,8,5,0,9,5,6,0,6,2,0,-1,-1,-1,-1,9,3,7,4,9,7,9,2,3,6,9,5,9,6,2,-1,2,11,3,4,8,7,5,6,10,-1,-1,-1,-1,-1,-1,-1,6,10,5,2,7,4,0,2,4,11,7,2,-1,-1,-1,-1,9,1,0,8,7,4,11,3,2,6,10,5,-1,-1,-1,-1,1,2,9,2,11,9,11,4,9,4,11,7,6,10,5,-1,7,4,8,5,11,3,1,5,3,6,11,5,-1,-1,-1,-1,11,1,5,6,11,5,11,0,1,4,11,7,11,4,0,-1,9,5,0,5,6,0,6,3,0,3,6,11,7,4,8,-1,9,5,6,11,9,6,9,7,4,9,11,7,-1,-1,-1,-1,9,4,10,10,4,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,10,4,10,9,4,3,8,0,-1,-1,-1,-1,-1,-1,-1,1,0,10,0,6,10,0,4,6,-1,-1,-1,-1,-1,-1,-1,1,3,8,6,1,8,4,6,8,10,1,6,-1,-1,-1,-1,9,4,1,4,2,1,4,6,2,-1,-1,-1,-1,-1,-1,-1,8,0,3,9,2,1,9,4,2,4,6,2,-1,-1,-1,-1,4,2,0,6,2,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,4,2,8,6,2,4,-1,-1,-1,-1,-1,-1,-1,9,4,10,4,6,10,3,2,11,-1,-1,-1,-1,-1,-1,-1,2,8,0,11,8,2,10,9,4,6,10,4,-1,-1,-1,-1,2,11,3,6,1,0,4,6,0,10,1,6,-1,-1,-1,-1,1,4,6,10,1,6,1,8,4,11,1,2,1,11,8,-1,4,6,9,6,3,9,3,1,9,3,6,11,-1,-1,-1,-1,1,11,8,0,1,8,1,6,11,4,1,9,1,4,6,-1,6,11,3,0,6,3,4,6,0,-1,-1,-1,-1,-1,-1,-1,8,4,6,8,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,10,7,10,8,7,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,7,0,7,10,0,10,9,0,10,7,6,-1,-1,-1,-1,7,6,10,7,10,1,8,7,1,0,8,1,-1,-1,-1,-1,7,6,10,1,7,10,3,7,1,-1,-1,-1,-1,-1,-1,-1,6,2,1,8,6,1,9,8,1,7,6,8,-1,-1,-1,-1,9,6,2,1,9,2,9,7,6,3,9,0,9,3,7,-1,0,8,7,6,0,7,2,0,6,-1,-1,-1,-1,-1,-1,-1,2,3,7,2,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,3,2,8,6,10,9,8,10,7,6,8,-1,-1,-1,-1,7,0,2,11,7,2,7,9,0,10,7,6,7,10,9,-1,0,8,1,8,7,1,7,10,1,10,7,6,11,3,2,-1,1,2,11,7,1,11,1,6,10,1,7,6,-1,-1,-1,-1,6,9,8,7,6,8,6,1,9,3,6,11,6,3,1,-1,1,9,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,6,0,7,0,11,3,0,6,11,-1,-1,-1,-1,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,3,6,7,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,6,7,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,8,1,3,8,6,7,11,-1,-1,-1,-1,-1,-1,-1,2,1,10,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,1,8,0,3,7,11,6,-1,-1,-1,-1,-1,-1,-1,0,9,2,9,10,2,7,11,6,-1,-1,-1,-1,-1,-1,-1,7,11,6,3,10,2,3,8,10,8,9,10,-1,-1,-1,-1,3,2,7,7,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,7,0,6,7,0,2,6,-1,-1,-1,-1,-1,-1,-1,6,7,2,7,3,2,9,1,0,-1,-1,-1,-1,-1,-1,-1,2,6,1,6,8,1,8,9,1,6,7,8,-1,-1,-1,-1,6,7,10,7,1,10,7,3,1,-1,-1,-1,-1,-1,-1,-1,6,7,10,10,7,1,7,8,1,8,0,1,-1,-1,-1,-1,7,3,0,10,7,0,9,10,0,7,10,6,-1,-1,-1,-1,10,6,7,8,10,7,9,10,8,-1,-1,-1,-1,-1,-1,-1,4,8,6,6,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,6,3,6,0,3,6,4,0,-1,-1,-1,-1,-1,-1,-1,11,6,8,6,4,8,1,0,9,-1,-1,-1,-1,-1,-1,-1,6,4,9,3,6,9,1,3,9,6,3,11,-1,-1,-1,-1,4,8,6,8,11,6,1,10,2,-1,-1,-1,-1,-1,-1,-1,10,2,1,11,0,3,11,6,0,6,4,0,-1,-1,-1,-1,8,11,4,11,6,4,9,2,0,9,10,2,-1,-1,-1,-1,3,9,10,2,3,10,3,4,9,6,3,11,3,6,4,-1,3,2,8,2,4,8,2,6,4,-1,-1,-1,-1,-1,-1,-1,2,4,0,2,6,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,4,3,2,6,4,2,8,3,4,-1,-1,-1,-1,4,9,1,2,4,1,6,4,2,-1,-1,-1,-1,-1,-1,-1,3,1,8,1,6,8,6,4,8,1,10,6,-1,-1,-1,-1,0,1,10,6,0,10,4,0,6,-1,-1,-1,-1,-1,-1,-1,3,6,4,8,3,4,3,10,6,9,3,0,3,9,10,-1,4,9,10,4,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,9,4,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,5,9,4,6,7,11,-1,-1,-1,-1,-1,-1,-1,1,0,5,0,4,5,11,6,7,-1,-1,-1,-1,-1,-1,-1,6,7,11,4,3,8,4,5,3,5,1,3,-1,-1,-1,-1,4,5,9,2,1,10,11,6,7,-1,-1,-1,-1,-1,-1,-1,7,11,6,10,2,1,3,8,0,5,9,4,-1,-1,-1,-1,11,6,7,10,4,5,10,2,4,2,0,4,-1,-1,-1,-1,8,4,3,4,5,3,5,2,3,2,5,10,6,7,11,-1,3,2,7,2,6,7,9,4,5,-1,-1,-1,-1,-1,-1,-1,4,5,9,6,8,0,2,6,0,7,8,6,-1,-1,-1,-1,2,6,3,6,7,3,0,5,1,0,4,5,-1,-1,-1,-1,8,2,6,7,8,6,8,1,2,5,8,4,8,5,1,-1,4,5,9,6,1,10,6,7,1,7,3,1,-1,-1,-1,-1,10,6,1,6,7,1,7,0,1,0,7,8,4,5,9,-1,10,0,4,5,10,4,10,3,0,7,10,6,10,7,3,-1,10,6,7,8,10,7,10,4,5,10,8,4,-1,-1,-1,-1,5,9,6,9,11,6,9,8,11,-1,-1,-1,-1,-1,-1,-1,11,6,3,3,6,0,6,5,0,5,9,0,-1,-1,-1,-1,8,11,0,11,5,0,5,1,0,11,6,5,-1,-1,-1,-1,3,11,6,5,3,6,1,3,5,-1,-1,-1,-1,-1,-1,-1,10,2,1,11,5,9,8,11,9,6,5,11,-1,-1,-1,-1,3,11,0,11,6,0,6,9,0,9,6,5,10,2,1,-1,5,8,11,6,5,11,5,0,8,2,5,10,5,2,0,-1,3,11,6,5,3,6,3,10,2,3,5,10,-1,-1,-1,-1,9,8,5,8,2,5,2,6,5,2,8,3,-1,-1,-1,-1,6,5,9,0,6,9,2,6,0,-1,-1,-1,-1,-1,-1,-1,8,5,1,0,8,1,8,6,5,2,8,3,8,2,6,-1,6,5,1,6,1,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,3,1,10,6,1,6,8,3,9,6,5,6,9,8,-1,0,1,10,6,0,10,0,5,9,0,6,5,-1,-1,-1,-1,8,3,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,5,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,11,11,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,11,5,7,11,0,3,8,-1,-1,-1,-1,-1,-1,-1,7,11,5,11,10,5,0,9,1,-1,-1,-1,-1,-1,-1,-1,5,7,10,7,11,10,1,8,9,1,3,8,-1,-1,-1,-1,2,1,11,1,7,11,1,5,7,-1,-1,-1,-1,-1,-1,-1,3,8,0,7,2,1,5,7,1,11,2,7,-1,-1,-1,-1,5,7,9,7,2,9,2,0,9,7,11,2,-1,-1,-1,-1,2,5,7,11,2,7,2,9,5,8,2,3,2,8,9,-1,10,5,2,5,3,2,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,2,8,2,5,8,5,7,8,5,2,10,-1,-1,-1,-1,1,0,9,3,10,5,7,3,5,2,10,3,-1,-1,-1,-1,2,8,9,1,2,9,2,7,8,5,2,10,2,5,7,-1,5,3,1,5,7,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,1,7,0,5,7,1,-1,-1,-1,-1,-1,-1,-1,3,0,9,5,3,9,7,3,5,-1,-1,-1,-1,-1,-1,-1,7,8,9,7,9,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,5,8,10,5,8,11,10,-1,-1,-1,-1,-1,-1,-1,4,0,5,0,11,5,11,10,5,0,3,11,-1,-1,-1,-1,9,1,0,10,4,8,11,10,8,5,4,10,-1,-1,-1,-1,4,11,10,5,4,10,4,3,11,1,4,9,4,1,3,-1,1,5,2,5,8,2,8,11,2,8,5,4,-1,-1,-1,-1,11,4,0,3,11,0,11,5,4,1,11,2,11,1,5,-1,5,2,0,9,5,0,5,11,2,8,5,4,5,8,11,-1,5,4,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,2,2,5,3,5,4,3,4,8,3,-1,-1,-1,-1,2,10,5,4,2,5,0,2,4,-1,-1,-1,-1,-1,-1,-1,2,10,3,10,5,3,5,8,3,8,5,4,9,1,0,-1,2,10,5,4,2,5,2,9,1,2,4,9,-1,-1,-1,-1,5,4,8,3,5,8,1,5,3,-1,-1,-1,-1,-1,-1,-1,5,4,0,5,0,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,4,8,3,5,8,5,0,9,5,3,0,-1,-1,-1,-1,5,4,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,11,4,11,9,4,11,10,9,-1,-1,-1,-1,-1,-1,-1,3,8,0,7,9,4,7,11,9,11,10,9,-1,-1,-1,-1,11,10,1,4,11,1,0,4,1,11,4,7,-1,-1,-1,-1,4,1,3,8,4,3,4,10,1,11,4,7,4,11,10,-1,7,11,4,4,11,9,11,2,9,2,1,9,-1,-1,-1,-1,4,7,9,7,11,9,11,1,9,1,11,2,3,8,0,-1,4,7,11,2,4,11,0,4,2,-1,-1,-1,-1,-1,-1,-1,4,7,11,2,4,11,4,3,8,4,2,3,-1,-1,-1,-1,10,9,2,9,7,2,7,3,2,9,4,7,-1,-1,-1,-1,7,10,9,4,7,9,7,2,10,0,7,8,7,0,2,-1,10,7,3,2,10,3,10,4,7,0,10,1,10,0,4,-1,2,10,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,4,7,1,4,3,1,7,-1,-1,-1,-1,-1,-1,-1,1,9,4,7,1,4,1,8,0,1,7,8,-1,-1,-1,-1,3,0,4,3,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,10,9,8,11,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,3,11,9,3,10,9,11,-1,-1,-1,-1,-1,-1,-1,10,1,0,8,10,0,11,10,8,-1,-1,-1,-1,-1,-1,-1,10,1,3,10,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,2,1,9,11,1,8,11,9,-1,-1,-1,-1,-1,-1,-1,9,0,3,11,9,3,9,2,1,9,11,2,-1,-1,-1,-1,11,2,0,11,0,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,2,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,10,8,2,9,8,10,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,10,8,2,8,1,0,8,10,1,-1,-1,-1,-1,2,10,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),numTrisTable:new Float32Array([0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,2,3,4,4,3,3,4,4,3,4,5,5,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,2,3,3,4,3,4,2,3,3,4,4,5,4,5,3,2,3,4,4,3,4,5,3,2,4,5,5,4,5,2,4,1,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,2,4,3,4,3,5,2,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,3,4,4,3,4,5,5,4,4,3,5,2,5,4,2,1,2,3,3,4,3,4,4,5,3,4,4,5,2,3,3,2,3,4,4,5,4,5,5,2,4,3,5,4,3,2,4,1,3,4,4,5,4,5,3,4,4,5,5,2,3,4,2,1,2,3,3,2,3,4,2,1,3,2,4,1,2,1,1,0])}}var HE=new Wp,KOe=class{constructor(){this.pyramidPassScene=new Ho,this.pyramidPassMaterial=new jE({name:"PyramidPass"}),this.pyramidPassUniforms={inputTexture:{value:void 0},inputWidth:{value:0},inputHeight:{value:0},inputShiftX:{value:0},outputShiftX:{value:0}},this.pyramidTopLevelReadPixelBuffer=new Float32Array(4);let e=`
			precision highp float;
			precision highp sampler2D;
			layout(location = 0) out vec4 pc_FragColor;
			uniform sampler2D inputTexture;
			uniform float inputWidth;
			uniform float inputHeight;
			uniform float inputShiftX;
			uniform float outputShiftX;
			const vec2 half_unit_coord = vec2(0.5);
			const vec4 one = vec4(1.0);
			void main() {
				vec2 inputSize = vec2(inputWidth, inputHeight);
				vec2 input_pixel_uv = 1. / inputSize;
				vec2 coord = gl_FragCoord.xy - half_unit_coord;
				coord.x -= outputShiftX;
				coord = coord * 2. + half_unit_coord;
				coord.x += inputShiftX;

				// sample bottom left corner
				vec2 input_uv = coord / inputSize;
				float bl = texture(inputTexture, input_uv).r;

				// sample bottom right corner
				input_uv.x += input_pixel_uv.x;
				float br = texture(inputTexture, input_uv).r;

				// sample top right corner
				input_uv.y += input_pixel_uv.y;
				float tr = texture(inputTexture, input_uv).r;

				// sample top left corner
				input_uv.x -= input_pixel_uv.x;
				float tl = texture(inputTexture, input_uv).r;

				pc_FragColor.a = bl;
				pc_FragColor.b = pc_FragColor.a + br;
				pc_FragColor.g = pc_FragColor.b + tr;
				pc_FragColor.r = pc_FragColor.g + tl; 
			}
		`;this.pyramidPassMaterial.fragmentShader=e,this.pyramidPassMaterial.uniforms=this.pyramidPassUniforms,this.pyramidPassMaterial.depthTest=!1,this.pyramidPassMaterial.depthWrite=!1;let t=new zr(mb,this.pyramidPassMaterial);t.frustumCulled=!1,this.pyramidPassScene.add(t)}renderPyramid(e,t,i,r,n){new lk().min.setScalar(0);let s=t.length-1,a=new bi;i.getViewport(a),this.pyramidPassUniforms.inputShiftX.value=0,this.pyramidPassUniforms.outputShiftX.value=0;let o=s-1;for(let u=o;u>=0;u--){let c=u%2===o%2?n[0]:n[1],h=u===o?r:u%2===o%2?n[1]:n[0];this.pyramidPassUniforms.inputTexture.value=Array.isArray(h.texture)?h.texture[1]:h.texture,this.pyramidPassUniforms.inputWidth.value=h.width,this.pyramidPassUniforms.inputHeight.value=h.height,i.setRenderTarget(c);let d=t[u],p=i.getPixelRatio();i.setViewport(this.pyramidPassUniforms.outputShiftX.value/p,0,d/p,d/p),u===2&&e%2!==0&&i.setViewport(this.pyramidPassUniforms.outputShiftX.value/p,0,3/p,3/p),i.render(this.pyramidPassScene,HE);let m=this.pyramidPassUniforms.inputShiftX.value;this.pyramidPassUniforms.inputShiftX.value=this.pyramidPassUniforms.outputShiftX.value,this.pyramidPassUniforms.outputShiftX.value=m,u<o&&(this.pyramidPassUniforms.outputShiftX.value+=t[u+1])}i.setViewport(a);let l=t.length%2===0?0:1;return i.readRenderTargetPixelsAsync(n[l],n[l].width-1,0,1,1,this.pyramidTopLevelReadPixelBuffer).then(()=>this.pyramidTopLevelReadPixelBuffer[0])}},Au=24,ca=96,Sc=QOe(),Xh=2,pK=class extends kn{constructor(e,t,i){super(e,t,i),this.data=t,this.needsRebuild=!0,this.customDepthMaterialNeedsUpdate=!1,this._npart=-1,this.spatialn=1,this.drawRangeNeedsForceUpdate=!0,this._resolutionLevel=-1,this.resolution=64,this.spatialDivisions=25,this.zLayersPerRow=8,this.basePyramidSize=512,this.pyramidTexture1Width=341,this.pyramidTexture1Height=256,this.pyramidTexture2Width=170,this.pyramidTexture2Height=128,this.numLevels=9,this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512],this.bboxSize=0,this.bboxOffset=0,this.shapesDataTexture={value:void 0},this.spatialscene=new Ho,this.potentialPassScene=new Ho,this.voxelPassScene=new Ho,this._spatialPassRenderTargets=[],this._potentialPassRenderTargets=[],this._voxelPassRenderTargets=[],this._pyramidRenderTargets=[],this.geometry=new Kt,this.geometry.drawRange.count=0,this.spatialPassUniforms={span:{value:-1},shapesDataTexture:this.shapesDataTexture,npart:{value:this.npart},spatialn:{value:this.spatialn}},this.spatialMesh=new zr(mb,this.spatialPassMaterial()),this.spatialMesh.frustumCulled=!1,this.spatialscene.add(this.spatialMesh);let r=new oo(Sc.triTable,16,256,RE,br);r.needsUpdate=!0;let n=new oo(Sc.numTrisTable,256,1,RE,br);n.needsUpdate=!0,this.voxelPassUniforms={potentialPassTexture:{value:void 0},numTrisTable:{value:n}},this.voxelMesh=new zr(mb,this.voxelPassMaterial()),this.voxelMesh.frustumCulled=!1,this.voxelPassScene.add(this.voxelMesh),this.potentialPassUniforms={shapesDataTexture:this.shapesDataTexture,spatialPassTexture:{value:void 0},npart:{value:this.npart},spatialn:{value:this.spatialn}},this.potentialMesh=new zr(mb,this.potentialPassMaterial()),this.potentialMesh.frustumCulled=!1,this.potentialPassScene.add(this.potentialMesh),this.marchPassUniforms={triTable:{value:r},potentialPassTexture:{value:void 0},voxelPassTexture:{value:void 0},pyramidTexture1:{value:void 0},pyramidTexture1Size:{value:void 0},pyramidTexture2:{value:void 0},pyramidTexture2Size:{value:void 0}},this.frustumCulled=!1,this.onBeforeShadowPass=s=>{if(tze.call(this),this.npart===0){this.geometry.drawRange.count=0;return}let a=this.material.root;if(!a.shadersPatchedForShapeBlend)this.patchVertexShaderForShapeBlend(a),a.shadersPatchedForShapeBlend=!0,this.customDepthMaterialNeedsUpdate=!0;else if(this.customDepthMaterialNeedsUpdate){this.customDepthMaterialNeedsUpdate=!1,this.customDepthMaterial=new Zi({vertexShader:a.vertexShader,fragmentShader:`
						#include <packing>
						void main()
						{
							gl_FragColor = packDepthToRGBA(gl_FragCoord.z);
						}
					`,uniforms:a.uniforms,defines:this.material.defines}),this.isMeshDepthMaterial=!0,this.customDistanceMaterial=new Zi({vertexShader:a.vertexShader,fragmentShader:`
					#include <common>
					#include <packing>
					uniform vec3 referencePosition;
					uniform float nearDistance;
					uniform float farDistance;
					// World-space position
					varying vec3 vWPosition;
					void main()
					{
						float dist = length(vWPosition - referencePosition);
						dist = (dist - nearDistance) / (farDistance - nearDistance);
						dist = saturate(dist);
						// Required by Three.js for this to work
						gl_FragColor = packDepthToRGBA( dist );
					}`,uniforms:{nearDistance:{value:0},farDistance:{value:0},referencePosition:{value:new H},opacity:{value:0},...a.uniforms},defines:this.material.defines});let u=this.customDistanceMaterial;u.referencePosition=new H,u.nearDistance=0,u.farDistance=0,u.opacity=1,u.isMeshDistanceMaterial=!0}if(this.spatialPassUniforms.npart.value=this.npart,this.spatialPassUniforms.spatialn.value=this.spatialn,this.potentialPassUniforms.npart.value=this.npart,this.potentialPassUniforms.spatialn.value=this.spatialn,this.needsRebuild){this.needsRebuild=!1,this.spatialMesh.material.defines.RES=this.resolutionLevel,this.spatialMesh.material.needsUpdate=!0,this.potentialMesh.material.defines.RES=this.resolutionLevel,this.potentialPassUniforms.spatialPassTexture.value=this.spatialPassRenderTarget.texture,this.potentialMesh.material.needsUpdate=!0,this.voxelMesh.material.defines.RES=this.resolutionLevel,this.voxelMesh.material.needsUpdate=!0,this.voxelPassUniforms.potentialPassTexture.value=this.potentialPassRenderTarget.texture,this.marchPassUniforms.potentialPassTexture.value=this.potentialPassRenderTarget.texture,this.marchPassUniforms.voxelPassTexture.value=this.voxelPassRenderTarget.texture[0],this.material.defines.RES=this.resolutionLevel,this.material.defines.LEVELS=this.pyramidLevelSizes.length,this.material.defines.LOOP=this.pyramidLevelSizes.length%2===0?this.pyramidLevelSizes.length-3:this.pyramidLevelSizes.length-2,this.material.defines.HALF=this.pyramidLevelSizes.length%2===0?1:0,this.material.needsUpdate=!0;let u=this.pyramidLevelSizes.length%2===0?0:1,c=this.pyramidLevelSizes.length%2===0?1:0;this.marchPassUniforms.pyramidTexture2.value=this.pyramidRenderTarget[u].texture,this.marchPassUniforms.pyramidTexture2Size.value=new Pe(this.pyramidRenderTarget[u].width,this.pyramidRenderTarget[u].height),this.marchPassUniforms.pyramidTexture1.value=this.pyramidRenderTarget[c].texture,this.marchPassUniforms.pyramidTexture1Size.value=new Pe(this.pyramidRenderTarget[c].width,this.pyramidRenderTarget[c].height),Object.assign(this.material.uniforms,this.marchPassUniforms)}let o=s.shadowMap.enabled;s.shadowMap.enabled=!1;let l=s.getRenderTarget();s.setRenderTarget(this.spatialPassRenderTarget),s.render(this.spatialscene,HE),s.setRenderTarget(this.potentialPassRenderTarget),s.render(this.potentialPassScene,HE),s.setRenderTarget(this.voxelPassRenderTarget),s.render(this.voxelPassScene,HE),pK.streamCompaction.renderPyramid(this.resolutionLevel,this.pyramidLevelSizes,s,this.voxelPassRenderTarget,this.pyramidRenderTarget).then(u=>{this.material.wireframe&&(u*3>this.geometry.attributes.position.count||this.drawRangeNeedsForceUpdate)&&(this.geometry.dispose(),this.geometry=new Kt,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]},this.geometry.attributes.position=new hi(new Float32Array(u*3*2),3)),(u*3>this.geometry.drawRange.count||this.drawRangeNeedsForceUpdate)&&(this.geometry.drawRange.count=Math.floor(u*1.2)*3),this.drawRangeNeedsForceUpdate=!1}),s.shadowMap.enabled=o,s.setRenderTarget(l)}}set npart(e){e!==this._npart&&(this.drawRangeNeedsForceUpdate=!0,this._npart=e,this.spatialn=Math.ceil(e/(4*Au)))}get npart(){return this._npart}set resolutionLevel(e){let t=Math.min(8,Math.max(5,e));if(t!==this._resolutionLevel){switch(this._resolutionLevel=t,this.resolution=Math.pow(2,t),this.resolutionLevel){case 5:this.pyramidLevelSizes=[1,2,4,6,12,24,48,96,192],this.bboxSize=248*Xh,this.bboxOffset=8*Xh*-1/2;break;case 6:this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512],this.bboxSize=252*Xh,this.bboxOffset=4*Xh*-1/2;break;case 7:this.pyramidLevelSizes=[1,2,4,6,12,24,48,96,192,384,768,1536],this.bboxSize=254*Xh,this.bboxOffset=2*Xh*-1/2;break;case 8:this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096],this.bboxSize=255*Xh,this.bboxOffset=Xh*-1/2;break}this.pyramidTexture1Width=0,this.pyramidTexture2Width=0,this.pyramidTexture1Height=this.pyramidLevelSizes[this.pyramidLevelSizes.length-2],this.pyramidTexture2Height=this.pyramidLevelSizes[this.pyramidLevelSizes.length-3];for(let i=this.pyramidLevelSizes.length-2;i>=0;i--)(this.pyramidLevelSizes.length-2)%2===i%2?this.pyramidTexture1Width+=this.pyramidLevelSizes[i]:this.pyramidTexture2Width+=this.pyramidLevelSizes[i];this.basePyramidSize=this.pyramidLevelSizes[this.pyramidLevelSizes.length-1],this.zLayersPerRow=this.basePyramidSize/this.resolution,this.numLevels=this.pyramidLevelSizes.length-1,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]},this.needsRebuild=!0,this.customDepthMaterialNeedsUpdate=!0}}get resolutionLevel(){return this._resolutionLevel}get spatialPassRenderTarget(){let e=this._spatialPassRenderTargets[this.resolutionLevel];return e||(e=new Ki(this.spatialDivisions*this.spatialn,this.spatialDivisions**2,{format:$r,type:br,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:Ni,magFilter:Ni}),this._spatialPassRenderTargets[this.resolutionLevel]=e),e}get potentialPassRenderTarget(){let e=this._potentialPassRenderTargets[this.resolutionLevel];return e||(e=new Ki(this.basePyramidSize,this.basePyramidSize,{format:$r,type:br,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:Ni,magFilter:Ni}),this._potentialPassRenderTargets[this.resolutionLevel]=e),e}get voxelPassRenderTarget(){let e=this._voxelPassRenderTargets[this.resolutionLevel];return e||(e=new aq(this.basePyramidSize,this.basePyramidSize,2,{stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:Ni,magFilter:Ni}),e.texture[0].format=$r,e.texture[0].type=br,e.texture[1].format=RE,e.texture[1].type=br,this._voxelPassRenderTargets[this.resolutionLevel]=e),e}get pyramidRenderTarget(){let e=this._pyramidRenderTargets[this.resolutionLevel];if(!e){let t=new Ki(this.pyramidTexture1Width,this.pyramidTexture1Height,{format:$r,type:br,stencilBuffer:!1,depthBuffer:!1,magFilter:Ni,minFilter:Ni}),i=new Ki(this.pyramidTexture2Width,this.pyramidTexture2Height,{format:$r,type:br,stencilBuffer:!1,depthBuffer:!1,magFilter:Ni,minFilter:Ni});e=[t,i],this._pyramidRenderTargets[this.resolutionLevel]=e}return e}updateState(e,t){let i=this.material;super.updateState(e,t),i!==this.material&&(this.needsRebuild=!0),e.geometry&&(this.resolutionLevel=e.geometry.resolutionLevel,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]}),e.wireframe&&!this.geometry.getAttribute("position")?this.geometry.setAttribute("position",new hi(new Float32Array(this.geometry.drawRange.count*3),3)):!e.wireframe&&this.geometry.getAttribute("position")&&this.geometry.deleteAttribute("position")}spatialPassMaterial(){let e=`
			precision highp float;
			out vec4 pc_FragColor;
			const float spatialDivisions = ${this.spatialDivisions}.;
			uniform float span;
			uniform float npart;
			uniform float spatialn;
			${Sc.shapeInput()}

			vec3 low, high;     // range of current div; subset of -1 .. 1 with span border

			// lookup one element/channel's worth of spheres for current division
			// stating with low sphere number lowi
			// gives a key to which spheres from lowi..lowi+23 are active within given div (low..high)
			float spatialKey(float lowi) {
				float t = 0.;
				for (float ii = ${Au-1}.; ii >= 0.; ii--) {
					float i = ii + lowi;
					float iin = (i + 0.5) / ${ca}.;
					vec4 shape = shapePos(iin);
					vec3 d = shape.xyz;
					float op = shape.w;
	
					t *= 2.;
					t += (
						low.x < d.x && d.x < high.x &&
						low.y < d.y && d.y < high.y &&
						low.z < d.z && d.z < high.z &&
						i < npart || op == -2. // always include if op is -2, which is the intersection operation
					) ? 1. : 0.;
				}
				return t;
			}

			${Sc.getpart}

			void main() {               // spatialial fragment shader
				// find active div
				vec3 div;                               // which div is current
				// out holds x=> x, lowi faster moving and y=> z, y faster moving
				float yz = float(gl_FragCoord.y - 0.5);     // contains  z, y faster moving
				div.y = getpart(yz, spatialDivisions);
				div.z = yz; // getpart(yz, spatialDivisions.z); // what's left, should be the same as getpart

				float lx = float(gl_FragCoord.x - 0.5);     // contains x, lowi faster moving
				float lowi = getpart(lx, spatialn) * ${4*Au}.;
				div.x = lx;

				low = div / spatialDivisions * 2. - 1. - span;
				high = (div+1.) / spatialDivisions * 2. - 1. + span;

				// find active range of spheres
				pc_FragColor.x = spatialKey(lowi);
				pc_FragColor.y = spatialKey(lowi+${Au}.);
				pc_FragColor.z = spatialKey(lowi+${2*Au}.);
				pc_FragColor.w = spatialKey(lowi+${3*Au}.);
			}
		`;return new jE({name:"Spatial Pass",fragmentShader:e,uniforms:this.spatialPassUniforms})}potentialPassMaterial(){let e=`
			precision highp float;
			out vec4 pc_FragColor;

			${Sc.shapeInput()}
			uniform sampler2D spatialPassTexture;

			const float res = float(RES);
			const float VOXEL_RESOLUTION = pow(2., res);
			const float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));
			const float VOXEL_RESOLUTION_SUB1 = VOXEL_RESOLUTION - 1.;
			const float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;

			uniform float npart;
			uniform float spatialn;
			const float spatialDivisions = ${this.spatialDivisions}.;
			const float spatialDivisions2 = spatialDivisions * spatialDivisions;
			const float spatialDivisionsSub1 = spatialDivisions - 1.;

			${Sc.getpart}

			vec3 packRGBAToVec3(vec4 color) {
				uint r = uint(color.r * 255.);
				uint g = uint(color.g * 255.);
				uint combined = (r << 8) | g; 
				return vec3(float(combined) * 0.00001525902, color.b, color.a); // 1/65535
			}

			void applyQuaternionToVector(in vec4 q, inout vec3 v) {
				v += 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);
			}

			/**
			 * SDF functions (reference: https://iquilezles.org/articles/distfunctions/)
			 */

			// branchless version of "Smooth Union, Subtraction and Intersection - bound, bound, bound" in above reference
			float smoothOperation(float op, float sdf, float d, float k) {
			  //        union: op =  1 => signSubtract =  1, signIntersection =  1
			  //     subtract: op = -1 => signSubtract = -1, signIntersection =  1
				// intersection: op = -2 => signSubtract = -1, signIntersection = -1

				float signSubtract = clamp(op, -1., 1.);
				float signIntersection = 2. * (op - signSubtract) + 1.;
				float h = clamp(
					0.5 + signSubtract * 0.5 * (sdf - signSubtract * signIntersection * d) / k,
					0.0,
					1.0
				);
				return mix(sdf, signSubtract * signIntersection * d, h) - 
							 signSubtract * k * h * (1.0 - h);
			}

			float sdSphere( vec3 p, float s )
			{
				return length(p)-s;
			}

			float sdEllipsoid( vec3 p, vec3 r )
			{
				float k0 = length(p/r);
				float k1 = length(p/(r*r));
				return k0*(k0-1.0)/k1;
			}

			float sdBox( vec3 p, vec3 b )
			{
				vec3 q = abs(p) - b;
				return length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0);
			}

			float sdTorus( vec3 p, vec2 t )
			{
				vec2 q = vec2(length(p.xy)-t.x,p.z);
				return length(q)-t.y;
			}

			float sdCappedTorus( vec3 p, vec2 sc, float ra, float rb)
			{
				p.x = abs(p.x);
				float k = (sc.y*p.x>sc.x*p.y) ? dot(p.xy,sc) : length(p.xy);
				return sqrt( dot(p,p) + ra*ra - 2.0*ra*k ) - rb;
			}

			float dot2( in vec2 v ) { return dot(v,v); }
			float sdCappedCone( vec3 p, float h, float r1, float r2 )
			{
				vec2 q = vec2( length(p.xz), p.y );
				vec2 k1 = vec2(r2,h);
				vec2 k2 = vec2(r2-r1,2.0*h);
				vec2 ca = vec2(q.x-min(q.x,(q.y<0.0)?r1:r2), abs(q.y)-h);
				vec2 cb = q - k1 + k2*clamp( dot(k1-q,k2)/dot2(k2), 0.0, 1.0 );
				float s = (cb.x<0.0 && ca.y<0.0) ? -1.0 : 1.0;
				return s*sqrt( min(dot2(ca),dot2(cb)) );
			}

			float sdCappedCylinder( vec3 p, float h, float r )
			{
				vec2 d = abs(vec2(length(p.xz),p.y)) - vec2(r,h);
				return min(max(d.x,d.y),0.0) + length(max(d,0.0));
			}

			float maxBlend = 0.0;
			// compute potential from A (=24) spheres, using the bit flags in 'activeKey'
			// to avoid lookup/compute for inactive spheres
			// return field potential, side effect updates track,
			// compute and return +ve and -ve values separately
			void fillSpatialInner(
				float ii,
				float activeKey,
				vec3 corner,
				inout float sdf,
				inout float colorDivisor,
				inout vec4 trackColor
			) {
				for (float i = 0.; i < ${Au}.; i++) {
					if (activeKey < 1.) break; // activeKey exhausted, no more active spheres
					activeKey *= 0.5;
					if (fract(activeKey) < 0.5) continue;

					float iin = (i + ii + 0.5) * ${1/ca};
					vec4 shape = shapePos(iin);
					vec4 quat = shapeQuat(iin);
					vec4 params1 = shapeParams1(iin);
					vec4 params2 = shapeParams2(iin);

					vec3 p = corner - shape.xyz;
					applyQuaternionToVector(quat, p);
					p /= params2.z; // scale
					float d; // d in -1..1 coordinates
					switch (int(params1.x)) {
						case 0: d = sdSphere(p, params1.y); break;
						case 1: d = sdEllipsoid(p, params1.yzw); break;
						case 2: d = sdBox(p, params1.yzw); break;
						case 3: d = sdCappedCylinder(p, params1.y, params1.z); break;
						case 4: d = sdCappedCone(p, params1.y, params1.z, params1.w); break;
						case 5: d = sdTorus(p, params1.yz); break;
						case 6: d = sdCappedTorus(p, params1.yz, params1.w, params2.w); break;
					}
					d -= params2.y; // rounded edge
					d *= params2.z; // scale

					float k = params2.x;
					float op = shape.w;

					sdf = smoothOperation(shape.w, sdf, d, k);

					float isNegativeOne = step(-1.5, op) * step(op, -0.5); // 1 when op == -1, 0 otherwise
					float colorCull = smoothstep(maxBlend, 0., -d);
					float cullFactor = mix(1.0, colorCull, isNegativeOne);
					trackColor *= cullFactor;
					colorDivisor *= cullFactor;

					maxBlend = max(maxBlend, k);

					k += 2. * INV_VOXEL_RESOLUTION; // avoid division by zero, and other color artifacts with very small k
					float nearness = smoothstep(k, 0., d);

					vec4 color = shapeColor(iin);
					nearness *= float(color.a >= 0.);

					colorDivisor += nearness;
					trackColor += color * nearness;
				}
			}

			vec3 div;
			// compute potential from all spheres; collect +ve and =ve values separately
			// work in blocks of A*4 (=96) spheres, using the bit flags in 4 float channel 'activeKey' values
			// TODO check if extra vec3 output useful, not really used at present
			float fillSpatial(vec3 corner, inout vec4 trackColor) {
				float sdf = 1e3; // hack: initialize to large value
				float colorDivisor = 0.;
				// spatialPassTexture holds x=> lowi, x faster moving and y=> z, y faster moving
				float divyz = (div.y + div.z * spatialDivisions + 0.5) / (spatialDivisions2);
				for (float ii = 0.; ii < spatialn; ii++) {
					float i = ii * ${4*Au}.;

					vec4 activeKey = texture(spatialPassTexture, vec2((div.x * spatialn + ii + 0.5)/(spatialn * spatialDivisions), divyz));
					fillSpatialInner(i, activeKey.x, corner, sdf, colorDivisor, trackColor);
					fillSpatialInner(i+${Au}., activeKey.y, corner, sdf, colorDivisor, trackColor);
					fillSpatialInner(i+${2*Au}., activeKey.z, corner, sdf, colorDivisor, trackColor);
					fillSpatialInner(i+${3*Au}., activeKey.w, corner, sdf, colorDivisor, trackColor);
				}

				trackColor /= colorDivisor;
				return mix(sdf, 0.0, step(1e20 - 0.1, sdf));
			}

			void main() {
				${Sc.getxyzi}    // get xi yi zi from 2d position

				vec3 xyzi = vec3(xi,yi,zi);
				vec3 corner = xyzi / VOXEL_RESOLUTION_SUB1 * 2. - 1.;  // -1..1 coords

				div = floor(xyzi / VOXEL_RESOLUTION_SUB1 * spatialDivisionsSub1);

				vec4 c = vec4(0.);
				float t = fillSpatial(corner, c);

				pc_FragColor = vec4(t, packRGBAToVec3(c)); // RGB texture
			}
		`;return new jE({name:"PotentialPass",fragmentShader:e,uniforms:this.potentialPassUniforms})}voxelPassMaterial(){let e=`
			precision highp float;
			layout(location = 0) out vec4 pc_FragColor;
			layout(location = 1) out vec4 numTris;

			const float res = float(RES);
			const float VOXEL_RESOLUTION = pow(2., res);
			const float VOXEL_RESOLUTION_SUB1 = VOXEL_RESOLUTION - 1.; 
			const float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));
			const float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;
			uniform sampler2D numTrisTable; // 256 x 1

			float keyi(float f000, float f100, float f010, float f110, float f001, float f101, float f011, float f111) {
				return (float(f000 < 0.) * 1.) +
							 (float(f100 < 0.) * 2.) +
							 (float(f010 < 0.) * 8.) +
							 (float(f110 < 0.) * 4.) +
							 (float(f001 < 0.) * 16.) +
							 (float(f101 < 0.) * 32.) +
							 (float(f011 < 0.) * 128.) +
							 (float(f111 < 0.) * 64.);
			}

			${Sc.lookup}

			vec3 compNormi(float xi, float yi, float zi) {
				float dx = look(xi + 1., yi, zi, potentialPassTexture).r - look(xi - 1., yi, zi, potentialPassTexture).r;
				float dy = look(xi, yi + 1., zi, potentialPassTexture).r - look(xi, yi - 1., zi, potentialPassTexture).r;
				float dz = look(xi, yi, zi + 1., potentialPassTexture).r - look(xi, yi, zi - 1., potentialPassTexture).r;
				// if we allow (common) 0,0,0 case through then NaN can spread
				// eg r = vec4(compNorm i(???), 1.) will pollute r.w
				if (dx == 0.0 && dy == 0.0 && dz == 0.0) {
					return vec3(0.199, 0.299, 0.399);
				}
				return normalize(vec3(dx, dy, dz));
			}

			void main() {
				${Sc.getxyzi}    // get xi yi zi from 2d

				vec3 normal = compNormi(xi, yi, zi);  // even if our key is -1 this may be needed by a neighbouring voxel

				if (xi >= VOXEL_RESOLUTION_SUB1 || yi >= VOXEL_RESOLUTION_SUB1 || zi >= VOXEL_RESOLUTION_SUB1) {
					pc_FragColor = vec4(normal, 0.);
					numTris = vec4(0.);
					return;
				}

				float
					f000 = look(xi, yi, zi, potentialPassTexture).r,
					f100 = look(xi+1., yi, zi, potentialPassTexture).r,
					f010 = look(xi, yi+1., zi, potentialPassTexture).r,
					f110 = look(xi+1., yi+1., zi, potentialPassTexture).r,
					f001 = look(xi, yi, zi+1., potentialPassTexture).r,
					f101 = look(xi+1., yi, zi+1., potentialPassTexture).r,
					f011 = look(xi, yi+1., zi+1., potentialPassTexture).r,
					f111 = look(xi+1., yi+1., zi+1., potentialPassTexture).r;
				float key = keyi(f000, f100, f010, f110, f001, f101, f011, f111);

				pc_FragColor = vec4(normal, key);

				numTris = texture(numTrisTable, vec2((key + 0.5) / 256., 0.5));
			}
		`;return new jE({name:"VoxelPass",fragmentShader:e,uniforms:this.voxelPassUniforms})}patchVertexShaderForShapeBlend(e){let t=`
		#ifdef SHAPEBLEND 
			precision highp sampler2D;

			uniform float isol;

			uniform sampler2D triTable;     // 256 x 16
			uniform sampler2D pyramidTexture1;
			uniform vec2 pyramidTexture1Size;
			uniform sampler2D pyramidTexture2;
			uniform vec2 pyramidTexture2Size;

			const vec2 halfPixelOffset = vec2(0.5, 0.5);

			const vec2 rShift = vec2(0., 1.);
			const vec2 gShift = vec2(1., 1.);
			const vec2 bShift = vec2(1., 0.);

			const float res = float(RES);
			const float VOXEL_RESOLUTION = pow(2., res);
			const float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));
			const float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;

			const float scale_factor = ${Xh}.;

			#if SHAPEBLEND == 5
				const float levelShiftX[7] = float[7](4., 6., 12., 24., 48., 96., 192.);
				const float scale = 8. * scale_factor;
				const vec3 originOffset = vec3(16.);
			#elif SHAPEBLEND == 7
				const float levelShiftX[10] = float[10](4., 6., 12., 24., 48., 96., 192., 384., 768., 1536.); 
				const float scale = 2. * scale_factor;
				const vec3 originOffset = vec3(64.);
			#elif SHAPEBLEND == 8
				const float levelShiftX[11] = float[11](4., 8., 16., 32., 64., 128., 256., 512., 1024., 2048., 4096.);
				const float scale = scale_factor;
				const vec3 originOffset = vec3(128.);
			#else
				const float levelShiftX[8] = float[8](4., 8., 16., 32., 64., 128., 256., 512.);
				const float scale = 4. * scale_factor;
				const vec3 originOffset = vec3(32.);
			#endif

			${Sc.lookup}

			const vec3 offsets[24] = vec3[](
				vec3(0., 0., 0.), vec3(1., 0., 0.),
				vec3(1., 0., 0.), vec3(1., 1., 0.),
				vec3(0., 1., 0.), vec3(1., 1., 0.),
				vec3(0., 0., 0.), vec3(0., 1., 0.),
				vec3(0., 0., 1.), vec3(1., 0., 1.),
				vec3(1., 0., 1.), vec3(1., 1., 1.),
				vec3(0., 1., 1.), vec3(1., 1., 1.),
				vec3(0., 0., 1.), vec3(0., 1., 1.),
				vec3(0., 0., 0.), vec3(0., 0., 1.),
				vec3(1., 0., 0.), vec3(1., 0., 1.),
				vec3(1., 1., 0.), vec3(1., 1., 1.),
				vec3(0., 1., 0.), vec3(0., 1., 1.)
			);

			vec2 computeShiftedPosition1(vec2 xy, float levelOriginX) {
				vec2 xyShifted = xy;
				xyShifted.x += levelOriginX;
				return (xyShifted + halfPixelOffset) / pyramidTexture1Size;
			}

			vec2 computeShiftedPosition2(vec2 xy, float levelOriginX) {
				vec2 xyShifted = xy;
				xyShifted.x += levelOriginX;
				return (xyShifted + halfPixelOffset) / pyramidTexture2Size;
			}

			vec4 unpackVec3ToRGBA(vec3 vec) {
				uint combined = uint(vec.x * 65535.0 + 0.5); // Add 0.5 for rounding
				float g = float(combined & uint(0xFF)) * 0.00392156862; // 1/255
				float r = float((combined >> 8) & uint(0xFF)) * 0.00392156862; 
		
				return vec4(r, g, vec.y, vec.z);
			}

			out vec4 marchColor;
			// end of marchvertPre
		#endif
		`,i=`
		#ifdef SHAPEBLEND
			float triIndex = floor(float(gl_VertexID/3));
			float vertexIndex = float(gl_VertexID);
			
			// Initial pyramid lookup
			float levelOriginX1 = pyramidTexture1Size.x - 2.;
			float levelOriginX2 = pyramidTexture2Size.x - 1.;
			vec2 xy = vec2(0.);
			vec4 lookUp = texture(pyramidTexture2, computeShiftedPosition2(xy, levelOriginX2));
			
			// Early exit check
			if (triIndex >= lookUp.r) return;
			
			// Optimize loop variables
			float start = 0.;
			vec4 triIndexVec = vec4(triIndex);
			
			// Main position computation loop
			for (int i = 0; i < LOOP;) {
				// Compute boundaries
				vec4 ends = lookUp + vec4(start);
				vec4 starts = vec4(ends.gba, start);
				vec4 check = vec4(greaterThanEqual(triIndexVec, starts)) * 
											vec4(lessThan(triIndexVec, ends));
				
				// Update position
				xy *= 2.;
				xy += check.r * rShift + check.g * gShift + check.b * bShift;
				
				// Update loop variables
				start = dot(check, starts);
				levelOriginX2 -= levelShiftX[i];
				
				// Update lookup
				lookUp = texture(pyramidTexture1, computeShiftedPosition1(xy, levelOriginX1));
				i++;

				ends = lookUp + vec4(start);
				starts = vec4(ends.gba, start);
				check = vec4(greaterThanEqual(triIndexVec, starts)) * 
											vec4(lessThan(triIndexVec, ends));
				
				// Update position
				xy *= 2.;
				xy += check.r * rShift + check.g * gShift + check.b * bShift;
				
				// Update loop variables
				start = dot(check, starts);
				levelOriginX1 -= levelShiftX[i];
				
				// Update lookup
				lookUp = texture(pyramidTexture2, computeShiftedPosition2(xy, levelOriginX2));

				i++;
			}

			#if HALF == 1
				vec4 ends = lookUp + vec4(start);
				vec4 starts = vec4(ends.gba, start);
				vec4 check = vec4(greaterThanEqual(triIndexVec, starts)) * vec4(lessThan(triIndexVec, ends));
			
				// Update position
				xy *= 2.;
				xy += check.r * rShift + check.g * gShift + check.b * bShift;
			
				// Update loop variables
				start = dot(check, starts);
			#endif
			
			// Compute final coordinates
			vec3 gridPos;
			gridPos.x = mod(xy.x, VOXEL_RESOLUTION);
			gridPos.y = mod(xy.y, VOXEL_RESOLUTION);
			gridPos.z = floor(xy.x * INV_VOXEL_RESOLUTION) + 
									floor(xy.y * INV_VOXEL_RESOLUTION) * Z_LAYERS_PER_ROW;
			
			// Vertex key computation
			vertexIndex -= start * 3.;
			float vk = vertexIndex * 0.0625 + 0.03125; // Optimized division by 16 and addition of 1/32
			
			// Voxel lookup and edge computation
			vec4 voxel = look(gridPos.x, gridPos.y, gridPos.z, voxelPassTexture);
			float key = (voxel.w + 0.5) * 0.00390625; // Optimized division by 256
			
			// Edge lookup and offset computation
			float edgeNum = texture(triTable, vec2(vk, key)).x;
			int edgeIndex = int(edgeNum) * 2;
			
			// Compute edge positions
			vec3 p1 = gridPos + offsets[edgeIndex];
			vec3 p2 = gridPos + offsets[edgeIndex + 1];
			
			// Compute potentials and normals
			vec4 potential1 = look(p1.x, p1.y, p1.z, potentialPassTexture);
			vec4 potential2 = look(p2.x, p2.y, p2.z, potentialPassTexture);
			
			// Final position and normal computation
			float mu = potential1.r / (potential1.r - potential2.r);

			marchColor = mix(
				unpackVec3ToRGBA(potential1.gba),
				unpackVec3ToRGBA(potential2.gba),
				mu
			);

			transformed = p1 + (p2 - p1) * mu;
			transformed -= originOffset;
			transformed *= scale;
			vec4 data1 = look(p1.x, p1.y, p1.z, voxelPassTexture);
			vec4 data2 = look(p2.x, p2.y, p2.z, voxelPassTexture);
			objectNormal = normalize(mix(data1.xyz, data2.xyz, mu));
			transformedNormal = normalMatrix * objectNormal;
			#ifndef FLAT_SHADED
				vNormal = transformedNormal;
			#endif
		#endif
		`;e.vertexShader=t+e.vertexShader.replace("#include <project_vertex>",i+`
#include <project_vertex>`);let r=e.fragmentShader.match(/vec3 diffuseColor[^\n]*\n/);if(!r)return;let n=`
		#ifdef SHAPEBLEND_C
			#if SHAPEBLEND_C == 1
				${r[0].replace(/nodeU0,/g,"marchColor.rgb,").replace(/nodeU\d+(?=,g_uid\d+_calpha\))/g,"marchColor.a")}
			#else
				${r[0]}
			#endif
		#else
			${r[0]}
		#endif
		`;e.fragmentShader=`in vec4 marchColor;
`+e.fragmentShader.replace(r[0],n),Object.assign(e.uniforms,this.marchPassUniforms)}initDebugPass(e){console.log("fboToDebug.width",e.width,e.height),this.geometry=new Zc(e.width,e.height),this.geometry.userData={parameters:{width:4,height:4}};let t={inputTexture:{value:Array.isArray(e.texture)?e.texture[1]:e.texture},pyramidTextureSize:{value:void 0}},i=r=>{r.vertexShader=`
				precision highp float;

				varying vec2 vUv;

				void main() {
						gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
						vUv = uv;
				}
			`,r.fragmentShader=`
				layout(location = 1) out vec4 gVelocity;

				precision highp float;
				
				uniform sampler2D inputTexture;
				varying vec2 vUv;

				uniform vec2 pyramidTextureSize;

				void main() {
						// Sample the input texture using UV coordinates
						gl_FragColor = texture(inputTexture, vUv);
						gVelocity = vec4(0.0);
				}
			`,t.pyramidTextureSize.value=new Pe(this.pyramidRenderTarget.width,this.pyramidRenderTarget.height),Object.assign(r.uniforms,t)};this.material.shapeBlendhack=i,this.material.root.shapeBlendhack=i}},Zg=pK;Zg.streamCompaction=new KOe;var ZOe=new yt,JOe=new yt,ny=new xi,Gf=new H,oE=new H,$Oe=new xi;function eze(e,t=0){let i=this.children.length;for(;i--;){let r=this.children[i];Yg.is(r)&&mK.call(r,e,t+1)}}function mK(e,t=0){if(e(this,t)!==!0){let i=this.children.length;for(;i--;){let r=this.children[i];Yg.is(r)&&mK.call(r,e,t+1)}}}function tze(){if(this.shapesDataTexture.value===void 0){let a=new oo(new Float32Array(4*ca*lg),ca,lg,$r,br);this.shapesDataTexture.value=a}let e=this.shapesDataTexture.value,t=e.image.data;e.needsUpdate=!0;let i=0,r=this.data.geometry.blendRange,n=ZOe.copy(this.matrixWorld).invert(),s=0;eze.call(this,a=>{if(a.visible===!1)return!0;let o;if(a instanceof jl||a instanceof fb||a instanceof pb)return;a instanceof ya?o=a.object:o=a;let l=a.data?.cloner;if(Xi.is(a)&&l&&!l.hideBase&&l.type!=="radial"&&l.disabled!==!0||!(o instanceof kn))return;let u=o.geometry.userData.parameters,c=u.shapeBlendNode;if(c===void 0)return;if(JOe.multiplyMatrices(n,a.matrixWorld).decompose(oE,ny,Gf),u.type==="TorusGeometry"&&u.arc!==360){let w=u.arc*Math.PI/180;w=w/4,ny.multiply($Oe.set(0,0,Math.sin(w),Math.cos(w)))}let h=c.overrideGlobalBlend?c.blendRange:r;h=h/this.bboxSize*2,t[s*4]=(oE.x-this.bboxOffset)/this.bboxSize*2,t[s*4+1]=(oE.y-this.bboxOffset)/this.bboxSize*2,t[s*4+2]=(oE.z-this.bboxOffset)/this.bboxSize*2,t[s*4+3]=c.operation===0?1:c.operation===2?-1:-2,t[ca*4+s*4]=-ny.x,t[ca*4+s*4+1]=-ny.y,t[ca*4+s*4+2]=-ny.z,t[ca*4+s*4+3]=ny.w;let d=new Float32Array(4),p=0;if(u.type==="SphereGeometry")u.width===u.height&&u.width===u.depth?d[0]=0:d[0]=1,d[1]=u.width/this.bboxSize,d[2]=u.height/this.bboxSize,d[3]=u.depth/this.bboxSize,i=Math.max(i,d[1]*Gf.x+h,d[2]*Gf.x+h,d[3]*Gf.x+h);else if(u.type==="CubeGeometry"){p=u.cornerRadius;let w=u.width,S=u.height,_=u.depth;d[0]=2,d[1]=(w-2*p)/this.bboxSize,d[2]=(S-2*p)/this.bboxSize,d[3]=(_-2*p)/this.bboxSize,i=Math.max(i,Math.sqrt(w**2+S**2+_**2)/this.bboxSize*Gf.x+h)}else if(u.type==="CylinderGeometry"){p=u.cornerRadius;let w=u.height,S=u.radiusBottom,_=u.radiusTop;if(_>=S){let A=Math.atan2(_-S,w),C=(Math.PI/2-A)/2;_-=p/Math.tan(C),S-=p*Math.tan(C)}else if(S>_){let A=Math.atan2(S-_,w),C=(Math.PI/2-A)/2;_-=p*Math.tan(C),S-=p/Math.tan(C)}d[1]=(u.height-2*p)/this.bboxSize,S===_?(d[0]=3,d[2]=S/this.bboxSize*2):(d[0]=4,d[2]=S/this.bboxSize*2,d[3]=_/this.bboxSize*2),i=Math.max(i,d[1]*4*Gf.x+h)}else if(u.type==="TorusGeometry"){if(d[0]=5,d[1]=(u.width-u.depth)/this.bboxSize,d[2]=u.depth/this.bboxSize,u.arc!==360){d[0]=6,d[3]=d[1],t[ca*12+s*4+3]=d[2];let w=2*Math.atan2(d[2]/2,d[1]),S=u.arc*Math.PI/180/2-w;d[1]=Math.sin(S),d[2]=Math.cos(S)}i=Math.max(i,u.width*Gf.x/this.bboxSize+h)}t.set(d,ca*8+s*4),t[ca*12+s*4]=h,t[ca*12+s*4+1]=p/this.bboxSize*2,t[ca*12+s*4+2]=Gf.x;let m=o.material,v=m.uniforms.nodeU0.node.value,g=m.uniforms.nodeU1.value;c.operation!==0&&!c.useColor&&(g=-1),t[ca*16+s*4]=v.r,t[ca*16+s*4+1]=v.g,t[ca*16+s*4+2]=v.b,t[ca*16+s*4+3]=g,g<1&&this.material.defines.SHAPEBLEND_C===1&&(this.material.transparent=!0),s++}),this.npart=s,this.spatialPassUniforms.span.value=i*1.4}var gK=512;function zH(e,t){let i=!1,r=e.layers.mask&gK,n=t.getLayersOfType("transmission"),s=t.getLayersOfType("outline");return s.length>0&&(e.layers.set(8),n.length>0&&e.layers.enable(3),i=!0,xB(e),yB(e)),n.length===0&&s.length===0&&e.layers.set(0),r&&e.layers.set(9),e instanceof Op&&e.needsAO&&e.layers.enable(5),i}function kH(e,t){if(!t.layers)return!1;let i=e.layers.mask&gK,r=!1,n=t.getLayersOfType("transmission").filter(a=>a.data.visible),s=t.getLayersOfType("outline").filter(a=>a.data.visible);return n.length>0&&(e.layers.set(3),s.length>0&&e.layers.enable(8),r=!0),n.length===0&&s.length===0&&e.layers.set(0),i&&e.layers.set(9),e.needsAO&&e.layers.enable(5),r}function ize(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof Op)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)zH(i,i.material[r])&&(t=!0);else zH(i,i.material)&&(t=!0)}),t}function rze(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof Op)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)kH(i,i.material[r])&&(t=!0);else kH(i,i.material)&&(t=!0)}),t}var nze=new kq,sze=new yt,aze=new zx;function pO(e,t,i,r=!1){let n=e.cloner;if(n)for(let s of n.children){let a=sze.copy(s.matrixWorld).invert(),o=aze.copy(t.ray).applyMatrix4(a),l=e.matrixWorld;o.applyMatrix4(l);let u=nze;u.set(o.origin,o.direction),u.near=t.near,u.far=t.far;let c=u.intersectObject(e,!1);c.length>0&&i.push({...c[0],object:r?s:e})}}var oze=class{constructor(){this._constraints=new Map}setConstraint(e,t){t===null?this._constraints.delete(e):this._constraints.set(e,t)}removeDependencies(e){this._constraints.delete(e)}applyConstraints(e){let t=new Set;this._constraints.forEach((i,r)=>{let n=[r,i],s=i;for(;this._constraints.has(s);){if(s=this._constraints.get(s),n.includes(s)){console.warn(`circular dependency detected: ${n.join(" -> ")}`);break}t.has(s)||n.push(s)}for(let a=n.length-2;a>=0;a--)if(!t.has(n[a])){let o=e.find(n[a]);o?o.applyPathSnapping(e):console.warn(`missing entity ${n[a]}`),t.add(n[a])}})}findDependency(e,t){let i=e;for(;this._constraints.has(i);)if(i=this._constraints.get(i),i===t)return!0;return!1}},lze="AGFzbQEAAAAADwhkeWxpbmsuMAEEAAAAAAETA2AAAGAIf39/f39/f38AYAABfwISAQNlbnYGbWVtb3J5AgMAgIAEAwQDAAECBzkDEV9fd2FzbV9jYWxsX2N0b3JzAAALc29ydEluZGV4ZXMAARNlbXNjcmlwdGVuX3Rsc19pbml0AAIK3gMDAwABC9IDAwF/BnwBfgJAIAdFDQAgAysDUCEMIAMrAzAhDSADKwMQIQ5BACEDRP///////+9/IQtEAAAAAAAAEAAhCgNAIAIgA0ECdGoCfyAOIAEgA0EMbGoiCCoCALuiIA0gCCoCBLuioCAMIAgqAgi7oqBEAAAAAAAAsECiIgmZRAAAAAAAAOBBYwRAIAmqDAELQYCAgIB4CzYCACAJIAsgCSALYxshCyAJIAogCSAKZBshCiADQQFqIgMgB0cNAAsgB0UNACAGuCAKIAuhoyEJQQAhAwNAAn8gCSACIANBAnRqIgEoAgC3IAuhoiIKmUQAAAAAAADgQWMEQCAKqgwBC0GAgICAeAshCCABIAg2AgAgBCAIQQJ0aiIBIAEoAgBBAWo2AgAgA0EBaiIDIAdHDQALCyAGQQJPBEAgBCgCACEIQQEhAwNAIAQgA0ECdGoiASABKAIAIAhqIgg2AgAgA0EBaiIDIAZHDQALCyAHQQFrIgGtIQ8DQCAEIAIgD6dBAnQiA2ooAgBBAnRqIgcgBygCAEEBayIHNgIAIAUgASAHa0ECdGogACADaigCADYCACAPUCEDIA9CAX0hDyADRQ0ACyAGBEAgBEEAIAZBAnT8CwALCwQAQQAL",gp=class{};Fw(gp,"DepthMapRange",65536),Fw(gp,"MemoryPageSize",65536),Fw(gp,"BytesPerFloat",4),Fw(gp,"BytesPerInt",4);function uze(e){let t,i,r,n,s,a,o,l,u,c,h,d,p,m,v,g;function w(z){let G=new Float64Array(c,a,16);for(let j=0;j<16;j++)G[j]=z[j];let V;if(r>1){t.exports.sortIndexes(n,s,u,a,o,l,d.DepthMapRange,r);let j=new Uint32Array(r);V=j.buffer,j.set(new Uint32Array(c,l,r))}else if(r===1){let j=new Uint32Array(r);j[0]=new Uint32Array(c,n,i)[0],V=j.buffer}else V=new ArrayBuffer(0);e.postMessage({sortDone:!0,indexesBuffer:V},[V])}function S(z,G,V){let j=new Float32Array(c,s,i*3);r=0;let J=new Uint32Array(c,n,i);for(let ne=0;ne<V.length-1;ne++){let K=G[ne],B=z[ne].elements,Z=K.filter(X=>X.enabled&&X.mode==="Include").map(X=>X.type==="Box"?E(X):D(X)),F=K.filter(X=>X.enabled&&X.mode==="Exclude").map(X=>X.type==="Box"?E(X):D(X));for(let X=V[ne];X<V[ne+1];X++){let Y=p[X*3],le=p[X*3+1],oe=p[X*3+2];if((Z.length===0||A(Y,le,oe,Z))&&(F.length===0||!A(Y,le,oe,F))){let re=1/(B[3]*Y+B[7]*le+B[11]*oe+B[15]);j[r*3]=(B[0]*Y+B[4]*le+B[8]*oe+B[12])*re,j[r*3+1]=(B[1]*Y+B[5]*le+B[9]*oe+B[13])*re,j[r*3+2]=(B[2]*Y+B[6]*le+B[10]*oe+B[14])*re,J[r]=X,r++}}}}function _(z,G){let V=[],j=G.filter(K=>K.enabled&&K.mode==="Include").map(K=>K.type==="Box"?E(K):D(K)),J=G.filter(K=>K.enabled&&K.mode==="Exclude").map(K=>K.type==="Box"?E(K):D(K)),ne=z.length;for(let K=0;K<ne;K+=3){let B=z[K],Z=z[K+1],F=z[K+2];(j.length===0||A(B,Z,F,j))&&(J.length===0||!A(B,Z,F,J))||V.push(K/3)}return V}function A(z,G,V,j,J){return j[J==="Intersect"?"every":"some"](ne=>{let K=C(z,G,V,ne.invRotationMatrix,ne.cropCenter);return Array.isArray(ne)?T(K.x,K.y,K.z,ne):L(K.x,K.y,K.z,ne)})}function C(z,G,V,j,J){let ne=z-J[0],K=G-J[1],B=V-J[2],Z=1/(j[3]*ne+j[7]*K+j[11]*B+j[15]);return{x:(j[0]*ne+j[4]*K+j[8]*B+j[12])*Z+J[0],y:(j[1]*ne+j[5]*K+j[9]*B+j[13])*Z+J[1],z:(j[2]*ne+j[6]*K+j[10]*B+j[14])*Z+J[2]}}function E(z){let G=z.cropSize[0]/2,V=z.cropSize[1]/2,j=z.cropSize[2]/2,J=[z.cropCenter[0]-G,z.cropCenter[1]-V,z.cropCenter[2]-j,z.cropCenter[0]+G,z.cropCenter[1]+V,z.cropCenter[2]+j],ne=I(z.cropRotation);return Object.assign(J,{invRotationMatrix:ne,cropCenter:z.cropCenter})}function I(z){let G=[],V=z[0]*Math.PI/180,j=z[1]*Math.PI/180,J=z[2]*Math.PI/180,ne=Math.cos(V),K=Math.sin(V),B=Math.cos(j),Z=Math.sin(j),F=Math.cos(J),X=Math.sin(J),Y=ne*F,le=ne*X,oe=K*F,re=K*X;return G[0]=B*F,G[1]=-B*X,G[2]=Z,G[4]=le+oe*Z,G[5]=Y-re*Z,G[6]=-K*B,G[8]=re-Y*Z,G[9]=oe+le*Z,G[10]=ne*B,G[12]=0,G[13]=0,G[14]=0,G[3]=0,G[7]=0,G[11]=0,G[15]=1,G}function T(z,G,V,j){return z>=j[0]&&z<=j[3]&&G>=j[1]&&G<=j[4]&&V>=j[2]&&V<=j[5]}function D(z){let G=2/z.cropSize[0],V=2/z.cropSize[1],j=2/z.cropSize[2],J=I(z.cropRotation);return{invRadiusX:G,invRadiusY:V,invRadiusZ:j,cropCenter:z.cropCenter,invRotationMatrix:J}}function L(z,G,V,j){let J=(z-j.cropCenter[0])*j.invRadiusX,ne=(G-j.cropCenter[1])*j.invRadiusY,K=(V-j.cropCenter[2])*j.invRadiusZ;return J*J+ne*ne+K*K<=1}e.onmessage=z=>{if(z.data.getCroppedIndexes){let G=new Uint32Array(_(new Float32Array(z.data.positions),z.data.crops)).buffer;e.postMessage({outOfBoundsIndexes:G},[G])}else if(z.data.positions)h=z.data.positions,p=new Float32Array(h),v=z.data.meshMatrixWorlds,g=z.data.cropsArray,m=z.data.meshIndexIntervals,S(v,g,m),e.postMessage({sortSetupComplete:!0});else if(z.data.sort||z.data.newMatrixWorlds||z.data.newCropsArray)(z.data.newMatrixWorlds||z.data.newCropsArray)&&(g=z.data.newCropsArray||g,v=z.data.newMatrixWorlds||v,S(v,g,m)),w(z.data.sort.view,z.data.sort.cameraPosition);else if(z.data.init){d=z.data.init.Constants,i=z.data.init.splatCount;let G=d.BytesPerInt,V=d.BytesPerFloat*3,j=new Uint8Array(z.data.init.sorterWasmBytes),J=G+V,ne=i*J,K=i*d.BytesPerInt*2+d.DepthMapRange*d.BytesPerInt*2,B=d.MemoryPageSize*32,Z=ne+K+B,F=Math.floor(Z/d.MemoryPageSize)+1,X={module:{},env:{memory:new WebAssembly.Memory({initial:F*2,maximum:F*3,shared:!0})}};WebAssembly.compile(j).then(Y=>WebAssembly.instantiate(Y,X)).then(Y=>{t=Y,n=0,s=i*G,a=s+i*V,u=a+16*d.BytesPerFloat*2,o=u+i*d.BytesPerInt,l=o+d.DepthMapRange*d.BytesPerInt,c=X.env.memory.buffer,e.postMessage({sortSetupPhase1Complete:!0})})}}}function cze(e){let t=new Worker(URL.createObjectURL(new Blob(["(",uze.toString(),")(self)"],{type:"application/javascript"}))),i=atob(lze),r=new Uint8Array(i.length);for(let n=0;n<i.length;n++)r[n]=i.charCodeAt(n);return t.postMessage({init:{sorterWasmBytes:r.buffer,splatCount:e,Constants:{BytesPerFloat:gp.BytesPerFloat,BytesPerInt:gp.BytesPerInt,DepthMapRange:gp.DepthMapRange,MemoryPageSize:gp.MemoryPageSize}}}),t}var qD=(function(){let e=new Float32Array(1),t=new Int32Array(e.buffer);return function(i){return e[0]=i,t[0]}})(),hze=function(e,t,i,r){return e+(t<<8)+(i<<16)+(r<<24)},lE=new Pe;function BH(e){let t=!1;return e.scene.objects.traverse((i,r)=>{if(r.visible===!1)return!0;r.type==="Splat"&&(t=!0)}),t}var WE=class extends zr{constructor(e,t,i,r,n=!1,s=1,a,o){super(i,r),this.splatCount=t,this.meshIndexIntervals=a,this.meshMatrixWorlds=o,this.splatBuffers=e,this.geometry=i,this.material=r,this.splatDataTextures=null,this.halfPrecisionCovariancesOnGPU=n,this.devicePixelRatio=s,this.resetLocalSplatDataAndTexturesFromSplatBuffer()}static buildMesh(e,t,i=!1,r=1,n,s){let a=WE.buildGeomtery(t),o=WE.buildMaterial(n);return new WE(e,t,a,o,i,r,n,s)}static buildMaterial(e){let t=`
            precision highp float;
            #include <common>

            attribute uint splatIndex;

            uniform highp sampler2D covariancesTexture;
            uniform highp usampler2D centersColorsTexture;
            uniform vec2 focal;
            uniform vec2 viewport;
            uniform vec2 basisViewport;
            uniform vec2 covariancesTextureSize;
            uniform vec2 centersColorsTextureSize;
						uniform highp sampler2D meshMatrixWorldsTexture;
						uniform uint meshIndexIntervals[257];
						uniform float orthoZoom;

            varying vec4 vColor;
            varying vec2 vUv;

            varying vec2 vPosition;

            const vec4 encodeNorm4 = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);
            const uvec4 mask4 = uvec4(uint(0x000000FF), uint(0x0000FF00), uint(0x00FF0000), uint(0xFF000000));
            const uvec4 shift4 = uvec4(0, 8, 16, 24);
            vec4 uintToRGBAVec (uint u) {
               uvec4 urgba = mask4 & u;
               urgba = urgba >> shift4;
               vec4 rgba = vec4(urgba) * encodeNorm4;
               return rgba;
            }

            vec2 getDataUV(in int stride, in int offset, in vec2 dimensions) {
                vec2 samplerUV = vec2(0.0, 0.0);
                float d = float(splatIndex * uint(stride) + uint(offset)) / dimensions.x;
                samplerUV.y = float(floor(d)) / dimensions.y;
                samplerUV.x = fract(d);
                return samplerUV;
            }

            void main () {
                uvec4 sampledCenterColor = texture(centersColorsTexture, getDataUV(1, 0, centersColorsTextureSize));
                vec3 splatCenter = uintBitsToFloat(uvec3(sampledCenterColor.gba));
                vColor = uintToRGBAVec(sampledCenterColor.r);

                vPosition = position.xy * 2.0;

								uint meshIndex;
								for (int i = 1; i < 257; i++) {
									if (splatIndex < meshIndexIntervals[i]) {
										meshIndex = uint(i - 1);
										break;
									}
								}

								float strideMulmeshIndex = float(4u*meshIndex);
								float meshMatrixWorldsTextureLength = float(256*4);

								mat4 modelMat = mat4(
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+0.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+1.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+2.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+3.0)/meshMatrixWorldsTextureLength, 0))
								);
								mat4 modelViewMat = viewMatrix * modelMat;
								vec4 viewCenter = modelViewMat * vec4(splatCenter, 1.0); 
                vec4 clipCenter = projectionMatrix * viewCenter;

                vec2 sampledCovarianceA = texture(covariancesTexture, getDataUV(3, 0, covariancesTextureSize)).rg;
                vec2 sampledCovarianceB = texture(covariancesTexture, getDataUV(3, 1, covariancesTextureSize)).rg;
                vec2 sampledCovarianceC = texture(covariancesTexture, getDataUV(3, 2, covariancesTextureSize)).rg;

                vec3 cov3D_M11_M12_M13 = vec3(sampledCovarianceA.rg, sampledCovarianceB.r);
                vec3 cov3D_M22_M23_M33 = vec3(sampledCovarianceB.g, sampledCovarianceC.rg);

                // Compute the 2D covariance matrix from the upper-right portion of the 3D covariance matrix
                mat3 Vrk = mat3(
                    cov3D_M11_M12_M13.x, cov3D_M11_M12_M13.y, cov3D_M11_M12_M13.z,
                    cov3D_M11_M12_M13.y, cov3D_M22_M23_M33.x, cov3D_M22_M23_M33.y,
                    cov3D_M11_M12_M13.z, cov3D_M22_M23_M33.y, cov3D_M22_M23_M33.z
                );
                float s = 1.0 / (viewCenter.z * viewCenter.z);

                mat3 W = transpose(mat3(modelViewMat));
                mat3 T = orthoZoom > 0.0 ? W : W * mat3(
									focal.x / viewCenter.z, 0., -(focal.x * viewCenter.x) * s,
									0., focal.y / viewCenter.z, -(focal.y * viewCenter.y) * s,
									0., 0., 0.
								);
                mat3 cov2Dm = transpose(T) * Vrk * T;
                cov2Dm[0][0] += 0.3;
                cov2Dm[1][1] += 0.3;

                // We are interested in the upper-left 2x2 portion of the projected 3D covariance matrix because
                // we only care about the X and Y values. We want the X-diagonal, cov2Dm[0][0],
                // the Y-diagonal, cov2Dm[1][1], and the correlation between the two cov2Dm[0][1]. We don't
                // need cov2Dm[1][0] because it is a symetric matrix.
                vec3 cov2Dv = vec3(cov2Dm[0][0], cov2Dm[0][1], cov2Dm[1][1]);

                vec3 ndcCenter = clipCenter.xyz / clipCenter.w;

                // We now need to solve for the eigen-values and eigen vectors of the 2D covariance matrix
                // so that we can determine the 2D basis for the splat. This is done using the method described
                // here: https://people.math.harvard.edu/~knill/teaching/math21b2004/exhibits/2dmatrices/index.html
                //
                // This is a different approach than in the original work at INRIA. In that work they compute the
                // max extents of the 2D covariance matrix in screen space to form an axis aligned bounding rectangle
                // which forms the geometry that is actually rasterized. They then use the inverse 2D covariance
                // matrix (called 'conic') to determine fragment opacity.
                float a = cov2Dv.x;
                float d = cov2Dv.z;
                float b = cov2Dv.y;
                float D = a * d - b * b;
                float trace = a + d;
                float traceOver2 = 0.5 * trace;
                float term2 = sqrt(trace * trace / 4.0 - D);
                float eigenValue1 = traceOver2 + term2;
								float eigenValue2 = max(traceOver2 - term2, 0.00); // prevent negative eigen value

                const float maxSplatSize = 1024.0;
                vec2 eigenVector1 = normalize(vec2(b, eigenValue1 - a));
                // since the eigen vectors are orthogonal, we derive the second one from the first
                vec2 eigenVector2 = vec2(eigenVector1.y, -eigenVector1.x);
                vec2 basisVector1 = eigenVector1 * min(sqrt(2.0 * eigenValue1), maxSplatSize);
                vec2 basisVector2 = eigenVector2 * min(sqrt(2.0 * eigenValue2), maxSplatSize);

                vec2 ndcOffset = vec2(vPosition.x * basisVector1 + vPosition.y * basisVector2) * basisViewport;

								if (orthoZoom > 0.0) {
									ndcOffset *= orthoZoom;
								}

                gl_Position = vec4(ndcCenter.xy + ndcOffset, ndcCenter.z, 1.0);
            }`,i=`
            precision highp float;
            #include <common>

            uniform vec3 debugColor;

            varying vec4 vColor;
            varying vec2 vUv;

            varying vec2 vPosition;
						layout(location = 1) out vec4 gVelocity; 

            void main () {
                // compute the negative squared distance from the center of the splat to the
                // current fragment in the splat's local space.
                float A = -dot(vPosition, vPosition);
                if (A < -4.0) discard;
                vec3 color = vColor.rgb;
                A = exp(A) * vColor.a;
                gl_FragColor = vec4(color.rgb, A);
								gVelocity = vec4(0.0); // so it is ignored by TAA
            }`,r={covariancesTexture:{type:"t",value:null},centersColorsTexture:{type:"t",value:null},meshIndexIntervals:{value:e},meshMatrixWorldsTexture:{type:"t",value:null},focal:{type:"v2",value:new Pe},viewport:{type:"v2",value:new Pe},basisViewport:{type:"v2",value:new Pe},debugColor:{type:"v3",value:new li},covariancesTextureSize:{type:"v2",value:new Pe(1024,1024)},centersColorsTextureSize:{type:"v2",value:new Pe(1024,1024)},orthoZoom:{type:"f",value:-1}};return new Zi({uniforms:r,vertexShader:t,fragmentShader:i,transparent:!0,alphaTest:1,blending:Pg,depthTest:!0,depthWrite:!1,side:Ba})}static buildGeomtery(e){let t=new Kt;t.setIndex([0,1,2,0,2,3]);let i=new Float32Array(12),r=new hi(i,3);t.setAttribute("position",r),r.setXYZ(0,-1,-1,0),r.setXYZ(1,-1,1,0),r.setXYZ(2,1,1,0),r.setXYZ(3,1,-1,0),r.needsUpdate=!0;let n=new Oq().copy(t),s=new Uint32Array(e),a=new Wb(s,1,!1);return a.setUsage(ude),n.setAttribute("splatIndex",a),n.instanceCount=e,n}resetLocalSplatDataAndTexturesFromSplatBuffer(){this.updateLocalSplatDataFromSplatBuffer(),this.allocateAndStoreLocalSplatDataInTextures()}updateLocalSplatDataFromSplatBuffer(){this.splatBuffers.forEach(r=>r.buildPreComputedBuffers()),this.covariances=new Float32Array(this.splatCount*6),this.colors=new Uint8Array(this.splatCount*4),this.centers=new Float32Array(this.splatCount*3);let e=0,t=0,i=0;for(let r of this.splatBuffers){let n=r.nsplats;this.colors.subarray(e,e+n*4).set(r.colorsA),e+=n*4,this.centers.subarray(t,t+n*3).set(r.decoded.xyz.denormDequant().data),t+=n*3,this.covariances.subarray(i,i+n*6).set(new Float32Array(r.precomputedCovarianceBufferData)),i+=n*6}}allocateAndStoreLocalSplatDataInTextures(){let e=this.splatCount,t=new Pe(4096,1024);for(;t.x*t.y*2<e*6;)t.y*=2;let i=new Pe(4096,1024);for(;i.x*i.y*4<e*4;)i.y*=2;let r,n;if(this.halfPrecisionCovariancesOnGPU){n=new Uint16Array(t.x*t.y*2);for(let c=0;c<this.covariances.length;c++)n[c]=U0e.toHalfFloat(this.covariances[c]);r=new oo(n,t.x,t.y,n2,Pd)}else n=new Float32Array(t.x*t.y*2),n.set(this.covariances),r=new oo(n,t.x,t.y,n2,br);r.needsUpdate=!0,this.material.uniforms.covariancesTexture.value=r,this.material.uniforms.covariancesTextureSize.value.copy(t);let s=new Uint32Array(i.x*i.y*4);for(let c=0;c<e;c++){let h=c*4,d=c*3,p=c*4;s[p]=hze(this.colors[h],this.colors[h+1],this.colors[h+2],this.colors[h+3]),s[p+1]=qD(this.centers[d]),s[p+2]=qD(this.centers[d+1]),s[p+3]=qD(this.centers[d+2])}let a=new oo(s,i.x,i.y,K7,gd);a.internalFormat="RGBA32UI",a.needsUpdate=!0,this.material.uniforms.centersColorsTexture.value=a,this.material.uniforms.centersColorsTextureSize.value.copy(i);let o=256*4,l=new Float32Array(256*16);for(let c=0;c<this.meshMatrixWorlds.length;c++)l.set(this.meshMatrixWorlds[c].elements,c*16);let u=new oo(l,o,1,$r,br);u.needsUpdate=!0,this.material.uniforms.meshMatrixWorldsTexture.value=u,this.material.uniformsNeedUpdate=!0,this.splatDataTextures={covariances:{data:n,texture:r,size:t},centerColors:{data:s,texture:a,size:i},meshMatrixWorlds:{data:l,texture:u}}}updateIndexes(e){let t=this.geometry;t.attributes.splatIndex.set(e),t.attributes.splatIndex.needsUpdate=!0,t.instanceCount=e.length}updateUniforms(e,t,i,r){this.splatCount>0&&(lE.set(e.x*this.devicePixelRatio,e.y*this.devicePixelRatio),this.material.uniforms.viewport.value.copy(lE),this.material.uniforms.basisViewport.value.set(2/lE.x,2/lE.y),this.material.uniforms.focal.value.set(t,i),this.material.uniforms.orthoZoom.value=r,this.material.uniformsNeedUpdate=!0)}getSplatDataTextures(){return this.splatDataTextures}getSplatCount(){return this.splatCount}getCenters(){return this.centers}getColors(){return this.colors}getCovariances(){return this.covariances}dispose(){this.geometry.dispose(),this.material.dispose(),this.splatDataTextures&&(this.splatDataTextures.covariances.texture.dispose(),this.splatDataTextures.centerColors.texture.dispose(),this.splatDataTextures.meshMatrixWorlds.texture.dispose()),this.removeFromParent()}},vK,dze=new Promise(e=>{vK=e}),NH=!1,uE;function fze(){if(NH)return;if(uE)return uE;async function e(){let t=await Vd(()=>import("./gaussian-splat-compression-CH16aANn.js"),[]);vK(t),NH=!0}return uE=e(),uE}var yK;dze.then(e=>yK=e);var pze=class{constructor(e={}){Fw(this,"updateView",(function(){let t=new yt,i=[],r=new H(0,0,-1),n=new H(0,0,-1),s=new H,a=new H;return function(o=!1,l){let u=this.updateMatrixWorldsInWorkerIfNeeded(),c=this.cropsChanged();if(!o){n.set(0,0,-1).applyQuaternion(l.quaternion);let d=!1,p=!1;if(n.dot(r)<=.95&&(d=!0),a.copy(l.position).sub(s).length()>=1&&(p=!0),!d&&!p&&!u&&!c&&!this.needsInitialRender)return}this.needsInitialRender=!1,s.copy(l.position),r.copy(n),t.copy(l.matrixWorld).invert(),t.premultiply(this.dummyPerspectiveMatrix),i[0]=l.position.x,i[1]=l.position.y,i[2]=l.position.z;let h={sort:{view:t.elements,cameraPosition:i,splatRenderCount:this.splatRenderCount,splatSortCount:this.splatRenderCount},...u?{newMatrixWorlds:this.meshMatrixWorlds}:{},...c?{newCropsArray:this.cropsArray}:{}};this.sortRunning?this.queuedMessage=h:(this.queuedMessage=null,this.sortRunning=!0,this.sortWorker.postMessage(h))}})()),this.scene=e.scene,this.currentPage=null,this.devicePixelRatio=window.devicePixelRatio,this.sortWorker=null,this.splatRenderCount=0,this.splatSortCount=0,this.splatMesh=null,this.sortRunning=!1,this.meshMatrixWorlds=null,this.meshMatrixWorldsOld=null,this.cropsArray=null,this.splatEntries=null,this.queuedMessage=null,this.needsInitialRender=!0,this.dummyPerspectiveMatrix=new yt().makePerspective(-1,1,-1,1,.1,1e3)}updateSplatMeshUniforms(e,t){let i=new Pe;this.splatMesh!==null&&this.splatMesh.getSplatCount()>0&&(e.getSize(i),this.cameraFocalLengthX=t.projectionMatrix.elements[0]*this.devicePixelRatio*i.x*.45,this.cameraFocalLengthY=t.projectionMatrix.elements[5]*this.devicePixelRatio*i.y*.45,this.splatMesh.updateUniforms(i,this.cameraFocalLengthX,this.cameraFocalLengthY,t.isPerspectiveCamera?-1:t.zoom*this.devicePixelRatio))}loadSplat(e={}){this.activePage=this.scene.activePage,e.position&&(e.position=new H().fromArray(e.position)),e.orientation&&(e.orientation=new xi().fromArray(e.orientation)),e.halfPrecisionCovariances=!!e.halfPrecisionCovariances;let t=[];if(this.splatEntries=t,this.activePage.traverseVisibleEntity(s=>{s.data.type==="Splat"&&t.push(s)}),this.splatMesh&&this.splatMesh.dispose(),t.length===0)return this.splatMesh=null,!1;this.meshMatrixWorlds=t.map(s=>s.matrixWorld),this.meshMatrixWorldsOld=t.map(s=>s.matrixWorld.clone()),this.cropsArray=t.map(s=>s.data.crops.map(a=>a.data));let i=t.map(s=>new yK.GSplineBuffer(new Uint8Array(s.data.buffer).buffer)),r=0,n=[0];for(let s of i)r+=s.getSplatCount(),n.push(r);return this.setupSplatMesh(i,r,e.position,e.orientation,e.halfPrecisionCovariances,this.devicePixelRatio,n,this.meshMatrixWorlds),this.setupSortWorker(r),!0}updateMatrixWorldsInWorkerIfNeeded(){let e=this.splatDataTextures.meshMatrixWorlds.data;for(let t=0;t<this.meshMatrixWorlds.length;t++)e.set(this.meshMatrixWorlds[t].elements,t*16);return this.splatDataTextures.meshMatrixWorlds.texture.needsUpdate=!0,this.meshMatrixWorlds.every((t,i)=>t.equals(this.meshMatrixWorldsOld[i]))?!1:(this.meshMatrixWorldsOld=this.meshMatrixWorlds.map(t=>t.clone()),!0)}cropsChanged(){let e=!1;return this.splatEntries.forEach((t,i)=>{t.data.crops.forEach((r,n)=>{this.cropsArray[i][n]===void 0?(e=!0,this.cropsArray[i][n]=r.data):Object.entries(r.data).forEach(([s,a])=>{Array.isArray(a)&&a.some((o,l)=>o!==this.cropsArray[i][n][s][l])?(e=!0,this.cropsArray[i][n][s]=a):a!==this.cropsArray[i][n]?.[s]&&(e=!0,this.cropsArray[i][n][s]=a)})}),t.data.crops.length!==this.cropsArray[i]?.length&&(this.cropsArray[i].length=t.data.crops.length,e=!0)}),e}setupSplatMesh(e,t,i=new H,r=new xi,n=!1,s=1,a,o){this.splatMesh=WE.buildMesh(e,t,n,s,a,o),this.splatMesh.position.copy(i),this.splatMesh.quaternion.copy(r),this.splatMesh.frustumCulled=!1,this.splatMesh.renderOrder=99999,this.splatRenderCount=t,this.splatMesh.onBeforeRender=(l,u,c)=>this.update(l,c)}setupSortWorker(e){this.sortWorker=cze(e),this.sortWorker.onmessage=t=>{t.data.sortDone?(this.sortRunning=!1,this.splatMesh?.updateIndexes(new Uint32Array(t.data.indexesBuffer)),this.lastSortTime=t.data.sortTime,this.queuedMessage&&(this.sortWorker.postMessage(this.queuedMessage),this.queuedMessage=null)):t.data.sortCanceled?this.sortRunning=!1:t.data.sortSetupPhase1Complete?this.sortWorker.postMessage({positions:this.splatMesh.getCenters().buffer,meshMatrixWorlds:this.splatMesh.meshMatrixWorlds,meshIndexIntervals:this.splatMesh.meshIndexIntervals,cropsArray:this.cropsArray}):t.data.sortSetupComplete&&(this.splatDataTextures=this.splatMesh.getSplatDataTextures(),this.scene.activePage.add(this.splatMesh),this.needsInitialRender=!0)}}update(e,t){this.splatMesh!==null&&(this.updateSplatMeshUniforms(e,t),this.updateView(!1,t))}getSplatMesh(){return this.splatMesh}},mO=new Dd;mO.wireframe=!0;var FH=new H,RB=class extends Ho{constructor(e,t){super(),this.data=e,this.sharedAssets=t,this.enableHelpers=!1,this.wireframeState=!1,this.needsTransmissionDirty=!0,this.needsNormalDirty=!0,this._needsTransmission=!1,this._needsNormal=!1,this.geometryCacheChanged=!1,this.splatViewer=null,this.shapeBlendIntances=[],this.entityByUuid={},this.entityIdentityToEntity={},this.toExpandCloner=new Set,this.toUpdateCloner=new Set,this.pendingCommands=[],this.pathConstraints=new oze,this.invisibleObjects=new Zy("jflkdsafjasdifjaslk",{...xL.defaultData,visible:!1,name:"buildin invisible"}),this.needsRecomputeInstances=!1,this.init(e,t),this.matrixAutoUpdate=!1,this.errorPage=new Ns("fdasfa",{...gx.defaultData,name:""},{shared:t,scene:this})}markGeometryCacheDirty(){this.geometryCacheChanged=!0}markNeedsUpdateRendererDirty(){this.needsTransmissionDirty=!0,this.needsNormalDirty=!0}needsTransmission(){return this.needsTransmissionDirty&&(this._needsTransmission=rze(this),this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){return this.needsNormalDirty&&(this._needsNormal=ize(this),this.needsNormalDirty=!1),this._needsNormal}registerInstanceAndSetUuid(e){let t=e.identity.join("-"),i=this.entityIdentityToEntity[t];i&&(e.uuid=i.uuid),this.entityIdentityToEntity[t]=e,this.entityByUuid[e.uuid]=e}markPenumbraSizeDirty(){for(let e of this.children)e instanceof Ns&&(e.penumbraSizeArrayCache=null)}findInstance(e){return this.entityIdentityToEntity[e.join("-")]}get bgColor(){return this.activePage.bgColor}get postprocessing(){return this.activePage.data.postprocessing}getWithSortKey(e){let t=this.find(e);if(t===void 0)return;let i=[],r=t;for(;r!==this;){let n=r;r=r.parent;let s=r.children.indexOf(n);i.splice(0,0,s)}return{entity:t,sortKey:i}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push(r)}return t.sort((i,r)=>IX(i.sortKey,r.sortKey)),t.map(i=>i.entity)}nonExistOrDescendantOf(e,t){let i=this.find(e);if(i===void 0)return!0;for(;i;){if(i.uuid===t)return!0;i=i.parent}return!1}find(e){if(this.activePage&&this.activePage.personalCamera.parent){if(e==="f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera")return this.activePage.personalCamera;if(e===Xx)return this.activePage.personalCamera}if(e===""||e===void 0)return;let t=this.entityByUuid[e];return t===void 0?this.getObjectByProperty("uuid",e):t}find2D(e){for(let t of this.children)if(t instanceof Ns&&t.uiScene){let i=t.uiScene.find(e);if(i)return i}}findScene2DfromObject2D(e){for(let t of this.children)if(t instanceof Ns&&t.uiScene&&t.uiScene.find(e))return t.uiScene}find2DInUIObjects(e){let t;return this.traverseEntity(i=>{t===void 0&&i instanceof ka&&(t=i.uiCanvas.find(e))}),t}traverse2D(e){for(let t of this.children)t instanceof Ns&&t.uiScene&&t.uiScene.traverse(e)}debugEnsureEntity(e){let t=this.find(e);if(t){if(Array.isArray(t.identity)&&this.findInstance(t.identity)===void 0){console.error("not found instance");debugger}}else{console.error("not found");debugger}}addPendingExpandCloner(e){this.toExpandCloner.add(e)}addPendingUpdateCloner(e){this.toUpdateCloner.add(e)}markToExpandCloner(e){this.toExpandCloner.add(e),e.traverseEntityAncestors(t=>{this.toExpandCloner.add(t)})}doPendingExpandCloner(e){this.toExpandCloner.forEach(t=>{t.expandCloner(e)}),this.toExpandCloner.clear()}doPendingUpdateCloner(e){this.toUpdateCloner.forEach(t=>{t.cloner?.update(e)}),this.toUpdateCloner.clear()}doPendingUpdates(e){this.doPendingExpandCloner(e),this.doPendingUpdateCloner(e),this.applyPendingCommands()}addPendingCommand(e){this.pendingCommands.push(e)}applyPendingCommands(){this.pendingCommands.forEach(e=>e()),this.pendingCommands.length=0}updateByLibOp(e,t){e.path.length===1&&e.path[0]==="components"&&e.type===1&&this.createChildrenObjects([{...e.data.asset,id:e.id}],this.invisibleObjects,t)}updateTreeByOp(e,t){if(e.path.length===0&&e.type===7){let i=e.parent===null?this:this.find(e.parent);if(i===void 0)throw new Error("unexpected");let r=this.createObject(e.id,e.data,e.children,i,e.localIndex,t);r.updateVisible(this),r.resetBBoxNeedsUpdate(),Bc(r)&&wd(r.parent)&&(r.invalidateUpstreamBooleanData(),r.parent.invalidateDownstreamBooleanData().recomputeBoolean()),this.markNeedsRecomputeInstancesForAncessors(i),this.markNeedsRecomputeInstancesForChildren(r),this.markToExpandCloner(r),this.markPenumbraSizeDirty(),r.updatePathSnapping()}else if(e.path.length===0&&e.type===8){let i=this.find(e.id);if(i===void 0)throw new Error("unexpected");i.traverseEntity(n=>{n instanceof Zg&&(this.shapeBlendIntances=this.shapeBlendIntances.filter(s=>s!==n))}),this.markToExpandCloner(i),i.resetBBoxNeedsUpdate(),this.unregisterObject(i);let r=i.parent;this.markNeedsRecomputeInstancesForAncessors(r),this.markNeedsRecomputeInstancesForChildren(i),this.markPenumbraSizeDirty(),i.parent.remove(i),wd(i.parent)&&(i.parent.invalidateUpstreamBooleanData(),i.parent.invalidateDownstreamBooleanData().recomputeBoolean()),Bc(i)&&(i.freeBooleanPointer(),r instanceof Kg&&r.invalidateDownstreamBooleanData().recomputeBoolean()),i instanceof gT&&i.detachShape(),this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(i),this.pathConstraints.removeDependencies(i.uuid),i.updatePathSnapping()}else if(e.path.length===0&&e.type===9){let i=this.find(e.id);if(i===void 0)throw new Error("unexpected");this.markNeedsRecomputeInstancesForChildren(i);let r=i.parent;this.markNeedsRecomputeInstancesForAncessors(r),i.cloner?.resetOnMove(),this.markToExpandCloner(i);let n=e.parent===null?this:this.find(e.parent);if(n===void 0)throw new Error("unexpected");n.add(i),this.markNeedsRecomputeInstancesForAncessors(n),this.markToExpandCloner(i),i.invalidateClonerTransform(i),i.updateVisible(this),i.resetBBoxNeedsUpdate(),this.markPenumbraSizeDirty();let s=e.localIndex;n.children.splice(s,0,n.children.pop()),Bc(i)&&(i.invalidateUpstreamBooleanData(),wd(i.parent)?i.parent.invalidateDownstreamBooleanData().recomputeBoolean():r instanceof Kg&&r.invalidateDownstreamBooleanData().recomputeBoolean()),i.updatePathSnapping()}this.markNeedsUpdateRendererDirty(),this.markGeometryCacheDirty()}get playPage(){return this.find(this.data.publish.playPage)??this.errorPage}updatePage(e){this.activePage&&this.activePage.onDeactive(),this.activePage=this.errorPage;for(let t of this.children)t instanceof Ns&&(t.visible=t.uuid===e,t.visible&&(this.activePage=t,this.activePage.onActive(this)));this.activePage!==this.splatViewer?.activePage&&this.reloadSplats()}updateEntityByOp(e,t,i,r){if(t.type===0){if(("overrides"in t.props||"component"in t.props)&&this.markNeedsRecomputeInstances(),"visible"in t.props&&this.markPenumbraSizeDirty(),t.path.includes("overrides")&&"states"in t.props){let{rest:s}=t.props;t={...t,props:s},this.markNeedsRecomputeInstances()}t.path[0]==="pathSnapping"&&t.props.pathId!==void 0&&this.pathConstraints.setConstraint(e,t.props.pathId)}let n=this.find(e);if(n)try{YOe(n,t,i,{scene:this,shared:r}),n instanceof kn&&n.updateGeometryGroupsIfNeeded()}catch(s){console.error(s)}}updateEntity2DByOp(e,t,i,r,n,s=[]){e.updateEntityByOp(t,i,r,n),this.traverseEntity(a=>{(a instanceof ka||a instanceof Ns)&&(s.includes(a.frameId??"")||a.frameId===t)&&a.updateEntity2DByOp(t,i,r,n)})}get activeCamera(){return this.activePage.activeCamera}switchActiveCamera(e){this.activePage.switchActiveCamera(e)}isInvisibleObjects(e){return e===this.invisibleObjects||e.hasAnccestor(this.invisibleObjects)}init(e,t){let i=Object.entries(t.data.lib.components).map((r,n)=>({data:r[1].asset.data,children:r[1].asset.children,id:r[0],fi:n}));this.invisibleObjects.updateState(this.invisibleObjects.data,{scene:this,shared:t}),this.add(this.invisibleObjects),this.createChildrenObjects(i,this.invisibleObjects,t),this.createChildrenObjects(e.objects,this,t),this.updatePage(e.publish.playPage),this.activePage.switchToPlayCamera(),this.expandInstances(t,!0),this.traverseEntity(r=>{r instanceof Ms&&r.updateUp()}),this.doPendingExpandCloner({scene:this,shared:t}),this.applyPendingCommands()}markNeedsRecomputeInstances(){this.needsRecomputeInstances=!0}markNeedsRecomputeInstancesForChildren(e){e.traverseEntity(t=>{(t.data.type==="Component"||t.data.type==="Instance")&&this.markNeedsRecomputeInstances()})}markNeedsRecomputeInstancesForAncessors(e){Xi.is(e)&&(e.data.type==="Component"&&this.markNeedsRecomputeInstances(),e.traverseAncestors(t=>{Xi.is(t)&&t.data.type==="Component"&&this.markNeedsRecomputeInstances()}))}relativeizeInner(e,t,i,r,n,s,a){if(e){let o=r.find(e);o&&o!==r&&n.forInstancesRec(l=>{l.data=e_(l.data,u=>{let c=u.events.data(a.id),h=l.goUp(s);if(h){let d=[...RX(h.identity),e].join("-"),p=this.entityIdentityToEntity[d];if(p){let m=p.uuid,v=bs.zoom(c,t);v[i]=m}else console.warn("cannot find instance")}}).data})}}rewriteActions(e,t,i,r,n,s){e.forEach(a=>{a.data.type==="Transition"?this.relativeizeInner(a.data.object,[...t,a.id],"object",i,r,n,s):a.data.type==="Animation"?this.relativeizeInner(a.data.object,[...t,a.id],"object",i,r,n,s):a.data.type==="Conditional"&&(this.rewriteActions(a.data.ifActions,[...t,a.id,"ifActions"],i,r,n,s),this.rewriteActions(a.data.elseActions,[...t,a.id,"elseActions"],i,r,n,s))})}rewriteEventsBeforeGoToPlayMode(){this.traverseEntity(e=>{if(e instanceof Jy&&typeof e.identity=="string"&&e.data.type==="Component")return e.traverseEntity((t,i)=>{t.data.events.forEach(r=>{if(r.data.type==="GameControl"){let n=!1;if(t.forInstancesRec(s=>{s.data=e_(s.data,a=>{s.isInstanceRoot||(a.events.delete(r.id),n=!0)}).data}),n===!1)for(let s of j2.list)this.rewriteActions(r.data.gameActions[s],["gameActions",s],e,t,i,r)}else r.data.type==="Conditional"?(r.data.condition.type==="Distance"?(this.relativeizeInner(r.data.condition.fromObject,["condition"],"fromObject",e,t,i,r),this.relativeizeInner(r.data.condition.toObject,["condition"],"toObject",e,t,i,r)):r.data.condition.type==="State"?this.relativeizeInner(r.data.condition.object,["condition"],"object",e,t,i,r):r.data.condition.type==="Comparison"&&(r.data.condition.lOperand.type==="Property"&&this.relativeizeInner(r.data.condition.lOperand.value[0],["condition","lOperand","value"],0,e,t,i,r),r.data.condition.rOperand.type==="Property"&&this.relativeizeInner(r.data.condition.rOperand.value[0],["condition","rOperand","value"],0,e,t,i,r)),this.rewriteActions(r.data.inActions,["inActions"],e,t,i,r),this.rewriteActions(r.data.outActions,["outActions"],e,t,i,r)):"actions"in r.data&&this.rewriteActions(r.data.actions,["actions"],e,t,i,r)})}),!0})}expandInstances(e,t,i){let r=new Set;this.traverseEntity(n=>{if(n instanceof Jy&&n.isInstanceRoot)return n.expandInstanceChildren({scene:this,shared:e,pendingDeletes:r}),t||n.resetBBoxNeedsUpdate(),i&&n.traverseEntity(s=>{i.addClip(s)}),!0});for(let n of r)this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(n),PB(n)}recomputeInstances(e,t){this.needsRecomputeInstances&&(this.needsRecomputeInstances=!1,this.traverseEntity(i=>{i instanceof Jy&&i.isInstanceRoot&&(i.component=void 0)}),this.expandInstances(e,!1,t))}disposeAndUnregisterEntityRecursivelyIfNotReregistered(e){e.traverseEntity(t=>{let i=typeof t.identity=="string"?t.identity:t.identity.join("-");this.entityIdentityToEntity[i]===t&&(delete this.entityByUuid[t.uuid],delete this.entityIdentityToEntity[i]),t.dispose()})}clearScene(){for(let e of this.children)Xi.is(e)&&e.disposeRecursively();this.children.length=0}resetAfterClear(e,t){this.init(e,t)}raycast(e){return this.raycast1(e,!1)}raycast1(e,t){let i=[],r=n=>{for(let s of n.children){let a=s.cloner;if(Xi.is(s)&&!s.raycastLock&&(s.visible||a?.object.data.visible))if(t===!0&&s.isInstanceRoot){let o=[];if(e.intersectObject(s,!0,o),o.length){let l=o[0];l.object=s,l.point.applyMatrix4(l.object.matrixWorld);let u=s.matrixWorld.clone().invert();l.point.applyMatrix4(u),i.push(l)}}else(Bc(s)||rO(s)&&this.enableHelpers&&s.objectHelper.visible)&&(e.intersectObject(s,!1,i),pO(s,e,i)),r(s)}};return r(this.activePage),i}raycastWithClones(e){let t=[],i=r=>{for(let n of r.children){let s=n.cloner;Xi.is(n)&&(n.visible||s?.object.data.visible)&&((Bc(n)||rO(n)&&this.enableHelpers&&n.objectHelper.visible)&&(e.intersectObject(n,!1,t),pO(n,e,t,!0)),i(n))}};return i(this),t}forEachEntity(e){for(let t of this.children)Xi.is(t)&&e(t)}traverseConcreteEntity(e){for(let t of this.children)Xi.is(t)&&t.isConcreteEntity&&t.traverseEntity(e)}traverseEntity(e){for(let t of this.children)Xi.is(t)&&t.traverseEntity(e)}updateFont(e,t){this.traverseEntity(i=>{if(i instanceof kn&&i.data.type==="Mesh"&&(i.data.geometry.type==="TextGeometry"||i.data.geometry.type==="InputGeometry")&&i.data.geometry.font===e){let r=i.geometry,n=i.data.geometry;r.updateFont(e,t).then(()=>{r.update(n,t);let s=i.invalidateDownstreamBooleanData();wd(s)&&s.recomputeBoolean()})}})}traverseObject(e){for(let t of this.children)Yg.is(t)&&t.traverseObject(e)}traverseVisibleEntity(e){for(let t of this.children)Xi.is(t)&&t.visible&&t.traverseVisibleEntity(e)}dispose(){this.clearScene()}createChildrenObjects(e,t,i){let r=0;for(let n of e)this.createObject(n.id,n.data,n.children,t,r,i),r+=1}registerObjectCreatedInLegacy(e){this.entityByUuid[e.uuid]=e}unregisterObject(e){delete this.entityByUuid[e.uuid];for(let t of e.children)this.unregisterObject(t)}createObject(e,t,i,r,n,s){let a={scene:this,shared:s},o=DB(e,t,a);return o instanceof Zg&&this.shapeBlendIntances.push(o),o&&(this.entityByUuid[e]=o,r.add(o),r.children.splice(n,0,r.children.pop()),i.length>0&&(o.isInstanceRoot?console.error("instance should not have children!"):this.createChildrenObjects(i,o,s)),o.updateState(t,a),o instanceof kn&&o.updateGeometryGroupsIfNeeded(),o.updateVisible(this),o.cloner&&this.toExpandCloner.add(o),t.pathSnapping?.pathId&&this.pathConstraints.setConstraint(e,t.pathSnapping.pathId)),t.type==="Empty"&&t.animations&&o.traverseEntity(l=>{let u=l.dataPatched;if(l instanceof kn&&u.bones&&u.boneInverses){let c=u.bones.map(p=>this.find(p)),h=u.boneInverses.map(p=>new yt().fromArray(p)),d=new $z(c,h);l.bind(d,l.bindMatrix)}else l.matrixAutoUpdate=!0}),o}getCenter(e){let t=[];for(let r=0,n=e.length;r<n;++r){let{id:s,recursive:a}=e[r],o=this.find(s),l=a?o.recursiveBBox:o.singleBBox;t.push(...l.vertices)}let i=new Nn;return i.setFromPoints(t),i.getCenter(FH),FH}copyMatrixWorld(e,t){if(e===null){t.identity();return}let i=this.find(e);i?t.copy(i.matrixWorld):t.identity()}copyParentMatrixWorld(e,t){if(e===null){t.identity();return}let i=this.find(e)?.parent;i?t.copy(i.matrixWorld):t.identity()}traverseMaterial(e){this.traverseEntity(t=>{if(t instanceof xa)if(Array.isArray(t.material))for(let i=0;i<t.material.length;i++)t.material[i]instanceof zd&&e(t.material[i]);else t.material instanceof zd&&e(t.material)})}updateViewPlaneSize(e,t,i=!1){this.traverseConcreteEntity(r=>{r instanceof Ms&&r.setViewplaneSize(e,t,i)})}initializeSplatViewer(){this.splatViewer=new pze({scene:this}),this.reloadSplats()}reloadSplats(){this.splatViewer?.loadSplat()}},GE=(e,t)=>{let i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)},mze=(e,t)=>{let i=t.x-e.x,r=t.y-e.y;return vze(Math.atan2(r,i))},gze=(e,t,i)=>{let r={x:0,y:0};return i=gO(i),r.x=e.x-t*Math.cos(i),r.y=e.y-t*Math.sin(i),r},gO=e=>e*(Math.PI/180),vze=e=>e*(180/Math.PI),yze=e=>isNaN(e.buttons)?e.pressure!==0:e.buttons!==0,XD=new Map,UH=e=>{XD.has(e)&&clearTimeout(XD.get(e)),XD.set(e,setTimeout(e,100))},lC=(e,t,i)=>{let r=t.split(/[ ,]+/g),n;for(let s=0;s<r.length;s+=1)n=r[s],e.addEventListener?e.addEventListener(n,i,!1):e.attachEvent&&e.attachEvent(n,i)},VH=(e,t,i)=>{let r=t.split(/[ ,]+/g),n;for(let s=0;s<r.length;s+=1)n=r[s],e.removeEventListener?e.removeEventListener(n,i):e.detachEvent&&e.detachEvent(n,i)},xK=e=>(e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e),jH=()=>{if(typeof window>"u")return;let e=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,t=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:e,y:t}},vO=(e,t)=>{t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},IB=(e,t,i)=>{let r=wK(e);for(let n in r)if(r.hasOwnProperty(n))if(typeof t=="string")r[n]=t+" "+i;else{let s="";for(let a=0,o=t.length;a<o;a+=1)s+=t[a]+" "+i+", ";r[n]=s.slice(0,-2)}return r},xze=(e,t)=>{let i=wK(e);for(let r in i)i.hasOwnProperty(r)&&(i[r]=t);return i},wK=e=>{let t={};return t[e]="",["webkit","Moz","o"].forEach(function(i){t[i+e.charAt(0).toUpperCase()+e.slice(1)]=""}),t},YD=(e,t)=>{for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},wze=(e,t)=>{let i={};for(let r in e)e.hasOwnProperty(r)&&t.hasOwnProperty(r)?i[r]=t[r]:e.hasOwnProperty(r)&&(i[r]=e[r]);return i},yO=(e,t)=>{if(e.length)for(let i=0,r=e.length;i<r;i+=1)t(e[i]);else t(e)},bze=(e,t,i)=>({x:Math.min(Math.max(e.x,t.x-i),t.x+i),y:Math.min(Math.max(e.y,t.y-i),t.y+i)});typeof window<"u"&&(bK="ontouchstart"in window,_K=!!window.PointerEvent,SK=!!window.MSPointerEvent);var bK,_K,SK,Tw={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},Ly,c_={};_K?Ly=Tw.pointer:SK?Ly=Tw.MSPointer:bK?(Ly=Tw.touch,c_=Tw.mouse):Ly=Tw.mouse;function hv(){}hv.prototype.on=function(e,t){var i=this,r=e.split(/[ ,]+/g),n;i._handlers_=i._handlers_||{};for(var s=0;s<r.length;s+=1)n=r[s],i._handlers_[n]=i._handlers_[n]||[],i._handlers_[n].push(t);return i};hv.prototype.off=function(e,t){var i=this;return i._handlers_=i._handlers_||{},e===void 0?i._handlers_={}:t===void 0?i._handlers_[e]=null:i._handlers_[e]&&i._handlers_[e].indexOf(t)>=0&&i._handlers_[e].splice(i._handlers_[e].indexOf(t),1),i};hv.prototype.trigger=function(e,t){var i=this,r=e.split(/[ ,]+/g),n;i._handlers_=i._handlers_||{};for(var s=0;s<r.length;s+=1)n=r[s],i._handlers_[n]&&i._handlers_[n].length&&i._handlers_[n].forEach(function(a){a.call(i,{type:n,target:i},t)})};hv.prototype.config=function(e){var t=this;t.options=t.defaults||{},e&&(t.options=wze(t.options,e))};hv.prototype.bindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[t]=function(){typeof i["on"+t]=="function"?i["on"+t].apply(i,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},lC(e,Ly[t],i._domHandlers_[t]),c_[t]&&lC(e,c_[t],i._domHandlers_[t]),i};hv.prototype.unbindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},VH(e,Ly[t],i._domHandlers_[t]),c_[t]&&VH(e,c_[t],i._domHandlers_[t]),delete i._domHandlers_[t],this};var LB=hv;function Ps(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=Ps.id,Ps.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}Ps.prototype=new LB;Ps.constructor=Ps;Ps.id=0;Ps.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)};Ps.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=xze("borderRadius","50%"),i=IB("transition","opacity",e),r={};return r.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},r.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:"rgba(255, 255, 255, .4)",border:"solid 2px rgba(0, 0, 0, .1)"},r.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:"rgba(255, 255, 255, .8)",border:"solid 2px rgba(0, 0, 0, .1)"},YD(r.el,i),this.options.shape==="circle"&&YD(r.back,t),YD(r.front,t),this.applyStyles(r),this};Ps.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var i in e[t])this.ui[t].style[i]=e[t][i];return this};Ps.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)};Ps.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)};Ps.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()};Ps.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout(function(){t.ui.el.style.opacity=1},0),t.showTimeout=setTimeout(function(){t.trigger("shown",t.instance),typeof e=="function"&&e.call(this)},t.options.fadeTime)),t};Ps.prototype.hide=function(e){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout(function(){var i=t.options.mode==="dynamic"?"none":"block";t.ui.el.style.display=i,typeof e=="function"&&e.call(t),t.trigger("hidden",t.instance)},t.options.fadeTime),t.options.restJoystick){let i=t.options.restJoystick,r={};r.x=i===!0||i.x!==!1?0:t.instance.frontPosition.x,r.y=i===!0||i.y!==!1?0:t.instance.frontPosition.y,t.setPosition(e,r)}return t};Ps.prototype.setPosition=function(e,t){var i=this;i.frontPosition={x:t.x,y:t.y};var r=i.options.fadeTime+"ms",n={};n.front=IB("transition",["top","left"],r);var s={front:{}};s.front={left:i.frontPosition.x+"px",top:i.frontPosition.y+"px"},i.applyStyles(n),i.applyStyles(s),i.restTimeout=setTimeout(function(){typeof e=="function"&&e.call(i),i.restCallback()},i.options.fadeTime)};Ps.prototype.restCallback=function(){var e=this,t={};t.front=IB("transition","none",""),e.applyStyles(t),e.trigger("rested",e.instance)};Ps.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}};Ps.prototype.computeDirection=function(e){var t=e.angle.radian,i=Math.PI/4,r=Math.PI/2,n,s,a;if(t>i&&t<i*3&&!e.lockX?n="up":t>-i&&t<=i&&!e.lockY?n="left":t>-i*3&&t<=-i&&!e.lockX?n="down":e.lockY||(n="right"),e.lockY||(t>-r&&t<r?s="left":s="right"),e.lockX||(t>0?a="up":a="down"),e.force>this.options.threshold){var o={},l;for(l in this.direction)this.direction.hasOwnProperty(l)&&(o[l]=this.direction[l]);var u={};this.direction={x:s,y:a,angle:n},e.direction=this.direction;for(l in o)o[l]===this.direction[l]&&(u[l]=!0);if(u.x&&u.y&&u.angle)return e;(!u.x||!u.y)&&this.trigger("plain",e),u.x||this.trigger("plain:"+s,e),u.y||this.trigger("plain:"+a,e),u.angle||this.trigger("dir dir:"+n,e)}else this.resetDirection();return e};var _ze=Ps;function Fn(e,t){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=e,i.id=Fn.id,Fn.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(t),(i.options.mode==="static"||i.options.mode==="semi")&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);let r=getComputedStyle(i.options.zone.parentElement);return r&&r.display==="flex"&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}Fn.prototype=new LB;Fn.constructor=Fn;Fn.id=0;Fn.prototype.prepareNipples=function(){var e=this,t=e.nipples;t.on=e.on.bind(e),t.off=e.off.bind(e),t.options=e.options,t.destroy=e.destroy.bind(e),t.ids=e.ids,t.id=e.id,t.processOnMove=e.processOnMove.bind(e),t.processOnEnd=e.processOnEnd.bind(e),t.get=function(i){if(i===void 0)return t[0];for(var r=0,n=t.length;r<n;r+=1)if(t[r].identifier===i)return t[r];return!1}};Fn.prototype.bindings=function(){var e=this;e.bindEvt(e.options.zone,"start"),e.options.zone.style.touchAction="none",e.options.zone.style.msTouchAction="none"};Fn.prototype.begin=function(){var e=this,t=e.options;if(t.mode==="static"){var i=e.createNipple(t.position,e.manager.getIdentifier());i.add(),e.idles.push(i)}};Fn.prototype.createNipple=function(e,t){var i=this,r=i.manager.scroll,n={},s=i.options,a={x:i.parentIsFlex?r.x:r.x+i.box.left,y:i.parentIsFlex?r.y:r.y+i.box.top};if(e.x&&e.y)n={x:e.x-a.x,y:e.y-a.y};else if(e.top||e.right||e.bottom||e.left){var o=document.createElement("DIV");o.style.display="hidden",o.style.top=e.top,o.style.right=e.right,o.style.bottom=e.bottom,o.style.left=e.left,o.style.position="absolute",s.zone.appendChild(o);var l=o.getBoundingClientRect();s.zone.removeChild(o),n=e,e={x:l.left+r.x,y:l.top+r.y}}var u=new _ze(i,{color:s.color,size:s.size,threshold:s.threshold,fadeTime:s.fadeTime,dataOnly:s.dataOnly,restJoystick:s.restJoystick,restOpacity:s.restOpacity,mode:s.mode,identifier:t,position:e,zone:s.zone,frontPosition:{x:0,y:0},shape:s.shape});return s.dataOnly||(vO(u.ui.el,n),vO(u.ui.front,u.frontPosition)),i.nipples.push(u),i.trigger("added "+u.identifier+":added",u),i.manager.trigger("added "+u.identifier+":added",u),i.bindNipple(u),u};Fn.prototype.updateBox=function(){var e=this;e.box=e.options.zone.getBoundingClientRect()};Fn.prototype.bindNipple=function(e){var t=this,i,r=function(n,s){i=n.type+" "+s.id+":"+n.type,t.trigger(i,s)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",r),e.on("dir:up dir:right dir:down dir:left",r),e.on("plain:up plain:right plain:down plain:left",r)};Fn.prototype.pressureFn=function(e,t,i){var r=this,n=0;clearInterval(r.pressureIntervals[i]),r.pressureIntervals[i]=setInterval((function(){var s=e.force||e.pressure||e.webkitForce||0;s!==n&&(t.trigger("pressure",s),r.trigger("pressure "+t.identifier+":pressure",s),n=s)}).bind(r),100)};Fn.prototype.onstart=function(e){var t=this,i=t.options,r=e;e=xK(e),t.updateBox();var n=function(s){t.actives.length<i.maxNumberOfNipples?t.processOnStart(s):r.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach(function(a){if(Object.values(r.touches).findIndex(function(l){return l.identifier===a})<0){var o=[e[0]];o.identifier=a,t.processOnEnd(o)}}),t.actives.length<i.maxNumberOfNipples&&t.processOnStart(s))};return yO(e,n),t.manager.bindDocument(),!1};Fn.prototype.processOnStart=function(e){var t=this,i=t.options,r,n=t.manager.getIdentifier(e),s=e.force||e.pressure||e.webkitForce||0,a={x:e.pageX,y:e.pageY},o=t.getOrCreate(n,a);o.identifier!==n&&t.manager.removeIdentifier(o.identifier),o.identifier=n;var l=function(c){c.trigger("start",c),t.trigger("start "+c.id+":start",c),c.show(),s>0&&t.pressureFn(e,c,c.identifier),t.processOnMove(e)};if((r=t.idles.indexOf(o))>=0&&t.idles.splice(r,1),t.actives.push(o),t.ids.push(o.identifier),i.mode!=="semi")l(o);else{var u=GE(a,o.position);if(u<=i.catchDistance)l(o);else{o.destroy(),t.processOnStart(e);return}}return o};Fn.prototype.getOrCreate=function(e,t){var i=this,r=i.options,n;return/(semi|static)/.test(r.mode)?(n=i.idles[0],n?(i.idles.splice(0,1),n):r.mode==="semi"?i.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1)):(n=i.createNipple(t,e),n)};Fn.prototype.processOnMove=function(e){var t=this,i=t.options,r=t.manager.getIdentifier(e),n=t.nipples.get(r),s=t.manager.scroll;if(!yze(e)){this.processOnEnd(e);return}if(!n){console.error("Found zombie joystick with ID "+r),t.manager.removeIdentifier(r);return}if(i.dynamicPage){var a=n.el.getBoundingClientRect();n.position={x:s.x+a.left,y:s.y+a.top}}n.identifier=r;var o=n.options.size/2,l={x:e.pageX,y:e.pageY};i.lockX&&(l.y=n.position.y),i.lockY&&(l.x=n.position.x);var u=GE(l,n.position),c=mze(l,n.position),h=gO(c),d=u/o,p={distance:u,position:l},m,v;if(n.options.shape==="circle"?(m=Math.min(u,o),v=gze(n.position,m,c)):(v=bze(l,n.position,o),m=GE(v,n.position)),i.follow){if(u>o){let _=l.x-v.x,A=l.y-v.y;n.position.x+=_,n.position.y+=A,n.el.style.top=n.position.y-(t.box.top+s.y)+"px",n.el.style.left=n.position.x-(t.box.left+s.x)+"px",u=GE(l,n.position)}}else l=v,u=m;var g=l.x-n.position.x,w=l.y-n.position.y;n.frontPosition={x:g,y:w},i.dataOnly||vO(n.ui.front,n.frontPosition);var S={identifier:n.identifier,position:l,force:d,pressure:e.force||e.pressure||e.webkitForce||0,distance:u,angle:{radian:h,degree:c},vector:{x:g/o,y:-w/o},raw:p,instance:n,lockX:i.lockX,lockY:i.lockY};S=n.computeDirection(S),S.angle={radian:gO(180-c),degree:180-c},n.trigger("move",S),t.trigger("move "+n.id+":move",S)};Fn.prototype.processOnEnd=function(e){var t=this,i=t.options,r=t.manager.getIdentifier(e),n=t.nipples.get(r),s=t.manager.removeIdentifier(n.identifier);!n||(i.dataOnly||n.hide(function(){i.mode==="dynamic"&&(n.trigger("removed",n),t.trigger("removed "+n.id+":removed",n),t.manager.trigger("removed "+n.id+":removed",n),n.destroy())}),clearInterval(t.pressureIntervals[n.identifier]),n.resetDirection(),n.trigger("end",n),t.trigger("end "+n.id+":end",n),t.ids.indexOf(n.identifier)>=0&&t.ids.splice(t.ids.indexOf(n.identifier),1),t.actives.indexOf(n)>=0&&t.actives.splice(t.actives.indexOf(n),1),/(semi|static)/.test(i.mode)?t.idles.push(n):t.nipples.indexOf(n)>=0&&t.nipples.splice(t.nipples.indexOf(n),1),t.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(t.manager.ids[s.id]=s.identifier))};Fn.prototype.onDestroyed=function(e,t){var i=this;i.nipples.indexOf(t)>=0&&i.nipples.splice(i.nipples.indexOf(t),1),i.actives.indexOf(t)>=0&&i.actives.splice(i.actives.indexOf(t),1),i.idles.indexOf(t)>=0&&i.idles.splice(i.idles.indexOf(t),1),i.ids.indexOf(t.identifier)>=0&&i.ids.splice(i.ids.indexOf(t.identifier),1),i.manager.removeIdentifier(t.identifier),i.manager.unbindDocument()};Fn.prototype.destroy=function(){var e=this;e.unbindEvt(e.options.zone,"start"),e.nipples.forEach(function(i){i.destroy()});for(var t in e.pressureIntervals)e.pressureIntervals.hasOwnProperty(t)&&clearInterval(e.pressureIntervals[t]);e.trigger("destroyed",e.nipples),e.manager.unbindDocument(),e.off()};var Sze=Fn;function Xs(e){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=jH(),t.config(e),t.prepareCollections();var i=function(){var n;t.collections.forEach(function(s){s.forEach(function(a){n=a.el.getBoundingClientRect(),a.position={x:t.scroll.x+n.left,y:t.scroll.y+n.top}})})};if(typeof window>"u")return t.collections;lC(window,"resize",function(){UH(i)});var r=function(){t.scroll=jH()};return lC(window,"scroll",function(){UH(r)}),t.collections}Xs.prototype=new LB;Xs.constructor=Xs;Xs.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var i;return e.collections.every(function(r){return i=r.get(t),!i}),i}};Xs.prototype.create=function(e){return this.createCollection(e)};Xs.prototype.createCollection=function(e){var t=this,i=new Sze(t,e);return t.bindCollection(i),t.collections.push(i),i};Xs.prototype.bindCollection=function(e){var t=this,i,r=function(n,s){i=n.type+" "+s.id+":"+n.type,t.trigger(i,s)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",r),e.on("dir:up dir:right dir:down dir:left",r),e.on("plain:up plain:right plain:down plain:left",r)};Xs.prototype.bindDocument=function(){var e=this;e.binded||(e.bindEvt(document,"move").bindEvt(document,"end"),e.binded=!0)};Xs.prototype.unbindDocument=function(e){var t=this;(!Object.keys(t.ids).length||e===!0)&&(t.unbindEvt(document,"move").unbindEvt(document,"end"),t.binded=!1)};Xs.prototype.getIdentifier=function(e){var t;return e?(t=e.identifier===void 0?e.pointerId:e.identifier,t===void 0&&(t=this.latest||0)):t=this.index,this.ids[t]===void 0&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]};Xs.prototype.removeIdentifier=function(e){var t={};for(var i in this.ids)if(this.ids[i]===e){t.id=i,t.identifier=this.ids[i],delete this.ids[i];break}return t};Xs.prototype.onmove=function(e){var t=this;return t.onAny("move",e),!1};Xs.prototype.onend=function(e){var t=this;return t.onAny("end",e),!1};Xs.prototype.oncancel=function(e){var t=this;return t.onAny("end",e),!1};Xs.prototype.onAny=function(e,t){var i=this,r,n="processOn"+e.charAt(0).toUpperCase()+e.slice(1);t=xK(t);var s=function(o,l,u){u.ids.indexOf(l)>=0&&(u[n](o),o._found_=!0)},a=function(o){r=i.getIdentifier(o),yO(i.collections,s.bind(null,o,r)),o._found_||i.removeIdentifier(r)};return yO(t,a),!1};Xs.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach(function(t){t.destroy()}),e.off()};Xs.prototype.onDestroyed=function(e,t){var i=this;if(i.collections.indexOf(t)<0)return!1;i.collections.splice(i.collections.indexOf(t),1)};var Mze=Xs,HH=new Mze,Aze={create:function(e){return HH.create(e)},factory:HH},MK=new Map,gb=new Map,wg=class{constructor(e,t,i,r){this.data=t;let{audio:n,volume:s,delay:a,loop:o}=t;if(!n)throw new Error("Missing property");let l=typeof n=="string"?r.getAudio(n).src:n.data;this.audioPlayer=new Qw({src:l,volume:s,delay:a,loop:o}),gb.has(i.uuid)?gb.get(i.uuid).push(this):gb.set(i.uuid,[this]),MK.set(e,this)}playByToggle(){this.data.toggle==="stop"?this.audioPlayer.status==="playing"?this.audioPlayer.stop():(this.audioPlayer.stop(),this.audioPlayer.play()):this.data.toggle==="pause"?this.audioPlayer.status==="playing"?this.audioPlayer.pause():this.audioPlayer.play():(this.audioPlayer.stop(),this.audioPlayer.play())}dispose(){this.audioPlayer.stop()}},xO=class{constructor(e){this.data=e}dispatch(){this.data.playAudio?this.pauseAudio(this.data.playAudio):this.data.object?this.pauseAllAudiosFromObject(this.data.object):this.pauseAllAudios()}pauseAudio(e){let t=MK.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.audioPlayer[this.data.interaction](),this.disposeDelay()},this.data.delay)):t.audioPlayer[this.data.interaction]())}pauseAllAudiosFromObject(e){let t=gb.get(e);!t?.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(i=>i.audioPlayer[this.data.interaction]()),this.disposeDelay()},this.data.delay)):t.forEach(i=>i.audioPlayer[this.data.interaction]()))}pauseAllAudios(){let e=[...gb.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(t=>{t.forEach(i=>{i.audioPlayer[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):e.forEach(t=>{t.forEach(i=>{i.audioPlayer[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},AK=class{constructor(e,t,i,r,n){if(this.data=t,this.shared=r,this.condition=n,t.interaction==="play")this.interaction=new wg(e,t,i,r);else if(t.interaction==="pause"||t.interaction==="stop")this.interaction=new xO(t);else throw new Error("Missing property")}dispatchBasic(){if(jr(this.shared,this.condition)===!1)return!1;this.interaction instanceof wg?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(jr(this.shared,this.condition)===!1)return!1;this.interaction instanceof wg?this.interaction.audioPlayer.play():this.interaction.dispatch()}dispatchGameControl(e){if(jr(this.shared,this.condition)===!1)return!1;this.interaction instanceof wg&&(e==="start"?this.interaction.audioPlayer.play():this.interaction.audioPlayer.stop())}dispose(){this.interaction.dispose()}},EK=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r,this.delay=0,this.emission=e.emission,e.delay!==void 0&&(this.delay=e.delay),this.particleSystem=this.page.scene.find(this.data.emitterObjectId)}toggleEmitting(){this.particleSystem.started&&!this.particleSystem.stopped?this.stop(this.delay):this.start(this.delay)}toggleFroze(){this.particleSystem.started&&!this.particleSystem.isFrozen?this.freeze(this.delay):this.unFreeze(this.delay)}start(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.start(0),this.clearDelay()},e);return}this.particleSystem.start()}stop(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.stop(0),this.clearDelay()},e);return}this.particleSystem.stop()}freeze(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.freeze(0),this.clearDelay()},e);return}this.particleSystem.froze()}unFreeze(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.unFreeze(0),this.clearDelay()},e);return}this.particleSystem.unFroze()}reset(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.reset(0),this.clearDelay()},e);return}this.particleSystem.reset()}reverseFromCurrent(){switch(this.emission){case"emitToggle":this.toggleEmitting();break;case"pauseToggle":this.toggleFroze();break}}dispatchBasic(){if(jr(this.shared,this.condition)===!1||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"emitToggle":this.toggleEmitting();break;case"pause":this.freeze(this.delay);break;case"pauseToggle":this.toggleFroze();break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay);break}}dispatchConditional(){if(jr(this.shared,this.condition)===!1||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay);break}}dispatchGameControl(e){if(jr(this.shared,this.condition)===!1||!this.particleSystem)return!1;e==="start"?this.start(this.delay):this.stop(this.delay)}dispose(){!this.particleSystem||(this.particleSystem.reset(),this.clearDelay())}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}},Eze="text/plain",Cze="us-ascii",WH=(e,t)=>t.some(i=>i instanceof RegExp?i.test(e):i===e),Tze=(e,{stripHash:t})=>{let i=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(e);if(!i)throw new Error(`Invalid URL: ${e}`);let{type:r,data:n,hash:s}=i.groups,a=r.split(";");s=t?"":s;let o=!1;a[a.length-1]==="base64"&&(a.pop(),o=!0);let l=(a.shift()||"").toLowerCase(),u=[...a.map(c=>{let[h,d=""]=c.split("=").map(p=>p.trim());return h==="charset"&&(d=d.toLowerCase(),d===Cze)?"":`${h}${d?`=${d}`:""}`}).filter(Boolean)];return o&&u.push("base64"),(u.length>0||l&&l!==Eze)&&u.unshift(l),`data:${u.join(";")},${o?n.trim():n}${s?`#${s}`:""}`};function Pze(e,t){if(t={defaultProtocol:"http:",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,sortQueryParameters:!0,...t},e=e.trim(),/^data:/i.test(e))return Tze(e,t);if(/^view-source:/i.test(e))throw new Error("`view-source:` is not supported as it is a non-standard protocol");let i=e.startsWith("//");!i&&/^\.*\//.test(e)||(e=e.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,t.defaultProtocol));let r=new URL(e);if(t.forceHttp&&t.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(t.forceHttp&&r.protocol==="https:"&&(r.protocol="http:"),t.forceHttps&&r.protocol==="http:"&&(r.protocol="https:"),t.stripAuthentication&&(r.username="",r.password=""),t.stripHash?r.hash="":t.stripTextFragment&&(r.hash=r.hash.replace(/#?:~:text.*?$/i,"")),r.pathname){let s=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g,a=0,o="";for(;;){let u=s.exec(r.pathname);if(!u)break;let c=u[0],h=u.index,d=r.pathname.slice(a,h);o+=d.replace(/\/{2,}/g,"/"),o+=c,a=h+c.length}let l=r.pathname.slice(a,r.pathname.length);o+=l.replace(/\/{2,}/g,"/"),r.pathname=o}if(r.pathname)try{r.pathname=decodeURI(r.pathname)}catch{}if(t.removeDirectoryIndex===!0&&(t.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(t.removeDirectoryIndex)&&t.removeDirectoryIndex.length>0){let s=r.pathname.split("/"),a=s[s.length-1];WH(a,t.removeDirectoryIndex)&&(s=s.slice(0,-1),r.pathname=s.slice(1).join("/")+"/")}if(r.hostname&&(r.hostname=r.hostname.replace(/\.$/,""),t.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(r.hostname)&&(r.hostname=r.hostname.replace(/^www\./,""))),Array.isArray(t.removeQueryParameters))for(let s of[...r.searchParams.keys()])WH(s,t.removeQueryParameters)&&r.searchParams.delete(s);if(t.removeQueryParameters===!0&&(r.search=""),t.sortQueryParameters){r.searchParams.sort();try{r.search=decodeURIComponent(r.search)}catch{}}t.removeTrailingSlash&&(r.pathname=r.pathname.replace(/\/$/,""));let n=e;return e=r.toString(),!t.removeSingleSlash&&r.pathname==="/"&&!n.endsWith("/")&&r.hash===""&&(e=e.replace(/\/$/,"")),(t.removeTrailingSlash||r.pathname==="/")&&r.hash===""&&t.removeSingleSlash&&(e=e.replace(/\/$/,"")),i&&!t.normalizeProtocol&&(e=e.replace(/^http:\/\//,"//")),t.stripProtocol&&(e=e.replace(/^(?:https?:)?\/\//,"")),e}var Dze=class{constructor({url:e,context:t},i,r,n){if(this.controlsManager=i,this.shared=r,this.condition=n,!e)throw new Error("Missing property");this.url=e.startsWith("mailto:")?e:Pze(e,{removeTrailingSlash:!1,removeSingleSlash:!1,stripWWW:!1}),this.context=t??"tab"}dispatch(){if(jr(this.shared,this.condition)===!1)return!1;Gx?window.location.assign(this.url):(this.context==="tab"||DX&&this.context==="none"?window.open(this.url,"_blank"):this.context==="window"?window.open(this.url,"_blank",`width=${window.innerWidth}, height=${window.innerHeight}`):window.open(this.url,"_parent"),this.controlsManager.orbitControls?.onPointerUp(pi[0]),ZAe())}},CK=class{constructor(e,t,i,r,n){this.data=e,this.page=t,this.controlsManager=i,this.shared=r,this.condition=n,this.timeoutIdQueue=[],this.dispatchInner=()=>{this.objects.forEach(this.destroyCallback)},this.destroyCallback=s=>{this.timeoutIdQueue.shift();let a=this.page.scene.find(s);if(a===void 0)return;let o=this.controlsManager.sharedGameControlGlobals.rapierWorld,l=o?a.dataPatched.physics?.fusedBody:!0;if(a.cloner){for(let u of a.cloner.children)l?(u.playModeVisible=!1,u.rigidBody&&a.dataPatched.physics?.rigidBody==="positioned"&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(u.rigidBody.collider(0).handle),o.removeRigidBody(u.rigidBody),u.rigidBody=void 0),u.bvhGeometry&&(u.bvhGeometry=void 0)):this.clone===void 0||this.clone===u?(u.playModeVisible=!1,u.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(u.rigidBody.collider(0).handle),o.removeRigidBody(u.rigidBody),u.rigidBody=void 0)):u.playModeVisible===void 0&&(u.playModeVisible=!0);(l||this.clone===void 0||this.clone===!1)&&(a.visible=!1,a.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(a.rigidBody.collider(0).handle),o.removeRigidBody(a.rigidBody),a.rigidBody=void 0),a.bvhGeometry&&(a.bvhGeometry=void 0))}else a.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(a.rigidBody.collider(0).handle),o.removeRigidBody(a.rigidBody),a.rigidBody=void 0),a.bvhGeometry&&(a.bvhGeometry=void 0),a.visible=!1;o===void 0?this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(u=>u.bvhGeometry!==void 0):this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(u=>u.rigidBody!==void 0),a.destroyedInAction=!0,this.controlsManager.requestRender()},this.objects=[...e.objects]}dispatch(e){if(jr(this.shared,this.condition)===!1)return!1;this.clone=e,this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()}dispatchFromStart(){if(jr(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))}dispose(){this.timeoutIdQueue.forEach(e=>window.clearTimeout(e))}},TK=class{constructor(e,t,i,r,n){this.data=e,this.page=t,this.shared=i,this.eventManager=r,this.condition=n,this.shared=i}dispatch(){if(jr(this.shared,this.condition)===!1)return!1;clearTimeout(this.timeoutId),delete this.timeoutId,this.timeoutId=window.setTimeout(()=>{this.shared.reset(this.shared.data,!0),OB(this.page,this.shared,!0),this.eventManager.reset(),this.eventManager.controlsManager.gameControl?.reset(!0),this.page.switchToPlayCamera(),this.eventManager.controlsManager.requestRender(),delete this.timeoutId},(this.data.delay??0)*1e3)}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}};function Rze(e,t,i,r){let n=[],s=e.cameraType==="OrthographicCamera"?t.orthographic?.zoom:t.perspective?.zoom,a=e.cameraType==="OrthographicCamera"?i.orthographic?.zoom:i.perspective?.zoom;if(a!==void 0){let o=s??e.zoom,l=a;o!==l&&n.push({update:u=>{e.zoom=Ot.lerp(o,l,u),e.updateProjectionMatrix()},start:()=>{e.zoom=o,e.updateProjectionMatrix()},end:()=>{e.zoom=l,e.updateProjectionMatrix()}})}if(i.targetOffset!==void 0){let o=fa("targetOffset",e,t,i,r);o&&n.push(o)}return n}function Ize(e,t,i,r){if(i.scaleBaked===void 0)return;let n=(t.scaleBaked??e.data.geometry.scaleBaked).map(o=>typeof o=="string"?Number(r.getVariable(o)??0):o),s=i.scaleBaked.map(o=>typeof o=="string"?Number(r.getVariable(o)??0):o);if(Sp.isEqual(n,s))return;let a=[];return a.push({update:o=>{e.updateGeometryInteractions({scaleBaked:[Ot.lerp(n[0],s[0],o),Ot.lerp(n[1],s[1],o),Ot.lerp(n[2],s[2],o)]},r),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()},start:()=>{e.updateGeometryInteractions({scaleBaked:n},r),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()},end:()=>{e.updateGeometryInteractions({scaleBaked:s},r),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()}}),a}function Lze(e,t,i,r){if(!i.extrusion)return;let n=e.extrusion,s=t.extrusion??{},a=i.extrusion,o=[];return Vk.forEach(l=>{let u=qp(l,n,s,a,r);u&&o.push(u)}),o}function Oze(e,t,i,r){let n=[];if(!("geometry"in i))return n;let s=e.geometry.userData.parameters,a="geometry"in t?t.geometry:{},o=i.geometry;if(e instanceof u_){let l=Ize(e,a,o,r);l&&n.push(...l)}else{let l={};if(Object.assign(l,Gc(s,J3),Gc(a,J3)),J3.forEach(u=>{let c=qp(u,l,a,o,r);c&&n.push(c)}),e instanceof gT){Object.assign(l,{extrusion:{...s.extrusion}});let u=Lze(l,a,o,r);u&&n.push(...u)}n.length&&n.push({update:u=>{e.updateGeometryInteractions(l,r),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()},start:u=>{e.updateGeometryInteractions(l,r),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()},end:u=>{e.updateGeometryInteractions(l,r),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()}})}return n}function zze(e,t,i,r){let n=e.geometry.userData.parameters.extrusion;if(n)return Vk.forEach(s=>{rp(s,n,t,i,r)}),n}function kze(e,t,i,r){let n=e.updatedPathSnapping;if(n)return IEe.forEach(s=>{rp(s,n,t,i,r)}),n}function Bze(e,t,i,r){let n=[];if(i.intensity!==void 0){let s=fa("intensity",e,t,i,r);s&&n.push(s)}if(i.color!==void 0){let s=sCe("color",e,t,i,r);s&&n.push(s)}return n}function Nze(e,t,i,r){let n=[];if(Array.isArray(e.material)){if(!("materials"in i&&i.materials))return n;let s="materials"in t&&t.materials?t.materials:[],a=i.materials;e.material.forEach((o,l)=>{if(!a[l])return;let u=s[l]??{},c=a[l];typeof u=="string"||typeof c=="string"||n.push(...GH(o,u,c,r))})}else{if(!("material"in i&&i.material))return n;let s="material"in t&&t.material?t.material:{},a=i.material;if(typeof s=="string"||typeof a=="string")return n;n.push(...GH(e.material,s,a,r))}return n}function GH(e,t,i,r){let n=[],s=Iy(i,r)||!!t.layers&&Iy(t,r);n.push(Fze(e,s));for(let a of e.layers){let o=t.layers?.data(a.uuid),l=i.layers.data(a.uuid);if(!l||a.type!=="light"&&(!(a.visible??!0)||!(l.visible??!0)))continue;let u=a.getNames().filter(c=>!sY.some(h=>c.includes(h)));for(let c of u)try{let h=a.getValue(c),d;if(c==="colors")d=zK(a,o,l,c);else if(Array.isArray(h))c==="steps"&&(d=OK(a,o,l,c));else if(typeof h=="number")d=PK(a,o,l,c,r);else{if(typeof h=="boolean")continue;h instanceof Pe?d=DK(a,o,l,c):h instanceof H?d=RK(a,o,l,c,r):h instanceof Gs?d=LK(a,o,l,c,r):h instanceof li?d=IK(a,o,l,c,r):"isTexture"in h&&(d=kK(a,o,l,c))}d&&(Array.isArray(d)?n.push(...d):n.push(d))}catch(h){console.error(`lerpMaterial: unexpected material layer for ${c}`,h)}}return n}function PK(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=t?t[r]:e.getValue(r),a=i[r],o=typeof s=="string"?Number(n.getVariable(s)??0):s,l=typeof a=="string"?Number(n.getVariable(a)??0):a;if(o!==l)return{update:u=>{e.setValue(r,Ot.lerp(o,l,u))},start:()=>{e.setValue(r,o)},end:()=>{e.setValue(r,l)}}}function DK(e,t,i,r){if(!e.hasValue(r)||!(r in i))return;let n=e.getValue(r),s=t?new Pe().fromArray(t[r]):n.clone(),a=new Pe().fromArray(i[r]);if(!s.equals(a))return{update:o=>{n.lerpVectors(s,a,o)},start:()=>{n.copy(s)},end:()=>{n.copy(a)}}}function RK(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=e.getValue(r),a=t?t[r]:void 0,o=i[r],l=a?Q2(new H,a,n):s.clone(),u=Q2(new H,o,n);if(!l.equals(u))return{update:c=>{s.lerpVectors(l,u,c)},start:()=>{s.copy(l)},end:()=>{s.copy(u)}}}function IK(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=t?t[r]:void 0,a=i[r],o=e.getValue(r),l=s?typeof s=="string"?n.getColor(s).clone():new li().setRGB(s.r,s.g,s.b):o.clone(),u=typeof a=="string"?n.getColor(a).clone():new li().setRGB(a.r,a.g,a.b);if(l.equals(u))return;let c=o.clone();return{update:h=>{e.getValue(r)!==c&&e.setValue(r,c),c.lerpColors(l,u,h)},start:()=>{c.copy(l)},end:()=>{c.copy(u)}}}function LK(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=t?t[r]:void 0,a=i[r],o=e.getValue(r),l=s?typeof s=="string"?n.color(s).clone():new li().setRGB(s.r,s.g,s.b):o.clone(),u=typeof a=="string"?n.getColor(a).clone():new Gs(a.r,a.g,a.b,a.a);if(l.equals(u))return;let c=o.clone();return{update:h=>{e.getValue(r)!==c&&e.setValue(r,c),c.lerpColors(l,u,h)},start:()=>{c.copy(l)},end:()=>{c.copy(u)}}}function OK(e,t,i,r="steps"){if(!e.hasValue(r)||!(r in i))return;let n=[],s=e.getValue(r),a=t?t[r]:s,o=i[r];return Ak(a,o)||n.push({update:l=>{let u=[...s];for(let c=0;c<s.length;++c){let h=a[c],d=o[c];u[c]=Ot.lerp(h,d,l)}e.setValue(r,u)},start:()=>{e.setValue(r,a)},end:()=>{e.setValue(r,o)}}),n.length?n:void 0}function zK(e,t,i,r="colors"){if(!e.hasValue(r)||!(r in i))return;let n=[],s=e.getValue(r),a=t?t[r]:s.map(l=>l.toArray()),o=i[r];for(let l=0;l<s.length;++l){let u=[...a[l]],c=[...o[l]];t_.isEqual(u,c)||n.push({update:h=>{s[l].fromArray(t_.lerp(u,c,h))},start:()=>{s[l].fromArray(u)},end:()=>{s[l].fromArray(c)}})}return n.length?n:void 0}function kK(e,t,i,r="texture"){if(!e.hasValue(r)||!(r in i))return;let n=e.getNode("rotation"),s=t?.[r]?.rotation??0,a=i[r]?.rotation??0;if(n&&s!==a)return{update:g=>{n.value=Ot.lerp(s,a,g)*Ot.DEG2RAD},start:()=>{n.value=s*Ot.DEG2RAD},end:()=>{n.value=a*Ot.DEG2RAD}};let o=e.getNode("mat");if(!o)return;let l=t?t[r]:o,u=i[r],c=[...l.repeat],h=[...l.offset],d=[...u.repeat],p=[...u.offset],m=l.rotation??0,v=u.rotation??0;if(!Fc.isEqual(c,d)||!Fc.isEqual(h,p)||m!==v)return{update:g=>{o.repeat=Fc.lerp(c,d,g),o.offset=Fc.lerp(h,p,g),o.rotation=Ot.lerp(m,v,g),o.updateMatrix()},start:()=>{o.repeat=[...c],o.offset=[...h],o.rotation=m,o.updateMatrix()},end:()=>{o.repeat=[...d],o.offset=[...p],o.rotation=v,o.updateMatrix()}}}function qH(e,t,i,r,n,s,a){if(e==="colors")zK(t,i,r,e)?.forEach(o=>o.update(n));else if(Array.isArray(s))e==="steps"&&OK(t,i,r,e)?.forEach(o=>o.update(n));else if(typeof s=="number")PK(t,i,r,e,a)?.update(n);else{if(typeof s=="boolean")return;s instanceof Pe?DK(t,i,r,e)?.update(n):s instanceof H?RK(t,i,r,e,a)?.update(n):s instanceof Gs&&a?LK(t,i,r,e,a)?.update(n):s instanceof li&&a?IK(t,i,r,e,a)?.update(n):"isTexture"in s&&kK(t,i,r,e)?.update(n)}}function Fze(e,t){return{update:()=>{e.transparent=t}}}var QD=new H,XH=new ws;function Uze(e,t,i,r,n){let s=[],a,o,l,u,c,h,d,p;if(e instanceof qs?(a=K2("position",e,t,i,n),a&&s.push(a),l=fa("rotation",e,t,i,n),l&&s.push(l),u=K2("shear",e,t,i,n),u&&s.push(u)):(p={slide:t.pathSnapping?.slide??e.updatedPathSnapping?.slide??e.dataPatched.pathSnapping?.slide??0,offset:t.pathSnapping?.offset??e.updatedPathSnapping?.offset??e.dataPatched.pathSnapping?.offset??0},h=fa("slide",p,t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping,i.pathSnapping??e.dataPatched.pathSnapping,n),h&&s.push(h),d=fa("offset",p,t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping,i.pathSnapping??e.dataPatched.pathSnapping,n),d&&s.push(d),!h&&!d&&(a=V6("position",e,t,i,n),a&&s.push(a),o=V6("scale",e,t,i,n),o&&s.push(o),l=Vze(e,t,i,r,n),l&&s.push(l),c=nCe("hiddenMatrix",e,t,i),c&&s.push(c))),a||o||l||c||h||d){let m=e instanceof qs?()=>{e.updateWorldMatrix(!0,!1,!0),e.resetBBoxNeedsUpdate()}:()=>{e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD()),e.parent?.matrixWorldFusedFalse&&(e.matrixWorld.multiplyMatrices(e.parent.matrixWorldFusedFalse,e.matrix),e.matrixWorldNeedsUpdate=!1),Bc(e)&&wd(e.parent)&&e.invalidateDownstreamBooleanData(!0),e.updatePathSnapping(Object.assign({},t.pathSnapping,p))};s.push({update:m,start:m,end:m})}return s}function Vze(e,t,i,r,n){let s=t?.rotation?t.rotation.map(c=>(typeof c=="string"?Number(n.getVariable(c)??0):c)*Ot.DEG2RAD):void 0,a=i.rotation?.map(c=>(typeof c=="string"?Number(n.getVariable(c)??0):c)*Ot.DEG2RAD);if(!a)return;let o=s?new H().fromArray(s):new H().setFromEuler(e.rotation),l=new H().fromArray(a);if(o.equals(l))return;let u=QD.subVectors(l,o);if(r&&u.toArray().every(c=>Math.abs(c)<2*Math.PI)){let c=new xi().setFromEuler(XH.setFromVector3(o)),h=new xi().setFromEuler(XH.setFromVector3(l));return{update:d=>{rCe(c,h,e.quaternion,d)},start:()=>{e.rotation.setFromVector3(o)},end:()=>{e.rotation.setFromVector3(l)}}}else return{update:c=>{QD.lerpVectors(o,l,c),e.rotation.setFromVector3(QD)},start:()=>{e.rotation.setFromVector3(o)},end:()=>{e.rotation.setFromVector3(l)}}}function jze(e,t){return{update:()=>{e instanceof Fs&&(e.fill.enabled=t)}}}function Hze(e,t){return{update:()=>{e instanceof Fs&&(e.stroke.enabled=t)}}}function Wze(e,t){return{update:()=>{e instanceof Fs&&(e.dropShadow.enabled=t)}}}function Gze(e,t){return{update:()=>{e instanceof Fs&&(e.innerShadow.enabled=t)}}}function qze(e,t){return{update:()=>{e instanceof Fs&&(e.backgroundBlur.enabled=t)}}}function Xze(e,t){return{update:()=>{e instanceof Fs&&(e.layerBlur.enabled=t)}}}function Yze(e,t,i,r,n){let s=[],a,o,l,u,c,h,d,p,m,v,g,w,S,_,A;if("width"in e&&(a=fa("width",e,t,i,n),a&&s.push(a)),"height"in e&&(o=fa("height",e,t,i,n),o&&s.push(o)),e instanceof Fs||e instanceof Xc){let C={...t.fill},E={...i.fill};C.enabled!==void 0&&C.enabled!==E.enabled&&(s.push(jze(e,!0)),C.enabled||Object.assign(C,{enabled:!0,color:{...C.color,a:0}}),E.enabled||Object.assign(E,{enabled:!0,color:{...E.color,a:0}})),l=EA("color",e.fill,C,E,n),l&&s.push(l)}if(e instanceof Fs){let C={...t.stroke},E={...i.stroke};(C.enabled||E.enabled)&&(s.push(Hze(e,!0)),C.enabled||Object.assign(C,{enabled:!0,color:{...C.color,a:0}}),E.enabled||Object.assign(E,{enabled:!0,color:{...E.color,a:0}})),u=EA("color",e.stroke,C,E,n),u&&s.push(u),c=fa("thickness",e.stroke,C,E,n),c&&s.push(c)}if(e instanceof Fs){let C={...t.dropShadow},E={...i.dropShadow};(C.enabled||E.enabled)&&(s.push(Wze(e,!0)),C.enabled||Object.assign(C,{enabled:!0,color:{...C.color,a:0}}),E.enabled||Object.assign(E,{enabled:!0,color:{...E.color,a:0}})),h=EA("color",e.dropShadow,C,E,n),h&&s.push(h),d=fa("blurRadius",e.dropShadow,C,E,n),d&&s.push(d),m=fa("spread",e.dropShadow,C,E,n),m&&s.push(m),p=K2("offset",e.dropShadow,C,E,n),p&&s.push(p)}if(e instanceof Fs){let C={...t.innerShadow},E={...i.innerShadow};(C.enabled||E.enabled)&&(s.push(Gze(e,!0)),C.enabled||Object.assign(C,{enabled:!0,color:{...C.color,a:0}}),E.enabled||Object.assign(E,{enabled:!0,color:{...E.color,a:0}})),v=EA("color",e.innerShadow,C,E,n),v&&s.push(v),g=fa("blurRadius",e.innerShadow,C,E,n),g&&s.push(g),S=fa("spread",e.innerShadow,C,E,n),S&&s.push(S),w=K2("offset",e.innerShadow,C,E,n),w&&s.push(w)}if(e instanceof Fs||e instanceof Xc){let C={...t.backgroundBlur},E={...i.backgroundBlur};(C.enabled||E.enabled)&&(s.push(qze(e,!0)),C.enabled||Object.assign(C,{enabled:!0,radius:0}),E.enabled||Object.assign(E,{enabled:!0,radius:0})),_=fa("radius",e.backgroundBlur,C,E,n),_&&s.push(_)}if(e instanceof Fs){let C={...t.layerBlur},E={...i.layerBlur};(C.enabled||E.enabled)&&(s.push(Xze(e,!0)),C.enabled||Object.assign(C,{enabled:!0,radius:0}),E.enabled||Object.assign(E,{enabled:!0,radius:0})),A=fa("radius",e.layerBlur,C,E,n),A&&s.push(A)}if(e instanceof Xc||e instanceof $_){let C=Zk("cornerRadius",e,t,i,n);C&&s.push(C)}return s}function YH(e,t,i,r,n){let s=[];return e.data.visible&&s.push(...Uze(e,t,i,n,r)),e instanceof qs?s.push(...Yze(e,t,i,n,r)):(e.data.visible&&s.push(...aCe(e,t,i,r)),e instanceof xa?(e instanceof kn&&e.data.visible&&s.push(...Oze(e,t,i,r)),e.data.visible&&s.push(...Nze(e,t,i,r))):nC.is(e)?e.data.visible&&s.push(...Bze(e,t,i,r)):e instanceof Ms&&s.push(...Rze(e,t,i,r))),s.length?{update:a=>{s.forEach(o=>o.update(a))},start:a=>{s.forEach(o=>o.start?.(a))},end:a=>{s.forEach(o=>o.end?.(a))}}:void 0}function Qze(e,t){return{position(i){Object.assign(e.position,i),(i.x!==void 0||i.y!==void 0||i.z!==void 0)&&(e.updateMatrix(),e.resetBBoxNeedsUpdate(),e.dispatchEvent({type:"requestRender"}))},rotation(i){let r=Object.keys(i)[0];e.rotation[r]=i[r]*Ot.DEG2RAD,(i.x!==void 0||i.y!==void 0||i.z!==void 0)&&(e.updateMatrix(),e.resetBBoxNeedsUpdate(),e.dispatchEvent({type:"requestRender"}))},scale(i){Object.assign(e.scale,i),(i.x!==void 0||i.y!==void 0||i.z!==void 0)&&(e.updateMatrix(),e.resetBBoxNeedsUpdate(),e.dispatchEvent({type:"requestRender"}))},shapeSize(i){e instanceof kn&&(e.userData.value={...e.userData.value,...i},(i.x!==void 0||i.y!==void 0||i.z!==void 0)&&(e.updateGeometryInteractions({width:e.userData.value.x,height:e.userData.value.y,depth:e.userData.value.z},t),e.resetBBoxNeedsUpdate(),e.invalidateDownstreamBooleanData(),e.dispatchEvent({type:"requestRender"})))},material(i,r,n){n&&(Object.entries(n).forEach(([s,{start:a,end:o,t:l}])=>{let u=r.getValue(s);u!==void 0&&qH(s,r,a,o,l,u,t)}),e.dispatchEvent({type:"requestRender"}))},opacity(i){if(e instanceof xa&&!Array.isArray(e.material)){let r=e.material.getLayersOfType("light")[0];e.material.transparent=!0,qH("alphaOverride",r,{alphaOverride:i},{alphaOverride:i+1},0,i,t),e.dispatchEvent({type:"requestRender"})}},light(i,r){(e instanceof fT||e instanceof CB||e instanceof pT)&&(e[i]=r,e.dispatchEvent({type:"requestRender"}))},cloner(i){i.cloner?.update(),i.dispatchEvent({type:"requestRender"})},pathExtrusion(i,r){i.geometry.userData.parameters.extrusion={...i.geometry.userData.parameters.extrusion,...r},i.updateGeometryInteractions({extrusion:{...i.geometry.userData.parameters.extrusion}},t),i.resetBBoxNeedsUpdate(),i.invalidateDownstreamBooleanData(),i.dispatchEvent({type:"requestRender"})},pathSnapping(i){e.userData.pathSnapping={...e.userData.pathSnapping,...i},e.updatePathSnapping(e.userData.pathSnapping),e.dispatchEvent({type:"requestRender"})}}}var QH=new H;function OB(e,t,i=!1){let r=[],n=s=>{let a=s.data;delete s.states,s.currentState=null,s.reversibleToState=null,s.currentTransitionEvent=null;for(let o of a.states){let l={...o.data};s.states||(s.states={}),s.states[o.id]=yg.patch(a,l)}ZH(e.scene,s,null,t,a.events.find(o=>o.data.type==="Follow"||o.data.type==="LookAt")!==void 0),KH(e)};e.scene.traverse2D(n),e.traverseChildren(s=>{if(i&&(s.rigidBody?.setTranslation(s.position0,!0),s.rigidBody?.setRotation(s.rotation0,!0),s.rigidBody?.setLinvel(QH,!0),s.rigidBody?.setAngvel(QH,!0)),!Xi.is(s))return;let a=s.uuid,o=s.data;if(delete s.states,s.uuid===Xx)return;let l=!1;r.some(u=>e.scene.find(a)?.isDescendantOf(u))?l=!0:o.physics?.fusedBody===!0&&o.physics.rigidBody==="dynamic"&&r.push(a),s.data=o,s.currentState=null,s.reversibleToState=null,s.currentTransitionEvent=null;for(let u of o.states){let c={...u.data};e.data.globalPhysics.usePhysics===!0&&o.physics&&(o.physics.rigidBody==="dynamic"||l)&&(u.data.position!==void 0&&delete c.position,u.data.rotation!==void 0&&delete c.rotation,u.data.hiddenMatrix!==void 0&&delete c.hiddenMatrix),s.states||(s.states={}),s.states[u.id]=fp.patch(o,c)}ZH(e.scene,s,null,t,o.events.find(u=>u.data.type==="Follow"||u.data.type==="LookAt")!==void 0),s instanceof ka&&s.frame&&(s.frame.traverse(u=>n(u)),s.uiCanvas?.applySize())}),KH(e),e.frame&&(e.frame.traverse(s=>n(s)),e.uiCanvas?.applySize())}function KH(e){e.traverseEntity(t=>{for(let i of t.data.events){let r=[];switch(i.data.type){case"Follow":case"MouseHover":case"Scroll":case"MouseDown":case"MouseUp":case"MousePress":case"KeyUp":case"KeyDown":case"KeyPress":case"Collision":r.push(...i.data.actions);break;case"GameControl":for(let n of Object.values(i.data.gameActions))r.push(...n);break;case"DragDrop":r.push(...i.data.dragDropActions.drag,...i.data.dragDropActions.drop);break;case"Conditional":r.push(...i.data.inActions,...i.data.outActions);break}for(let n of r)if(n.data.type==="Create"&&n.data.hideBase==="Yes"){let s=e.scene.find(n.data.object);s&&(s.visible=!1)}}})}function ZH(e,t,i,r,n=!1){if(t instanceof kn&&!(t instanceof Zg)&&t.removeInteractionGeometry(r),t instanceof qs?t.changeSelectedState(i,{shared:r},n):t.changeSelectedState(i,{scene:e,shared:r},n),t instanceof kn&&t.updateGeometryGroupsIfNeeded(),t instanceof Ms&&t.updateCameraState(t.dataPatched,{scene:e,shared:r}),!(t instanceof qs)){if(t.cloner)for(let s of t.cloner.children)s.playModeVisible=void 0;t.updateVisible()}}function BK(e){let t;if(e.easing===5){let{control1:i,control2:r}=e;t=`cubicBezier(
			${i[0]}, ${i[1]}, ${r[0]}, ${r[1]}
		)`}else if(e.easing===6){let{mass:i,stiffness:r,damping:n,velocity:s}=e;t=`spring( ${i}, ${r}, ${n}, ${s} )`}else{let i;switch(e.easing){case 0:i=Zf.linear;break;case 1:i=Zf.ease;break;case 2:i=Zf.easeIn;break;case 3:i=Zf.easeOut;break;case 4:i=Zf.easeInOut;break;default:i=Zf.linear}let[r,n,s,a]=i;t=`cubicBezier( ${r}, ${n}, ${s}, ${a} )`}return{duration:Math.max(e.duration,1e-4),easing:t}}function uC(e){let t={delay:0,loop:e.repeat===-1?!0:e.repeat+1};if(e.repeat===0)t.direction="normal",t.rewind=!1;else switch(e.direction){case"pingpong":t.direction="alternate",t.rewind=!1;break;case"pingpong-rewind":t.direction="alternate",t.rewind=!0;break;default:t.direction="normal",t.rewind=!1;break}switch(t.delay=0,t.endDelay=0,t.startOnceDelay=0,t.pingPongDelayCorrection=0,t.pingPongEndDelayCorrection=0,e.delayDirection){case"start-once":t.startOnceDelay=e.delay;break;case"start":t.delay=e.delay;break;case"end":t.endDelay=e.delay;break;case"start-end":case void 0:t.delay=e.delay,t.endDelay=e.delay;break}return t.direction==="alternate"&&(t.delay/=2,t.endDelay/=2,e.delayDirection==="start"?(t.pingPongDelayCorrection=t.delay,typeof t.loop=="number"&&t.loop%2===0&&(t.pingPongEndDelayCorrection=t.delay)):e.delayDirection==="end"?typeof t.loop=="number"&&t.loop%2!==0&&(t.pingPongEndDelayCorrection=t.endDelay):e.delayDirection==="start-end"&&(t.pingPongDelayCorrection=t.delay,t.pingPongEndDelayCorrection=t.endDelay)),t}var NK={type:"beginState"},FK={type:"completeState",isfromEntity:!1},wO=class{constructor(e,t,i,r,n,s){if(this.object=e,this.data=r,this.sharedAssets=n,this.allowSlerp=s,this.targets={t:0},this.firstLoop=!0,this._changeBegan=!1,this._changeCompleted=!0,this.onChange=()=>{this.callback&&(this.callback.update(this.targets.t),this.object.requestRender()),this.targets.t===0||this.targets.t===1?this._changeCompleted||(this._changeCompleted=!0,this._changeBegan=!1,this.onChangeComplete()):(this._changeCompleted&&(this._changeCompleted=!1),this._changeBegan||(this._changeBegan=!0,this.onChangeBegin()))},this.onChangeBegin=()=>{this.object.reversibleToState=this.to.id;let a=this.targets.t>.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=a,this.object.dispatchEvent({type:"beginState",state:a}),this.object instanceof qs||this.object.traverseEntity(o=>{o!==this.object&&o instanceof Ms&&o.dispatchEvent(NK)})},this.onChangeComplete=()=>{this.firstLoop&&(this.onFirstLoop(),this.firstLoop=!1),this.object.reversibleToState=this.to.id;let a=this.targets.t<.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=a,this.object.dispatchEvent({type:"completeState",state:a}),this.object instanceof qs||this.object.traverseEntity(o=>{o!==this.object&&o instanceof Ms&&o.dispatchEvent(FK)})},this.onFirstLoop=()=>{this.useCurrentState&&(this.callback=YH(this.object,this.from.data,this.to.data,this.sharedAssets,this.allowSlerp))},t===void 0){let a=qE(this.object,this.object.currentState===i?this.object.prevState:this.object.currentState);if(!a)throw new Error("Missing property");this.from=a}else{let a=qE(this.object,t);if(!a)throw new Error("Missing property");this.from=a}if(i===void 0)throw new Error("Missing property");{let a=qE(this.object,i);if(!a)throw new Error("Missing property");this.to=a}this.useCurrentState=t===void 0||i===void 0,this.params={targets:this.targets,t:1,autoplay:!1,...uC(r),...BK(r),change:this.onChange},this.callback=YH(this.object,t===void 0?{}:this.from.data,i===void 0?{}:this.to.data,this.sharedAssets,this.allowSlerp)}get changeBegan(){return this._changeBegan}get changeCompleted(){return this._changeCompleted}},bO=class extends Ys{constructor(e,t,i,r,n){if(super(),this.eventType=e,this.data=t,this.page=i,this.shared=r,this.condition=n,this.toggleIsForward=!1,this.timelineNeedsRebuild=!1,this.hasPlayedOnce=!1,this.pauseOnNextLoopEnd=!1,this.onTimelineChangeComplete=()=>{if(this.pauseOnNextLoopEnd){this.pauseOnNextLoopEnd=!1,this.timeline?.pause();return}this.data.tweens[0].data.direction!=="normal"&&(this.toggleIsForward=!this.toggleIsForward),this.timelineNeedsRebuild!==!1&&(this.timeline?.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!1,isRebuild:!0}),this.timeline.play())},!t.object)throw new Error("Missing property");let s=this.page.scene.find(t.object)??this.page.uiCanvas?.find(t.object)??this.page.scene.find2DInUIObjects(t.object);if(!s)throw new Error("Missing property");if(!s.states)throw new Error("Missing property");if(this.object=s,t.tweens.length<2)throw new Error("Missing property");this.tweens=Array(this.data.tweens.length-1),this.startOnceDelay=t.tweens[0].data.delayDirection==="start-once"?t.tweens[0].data.delay:0,this.init()}get playing(){return this.timeline?.paused===!1}get changeBegan(){return this.tweens.some(e=>e.changeBegan)??!1}init(){this.initialCurrentState=qE(this.object,this.object.currentState).id,this.toggleIsForward=!1}get currentState(){return this.data.runMode==="Toggle"&&ZI(this.eventType)?this.initialCurrentState:this.object.currentState}buildTimeline({isForward:e=!0,needsRebuild:t=!1,isRebuild:i=!1}={}){try{let r=uC(this.data.tweens[0].data);i&&typeof r.loop=="number"&&r.loop--,this.timeline?.pause(),this.timeline=Og.timeline({autoplay:!1,...r,...r.loop===!0||r.loop>1?{timelineChangeComplete:this.onTimelineChangeComplete}:{}});let n=this.tweens.findIndex(s=>s?.changeBegan);if(t===!0&&(this.timelineNeedsRebuild=!0),e){let s=n===-1?0:n;for(let a=s;a<this.data.tweens.length-1;a++){let o=this.data.tweens[a],l=this.data.tweens[a+1],u;a===s&&(this.object.wasMovedByUser===!0||this.object.previousAction?.changeBegan===!0)?(u=void 0,this.object instanceof Ms&&(this.object.wasMovedByUser=!1)):u=o.data.state===void 0?this.currentState:o.data.state;let c=new wO(this.object,u,l.data.state===void 0?this.currentState:l.data.state,l.data,this.shared,this.data.allowSlerp??!1);n!==-1&&a===s&&Object.assign(c.params,{startOnceDelay:0}),this.tweens[a]=c,this.timeline.add(c.params,this.timeline.duration+(a===s?r.delay:0))}this.timeline.duration+=r.endDelay}else{let s=n===-1?this.data.tweens.length-1:n+1;for(let a=s;a>0;a--){let o=this.data.tweens[a],l=this.data.tweens[a-1],u;a===s&&(this.object.wasMovedByUser===!0||this.object.previousAction?.changeBegan===!0)?(u=void 0,this.object instanceof Ms&&(this.object.wasMovedByUser=!1)):u=o.data.state===void 0?this.currentState:o.data.state;let c=new wO(this.object,u,l.data.state===void 0?this.currentState:l.data.state,o.data,this.shared,this.data.allowSlerp??!1);n!==-1&&a===s&&Object.assign(c.params,{startOnceDelay:0}),this.tweens[a-1]=c,this.timeline.add(c.params,this.timeline.duration+(a===s?r.endDelay:0))}this.timeline.duration+=r.delay}}catch(r){r instanceof Error&&console.error(r.message)}this.object.previousAction?.playing===!0&&this.object.previousAction.pause(),this.object.previousAction=this}play(){if(jr(this.shared,this.condition)===!1||ZI(this.eventType)&&this.data.runMode==="Once"&&this.hasPlayedOnce||(this.hasPlayedOnce=!0,this.playing))return!1;this.startTimeout?.pause();let e=uC(this.data.tweens[0].data).pingPongDelayCorrection;this.startTimeout=Og({targets:{},duration:this.startOnceDelay+e,easing:"linear",complete:()=>{this.startTimeout=void 0;try{this.buildTimeline(),this.timeline.play()}catch(t){t instanceof Error&&console.error(t.message)}}})}pause(){this.timeline?.pause(),this.startTimeout?.pause(),this.tweens=Array(this.data.tweens.length-1),delete this.startTimeout}stop(){this.pause();let e=this.data.tweens[0].data.state===void 0?this.initialCurrentState:this.data.tweens[0].data.state;this.object instanceof qs?this.object.changeSelectedState(e,{shared:this.shared}):this.object.changeSelectedState(e,{scene:this.page.scene,shared:this.shared}),this.object.currentState=e}seek(e){if(jr(this.shared,this.condition)===!1)return!1;this.timeline===void 0&&this.buildTimeline(),this.timeline?.seek(e*this.timeline.duration,!0)}toggle(e){if(jr(this.shared,this.condition)===!1)return!1;this.startTimeout?.pause(),this.toggleIsForward=e??!this.toggleIsForward,this.playing?(this.timeline?.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!0}),this.pauseOnNextLoopEnd=!0,this.timeline.play()):this.startTimeout=Og({targets:{},duration:this.startOnceDelay,easing:"linear",complete:()=>{this.startTimeout=void 0,this.timeline?.pause(),this.buildTimeline({isForward:this.toggleIsForward}),this.timeline.play()}})}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause()}};function qE(e,t){let i,r;if(typeof t=="string"?(i=t,r=e.states?.[i]):t===null&&(i=null,r=e.data),!(i===void 0||r===void 0))return{id:i,data:r}}var Kze={type:"beginState"},JH={type:"completeState",isfromEntity:!1},$H={type:"requestRender"},UK=class extends Ys{constructor(e,t,i,r){super(),this.data=e,this.page=t,this.shared=i,this.condition=r,this.toggleIsForward=!1,this.posStart=new H,this.posEnd=new H,this.qStart=new xi,this.qEnd=new xi,this.zoomStart=1,this.zoomEnd=1}init(){}get playing(){return this.animation&&this.animation.began&&!this.animation.completed}buildAnimation(e=!1){if(!this.data.animate)return;let t=this.page.scene.find(this.data.targetCamera);if(!t||!t.visible)throw new ReferenceError("Target camera not founded or not visible");let i={t:0};this.posStart.copy(this.page.activeCamera.position),this.qStart.copy(this.page.activeCamera.quaternion),this.zoomStart=this.page.activeCamera.zoom,this.animation=Og({targets:i,t:1,...BK(this.data),update:()=>{i.t===0&&(this.data.runMode==="Toggle"&&!this.toggleIsForward?this.fromCamera&&(this.posEnd.copy(this.fromCamera.position),this.qEnd.copy(this.fromCamera.quaternion),this.zoomEnd=this.fromCamera.zoom,this.switchCamera(this.fromCamera.uuid)):(this.posEnd.copy(t.position),this.qEnd.copy(t.quaternion),this.zoomEnd=t.zoom,this.fromCamera=this.page.activeCamera,this.switchCamera(t.uuid)),this.page.activeCamera.dispatchEvent(Kze));let r=this.page.activeCamera;r.position.lerpVectors(this.posStart,this.posEnd,i.t),r.quaternion.slerpQuaternions(this.qStart,this.qEnd,i.t),r.zoom=this.zoomStart+(this.zoomEnd-this.zoomStart)*i.t,r.wasMovedBySwitchCameraAction=!0,r.updateMatrix(),r.updateMatrixWorld(),r.updateProjectionMatrix(),r.dispatchEvent($H),i.t===1&&r.dispatchEvent(JH)}})}switchCamera(e){let t=this.page.activeCamera,i=this.page.scene.find(e);if(!i||!i.visible)throw new ReferenceError("Target camera not founded or not visible");this.page.switchActiveCamera(i),t.dispatchEvent({type:"cameraChange",camera:i})}play(){if(jr(this.shared,this.condition)===!1)return!1;if(!this.playing&&this.page.activeCamera.uuid!==this.data.targetCamera)try{clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{delete this.timeoutId,this.data.animate?(this.buildAnimation(),this.animation?.play()):this.switchCamera(this.data.targetCamera)},this.data.delay*1e3)}catch{}}pause(){this.animation?.pause(),clearTimeout(this.timeoutId),delete this.timeoutId}toggle(e){if(jr(this.shared,this.condition)===!1)return!1;if(window.clearTimeout(this.timeoutId),delete this.timeoutId,e!==this.toggleIsForward)try{this.playing?(this.animation?.pause(),this.toggleIsForward=e??!this.toggleIsForward,this.buildAnimation(!0),this.animation?.play()):this.timeoutId=window.setTimeout(()=>{this.toggleIsForward=e??!this.toggleIsForward,this.data.animate?(this.animation?.pause(),this.buildAnimation(),this.animation?.play()):(this.toggleIsForward?(this.fromCamera=this.page.activeCamera,this.switchCamera(this.data.targetCamera)):this.fromCamera&&this.switchCamera(this.fromCamera.uuid),this.page.activeCamera.dispatchEvent(JH),this.page.activeCamera.dispatchEvent($H))},this.data.delay*1e3)}catch{}}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause(),this.toggleIsForward=!1}},VK=class extends Ys{constructor(e,t,i,r,n){super(),this.id=e,this.data=t,this.scene=i,this.sharedAssets=r,this.eventType=n,this.toggleIsForward=!1,this._finished=!1,this.hasPlayedOnce=!1,this._shouldForwardLoop=!1,this._shouldPauseOnNextLoopComplete=!1,this._onLoopComplete=()=>{this._shouldPauseOnNextLoopComplete&&(this.timeline.pause(),this._shouldPauseOnNextLoopComplete=!1)};try{let s=uC(this.data);typeof s.loop=="number"&&s.loop--,this.timeline=Og.timeline({...s,autoplay:!1}),this._shouldForwardLoop=s.loop===!0||typeof s.loop=="number"&&s.loop>1;let a=this.sharedAssets.data.timelineAnimations[this.data.timeline].mapping;Object.entries(a).forEach(([o,l])=>{let u=this.scene.find(o);if(!u)return;let c=u.data.timelineAnimations[l];if(!c)return;let h=kL.addKeyframesToTimeline(u,{...c},Qze(u,this.sharedAssets),this.sharedAssets),d=(this.data.delayDirection==="start"?this.data.delay:0)+(this.data.delayDirection==="start-end"?this.data.delay:0)+(this.data.delayDirection==="start-once"?this.data.delay:0);h.forEach(p=>{this.timeline.add(p,d)}),this.timeline.duration=c.to*1e3+d}),this.timeline.delay=0,this.timeline.duration+=(this.data.delayDirection==="start"?this.data.delay:0)+(this.data.delayDirection==="end"?this.data.delay:0)+(this.data.delayDirection==="start-end"?this.data.delay*2:0)+(this.data.delayDirection==="start-once"?this.data.delay*2:0),this.timeline.finished.then(()=>{Object.keys(a).forEach(o=>{let l=this.scene.find(o);l instanceof Ms&&l.dispatchEvent(FK)}),this._finished=!0}),this.timeline.loopComplete=this._onLoopComplete}catch{throw new Error("Missing property")}}get playing(){return this.timeline.paused===!1}get finished(){return this._finished}get paused(){return this.timeline.paused}play(){if(this.eventType!==void 0&&ZI(this.eventType)&&this.data.runMode==="Once"&&this.hasPlayedOnce||this.eventType===void 0&&this._finished)return!1;this.hasPlayedOnce=!0;let e=this.sharedAssets.data.timelineAnimations[this.data.timeline].mapping;Object.keys(e).forEach(t=>{let i=this.scene.find(t);i instanceof Ms&&i.dispatchEvent(NK)}),this.timeline.restart()}pause(){this.timeline.pause()}stop(){this.pause(),this.seek(0),this.timeline.reset(),this._finished=!1}seek(e){this.timeline.seek(e*this.timeline.duration,!0)}toggle(e){if(this.toggleIsForward=e??!this.toggleIsForward,this.playing){if(!this.toggleIsForward&&this.timeline.reversed&&this._shouldForwardLoop&&this.timeline.remaining%2===1){this._shouldPauseOnNextLoopComplete=!0;return}this.timeline.reverse(this.timeline.duration-this.timeline.currentTime),this._shouldForwardLoop&&this.timeline.loop&&this.timeline.reversed&&(this._shouldPauseOnNextLoopComplete=!0)}else(!this.toggleIsForward!==this.timeline.reversed||!this.toggleIsForward&&this.timeline.reversed&&this.timeline.direction==="alternate")&&this.timeline.reverse(),typeof this.timeline.loop=="number"&&typeof this.timeline.remaining=="number"&&this.timeline.remaining<this.timeline.loop&&this.toggleIsForward&&(this.timeline.remaining=this.timeline.loop),this.timeline.play()}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause()}};function jK(e){let t=e?.tracks.filter(i=>i.ValueTypeName==="vector"||i.ValueTypeName==="quaternion").map(i=>i.times.length);if(t?.length){let i=vAe(t);return i&&i>2?i:2}return 2}var HK=class extends Ys{constructor(e,t,i,r,n){super(),this.data=e,this.page=t,this.animationControls=i,this.shared=r,this.condition=n,this.startOnceDelay=0,this.toggleIsForward=!1;let s=e.object,a=t.scene.find(e.object);a&&Array.isArray(a.identity)&&(s=a.identity[0]),this.data={...e,object:s};let o=this.animationControls.clipIdToAction[e.clipId+"/"+s];if(this.duration=o?.getClip()?.duration??1,this.data.crop2){let l=jK(o?.getClip());this.leftFrameTime=this.data.crop2[0]/(l-1)*this.duration,this.rightFrameTime=this.data.crop2[1]/(l-1)*this.duration}else{let l=o?.getClip()?.tracks[0]?.times.length;l&&l>1?(this.leftFrameTime=this.data.crop[0]/l*this.duration,this.rightFrameTime=this.data.crop[1]/l*this.duration):(this.leftFrameTime=0,this.rightFrameTime=this.duration)}this.startOnceDelay=e.delay}get playing(){return this.threeAnimAction?.isRunning()??!1}play(e=!1){if(jr(this.shared,this.condition)===!1)return!1;window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{if(this.threeAnimAction=this.animationControls.play(this.data),!this.threeAnimAction)return;this.threeAnimAction.reset(),this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime;let t=this.data.object;Object.entries(this.animationControls.clipIdToAction).forEach(([i,r])=>{let n=i.split("/")[1];this.threeAnimAction!==r&&n===t&&r.isRunning()&&(e?r.fadeOut(.2):r.stop())}),e&&this.threeAnimAction?.fadeIn(.2)},this.startOnceDelay)}pause(){this.threeAnimAction&&(this.threeAnimAction.paused=!0),window.clearTimeout(this.timeoutId),delete this.timeoutId}stop(){this.threeAnimAction?.fadeOut(.2)}seek(e){this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction&&(this.threeAnimAction.paused=!0,this.threeAnimAction.time=Ot.clamp(this.threeAnimAction.time+1/60*e,this.leftFrameTime,this.rightFrameTime-16e-5),this.animationControls.needsUpdate=!0,this.animationControls.requestRender())}toggle(e,t=!1){if(jr(this.shared,this.condition)===!1)return!1;this.toggleIsForward=e??!this.toggleIsForward,this.threeAnimAction&&(this.threeAnimAction._loopCount=0),this.playing?this.threeAnimAction&&(this.threeAnimAction.timeScale=this.toggleIsForward?1:-1,this.toggleIsForward?(this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime)):this.timeoutId=window.setTimeout(()=>{if(this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction){this.toggleIsForward?(this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction.time=this.rightFrameTime,this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime),this.threeAnimAction.paused=!1,this.threeAnimAction.timeScale=this.toggleIsForward?1:-1;let i=this.data.clipId.split("/")[1];Object.entries(this.animationControls.clipIdToAction).forEach(([r,n])=>{let s=r.split("/")[1];this.threeAnimAction!==n&&s===i&&n.isRunning()&&(t?n.fadeOut(.2):n.stop())}),t&&this.threeAnimAction?.fadeIn(.2)}},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){let e=this.animationControls.clipIdToAction[this.data.clipId+"/"+this.data.object]?.getClip();e&&(e.duration=this.duration),this.pause()}},WK=class{constructor(e,t,i,r,n){this.data=e,this.page=t,this.eventManager=i,this.shared=r,this.condition=n,this.timeOutId=-1,this.scene=t.scene}dispatch(){if(jr(this.shared,this.condition)===!1)return!1;this.data.target!==this.page.uuid&&(window.clearTimeout(this.timeOutId),this.timeOutId=window.setTimeout(()=>{this.play()},this.data.delay*1e3))}dispose(){window.clearTimeout(this.timeOutId)}play(){if(this.scene.children.every(t=>t.uuid!==this.data.target||t.data.uiScene))return;this.data.transition==="fade"&&this.data.duration>0&&this.eventManager.eventContext.renderer.renderFromSceneForSceneTransitionPass(this.scene,this.scene.activeCamera,this.data.duration*1e3),this.eventManager.deactivate(),this.eventManager.controlsManager.deactivate();let e=this.scene.activeCamera;this.scene.updatePage(this.data.target),this.scene.traverseVisibleEntity(t=>{t.type==="ParticleSystem"&&(t.sleep(),t.wakeUp(),t.data.autoPlay?t.start():t.stop())}),this.scene.activePage.switchToPlayCamera(),this.scene.activeCamera.copyViewPlaneSize(e),OB(this.scene.activePage,this.shared),this.eventManager.activate(),this.eventManager.controlsManager.activate(this.eventManager)}},GK=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r,this.evaluatedCondition=!1}checkConditions(){this.evaluatedCondition=jr(this.shared,this.condition)}dispatch(){if(this.evaluatedCondition===!1)return!1;let e=this.shared.getVariable(this.data.variableId),t=tQ(this.data.expression,this.shared,va.typeOfVariable(e));t!==void 0&&this.shared.updateVariable(this.data.variableId,typeof t=="string"?{textValue:t}:t)}dispose(){}},qK=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r,this.timeoutId=null}dispatchInner(){if(jr(this.shared,this.condition)===!1)return!1;let e=this.shared.getDynamicVariablePlayState(this.data.variableId);if(this.data.mode==="PlayPause")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,e==="Playing"?"Paused":"Playing");else if(this.data.mode==="Play"&&e!=="Playing")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing");else if(this.data.mode==="Stop"&&e!=="Stopped")this.shared.setDynamicVariablePlayState(this.data.variableId,"Stopped");else if(this.data.mode==="Pause"&&e!=="Paused")this.shared.setDynamicVariablePlayState(this.data.variableId,"Paused");else if(this.data.mode==="Restart")this.shared.setDynamicVariablePlayState(this.data.variableId,"Restarted");else if(this.data.mode==="Toggle"){let t=this.shared.getDynamicVariableToggleIsForward(this.data.variableId);e==="Playing"?this.shared.setDynamicVariableToggleIsForward(this.data.variableId,t===void 0?!1:!t):(this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!t),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing"))}}dispatch(){let e=this.data.delay,t=this.shared.getDynamicVariablePlayState(this.data.variableId);this.data.mode==="PlayPause"&&t==="Playing"&&(e=this.data.pauseDelay),e!==0?(this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{this.timeoutId=null,this.dispatchInner()},e)):this.dispatchInner()}dispose(){this.timeoutId&&window.clearTimeout(this.timeoutId)}},Zze=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r}dispatch(){if(jr(this.shared,this.condition)===!1)return!1;(this.data.target==="single"?this.data.variableId?[this.data.variableId]:[]:Object.keys(this.shared.getVariables())).forEach(e=>{this.shared.getVariable(e);let t=this.shared.data.variables.data(e)?.value;t!==void 0&&this.shared.updateVariable(e,t),this.shared.enableLocalStorageForPersistentVariables&&localStorage.removeItem(tO(e))})}dispose(){}},Jze=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r}dispatch(){if(jr(this.shared,this.condition)===!1)return!1;this.data.userAPIId&&this.shared.getUserAPI(this.data.userAPIId)?.callUserAPI(this.shared)}dispose(){}};function jr(e,t){if(t===void 0)return!0;if(t.expression.length===0)return!1;let i=tQ(t.expression,e,"boolean");return t.negate?!i:!!i}function os(e,t,i,r,n,s){let a={Audio:[],Video:[],Particles:[],Link:[],Destroy:[],Create:[],Reset:[],Transition:[],TimelineAnimation:[],SwitchCamera:[],Animation:[],SceneTransition:[],SetVariable:[],DynamicVariablePlay:[],ClearLocalStorage:[],UserAPI:[]},o=l=>({id:u,data:c})=>{try{c.type==="Audio"?oa[e.type].includes("Audio")&&a.Audio.push(new AK(u,c,s,r,l)):c.type==="Video"&&!(s instanceof qs)?oa[e.type].includes("Video")&&a.Video.push(new YK(u,c,s,r,l)):c.type==="Particles"?oa[e.type].includes("Particles")&&a.Particles.push(new EK(c,i,r,l)):c.type==="Link"?oa[e.type].includes("Link")&&a.Link.push(new Dze(c,n.controlsManager,r,l)):c.type==="Create"?oa[e.type].includes("Create")&&a.Create.push(new QK(c,i,n.controlsManager,r,l)):c.type==="Destroy"?oa[e.type].includes("Destroy")&&a.Destroy.push(new CK(c,i,n.controlsManager,r,l)):c.type==="Reset"?oa[e.type].includes("Reset")&&a.Reset.push(new TK(c,i,r,n,l)):c.type==="Transition"?oa[e.type].includes("Transition")&&a.Transition.push(new bO(e.type,c,i,r,l)):c.type==="SwitchCamera"?oa[e.type].includes("SwitchCamera")&&a.SwitchCamera.push(new UK(c,i,r,l)):c.type==="SceneTransition"?oa[e.type].includes("SceneTransition")&&a.SceneTransition.push(new WK(c,i,n,r,l)):c.type==="Animation"?oa[e.type].includes("Animation")&&a.Animation.push(new HK(c,i,n.animationControls,r,l)):c.type==="SetVariable"?oa[e.type].includes("SetVariable")&&a.SetVariable.push(new GK(c,i,r,l)):c.type==="DynamicVariablePlay"?oa[e.type].includes("DynamicVariablePlay")&&a.DynamicVariablePlay.push(new qK(c,i,r,l)):c.type==="Conditional"?oa[e.type].includes("Conditional")&&(c.ifActions.forEach(o({expression:c.condition,negate:!1})),c.elseActions.forEach(o({expression:c.condition,negate:!0}))):c.type==="ClearLocalStorage"?oa[e.type].includes("ClearLocalStorage")&&a.ClearLocalStorage.push(new Zze(c,i,r,l)):c.type==="UserAPI"?oa[e.type].includes("UserAPI")&&a.UserAPI.push(new Jze(c,i,r,l)):c.type==="TimelineAnimation"&&oa[e.type].includes("TimelineAnimation")&&a.TimelineAnimation.push(new VK(u,c,i.scene,r,e.type))}catch{}};return t.forEach(o()),a}function Ws(e){Object.values(e).forEach(t=>{t.forEach(i=>{(i instanceof AK||i instanceof YK||i instanceof bO||i instanceof VK||i instanceof EK||i instanceof HK||i instanceof bO||i instanceof QK||i instanceof CK||i instanceof UK||i instanceof WK||i instanceof TK||i instanceof GK||i instanceof qK)&&i.dispose()})})}function $ze(e,t){let i;if("material"in e){let r=e.material;Array.isArray(r)?i=e.material[0].layers.find(n=>n.uuid===t):i=e.material.layers.find(n=>n.uuid===t)}if(i)return i.color.texture.image.img instanceof HTMLVideoElement?i.color.texture.image.img:void 0}var XK=new Map,vb=new Map,vp=class{constructor(e,t,i){this.data=t,this.delay=0,this.status="stopped";let{layerId:r,loop:n,volume:s,delay:a}=t;if(this.object=i,r===void 0)throw new Error("Missing property");let o=$ze(i,r);o&&(this.videoElement=o,this.videoElement.loop=n===1/0,Gx&&(this.videoElement.autoplay=!0),s!==void 0&&(this.videoElement.volume=s)),a!==void 0&&(this.delay=a),vb.has(i.uuid)?vb.get(i.uuid).push(this):vb.set(i.uuid,[this]),XK.set(e,this),this.pause()}mute(){!this.videoElement||(this.videoElement.muted=!0)}unMute(){!this.videoElement||(this.videoElement.muted=!1)}play(e){if(!this.videoElement)return;let t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);e?(this.mute(),this.delay+=150):t?(this.mute(),window.setTimeout(()=>{this.unMute()},100)):this.unMute(),this.delayTimerId=window.setTimeout(()=>{if(!this.videoElement)return;let i=this.videoElement.play();i!==void 0&&i.then(r=>{}).catch(r=>{this.play()}),this.clearDelay()},this.delay),this.status="playing"}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}pause(){!this.videoElement||(this.videoElement.pause(),this.status="paused")}stop(){!this.videoElement||(this.videoElement.pause(),this.videoElement.currentTime=0,this.status="stopped",this.clearDelay())}seek(e){return new Promise(t=>{if(!this.videoElement)return t();let i=this.videoElement.duration;if(i>0){let r=e%i;this.videoElement.currentTime=r}this.videoElement.addEventListener("seeked",()=>t(),{once:!0})})}playByToggle(){this.data.toggle==="stop"?this.status==="playing"?this.stop():(this.stop(),this.play()):this.data.toggle==="pause"?this.status==="playing"?this.pause():this.play():(this.stop(),this.play())}dispose(){!this.videoElement||(this.stop(),this.videoElement.muted=!0)}},_O=class{constructor(e){this.data=e}dispatch(){this.data.playVideo?this.pauseVideo(this.data.playVideo):this.data.object?this.pauseAllVideosFromObject(this.data.object):this.pauseAllVideos()}pauseVideo(e){let t=XK.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t[this.data.interaction](),this.disposeDelay()},this.data.delay)):t[this.data.interaction]())}pauseAllVideosFromObject(e){let t=vb.get(e);!t?.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(i=>i[this.data.interaction]()),this.disposeDelay()},this.data.delay)):t.forEach(i=>i[this.data.interaction]()))}pauseAllVideos(){let e=[...vb.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(t=>{t.forEach(i=>{i[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):e.forEach(t=>{t.forEach(i=>{i[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},YK=class{constructor(e,t,i,r,n){if(this.data=t,this.shared=r,this.condition=n,t.interaction==="play")this.interaction=new vp(e,t,i);else if(t.interaction==="pause"||t.interaction==="stop")this.interaction=new _O(t);else throw new Error("Missing property")}dispatchBasic(){if(jr(this.shared,this.condition)===!1)return!1;this.interaction instanceof vp?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(jr(this.shared,this.condition)===!1)return!1;this.interaction instanceof vp?this.interaction.play():this.interaction.dispatch()}dispose(){this.interaction.dispose()}},eW=(()=>{let e,t,i,r;function n(o){!e&&!tW()&&t?.sharedGameControlGlobals.createdObjects.length>0&&(e=requestAnimationFrame(s)),o&&(t=o,r=o.requestRender)}function s(o){let l=i?o-i:0,u=t.sharedGameControlGlobals.createdObjects,c=t.sharedGameControlGlobals.nCreatedPerAction,h=u.length,d=0;for(;d<h;){let p=u[d];p.userData.createdTime===void 0&&(p.userData.createdTime=o),p.userData.lifetime===void 0&&p.userData.quantity===void 0||p.userData.lifetime&&o-p.userData.createdTime<p.userData.lifetime||p.userData.quantity&&c[p.userData.actionId]<=p.userData.quantity?(p.userData.velocity&&(p.position.addScaledVector(p.userData.velocity,l/1e3),p.updateMatrix(),r()),d++):(c[p.userData.actionId]>p.userData.quantity&&c[p.userData.actionId]--,u.splice(d,1),p.removeFromParent(),t.sharedGameControlGlobals.rapierWorld&&p.rigidBody?(t.sharedGameControlGlobals.colliderToEntity.delete(p.rigidBody.collider(0).handle),t.sharedGameControlGlobals.rapierWorld.removeRigidBody(p.rigidBody)):(p.bvhGeometry=void 0,t.sharedGameControlGlobals.entitiesWithTransformAnim=t.sharedGameControlGlobals.entitiesWithTransformAnim.filter(m=>m.bvhGeometry!==void 0)),h--,r())}e=d>0?requestAnimationFrame(s):void 0,i=d>0?o:void 0}function a(){tW()?e&&(cancelAnimationFrame(e),e=void 0,i=void 0):n()}return typeof document<"u"&&document.addEventListener("visibilitychange",a),n})();function tW(){return!!document&&document.hidden}var iW=new xi,eke=new H,tke=new H,QK=class{constructor(e,t,i,r,n){this.data=e,this.page=t,this.controlsManager=i,this.shared=r,this.condition=n,this.intervalId=null,this.timeoutIdQueue=[],this.uniqueId=Ot.generateUUID(),this.dispatch=()=>{if(jr(this.shared,this.condition)===!1)return!1;this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()},this.dispatchFromStart=()=>{if(jr(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))},this.dispatchThrottled=zAe(this.dispatch,1e3/this.data.creationSpeed),this.dispatchStart=()=>{this.intervalId===null&&(this.intervalId=window.setInterval(this.dispatch,1e3/this.data.creationSpeed))},this.dispatchStop=()=>{this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null)},this.dispatchInner=()=>{this.timeoutIdQueue.shift();let a=new ya(this.object);if(a.playModeVisible=!0,a.expand(),this.data.coordinateSystem!=="world"){let l=this.data.coordinateSystem,u=this.page.scene.find(l);u&&(u.updateMatrixWorldSVD(),a.hiddenMatrix.copy(u.matrixWorldRigid))}a.scale.copy(this.object.scale),a.position.fromArray(this.data.position),a.rotation.fromArray(this.data.rotation),a.updateMatrix(),this.page.add(a);let o=this.controlsManager.sharedGameControlGlobals;o.createdObjects.push(a),o.nCreatedPerAction[this.uniqueId]===void 0?o.nCreatedPerAction[this.uniqueId]=1:o.nCreatedPerAction[this.uniqueId]++,a.updateWorldMatrix(!0,!0),a.traverseObject(this.traverseObjectCB),eW(),this.controlsManager.requestRender()},this.traverseObjectCB=a=>{a.hasNonUniformScale&&a.updateMatrixWorldSVD();let o;if(this.controlsManager.sharedGameControlGlobals.rapierWorld){if(a instanceof jl)if(a.objectForSample){if(a.objectForSample.dataPatched.physics.fusedBody)return;o=a.object}else return a.object.dataPatched.physics.fusedBody===!0&&a.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(a instanceof ya)o=a.object;else if(o=a,o.dataPatched.cloner?.hideBase)return!0}else{if(a instanceof jl)return;a instanceof ya?o=a.object:o=a}this.data.destroy==="Time"?a.userData.lifetime=this.data.lifetime*1e3:this.data.destroy==="Quantity"&&(a.userData.quantity=this.data.destroyAfterQuantity,a.userData.actionId=this.uniqueId);let l=new H().fromArray(this.data.velocity),u=o.dataPatched;if(!(u.physics.enabled==="visibility"?!u.visible:!u.physics.enabled)&&(this.controlsManager.sharedGameControlGlobals.rapierWorld?(this.controlsManager.addRigidBody(a,o,{fromCreate:!0,dynamic:this.data.dynamic}),this.data.destroy==="Collision"&&(a.rigidBody?.collider(0).setActiveEvents(1),a.userData.hasCollisionDestroy=!0),a.matrixWorld.decompose(eke,iW,tke),l.applyQuaternion(iW),this.data.velocity.some(c=>c!==0)&&this.data.dynamic&&a.rigidBody?.setLinvel(l.divideScalar(this.controlsManager.pixelsPerMeter),!0)):("geometry"in a.object&&this.controlsManager.addBoundsTree(a),this.data.velocity.some(c=>c!==0)&&this.data.dynamic&&(a.userData.velocity=l)),o.dataPatched.physics?.fusedBody===!0))return!0};let s=this.page.scene.find(this.data.object);if(!s)throw new Error("Missing Property");if(this.object=s,this.data.coordinateSystem!=="world"&&!this.page.scene.find(this.data.coordinateSystem))throw new Error("Missing Property");eW(i)}dispose(){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null),this.timeoutIdQueue.forEach(e=>window.clearTimeout(e)),this.dispatchThrottled.cancel(),this.page.remove(...this.controlsManager.sharedGameControlGlobals.createdObjects),this.controlsManager.sharedGameControlGlobals.createdObjects=[]}},KK=200,KD=.02,ZD=.3,ike=65,rW=new H,nW=new H,rke=new H,to=new H,Io=new H,qf=new H,JD=new yt,sW=new yt,nke=new yt;new yt;var Eu=new xi,Yh=new xi,Mc=new ws(0,0,0,"YXZ"),ske=new H(1,0,0),Cu=new H(0,1,0),ake=new H(0,0,1),aW=new H(1,1,1);new Wo;var oke=1,lke=.025,uke=16e-6,oW=12,cke=20,ks=new Gl,Rl=new Nn,hke={type:"requestRender"},dke={type:"updateMatrix"},lW=Math.PI/6,SO=class extends Ys{constructor(e,t,i,r,n,s,a,o,l){super(),this.object=e,this.domElement=t,this.data=i,this.gloabalPhysics=r,this.controlsManager=n,this.cameraFollow=s,this.camera=a,this.page=o,this.sharedAssets=l,this.enableDamping=!0,this.hiddenMatrix0=new yt,this.target0=new H,this.zoom0=1,this.rotForce=1,this.moveForce=1,this.pixelsPerMeter=KK,this.euler0=new ws(0,0,0,"YXZ"),this.position0Cam=new H,this.quat0Cam=new xi,this.scale0Cam=new H,this.hiddenMatrix0Cam=new yt,this.threshEndTranslate=.01,this.threshEndRotate=1e-8,this.threshEndRotVel=.005,this.collider={type:"capsule",radius:40,segment:new Gl(new H(0,-40,0),new H(0,40,0)),matrix:new yt,position:new H,rotation:new xi},this.euler=new ws(0,0,0,"YXZ"),this.eulerDelta=new H,this.lastPosition=new H,this.lastCameraQuaternion=new xi,this.lastCameraPosition=new H,this.PI_2=Math.PI/2,this.prevMouse=new Pe,this.velocityTarget=new H,this.velocity=new H,this.directionXZ=new H,this.rotVelocityStick=new H,this.rotVelocityTarget=new H,this.rotVelocity=new H,this.rotDirection=new H,this.nonColliderRotOffset=new yt,this.nonColliderPosOffset=new yt,this.firstPointerId=-1,this.rot=new H,this.path=[],this.movementState={moveNegZ:0,movePosZ:0,moveNegX:0,movePosX:0,moveNegY:0,movePosY:0,rotPosX:0,rotNegX:0,rotPosY:0,rotNegY:0,jump:0,run:0},this.vrEulerYOffset=0,this.onObject=!1,this.actionState={},this.keyAssignments=[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","ArrowUp"],["rotPosY","ArrowLeft"],["rotNegX","ArrowDown"],["rotNegY","ArrowRight"],["jump"," "]],this.collisionEnabled=!0,this.offsetMatrix=new yt,this.objectToTarget=new H,this.objectToTarget0=new H,this.objectToCamXZ=new H,this.objectToCamXZ0=new H,this.targetToCamera=new H,this.targetToCamera0=new H,this.cameraPolarAxis0=new H,this.targetPos=new H,this.targetQuat=new xi,this.lerpFactorPos=new H().setScalar(.3),this.lerpFactorPosStart=.3,this.lerpFactorPosEnd=.3,this.lerpFactorRotStart=.3,this.lerpFactorRotEnd=.3,this.lerpFactorPosCamera=.3,this.lerpFactorRotCamera=.3,this.objXZQuat=new xi,this.objXZQuatInv=new xi,this.objXZRotMat=new yt,this.isFirstPerson=!1,this.didHit=!1,this.groundVelocity=new H,this.pushedVelocity=new H,this.groundYRotation=0,this.objectRealQuat=new xi,this.colliderWorldQuat=new xi,this.groundNormal=new H,this.groundTilt=new xi,this.groundTiltInv=new xi,this.lastHitObj=null,this.isFirstFrame=!0,this.rotationAccumWhenOrientWithCamera=0,this.navMeshPathDest=null,this.position=new H,this.quaternion=new xi,this.scale=new H,this.initialAction=!0,this.onPointerDown=m=>{!(m.target===this.domElement||m.target instanceof HTMLElement&&m.target.tagName==="SPLINE-VIEWER"&&m.target.shadowRoot?.contains(this.domElement))||this.firstPointerId!==-1||(this.firstPointerId=m.pointerId,this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),this.rotBy!=="keys"&&!cl&&!RV&&this.domElement.requestPointerLock(),this.prevMouse.set(m.clientX,m.clientY))},this.onPointerUp=m=>{this.firstPointerId=-1,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),m.pointerType==="mouse"&&this.domElement.ownerDocument.exitPointerLock()},this.onPointerMove=m=>{if(m.pointerId!==this.firstPointerId)return;let v=m.clientX-this.prevMouse.x,g=m.clientY-this.prevMouse.y;this.prevMouse.set(m.clientX,m.clientY),m.pointerType==="mouse"&&this.rotBy!=="keys"&&(RV&&QAe<15.5&&!cl?(this.eulerDelta.y=-v*this.mouseOrbitSensitivity,this.eulerDelta.x=-g*this.mouseOrbitSensitivity):(this.eulerDelta.y=-m.movementX*this.mouseOrbitSensitivity,this.eulerDelta.x=-m.movementY*this.mouseOrbitSensitivity)),m.pointerType!=="mouse"&&this.rotByTouch==="drag"&&(this.eulerDelta.y=-v*this.mouseOrbitSensitivity*5,this.eulerDelta.x=-g*this.mouseOrbitSensitivity*5),this.controlsManager.requestRender()},this.onPointerlockChange=m=>{this.domElement.ownerDocument.pointerLockElement===this.domElement?SO.isLocked=!0:SO.isLocked=!1},this.onPointerlockError=()=>{console.error("SPE.GameControls: Unable to use Pointer Lock API")},this.handleVisibilityChange=()=>{if(document?.hidden)for(let m in this.movementState)this.movementState[m]=0},this.onKeyDown=m=>{!(m.target instanceof HTMLInputElement)&&(m.code==="ArrowLeft"||m.code==="ArrowUp"||m.code==="ArrowRight"||m.code==="ArrowDown"||m.code==="Space")&&m.preventDefault();for(let v of this.keyAssignments)if(m.key.toUpperCase()===v[1]||m.key===v[1]){this.movementState[v[0]]=1;break}this.controlsManager.requestRender()},this.onKeyUp=m=>{for(let v of this.keyAssignments)if(m.key.toUpperCase()===v[1]||m.key===v[1]||m.code.slice(3,m.code.length).toUpperCase()===v[1]){this.movementState[v[0]]=0;break}},this.copyVRGamePadValues=(m,v)=>{for(let g=2;g<4;g++){let w=m.axes[g];v===0?g===2?this.movementState.movePosX=w:this.movementState.movePosZ=w:(m.buttons[3].pressed?this.movementState.jump=1:this.movementState.jump=0,g===2?(Math.abs(this.movementState.rotPosY)<.3&&Math.abs(w)>=.3&&(this.vrEulerYOffset+=w<0?1:-1),this.movementState.rotPosY=w):this.moveMode==="fly"&&(this.movementState.moveNegY=w))}},this.sharedGameControlGlobals=n.sharedGameControlGlobals,e===a&&(this.isFirstPerson=!0),this.hiddenMatrix0.copy(this.object.hiddenMatrix),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.euler0.setFromQuaternion(this.quaternion,"YXZ");let u=this.euler0.clone(),c=u.y;if(this.objectRealQuat.copy(this.quaternion),u.y=0,this.quaternion.setFromEuler(u),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),u.set(0,c,0),this.quaternion.setFromEuler(u),this.rot.setFromEuler(u),this.object.matrixAutoUpdate=!1,(this.isFirstPerson||this.cameraFollow===!0)&&(this.target0.copy(this.camera.getTarget()),this.zoom0=this.camera.zoom),this.cameraFollow===!0){this.position0Cam.copy(this.camera.position),this.quat0Cam.copy(this.camera.quaternion),this.scale0Cam.copy(this.camera.scale),this.hiddenMatrix0Cam.copy(this.camera.hiddenMatrix),this.camera.parent?(this.camera.hiddenMatrix.copy(this.camera?.parent.matrixWorld),this.camera.matrix.copy(this.camera.matrixWorld)):this.camera.hiddenMatrix.identity(),this.camera.matrix.copy(this.camera.matrixWorld),this.camera.matrix.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.matrixAutoUpdate=!1,this.offsetMatrix.copy(this.object.matrix).invert().multiply(this.camera.matrix);let m=new H(0,0,-1).applyQuaternion(this.camera.quaternion),v=new H().subVectors(this.position,this.camera.position);this.objectToCamXZ.copy(v),this.objectToCamXZ.y=0,this.objectToCamXZ0.copy(this.objectToCamXZ);let g,w;Math.abs(m.y)<1e-6?(v.y=0,m.y=0,w=v.projectOnVector(m)):v.y/m.y>0?w=m.multiplyScalar(v.y/m.y):w=m.multiplyScalar(v.length()),this.targetToCamera0.copy(w).negate(),g=this.camera.position.clone().add(w),this.objectToTarget0.subVectors(g,this.position);let S=new ws().setFromQuaternion(this.camera.quaternion,"YXZ");this.cameraPolarOffset=-S.x,S.x=0,S.z=0,S.y-=Math.PI/2,this.cameraPolarAxis0.set(0,0,-1).applyEuler(S)}if(this.object instanceof Ms&&(this.object.matrixAutoUpdate=!1),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.rotByTouch=i.rotByTouch??"joystick",this.rotBy=i.rotBy??"keys",this.rotationMode=i.rotationMode??"normal",this.moveMode=i.moveMode??"walk",this.collisionEnabled=i.collisionEnabled,this.speedTranslate=(i.speedTranslate??250)*oke,this.speedOrbit=(i.speedRotate??100)*lke,this.mouseOrbitSensitivity=(i.speedRotate??100)*uke,this.keyAssignments=i.keyAssignments.map(m=>{let v=[m[0],m[1]];return v[1]===""?v[1]="ArrowUp":v[1]===""?v[1]="ArrowLeft":v[1]===""?v[1]="ArrowDown":v[1]===""?v[1]="ArrowRight":v[1]===""?v[1]="Shift":v[1]===""?v[1]="Enter":v[1]==="Space"?v[1]=" ":v[1]===""?v[1]="Meta":v[1]==="Ctrl"?v[1]="Control":v[1]==="Esc"&&(v[1]="Escape"),v}),i.rotBy==="mouse"){let m;m=this.keyAssignments.findIndex(v=>v[0]==="rotNegX"),m!==-1&&(this.keyAssignments[m][1]=""),m=this.keyAssignments.findIndex(v=>v[0]==="rotPosX"),m!==-1&&(this.keyAssignments[m][1]=""),m=this.keyAssignments.findIndex(v=>v[0]==="rotPosY"),m!==-1&&(this.keyAssignments[m][1]=""),m=this.keyAssignments.findIndex(v=>v[0]==="rotNegY"),m!==-1&&(this.keyAssignments[m][1]="")}this.lerpFactorPosStart=1-.02**(1/((i.delayPos[0]??.3)*60)),this.lerpFactorPosEnd=1-.02**(1/((i.delayPos[1]??.3)*60)),this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.lerpFactorRotStart=1-.02**(1/((i.delayRot[0]??.3)*60)),this.lerpFactorRotEnd=1-.02**(1/((i.delayRot[1]??.3)*60)),this.lerpFactorPosCamera=1-.02**(1/((i.delayPosCamera??.3)*60)),this.lerpFactorRotCamera=1-.02**(1/((i.delayRotCamera??.3)*60)),this.gravity=(this.gloabalPhysics.gravity??px.defaultData.gravity)*oW,this.usePhysics=this.gloabalPhysics.usePhysics??px.defaultData.usePhysics,this.jumpPower=i.jumpPower*cke,this.resetYPosition=this.position.y+Math.abs(i.resetYPosition)*(this.gravity>0?1:-1),this.alignToGround=i.alignToGround??!1,this.orientMode=i.autoOrientMove?i.orientMode:"none",this.orientWith=i.orientWith??H2.defaultDataThirdPerson.orientWith,this.slopeThresh=ike*Math.PI/180,i.collider.type==="capsule"?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=i.collider.height/2-i.collider.radius,this.collider.segment.end.y=-this.collider.segment.start.y,this.offset=i.collider.height*KD/this.pixelsPerMeter,this.stepThresh=i.collider.height*ZD/this.pixelsPerMeter,this.colliderHeight=i.collider.height):i.collider.type==="sphere"?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=0,this.collider.segment.end.y=0,this.offset=2*i.collider.radius*KD/this.pixelsPerMeter,this.stepThresh=2*i.collider.radius*ZD/this.pixelsPerMeter,this.colliderHeight=i.collider.radius*2):(this.offset=i.collider.height*KD/this.pixelsPerMeter,this.stepThresh=i.collider.height*ZD/this.pixelsPerMeter,this.colliderHeight=i.collider.height),this.collider.type=i.collider.type;let h=new H().fromArray(i.collider.position),d=new xi().setFromEuler(new ws().fromArray([...i.collider.rotation,"XYZ"]));this.collider.position.copy(h).multiply(this.scale),this.collider.rotation.copy(d),this.collider.matrix.compose(h,d,aW),i.cameraXAxis!==void 0&&(this.cameraXAxis=i.cameraXAxis,this.cameraYAxis=i.cameraYAxis,this.minPolarAngle=i.cameraRotXLimits[0],this.maxPolarAngle=i.cameraRotXLimits[1],this.minAzimuthAngleRel=i.cameraRotYLimits[0],this.maxAzimuthAngleRel=i.cameraRotYLimits[1]),this.forwardDir=i.forwardDirection??"-z",this.isFirstPerson&&(this.forwardDir="-z"),this.runMultiplier=i.runMultiplier??2;let p=i.navmesh.destinationHelperRadius*2;if(p>0){let m=new Xt;m.push({fi:0,data:{...Jn.defaultData("light","phong"),alpha:0},id:"layer1"}),m.push({fi:0,data:{...Jn.defaultData("color"),color:i.navmesh.destinationHelperColor,alpha:i.navmesh.destinationHelperColor.a},id:"layer2"});let v=new mB({layers:m},{scene:this.page.scene,shared:this.sharedAssets});this.navMeshPathDest=new zr(LY.create({parameters:{width:p,height:p/10,hollow:.7}}),v),this.navMeshPathDest.material.userData.opacity0=i.navmesh.destinationHelperColor.a}this.activate()}reset(e=!1){if(this.object.hiddenMatrix.copy(this.hiddenMatrix0),e){this.object.updateMatrix(),this.object.updateMatrixWorld(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity();let t=new ws().setFromQuaternion(this.quaternion,"YXZ"),i=t.y;this.objectRealQuat.copy(this.quaternion),t.y=0,this.quaternion.setFromEuler(t),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),t.set(0,i,0),this.quaternion.setFromEuler(t),this.rot.setFromEuler(t),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.velocityTarget.set(0,0,0),this.velocity.set(0,0,0)}else this.object instanceof Ms?this.object.matrixAutoUpdate=!0:this.object.updateMatrix();this.cameraFollow===!0&&(this.camera.quaternion.copy(this.quat0Cam),this.camera.position.copy(this.position0Cam),this.camera.scale.copy(this.scale0Cam),this.camera.hiddenMatrix.copy(this.hiddenMatrix0Cam),this.camera.matrixAutoUpdate=!0),this.controlsManager.requestRender()}activate(){this.instantiateActions(),this.domElement.ownerDocument.addEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.addEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.addEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.addEventListener("visibilitychange",this.handleVisibilityChange)}deactivate(){this.disposeActions(),this.domElement.ownerDocument.removeEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.removeEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.removeEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.removeEventListener("visibilitychange",this.handleVisibilityChange)}dispose(){this.deactivate(),this.navMeshPathDest?.parent&&this.page.remove(this.navMeshPathDest)}instantiateActions(){let e=this.data,t=this.sharedAssets;e.gameActions!==void 0&&(this.actions={},j2.list.forEach(i=>{this.actions[i]=os({...e,disabled:!1,type:"GameControl"},e.gameActions[i],this.page,t,this.controlsManager.eventManager,this.object)})),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"),this.initialAction&&(this.initialAction=!1)}disposeActions(){this.initialAction=!1,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),Ws(this.actions.idle),Ws(this.actions.move),Ws(this.actions.run),Ws(this.actions.jump)}dispatchStartEvent(e){this.actions[e]!==void 0&&(this.actionState[e]||(this.actionState[e]=!0,this.actions[e].Transition.forEach(t=>{t.play()}),this.actions[e].Animation.forEach(t=>{t.play(this.initialAction===!1)}),this.actions[e].TimelineAnimation.forEach(t=>{t.play()}),this.actions[e].Create.forEach(t=>{t.dispatchStart()}),this.actions[e].Audio.forEach(t=>{t.dispatchGameControl("start")}),this.actions[e].Particles.forEach(t=>{t.dispatchGameControl("start")})))}dispatchStopEvent(e){this.actions[e]!==void 0&&(!this.actionState[e]||(this.actionState[e]=!1,this.actions[e].Transition.forEach(t=>{t.stop(),t.object.currentState!==null&&t.object.changeSelectedState(null,{scene:this.page.scene,shared:this.sharedAssets})}),this.actions[e].TimelineAnimation.forEach(t=>{t.stop()}),this.actions[e].Create.forEach(t=>{t.dispatchStop()}),this.actions[e].Audio.forEach(t=>{t.dispatchGameControl("stop")}),this.actions[e].Particles.forEach(t=>{t.dispatchGameControl("stop")})))}get colliderWorldPosition(){return to.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.position)}update(e,t,i){if(this.gravity<0?this.position.y<this.resetYPosition:this.position.y>this.resetYPosition)return this.reset(!0),!0;this.sharedGameControlGlobals.gamePads.forEach(this.copyVRGamePadValues);let r=(this.isFirstFrame?16.6:e)/1e3;this.isFirstFrame&&(this.isFirstFrame=!1);let n=r*60,s=!1;if(this.usePhysics&&this.collisionEnabled){let o=Io.set(0,(this.velocity.y===0?this.pixelsPerMeter*Math.max(Math.abs(this.gravity)/(10*oW),1)*(this.gravity>0?1:-1):this.velocity.y)*r,0).divideScalar(this.pixelsPerMeter),l=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter),this.colliderWorldQuat,o,this.object.rigidBody?.collider(0).shape,1,!1,16,void 0,void 0,this.object.rigidBody);if(l){this.onObject=!0,this.groundNormal.set(l.normal2.x,l.normal2.y,l.normal2.z).applyQuaternion(this.colliderWorldQuat).negate(),this.alignToGround&&this.groundTiltAdjustment(this.groundNormal),Math.acos(this.groundNormal.y)<this.slopeThresh&&(s=!0),l.collider.parent()?.bodyType()===0&&Math.acos(this.groundNormal.y)*(180/Math.PI)>45&&(this.onObject=!1);let u=l.collider.parent();this.groundYRotation=0,this.groundVelocity.set(0,0,0);for(let c of this.sharedGameControlGlobals.entitiesWithTransformAnim)if(c.rigidBody===u&&c.userData.isFollowingObj!==this.object.uuid){(c.hasNonUniformScale?c.matrixWorldRigid:c.matrixWorld).decompose(to,Yh,Io),this.groundVelocity.subVectors(to,c.prevT),this.object.getWorldPosition(Io).add(this.collider.position).sub(to),this.groundYRotation=Mc.setFromQuaternion(Yh).y-c.prevR.y,qf.copy(Io).applyAxisAngle(Cu,this.groundYRotation),this.groundVelocity.add(qf.sub(Io)).divideScalar(r);break}}else this.onObject=!1}if(this.moveMode==="walk"&&this.collisionEnabled&&(this.movementState.jump===1&&this.onObject&&(this.velocityTarget.y=this.jumpPower,this.movementState.jump=0,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("jump"),this.onObject=!1),this.onObject?this.velocityTarget.y/=2:this.velocityTarget.y+=this.gravity*n),this.moveMode==="fly"&&(this.velocityTarget.y=(this.movementState.movePosY-this.movementState.moveNegY)*this.speedTranslate),this.directionXZ.z=this.movementState.movePosZ-this.movementState.moveNegZ,this.directionXZ.x=this.movementState.movePosX-this.movementState.moveNegX,this.forwardDir==="+z"&&this.directionXZ.multiplyScalar(-1),this.directionXZ.manhattanLength()>0&&(this.path=[]),this.navMeshPathDest){let o=this.navMeshPathDest.material;if(this.moveMode==="walk"&&this.path.length>1){this.navMeshPathDest.position.copy(this.path[this.path.length-1]),this.navMeshPathDest.parent||this.page.add(this.navMeshPathDest);let l=to.subVectors(this.path[1],this.position),u=Io.subVectors(this.path[1],this.path[0]);l.dot(u)<0?this.path.shift():(this.directionXZ.x=u.x,this.directionXZ.z=u.z),o.opacity=o.userData.opacity0}else o.opacity-=.05*o.userData.opacity0,this.navMeshPathDest.material.opacity<=0&&this.navMeshPathDest.parent&&this.page.remove(this.navMeshPathDest)}this.directionXZ.normalize(),this.movementState.run?this.moveForce=this.runMultiplier:this.moveForce=1,this.velocityTarget.z=this.directionXZ.z*this.speedTranslate*this.moveForce,this.velocityTarget.x=this.directionXZ.x*this.speedTranslate*this.moveForce,(this.moveMode==="walk"?this.velocityTarget.x+this.velocityTarget.z===0:this.velocityTarget.manhattanLength()===0)?this.lerpFactorPos.setScalar(this.lerpFactorPosEnd):this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.moveMode==="walk"&&(this.lerpFactorPos.y=1),this.didHit===!1&&this.pushedVelocity.manhattanLength()===0||this.usePhysics===!1?(this.velocity.x+=(this.velocityTarget.x-this.velocity.x)*(1-(1-this.lerpFactorPos.x)**n),this.velocity.y+=(this.velocityTarget.y-this.velocity.y)*(1-(1-this.lerpFactorPos.y)**n),this.velocity.z+=(this.velocityTarget.z-this.velocity.z)*(1-(1-this.lerpFactorPos.z)**n)):this.velocity.copy(this.velocityTarget),(this.moveMode==="walk"?this.velocity.x**2+this.velocity.z**2<this.speedTranslate:this.velocity.lengthSq()<this.speedTranslate)?(this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.onObject&&(this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"))):(this.dispatchStopEvent("idle"),(this.onObject||this.moveMode==="fly")&&(this.dispatchStopEvent("jump"),this.movementState.run?(this.dispatchStopEvent("move"),this.dispatchStartEvent("run")):(this.dispatchStopEvent("run"),this.dispatchStartEvent("move"))));let a=rke.copy(this.velocity);if(this.orientMode!=="none"&&this.isFirstPerson===!1){let o=Io.copy(a);o.y=0,a.set(0,a.y,o.length()*(this.forwardDir==="+z"?1:-1))}if(this.directionXZ.manhattanLength()>0&&this.orientMode!=="none"&&this.isFirstPerson===!1)if(this.orientWith==="camera"&&this.path.length<=1){let o=to;this.camera.getWorldDirection(o);let l=qf.copy(Cu).multiplyScalar(o.dot(Cu));o.sub(l);let u=Io.copy(this.directionXZ);u.x*=-1,this.rot.y=o.angleTo(u)*(o.cross(u).y>0?-1:1)+this.rotationAccumWhenOrientWithCamera}else this.rot.y=(this.path.length>1?0:this.euler.y)+Math.atan2(-this.directionXZ.z,this.directionXZ.x)+Math.PI/2*(this.forwardDir==="+z"?1:-1);if(Mc.setFromVector3(this.rot),this.moveMode==="walk"&&(Mc.x=0),a.applyEuler(Mc),s&&(Yh.setFromUnitVectors(Cu,this.groundNormal),a.applyQuaternion(Yh)),i){let o=Mc.set(0,this.vrEulerYOffset*lW,0);i.applyEuler(o),a.x+=i.x,a.z+=i.z,this.nonColliderPosOffset.elements[13]+=i.y*r}if(this.usePhysics===!0){let o=Io;this.pushedVelocity.set(0,0,0);for(let l of this.sharedGameControlGlobals.entitiesWithTransformAnim){let u=qf.setFromMatrixPosition(l.matrixWorld).sub(l.prevT).divideScalar(r).divideScalar(this.pixelsPerMeter),c=l.rigidBody.collider(0).castCollider(u,this.object.rigidBody.collider(0),to.copy(a).divideScalar(this.pixelsPerMeter),r,!1);u.multiplyScalar(this.pixelsPerMeter);let h=Xi.is(l)?l:l.object;if(c!==null&&this.lastHitObj!==h){let d;l instanceof ya&&(d=l);let p=this.sharedGameControlGlobals.entityToCollisionEvents[h.uuid];if(p)for(let m of p)m.data.target==="character"&&(m.dispatch(d),h.dispatchEvent(AO));this.lastHitObj=h}if(c!==null){this.pushedVelocity.copy(u),o.copy(c.normal1).applyQuaternion(l.quaternion);break}}if(this.pushedVelocity.manhattanLength()!==0){let l=o.dot(a);l<0&&a.addScaledVector(o,-l),a.add(this.pushedVelocity)}else a.add(this.groundVelocity)}if(this.rotDirection.y=Number(this.movementState.rotPosY)-Number(this.movementState.rotNegY),this.rotDirection.x=Number(this.movementState.rotPosX)-Number(this.movementState.rotNegX),this.rotDirection.normalize(),this.rotationMode==="normal"&&(this.movementState.rotPosX||this.movementState.rotNegX)||this.rotationMode==="steer"&&(this.movementState.rotPosX||this.movementState.rotNegX)&&(this.movementState.movePosZ||this.movementState.moveNegZ||this.moveMode==="walk")?this.rotVelocityStick.x=-this.rotDirection.x*this.speedOrbit*this.rotForce:this.rotVelocityStick.x=0,this.rotationMode==="normal"&&(this.movementState.rotPosY||this.movementState.rotNegY)||this.rotationMode==="steer"&&(this.movementState.rotPosY||this.movementState.rotNegY)&&(this.movementState.movePosZ||this.movementState.moveNegZ)?this.rotVelocityStick.y=-this.rotDirection.y*this.speedOrbit*this.rotForce:this.rotVelocityStick.y=0,this.rotVelocityTarget.subVectors(this.eulerDelta.divideScalar(r),this.rotVelocityStick),this.rotVelocityTarget.manhattanLength()===0?this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotEnd)**n):this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotStart)**n),this.euler.x+=this.rotVelocity.x*r,this.euler.y+=this.rotVelocity.y*r+this.groundYRotation,this.rotVelocityTarget.y===0&&this.directionXZ.manhattanLength()===0?this.rotationAccumWhenOrientWithCamera=0:(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.rotationAccumWhenOrientWithCamera+=this.rotVelocity.y*r),this.isFirstPerson===!1&&this.orientMode!=="none"&&this.directionXZ.manhattanLength()>0){if(this.orientMode==="radial"){this.objectToCamXZ.copy(this.objectToCamXZ0).applyAxisAngle(Cu,this.euler.y-this.euler0.y);let o=Io.copy(this.objectToCamXZ).normalize(),l=qf.copy(a).multiplyScalar(r);l.y=0;let u=l.sub(to.copy(o).multiplyScalar(l.dot(o))).cross(o).y;this.euler.y-=Math.atan2(u,this.objectToCamXZ.length())}}else this.rot.y+=this.rotVelocity.y*r+this.groundYRotation,this.rotVelocityTarget.y!==0&&(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.euler.y=this.rot.y);if(this.cameraFollow===!0&&(this.moveMode==="walk"?this.cameraXAxis==="Limit"?this.euler.x=Ot.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):this.euler.x=Ot.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset,this.PI_2+this.cameraPolarOffset):this.cameraXAxis==="Limit"&&(this.euler.x=Ot.clamp(this.euler.x,-this.PI_2,this.PI_2))),this.moveMode==="fly"?this.rot.x=this.euler.x:this.isFirstPerson&&(t?(Mc.copy(t),Mc.y=0):(Mc.copy(this.euler),Mc.y=0),this.nonColliderRotOffset.makeRotationFromEuler(Mc)),t&&(this.moveMode==="walk"?(this.rot.y=t.y,this.rot.x=0,this.rot.z=0):this.rot.setFromEuler(t),this.rot.y+=this.vrEulerYOffset*lW),Eu.setFromAxisAngle(ske,this.rot.x),Yh.setFromAxisAngle(Cu,this.rot.y),Yh.multiply(Eu),Eu.setFromAxisAngle(ake,this.rot.z),Yh.multiply(Eu),this.quaternion.copy(Yh),this.objectRealQuat.multiplyQuaternions(this.quaternion,this.objXZQuat),this.colliderWorldQuat.copy(this.objectRealQuat).multiply(this.collider.rotation),this.collisionEnabled)if(this.usePhysics){let o=Io.copy(a).multiplyScalar(r/this.pixelsPerMeter),l=null;this.didHit=!1;let u=new H;for(let c=0;c<5;c++){let h=o.length(),d=qf.copy(o).normalize();if(l=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(u),this.colliderWorldQuat,d,this.object.rigidBody?.collider(0).shape,h,!1,24,void 0,void 0,this.object.rigidBody),l!==null){this.didHit=!0;let p=this.sharedGameControlGlobals.colliderToEntity.get(l.collider.handle);if(p!==this.lastHitObj&&c===0){this.lastHitObj=p;let w=this.sharedGameControlGlobals.entityToCollisionEvents[p?.uuid];if(w){for(let S of w)if(S.data.target==="character"){let _=(this.sharedGameControlGlobals.rapierWorld?.getCollider(l.collider.handle))._parent,A;if(p.cloner){for(let C of p.cloner.children)if(C.rigidBody===_){A=C;break}}S.dispatch(A),p.dispatchEvent(AO)}}}let m=rW.set(l.normal2.x,l.normal2.y,l.normal2.z).applyQuaternion(this.colliderWorldQuat),v=nW.copy(d).multiplyScalar(l.toi).dot(m),g=l.toi;if(g===0&&(this.position.y+=this.offset*this.pixelsPerMeter),v>this.offset&&(g=l.toi*(v-this.offset)/v,u.addScaledVector(d,g)),o.copy(d).multiplyScalar(h-g),Math.acos(-m.y)>this.slopeThresh){let w=this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(u),S=qf.copy(l.witness2).applyQuaternion(this.colliderWorldQuat);S.y=0;let _=w.add(S);_.y+=this.stepThresh;let A=this.sharedGameControlGlobals.rapierWorld.castShape(_,this.colliderWorldQuat,o,this.object.rigidBody?.collider(0).shape,1,!1,24,void 0,void 0,this.object.rigidBody);A!==null&&A.toi===0&&(m.y=0,m.normalize())}o.addScaledVector(m,-o.dot(m))}else{c===0&&this.directionXZ.manhattanLength()!==0&&(this.lastHitObj=null),u.add(o);break}}this.position.addScaledVector(u,this.pixelsPerMeter),this.object.rigidBody?.setTranslation(to.copy(this.position).divideScalar(this.pixelsPerMeter),!0),this.object.rigidBody?.setRotation(Eu.copy(this.quaternion).premultiply(this.groundTilt).multiply(this.objXZQuat),!0)}else{let o=this.onObject?1:5,l=a.multiplyScalar(r/o);for(let u=0;u<o;u++)this.position.add(l),this.collisionAdjustment(r/o)}else this.position.addScaledVector(a,r);if(this.moveMode==="walk"&&this.onObject&&(this.velocityTarget.y=0,this.velocity.y=0),this.quaternion.premultiply(this.groundTilt).multiply(this.objXZQuat),this.object.matrix.compose(this.position,this.quaternion,this.scale),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.multiply(this.nonColliderPosOffset).multiply(this.nonColliderRotOffset),this.quaternion.premultiply(this.groundTiltInv).multiply(this.objXZQuatInv),this.cameraFollow===!0){this.updateFollowArms();let o=this.objectToTarget.add(this.position),l=this.targetToCamera.add(o);JD.lookAt(l,o,Cu).setPosition(l),JD.decompose(this.targetPos,this.targetQuat,to),this.camera.quaternion.slerp(this.targetQuat,1-(1-this.lerpFactorRotCamera)**n),this.camera.position.lerp(this.targetPos,1-(1-this.lerpFactorPosCamera)**n),this.camera.updateMatrix(),this.camera.updateMatrixWorld(),this.cameraYAxis==="Limit"&&this.orientMode==="cartesian"&&(this.euler.y=Ot.clamp(this.euler.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel)),this.euler.x=Ot.clamp(this.euler.x,-this.PI_2+(this.cameraPolarOffset<0?this.cameraPolarOffset:0),this.PI_2+(this.cameraPolarOffset>0?this.cameraPolarOffset:0))}return this.eulerDelta.set(0,0,0),this.object.dispatchEvent(dke),this.path.length<2&&this.lastPosition.distanceToSquared(this.position)<this.threshEndTranslate&&Math.abs(this.rotVelocity.x)<this.threshEndRotVel&&Math.abs(this.rotVelocity.y)<this.threshEndRotVel&&(this.camera===void 0||this.isFirstPerson||this.lastCameraPosition.distanceToSquared(this.camera.position)<this.threshEndTranslate&&8*(1-this.lastCameraQuaternion.dot(this.camera.quaternion))<this.threshEndRotate)&&(this.moveMode==="fly"||this.onObject===!0||this.collisionEnabled===!1)&&(this.navMeshPathDest===null||this.navMeshPathDest.material.opacity<-.04*this.navMeshPathDest?.material?.userData.opacity0)?!1:(this.camera&&(this.lastCameraPosition.copy(this.camera.position),this.lastCameraQuaternion.copy(this.camera.quaternion)),this.lastPosition.copy(this.position),this.object.dispatchEvent(hke),!0)}updateFollowArms(){this.objectToTarget.copy(this.objectToTarget0),this.targetToCamera.copy(this.targetToCamera0);let e=Eu.setFromAxisAngle(Cu,this.cameraYAxis==="Limit"&&this.orientMode!=="radial"?Ot.clamp(this.euler.y-this.euler0.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel):this.euler.y-this.euler0.y);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&this.objectToTarget.applyQuaternion(e);let t;this.cameraXAxis==="Limit"?t=Ot.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):t=Ot.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset+1e-6,this.PI_2+this.cameraPolarOffset-1e-6);let i=to.copy(this.cameraPolarAxis0);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&i.applyQuaternion(e);let r=Yh.setFromAxisAngle(i,t);this.cameraYAxis!=="Locked"&&this.targetToCamera.applyQuaternion(e),this.cameraXAxis!=="Locked"&&this.targetToCamera.applyQuaternion(r)}groundTiltAdjustment(e){Cu.angleTo(e)*180/Math.PI<15||Cu.angleTo(e)*180/Math.PI>85?Eu.identity():Eu.setFromUnitVectors(Cu,e),this.groundTilt.slerp(Eu,.06),this.groundTiltInv.copy(this.groundTilt).invert()}collisionAdjustment(e){let t=nW.set(0,0,0);this.object.matrix.compose(this.position,this.quaternion,this.scale);let i=JD.multiplyMatrices(this.object.matrix,this.objXZRotMat).multiply(this.collider.matrix).decompose(to,Eu,Io).compose(to,Eu,aW);this.sharedGameControlGlobals.entitiesWithTransformAnim.forEach(n=>{if(n===this.object||n.isDescendantOf(this.object))return;Rl.makeEmpty(),n.updateMatrixWorldSVD();let s=n.matrixWorldRigid,a=sW.copy(s).invert(),o=nke.copy(sW).multiply(i);ks.copy(this.collider.segment),ks.start.applyMatrix4(o),ks.end.applyMatrix4(o);let l=rW.copy(this.position).applyMatrix4(a);Rl.expandByPoint(ks.start),Rl.expandByPoint(ks.end),Rl.min.addScalar(-this.collider.radius),Rl.max.addScalar(this.collider.radius),n.bvhGeometry.boundsTree.shapecast({traverseBoundsOrder(u){return u.distanceToPoint(ks.end)},intersectsBounds:u=>u.intersectsBox(Rl),intersectsTriangle:u=>{let c=to,h=Io,d=u.closestPointToSegment(ks,c,h);if(d<this.collider.radius){let p=this.collider.radius-d,m=h.sub(c).normalize(),v=qf.copy(l);v.addScaledVector(m,p);let g=v.applyMatrix4(s).sub(this.position);t.add(g),ks.start.addScaledVector(m,p),ks.end.addScaledVector(m,p)}}})}),Rl.makeEmpty(),ks.copy(this.collider.segment),ks.start.applyMatrix4(i),ks.end.applyMatrix4(i),Rl.expandByPoint(ks.start),Rl.expandByPoint(ks.end),Rl.min.addScalar(-this.collider.radius),Rl.max.addScalar(this.collider.radius),this.sharedGameControlGlobals.staticMeshBVH?.shapecast({traverseBoundsOrder(n){return n.distanceToPoint(ks.end)},intersectsBounds:n=>n.intersectsBox(Rl),intersectsTriangle:n=>{let s=to,a=Io,o=n.closestPointToSegment(ks,s,a);if(o<this.collider.radius){let l=this.collider.radius-o,u=a.sub(s).normalize();this.alignToGround&&this.groundTiltAdjustment(u),t.addScaledVector(u,l),ks.start.addScaledVector(u,l),ks.end.addScaledVector(u,l)}}}),this.onObject=Math.abs(t.y)>Math.abs(e*this.velocity.y*.25),this.onObject&&this.dispatchStopEvent("jump");let r=Math.max(0,t.length()-1e-5);t.normalize().multiplyScalar(r),this.position.add(t)}pause(){this.firstPointerId=-1,this.movementState={moveNegZ:0,movePosZ:0,moveNegX:0,movePosX:0,moveNegY:0,movePosY:0,rotPosX:0,rotNegX:0,rotPosY:0,rotNegY:0,jump:0,run:0},this.deactivate()}resume(){this.activate()}},ZK=SO;ZK.isLocked=!1;var fke=Hp(H7());function JK(e){let t=e.elements,i=t[0]**2+t[1]**2+t[2]**2,r=t[4]**2+t[5]**2+t[6]**2,n=t[8]**2+t[9]**2+t[10]**2,s=t[0]**2+t[4]**2+t[8]**2,a=t[1]**2+t[5]**2+t[9]**2,o=t[2]**2+t[6]**2+t[10]**2,l=1e-8;return i<l||r<l||n<l||s<l||a<l||o<l}function ad(e,t){let i=new Kt;if(t&&JK(t))return i.setAttribute("position",new kt([],3)),i.setIndex([]),i;if(!e.getAttribute("position"))return i.setAttribute("position",new kt([],3)),i.setIndex([]),i;let{positions:r,triIndices:n}=cT(e.getAttribute("position"),e.getIndex());return i.setAttribute("position",new kt(r,3)),i.setIndex(n),t&&i.applyMatrix4(t),i}var pke=new yt,mke=new yt,Ac=[[0,0,0],[0,0,0],[0,0,0]];function $K(e){let t=e.elements;Ac[0][0]=t[0],Ac[0][1]=t[4],Ac[0][2]=t[8],Ac[1][0]=t[1],Ac[1][1]=t[5],Ac[1][2]=t[9],Ac[2][0]=t[2],Ac[2][1]=t[6],Ac[2][2]=t[10];let{u:i,v:r}=(0,fke.SVD)(Ac),n=pke.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1),s=mke.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1);return n.multiply(s.transpose())}var gke=class extends kq{constructor(){super(),this.layers.enable(3),this.layers.enable(8),this.layers.enable(9)}setFromCamera(e,t){t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):t.isPerspectiveCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):console.error("Raycaster: Unsupported camera type.")}intersectVisibleObjects(e,t=!0,i=[]){return e.forEach(r=>{r.visible&&this.intersectObject(r,t,i)}),i}createRaycastLineHelper(){let e=new Gp({color:65280,linewidth:10}),t=new H(this.ray.origin.x,this.ray.origin.y,this.ray.origin.z),i=new H(this.ray.direction.x,this.ray.direction.y,this.ray.direction.z),r=this.camera.far-this.camera.near,n=new H().addVectors(t,i.multiplyScalar(r)),s=new Kt;return s.setFromPoints([t,n]),new c2(s,e)}},eZ=e=>e instanceof Zy||e instanceof Jy;function vke(e,t){return e.distance-t.distance}function tZ(e,t,i){if(!(!sd(t)||!t.visible)){Bc(t)&&t.raycast(e,i);for(let r of t.children)tZ(e,r,i)}}function XE(e,t,i,r=!1){if(!r&&!i.some(s=>cC(e,s)!==void 0))return[];let n=[];return t.children.forEach(s=>tZ(e,s,n)),n.sort(vke),n}function MO(e){let t=[];if(e.length){let i=e[0].object;sd(i)&&t.push(i);let r=i.parent;for(;r;)eZ(r)&&t.push(r),r=r.parent}return t}function od(e,t,i,r){let n=e.frame;if(n){let s=t[0]*n.width,a=(1-t[1])*n.height;for(let o of i){let l=o===n.uuid?n:n.find(o);if(l?.intersects(s,a))return r(l),!0}}return!1}function cC(e,t){if(Bc(t)){if(t.visible){let i=[];return t.raycast(e,i),i.length?i[0]:void 0}}else if(eZ(t))return iZ(e,t)}function iZ(e,t){if(!(!sd(t)||!t.visible)){if(Bc(t)){let i=[];if(t.raycast(e,i),i.length)return i[0]}for(let i of t.children){let r=iZ(e,i);if(r)return r}}}function yke(e,t,i){return{x:(e-(i.left+window.scrollX))/i.width*2-1,y:-((t-(i.top+window.scrollY))/i.height)*2+1}}function xke(e,t,i){return{x:(e-(i.left+window.scrollX))/i.width,y:1-(t-(i.top+window.scrollY))/i.height}}var wke=class{constructor(e,t,i,r,n,s,a,o){this.renderer=e,this.publish=t,this.scene=i,this.getCamera=r,this.sharedAssets=n,this.requestRender=s,this.isExport=a,this.frame=o,this.raycaster=new gke,this._useWindowEvents=!1,this.pointerWorld={x:0,y:0},this.pointerScreen={x:0,y:0},this._useWindowEvents=t.mouseEventTarget==="window",this.domElement=e.domElement,this.eventElement=this._useWindowEvents?window:e.domElement,this._domRect=this.domElement.getBoundingClientRect()}get stopRaycast(){return this.publish.stopRaycast}get page(){return this.scene.activePage}set useWindowEvents(e){this._useWindowEvents=e,this.eventElement=e?window:this.renderer.domElement}get useWindowEvents(){return this._useWindowEvents}set domRect(e){this._domRect=e}get domRect(){return this._domRect}updateRaycaster(e){let{pageX:t,pageY:i}=e.touches?.length>0?e.touches[0]:e;this.pointerWorld=yke(t,i,this._domRect),this.pointerScreen=xke(t,i,this._domRect),this.raycaster.setFromCamera(this.pointerWorld,this.getCamera())}},Va=class{constructor(e){this.eventContext=e,this.domEventsNeeded=new Set,this.hasVideoAction=!1}connect(){}disconnect(){}},zB=[["start","Start"],["keyDown","KeyDown"],["keyUp","KeyUp"],["mouseDown","MouseDown"],["mouseUp","MouseUp"],["mouseHover","MouseHover"],["collision","Collision"],["lookAt","LookAt"],["follow","Follow"],["scroll","Scroll"]],rZ=e=>zB.find(([t,i])=>i===e)?.[0],eS=e=>zB.find(([t])=>t===e)?.[1],bke=(e,t)=>{let i=rZ(e);if(i){let r=new CustomEvent(i,{bubbles:!0});return Object.defineProperty(r,"target",{writable:!1,value:t}),r}},_ke=class extends Va{constructor(){super(...arguments),this.objectsPerEvents=new Map,this.splineEvents={},this.onBeginEvent=e=>{if(!e.eventName||!e.target||e.eventName==="Scroll")return;let t=this.splineEvents[rZ(e.eventName)]?.[e.target.uuid];if(!t)return;e.eventName==="Scroll"&&e.deltaY!==void 0&&Object.assign(t,{deltaY:e.deltaY});let{domElement:i}=this.eventContext;i.dispatchEvent(t)}}connect(){let{page:e}=this.eventContext;e.traverseEntity(t=>{if(t.data?.events.length){for(let[i,r]of zB)if(t.data.events.some(n=>n.data.type===r&&!n.data.disabled)){this.objectsPerEvents.has(i)?this.objectsPerEvents.get(i)?.push(t):this.objectsPerEvents.set(i,[t]);let n={id:t.uuid,name:t.name},s=bke(r,n),a=this.splineEvents[i];a?a[t.uuid]=s:this.splineEvents[i]={[t.uuid]:s}}}}),this.objectsPerEvents.forEach(t=>{t.forEach(i=>{i.addEventListener("beginEvent",this.onBeginEvent)})})}disconnect(){this.objectsPerEvents.forEach(e=>{e.forEach(t=>{t.removeEventListener("beginEvent",this.onBeginEvent)})})}},Ske=class{constructor(e,t,i,r,n,s){if(this.id=e,this.data=t,this.object=i,this.entered=!1,(t.type==="KeyDown"||t.type==="KeyUp"||t.type==="KeyPress")&&!t.key)throw new Error("Missing property");this.actions=os(t,t.actions,r,n,s,i)}disconnect(){Ws(this.actions)}dispatchHeld(e){this.actions.Create.forEach(t=>{e&&t.dispatchThrottled.cancel(),t.dispatchThrottled()})}dispatch(e=!1){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.data.type==="MousePress"||this.data.type==="KeyPress"?this.entered||(this.entered=!0,this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.TimelineAnimation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent()),this.actions.Create.forEach(t=>t.dispatchStart())):(this.actions.Transition.some(t=>t.playing&&t.data.runMode!=="Toggle")||this.actions.Transition.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.SwitchCamera.some(t=>t.playing&&t.data.runMode!=="Toggle")||this.actions.SwitchCamera.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.Animation.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.TimelineAnimation.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()})),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),e===!1&&this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}dispatchRelease(){this.entered&&(this.entered=!1,this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Particles.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent()),this.actions.Create.forEach(e=>e.dispatchStop()))}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.TimelineAnimation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.TimelineAnimation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},Mke=class extends Va{constructor(e,t,i){super(e),this.eventManager=t,this.useForRaycastProperty=i,this.objectsPerTypes={MouseDown:[],MouseUp:[],MousePress:[],KeyDown:[],KeyUp:[],KeyPress:[]},this.canvasMouseEvents=[],this.eventsPerObjects={MouseDown:{},MouseUp:{},MousePress:{},KeyDown:{},KeyUp:{},KeyPress:{}},this.heldKeys={},this.heldKeysPress={},this._prevObjects=[],this.sceneInterects=null,this.onCanvasRaycast=r=>{if(this.useForRaycastProperty===!0&&this.sceneInterects===null){this.eventContext.updateRaycaster(r);let{raycaster:n,page:s}=this.eventContext,a=XE(n,s,[],!0);this.sceneInterects=a,a.length&&(this.eventContext.sharedAssets.raycastProperty={x:a[0].point.x,y:a[0].point.y,z:a[0].point.z,objX:a[0].object.matrixWorld.elements[12],objY:a[0].object.matrixWorld.elements[13],objZ:a[0].object.matrixWorld.elements[14]})}},this.onCanvasMouseDown=r=>{(r.target===this.eventContext.domElement||r.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(n=>{(n.data.type==="MouseDown"||n.data.type==="MousePress")&&(this.onCanvasRaycast(r),n.dispatch())})},this.onCanvasMouseUp=r=>{(r.target===this.eventContext.domElement||r.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(n=>{n.data.type==="MouseUp"?(this.onCanvasRaycast(r),n.dispatch()):n.data.type==="MousePress"&&n.dispatchRelease()})},this.onMouseDown=r=>{pi.length>1||(this.eventContext.updateRaycaster(r),this.handleMouseEvent("MouseDown"))},this.onMouseUp=r=>{pi.length>1||(this.eventContext.updateRaycaster(r),this.handleMouseEvent("MouseUp"))},this.onMousePressDown=r=>{pi.length>1||(this.eventContext.updateRaycaster(r),this.handleMousePressEvent())},this.onMousePressRelease=r=>{pi.length>1||(this.eventContext.updateRaycaster(r),this.handleMousePressEvent(!0))},this.onKeyDown=r=>{this.heldKeys[r.key]||(this.handleKeyEvent(r,"KeyDown"),this.handleKeyEventHeld(r,"KeyDown",!0)),this.heldKeys[r.key]=!0},this.onKeyUp=r=>{this.handleKeyEvent(r,"KeyUp"),this.handleKeyEventHeld(r,"KeyUp",!0)},this.onKeyPressDown=r=>{this.heldKeysPress[r.key]?this.handleKeyEventHeld(r,"KeyPress"):(this.handleKeyEvent(r,"KeyPress"),this.handleKeyEventHeld(r,"KeyPress",!0)),this.heldKeysPress[r.key]=!0},this.onKeyPressUp=r=>{this.handleKeyEvent(r,"KeyPress",!0)},this.releaseHeldKey=r=>{delete this.heldKeys[r.key]},this.releaseHeldKeyPress=r=>{delete this.heldKeysPress[r.key]},this._onUserEvent=({eventName:r,target:n,reverse:s})=>{if(!r||!n)return;let a=eS(r);a&&(a==="MouseDown"||a==="MouseUp"||a==="MousePress"?(n.dispatchEvent({type:"beginEvent",eventName:a}),this.eventsPerObjects[a]?.[n.uuid]?.forEach(o=>{o.dispatchUserEvent(s)}),this.canvasMouseEvents.forEach(o=>{o.dispatchUserEvent(s)})):(a==="KeyDown"||a==="KeyUp"||a==="KeyPress")&&(n.dispatchEvent({type:"beginEvent",eventName:a}),this.eventsPerObjects[a]?.[n.uuid]?.forEach(o=>{o.dispatchUserEvent()})))}}connect(){let{page:e,sharedAssets:t,domElement:i}=this.eventContext,r=(n,s)=>{if(!n.data?.events.length)return;let a=["MouseDown","MouseUp","MousePress","KeyDown","KeyUp","KeyPress"];for(let o of a){let l=this.eventsPerObjects[o];if(n.data.events.filter(({data:u})=>u.type===o&&u.disabled!==!0).forEach(({id:u,data:c})=>{try{let h=new Ske(u,c,n,e,t,this.eventManager);h.actions.Video.length&&(this.hasVideoAction=!0),(c.type==="MouseDown"||c.type==="MouseUp"||c.type==="MousePress")&&(c.mode==="Canvas"||c.mode==="Window")?this.canvasMouseEvents.push(h):(l[n.uuid]?l[n.uuid].some(d=>d.id===h.id)||l[n.uuid].push(h):l[n.uuid]=[h],n instanceof Zg&&n.traverseChildren(d=>{if(!d.visible)return!0;d instanceof kn&&"shapeBlendNode"in d.data.geometry&&d.data.geometry.shapeBlendNode?.operation!==2&&(l[d.uuid]?l[d.uuid].push(h):l[d.uuid]=[h])}))}catch{}}),l[n.uuid]?.length&&(this.objectsPerTypes[o].push(n instanceof qs&&(o==="MouseDown"||o==="MouseUp"||o==="MousePress")?s:n),n instanceof Zg)){let u=this.objectsPerTypes[o];n.traverseChildren(c=>{if(!c.visible)return!0;c instanceof kn&&u.indexOf(c)===-1&&u.push(c)})}}};e.traverseEntity(n=>{(n instanceof ka||n instanceof Ns)&&n.frame?.traverse(s=>{r(s,n)}),r(n)}),this.heldKeys={},this.heldKeysPress={},this.domEventsNeeded.clear(),i.addEventListener("pointerdown",this.onCanvasMouseDown),i.addEventListener("pointerup",this.onCanvasMouseUp),(this.objectsPerTypes.MouseDown?.length||this.useForRaycastProperty)&&(this.domEventsNeeded.add("pointerdown"),i.addEventListener("pointerdown",this.onMouseDown)),this.objectsPerTypes.MouseUp?.length&&(this.domEventsNeeded.add("pointerup"),i.addEventListener("pointerup",this.onMouseUp)),this.objectsPerTypes.MousePress?.length&&(this.domEventsNeeded.add("pointerdown"),i.addEventListener("pointerdown",this.onMousePressDown),this.domEventsNeeded.add("pointerup"),i.addEventListener("pointerup",this.onMousePressRelease)),this.objectsPerTypes.KeyDown?.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.releaseHeldKey)),this.objectsPerTypes.KeyUp?.length&&(this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyUp)),this.objectsPerTypes.KeyPress?.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyPressDown),document.addEventListener("keyup",this.releaseHeldKeyPress),this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyPressUp)),Object.entries(this.objectsPerTypes).forEach(([n,s])=>{s.forEach(a=>{a.addEventListener("userEvent",this._onUserEvent)})}),this.canvasMouseEvents.forEach(n=>{n.object.addEventListener("userEvent",this._onUserEvent)})}disconnect(){let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),this.heldKeys={},this.heldKeysPress={},e.removeEventListener("pointerdown",this.onCanvasMouseDown),e.removeEventListener("pointerup",this.onCanvasMouseUp),e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerdown",this.onMousePressDown),e.removeEventListener("pointerup",this.onMouseUp),e.removeEventListener("pointerup",this.onMousePressRelease),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("keydown",this.onKeyPressDown),document.removeEventListener("keyup",this.onKeyPressUp),document.removeEventListener("keyup",this.releaseHeldKey),Object.values(this.eventsPerObjects).forEach(t=>{Object.values(t).forEach(i=>{i.forEach(r=>{r.disconnect()})})}),this.canvasMouseEvents.forEach(t=>{t.disconnect()}),Object.entries(this.objectsPerTypes).forEach(([t,i])=>{i.forEach(r=>{r.removeEventListener("userEvent",this._onUserEvent)})}),this.canvasMouseEvents.forEach(t=>{t.object.removeEventListener("userEvent",this._onUserEvent)})}handleMouseEvent(e){let{stopRaycast:t,raycaster:i,page:r,pointerScreen:n}=this.eventContext,s=this.objectsPerTypes[e],a=s.filter(o=>!(o instanceof qs));if(!(!s.length&&!this.useForRaycastProperty)&&!(r.uiCanvas&&od(r,[n.x,n.y],Object.keys(this.eventsPerObjects[e]),o=>{this.handleObjectMouseEventDispatch(o,e)}))){if(t||this.useForRaycastProperty){let o;if(this.sceneInterects===null?o=XE(i,r,a,this.useForRaycastProperty):(o=this.sceneInterects,this.sceneInterects=null),this.useForRaycastProperty&&o.length&&(this.eventContext.sharedAssets.raycastProperty={x:o[0].point.x,y:o[0].point.y,z:o[0].point.z,objX:o[0].object.matrixWorld.elements[12],objY:o[0].object.matrixWorld.elements[13],objZ:o[0].object.matrixWorld.elements[14]}),t){let l=[o[0]?.uv?.x??0,o[0]?.uv?.y??0];MO(o).forEach(u=>{u instanceof ka&&od(u,l,Object.keys(this.eventsPerObjects[e]),c=>{this.handleObjectMouseEventDispatch(c,e)}),this.eventsPerObjects[e][u.uuid]&&this.handleObjectMouseEventDispatch(u,e)})}}t||a.forEach(o=>{let l=cC(i,o);l&&(this.handleObjectMouseEventDispatch(o,e),o instanceof ka&&od(o,[l?.uv?.x??0,l?.uv?.y??0],Object.keys(this.eventsPerObjects[e]),u=>{this.handleObjectMouseEventDispatch(u,e)}))})}}handleMousePressEvent(e=!1){let t="MousePress",i=this.objectsPerTypes[t],r=i.filter(s=>!(s instanceof qs)),n=[];if(i.length){if(!e){let{stopRaycast:s,raycaster:a,page:o,pointerScreen:l}=this.eventContext,u=!1;if(o.uiCanvas&&(u=od(o,[l.x,l.y],Object.keys(this.eventsPerObjects[t]),c=>{n.push(c)})),s&&!u){let c=XE(a,o,r);n=MO(c),c.forEach(h=>{h.object instanceof ka&&od(h.object,[h?.uv?.x??0,h?.uv?.y??0],Object.keys(this.eventsPerObjects[t]),d=>{n.push(d)})})}else r.forEach(c=>{let h=cC(a,c);h&&(n.push(c),c instanceof ka&&od(c,[h?.uv?.x??0,h?.uv?.y??0],Object.keys(this.eventsPerObjects[t]),d=>{n.push(d)}))})}this._prevObjects.length&&this._prevObjects.forEach(s=>{n.includes(s)||this.handleObjectMouseEventDispatchRelease(s,t)}),n.length&&n.forEach(s=>{this.handleObjectMouseEventDispatch(s,t)}),this._prevObjects=n}}handleObjectMouseEventDispatch(e,t){e.dispatchEvent({type:"beginEvent",eventName:t}),this.eventsPerObjects[t]?.[e.uuid]?.forEach(i=>{i.dispatch()})}handleObjectMouseEventDispatchRelease(e,t){e.dispatchEvent({type:"beginEvent",eventName:t}),this.eventsPerObjects[t]?.[e.uuid]?.forEach(i=>{i.dispatchRelease()})}handleKeyEvent(e,t,i=!1){this.objectsPerTypes[t].forEach(r=>{let n=this.eventsPerObjects[t][r.uuid];n.some(({data:s})=>"key"in s&&s.key===e.key)&&r.dispatchEvent({type:"beginEvent",eventName:t}),n.forEach(s=>{"key"in s.data&&s.data.key===e.key&&(i?s.dispatchRelease():s.dispatch(!0))})})}handleKeyEventHeld(e,t,i=!1){this.objectsPerTypes[t].forEach(r=>{this.eventsPerObjects[t][r.uuid].forEach(n=>{"key"in n.data&&n.data.key===e.key&&n.dispatchHeld(i)})})}},Ake=new H,Eke=new H,nZ=class{constructor(e,t,i,r,n){this.actionsIn=os(e,e.inActions,i,r,n,t),this.actionsOut=os(e,e.outActions,i,r,n,t)}disconnect(){Ws(this.actionsIn),Ws(this.actionsOut)}},Cke=class extends nZ{constructor(e,t,i,r,n,s){super(t,i,r,n,s),this.id=e,this.data=t,this.object=i,this.stage="out",this.objects=[],this.onUpdateMatrixWorld=()=>{for(let d of this.objects)if(!d.visible)return;let u=Ake.setFromMatrixPosition(this.objects[0].matrixWorld),c=Eke.setFromMatrixPosition(this.objects[1].matrixWorld),h=u.distanceTo(c)<=this.distance?"in":"out";if(this.stage!==h){this.stage=h;let d=h==="in"?this.actionsIn:this.actionsOut;d.Audio.forEach(p=>p.dispatchConditional()),d.Particles.forEach(p=>p.dispatchConditional()),d.Video.forEach(p=>p.dispatchConditional()),d.Link.forEach(p=>p.dispatch()),d.Create.forEach(p=>p.dispatch()),d.Destroy.forEach(p=>p.dispatch()),d.Reset.forEach(p=>p.dispatch()),d.Transition.forEach(p=>{p.object.currentTransitionEvent!==this&&(p.object.currentTransitionEvent=this),p.init()}),d.Transition.forEach(p=>p.play()),d.Animation.forEach(p=>p.play()),d.TimelineAnimation.forEach(p=>p.play()),d.SwitchCamera.forEach(p=>p.play()),d.SceneTransition.forEach(p=>p.dispatch()),d.SetVariable.forEach(p=>p.checkConditions()),d.SetVariable.forEach(p=>p.dispatch()),d.DynamicVariablePlay.forEach(p=>p.dispatch()),d.ClearLocalStorage.forEach(p=>p.dispatch()),d.UserAPI.forEach(p=>p.dispatch())}};let{distance:a,fromObject:o,toObject:l}=t.condition;this.distance=a;for(let u of[o,l]){if(!u)throw new Error("Missing property");let c=r.find(u);if(!c)throw new Error("Missing property");this.objects.push(c)}}connect(){window.setTimeout(()=>{this.objects.forEach(e=>{e.addEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)}),this.onUpdateMatrixWorld()},0)}disconnect(){super.disconnect(),this.stage="out",this.objects.forEach(e=>{e.removeEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)})}},Tke=class extends nZ{constructor(e,t,i,r,n,s){super(t,i,r,n,s),this.id=e,this.data=t,this.object=i,this.onBegin=({target:l,state:u})=>{this.toState!==u&&(this.actionsOut.Audio.forEach(c=>c.dispatchConditional()),this.actionsOut.Particles.forEach(c=>c.dispatchConditional()),this.actionsOut.Video.forEach(c=>c.dispatchConditional()),this.actionsOut.Link.forEach(c=>c.dispatch()),this.actionsOut.Create.forEach(c=>c.dispatch()),this.actionsOut.Destroy.forEach(c=>c.dispatch()),this.actionsOut.Reset.forEach(c=>c.dispatch()),this.actionsIn.Transition.forEach(c=>c.pause()),this.object.currentTransitionEvent=this,this.actionsOut.Transition.forEach(c=>c.play()),this.actionsOut.Animation.forEach(c=>c.play()),this.actionsOut.TimelineAnimation.forEach(c=>c.play()),this.actionsIn.SwitchCamera.forEach(c=>c.pause()),this.actionsOut.SwitchCamera.forEach(c=>c.play()),this.actionsOut.SceneTransition.forEach(c=>c.dispatch()),this.actionsOut.SetVariable.forEach(c=>c.checkConditions()),this.actionsOut.SetVariable.forEach(c=>c.dispatch()),this.actionsOut.DynamicVariablePlay.forEach(c=>c.dispatch()),this.actionsOut.ClearLocalStorage.forEach(c=>c.dispatch()),this.actionsOut.UserAPI.forEach(c=>c.dispatch()))},this.onComplete=({target:l,state:u})=>{this.toState===u&&(this.actionsIn.Audio.forEach(c=>c.dispatchConditional()),this.actionsIn.Particles.forEach(c=>c.dispatchConditional()),this.actionsIn.Video.forEach(c=>c.dispatchConditional()),this.actionsIn.Link.forEach(c=>c.dispatch()),this.actionsIn.Create.forEach(c=>c.dispatch()),this.actionsIn.Destroy.forEach(c=>c.dispatch()),this.actionsIn.Reset.forEach(c=>c.dispatch()),this.actionsOut.Transition.forEach(c=>c.pause()),this.actionsOut.Transition.forEach(c=>c.pause()),this.object.currentTransitionEvent=this,this.actionsIn.Transition.forEach(c=>c.play()),this.actionsIn.Animation.forEach(c=>c.play()),this.actionsIn.TimelineAnimation.forEach(c=>c.play()),this.actionsOut.SwitchCamera.forEach(c=>c.pause()),this.actionsIn.SwitchCamera.forEach(c=>c.play()),this.actionsIn.SceneTransition.forEach(c=>c.dispatch()),this.actionsIn.SetVariable.forEach(c=>c.checkConditions()),this.actionsIn.SetVariable.forEach(c=>c.dispatch()),this.actionsIn.DynamicVariablePlay.forEach(c=>c.dispatch()),this.actionsOut.ClearLocalStorage.forEach(c=>c.dispatch()),this.actionsOut.UserAPI.forEach(c=>c.dispatch()))};let{condition:a}=t;if(!a.object)throw new Error("Missing property");let o=r.find(a.object)??r.scene.find2D(a.object);if(!o)throw new Error("Missing property");if(this.toObject=o,a.state&&!this.toObject.states?.[a.state])throw new Error("Missing property");this.toState=a.state}connect(){mg(this.actionsOut).forEach(e=>{this.actionsOut[e]?.length&&this.toObject.addEventListener("beginState",this.onBegin)}),mg(this.actionsIn).forEach(e=>{this.actionsIn[e]?.length&&this.toObject.addEventListener("completeState",this.onComplete)})}disconnect(){super.disconnect(),mg(this.actionsOut).forEach(e=>{this.actionsIn[e]?.length&&this.toObject.removeEventListener("beginState",this.onBegin)}),mg(this.actionsIn).forEach(e=>{this.actionsIn[e]?.length&&this.toObject.removeEventListener("completeState",this.onComplete)})}},Pke=class extends Va{constructor(e,t){super(e),this.eventManager=t,this.eventsPerConditions={Comparison:[],Distance:[],State:[]},this.hasVideoAction=!1}connect(){super.connect();let{page:e,sharedAssets:t}=this.eventContext;e.traverseEntity(i=>{if(i.data?.events.length){for(let{id:r,data:n}of i.data.events)if(!n.disabled&&n.type==="Conditional")try{let s;n.condition.type==="Comparison"||(n.condition.type==="Distance"?s=new Cke(r,n,i,e,t,this.eventManager):n.condition.type==="State"&&(s=new Tke(r,n,i,e,t,this.eventManager))),s&&(this.eventsPerConditions[n.condition.type].push(s),(s.actionsIn.Video.length||s.actionsOut.Video.length)&&(this.hasVideoAction=!0))}catch{}}}),Object.values(this.eventsPerConditions).forEach(i=>i.forEach(r=>r.connect()))}disconnect(){super.disconnect(),Object.values(this.eventsPerConditions).forEach(e=>e.forEach(t=>t.disconnect()))}},Pw=new H,Xf=new H,Hm=new H,uW=new Oo,Dke=.01,fr=new H,vs=new H,cW=new H,bg=new xi,$D=new ws,Rke=new yt,eR=new rs,sy=new H,Ec=new H,ay=.2;function tR(e,t){!t||(t[0]<t[1]&&(e.x=Math.min(Math.max(e.x,t[0]),t[1])),t[2]<t[3]&&(e.y=Math.min(Math.max(e.y,t[2]),t[3])),t[4]<t[5]&&(e.z=Math.min(Math.max(e.z,t[4]),t[5])))}var Ike=(function(){let e=new yt;return(t,i,r)=>{let n=t.obj;e.copy(n.hiddenMatrix),n.parent!==null&&e.premultiply(n.parent.matrixWorld),e.invert(),n.position.copy(i),t.reference==="global"&&tR(n.position,t.limits),n.position.applyMatrix4(e),t.reference==="parent"?tR(n.position,t.limits):t.reference==="local"&&(bg.copy(t.quat0).invert(),n.position.sub(t.position0),n.position.applyQuaternion(bg),tR(n.position,t.limits),bg.invert(),n.position.applyQuaternion(bg),n.position.add(t.position0)),e.multiply(r??n.matrixWorld).decompose(fr,n.quaternion,vs),n.updateMatrix(),n.hasNonUniformScale&&(n.updateMatrixWorld(),n.updateMatrixWorldSVD()),n instanceof xa&&wd(n.parent)&&n.invalidateDownstreamBooleanData(!0)}})(),Lke=class{constructor(e,t,i,r,n,s,a){this.object=e,this.id=t,this.data=i,this.dropDestIds=[],this.activeIdx=null,this.wasDragEventTriggered=!1,this.resetDampingFactor=this.data.resetSpeed===0?1:8/this.data.resetSpeed+1,this.snapDampingFactor=this.data.snapSpeed===0?1:8/this.data.snapSpeed+1,this.actionsDrag=os(i,i.dragDropActions.drag,r,n,s,this.object),this.actionsDrop=os(i,i.dragDropActions.drop,r,n,s,this.object);let o=[];this.data.objects.forEach(l=>{let u=r.find(l);!u||u.data.visible!==!1&&(o.push(u),a[u.uuid]&&a[u.uuid].forEach(c=>{let h=r.find(c);!h||h.data.visible!==!1&&o.push(h)}))}),this.data.dropDestinations.forEach(l=>{let u=r.find(l);!u||u.data.visible!==!1&&(this.dropDestIds.push(u.uuid),a[u.uuid]&&a[u.uuid].forEach(c=>{let h=r.find(c);!h||h.data.visible!==!1&&this.dropDestIds.push(h.uuid)}))}),this.dragItems=o.map(l=>(this.data.planeMode==="locked"&&(l.userData.lockedPlane=!0),l.userData.worldPosition0=new H().setFromMatrixPosition(l.matrixWorld),{obj:l,fromPosition:new H().setFromMatrixPosition(l.matrixWorld),pointStart:new H,pointEnd:new H,paused:!0,currentDampingFactor:this.data.dampingFactor,reset:!1,position0:new H().copy(l.position),quat0:new xi().copy(l.quaternion),snapped:!1,orientationMatrix:new yt,limits:this.data.limits,reference:this.data.referenceFrame}))}get activeDragItem(){return this.activeIdx!==null?this.dragItems[this.activeIdx]:null}dispose(){Ws(this.actionsDrag),Ws(this.actionsDrop),this.dragItems.forEach(e=>{e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart),e.obj.recursiveBBoxNeedsUpdate=!0,e.obj.userData.lockedPlane=void 0,e.obj.position.copy(e.position0),e.obj.quaternion.copy(e.quat0),e.obj.updateMatrix()})}},Oke=class extends Va{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.lastDropDestination=null,this.dragTimeout=null,this.onPointerDown=i=>{if(pi.length>1)return;this.eventContext.updateRaycaster(i);let{raycaster:r,page:n}=this.eventContext,s=n.raycastWithClones(r);if(this.lastDropDestination=null,s.length===0){this.activeEvent=null;return}for(let a of this.events){let o=0;for(let{obj:l,pointEnd:u,pointStart:c}of a.dragItems){if(l===s[0].object||l===s[0].object.object||Xi.is(l)&&l.isAncestorOf(s[0].object.uuid)){if(a.activeIdx=o,a.activeDragItem.reset=!1,a.activeDragItem.currentDampingFactor=a.data.dampingFactor,a.activeDragItem.snapped=!1,a.data.cursor==="hand"&&this.setCursor("grabbing"),this.eventManager.controlsManager.usePhysics){a.activeDragItem.obj.rigidBody&&a.activeDragItem.obj.rigidBody.setBodyType(2,!0);let h=a.activeDragItem.obj;l.hasNonUniformScale&&l.updateMatrixWorldSVD(),(h.hasNonUniformScale?h.matrixWorldRigid:h.matrixWorld).decompose(fr,bg,vs),$D.setFromQuaternion(bg),h.prevR===void 0?(h.prevR=$D.clone(),h.prevT=fr.clone()):(h.prevR.copy($D),h.prevT.copy(fr)),this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.push(a.activeDragItem.obj)}this.calcPlaneIntersectPos(l,c,a.data.plane,a.data.referenceFrame),u.copy(c),(this.eventManager.controlsManager.usePhysics&&l.data.physics?.rigidBody==="dynamic"||a.data.drop===!1||a.data.resetOnSnapFail===!1)&&a.activeDragItem.fromPosition.setFromMatrixPosition(a.activeDragItem.obj.matrixWorld),this.activeEvent=a,this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1);return}o++}}this.activeEvent=null},this.onPointerMove=i=>{if(pi.length>1)return;this.eventContext.updateRaycaster(i);let{raycaster:r,page:n}=this.eventContext,s=n.raycastWithClones(r);if(pi.length===0){let a=!1;for(let o of this.events){for(let{obj:l}of o.dragItems)if(l===s[0]?.object||l===s[0]?.object?.object||Xi.is(l)&&l.isAncestorOf(s[0]?.object.uuid)){switch(a=!0,o.data.cursor){case"hand":this.setCursor("grab");break;case"move":this.setCursor("move");break}break}if(a)break}a||this.setCursor("default");return}if(this.activeEvent&&this.activeEvent.activeDragItem){let a=this.activeEvent.activeDragItem;a.snapped=!1;let o;if(this.activeEvent.data.drop&&(o=s.filter(l=>a.obj!==l.object&&!a.obj.isAncestorOf(l.object.uuid)&&!(l.object instanceof Zy)&&(this.activeEvent.data.dropOn==="all"||this.activeEvent.dropDestIds.some(u=>u===l.object.uuid||n.scene.find(u).isAncestorOf(l.object.uuid))))[0]),o){let l=cW.copy(o.face.normal).applyMatrix3(eR.getNormalMatrix(o.object.matrixWorld));if(this.activeEvent.data.snapTo==="center")a.fromPosition.setFromMatrixPosition(o.object.matrixWorld);else if(this.activeEvent.data.snapTo==="surface"){if(a.fromPosition.copy(o.point),this.activeEvent.data.snapSurfaceMode==="bbox"){fr.copy(l).applyMatrix3(eR.setFromMatrix4(a.obj.matrixWorld).transpose());let u=a.obj;fr.x>ay?vs.x=-u.recursiveBBox.min.x:fr.x<-ay&&(vs.x=-u.recursiveBBox.max.x),fr.y>ay?vs.y=-u.recursiveBBox.min.y:fr.y<-ay&&(vs.y=-u.recursiveBBox.max.y),fr.z>ay?vs.z=-u.recursiveBBox.min.z:fr.z<-ay&&(vs.z=-u.recursiveBBox.max.z),vs.applyMatrix3(eR.invert())}else vs.copy(l).multiplyScalar(this.activeEvent.data.snapSurfaceOffset);a.fromPosition.add(vs)}this.activeEvent.data.autoOrient&&(fr.set(0,1,0).cross(l),fr.length()<1e-4&&fr.set(-1,0,0).cross(l),vs.crossVectors(cW,fr),a.orientationMatrix.makeBasis(fr,vs,l)),a.pointStart.copy(a.fromPosition),a.pointEnd.copy(a.pointStart),a.currentDampingFactor=this.activeEvent.snapDampingFactor,a.snapped=!0,this.lastDropDestination!==o.object&&(this.lastDropDestination=o.object,this.activeEvent.actionsDrop.Transition.forEach(u=>{u.play()}),this.activeEvent.actionsDrop.Animation.forEach(u=>{u.play()}),this.activeEvent.actionsDrop.Audio.forEach(u=>{u.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Particles.forEach(u=>{u.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Create.forEach(u=>{u.dispatchThrottled()}))}else a.orientationMatrix.makeRotationFromQuaternion(a.quat0),this.lastDropDestination=null,a.currentDampingFactor=this.activeEvent.data.dampingFactor,this.calcPlaneIntersectPos(a.obj,a.pointEnd,this.activeEvent.data.plane,this.activeEvent.data.referenceFrame),this.activeEvent.actionsDrop.Transition.forEach(l=>{l.stop(),l.object.currentState!==null&&l.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrop.Animation.forEach(l=>{l.stop()}),this.activeEvent.actionsDrop.Audio.forEach(l=>{l.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.Particles.forEach(l=>{l.dispatchGameControl("stop")});this.activeEvent.actionsDrag.Create.forEach(l=>{l.dispatchThrottled()}),this.activeEvent.actionsDrag.SetVariable.forEach(l=>l.checkConditions()),this.activeEvent.actionsDrag.SetVariable.forEach(l=>l.dispatch()),this.activeEvent.actionsDrag.DynamicVariablePlay.forEach(l=>l.dispatch()),this.activeEvent.actionsDrag.ClearLocalStorage.forEach(l=>l.dispatch()),this.activeEvent.actionsDrag.UserAPI.forEach(l=>l.dispatch()),this.activeEvent.wasDragEventTriggered===!1&&(this.activeEvent.wasDragEventTriggered=!0,this.activeEvent.actionsDrag.Transition.forEach(l=>{l.play()}),this.activeEvent.actionsDrag.Animation.forEach(l=>{l.play()}),this.activeEvent.actionsDrag.Audio.forEach(l=>{l.dispatchGameControl("start")}),this.activeEvent.actionsDrag.Particles.forEach(l=>{l.dispatchGameControl("start")})),this.dragTimeout&&window.clearTimeout(this.dragTimeout),this.dragTimeout=window.setTimeout(()=>{!this.activeEvent||(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Audio.forEach(l=>{l.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Particles.forEach(l=>{l.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Transition.forEach(l=>{l.stop(),l.object.currentState!==null&&l.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(l=>{l.stop()}))},500),this.updateDragItem(a),a.obj.dispatchEvent({type:"requestRender"})}},this.onPointerUp=i=>{if(this.activeEvent&&this.activeEvent.activeDragItem){this.activeEvent.data.cursor==="hand"&&this.setCursor("grab");let r=this.activeEvent.activeDragItem.obj.data.physics?.rigidBody==="dynamic";this.activeEvent.activeDragItem.snapped===!1&&this.activeEvent.data.drop&&this.activeEvent.data.resetOnSnapFail&&(this.eventManager.controlsManager.usePhysics===!1||!r)&&(this.activeEvent.activeDragItem.reset=this.activeEvent.data.resetOnSnapFail,this.activeEvent.activeDragItem.paused=!1,this.activeEvent.activeDragItem.currentDampingFactor=this.activeEvent.resetDampingFactor),this.eventManager.controlsManager.usePhysics&&r&&(this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.pop(),this.activeEvent.activeDragItem.obj.rigidBody.setBodyType(0,!0),this.activeEvent.activeDragItem.paused=!0),this.activeEvent.wasDragEventTriggered===!0&&(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Transition.forEach(n=>{n.stop(),n.object.currentState!==null&&n.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(n=>{n.stop()}),this.activeEvent.actionsDrag.Audio.forEach(n=>{n.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Particles.forEach(n=>{n.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.SetVariable.forEach(n=>n.checkConditions()),this.activeEvent.actionsDrop.SetVariable.forEach(n=>n.dispatch()),this.activeEvent.actionsDrop.DynamicVariablePlay.forEach(n=>n.dispatch()),this.activeEvent.actionsDrop.ClearLocalStorage.forEach(n=>n.dispatch()),this.activeEvent.actionsDrop.UserAPI.forEach(n=>n.dispatch())),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0)}}}connect(){let e={};if(this.eventContext.page.traverseEntity(i=>{i.component&&(e[i.component.uuid]?e[i.component.uuid].push(i.uuid):e[i.component.uuid]=[i.uuid])}),this.eventContext.page.traverseEntity(i=>{i.data?.events.filter(r=>r.data.type==="DragDrop"&&!r.data.disabled).forEach(r=>{this.events.push(new Lke(i,r.id,r.data,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager,e))})}),!this.events.length)return;this.domEventsNeeded.clear(),this.domEventsNeeded.add("pointerdown");let t=this.eventContext.domElement;t.addEventListener("pointerdown",this.onPointerDown),t.addEventListener("pointermove",this.onPointerMove),t.addEventListener("pointerup",this.onPointerUp),this.domEventsNeeded.add("pointermove")}disconnect(){if(!this.events.length)return;this.domEventsNeeded.clear();let e=this.eventContext.domElement;e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointermove",this.onPointerMove),e.removeEventListener("pointerup",this.onPointerUp),this.events.forEach(t=>t.dispose())}setCursor(e){this.eventContext.domElement.style.cursor=e}onAnimationFrameDamping(){for(let e of this.events)for(let t of e.dragItems)t.paused||this.updateDragItem(t,!0)}calcPlaneIntersectPos(e,t,i,r){let{getCamera:n,raycaster:s}=this.eventContext;n().getWorldDirection(Xf),Xf.negate();let a=bg.identity();switch(r==="parent"?Rke.multiplyMatrices(e.parent.matrixWorld,e.hiddenMatrix).decompose(fr,a,vs):r==="local"&&e.matrixWorld.decompose(fr,a,vs),i){case"x":fr.set(1,0,0).applyQuaternion(a),sy.copy(Xf).cross(fr),Ec.copy(fr).cross(sy);break;case"y":fr.set(0,1,0).applyQuaternion(a),sy.copy(Xf).cross(fr),Ec.copy(fr).cross(sy);break;case"z":fr.set(0,0,1).applyQuaternion(a),sy.copy(Xf).cross(fr),Ec.copy(fr).cross(sy);break;case"xy":Ec.set(0,0,1).applyQuaternion(a);break;case"yz":Ec.set(1,0,0).applyQuaternion(a);break;case"xz":Ec.set(0,1,0).applyQuaternion(a);break;case"adaptive":Xf.angleTo(vs.set(0,1,0))>Math.PI/6?(fr.crossVectors(vs.set(0,1,0),Xf),Ec.crossVectors(fr,vs)):Ec.set(0,1,0);break;default:Ec.copy(Xf);break}Hm.setFromMatrixPosition(e.matrixWorld);let o=e.userData.lockedPlane?e.userData.worldPosition0:Hm;if(uW.setFromNormalAndCoplanarPoint(Ec,o),!!s.ray.intersectPlane(uW,t)&&(i==="x"||i==="y"||i==="z")){let l=vs.subVectors(t,o).dot(fr);t.copy(o).addScaledVector(fr,l)}}updateDragItem(e,t=!1){Hm.setFromMatrixPosition(e.obj.matrixWorld),e.reset==="current"?Pw.subVectors(e.fromPosition,Hm).divideScalar(e.currentDampingFactor):e.reset==="original"?(Pw.subVectors(e.obj.userData.worldPosition0,Hm).divideScalar(e.currentDampingFactor),e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart)):Pw.subVectors(e.pointEnd,e.pointStart).add(e.fromPosition).sub(Hm).divideScalar(e.currentDampingFactor),e.paused=e.currentDampingFactor>1?Pw.length()<Dke:!0,(this.activeEvent&&this.activeEvent.data.dampingFactor===1||t)&&Ike(e,Pw.add(Hm),this.activeEvent?.data.drop&&this.activeEvent?.data.autoOrient?e.orientationMatrix:null),e.obj.dispatchEvent({type:"beginEvent",eventName:"DragDrop"}),this.eventManager.requestRender()}},oy=new H,iR=new H,Qh=new H,Kh=new H,hW=new Oo,zke=.01,kke={type:"requestRender"},Bke=(function(){let e=new H,t=new H;return(i,r,n)=>n>0?(e.subVectors(i,r),e.length()<=n?i:t.copy(r).add(e.normalize().multiplyScalar(n))):r})(),dW=(function(){let e=new yt;return(t,i)=>{t.position.copy(i),t.parent!==null&&(e.copy(t.parent.matrixWorld).invert(),t.position.applyMatrix4(e)),e.copy(t.hiddenMatrix).invert(),t.position.applyMatrix4(e),t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD()),t instanceof xa&&wd(t.parent)&&t.invalidateDownstreamBooleanData(!0)}})(),Nke=class{constructor(e,t,i,r,n,s){this.data=e,this.id=t,this.object=i,this.paused=!1,this.currentDampingFactor=1,this.snapComplete=!1,this.isReset=!1,this.worldPosition0=new H,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...$I.defaultData,...e,...e.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},e.target===void 0||e.target==="cursor"||(this.target=r.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.resetDampingFactor=80/this.data.resetSpeed+1,this.object.getWorldPosition(this.worldPosition0),this.actions=os(e,e.actions,r,n,s,i)}},Fke=class extends Va{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.pairOfEventListeners=[],this.onMouseMove=i=>{if(!(pi.length>1)){this.eventContext.updateRaycaster(i);for(let r of this.events)r.target===void 0&&this.updateSingleEvent(r)}},this.onMouseEnter=i=>{for(let r of this.events)r.target===void 0&&(r.isReset=!1,r.currentDampingFactor=r.data.dampingFactor)},this.onMouseLeave=i=>{for(let r of this.events)r.target===void 0&&(r.data.resetOnPointerLeave&&(r.isReset=!0,r.currentDampingFactor=r.resetDampingFactor),this.updateSingleEvent(r))},this.onTargetChange=i=>()=>{this.updateSingleEvent(i)}}connect(){let{page:e}=this.eventContext;if(e.traverseEntity(r=>{let n=r.data?.events.find(s=>s.data.type==="Follow"&&!s.data.disabled);n&&(!e.data.globalPhysics.usePhysics||r.dataPatched.physics?.rigidBody!=="dynamic")&&this.events.push(new Nke(n.data,n.id,r,e,this.eventContext.sharedAssets,this.eventManager))}),!this.events.length)return;let{domElement:t,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),cl&&(this.domEventsNeeded.add("pointerdown"),t.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents||(t.addEventListener("pointerenter",this.onMouseEnter),t.addEventListener("pointerleave",this.onMouseLeave));for(let r of this.events)if(r.target!==void 0){let n=r.target,s=this.onTargetChange(r);this.pairOfEventListeners.push([n,s]),n.addEventListener("requestRender",s)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),cl&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave);for(let[i,r]of this.pairOfEventListeners)i.removeEventListener("requestRender",r);for(let i of this.events)i.paused=!0,i.isReset=!1,Ws(i.actions)}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e,!0)}updateSingleEvent(e,t=!1){this.events.forEach(a=>{a.actions.Create.forEach(o=>{o.dispatchThrottled()})});let{plane:i,limitDistance:r,limitDistanceEnabled:n}=e.data;if(e.object.getWorldPosition(Qh),e.isReset)Kh.copy(e.worldPosition0);else if(e.target)e.target.getWorldPosition(Kh);else{let{getCamera:a,raycaster:o}=this.eventContext;if(i==="custom"?(a().getWorldDirection(iR),iR.negate(),oy.copy(iR)):i==="xy"?oy.set(0,0,1):i==="xz"?oy.set(0,1,0):i==="yz"&&oy.set(1,0,0),hW.setFromNormalAndCoplanarPoint(oy,Qh),!o.ray.intersectPlane(hW,Kh))return}if(!e.isReset){if(Kh.distanceTo(e.worldPosition0)>r&&n&&e.target)if(e.snapComplete=!1,e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&e.timeoutId!==null&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,e.data.resetAfterDistanceLimit)Kh.copy(e.worldPosition0),e.currentDampingFactor=e.resetDampingFactor;else return;else if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout(()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)},e.data.snapDelay*1e3)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),e.delayFinished===!1)return}e.data.enabledTranslation[0]===!1&&(Kh.x=Qh.x),e.data.enabledTranslation[1]===!1&&(Kh.y=Qh.y),e.data.enabledTranslation[2]===!1&&(Kh.z=Qh.z);let s=Bke(Qh,Kh,e.wasOutside?0:e.data.maxDelta);if(e.currentDampingFactor>1){let a=oy.subVectors(s,Qh).divideScalar(e.currentDampingFactor);Qh.add(a),t&&dW(e.object,Qh),e.paused=a.length()<zke}else dW(e.object,s),e.paused=!0;e.object?.dispatchEvent({type:"beginEvent",eventName:"Follow"}),e.object.dispatchEvent(kke)}},Dw=new H,cE=new H,Rw=new yt,ly=new xi,Yf=new xi,Iw=new H,Lw=new H,Wm=new H,Zh=new H,rR=new Oo,Uke=1e-6,Vke={type:"requestRender"},jke={type:"changeRotation"},fW=(function(){let e=new yt;return function(t,i){t.parent!==null?e.multiplyMatrices(t.parent.matrixWorld,t.hiddenMatrix):e.copy(t.hiddenMatrix),i.premultiply($K(e).invert()),t.rotation.setFromRotationMatrix(i),t.updateMatrix(),t instanceof xa&&wd(t.parent)&&t.invalidateDownstreamBooleanData(!0)}})(),Hke=class{constructor(e,t,i,r){this.id=t,this.object=i,this.paused=!1,this.currentDampingFactor=1,this.isReset=!1,this.worldQuaternion0=new xi,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...eL.defaultData,...e,...e.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},e.target===void 0||e.target==="cursor"||(this.target=r.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.object.getWorldQuaternion(this.worldQuaternion0),isNaN(this.worldQuaternion0.x)&&(this.worldQuaternion0.x=0),isNaN(this.worldQuaternion0.y)&&(this.worldQuaternion0.y=0),isNaN(this.worldQuaternion0.z)&&(this.worldQuaternion0.z=0),isNaN(this.worldQuaternion0.w)&&(this.worldQuaternion0.w=1),this.resetDampingFactor=80/this.data.resetSpeed+1}},Wke=class extends Va{constructor(){super(...arguments),this.events=[],this.pairOfEventListeners=[],this.pairOfUserEventListeners=[],this.onMouseMove=e=>{if(!(pi.length>1)){this._lastMouseEvent=e,this.eventContext.updateRaycaster(e);for(let t of this.events)t.target===void 0&&this.updateSingleEvent(t)}},this.onMouseEnter=e=>{for(let t of this.events)t.target===void 0&&(t.isReset=!1,t.currentDampingFactor=t.data.dampingFactor)},this.onMouseLeave=e=>{for(let t of this.events)t.target===void 0&&(t.data.resetOnPointerLeave&&(t.isReset=!0,t.currentDampingFactor=t.resetDampingFactor),this.updateSingleEvent(t))},this.onScroll=e=>{if(this._lastMouseEvent){let t=new PointerEvent("pointermove",{clientX:this._lastMouseEvent.clientX,clientY:this._lastMouseEvent.clientY,bubbles:!0,cancelable:!0,view:window});this.eventContext.eventElement.dispatchEvent(t)}},this.onTargetChange=e=>()=>{this.updateSingleEvent(e)},this.createUserEventListener=e=>({eventName:t,target:i})=>{if(!t||!i)return;let r=eS(t);r&&r==="LookAt"&&this.updateSingleEvent(e)}}connect(){let{page:e}=this.eventContext;if(e.traverseEntity(r=>{let n=r.data?.events.find(s=>s.data.type==="LookAt"&&!s.data.disabled);n&&(!e.data.globalPhysics.usePhysics||r.dataPatched.physics?.rigidBody!=="dynamic")&&this.events.push(new Hke(n.data,n.id,r,e))}),!this.events.length)return;let{domElement:t,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),cl&&(this.domEventsNeeded.add("pointerdown"),t.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents?i.addEventListener("scroll",this.onScroll):(t.addEventListener("pointerenter",this.onMouseEnter),t.addEventListener("pointerleave",this.onMouseLeave));for(let r of this.events){if(r.target!==void 0){let a=this.onTargetChange(r),o=r.target;this.pairOfEventListeners.push([o,a]),o.addEventListener("requestRender",a)}let n=this.createUserEventListener(r),s=r.object;this.pairOfUserEventListeners.push([s,n]),s.addEventListener("userEvent",n)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),cl&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave),t.removeEventListener("scroll",this.onScroll);for(let[i,r]of this.pairOfEventListeners)i.removeEventListener("requestRender",r);for(let[i,r]of this.pairOfUserEventListeners)i.removeEventListener("userEvent",r);for(let i of this.events)i.paused=!0,i.isReset=!1}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e)}updateSingleEvent(e){let{tilt:t,axis:i,distance:r,plane:n,limitDistance:s,enabledRotation:a,limitDistanceEnabled:o}=e.data,{getCamera:l,raycaster:u}=this.eventContext,{object:c,target:h}=e;if(c.getWorldPosition(Iw),!e.isReset)if(e.target)e.target.getWorldPosition(Lw);else{if(n==="custom"?(l().getWorldDirection(cE),cE.negate(),rR.setFromNormalAndCoplanarPoint(cE,Iw)):(n==="xy"?Dw.set(0,0,1):n==="xz"?Dw.set(0,1,0):n==="yz"&&Dw.set(1,0,0),rR.setFromNormalAndCoplanarPoint(Dw,Iw)),!u.ray.intersectPlane(rR,Lw))return;r>0&&(n==="custom"||n===void 0)&&Lw.addScaledVector(cE,r)}if(e.isReset||(h?t==="target"?Wm.copy(h.up).applyMatrix4(Rw.extractRotation(h.matrixWorld)).normalize():a.some(d=>d===!1)?(i==="x"?(Zh.set(0,0,1),a[2]===!1&&Zh.set(0,1,0)):i==="y"?(Zh.set(1,0,0),a[0]===!1&&Zh.set(0,0,1)):(Zh.set(0,1,0),a[1]===!1&&Zh.set(1,0,0)),Wm.copy(Zh).applyQuaternion(e.worldQuaternion0).normalize()):Wm.set(0,1,0):n==="custom"?Wm.set(0,1,0):Wm.copy(Dw)),e.isReset)Yf.copy(e.worldQuaternion0);else if(Iw.distanceTo(Lw)>s&&o&&h)if(e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&e.timeoutId!==null&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,e.data.resetAfterDistanceLimit)Yf.copy(e.worldQuaternion0),e.currentDampingFactor=e.resetDampingFactor;else return;else{if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout(()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)},e.data.snapDelay*1e3)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),e.delayFinished===!1)return;Gke(Rw,Lw,Iw,Wm,i,Zh),Yf.setFromRotationMatrix(Rw),ly.setFromUnitVectors(Zh.applyQuaternion(Yf),Wm),a.some(d=>d===!1)&&t!=="target"&&Yf.premultiply(ly).normalize()}e.currentDampingFactor>1?(c.updateWorldMatrix(!0,!1),ly.setFromRotationMatrix($K(c.matrixWorld)),ly.slerp(Yf,1/e.currentDampingFactor),fW(c,Rw.makeRotationFromQuaternion(ly)),e.paused=8*(1-ly.dot(Yf))<Uke):(fW(c,Rw.makeRotationFromQuaternion(Yf)),e.paused=!0),e.object?.dispatchEvent({type:"beginEvent",eventName:"LookAt"}),c.dispatchEvent(Vke),c.dispatchEvent(jke)}},Il=new H,gs=new H,In=new H;function Gke(e,t,i,r,n,s){let a=e.elements;In.subVectors(t,i),In.lengthSq()===0&&(In.z=1),In.normalize(),gs.crossVectors(r,In),gs.lengthSq()===0&&(Math.abs(r.z)===1?In.x+=1e-4:In.z+=1e-4,In.normalize(),gs.crossVectors(r,In)),gs.normalize(),Il.crossVectors(In,gs),n==="x"?s.z===1?[gs,Il,In]=[In,gs,Il]:(gs.negate(),[gs,In]=[In,gs]):n==="y"?s.x===1?[gs,Il,In]=[Il,In,gs]:(gs.negate(),[Il,In]=[In,Il]):s.x===1&&(gs.negate(),[gs,Il]=[Il,gs]),a[0]=gs.x,a[4]=Il.x,a[8]=In.x,a[1]=gs.y,a[5]=Il.y,a[9]=In.y,a[2]=gs.z,a[6]=Il.z,a[10]=In.z}var qke=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.entered=!1,this.actions=os(t,t.actions,r,n,s,i)}disconnect(){Ws(this.actions)}dispatchEnter(){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.entered||(this.entered=!0,this.actions.TimelineAnimation.forEach(e=>e.playFromCurrent()),this.actions.Transition.forEach(e=>e.playFromCurrent()),this.actions.Animation.forEach(e=>e.play()),this.actions.Create.forEach(e=>e.dispatchStart()),this.actions.Particles.forEach(e=>e.dispatchBasic()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.SwitchCamera.forEach(e=>e.playFromCurrent()),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()))}dispatchLeave(){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.entered&&(this.entered=!1,this.actions.TimelineAnimation.forEach(e=>e.reverseFromCurrent()),this.actions.Create.forEach(e=>e.dispatchStop()),this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Particles.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent()))}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Particles.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.TimelineAnimation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.TimelineAnimation.forEach(t=>t.playFromCurrent()),this.actions.Create.forEach(t=>t.dispatch()),this.actions.Particles.forEach(t=>t.dispatchBasic()),this.actions.Destroy.forEach(t=>t.dispatch()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},Xke=class extends Va{constructor(e,t){super(e),this.eventManager=t,this.eventsPerObjects={},this.objects=[],this.objects2D=[],this._prevObjects=[],this.onMouseDown=i=>{pi.length>1||(this.eventContext.updateRaycaster(i),this.handleMouseHoverEvent())},this.onMouseUp=i=>{pi.length>1||this.handleMouseHoverEvent(!0)},this.onMouseMove=i=>{pi.length>1||(this.eventContext.updateRaycaster(i),this.handleMouseHoverEvent())},this.onUserEvent=({eventName:i,target:r,reverse:n})=>{if(!i||!r)return;let s=eS(i);s&&s==="MouseHover"&&(r.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),this.eventsPerObjects[r.uuid]?.forEach(a=>a.dispatchUserEvent(n)))}}connect(){let{page:e,sharedAssets:t}=this.eventContext,i=(n,s)=>{if(!(!n.visible||!n.data?.events.length)){for(let{id:a,data:o}of n.data.events)if(!o.disabled&&o.type==="MouseHover")try{let l=new qke(a,o,n,e,t,this.eventManager);this.eventsPerObjects[n.uuid]?this.eventsPerObjects[n.uuid].push(l):this.eventsPerObjects[n.uuid]=[l]}catch{}this.eventsPerObjects[n.uuid]?.length&&this.objects.push(n instanceof qs?s:n)}};if(e.traverseEntity(n=>{(n instanceof ka||n instanceof Ns)&&n.frame?.traverse(s=>{i(s,n)}),i(n)}),!this.objects.length)return;let{domElement:r}=this.eventContext;this.domEventsNeeded.clear(),cl&&(this.domEventsNeeded.add("pointerdown"),r.addEventListener("pointerdown",this.onMouseDown),this.domEventsNeeded.add("pointerup"),r.addEventListener("pointerup",this.onMouseUp)),this.domEventsNeeded.add("pointermove"),r.addEventListener("pointermove",this.onMouseMove),this.objects.forEach(n=>{n.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if(!this.objects.length)return;let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),cl&&(e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerup",this.onMouseUp)),e.removeEventListener("pointermove",this.onMouseMove),Object.values(this.eventsPerObjects).forEach(t=>{t.forEach(i=>{i.disconnect()})}),this.objects.forEach(t=>{t.removeEventListener("userEvent",this.onUserEvent)})}handleMouseHoverEvent(e=!1){let t=[];if(!e){let{stopRaycast:i,raycaster:r,page:n,pointerScreen:s}=this.eventContext,a=!1;if(n.uiCanvas&&(a=od(n,[s.x,s.y],Object.keys(this.eventsPerObjects),o=>{t.push(o)})),i&&!a){let o=XE(r,n,this.objects);t=MO(o),o.forEach(l=>{l.object instanceof ka&&od(l.object,[l?.uv?.x??0,l?.uv?.y??0],Object.keys(this.eventsPerObjects),u=>{t.push(u)})})}else this.objects.forEach(o=>{let l=cC(r,o);l&&(t.push(o),o instanceof ka&&od(o,[l?.uv?.x??0,l?.uv?.y??0],Object.keys(this.eventsPerObjects),u=>{t.push(u)}))})}this._prevObjects.length&&this._prevObjects.forEach(i=>{t.includes(i)||(i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),this.eventsPerObjects[i.uuid]?.forEach(r=>r.dispatchLeave()))}),t.length&&t.forEach(i=>{i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),this.eventsPerObjects[i.uuid]?.forEach(r=>r.dispatchEnter())}),this._prevObjects=t}},Yke=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.scrollCounter=0,this.actions=os(t,t.actions,r,n,s,i)}connect(){this.scrollCounter=0}disconnect(){Ws(this.actions)}dispatch(e){this.actions.Transition.forEach(r=>{r.object.currentTransitionEvent!==this&&(r.object.currentTransitionEvent=this,r.init())});let t=e>0?1:-1;this.scrollCounter+=t,this.scrollCounter=Math.min(Math.max(this.scrollCounter,0),this.data.steps);let i=this.scrollCounter/this.data.steps;this.actions.Transition.forEach(r=>r.seek(i)),this.actions.Animation.forEach(r=>r.seek(t)),this.actions.TimelineAnimation.forEach(r=>r.seek(i)),this.actions.Create.forEach(r=>r.dispatchThrottled()),this.actions.SetVariable.forEach(r=>r.checkConditions()),this.actions.SetVariable.forEach(r=>r.dispatch()),this.actions.DynamicVariablePlay.forEach(r=>r.dispatch()),this.actions.ClearLocalStorage.forEach(r=>r.dispatch()),this.actions.UserAPI.forEach(r=>r.dispatch())}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.TimelineAnimation.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>{t.playFromCurrent()}),this.actions.Animation.forEach(t=>{t.playFromCurrent()}),this.actions.TimelineAnimation.forEach(t=>{t.playFromCurrent()})),this.actions.Create.forEach(t=>t.dispatchThrottled()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},Qke=class{constructor(e,t,i,r,n,s,a){this.id=e,this.data=t,this.object=i,this.domElement=s,this.eventManager=a,this.scrollStart=0,this.scrollEnd=0,this.actions=os(t,t.actions,r,n,a,i)}getStickyParentElement(){let e=this.domElement;for(;e;){if(window.getComputedStyle(e).position==="sticky")return e;e=e.parentElement}return null}computeScrollBounds(){let e=this.getStickyParentElement(),t=e?.parentElement,i=this.domElement.getBoundingClientRect(),r={top:i.top,bottom:i.bottom,left:i.left,right:i.right,width:i.width,height:i.height};if(t){let u=t.getBoundingClientRect(),c=window.getComputedStyle(e),h=parseFloat(c.marginTop)+parseFloat(c.marginBottom),d=parseFloat(c.top),p=parseFloat(c.bottom),m=u.height-h;if(!isNaN(d))i.top===d?(r.top+=u.top-d,r.bottom+=u.top-d):i.top<0&&(r.top-=m-i.height,r.bottom-=m-i.height);else if(!isNaN(p)){let v=document.body.clientHeight??window.innerHeight,g=window.innerWidth-(document.documentElement.clientWidth??window.innerWidth);i.bottom===v-p?(r.top+=u.top-i.height+p+g,r.bottom+=u.top-i.height+p+g):i.bottom<v-p&&(r.top-=m-i.height,r.bottom-=m-i.height)}}let n=document.body,s=document.documentElement,a=window.pageYOffset||s.scrollTop||n.scrollTop,o=s.clientTop||n.clientTop||0,l=Math.round(r.top+a-o);if(this.data.startFrom==="enter"){let u=window.innerHeight,c=r.height,h=this.data.enterAnchor,d=h==="top"?u:h==="bottom"?u-c:u-c*.5;this.scrollStart=l-d}else this.scrollStart=0;this.scrollStart+=this.data.startOffset??0,this.scrollEnd=this.scrollStart+(this.data.endAfter??400),this.box=r,this.computeScroll({x:window.scrollX,y:window.scrollY})}connect(){this.computeScrollBounds()}disconnect(){Ws(this.actions)}handleResize(){this.computeScrollBounds()}get isInvalidBox(){return this.box===void 0||this.box.width===0&&this.box.height===0&&this.box.top===0&&this.box.bottom===0}computeScroll({x:e,y:t}){this.actions.Transition.forEach(n=>{n.object.currentTransitionEvent!==this&&(n.object.currentTransitionEvent=this,n.init())});let i=this.scrollEnd-this.scrollStart,r=Math.min(1,Math.max(0,(t-this.scrollStart)/i));this.actions.Transition.forEach(n=>n.seek(r)),this.actions.Animation.forEach(n=>n.seek(r)),this.actions.TimelineAnimation.forEach(n=>n.seek(r)),this.actions.Create.forEach(n=>n.dispatchThrottled()),this.actions.SetVariable.forEach(n=>n.checkConditions()),this.actions.SetVariable.forEach(n=>n.dispatch()),this.actions.DynamicVariablePlay.forEach(n=>n.dispatch()),this.actions.ClearLocalStorage.forEach(n=>n.dispatch()),this.actions.UserAPI.forEach(n=>n.dispatch())}dispatch(e){this.isInvalidBox&&this.computeScrollBounds(),this.computeScroll(e)}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.TimelineAnimation.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>{t.playFromCurrent()}),this.actions.Animation.forEach(t=>{t.playFromCurrent()}),this.actions.TimelineAnimation.forEach(t=>{t.playFromCurrent()})),this.actions.Create.forEach(t=>t.dispatchThrottled()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},Kke=class extends Va{constructor(e,t){super(e),this.managers=t,this.wheelEventsPerObject=new Map,this.scrollEventsPerObject=new Map,this.isInview=!0,this.handleResize=()=>{[...this.scrollEventsPerObject.entries()].forEach(([i,r])=>{r.forEach(n=>n.handleResize())})},this.onScroll=i=>{if(!this.isInview)return;let r={y:window.scrollY,x:window.scrollX};[...this.scrollEventsPerObject.entries()].forEach(([n,s])=>{n.dispatchEvent({type:"beginEvent",eventName:"Scroll",scroll:r}),s.forEach(a=>a.dispatch(r))})},this.onWheel=i=>{!this.isInview||i.ctrlKey||[...this.wheelEventsPerObject.entries()].forEach(([r,n])=>{r.dispatchEvent({type:"beginEvent",eventName:"Scroll",deltaY:i.deltaY}),n.forEach(s=>s.dispatch(i.deltaY))})},this.onUserEvent=({eventName:i,target:r,reverse:n})=>{if(!i||!r)return;let s=eS(i);s&&s==="Scroll"&&(r.dispatchEvent({type:"beginEvent",eventName:"Scroll"}),this.wheelEventsPerObject.get(r)?.forEach(a=>{a.dispatchUserEvent(n)}))}}connect(){let{page:e,sharedAssets:t,domElement:i,isExport:r}=this.eventContext,n=s=>{if(s.data?.events.length){for(let{id:a,data:o}of s.data.events)if(!o.disabled&&o.type==="Scroll")if(o.trigger==="load"||!r){let l=new Yke(a,o,s,e,t,this.managers);this.wheelEventsPerObject.has(s)?this.wheelEventsPerObject.get(s)?.push(l):this.wheelEventsPerObject.set(s,[l])}else{let l=new Qke(a,o,s,e,t,i,this.managers);this.scrollEventsPerObject.has(s)?this.scrollEventsPerObject.get(s)?.push(l):this.scrollEventsPerObject.set(s,[l])}}};e.traverseEntity(s=>{(s instanceof ka||s instanceof Ns)&&s.frame?.traverse(a=>{n(a)}),n(s)}),this.intersectionObserver=new IntersectionObserver(s=>{let a=s[0];a&&(this.isInview=a.isIntersecting)},{root:null}),this.intersectionObserver.observe(this.eventContext.domElement),[...this.wheelEventsPerObject.entries()].forEach(([s,a])=>{a.forEach(o=>o.connect()),s.addEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([s,a])=>{a.forEach(o=>o.connect()),s.addEventListener("userEvent",this.onUserEvent)}),[...this.wheelEventsPerObject.values()].some(s=>s.length)&&(this.domEventsNeeded.add("wheel"),window.addEventListener("wheel",this.onWheel)),[...this.scrollEventsPerObject.values()].some(s=>s.length)&&(this.domEventsNeeded.add("scroll"),window.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.handleResize))}disconnect(){window.removeEventListener("wheel",this.onWheel),window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.handleResize),this.intersectionObserver.unobserve(this.eventContext.domElement),this.domEventsNeeded.clear(),[...this.wheelEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.disconnect()),e.removeEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.disconnect()),e.removeEventListener("userEvent",this.onUserEvent)})}},Zke=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=os(t,t.actions,r,n,s,i)}disconnect(){Ws(this.actions)}dispatch(){this.actions.Transition.forEach(e=>{e.play()}),this.actions.Animation.forEach(e=>{e.play()}),this.actions.TimelineAnimation.forEach(e=>{e.play()}),this.actions.SwitchCamera.forEach(e=>{e.play()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()),this.actions.Create.forEach(e=>{e.dispatchFromStart()}),this.actions.Destroy.forEach(e=>{e.dispatchFromStart()})}dispatchAfter(e){this.actions.Audio.forEach(t=>{(t.interaction.data.triggerAfter??"any")===e&&(t.interaction instanceof wg?t.interaction.audioPlayer.play():t.interaction instanceof xO&&t.interaction.dispatch())}),this.actions.Video.forEach(t=>{let i=t.interaction.data.triggerAfter??"autoplay";i===e&&(t.interaction instanceof vp?t.interaction.play(i==="autoplay"):t.interaction instanceof _O&&t.interaction.dispatch())}),this.actions.Particles.forEach(t=>{(t.data.triggerAfter??"any")===e&&t.dispatchBasic()})}async seekVideos(e){let t=[];this.actions.Video.forEach(i=>{(i.interaction.data.triggerAfter??"autoplay")==="autoplay"&&i.interaction instanceof vp&&t.push(i.interaction.seek(e))}),await Promise.all(t)}pauseVideos(){this.actions.Video.forEach(e=>{e.interaction instanceof vp&&e.interaction.pause()})}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.TimelineAnimation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.TimelineAnimation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.Reset.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch()),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.interaction instanceof wg?t.interaction.audioPlayer.play():t.interaction instanceof xO&&t.interaction.dispatch()}),this.actions.Video.forEach(t=>{t.interaction instanceof vp?t.interaction.play():t.interaction instanceof _O&&t.interaction.dispatch()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()})}},Jke=class extends Va{constructor(e,t){super(e),this.eventManager=t,this.eventsPerObject=new Map,this.eventsAfterPerObject=new Map,this.onMouseDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.dispatchAfter("mouseDown")})})},this.onKeyDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.dispatchAfter("keyDown")})})},this.onAny=()=>{let{domElement:i,isExport:r}=this.eventContext,n=r?document:i;n.removeEventListener("pointerdown",this.onAny),n.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([s,a])=>{s.dispatchEvent({type:"beginEvent",eventName:"Start"}),a.forEach(o=>{o.dispatchAfter("any")})})},this.onSceneTransitionAudioVideoPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.actions.Audio.forEach(s=>{s.interaction instanceof wg&&s.interaction.audioPlayer.play()}),n.actions.Video.forEach(s=>{let a=s.interaction.data.triggerAfter??"autoplay";s.interaction instanceof vp&&s.interaction.play(a==="autoplay")}),n.actions.Particles.forEach(s=>{s.dispatchBasic()})})})},this.onPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.dispatchAfter("autoplay")})})},this.seekVideos=async i=>{let r=[];[...this.eventsAfterPerObject.entries()].forEach(([n,s])=>{!n.data.visible||s.forEach(a=>{r.push(a.seekVideos(i))})}),await Promise.all(r)},this.pauseVideos=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{r.forEach(n=>{n.pauseVideos()})})},this.onUserEvent=({eventName:i,target:r,reverse:n})=>{if(!i||!r)return;let s=eS(i);s&&s==="Start"&&(r instanceof qs||r.dispatchEvent({type:"beginEvent",eventName:"Start"}),this.eventsPerObject.get(r)?.forEach(a=>{a.dispatchUserEvent(n)}),this.eventsAfterPerObject.get(r)?.forEach(a=>{a.dispatchUserEvent(n)}))}}connect(){let{sharedAssets:e,page:t}=this.eventContext,i=r=>{if(r.data?.events.length)for(let{id:n,data:s}of r.data.events){if(s.disabled||s.type!=="Start")continue;let a=new Zke(n,s,r,t,e,this.eventManager);(a.actions.Transition.length||a.actions.TimelineAnimation.length||a.actions.Animation.length||a.actions.SwitchCamera.length||a.actions.Create.length||a.actions.Destroy.length||a.actions.SceneTransition.length||a.actions.Reset.length||a.actions.SetVariable.length||a.actions.DynamicVariablePlay.length||a.actions.ClearLocalStorage.length||a.actions.UserAPI.length)&&(this.eventsPerObject.has(r)?this.eventsPerObject.get(r)?.push(a):this.eventsPerObject.set(r,[a])),a.actions.Audio.length&&(this.eventsAfterPerObject.has(r)?this.eventsAfterPerObject.get(r)?.push(a):this.eventsAfterPerObject.set(r,[a])),a.actions.Video.length&&(this.hasVideoAction=!0,this.eventsAfterPerObject.has(r)?this.eventsAfterPerObject.get(r)?.push(a):this.eventsAfterPerObject.set(r,[a])),a.actions.Particles.length&&(this.eventsAfterPerObject.has(r)?this.eventsAfterPerObject.get(r)?.push(a):this.eventsAfterPerObject.set(r,[a]))}};if(t.traverseEntity(r=>{(r instanceof ka||r instanceof Ns)&&r.frame?.traverse(n=>{i(n)}),i(r)}),[...this.eventsAfterPerObject.values()].some(r=>r.length)){if(this.eventManager.activateCount===0){let{domElement:r,isExport:n}=this.eventContext,s=n?document:r;s.addEventListener("pointerdown",this.onMouseDown,{once:!0}),s.addEventListener("mousedown",this.onMouseDown,{once:!0}),document.addEventListener("keydown",this.onKeyDown,{once:!0}),s.addEventListener("pointerdown",this.onAny),s.addEventListener("mousedown",this.onAny),document.addEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([a,o])=>{a.addEventListener("userEvent",this.onUserEvent)})}else this.onSceneTransitionAudioVideoPlay();this.onPlay()}[...this.eventsPerObject.entries()].forEach(([r,n])=>{r.dispatchEvent({type:"beginEvent",eventName:"Start"}),n.forEach(s=>s.dispatch()),r.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if([...this.eventsAfterPerObject.values()].some(e=>e.length)){let{domElement:e,isExport:t}=this.eventContext,i=t?document:e;i.removeEventListener("pointerdown",this.onMouseDown),i.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("keydown",this.onKeyDown),i.removeEventListener("pointerdown",this.onAny),i.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([r,n])=>{r.removeEventListener("userEvent",this.onUserEvent),n.forEach(s=>s.disconnect())})}[...this.eventsPerObject.entries()].forEach(([e,t])=>{e.removeEventListener("userEvent",this.onUserEvent),t.forEach(i=>i.disconnect())}),this.eventsPerObject.clear(),this.eventsAfterPerObject.clear()}},$ke=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.initialDisabled=!1,this.actions=os(t,t.actions,r,n,s,i),this.target=t.target}disconnect(){Ws(this.actions)}dispatch(e){this.initialDisabled||(this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.object.dispatchEvent({type:"beginEvent",eventName:"Collision"}),this.actions.Transition.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.Animation.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.TimelineAnimation.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch(e??!1)}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch()))}},eBe=class extends Va{constructor(e,t,i,r,n){super(e),this.sharedVariables=t,this.eventManager=i,this.needsMouse=r,this.needsRaycast=n,this.dynamicVars=[],this.variablesToWatch=[],this.prevMouseProperty=null,this.prevRaycastProperty=null,this.pauseTime=0,this.isOutOfFocus=!1,this.events=[],this.onFrame=s=>{let a=this.eventContext.sharedAssets;if(this.rafId=window.requestAnimationFrame(this.onFrame),this.isOutOfFocus)return;let o=new Date,l=[],u=[];for(let d=0;d<this.propertiesToWatch.length;d++){let{objectId:p,property:m,prevValue:v}=this.propertiesToWatch[d],g=this.eventContext.scene.find(p),w=iL.propertyPaths[m];if(w[0]==="width"||w[0]==="height"||w[0]==="depth")g=g.geometry.userData.parameters[w[0]];else for(let S=0;S<w.length;S++)g=g[w[S]];v===null?this.propertiesToWatch[d].prevValue=g instanceof H?g.clone():g:(g instanceof H?!g.equals(v):v!==g)&&(u.push({objId:p,property:m}),g instanceof H?this.propertiesToWatch[d].prevValue.copy(g):this.propertiesToWatch[d].prevValue=g)}for(let d=0;d<this.variablesToWatch.length;d++){let{id:p,prevValue:m}=this.variablesToWatch[d],v=a.getVariable(p);v!==m&&(l.push(p),this.variablesToWatch[d].prevValue=v)}for(let d=0;d<this.dynamicVars.length;d++){let{id:p,expectedTime:m,last:v,data:g,timerSeconds:w,startValue:S}=this.dynamicVars[d],_=1e3;if((g.dynamicVariableType==="timer"||g.dynamicVariableType==="stopwatch")&&g.format==="number3decimal"?_=1:g.dynamicVariableType==="counter"?_=g.updateInterval:g.dynamicVariableType==="random"&&(_=g.isStatic?1/0:g.updateInterval),m===-1){this.dynamicVars[d].last=s,this.dynamicVars[d].expectedTime=s+_;continue}if(!((a.getDynamicVariablePlayState(p)==="Stopped"||a.getDynamicVariablePlayState(p)==="Restarted")&&(this.dynamicVars[d].last=s,this.dynamicVars[d].expectedTime=s+_,g.dynamicVariableType==="counter"&&a.getVariable(p)!==S&&(a.updateVariable(p,S),this.eventManager.requestRender()),(g.dynamicVariableType==="timer"||g.dynamicVariableType==="stopwatch")&&this.dynamicVars[d].timerSeconds!==S&&(this.dynamicVars[d].timerSeconds=S,a.updateVariable(p,Nl.getFormattedTimerTime(S,g)),this.eventManager.requestRender()),a.getDynamicVariablePlayState(p)==="Restarted"&&a.setDynamicVariablePlayState(p,"Playing"),a.getDynamicVariablePlayState(p)==="Stopped"))){if(a.getDynamicVariablePlayState(p)==="Paused"){this.dynamicVars[d].deltaToExpectedTime===void 0&&(this.dynamicVars[d].deltaToExpectedTime=Math.max(this.dynamicVars[d].expectedTime-s,0)),this.dynamicVars[d].last=s-(_-this.dynamicVars[d].deltaToExpectedTime),this.dynamicVars[d].expectedTime=s+this.dynamicVars[d].deltaToExpectedTime;continue}else this.dynamicVars[d].deltaToExpectedTime=void 0;if(s>=m)if(this.dynamicVars[d].last=s,this.dynamicVars[d].expectedTime+=_,g.dynamicVariableType==="random"){let A=g.min+Math.random()*(g.max-g.min),C=g.decimals;A=Math.round(A*Math.pow(10,C))/Math.pow(10,C),a.updateVariable(p,A),l.push(p),this.eventManager.requestRender()}else if(g.dynamicVariableType==="counter"){let A=a.getVariable(p),C=a.getDynamicVariableToggleIsForward(p)??!0,E=a.getVariable(p)+g.increment*(C?1:-1);g.hasEnd&&(E=g.increment>0?Ot.clamp(E,S,g.endValue):Ot.clamp(E,g.endValue,S),E===S&&a.setDynamicVariableToggleIsForward(p,void 0),g.repeat?E===g.endValue&&(E=S):(E===S||E===g.endValue)&&a.setDynamicVariablePlayState(p,"Paused")),E!==A&&(l.push(p),a.updateVariable(p,E),this.eventManager.requestRender())}else if(g.dynamicVariableType==="time"){let A=a.getVariable(p),C=Bj(o,g);if(typeof A=="object"&&"textValue"in A&&typeof C=="object"&&"textValue"in C){if(Array.isArray(A.textValue)&&Array.isArray(C.textValue)){if(A.textValue.every((E,I)=>E===C.textValue[I]))continue}else if(A.textValue===C.textValue)continue}else if(A===C)continue;a.updateVariable(p,C),l.push(p),this.eventManager.requestRender()}else{let A=va.isTextValue(g.endValue)?pW(g.endValue.textValue):g.endValue,C=a.getDynamicVariableToggleIsForward(p)??!0,E=w+(s-v)/1e3*(g.dynamicVariableType==="timer"?-1:1)*(C?1:-1);E=Math.max(E,0),g.hasEnd&&(E=g.dynamicVariableType==="stopwatch"?Ot.clamp(E,S,A):Ot.clamp(E,A,S),E===S&&a.setDynamicVariableToggleIsForward(p,void 0),g.repeat?Math.abs(E-A)<(g.format==="number3decimal"?1e-4:.1)&&(E=S):(Math.abs(E-S)<(g.format==="number3decimal"?1e-4:.1)||Math.abs(E-A)<(g.format==="number3decimal"?1e-4:.1))&&a.setDynamicVariablePlayState(p,"Paused")),E!==w&&(l.push(p),this.dynamicVars[d].timerSeconds=E,a.updateVariable(p,Nl.getFormattedTimerTime(E,g)),this.eventManager.requestRender())}}}let c=!1;a.mouseProperty!==this.prevMouseProperty&&(this.prevMouseProperty=a.mouseProperty,c=!0);let h=!1;a.raycastProperty!==this.prevRaycastProperty&&(this.prevRaycastProperty=a.raycastProperty,h=!0),this.events.forEach(d=>{(l.includes(d.data.variableId)||u.find(p=>p.objId===d.data.objectId&&p.property===d.data.property)||d.data.variableId==="mouseProperty"&&c||d.data.variableId==="raycastProperty"&&h)&&(d.dispatch(),this.eventManager.requestRender())})},this.onBlur=()=>{this.pause()},this.onFocus=()=>{this.resume()}}pause(){this.isOutOfFocus||(this.isOutOfFocus=!0,this.pauseTime=Date.now())}resume(){if(!this.isOutOfFocus)return;this.isOutOfFocus=!1;let e=Date.now()-this.pauseTime;for(let t=0;t<this.dynamicVars.length;t++)this.dynamicVars[t].last+=e,this.dynamicVars[t].expectedTime+=e}connect(){this.eventContext.page.traverseEntity(t=>{t.data?.events.filter(i=>i.data.type==="VariableChange"&&!i.data.disabled).forEach(i=>{this.events.push(new tBe(i.id,i.data,t,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.propertiesToWatch=this.events.filter(t=>t.data.variableId==="objectProperty"&&t.data.objectId!==null).map(t=>({objectId:t.data.objectId,property:t.data.property,prevValue:null}));let e=this.eventContext.sharedAssets;this.sharedVariables.forEach(({id:t,data:i})=>{if(!("dynamicVariableType"in i)){this.events.find(n=>n.data.variableId===t)&&this.variablesToWatch.push({id:t,prevValue:e.getVariable(t)});return}let r;if(i.dynamicVariableType==="timer"||i.dynamicVariableType==="stopwatch"){let n;if(va.isTextValue(i.value)&&Array.isArray(i.value.textValue)){let s=i.value.textValue;s.length===3?n=s[2]+s[1]*60+s[0]*3600:n=s[1]+s[0]*60}else n=i.value;r=n,this.dynamicVars.push({id:t,last:-1,expectedTime:-1,data:i,timerSeconds:n,startValue:r})}else i.dynamicVariableType==="time"&&e.updateVariable(t,Bj(new Date,i)),i.dynamicVariableType==="counter"&&(r=va.isTextValue(i.value)?pW(i.value.textValue):i.value),this.dynamicVars.push({id:t,last:-1,expectedTime:-1,data:i,startValue:r})}),this.rafId=window.requestAnimationFrame(this.onFrame),window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus)}disconnect(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),this.rafId&&(window.cancelAnimationFrame(this.rafId),this.rafId=void 0),this.events.forEach(e=>e.dispose())}},tBe=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=os(t,t.actions,r,n,s,i)}dispatch(){let e=this.actions;e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}dispose(){Ws(this.actions)}};function pW(e){return e.length===3?e[2]+e[1]*60+e[0]*3600:e[1]+e[0]*60}var iBe="https://unpkg.com/@splinetool/runtime@1.12.5/build/",rBe="https://unpkg.com/@splinetool/navmesh-wasm@1.12.5/build/",nBe=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import('${iBe}' + 'navmesh.js'),
		fetch('${rBe}' + 'navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,sBe=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import(self.location.origin + '/_libraries/navmesh.js'),
		fetch(self.location.origin + '/_libraries/navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,aBe=`

onmessage = function(messageEvent) {
	const meshData = messageEvent.data;
	const positions = meshData[0];
	const offset = meshData[1];
	const indices = meshData[2];
	const indicesLength = meshData[3];
	const parameters = meshData[4];

	const module = self.module;
	const rc = new module.rcConfig();
	rc.cs = parameters.cs;
	rc.ch = parameters.ch;
	rc.borderSize = parameters.borderSize ? parameters.borderSize : 0;
	rc.tileSize = parameters.tileSize ? parameters.tileSize : 0;
	rc.walkableSlopeAngle = parameters.walkableSlopeAngle;
	rc.walkableHeight = parameters.walkableHeight;
	rc.walkableClimb = parameters.walkableClimb;
	rc.walkableRadius = parameters.walkableRadius;
	rc.maxEdgeLen = parameters.maxEdgeLen;
	rc.maxSimplificationError = parameters.maxSimplificationError;
	rc.minRegionArea = parameters.minRegionArea;
	rc.mergeRegionArea = parameters.mergeRegionArea;
	rc.maxVertsPerPoly = parameters.maxVertsPerPoly;
	rc.detailSampleDist = parameters.detailSampleDist;
	rc.detailSampleMaxError = parameters.detailSampleMaxError;

	if (!self.navMesh) {
		self.navMesh = new module.NavMesh();
	}
	self.navMesh.build(positions, offset, indices, indicesLength, rc);

	const navmeshData = navMesh.getNavmeshData();
	const arrView = new Uint8Array(module.HEAPU8.buffer, navmeshData.dataPointer, navmeshData.size);
	const ret = new Uint8Array(navmeshData.size);
	ret.set(arrView);
	navMesh.freeNavmeshData(navmeshData);

	postMessage(ret);
}
`,oBe=.001,lBe={cs:6,ch:2,walkableSlopeAngle:90,walkableHeight:20,walkableClimb:5,walkableRadius:0,maxEdgeLen:12,maxSimplificationError:1.3,minRegionArea:8,mergeRegionArea:20,maxVertsPerPoly:6,detailSampleDist:6,detailSampleMaxError:1},sZ,Wi,ua;eEe.then(e=>{sZ=e,Wi=new e.Vec3,ua=new e.Vec3});var uBe=new H,cBe=class{constructor(e=!1,t=!1){this.usePhysics=e,this.isExport=t,this.onPointerDown=i=>{if(pi.length!==1)return;let{raycaster:r,page:n}=this.eventContext;this.eventContext.updateRaycaster(i);let s=n.raycastWithClones(r);if(s.length!==0){if(this.gameControl){let a=uBe.copy(this.gameControl.colliderWorldPosition);a.y-=this.gameControl.colliderHeight/2,this.gameControl.path=this.computePath(a,s[0].point)}this.eventContext.requestRender()}},this.traverseWithPhysics=(i,r)=>n=>{let s;if(n instanceof jl)if(n.objectForSample){if(n.objectForSample.dataPatched.physics.fusedBody)return;s=n.object}else return n.object.dataPatched.physics.fusedBody===!0&&n.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(n instanceof ya)s=n.object;else if(s=n,s.dataPatched.cloner?.disabled===!1&&s.dataPatched.cloner?.hideBase&&s.dataPatched.physics?.fusedBody!==!0)return!0;if(r&&!s.userData.navmesh)return;let a=s.dataPatched;if(!a.visible&&a.physics?.enabled!==!0)return!0;n.updateMatrixWorldSVD();let o=hC(a),l=s.userData.hasDestroy,u=s.userData.hasDrag,c=!1,h=!1;for(let d of a.events)d.data.disabled!==!0&&(d.data.type==="GameControl"?c=!0:d.data.type==="Follow"&&(h=!0));if(c||o||h||l||u)return!0;if(this.usePhysics&&a.physics?.rigidBody==="dynamic"){if(this.usePhysics&&a.physics?.fusedBody)return!0}else if("geometry"in n&&n.geometry&&i.push(ad(n.geometry,n.matrixWorld)),this.usePhysics&&a.physics?.fusedBody)return n.traverseObject((d,p)=>{if(p===0)return;let m;if(d instanceof jl)if(d.objectForSample){if(d.objectForSample.dataPatched.physics.fusedBody)return;m=d.object}else return d.object.dataPatched.physics.fusedBody===!0&&d.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(d instanceof ya)m=d.object;else if(m=d,d.dataPatched.cloner?.hideBase)return!0;let v=m.dataPatched;if(!v.visible&&v.physics?.enabled!==!0)return!0;"geometry"in d&&d.geometry&&i.push(ad(d.geometry,d.matrixWorld))}),!0},this.traverseNoPhysics=(i,r)=>n=>{let s;if(n instanceof jl)return;n instanceof ya?s=n.object:s=n;let a=s.dataPatched;if(a.physics.enabled==="visibility"?!a.visible:!a.physics.enabled)return!0;if(r&&!s.userData.navmesh)return;let o=n.geometry,l=s.userData.hasDestroy===!0,u=s.userData.hasDrag===!0;if(hC(a)||l||u||s.dataPatched.events.some(c=>c.data.disabled!==!0&&c.data.type==="GameControl"))return!0;o&&i.push(ad(o,n.matrixWorld))},this.navmeshWasm=sZ,this.navMesh=new this.navmeshWasm.NavMesh,this._workerURL=URL.createObjectURL(new Blob([(t?nBe:sBe)+aBe])),this._worker=new Worker(this._workerURL)}init(e,t,i){this.gameControl=t,this.eventContext=i,this.setDefaultQueryExtent(new H().setScalar(e.ch*e.walkableRadius*1.2)),this._worker.onmessage=()=>{this.createNavMesh(i.page,e,r=>{this.buildFromNavmeshData(r.data)})},this.eventContext.renderer.domElement.addEventListener("pointerdown",this.onPointerDown)}createNavMesh(e,t,i){t.objects.forEach(l=>{let u=e.scene.find(l);u.traverseEntity(c=>{c.userData.navmesh=!0}),u.cloner?.traverseObject(c=>{c.userData.navmesh=!0})});let r=[],n=(this.usePhysics?this.traverseWithPhysics:this.traverseNoPhysics)(r,t.zones==="custom");if(e.traverseChildren(n),t.objects.forEach(l=>{let u=e.scene.find(l);u.traverseEntity(c=>{c.userData.navmesh=void 0}),u.cloner?.traverseObject(c=>{c.userData.navmesh=void 0})}),r.length===0)return!1;let s=xg(r),{positions:a,triIndices:o}=cT(s.getAttribute("position"),s.getIndex());return this._worker.postMessage([a,a.length/3,o,o.length,{...lBe,...t}]),this._worker.onmessage=i,!0}createDebugNavGeometry(){let e,t,i=this.navMesh.getDebugNavMesh(),r=i.getTriangleCount(),n=new Uint32Array(r*3),s=new Float32Array(r*3*3);for(e=0;e<r*3;e++)n[e]=e;for(e=0;e<r;e++)for(t=0;t<3;t++){let o=i.getTriangle(e).getPoint(t);s[e*9+t*3+0]=o.x,s[e*9+t*3+1]=o.y,s[e*9+t*3+2]=o.z}let a=new Kt;return a.setIndex(new hi(n,1)),a.setAttribute("position",new hi(s,3)),a}getClosestPoint(e){return Wi.x=e.x,Wi.y=e.y,Wi.z=e.z,this.navMesh.getClosestPoint(Wi)}getClosestPointToRef(e,t){Wi.x=e.x,Wi.y=e.y,Wi.z=e.z;let i=this.navMesh.getClosestPoint(Wi);t.set(i.x,i.y,i.z)}getRandomPointAround(e,t){return Wi.x=e.x,Wi.y=e.y,Wi.z=e.z,this.navMesh.getRandomPointAround(Wi,t)}getRandomPointAroundToRef(e,t,i){Wi.x=e.x,Wi.y=e.y,Wi.z=e.z;let r=this.navMesh.getRandomPointAround(Wi,t);i.set(r.x,r.y,r.z)}moveAlong(e,t){return Wi.x=e.x,Wi.y=e.y,Wi.z=e.z,ua.x=t.x,ua.y=t.y,ua.z=t.z,this.navMesh.moveAlong(Wi,ua)}moveAlongToRef(e,t,i){return Wi.x=e.x,Wi.y=e.y,Wi.z=e.z,ua.x=t.x,ua.y=t.y,ua.z=t.z,this.navMesh.moveAlong(Wi,ua)}computePath(e,t){let i=this.getClosestPoint(t);if(ua.x=i.x,ua.y=i.y,ua.z=i.z,Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)+Math.pow(t.z-i.z,2))>this.getDefaultQueryExtent().y)return[];this.getClosestPoint(e);let r=this.navMesh.computePath(Wi,ua),n=r.getPointCount(),s=[];for(let a=0;a<n;a++){let o=r.getPoint(a);s.push(new H(o.x,o.y,o.z))}return s}createCrowd(e,t){return new hBe(this,e,t)}setDefaultQueryExtent(e){Wi.x=e.x,Wi.y=e.y,Wi.z=e.z,this.navMesh.setDefaultQueryExtent(Wi)}getDefaultQueryExtent(){return this.navMesh.getDefaultQueryExtent()}buildFromNavmeshData(e){let t=e.length*e.BYTES_PER_ELEMENT,i=this.navmeshWasm._malloc(t),r=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,i,t);r.set(e);let n=new this.navmeshWasm.NavmeshData;n.dataPointer=r.byteOffset,n.size=e.length,this.navMesh.buildFromNavmeshData(n),this.navmeshWasm._free(r.byteOffset)}getNavmeshData(){let e=this.navMesh.getNavmeshData(),t=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,e.dataPointer,e.size),i=new Uint8Array(e.size);return i.set(t),this.navMesh.freeNavmeshData(e),i}getDefaultQueryExtentToRef(e){let t=this.navMesh.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}dispose(){this.navMesh.destroy(),this._worker.terminate(),URL.revokeObjectURL(this._workerURL),this.eventContext?.renderer.domElement.removeEventListener("pointerdown",this.onPointerDown)}addCylinderObstacle(e,t,i){return Wi.x=e.x,Wi.y=e.y,Wi.z=e.z,this.navMesh.addCylinderObstacle(Wi,t,i)}addBoxObstacle(e,t,i){return Wi.x=e.x,Wi.y=e.y,Wi.z=e.z,ua.x=t.x,ua.y=t.y,ua.z=t.z,this.navMesh.addBoxObstacle(Wi,ua,i)}removeObstacle(e){this.navMesh.removeObstacle(e)}isSupported(){return this.navmeshWasm!==void 0}},hBe=class{constructor(e,t,i){this.navmeshWasmWrapper=e,this.transforms=[],this.agents=new Array,this.reachRadii=new Array,this._agentDestinationArmed=new Array,this._agentDestination=new Array,this.crowd=new this.navmeshWasmWrapper.navmeshWasm.Crowd(t,i,this.navmeshWasmWrapper.navMesh.getNavMesh())}onReachTarget(e,t){}addAgent(e,t,i){let r=new this.navmeshWasmWrapper.navmeshWasm.dtCrowdAgentParams;r.radius=t.radius,r.height=t.height,r.maxAcceleration=t.maxAcceleration,r.maxSpeed=t.maxSpeed,r.collisionQueryRange=t.collisionQueryRange,r.pathOptimizationRange=t.pathOptimizationRange,r.separationWeight=t.separationWeight,r.updateFlags=7,r.obstacleAvoidanceType=0,r.queryFilterType=0,r.userData=0;let n=this.crowd.addAgent(new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z),r);return this.transforms.push(i),this.agents.push(n),this.reachRadii.push(t.reachRadius?t.reachRadius:t.radius),this._agentDestinationArmed.push(!1),this._agentDestination.push(new H(0,0,0)),n}getAgentPosition(e){return this.crowd.getAgentPosition(e)}getAgentPositionToRef(e,t){let i=this.crowd.getAgentPosition(e);t.set(i.x,i.y,i.z)}getAgentVelocity(e){return this.crowd.getAgentVelocity(e)}getAgentVelocityToRef(e,t){let i=this.crowd.getAgentVelocity(e);t.set(i.x,i.y,i.z)}getAgentNextTargetPath(e){return this.crowd.getAgentNextTargetPath(e)}getAgentNextTargetPathToRef(e,t){let i=this.crowd.getAgentNextTargetPath(e);t.set(i.x,i.y,i.z)}getAgentState(e){return this.crowd.getAgentState(e)}overOffmeshConnection(e){return this.crowd.overOffmeshConnection(e)}agentGoto(e,t){this.crowd.agentGoto(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z));let i=this.agents.indexOf(e);i>-1&&(this._agentDestinationArmed[i]=!0,this._agentDestination[i].set(t.x,t.y,t.z))}agentTeleport(e,t){this.crowd.agentTeleport(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z))}updateAgentParameters(e,t){let i=this.crowd.getAgentParameters(e);t.radius!==void 0&&(i.radius=t.radius),t.height!==void 0&&(i.height=t.height),t.maxAcceleration!==void 0&&(i.maxAcceleration=t.maxAcceleration),t.maxSpeed!==void 0&&(i.maxSpeed=t.maxSpeed),t.collisionQueryRange!==void 0&&(i.collisionQueryRange=t.collisionQueryRange),t.pathOptimizationRange!==void 0&&(i.pathOptimizationRange=t.pathOptimizationRange),t.separationWeight!==void 0&&(i.separationWeight=t.separationWeight),this.crowd.setAgentParameters(e,i)}removeAgent(e){this.crowd.removeAgent(e);let t=this.agents.indexOf(e);t>-1&&(this.agents.splice(t,1),this.transforms.splice(t,1),this.reachRadii.splice(t,1),this._agentDestinationArmed.splice(t,1),this._agentDestination.splice(t,1))}getAgents(){return this.agents}update(e){if(this.navmeshWasmWrapper.navMesh.update(),e<=oBe)return;let t=1/60,i=10;{let r=Math.floor(e/t);r>i&&(r=i),r<1&&(r=1);let n=e/r;for(let s=0;s<r;s++)this.crowd.update(n)}for(let r=0;r<this.agents.length;r++){let n=this.agents[r],s=this.getAgentPosition(n);if(this.transforms[r].copy(s),this._agentDestinationArmed[r]){let a=s.x-this._agentDestination[r].x,o=s.z-this._agentDestination[r].z,l=this.reachRadii[r],u=this._agentDestination[r].y-this.reachRadii[r],c=this._agentDestination[r].y+this.reachRadii[r],h=a*a+o*o;s.y>u&&s.y<c&&h<l*l&&(this.onReachTarget(n,this._agentDestination[r]),this._agentDestinationArmed[r]=!1)}}}setDefaultQueryExtent(e){let t=new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z);this.crowd.setDefaultQueryExtent(t)}getDefaultQueryExtent(){return this.crowd.getDefaultQueryExtent()}getDefaultQueryExtentToRef(e){let t=this.crowd.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}getCorners(e){let t,i=this.crowd.getCorners(e),r=i.getPointCount(),n=[];for(t=0;t<r;t++){let s=i.getPoint(t);n.push(new H(s.x,s.y,s.z))}return n}dispose(){this.crowd.destroy()}};function dBe(e){let t=!1;return e.scene.objects.forEach(i=>{i.data.type==="Page"&&!t&&i.data.publish.gameControlObject&&r_.traverseModuleInstances(e,i.id,(r,n,s)=>{for(let a of s)a.data.type==="GameControl"&&a.data.navmesh.enabled&&(t=!0)})}),t}var hE={type:"change"},Ow={type:"start"},uy={type:"end",nonOrbit:!0},fBe={type:"end",nonOrbit:!1},pBe={type:"end",isZoom:!0,nonOrbit:!0},mBe={type:"end",changed:!1},nR={type:"cameraAnimatingInTimeline"},sR=new xi,mW=new Pe,gBe=2*Math.PI,vBe=1e-8,yBe=.01,aR=new H,dE=new Pe,oR=new H,fE=new xi,gW=new yt,xBe={type:"requestRender"},aZ=class extends Ys{constructor(e,t,i={isPlayMode:!1,isExport:!1},r){super(),this.object=e,this.domElement=t,this.options=i,this.timelineState=r,this.enabled=!0,this.useKeyEvents=!0,this.enableDamping=!1,this.enableZoom=!0,this.enableRotate=!0,this.enablePan=!0,this.autoRotate=!1,this.rotationLimitsMode=0,this.panLimitsMode=0,this.rotationSoftLimit=2,this.panSoftLimit=2,this.hoverRotatePanMode=0,this.zoomLimitsEnabled=!1,this.mouseButtons=[0,5],this.mouseButtonsPlay=[3,4,5],this.touches=[null,Cl.DOLLY_ROTATE,Cl.PAN],this.offset=new H,this.eye=new H,this.lastPosition=new H,this.lastQuaternion=new xi,this.current=new Pe,this.overShoot=new Pe,this.overRatio=new Pe,this.spherical=new j5,this.sphericalDelta=new j5,this.panOffset=new H,this.panLeftV=new H,this.panUpV=new H,this.panV=new H,this.rotateStart=new Pe,this.rotateEnd=new Pe,this.rotateDelta=new Pe,this.panStart=new Pe,this.panEnd=new Pe,this.panDelta=new Pe,this.dollyStart=new Pe,this.dollyEnd=new Pe,this.dollyDelta=new Pe,this.rotationRangeFactor=new Pe,this.panRangeFactor=new Pe,this.state=-1,this.zoomChanged=!1,this.isPointerDown=!1,this.isThetaFlipped=!1,this.prevScale=0,this.scale=1,this.gesture=!1,this.timer=-1,this.timerHover=-1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPhi=0,this.maxPhi=Math.PI,this.minTheta=-1/0,this.maxTheta=1/0,this.minH=0,this.maxH=Math.PI,this.minV=-1/0,this.maxV=1/0,this.autoRotateClockwise=!0,this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.resetHoverEffectOnPointerLeave=!1,this.hasChange=!1,this.useWindowEvents=!1,this.isTouchZoom=!0,this.autoRotateSpeed=2,this.dampingFactor=.125,this.zoomSpeed=2,this.rotateSpeed=1,this.panSpeed=1,this.hoverRotatePanStrength=.1,this.hoverRotateDamping=this.dampingFactor,this.isCurrentlyDamping=!1,this.thetaIsFree=!1,this.phiIsFree=!1,this.needsUpdate=!0,this.onCameraChange=n=>{this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange),this.object=n.camera,this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)},this.update=()=>{this.object.updateWorldMatrix(!0,!1),this.object.matrixWorld.decompose(oR,fE,aR),this.offset.copy(oR).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.autoRotate&&this.state===-1&&this.rotateLeft((this.autoRotateClockwise===!0?1:-1)*this.getAutoRotationAngle()),this.rotationLimitsMode!==0&&this.applyLimits(this.sphericalDelta,this.rotationLimitsMode,this.rotationSoftLimit,this.maxTheta,this.minTheta,this.maxPhi,this.minPhi,this.rotationRangeFactor),this.rotationLimitsMode!==2&&(this.spherical.phi+=this.sphericalDelta.phi),(this.rotationLimitsMode!==1||this.autoRotate===!0)&&(this.spherical.theta+=this.sphericalDelta.theta),this.spherical.radius*=this.scale,this.zoomLimitsEnabled&&this.object.isPerspectiveCamera&&(this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius))),this.panLimitsMode!==0&&(this.target.applyQuaternion(sR.copy(fE).invert()),this.panOffset.applyQuaternion(sR),this.applyLimits(this.panOffset,this.panLimitsMode,this.panSoftLimit,this.maxH,this.minH,this.maxV,this.minV,this.panRangeFactor),this.target.applyQuaternion(fE),this.panOffset.applyQuaternion(fE)),this.panLimitsMode===2&&(this.panOffset.y=0),this.panLimitsMode===1&&(this.panOffset.x=0),this.state===-1&&!this.gesture?(this.panOffset.multiplyScalar(1-this.dampingFactor),this.target.add(this.panOffset)):(this.target.add(this.panOffset),this.panOffset.set(0,0,0)),this.offset.setFromSpherical(this.spherical),oR.copy(this.target).add(this.offset),this.object.position.copy(this.target).add(this.offset),this.object.parent&&(gW.copy(this.object.parent.matrixWorld).invert(),this.object.position.applyMatrix4(gW));let n=this.spherical.phi%gBe;if(this.eye.copy(this.offset).normalize(),this.object.up.copy(vr.DEFAULT_UP).applyAxisAngle(this.eye,this.object.angleOffsetFromUp),n>0&&n>Math.PI||n<0&&n>-Math.PI?(this.object.up.negate(),this.object.lookAt(this.target),this.object.isUpVectorFlipped=!0):(this.object.lookAt(this.target),this.object.isUpVectorFlipped=!1),this.state===-1||this.enableDamping===!0){let s=this.hoverRotatePanMode===1?this.hoverRotateDamping:this.dampingFactor;this.sphericalDelta.theta*=1-s,this.sphericalDelta.phi*=1-s}else this.sphericalDelta.set(0,0,0);if(this.scale=1,this.lastPosition.distanceToSquared(this.object.position)>yBe||8*(1-this.lastQuaternion.dot(this.object.quaternion))>vBe){this.dispatchEvent(hE),this.object.dispatchEvent(xBe),this.lastPosition.copy(this.object.position),this.lastQuaternion.copy(this.object.quaternion),this.isCurrentlyDamping=!0;return}this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.object.wasMovedBySwitchCameraAction=!1,this.sphericalDelta.set(0,0,0),this.panOffset.set(0,0,0),this.isCurrentlyDamping=!1},this.onPointerDown=n=>{this.enabled!==!1&&(n.pointerType==="touch"||n.pointerType==="pen"&&cl?this.onPointerDownTouch(n):this.onPointerDownMouse(n),this.state!==-1&&(this.isPointerDown=!0,this.dispatchEvent(Ow),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp),n.stopPropagation(),n.pointerType==="touch"||n.pointerType==="pen"&&cl||this.domElement.setPointerCapture(n.pointerId)))},this.onPointerLeave=n=>{this.resetHoverEffectOnPointerLeave&&!this.useWindowEvents?(this.hoverRotatePanMode===1?(this.sphericalDelta.theta=-this.spherical.theta,this.sphericalDelta.phi=-this.spherical.phi,aR.subVectors(this.position0,this.target0),this.spherical.setFromVector3(aR),this.sphericalDelta.theta+=this.spherical.theta,this.sphericalDelta.phi+=this.spherical.phi,this.sphericalDelta.theta/=8,this.sphericalDelta.phi/=8):this.hoverRotatePanMode===2&&this.panOffset.subVectors(this.target0,this.target).divideScalar(8),this.update()):this.pointerLeaveEvent=n},this.onPointerEnter=n=>{this.resetHoverEffectOnPointerLeave||this.pointerLeaveEvent===void 0?dE.set(n.clientX-this.domElement.clientWidth/2,n.clientY-this.domElement.clientHeight/2):dE.set(n.clientX-this.pointerLeaveEvent.clientX,n.clientY-this.pointerLeaveEvent.clientY),this.hoverRotatePanMode===1?(this.rotateDelta.copy(dE).multiplyScalar(this.rotateSpeed*this.hoverRotatePanStrength).rotateAround(mW,-this.object.angleOffsetFromUp),this.rotateLeft(2*Math.PI*this.rotateDelta.x/this.domElement.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/this.domElement.clientHeight),this.rotateStart.set(n.clientX,n.clientY)):this.hoverRotatePanMode===2&&(this.panDelta.copy(dE).multiplyScalar(this.panSpeed*this.hoverRotatePanStrength),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.set(n.clientX,n.clientY)),this.update()},this.onPointerMove=n=>{if(this.timelineState?.isPlayingCameraAnimation){this.dispatchEvent(nR);return}this.enabled!==!1&&(this.checkRaycastLock()||(n.pointerType==="touch"||n.pointerType==="pen"&&cl?this.onPointerMoveTouch(n):this.onPointerMoveMouse(n),n.stopPropagation()))},this.onPointerUp=n=>{this.isPointerDown=!1,pi.length===0&&(this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)),pi.length>1&&n.preventDefault(),this.hasChange?this.dispatchEvent(this.state===0?fBe:uy):this.dispatchEvent(mBe),this.state=-1,n&&(n.stopPropagation(),n.pointerType==="touch"||n.pointerType==="pen"&&cl||this.domElement.releasePointerCapture(n.pointerId))},this.onPointerDownMouse=n=>{let s;switch(this.useKeyEvents?s=this.mouseButtons[n.button]:s=this.mouseButtonsPlay[n.button],s){case 0:if(n.altKey===!0&&!n.shiftKey&&!_A(n)){if(this.enableRotate===!1)return;this.handleMouseDownRotate(n),this.state=0}else if(this.key===" "){if(this.enablePan===!1)return;this.handleMouseDownPan(n),this.state=2}break;case 4:if(this.enablePan===!1)return;this.handleMouseDownPan(n),this.state=2;break;case 3:if(_A(n)||n.shiftKey){if(this.enablePan===!1)return;this.handleMouseDownPan(n),this.state=2}else{if(this.enableRotate===!1)return;this.handleMouseDownRotate(n),this.state=0}break;case 5:if(_A(n)||n.shiftKey){if(this.enableRotate===!1)return;this.handleMouseDownRotate(n),this.state=0}else{if(this.enablePan===!1)return;this.handleMouseDownPan(n),this.state=2}break;default:this.state=-1}},this.onPointerMoveMouse=n=>{switch(this.state){case 0:if(this.enableRotate===!1)return;this.handleMouseMoveRotate(n);break;case 1:if(this.enableZoom===!1)return;this.handleMouseMoveDolly(n);break;case 2:if(this.enablePan===!1)return;this.handleMouseMovePan(n);break}this.object.wasMovedByUser=!0},this.onPointerDownTouch=n=>{switch(pi.length>1&&n.preventDefault(),this.touches[pi.length-1]){case Cl.ROTATE:if(this.enableRotate===!1){this.state=-1;return}this.handleTouchStartRotate(),this.state=3;break;case Cl.PAN:if(this.enablePan===!1){this.state=-1;return}this.handleTouchStartPan(),this.state=4;break;case Cl.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchStartDollyPan(),this.state=5;break;case Cl.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchStartDollyRotate(),this.state=6;break;default:this.state=-1}},this.onPointerMoveTouch=n=>{switch(pi.length>1&&n.preventDefault(),this.state){case 3:if(this.enableRotate===!1)return;this.handleTouchMoveRotate(n),this.update();break;case 4:if(this.enablePan===!1)return;this.handleTouchMovePan(n),this.update();break;case 5:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchMoveDollyPan(n),this.update();break;case 6:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchMoveDollyRotate(n),this.update();break;default:this.state=-1}this.object.wasMovedByUser=!0},this.dispatchEndDebounced=Zb(()=>{this.zoomChanged?this.dispatchEvent(pBe):this.dispatchEvent(uy),this.zoomChanged=!1},33),this.onMouseWheel=n=>{if(!(this.enabled===!1||this.enableZoom===!1&&this.enablePan===!1)&&!this.checkRaycastLock()){if(!this.options.isExport&&this.domElement.clientHeight===document.body.clientHeight&&this.domElement.clientWidth===document.body.clientWidth&&n.preventDefault(),this.dispatchEvent(Ow),this.timelineState?.isPlayingCameraAnimation){this.dispatchEvent(nR);return}this.handleMouseWheel(n),this.dispatchEndDebounced(),this.object.wasMovedByUser=!0}},this.onGesture=n=>{if(n.preventDefault(),this.enabled!==!1&&!this.checkRaycastLock()&&!Gx){if(this.timelineState?.isPlayingCameraAnimation){this.dispatchEvent(nR);return}if(n.type==="gesturechange"){if(this.enableZoom===!1||this.isTouchZoom===!1)return;this.dispatchEvent(Ow),n.scale>this.prevScale?this.dollyIn(this.getZoomScale()):n.scale<this.prevScale&&this.dollyOut(this.getZoomScale()),this.prevScale=n.scale,this.update(),this.object.wasMovedByUser=!0}else this.dispatchEvent(uy)}},this.onContextMenu=n=>{n.preventDefault()},this.onTouchEnd=n=>{n.preventDefault()},this.onKeyDown=n=>{this.enabled!==!1&&(this.key=n.key,n.key===" "&&this.dispatchEvent(Ow))},this.onKeyUp=n=>{this.enabled!==!1&&(this.key=void 0,this.state!==-1&&n.key==="Alt"&&this.onPointerUp(pi[0]),n.key===" "&&this.dispatchEvent(uy))},this.onPointerHover=n=>{n.pointerType!=="mouse"||this.enabled===!1||this.state!==-1||this.hoverRotatePanMode===2&&this.isPanOverShoot||this.hoverRotatePanMode===1&&this.isRotateOverShoot||(this.isPointerDown=!0,this.hoverRotatePanMode===2?this.handleMouseMovePan(n,this.hoverRotatePanStrength):this.hoverRotatePanMode===1&&this.handleMouseMoveRotate(n,this.hoverRotatePanStrength))},this.onBeginState=()=>{this.enabled=!1,this.needsUpdate=!1},this.onCompleteState=n=>{n.isfromEntity&&this.options.isPlayMode||(this.enabled=!0,this.needsUpdate=!0,this.object.updateUp(),this.object.getTarget(this.target))},this.target=this.object.getTarget(),this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.quat0=this.object.quaternion.clone(),this.isUpVectorFlipped0=this.object.isUpVectorFlipped,this.offset.copy(this.object.position).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.initialSphericalRadius=this.spherical.radius,this.addEventListenersToCamera()}dispatchEvent(e){e.type==="start"?this.hasChange=!1:this.hasChange=!0,super.dispatchEvent(e)}addEventListenersToCamera(){this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)}removeEventListenersFromCamera(){this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange)}updateUseWindowEvents(e){if(window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("pointermove",this.onPointerHover),this.useWindowEvents=e,this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover)),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let t=this.useWindowEvents?window:this.domElement;t.addEventListener("pointerleave",this.onPointerLeave),t.addEventListener("pointerenter",this.onPointerEnter)}}fromJSON(e,t){this.setEnableDampingSpeed(e.enableDamping),this.enablePan=e.enablePan,this.enableZoom=e.enableZoom,this.enableRotate=e.enableRotate,this.rotationLimitsMode=e.rotationLimitsMode,this.thetaIsFree=e.rotationHorizontalOffset.min===e.rotationHorizontalOffset.max&&e.rotationHorizontalOffset.min===Math.PI,this.phiIsFree=e.rotationVerticalOffset.min===e.rotationVerticalOffset.max&&e.rotationVerticalOffset.min===Math.PI,this.panLimitsMode=e.panLimitsMode,this.panSoftLimit=e.panSoftLimit,this.rotationSoftLimit=e.rotationSoftLimit,this.hoverRotatePanMode=e.hoverRotatePanMode,this.hoverRotateDamping=e.hoverRotateDamping??this.dampingFactor,this.useWindowEvents=t==="window",this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover));let i=e.hoverRotatePanStrength/100;this.hoverRotatePanStrength=i**2,this.zoomLimitsEnabled=e.zoomLimitsEnabled,this.minZoom=e.zoomLimits.min,this.maxZoom=Math.max(e.zoomLimits.min,e.zoomLimits.max),this.minDistance=1e3/this.maxZoom,this.maxDistance=Math.max(this.minDistance,1e3/e.zoomLimits.min),this.autoRotate=e.autoRotate,this.autoRotateSpeed=e.autoRotateSpeed,this.autoRotateClockwise=e.autoRotateClockwise;let r=this.object.getTarget().applyQuaternion(sR.copy(this.object.quaternion).invert());this.minV=-e.panVerticalOffset.min+r.y,this.maxV=e.panVerticalOffset.max+r.y,this.minH=-e.panHorizontalOffset.min+r.x,this.maxH=e.panHorizontalOffset.max+r.x,this.panRangeFactor.set(this.maxH-this.minH,this.maxV-this.minV).divideScalar(2),this.rotationRangeFactor.setScalar(Math.PI).divideScalar(4),this.minPhi=Cc(this.spherical.phi-e.rotationVerticalOffset.min),this.maxPhi=Cc(this.spherical.phi+e.rotationVerticalOffset.max),this.minTheta=Cc(Cc(this.spherical.theta)-e.rotationHorizontalOffset.min),this.maxTheta=Cc(Cc(this.spherical.theta)+e.rotationHorizontalOffset.max),this.isThetaFlipped=this.minTheta>this.maxTheta,e.orbitTouches===1&&(this.touches[0]=Cl.ROTATE),e.panTouches===1&&(this.touches[0]=Cl.PAN),e.orbitTouches===2&&(this.touches[1]=Cl.DOLLY_ROTATE),e.panTouches===2&&(this.touches[1]=Cl.DOLLY_PAN),e.orbitTouches===3&&(this.touches[2]=Cl.ROTATE),e.panTouches===3&&(this.touches[2]=Cl.PAN),this.isTouchZoom=e.isTouchZoom,this.resetHoverEffectOnPointerLeave=e.resetHoverEffectOnPointerLeave??!1}connect(){if(this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.onMouseWheel),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keyup",this.onKeyUp,!1),this.domElement.addEventListener("gesturestart",this.onGesture),this.domElement.addEventListener("gesturechange",this.onGesture),this.domElement.addEventListener("gestureend",this.onGesture),this.domElement.addEventListener("touchend",this.onTouchEnd),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let e=this.useWindowEvents?window:this.domElement;e.addEventListener("pointerleave",this.onPointerLeave),e.addEventListener("pointerenter",this.onPointerEnter)}this.pointerLeaveEvent=void 0}dispose(){this.removeEventListenersFromCamera(),this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.onMouseWheel),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keyup",this.onKeyUp,!1),this.domElement.removeEventListener("pointermove",this.onPointerHover),window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("gesturestart",this.onGesture),this.domElement.removeEventListener("gesturechange",this.onGesture),this.domElement.removeEventListener("gestureend",this.onGesture),this.domElement.removeEventListener("touchend",this.onTouchEnd),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)}applyLimits(e,t,i,r,n,s,a,o){this.overShoot.set(0,0);let l,u,c;e instanceof H?(l=e.x,u=e.y,this.current.set(this.target.x,this.target.y),c=!0):(l=e.theta,u=e.phi,this.current.set(Cc(this.spherical.theta),Cc(this.spherical.phi)),c=!1),i===0&&(this.current.x+=l,this.current.y+=u),(t===3||t===2)&&(!c&&this.isThetaFlipped?this.current.x>r&&this.current.x<0?this.overShoot.x=r-this.current.x:this.current.x<n&&this.current.x>0&&(this.overShoot.x=n-this.current.x):this.current.x>r?this.overShoot.x=r-this.current.x:this.current.x<n&&(this.overShoot.x=n-this.current.x)),(t===3||t===1)&&(this.current.y>s?this.overShoot.y=s-this.current.y:this.current.y<a&&(this.overShoot.y=a-this.current.y)),c||(this.overShoot.x=Cc(this.overShoot.x),this.overShoot.y=Cc(this.overShoot.y)),i!==0?(this.overRatio.copy(this.overShoot).divide(o),this.overRatio.x=Math.min(Math.abs(this.overRatio.x),1),this.overRatio.y=Math.min(Math.abs(this.overRatio.y),1),i===1&&(this.overRatio.x=vW(Math.abs(this.overRatio.x)),this.overRatio.y=vW(Math.abs(this.overRatio.y))),this.isPointerDown||i===1?i===2&&(this.overRatio.x>.9&&!this.thetaIsFree||this.overRatio.y>.9&&!this.phiIsFree)?this.isPointerDown=!1:(l*this.overShoot.x<0&&!this.thetaIsFree&&(l*=1-this.overRatio.x),u*this.overShoot.y<0&&!this.phiIsFree&&(u*=1-this.overRatio.y)):i===2&&(!c&&(this.overRatio.x>.002&&!this.thetaIsFree||this.overRatio.y>.002&&!this.phiIsFree)||c&&(Math.abs(this.overShoot.x)>2||Math.abs(this.overShoot.y)>2)?(this.thetaIsFree||(l=this.overShoot.x*.05),this.phiIsFree||(u=this.overShoot.y*.05),c?this.isPanOverShoot=!0:this.isRotateOverShoot=!0):c?this.isPanOverShoot=!1:this.isRotateOverShoot=!1)):(l+=this.overShoot.x,u+=this.overShoot.y),e instanceof H?(e.x=l,e.y=u):(this.thetaIsFree||(e.theta=l),this.phiIsFree||(e.phi=u))}setEnableDampingSpeed(e){this.enableDamping=e,this.rotateSpeed=e===!0?.2:1}stopDamping(){this.sphericalDelta.theta=0,this.sphericalDelta.phi=0}getAutoRotationAngle(){return 2*Math.PI/60/60*this.autoRotateSpeed}getZoomScale(){return Math.pow(.95,this.zoomSpeed)}rotateLeft(e){this.sphericalDelta.theta-=e}rotateUp(e){this.sphericalDelta.phi-=e}panLeft(e,t){this.panLeftV.setFromMatrixColumn(t,0),this.panLeftV.multiplyScalar(-e),this.panOffset.add(this.panLeftV)}panUp(e,t){this.panUpV.setFromMatrixColumn(t,1),this.panUpV.multiplyScalar(e),this.panOffset.add(this.panUpV)}pan(e,t){let i=this.domElement;if(i&&this.object.isPerspectiveCamera){let r=this.object.position;this.panV.copy(r).sub(this.target);let n=this.panV.length();n*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*e*n/i.clientHeight,this.object.matrixWorld),this.panUp(2*t*n/i.clientHeight,this.object.matrixWorld)}else i&&this.object.isOrthographicCamera&&(this.panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrixWorld),this.panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrixWorld));this.dispatchEvent(hE)}dollyOut(e){this.object.isPerspectiveCamera?this.scale/=e:this.object.isOrthographicCamera&&(this.object.zoom*=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(hE)}dollyIn(e){this.object.isPerspectiveCamera?this.scale*=e:this.object.isOrthographicCamera&&(this.object.zoom/=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(hE)}setZoom(e){if(this.dispatchEvent(Ow),this.object.isPerspectiveCamera){let t=this.initialSphericalRadius/e/this.spherical.radius;this.scale=t}else this.object.isOrthographicCamera&&(this.object.zoom=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0);this.dispatchEvent(uy)}handleMouseDownRotate(e){this.rotateStart.set(e.clientX,e.clientY)}handleMouseDownDolly(e){this.dollyStart.set(e.clientX,e.clientY)}handleMouseDownPan(e){this.panStart.set(e.clientX,e.clientY)}handleMouseMoveRotate(e,t=1){e.movementX!==void 0?this.rotateDelta.set(e.movementX,e.movementY):(this.rotateEnd.set(e.clientX,e.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd)),this.rotateDelta.multiplyScalar(this.rotateSpeed*t).rotateAround(mW,-this.object.angleOffsetFromUp);let i=this.domElement,r=this.useWindowEvents?window.innerHeight:i.clientHeight,n=2*Math.PI*this.rotateDelta.x/r,s=2*Math.PI*this.rotateDelta.y/r;this.rotateLeft(n),this.rotateUp(s),this.update()}handleMouseMoveDolly(e){this.dollyEnd.set(e.clientX,e.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyIn(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}handleMouseMovePan(e,t=1){e.movementX!==void 0?this.panDelta.set(e.movementX,e.movementY):(this.panEnd.set(e.clientX,e.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.panStart.copy(this.panEnd)),this.panDelta.multiplyScalar(this.panSpeed*t),this.pan(this.panDelta.x,this.panDelta.y),this.update()}handleMouseWheel(e){if(YAe===!1&&_A(e)===!1&&KAe(e)===!0){if(this.enablePan===!1)return;this.gesture?(this.panDelta.set(-e.deltaX,-e.deltaY).multiplyScalar(this.panSpeed),this.panDelta.x=Math.min(Math.abs(this.panDelta.x),100)*(this.panDelta.x<0?-1:1),this.panDelta.y=Math.min(Math.abs(this.panDelta.y),100)*(this.panDelta.y<0?-1:1),e.altKey?this.pan(0,this.panDelta.y):e.shiftKey?this.pan(this.panDelta.x,0):this.pan(this.panDelta.x,this.panDelta.y),this.update()):(this.gesture=!0,this.isPointerDown=!0),window.clearTimeout(this.timer),this.timer=window.setTimeout(()=>{this.gesture=!1,this.isPointerDown=!1,this.dispatchEvent(uy)},30)}else{if(this.enableZoom===!1||this.gesture)return;e.deltaY===0?e.deltaX<0?this.dollyIn(this.getZoomScale()):e.deltaX>0&&this.dollyOut(this.getZoomScale()):e.deltaY<0?this.dollyIn(this.getZoomScale()):e.deltaY>0&&this.dollyOut(this.getZoomScale()),this.update(),this.gesture=!1,this.isPointerDown=!1}}handleTouchStartRotate(){if(pi.length===2){let e=.5*(pi[0].pageX+pi[1].pageX),t=.5*(pi[0].pageY+pi[1].pageY);this.rotateStart.set(e,t)}else this.rotateStart.set(pi[0].pageX,pi[0].pageY)}handleTouchStartPan(){if(pi.length===2){let e=.5*(pi[0].pageX+pi[1].pageX),t=.5*(pi[0].pageY+pi[1].pageY);this.panStart.set(e,t)}else this.panStart.set(pi[0].pageX,pi[0].pageY)}handleTouchStartDolly(){let e=pi[0].pageX-pi[1].pageX,t=pi[0].pageY-pi[1].pageY,i=Math.sqrt(e*e+t*t);this.dollyStart.set(0,i)}handleTouchStartDollyPan(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enablePan&&this.handleTouchStartPan()}handleTouchStartDollyRotate(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enableRotate&&this.handleTouchStartRotate()}handleTouchMoveRotate(e){if(pi.length===2){let i=X3(e),r=.5*(e.pageX+i.x),n=.5*(e.pageY+i.y);this.rotateEnd.set(r,n)}else{if(e.pointerId!==pi[0].pointerId)return;this.rotateEnd.set(e.pageX,e.pageY)}this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);let t=this.domElement;t&&(this.rotateLeft(2*Math.PI*this.rotateDelta.x/t.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/t.clientHeight)),this.rotateStart.copy(this.rotateEnd)}handleTouchMovePan(e){if(pi.length===2){let t=X3(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this.panEnd.set(i,r)}else{if(e.pointerId!==pi[0].pointerId)return;this.panEnd.set(e.pageX,e.pageY)}this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(this.panSpeed),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)}handleTouchMoveDolly(e){let t=X3(e),i=e.pageX-t.x,r=e.pageY-t.y,n=Math.sqrt(i*i+r*r);this.dollyEnd.set(0,n),this.dollyDelta.set(0,Math.pow(this.dollyEnd.y/this.dollyStart.y,this.zoomSpeed)),this.dollyOut(this.dollyDelta.y),this.dollyStart.copy(this.dollyEnd)}handleTouchMoveDollyPan(e){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(e),this.enablePan&&this.handleTouchMovePan(e)}handleTouchMoveDollyRotate(e){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(e),this.enableRotate&&this.handleTouchMoveRotate(e)}checkRaycastLock(){if(this.object.data.raycastLock){if(this.options.isPlayMode)return!1;{let e=this.options?.showCameraLock;return e&&e(),!0}}else return!1}};function Cc(e){let t=Math.PI*2;for(;e<=-Math.PI;)e+=t;for(;e>Math.PI;)e-=t;return e}function vW(e){return 1-Math.pow(1-e,4)}var yW=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.page=r,this.currentIntersectedObjects=[],this.actions=os(t,t.actions,r,n,s,i),this.target=t.target,this.triggeringObjects=[];for(let a of t.triggeringObjects){let o=r.scene.find(a);o&&this.triggeringObjects.push(o)}}isValidTriggeringObject(e){return this.target==="all"?!0:this.triggeringObjects.some(t=>t===e||t.isAncestorOf(e.uuid)||e.isAncestorOf(t.uuid))}disconnect(){Ws(this.actions)}dispatch(){this.object.destroyedInAction||(this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.object.dispatchEvent({type:"beginEvent",eventName:"Trigger"}),this.actions.Transition.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.SwitchCamera.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.TimelineAnimation.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.Link.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>{e.dispatch()}),this.actions.Create.forEach(e=>{e.dispatch()}),this.actions.Destroy.forEach(e=>{e.dispatch(!1)}),this.actions.Audio.forEach(e=>{e.dispatchBasic()}),this.actions.Particles.forEach(e=>{e.dispatchBasic()}),this.actions.Video.forEach(e=>{e.dispatchBasic()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()))}},$i;iEe.then(e=>$i=e);var Zn=new H,Tu=new xi,Qf=new H,lR=new ws(0,0,0,"YXZ"),xW=new ws(0,0,0,"XYZ"),Pu=new H,uR=new H,cR=new H(1,1,1),cy=new xi,pE=new yt,wW=new yt,wBe={type:"updateMatrix"},bW=new xi,hR=new Wo,AO={type:"beginEvent",eventName:"Collision"},bBe={type:"beginEvent",eventName:"Trigger"};function _Be(e){if(r_.physicsEnabled(e.scene.objects))return!0;let t=!1;return e.scene.objects.traverse((i,r)=>{if(r.events){if(Array.isArray(r.events)){for(let n of r.events)if(n.data.disabled!==!0&&n.data.type==="GameControl"&&n.data.collisionEnabled){t=!0;break}}else for(let n of Object.values(r.events))if(n.disabled!==!0&&n.type==="GameControl"&&n.collisionEnabled){t=!0;break}}}),t}var hC=e=>e.states.some(t=>t.data.position!==void 0||t.data.rotation!==void 0||t.data.hiddenMatrix!==void 0||t.data.cloner!==void 0||t.data.pathSnapping!==void 0),SBe=class{constructor(e){this.eventContext=e,this.isEnabled=!1,this.gameControl=null,this.joysticks=[],this.joystickToGameControls=[],this.sharedGameControlGlobals={entitiesWithTransformAnim:[],entityToCollisionEvents:{},colliderToEntity:new Map,triggers:[],gamePads:[],createdObjects:[],nCreatedPerAction:{}},this.sensorToTriggerEvent={},this.eventManager=void 0,this.needsCollisionDetection=!1,this.initializationCounter=-1,this.rigidBodyToMesh=new Map,this.nActiveRigidBodies=0,this.collisionEvents=[],this.isExport=!1,this.skipRender=!0,this.processRigidBody=t=>{if(t.bodyType()!==$i.RigidBodyType.Dynamic)return;t.isSleeping()||this.nActiveRigidBodies++;let[i,r,n]=this.rigidBodyToMesh.get(t.handle);if(Zn.copy(t.translation()).multiplyScalar(this.pixelsPerMeter),Tu.copy(t.rotation()),i.matrixWorld.compose(Zn,Tu,r),i.hasNonUniformScale&&i.matrixWorld.multiply(i.shearScale),i.dispatchEvent(wBe),n){let s=i.cloner;if(s&&s.objectForSample===void 0){s.matrixWorld.copy(i.matrixWorld);for(let a of s.children)a.updateMatrixWorld(!0)}for(let a of i.children)a.updateMatrixWorld(!0)}},this.accumulator=0,this.handleCollisionEvents=(t,i,r)=>{if(r===!1)return;let n,s;if(this.sensorToTriggerEvent[t]?(n=this.sensorToTriggerEvent[t],s=this.sharedGameControlGlobals.colliderToEntity.get(i)):this.sensorToTriggerEvent[i]&&(n=this.sensorToTriggerEvent[i],s=this.sharedGameControlGlobals.colliderToEntity.get(t)),n&&s&&n.isValidTriggeringObject(s)){n.dispatch();return}for(let a=this.sharedGameControlGlobals.createdObjects.length-1;a>=0;a--){let o=this.sharedGameControlGlobals.createdObjects[a];if(o.userData.hasCollisionDestroy&&(o.rigidBody?.collider(0).handle===t||o.rigidBody?.collider(0).handle===i)){this.sharedGameControlGlobals.createdObjects.splice(a,1),o.removeFromParent(),requestAnimationFrame(()=>this.sharedGameControlGlobals.rapierWorld?.removeRigidBody(o.rigidBody));break}}if(this.gameControl?.object!==void 0&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(t)){let a=this.sharedGameControlGlobals.colliderToEntity.get(i),o=this.sharedGameControlGlobals.entityToCollisionEvents[a.uuid];if(o===void 0)return;for(let l of o)l.data.target==="character"&&this.dispatchCollisionEvent(l,a,i)}else if(this.gameControl?.object!==void 0&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(i)){let a=this.sharedGameControlGlobals.colliderToEntity.get(t),o=this.sharedGameControlGlobals.entityToCollisionEvents[a.uuid];if(o===void 0)return;for(let l of o)l.data.target==="character"&&this.dispatchCollisionEvent(l,a,t)}else{let a=this.sharedGameControlGlobals.colliderToEntity.get(t),o=this.sharedGameControlGlobals.entityToCollisionEvents[a.uuid];if(o!==void 0)for(let c of o)c.data.target==="scene"&&this.dispatchCollisionEvent(c,a,t);let l=this.sharedGameControlGlobals.colliderToEntity.get(i),u=this.sharedGameControlGlobals.entityToCollisionEvents[l?.uuid];if(u!==void 0)for(let c of u)c.data.target==="scene"&&this.dispatchCollisionEvent(c,l,i)}},this.isExport=e.isExport,this.sharedAssets=e.sharedAssets,this.renderer=e.renderer,this.requestRender=e.requestRender,this.domElement=this.renderer.domElement,this.pixelsPerMeter=KK,this.gravity=this.page.data.globalPhysics.gravity}get page(){return this.eventContext.page}attachVRControllers(e){e.forEach(t=>{t.addEventListener("connected",i=>{"gamepad"in i.data&&"axes"in i.data.gamepad&&this.sharedGameControlGlobals.gamePads.push(i.data.gamepad)})})}markIsDestroyTarget(){this.page.traverseVisibleEntity(e=>{let t=e.dataPatched;for(let i of t.events){if(i.data.disabled===!0)continue;let r=i.data.actions?.find(n=>n.data.type==="Destroy")?.data;if(r)for(let n of r.objects){let s=this.page.scene.find(n);s&&(s.userData.hasDestroy=!0)}}})}markIsDragObject(){this.page.traverseVisibleEntity(e=>{let t=e.dataPatched;for(let i of t.events)if(!(i.data.disabled===!0||i.data.type!=="DragDrop"))for(let r of i.data.objects){let n=this.page.scene.find(r);n&&(n.userData.hasDrag=!0)}})}initBVH(){let e=[];if(this.page.traverseChildren(t=>{let i,r=t instanceof fb,n=t instanceof pb;if(t instanceof jl||r||n)return;t instanceof ya?i=t.object:i=t;let s=i.dataPatched;if(s.physics?.enabled==="visibility"?!s.visible:!s.physics?.enabled)return!0;let a=t.geometry,o=i.userData.hasDestroy===!0,l=i.userData.hasDrag===!0;if(hC(s)||o||l||i.dataPatched.events.some(u=>u.data.disabled!==!0&&(u.data.type==="GameControl"||u.data.type==="Follow")))return t.updateMatrixWorldSVD(),this.addBoundsTree(t),!0;a&&a.getAttribute("position").count>0&&e.push(ad(a,t.matrixWorld))}),e.length>0){let t=xg(e,!1);this.sharedGameControlGlobals.staticMeshBVH=new cb(t)}}addRigidBody(e,t,i){if(JK(e.matrixWorld))return;let r=[],n="geometry"in e?e.geometry:void 0,s=t.dataPatched;if(n?.getAttribute("position")!==void 0&&r.push(ad(n,e.shearScale)),s.physics.fusedBody){let a=this.gatherChildrenGeom(e,r);e.traverseObject(a),e.children.forEach(l=>l.updateMatrixWorld(!0));let o=e.cloner;o&&o.objectForSample===void 0&&s.physics.rigidBody==="dynamic"&&(o.traverseObject(a),o.children.forEach(l=>l.updateMatrixWorld(!0)))}if(r.length>0){let a,o=!i.fromCreate&&s.physics.rigidBody==="dynamic"||i.fromCreate&&i.dynamic;o?(a=$i.RigidBodyDesc.dynamic(),a.setLinearDamping(s.physics.damping).setAngularDamping(s.physics.damping).setAdditionalMass(1e-9).setGravityScale(s.physics.gravityScale).enabledRotations(...s.physics.enabledRotation).enabledTranslations(...s.physics.enabledTranslation)):(i.hasTransformAnim||i.hasFollow||i.hasDrag)&&!i.fromCreate?(a=$i.RigidBodyDesc.kinematicPositionBased(),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e)):a=$i.RigidBodyDesc.fixed();let l=xg(r);(e.hasNonUniformScale?e.matrixWorldRigid:e.matrixWorld).decompose(Zn,Tu,Qf),e.position0=Zn.clone().divideScalar(this.pixelsPerMeter),e.rotation0=Tu.clone(),Zn.divideScalar(this.pixelsPerMeter),a.setTranslation(Zn.x,Zn.y,Zn.z).setRotation(Tu),n?l?.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter):l?.scale(Qf.x/this.pixelsPerMeter,Qf.y/this.pixelsPerMeter,Qf.z/this.pixelsPerMeter);let u=this.sharedGameControlGlobals.rapierWorld.createRigidBody(a);o&&this.rigidBodyToMesh.set(u.handle,[e,Qf.clone(),s.physics.fusedBody]);let c=!(s.geometry===void 0||s.geometry.type==="SubdivGeometry"||s.geometry.type==="NonParametricGeometry"||s.geometry.type==="BooleanGeometry"||s.geometry.type==="VectorGeometry"||s.geometry.type==="StarGeometry"||s.geometry.type==="RectangleGeometry"||s.geometry.type==="EllipseGeometry"||s.geometry.type==="TriangleGeometry"||s.geometry.type==="TorusGeometry"||s.geometry.type==="HelixGeometry");try{this.addCollider(u,s.physics,l,t,c)}catch{try{this.addCollider(u,s.physics,l,t,!1)}catch(h){console.error(h)}}e.rigidBody=u}}addBoundsTree(e){let t=[];if(e.geometry?.getAttribute("position")!==void 0&&e.geometry?.getAttribute("position").count>0&&t.push(ad(e.geometry,e.shearScale)),e.traverseObject(this.gatherChildrenGeom(e,t)),e.children.forEach(i=>i.updateMatrixWorld(!0)),t.length>0){let i=xg(t,!1);e.bvhGeometry=i,i.getAttribute("position").count>0&&(e.bvhGeometry.boundsTree=new cb(i),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e))}}addCollider(e,t,i,r,n=!0){if(i?.getAttribute("position").count===0||i?.getIndex()?.count===0)return;let s;i&&(t.colliderType==="trimesh"?s=$i.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array):s=$i.ColliderDesc.convexMesh(i.getAttribute("position").array,n?i.getIndex().array:void 0)),s.setFrictionCombineRule($i.CoefficientCombineRule.Average).setRestitutionCombineRule($i.CoefficientCombineRule.Average).setDensity(t.density).setFriction(t.friction).setRestitution(t.restitution);let a=this.sharedGameControlGlobals.rapierWorld.createCollider(s,e);this.sharedGameControlGlobals.colliderToEntity.set(a.handle,r),this.sharedGameControlGlobals.entityToCollisionEvents[r.uuid]?.some(o=>o.target==="scene")&&a.setActiveEvents($i.ActiveEvents.COLLISION_EVENTS)}gatherChildrenGeom(e,t){return(i,r)=>{if(r===0)return;let n;if(i instanceof jl)if(i.objectForSample){if(i.objectForSample.dataPatched.physics.fusedBody)return;n=i.object}else return i.object.dataPatched.physics.fusedBody===!0&&i.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(i instanceof ya)n=i.object;else if(n=i,n.dataPatched.cloner?.hideBase)return!0;let s=n.dataPatched;if(s.physics.enabled==="visibility"?!s.visible:!s.physics.enabled)return!0;r===1?e.hasNonUniformScale?i.matrixWorld.multiplyMatrices(e.shearScale,i.hiddenMatrix):i.matrixWorld.copy(i.hiddenMatrix):i.matrixWorld.multiplyMatrices(i.parent.matrixWorld,i.hiddenMatrix),i.matrixWorld.multiply(i.matrix);let a=i.geometry;a?.getAttribute("position")!==void 0&&t.push(ad(a,i.matrixWorld))}}activate(e){if(this.isEnabled)return;this.isEnabled=!0,this.eventManager=e,this.usePhysics=this.page.data.globalPhysics.usePhysics;let t=this.page.playCamera,i=!1,r=5,n=8,s=9,a="drag",o=this.page.data.publish.gameControlObject,l=o!==null?this.page.find(o):null,u=null;if(l)for(let d of l.data.events){if(d.data.disabled||d.data.type!=="GameControl")continue;let p=l;for(;this.usePhysics&&(p=p.parent)?.parent!==null;)p.data.physics?.fusedBody;d.data.collisionEnabled&&(this.needsCollisionDetection=!0),u===null&&(u=d.data)}if(this.page.traverseEntity(d=>{for(let p of d.dataPatched.events)if(p.data.disabled===!1&&p.data.type==="Trigger")return this.needsCollisionDetection=!0,!0}),l&&u&&(l.data.visible===!0||l.data.physics.enabled===!0)){i=i||u.camera===t.uuid||l.uuid===t.uuid;let d=new ZK(l,this.renderer.domElement,u,this.eventContext.page.data.globalPhysics,this,l.uuid!==t.uuid&&u.camera===t.uuid,t,this.page,this.sharedAssets);this.gameControl=d,r=u.joystickPosLoc,n=u.joystickRotLoc,s=u.jumpTouchButtonLoc,a=u.rotByTouch,cl&&u.touchControl&&(this.joystickToGameControls[r]="pos",u.moveMode==="walk"&&(this.joystickToGameControls[s]="jmp"),a==="joystick"&&(this.joystickToGameControls[n]="rot"))}if(this.gameControl&&this.gameControl.data.navmesh.enabled){let d=this.gameControl.data;if(!this.navigationMeshWrapper){this.navigationMeshWrapper=new cBe(this.usePhysics,this.isExport);let p;d.collider.type==="sphere"?p=d.collider.radius*2:p=d.collider.height,p=Math.floor(p/d.navmesh.ch-1),this.navigationMeshWrapper.init({...d.navmesh,walkableHeight:p},this.gameControl,this.eventContext)}}if(i===!1){let{enableRotate:d,enablePan:p,enableZoom:m,autoRotate:v,hoverRotatePanMode:g}=this.eventManager.publish.orbitControls;(d||p||m||v||g!==0)&&(this.orbitControls=new aZ(t,this.renderer.domElement,{isExport:this.isExport,isPlayMode:!0}),this.orbitControls.addEventListener("change",this.requestRender),this.orbitControls.addEventListener("end",this.requestRender),this.orbitControls.addEventListener("start",this.requestRender),this.orbitControls.fromJSON(this.eventManager.publish.orbitControls,this.eventManager.publish.mouseEventTarget),this.orbitControls.useKeyEvents=!1,this.orbitControls.addEventListenersToCamera(),this.orbitControls.connect(),this.orbitControls.update())}let c=this.renderer.domElement.width/this.renderer.getPixelRatio(),h=this.renderer.domElement.height/this.renderer.getPixelRatio();this.joystickToGameControls.forEach((d,p)=>{let m=document.body.appendChild(document.createElement("div")),[v,g,w]=this.eventManager.eventContext.publish.joystickSizeAndXYOffset[p],S=(c-5*v)/4+v,_={},A=d==="jmp",C=A?0:v;p<10?(p<5?_.top=C/2:_.bottom=C/2,_.left=C/2+p%5*S):p===10?(_.left=C/2,_.top=h/2):(_.right=C/2,_.top=h/2),_.top?_.top-=g[1]:_.bottom+=g[1],_.left?_.left+=g[0]:_.right-=g[0];for(let T in _)_[T]+="px";if(A){let T=m.appendChild(document.createElement("div"));Object.assign(T.style,_,{position:"absolute",width:v+"px",height:v+"px",backgroundColor:`rgba(255,255,255,${w==="show"?.4:0})`,zIndex:"9999",borderRadius:v+"px",border:w==="show"?"solid 2px rgba(0, 0, 0, .1)":"none",display:"flex",alignItems:"center",justifyContent:"center",touchAction:"none"});let D=v/16*16*.4;w==="show"&&(T.innerHTML=`
						<svg width="${D}" height="${v*.4}" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M2 10L8 4L14 10" stroke="black" stroke-opacity="40%" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
						</svg>
					`),T.addEventListener("pointerdown",()=>{this.gameControl.movementState.jump=1,this.requestRender()}),T.addEventListener("touchend",L=>L.preventDefault()),this.joysticks[p]=[void 0,m];return}let E={zone:m,mode:"static",position:_,size:v};w==="hide"&&(E.restOpacity=0);let I=Aze.create(E);I.on("move",(T,D)=>{let L=this.gameControl;d==="pos"?D.force<.2?L.moveForce=0:(L.movementState.movePosZ=Math.sin(-D.angle.radian),L.movementState.movePosX=Math.cos(-D.angle.radian),D.force>1.2?L.movementState.run=1:L.movementState.run=0,D.force<.3?L.moveForce=(D.force-.2)/.1:L.moveForce=1):d==="rot"&&(D.force<.2?L.rotForce=0:(L.movementState.rotPosX=D.vector.y,L.movementState.rotPosY=-D.vector.x,D.force<.3?L.rotForce=(D.force-.2)/.1:L.rotForce=1)),this.requestRender()}),I.on("end",(T,D)=>{let L=this.gameControl;d==="pos"?(L.movementState.movePosZ=0,L.movementState.movePosX=0,L.moveForce=1):d==="rot"&&(L.movementState.rotPosX=0,L.movementState.rotPosY=0,L.rotForce=1)}),this.joysticks[p]=[I,m]}),this.markIsDestroyTarget(),this.markIsDragObject(),this.rebuildBVH(),this.initializationCounter++,window.setTimeout(()=>{this.collisionEvents.forEach(d=>d.initialDisabled=!1)},80)}initPhysics(){this.sharedGameControlGlobals.rapierWorld?.free(),this.sharedGameControlGlobals.rapierWorld=new $i.World(new $i.Vector3(0,this.gravity,0)),this.events=new $i.EventQueue(!0);let e=[],t=[];if(this.page.traverseChildren(a=>{let o;if(a instanceof jl)if(a.objectForSample){if(a.objectForSample.dataPatched.physics.fusedBody)return;o=a.object}else return a.object.dataPatched.physics.fusedBody===!0&&a.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(a instanceof ya)o=a.object;else{if(a instanceof pb||a instanceof fb)return;if(o=a,o.dataPatched.cloner?.disabled===!1&&o.dataPatched.cloner?.hideBase&&o.dataPatched.physics?.fusedBody!==!0)return!0}let l=o.dataPatched,u;for(let g of l.events)g.data.disabled!==!0&&g.data.type==="GameControl"&&(u=g.data);if(!l.physics||(l.physics.enabled==="visibility"?!l.visible:!l.physics.enabled))return!0;a.updateMatrixWorldSVD();let c=hC(l),h=!1,d=o.userData.hasDestroy,p=o.userData.hasDrag,m=!1;for(let g of l.events)if(g.data.disabled!==!0){if(g.data.type==="Collision"){h=!0;let w=new $ke(g.id,g.data,o,this.page,this.sharedAssets,this.eventManager);w.initialDisabled=!0,this.collisionEvents.push(w),this.sharedGameControlGlobals.entityToCollisionEvents[o.uuid]&&this.sharedGameControlGlobals.entityToCollisionEvents[o.uuid].every(S=>S.id!==g.id)?this.sharedGameControlGlobals.entityToCollisionEvents[o.uuid].push(w):this.sharedGameControlGlobals.entityToCollisionEvents[o.uuid]=[w]}else if(g.data.type==="Follow"){m=!0;let w=g.data.target;a.traverseVisible(S=>{S.userData.isFollowingObj=w})}}l.physics.rigidBody==="dynamic"&&l.physics.fusedBody===!1&&(a.matrixWorldFusedFalse=a.matrixWorld.clone());let v=a.geometry;if(u!==void 0){let g=$i.RigidBodyDesc.kinematicPositionBased();(a.hasNonUniformScale?a.matrixWorldRigid:a.matrixWorld).decompose(Zn,Tu,Qf),a.position0=Zn.clone().divideScalar(this.pixelsPerMeter),a.rotation0=Tu.clone(),Zn.divideScalar(this.pixelsPerMeter),g.setTranslation(Zn.x,Zn.y,Zn.z).setRotation(Tu);let w=this.sharedGameControlGlobals.rapierWorld.createRigidBody(g);a.rigidBody=w;let S;u.collider.type==="sphere"?S=$i.ColliderDesc.ball(u.collider.radius/this.pixelsPerMeter):u.collider.type==="capsule"?S=$i.ColliderDesc.capsule((u.collider.height/2-u.collider.radius)/this.pixelsPerMeter,u.collider.radius/this.pixelsPerMeter):S=$i.ColliderDesc.cuboid(u.collider.width/this.pixelsPerMeter/2,u.collider.height/this.pixelsPerMeter/2,u.collider.depth/this.pixelsPerMeter/2),S.setFrictionCombineRule($i.CoefficientCombineRule.Average).setRestitutionCombineRule($i.CoefficientCombineRule.Average).setDensity(l.physics.density).setFriction(l.physics.friction).setRestitution(l.physics.restitution);let _=this.sharedGameControlGlobals.rapierWorld.createCollider(S,w);this.sharedGameControlGlobals.colliderToEntity.set(_.handle,o),Zn.fromArray(u.collider.position).multiply(Qf.setFromMatrixScale(o.matrixWorld)).divideScalar(this.pixelsPerMeter),_.setTranslationWrtParent(Zn);let A=new xi().setFromEuler(new ws().setFromVector3(new H().fromArray(u.collider.rotation)));_.setRotationWrtParent(A),_.setActiveEvents($i.ActiveEvents.COLLISION_EVENTS),this.generateSensorColliderDescs(o,!0)}else l.physics.rigidBody==="dynamic"||c||m||d||p||h?(this.addRigidBody(a,o,{hasFollow:m,hasTransformAnim:c,hasDrag:p}),this.generateSensorColliderDescs(o,l.physics.fusedBody)):(v&&e.push(ad(v,a.matrixWorld)),l.physics.fusedBody&&a.traverseObject((g,w)=>{if(w===0)return;let S;if(g instanceof jl)if(g.objectForSample){if(g.objectForSample.dataPatched.physics.fusedBody)return;S=g.object}else return g.object.dataPatched.physics.fusedBody===!0&&g.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else{if(g instanceof pb||g instanceof fb)return;if(g instanceof ya)S=g.object;else if(S=g,S.dataPatched.cloner?.hideBase)return!0}let _=S.dataPatched;if(_.physics.enabled==="visibility"?!_.visible:!_.physics.enabled)return!0;let A=g.geometry;A?.getAttribute("position")!==void 0&&e.push(ad(A,g.matrixWorld))}),this.generateSensorColliderDescs(o,l.physics.fusedBody,t));if(l.physics?.fusedBody===!0||u)return!0}),e.length===0)return;let i=xg(e);i.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter);let r=$i.RigidBodyDesc.fixed(),n=this.sharedGameControlGlobals.rapierWorld.createRigidBody(r),s=$i.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array).setFrictionCombineRule($i.CoefficientCombineRule.Multiply).setRestitutionCombineRule($i.CoefficientCombineRule.Multiply).setFriction(1).setRestitution(1);this.sharedGameControlGlobals.rapierWorld.createCollider(s,n);for(let[a,o]of t){let l=this.sharedGameControlGlobals.rapierWorld.createCollider(a,n);this.sensorToTriggerEvent[l.handle]=o}}updatePositions(){return this.nActiveRigidBodies=0,this.sharedGameControlGlobals.rapierWorld.forEachRigidBody(this.processRigidBody),this.nActiveRigidBodies>0}rebuildBVH(){this.usePhysics?this.initPhysics():(this.page.traverseEntity(e=>{for(let t of e.dataPatched.events)if(t.data.type==="Trigger"&&t.data.disabled!==!0){let i=new yW(t.id,t.data,e,this.page,this.sharedAssets,this.eventManager),r=new yt().compose(Pu.fromArray(t.data.position),cy.setFromEuler(xW.fromArray(t.data.rotation)),cR);if(t.data.triggerZone==="box"){let n=new Nn;n.min.fromArray(t.data.size).multiplyScalar(-.5),n.max.fromArray(t.data.size).multiplyScalar(.5),this.sharedGameControlGlobals.triggers.push([n,r,e,i])}else this.sharedGameControlGlobals.triggers.push([t.data.radius,r,e,i])}}),this.needsCollisionDetection&&this.initBVH())}disconnectEvents(){this.collisionEvents.forEach(e=>e.disconnect()),this.sharedGameControlGlobals.triggers.forEach(e=>e[3].disconnect()),this.sharedGameControlGlobals.triggers.length=0}deactivate(){if(this.isEnabled){this.isEnabled=!1,this.page.traverse(e=>{let t=e;t.matrixWorldFusedFalse&&(t.matrixWorldFusedFalse=void 0),t.rigidBody&&(t.rigidBody=void 0),t.position0&&(t.position0=void 0),t.rotation0&&(t.rotation0=void 0)}),this.sharedGameControlGlobals.rapierWorld?.free(),this.sharedGameControlGlobals.rapierWorld=void 0,this.sharedGameControlGlobals.staticMeshBVH=void 0,this.accumulator=0,this.sharedGameControlGlobals.entitiesWithTransformAnim=[],this.disconnectEvents(),this.gameControl?.reset(),this.gameControl?.dispose(),this.gameControl=null,this.initializationCounter=-1,this.joysticks.forEach(([e,t])=>{e?.destroy(),t.remove()}),this.joystickToGameControls=[],this.joysticks=[],this.orbitControls&&(this.orbitControls.dispose(),this.orbitControls=void 0),this.navigationMeshWrapper?.dispose(),this.navigationMeshWrapper=void 0;for(let e of Object.values(this.sharedGameControlGlobals.entityToCollisionEvents))e.forEach(t=>t.disconnect());this.sharedGameControlGlobals.entityToCollisionEvents={},this.page.updateMatrixWorld(!0)}}update(e,t,i){if(!this.isEnabled)return!0;let r=!0;if(this.orbitControls!==void 0&&this.orbitControls.needsUpdate&&(this.orbitControls.update(),r=!this.orbitControls.isCurrentlyDamping),this.initializationCounter>=0&&this.initializationCounter<2?(this.initializationCounter++,r=!1):this.initializationCounter===2&&this.gameControl&&(r=!this.gameControl.update(e,t,i)&&r),this.usePhysics===!1&&this.checkTrigger(),this.usePhysics){let n=.016666666666666666;if(e===0)r=this.stepPhysics()&&r;else{let s=e/1e3;s<n&&s>n*.55&&(s=n),this.accumulator+=s;let a=performance.now(),o=0,l=6;for(;this.accumulator>=n&&o<l&&(r=this.stepPhysics()&&r,this.accumulator-=n,o++,!(performance.now()-a>n*1e3)););this.accumulator=this.accumulator%n}}this.skipRender=r}stepPhysics(){for(let e of this.sharedGameControlGlobals.entitiesWithTransformAnim){(e.hasNonUniformScale?e.matrixWorldRigid:e.matrixWorld).decompose(Zn,Tu,Qf),lR.setFromQuaternion(Tu);let t=e;t.prevR===void 0?(t.prevR=lR.clone(),t.prevT=Zn.clone()):(t.prevR.copy(lR),t.prevT.copy(Zn)),e.rigidBody&&(e.rigidBody.setNextKinematicTranslation(Zn.divideScalar(this.pixelsPerMeter)),e.rigidBody.setNextKinematicRotation(Tu))}return this.sharedGameControlGlobals.rapierWorld.step(this.events),this.events?.drainCollisionEvents(this.handleCollisionEvents),!this.updatePositions()}dispatchCollisionEvent(e,t,i){let r=(this.sharedGameControlGlobals.rapierWorld?.getCollider(i))._parent,n;if(t.cloner){for(let s of t.cloner.children)if(s.rigidBody===r){n=s;break}}e.dispatch(n),t.dispatchEvent(AO)}updateUseWindowEvents(e){this.orbitControls?.updateUseWindowEvents(e)}generateSensorColliderDescs(e,t,i){let r=wW.copy(e.matrixWorld).invert();e.traverseEntity((n,s)=>{if(t===!1&&s===1)return!0;for(let a of n.dataPatched.events)if(a.data.type==="Trigger"&&a.data.disabled!==!0){let o=new yW(a.id,a.data,n,this.page,this.sharedAssets,this.eventManager),l;if(a.data.triggerZone==="box"?l=$i.ColliderDesc.cuboid(...a.data.size.map(u=>u/(2*this.pixelsPerMeter))):l=$i.ColliderDesc.ball(a.data.radius/this.pixelsPerMeter),l.setDensity(0).setSensor(!0).setActiveEvents($i.ActiveEvents.COLLISION_EVENTS),Pu.fromArray(a.data.position),cy.setFromEuler(xW.fromArray(a.data.rotation)),pE.compose(Pu,cy,cR).premultiply(n.matrixWorld),i?(pE.decompose(Pu,cy,uR),l.setActiveCollisionTypes($i.ActiveCollisionTypes.KINEMATIC_FIXED|$i.ActiveCollisionTypes.DYNAMIC_FIXED)):(pE.premultiply(r).decompose(Pu,cy,uR),e.rigidBody.bodyType()===$i.RigidBodyType.Dynamic||(e.rigidBody.bodyType()===$i.RigidBodyType.Fixed?l.setActiveCollisionTypes($i.ActiveCollisionTypes.KINEMATIC_FIXED|$i.ActiveCollisionTypes.DYNAMIC_FIXED):l.setActiveCollisionTypes($i.ActiveCollisionTypes.KINEMATIC_KINEMATIC|$i.ActiveCollisionTypes.DYNAMIC_KINEMATIC))),Pu.divideScalar(this.pixelsPerMeter),l.setTranslation(Pu.x,Pu.y,Pu.z),l.setRotation(cy),i)i.push([l,o]);else{let u=this.sharedGameControlGlobals.rapierWorld.createCollider(l,e.rigidBody);this.sensorToTriggerEvent[u.handle]=o}}})}checkTrigger(){let e;for(let t=0;t<this.sharedGameControlGlobals.triggers.length;t++){let[i,r,n,s]=this.sharedGameControlGlobals.triggers[t];for(let a=0;a<this.sharedGameControlGlobals.entitiesWithTransformAnim.length;a++){let o=this.sharedGameControlGlobals.entitiesWithTransformAnim[a];if(n===o||s.isValidTriggeringObject(Xi.is(o)?o:o.object)===!1)continue;let l=wW.copy(n.matrixWorld).decompose(Pu,bW,uR).compose(Pu,bW,cR).multiply(r),u=pE.copy(o.matrixWorld).invert().multiply(l);i instanceof Nn?e=o.bvhGeometry.boundsTree.intersectsBox(i,u):(hR.radius=i,hR.center.setFromMatrixPosition(u),e=o.bvhGeometry.boundsTree.intersectsSphere(hR)),e?s.currentIntersectedObjects.indexOf(o)===-1&&(s.currentIntersectedObjects.push(o),s.dispatch(),n.dispatchEvent(bBe)):s.currentIntersectedObjects=s.currentIntersectedObjects.filter(c=>c!==o)}}}};function MBe(e){let t=this._clip.duration,i=this._clip.start??0,r=this.loop,n=this.time+e,s=this._loopCount,a=r===qz;if(e===0)return s===-1?n:a&&(s&1)===1?t-(n-i):n;if(r===Z7){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=t)n=t;else if(n<0)n=0;else{this.time=n;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),n>=t||n<i){let o=Math.floor((n-i)/(t-i));n-=(t-i)*o,s+=Math.abs(o);let l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,a||(n=e>0?t:i,this.repetitions===1&&(n=t)),this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){let u=e<0;this._setEndings(u,!u,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=n;if(a&&(s&1)===1)return t-(n-i)}return n}var _W=!1,ABe=class{constructor(e,t,i,r){this.scene=e,this.requestRender=t,this.updateDisplayProgress=i,this.animationInspectorState=r,this.clipIdToAction={},this.activeClip=null,this.needsUpdate=!1,this.addClip=n=>{n.data.type==="Empty"&&n.data.animations&&n.data.animations.forEach((s,a)=>{let o=s[0]+"/";if(Array.isArray(n.identity)?o+=n.identity[0]:o+=n.uuid,this.clipIdToAction[o])return;let l=LI.parse(JSON.parse(s[2]));n.animations[a]=l;let u=this.mixer.clipAction(l,n);_W===!1&&(Object.getPrototypeOf(u)._updateTime=MBe,_W=!0),u.clampWhenFinished=!0,this.clipIdToAction[o]=u})},this.mixer=new I0e(e),this.scene.traverseEntity(this.addClip)}deleteClip(e,t){let i=this.scene.find(t);if(!i)return;let r=i.animations.find(s=>s.uuid===e);if(!r)return;let n=this.clipIdToAction[e];!n||(n.stop(),this.mixer.uncacheClip(r),delete this.clipIdToAction[e],i.animations=i.animations.filter(s=>s.uuid!==e))}get isPlaying(){return Object.values(this.clipIdToAction).some(e=>e.isRunning())}playFromInspector(e){this.mixer.stopAllAction();let t=this.clipIdToAction[e];!t||(t.play(),this.activeClip=t.getClip(),this.requestRender())}onExitPlayMode(){Object.values(this.clipIdToAction).forEach(e=>{e.repetitions=1/0,e.loop=J7}),this.mixer.stopAllAction(),this.requestRender()}play(e){let t=e.clipId+"/"+e.object,i=this.clipIdToAction[t];if(i)return e&&(e.repeat>=0&&(i.repetitions=e.repeat+1),e.direction==="pingpong"&&e.repeat!==0&&(i.loop=qz)),i.play(),i.paused=!1,this.requestRender(),i}resumeFromInspector(e){let t=this.clipIdToAction[e];!t||(t.play(),t.paused=!1,this.requestRender())}pauseFromInspector(e){let t=this.clipIdToAction[e];!t||(t.paused=!0)}stop(){this.mixer.stopAllAction(),this.requestRender()}update(e){if(this.needsUpdate)this.needsUpdate=!1;else if(this.isPlaying===!1||this.animationInspectorState?.isScrubbing)return;this.mixer.update(e/1e3),this.activeClip&&this.updateDisplayProgress(Math.round(this.mixer.time/this.activeClip.duration*(this.maxFrames-1)%(this.maxFrames-1))),this.requestRender()}get maxFrames(){return jK(this.activeClip??void 0)}setProgressFromInspector(e,t){if(!this.clipIdToAction[t])return;this.activeClip!==this.clipIdToAction[t].getClip()&&this.playFromInspector(t);let i=this.clipIdToAction[t].paused;this.clipIdToAction[t].paused=!1,this.mixer.setTime(Math.min(e/(this.maxFrames-1),.9999)*this.activeClip.duration),this.requestRender(),i&&(this.clipIdToAction[t].paused=!0)}},dR=new WeakMap,EBe=class extends H_{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,r){let n=new OI(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,s=>{this.decodeDracoFile(s,t).catch(r)},i,r)}decodeDracoFile(e,t,i,r){let n={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!i};return this.decodeGeometry(e,n).then(t)}decodeGeometry(e,t){let i=JSON.stringify(t);if(dR.has(e)){let o=dR.get(e);if(o.key===i)return o.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r,n=this.workerNextTaskID++,s=e.byteLength,a=this._getWorker(n,s).then(o=>(r=o,new Promise((l,u)=>{r._callbacks[n]={resolve:l,reject:u},r.postMessage({type:"decode",id:n,taskConfig:t,buffer:e},[e])}))).then(o=>this._createGeometry(o.geometry));return a.catch(()=>!0).then(()=>{r&&n&&this._releaseTask(r,n)}),dR.set(e,{key:i,promise:a}),a}_createGeometry(e){let t=new Kt;e.index&&t.setIndex(new hi(e.index.array,1));for(let i=0;i<e.attributes.length;i++){let r=e.attributes[i],n=r.name,s=r.array,a=r.itemSize;t.setAttribute(n,new hi(s,a))}return t}_loadLibrary(e,t){let i=new OI(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((r,n)=>{i.load(e,r,void 0,n)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{let r=i[0];e||(this.decoderConfig.wasmBinary=i[1]);let n=CBe.toString(),s=["/* draco decoder */",r,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([s]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(n){let s=n.data;switch(s.type){case"decode":r._callbacks[s.id].resolve(s);break;case"error":r._callbacks[s.id].reject(s);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+s.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,n){return r._taskLoad>n._taskLoad?-1:1});let i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}};function CBe(){let e,t;onmessage=function(a){let o=a.data;switch(o.type){case"init":e=o.decoderConfig,t=new Promise(function(c){e.onModuleLoaded=function(h){c({draco:h})},DracoDecoderModule(e)});break;case"decode":let l=o.buffer,u=o.taskConfig;t.then(c=>{let h=c.draco,d=new h.Decoder,p=new h.DecoderBuffer;p.Init(new Int8Array(l),l.byteLength);try{let m=i(h,d,p,u),v=m.attributes.map(g=>g.array.buffer);m.index&&v.push(m.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:m},v)}catch(m){console.error(m),self.postMessage({type:"error",id:o.id,error:m.message})}finally{h.destroy(p),h.destroy(d)}});break}};function i(a,o,l,u){let c=u.attributeIDs,h=u.attributeTypes,d,p,m=o.GetEncodedGeometryType(l);if(m===a.TRIANGULAR_MESH)d=new a.Mesh,p=o.DecodeBufferToMesh(l,d);else if(m===a.POINT_CLOUD)d=new a.PointCloud,p=o.DecodeBufferToPointCloud(l,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());let v={index:null,attributes:[]};for(let g in c){let w=self[h[g]],S,_;if(u.useUniqueIDs)_=c[g],S=o.GetAttributeByUniqueId(d,_);else{if(_=o.GetAttributeId(d,a[c[g]]),_===-1)continue;S=o.GetAttribute(d,_)}v.attributes.push(n(a,o,d,g,w,S))}return m===a.TRIANGULAR_MESH&&(v.index=r(a,o,d)),a.destroy(d),v}function r(a,o,l){let u=l.num_faces()*3,c=u*4,h=a._malloc(c);o.GetTrianglesUInt32Array(l,c,h);let d=new Uint32Array(a.HEAPF32.buffer,h,u).slice();return a._free(h),{array:d,itemSize:1}}function n(a,o,l,u,c,h){let d=h.num_components(),p=l.num_points()*d,m=p*c.BYTES_PER_ELEMENT,v=s(a,c),g=a._malloc(m);o.GetAttributeDataArrayForAllPoints(l,h,v,m,g);let w=new c(a.HEAPF32.buffer,g,p).slice();return a._free(g),{name:u,array:w,itemSize:d}}function s(a,o){switch(o){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}var yp;function SW(e){return yp||(yp=new EBe,yp.setDecoderPath(e?`${e}/`:"https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload()),yp.decoderPending}async function TBe(e){if(yp){let t={attributeIDs:yp.defaultAttributeIDs,attributeTypes:yp.defaultAttributeTypes,useUniqueIDs:!1},i;try{i=await yp.decodeGeometry(new Int8Array(e).buffer,t)}catch(r){console.error(r)}if(i)return{index:i.index?{array:i.index.array}:void 0,attributes:Object.entries(i.attributes).map(([r,n])=>({name:r,itemSize:n.itemSize,array:n.array}))}}return null}async function PBe(e,t){let[i,r]=GX(D2.deserialize(new Uint8Array(e)));return cY(i),r.result().data}function DBe(e){let t=[];return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="NonParametricGeometry"&&r.geometry.data.draco!==void 0&&t.push(r)}),t}async function MW(e){for(let t of e){let i=await TBe(t.geometry.data.draco);if(i){let r=t.geometry.data;i.index&&(r.index={array:i.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let n={};i.attributes.forEach(({name:s,array:a,itemSize:o})=>{n[s]={array:a,itemSize:o,type:"Float32Array",normalized:!1}}),r.attributes=n,r.draco=void 0}}}var RBe=class{constructor(){this._clickCount=0,this._lastTime=0,this._lastPosition=[0,0],this._delay=500,this._distance=2,this._onMouseDown=e=>{let t=[e.clientX,e.clientY],i=new Date().getTime();if(this._clickCount>0){let r=t[0]-this._lastPosition[0],n=t[1]-this._lastPosition[1];Math.sqrt(r*r+n*n)>this._distance&&(this._clickCount=0)}this._lastPosition=t,this._clickCount=i-this._lastTime>this._delay?1:this._clickCount+1,this._lastTime=i},this._onMouseUp=e=>{}}start(e,t=500,i=2){this._target&&this.stop(),this.reset(),this._delay=t,this._distance=i,this._target=e,this._target.addEventListener("pointerdown",this._onMouseDown,!1),this._target.addEventListener("pointerup",this._onMouseUp,!1)}stop(){this._target&&(this._target.removeEventListener("pointerdown",this._onMouseDown,!1),this._target.removeEventListener("pointerup",this._onMouseUp,!1),this._target=void 0)}get clickCount(){return this._clickCount}reset(){this._clickCount=0,this._lastTime=0,this._lastPosition=[0,0]}},IBe=class{constructor(e,t,i,r,n,s,a,o){this.eventId=e,this.id=t,this.data=i,this.dataEvent=r,this.object=n,this.stage=!1,this.actions=os(r,i.actions,s,a,o,n)}disconnect(){Ws(this.actions)}dispatchIn(){this.actions.Audio.forEach(e=>e.dispatchBasic()),this.actions.Particles.forEach(e=>e.dispatchBasic()),this.actions.Video.forEach(e=>e.dispatchBasic()),this.actions.Create.forEach(e=>e.dispatch()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.Reset.forEach(e=>e.dispatch()),this.actions.Link.forEach(e=>e.dispatch()),this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.actions.Transition.forEach(e=>e.toggle()),this.actions.Animation.forEach(e=>e.play()),this.actions.SwitchCamera.forEach(e=>e.play()),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch())}dispatchOut(){this.actions.Transition.forEach(e=>{e.toggle()})}},LBe=class extends Va{constructor(e,t){super(e),this.eventManager=t,this.breakpoints=[],this.resize=(i,r)=>{this.breakpoints.forEach(n=>{let s=tL.deviceToSize(n.data.size),a=n.dataEvent.orientation==="horizontal"?i:r,o;switch(n.data.operator){case"<":o=a<s[0];break;case">":o=a>s[0];break;case"<>":o=a>s[0]&&a<s[1];break}n.stage!==o&&(n.stage=o,n.stage?n.dispatchIn():n.dispatchOut())})},this.onResizeObserver=new ResizeObserver(i=>{for(let r of i){let{width:n,height:s}=r.contentRect;this.resize(n,s)}})}connect(){let{page:e,sharedAssets:t,domElement:i}=this.eventContext;this.onResizeObserver.observe(i);let r=n=>{if(!(!n.visible||!n.data?.events.length))for(let{data:s,id:a}of n.data.events)s.disabled||s.type==="Resize"&&s.breakpoints.forEach(({data:o,id:l})=>{try{let u=new IBe(a,l,o,s,n,e,t,this.eventManager);this.breakpoints.push(u)}catch{}})};e.traverseEntity(n=>{(n instanceof ka||n instanceof Ns)&&n.frame?.traverse(s=>{r(s)}),r(n)})}disconnect(){this.onResizeObserver.disconnect(),this.breakpoints.forEach(e=>{e.disconnect()}),this.breakpoints=[]}},OBe=class extends Va{constructor(e,t){super(e),this.eventManager=t,this.userAPIs={},this.events=[],this.onSuccess=({userAPIId:i})=>{this.events.forEach(r=>{r.data.userAPIId===i&&r.dispatchSuccess()})},this.onError=({userAPIId:i})=>{this.events.forEach(r=>{r.data.userAPIId===i&&r.dispatchError()})},this.userAPIs=e.sharedAssets.getUserAPIs()}connect(){this.eventContext.page.traverseEntity(e=>{e.data?.events.filter(t=>t.data.type==="API"&&!t.data.disabled).forEach(t=>{this.events.push(new zBe(t.id,t.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),Object.entries(this.userAPIs).forEach(([e,t])=>{t.on("success",this.onSuccess),t.on("error",this.onError),t.autostart&&t.callUserAPI(this.eventContext.sharedAssets)})}disconnect(){Object.entries(this.userAPIs).forEach(([e,t])=>{t.off("success",this.onSuccess),t.off("error",this.onError)})}},zBe=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.successActions=os(t,t.successActions,r,n,s,i),this.errorActions=os(t,t.errorActions,r,n,s,i)}dispatchSuccess(){this.dispatchActions(this.successActions)}dispatchError(){this.dispatchActions(this.errorActions)}dispatchActions(e){e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}},kBe=class extends Va{constructor(e,t){super(e),this.eventManager=t,this.userWebhooks={},this.events=[],this.onMessage=({userWebhookId:i})=>{this.events.forEach(r=>{r.data.userWebhookId===i&&r.dispatch()})},this.userWebhooks=e.sharedAssets.getUserWebhooks()}connect(){this.eventContext.page.traverseEntity(e=>{e.data?.events.filter(t=>t.data.type==="WEBHOOK"&&!t.data.disabled).forEach(t=>{this.events.push(new BBe(t.id,t.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),Object.entries(this.userWebhooks).forEach(([e,t])=>{t.connect(),t.on("message",this.onMessage)})}disconnect(){Object.entries(this.userWebhooks).forEach(([e,t])=>{t.off("message",this.onMessage),t.disconnect()})}},BBe=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=os(t,t.actions,r,n,s,i)}dispatch(){let e=this.actions;e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}};function NBe(){let e=document.createElement("textarea");return e.style.position="fixed",e.style.top="200px",e.style.left="400px",e.style.zIndex="-1",e.style.border="1px solid rgba(255,0,0,0.5)",e.style.width="10px",e.style.height="500px",e.style.color="white",e.style.opacity="0.5",e.style.background="transparent",e.style.display="none",e.style.margin="0px",e.style.padding="0px",e.style.boxSizing="content-box",e.style.pointerEvents="none",e}var FBe=new H(0,0,1),AW=new H,EW=new H,CW=new rs,UBe=class{constructor(e,t,i,r,n){this.containerScene=e,this.raycaster=t,this.sharedAssets=i,this.requestRender=r,this.onExit=n,this.htmlInput=null,this.virtualInput=null,this.helper=new tK,this.doubleClickHandler=new RBe,this.isDragging=!1,this.plane=new Oo,this.caretInterval=0,this.planeIntersection=new H,this.projected=new Pe,this._lastIndex=0,this._isFirstDragMove=!1,this.selectionOnDragStart=0,this.onTextMaterialChanged=()=>{let s=this.virtualInput?.data;if(this.virtualInput!==void 0&&s){let a=s.material,o=typeof a=="string"?this.sharedAssets.data.materials[a]:a,l=HLe(o,this.sharedAssets);this.helper.setCaretColor(l)}},this.stopAnimateTextCursor=()=>{clearInterval(this.caretInterval),this.helper&&(this.helper.caretMesh.visible=!1)},this.startAnimateTextCursor=()=>{this.stopAnimateTextCursor(),this.helper&&(this.helper.caretMesh.visible=!0,this.caretInterval=setInterval(()=>{this.helper&&(this.helper.caretMesh.visible=!this.helper.caretMesh.visible),this.requestRender()},600))},this.handleCaretUpdate=s=>{if(!this.htmlInput||!this.virtualInput)return;let a=this.helper,o=s?.key==="ArrowLeft"||s?.key==="ArrowRight",l=s?.key==="ArrowUp"||s?.key==="ArrowDown";this.htmlInput.selectionStart===this.htmlInput.selectionEnd?(a.setCaretPosition(this.htmlInput.selectionStart,{horizontalKeyMove:o,verticalKeyMove:l}),this.startAnimateTextCursor()):a.setSelection(this.htmlInput.selectionStart,this.htmlInput.selectionEnd),this.requestRender()},this.containerScene.add(this.helper)}createInput(){return this.htmlInput=NBe(),this.htmlInput}connect(){}disconnect(){this.stopAnimateTextCursor(),this.helper.hide(),this.htmlInput?.remove(),this.doubleClickHandler.stop()}handleMouseDown(){if(!this.htmlInput||!this.virtualInput)return!0;this.getPointOnPlane();let e=this.doubleClickHandler.clickCount,{index:t,lineIndex:i,characterIndex:r}=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,e>1?"inside":"previous")??{index:0,lineIndex:0,characterIndex:0};this.virtualInput?.wrappedText?.length&&this.virtualInput.wrappedText[i][Math.max(0,r-1)]===`
`&&(t--,r--),this._lastIndex=t,this._isFirstDragMove=!0;let n=this.checkClickedObject();if(e===1){if(n===null)return this.onExit(this.virtualInput),!0;this.selectionOnDragStart=t,this.isDragging=!0,this.setInputSelection(t)}else n===this.virtualInput&&(e===2?this.selectClosestWord(i,r):e>2&&(this.setInputSelection(0,this.htmlInput.value.length),this.doubleClickHandler.reset()))}handleMouseUp(){this.applyRangeToTextInput(),this.isDragging=!1,this._isFirstDragMove=!1}handleMouseMove(){!this.virtualInput||(this._isFirstDragMove&&this.doubleClickHandler.clickCount>1&&(this.selectionOnDragStart=this._lastIndex,this.isDragging=!0,this.setInputSelection(this._lastIndex)),this._isFirstDragMove=!1,this.getPointOnPlane(),this.applyRangeToTextInput())}focus(e){if(this.virtualInput=e,this.updateTextInputStyles(),this.htmlInput)if(e){let t=this.data?.geometry.text;this.htmlInput.value=typeof t=="string"?"":t?.textValue.toString()??""}else this.htmlInput.value=""}blur(){}get data(){let{virtualInput:e}=this;if(e)return e.dataPatched}applyRangeToTextInput(){if(!this.isDragging||!this.virtualInput||!this.htmlInput)return;let e=this.selectionOnDragStart,{index:t,lineIndex:i,characterIndex:r}=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,this.doubleClickHandler.clickCount>2?"inside":"previous")??{index:0};i!==void 0&&r!==void 0&&this.virtualInput?.wrappedText[i][r-1]===`
`&&t--,this.htmlInput.setSelectionRange(Math.min(e,t),Math.max(e,t))}checkClickedObject(){if(this.virtualInput){let e=this.raycaster.intersectObject(this.virtualInput,!1);if(e.length>0){let t=e[0];if(t.object instanceof TB)return t.object}}return null}selectClosestWord(e,t){if(!this.virtualInput)return;let i=this.virtualInput.wrappedText,r=i[e],n=t+1,s=t;r[t]!==" "&&(n=this.findNextCharOccurence(r,t,"forward"," "),s=this.findNextCharOccurence(r,t,"backward"," "),s>0&&s++,n>=r.length-1&&e===i.length-1&&n++);let a=this.helper,o=a.getGlobalIndexFromLineAndCharIndexes(i,e,s),l=a.getGlobalIndexFromLineAndCharIndexes(i,e,n);this.setInputSelection(o,l)}findNextCharOccurence(e,t,i,r=" "){let n=Math.max(0,e.length-1),s=i==="forward"?n:0,a=i==="forward"?1:-1,o=Math.max(Math.min(t,n),0);for(;o!==s;)if(o+=a,e.charAt(o)===r)return o;return s}getPointOnPlane(){let e=this.virtualInput?.data;if(!(!this.virtualInput||!e)&&this.raycaster.ray.intersectsPlane(this.plane)){this.planeIntersection===null&&(this.planeIntersection=new H);let t=this.raycaster.ray.intersectPlane(this.plane,this.planeIntersection);if(t){this.planeIntersection.copy(this.virtualInput.worldToLocal(t));let i=typeof e.geometry.width=="number"?e.geometry.width:1,r=typeof e.geometry.height=="number"?e.geometry.height:1;this.projected.set(t.x+i*.5,t.y-r*.5)}}}updatePlane(){let e=this.virtualInput?.data;this.virtualInput&&e&&(CW.getNormalMatrix(this.virtualInput.matrixWorld),AW.copy(FBe).applyMatrix3(CW).normalize(),this.virtualInput.localToWorld(EW.set(0,0,e.geometry.depth)),this.plane.setFromNormalAndCoplanarPoint(AW,EW))}setInputSelection(e,t=e){this.htmlInput?.setSelectionRange(e,t),Gx&&this.htmlInput?.focus(),setTimeout(()=>{this.htmlInput?.focus()})}updateTextInputStyles(){let e=this.virtualInput?.data;this.virtualInput&&e&&this.htmlInput&&(this.htmlInput.style.fontSize=e.geometry.fontSize+"px",this.htmlInput.style.letterSpacing=e.geometry.letterSpacing*e.geometry.fontSize+"px",this.htmlInput.style.lineHeight=e.geometry.fontSize*e.geometry.lineHeight+"px",this.htmlInput.style.width=e.geometry.width+"px",this.htmlInput.style.height=e.geometry.height+"px",this.htmlInput.style.textAlign=VBe(e.geometry.horizontalAlign))}};function VBe(e){return e===4?"justify":e===2?"right":e===3?"center":"left"}var oZ=(e,t)=>{if(typeof e=="string"){let i=t.data(e);if(i)return oZ(i.value,t)}return va.getDisplayedValue(e)};function TW(e,t){let i=e.text,r="";if(typeof i=="string"){let n=t.variables.data(r);n&&(r=oZ(n.value,t.variables))}else r=i.textValue.toString();return r}var jBe=class extends Va{constructor(e,t){super(e),this.eventManager=t,this._textInputs=[],this.sceneHelpers=new Ho,this.helper=new tK,this._onMouseDownFocusIn=i=>{if(pi.length>1)return;this.eventContext.updateRaycaster(i);let r=null;if(this.eventContext.raycaster){for(let n of this._textInputs)if(this.eventContext.raycaster.intersectObject(n,!0).length>0){r=n;break}}this.focusOnTextInput(r),this._onCaretUpdate(),this._onMouseUp(),this.textInputManager.doubleClickHandler.start(this.eventContext.domElement),this.textInputManager.doubleClickHandler._onMouseDown(i),this._onMouseDown(i)},this.onExit=()=>{let{virtualInput:i}=this.textInputManager;if(i===null)return;let r=this.textInputManager.htmlInput;this.helper.hide(),r?.setSelectionRange(r.value.length,r.value.length),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0);let{domElement:n}=this.eventContext;n.removeEventListener("pointerdown",this._onMouseDown,!1),n.removeEventListener("pointerup",this._onMouseUp,!1),n.removeEventListener("pointermove",this._onMouseMove,!1),window.removeEventListener("keydown",this._onKeyPress),this.textInputManager.doubleClickHandler.reset(),n.addEventListener("pointerdown",this._onMouseDownFocusIn),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers()},this._onMouseDown=i=>{this.eventContext.updateRaycaster(i),this.textInputManager.handleMouseDown(),this.textInputManager.virtualInput&&this.eventContext.raycaster.intersectObject(this.textInputManager.virtualInput,!0).length>0&&this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1)},this._onMouseUp=()=>{this.textInputManager.handleMouseUp(),this.eventManager.controlsManager.orbitControls&&!this.eventManager.controlsManager.orbitControls.enabled&&(this.eventManager.controlsManager.orbitControls.enabled=!0)},this._onMouseMove=i=>{this.eventContext.updateRaycaster(i),this.textInputManager.handleMouseMove()},this._onTextEdit=i=>{let{htmlInput:r,virtualInput:n,helper:s}=this.textInputManager;if(!r||!n)return;let a=r.value;n.textGeometry.setText(a,this.eventContext.sharedAssets).then(()=>{this.eventContext.requestRender()});let o=n.data;s.update();let l=o.geometry.text;if(typeof l=="string"){let u=l;this.eventContext.sharedAssets.updateVariable(u,{textValue:a})}this.textInputManager.updateTextInputStyles(),this._onCaretUpdate()},this._onCaretUpdate=i=>{this.textInputManager.handleCaretUpdate(i)},this._onKeyPress=i=>{i.key==="Escape"&&this.onExit()},this.textInputManager=new UBe(this.sceneHelpers,e.raycaster,e.sharedAssets,e.requestRender,this.onExit)}connect(){let e=[];if(this.eventContext.scene.traverseEntity(r=>{r instanceof TB&&e.push(r)}),this._textInputs=e,e.length===0)return;let{domElement:t}=this.eventContext;t.addEventListener("pointerdown",this._onMouseDownFocusIn),this.textInputManager.connect();let i=this.textInputManager.createInput();document.body.appendChild(i),i.style.display="none",i.addEventListener("keyup",this._onCaretUpdate),i.addEventListener("keydown",this._onCaretUpdate),i.addEventListener("beforeinput",this._onCaretUpdate),i.addEventListener("paste",this._onCaretUpdate),i.addEventListener("cut",this._onCaretUpdate),i.addEventListener("select",this._onCaretUpdate),i.addEventListener("selectstart",this._onCaretUpdate)}disconnect(){let e=this.textInputManager.htmlInput,{domElement:t,sharedAssets:i}=this.eventContext;t.removeEventListener("pointerdown",this._onMouseDownFocusIn),e?.removeEventListener("keyup",this._onCaretUpdate),e?.removeEventListener("keydown",this._onCaretUpdate),e?.removeEventListener("beforeinput",this._onCaretUpdate),e?.removeEventListener("paste",this._onCaretUpdate),e?.removeEventListener("cut",this._onCaretUpdate),e?.removeEventListener("select",this._onCaretUpdate),e?.removeEventListener("selectstart",this._onCaretUpdate),this._textInputs.forEach(r=>{let n=TW(r.data.geometry,this.eventContext.sharedAssets.data);r.textGeometry.setText(n,i)}),t.removeEventListener("pointerdown",this._onMouseDown,!1),t.removeEventListener("pointerup",this._onMouseUp,!1),t.removeEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers(),this.textInputManager.disconnect()}focusOnTextInput(e){this.textInputManager.focus(e),this.textInputManager.onTextMaterialChanged();let t=this.textInputManager.htmlInput;if(!t||e===null)return;this.textInputManager.updateTextInputStyles(),this.eventContext.renderer.sceneHelpersOnTop=this.sceneHelpers,this.eventContext.renderer.pipeline.enableHelpers(),this.textInputManager.isDragging=!1;let i=TW(e.textGeometry.userData.parameters,this.eventContext.sharedAssets.data);t.value=i,t.setSelectionRange(0,0),this.textInputManager.helper.show(e),t.style.display="block",t.addEventListener("input",this._onTextEdit),this.textInputManager.updatePlane();let{domElement:r}=this.eventContext;r.removeEventListener("pointerdown",this._onMouseDownFocusIn),r.addEventListener("pointerdown",this._onMouseDown,!1),r.addEventListener("pointerup",this._onMouseUp,!1),r.addEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress)}},HBe=class extends Va{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.onVoice=({value:i,frequencies:r})=>{this.events.forEach(n=>{n.dispatch()})}}connect(){this.openAIRealtime=this.eventContext.sharedAssets.openAIRealtime,this.openAIRealtime&&(this.eventContext.page.traverseEntity(e=>{e.data?.events.filter(t=>t.data.type==="AIAssistantListener"&&!t.data.disabled).forEach(t=>{this.events.push(new WBe(t.id,t.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.openAIRealtime.on("voice",this.onVoice))}disconnect(){this.openAIRealtime?.off("voice",this.onVoice)}},WBe=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=os(t,t.actions,r,n,s,i)}dispatch(){this.dispatchActions(this.actions)}dispatchActions(e){e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}},GBe=class extends Va{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.onTriggerEvent=({description:i,direction:r})=>{let n=this.events.find(s=>s.data.description===i);n&&(r==="backward"?n.dispatchReverse():n.dispatch())}}connect(){this.openAIRealtime=this.eventContext.sharedAssets.openAIRealtime,this.openAIRealtime&&(this.eventContext.page.traverseEntity(e=>{e.data?.events.filter(t=>t.data.type==="AIAssistantTrigger"&&!t.data.disabled).forEach(t=>{this.events.push(new qBe(t.id,t.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.openAIRealtime.on("trigger_event",this.onTriggerEvent))}disconnect(){this.openAIRealtime?.off("trigger_event",this.onTriggerEvent)}},qBe=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=os(t,t.actions,r,n,s,i)}dispatch(){let e=this.actions;e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}dispatchReverse(){let e=this.actions;e.Transition.forEach(t=>t.reverseFromCurrent()),e.Particles.forEach(t=>t.reverseFromCurrent()),e.Animation.forEach(t=>t.reverseFromCurrent()),e.SwitchCamera.forEach(t=>t.reverseFromCurrent()),e.Create.forEach(t=>t.dispatchStop())}},XBe=class{constructor(e,t,i,r,n){this.publish=e,this.controlsManager=t,this.animationControls=i,this.eventContext=r,this.sharedVariables=n,this.isEnabled=!1,this.activateCount=0,this.needsMouse=!1,this.needsRaycast=!1,this.onTouchMovePreventScroll=s=>{let a=window.parent!==window,o=document.documentElement.scrollHeight>document.documentElement.clientHeight||document.documentElement.scrollWidth>document.documentElement.clientWidth;(s.touches.length>1||this.preventTouchScroll||a===!1&&o===!1)&&s.preventDefault()},this.onMouseWheelPreventScroll=s=>{this.preventScroll&&s.preventDefault()},this.onMouseMove=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:s.buttons>0}},this.onMouseDown=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:!0}},this.onMouseUp=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:!1}},this.getMousePosition=s=>{let{domRect:a}=this.eventContext,{pageX:o,pageY:l}=s.touches?.length>0?s.touches[0]:s;return{x:o-(a.left+window.scrollX),y:l-(a.top+window.scrollY)}},this.stopRaycast=e.stopRaycast,this.preventScroll=e.preventScroll,this.preventTouchScroll=e.preventTouchScroll,this.hideCursor=e.hideCursor,this.requestRender=r.requestRender}activate(e=!1){if(this.isEnabled)return;this.isEnabled=!0,this.initializeActionsDependentStates(),this.needsMouse&&(this.eventContext.domElement.addEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.addEventListener("pointerdown",this.onMouseDown)),this.handlers={Spline:new _ke(this.eventContext),VariableChange:new eBe(this.eventContext,this.sharedVariables,this,this.needsMouse,this.needsRaycast),API:new OBe(this.eventContext,this),WEBHOOK:new kBe(this.eventContext,this),AIAssistantListener:new HBe(this.eventContext,this),AIAssistantTrigger:new GBe(this.eventContext,this),Conditional:new Pke(this.eventContext,this),Start:new Jke(this.eventContext,this),Basic:new Mke(this.eventContext,this,this.needsRaycast),MouseHover:new Xke(this.eventContext,this),Scroll:new Kke(this.eventContext,this),Follow:new Fke(this.eventContext,this),DragDrop:new Oke(this.eventContext,this),LookAt:new Wke(this.eventContext),Resize:new LBe(this.eventContext,this),Textfields:new jBe(this.eventContext,this)};let{page:t,domElement:i}=this.eventContext;this.hideCursor&&(i.style.cursor="none"),t.traverseEntity(r=>{r.addEventListener("requestRender",this.requestRender)}),Object.values(this.handlers).forEach(r=>r.connect()),i.addEventListener("wheel",this.onMouseWheelPreventScroll),i.addEventListener("touchmove",this.onTouchMovePreventScroll),this.activateCount++,e||this.eventContext.sharedAssets.openAIRealtime?.connect()}deactivate(e=!1){if(!this.isEnabled)return;this.isEnabled=!1,this.eventContext.domElement.removeEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.removeEventListener("pointerdown",this.onMouseDown),this.eventContext.domElement.removeEventListener("pointerup",this.onMouseUp),this.eventContext.sharedAssets.mouseProperty=null,this.eventContext.sharedAssets.raycastProperty=null;let{page:t,domElement:i}=this.eventContext;i.style.cursor="",Object.values(this.handlers).forEach(r=>r.disconnect()),this.controlsManager.gameControl?.disposeActions(),this.controlsManager.disconnectEvents(),t.traverseEntity(r=>{r.removeEventListener("requestRender",this.requestRender),r.destroyedInAction=!1}),i.removeEventListener("touchmove",this.onTouchMovePreventScroll),i.removeEventListener("wheel",this.onMouseWheelPreventScroll),this.animationControls.onExitPlayMode(),e||this.eventContext.sharedAssets.openAIRealtime?.disconnect()}get isPaused(){return this.isEnabled}pause(){this.deactivate()}resume(){this.activate()}reset(){this.deactivate(!0),this.activate(!0),this.controlsManager.deactivate(),this.controlsManager.activate(this),this.controlsManager.page.updateMatrixWorld(!0),this.controlsManager.rebuildBVH()}updateUseWindowEvents(e){let t=this.isEnabled;t&&this.deactivate(),this.eventContext.useWindowEvents=e,t&&this.activate()}initializeActionsDependentStates(){let e=this.eventContext.sharedAssets;e.resetDynamicVariablePlayState();let t=i=>{if(i.data.type==="Conditional"&&(i.data.ifActions.forEach(t),i.data.elseActions.forEach(t)),i.data.type==="Conditional"||i.data.type==="SetVariable")for(let r of i.data.type==="Conditional"?i.data.condition:i.data.expression)"id"in r&&Array.isArray(r.id)&&(r.id[0]==="mouse"&&(this.needsMouse=!0),r.id[0]==="raycast"&&(this.needsRaycast=!0));i.data.type==="DynamicVariablePlay"&&i.data.variableId!==""&&(i.data.mode==="Play"||i.data.mode==="PlayPause"||i.data.mode==="Toggle")&&e.setDynamicVariablePlayState(i.data.variableId,"Stopped")};this.eventContext.page.traverseEntity(i=>{if(i.data?.events.length)for(let r of i.data.events)if(r.data.type==="VariableChange"&&(r.data.variableId==="mouseProperty"&&(this.needsMouse=!0),r.data.variableId==="raycastProperty"&&(this.needsRaycast=!0)),r.data.type==="Conditional")for(let n of["inActions","outActions"])r.data[n].forEach(t);else if(r.data.type==="DragDrop")for(let n of["drag","drop"])r.data.dragDropActions[n].forEach(t);else if(r.data.type==="GameControl")for(let n of["idle","move","jump","run"])r.data.gameActions[n].forEach(t);else if(r.data.type==="Resize")for(let n of r.data.breakpoints)n.data.actions.forEach(t);else r.data.type==="LookAt"||r.data.type==="API"||r.data.actions.forEach(t)})}},YBe=class{constructor(e,t,i,r,n){this._aspect=1,this.enableResponsive=!1,this._renderer=e,this._camera=t,this._frameSize=new Pe().copy(i),this._editorSize=new Pe().copy(r),this._aspect=t.aspect,this._fov=n??t.fov}set frameSize(e){this._frameSize.copy(e)}updateRenderer(){!this._renderer||this._renderer.setSize(this._frameSize.x,this._frameSize.y)}updateViewport(){if(!this._renderer||!this._camera||this._camera.cameraType!=="PerspectiveCamera")return;let e=this._frameSize.x,t=this._frameSize.y,i=this._editorSize.y;this._aspect=e/t,t<=i&&(this._camera.zoom*=i/t),this._renderer.setViewport(0,0,e,t)}updateCamera(e=!0){if(this._camera)if(this._camera.cameraType==="PerspectiveCamera"){let t=this._frameSize.y,i=this._editorSize.y,r=this._fov;if(e&&t>i){let n=QBe(t,1080,2160,1,15)/100;r*=t/i,r*=1-n}this._camera.aspect=this._aspect,this._camera.fov=r,this._camera.updateProjectionMatrix()}else this._camera.setViewplaneSize(this._frameSize.x,this._frameSize.y,this.enableResponsive)}setCamera(e){this._camera=e,this._aspect=e.aspect,this._fov=e.fov}revert(){let e=window.innerWidth,t=window.innerHeight;this._renderer&&(this._renderer.setViewport(0,0,e,t),this._renderer.setSize(e,t)),this._camera&&(this._camera.aspect=e/t,this._camera.fov=this._fov,this._camera.setViewplaneSize(e,t,this.enableResponsive),this._camera.updateProjectionMatrix())}};function QBe(e,t,i,r,n){return(e-t)/(i-t)*(n-r)+r}var KBe=class{get sharedAssets(){return this.shared}constructor(e,t={},i=!0){this.shared=new vB(e.shared,t,!0,i),this.scene=new RB(e.scene,this.sharedAssets),this.shared.setEntityOpContext({scene:this.scene,shared:this.shared})}reset(e,t){this.scene.clearScene(),this.sharedAssets.reset(e.shared),this.scene.resetAfterClear(e.scene,this.sharedAssets)}resetPersonalCameraFromDocumentData(){for(let e of this.scene.children)e instanceof Ns&&!e.uiScene&&e.personalCamera.updateState(e.data.camera,{scene:this.scene,shared:this.shared})}dispose(){this.scene.dispose(),this.shared.dispose()}gc(){this.shared.geometryCache.startGc(),this.shared.geometryCache2.startGc(),this.scene.traverseEntity(e=>{e instanceof kn&&e.markGeometryAsReachable(this.shared)}),this.shared.geometryCache.endGc(),this.shared.geometryCache2.endGc()}},ZBe=class{constructor({x:e=10,y:t=10}){this._startTime=0;let i=document.getElementById("spe-perfs");i?this.element=i:(this.element=document.createElement("div"),document.body.appendChild(this.element),this.element.style.position="absolute",this.element.style.zIndex="10000",this.element.style.fontFamily="monospace",this.element.style.background="black",this.element.style.color="white",this.element.style.padding="10px",this.element.style.opacity="0.5",this.element.style.fontSize="11px",this.element.setAttribute("id","spe-perfs")),this.element.style.left=`${e}px`,this.element.style.top=`${t}px`}dispose(){this.element.parentElement?.removeChild(this.element)}start(){this._startTime=performance.now()}end(){let e=performance.now()-this._startTime;this.element.innerHTML=e.toFixed(3)+" ms"}};function JBe(e){let t;if(e.index)for(let i=0;i<e.index.array.length;i+=3)t=e.index.array[i],e.index.array[i]=e.index.array[i+2],e.index.array[i+2]=t}function yb(e){return e instanceof u_?"SubdivObject":e.geometry.type==="NonParametricGeometry"?"NonParametric":"Mesh"}function $Be(e,t){let i={};return e.traverseEntity(r=>{if(!r.visible||!(r instanceof xa)||r.type!=="Mesh"||Array.isArray(r.material)||r.states&&Object.keys(r.states).length)return;let n=r.parent;for(;n;){if(n instanceof xa&&r.states&&Object.keys(r.states).length)return;n=n.parent}let s=r.material.uuid,a=t.shared.materials[s];if(a){if(!Vs.isMergable(a))return}else{let l=t.scene.objects.get(r.uuid)?.data;if(l&&"material"in l&&typeof l.material!="string"){if(!Vs.isMergable(l.material))return;s=Vs.getHash(l.material)}}i[s]||(i[s]={});let o=i[s][yb(r)];if(o){if(o.push(r),r.cloner)for(let l of r.cloner.children)o.push(l)}else if(i[s][yb(r)]=[r],r.cloner)for(let l of r.cloner.children)i[s][yb(r)].push(l)}),i}function eNe(e){let t=0;return Object.values(e).forEach(i=>{Object.values(i).forEach(r=>{let n=r.length;n>t&&(t=n)})}),t}function tNe(e,t){let i=$Be(t,e),r=eNe(i),n=new Array(r),s=0,a=new Array(r),o=0,l=new Array(r),u=0,c=new Array(r),h=0;for(let[d,p]of Object.entries(i))for(let m of Object.values(p)){if(o=0,u=0,m.forEach(g=>{g instanceof xa&&(a[o++]=g.geometry.clone(),l[u++]=g)}),u<2)continue;for(let g=0;g<u;g++)l[g].updateWorldMatrix(!0,!1),a[g].applyMatrix4(l[g].matrixWorld),l[g].matrixWorld.determinant()<0&&JBe(a[g]);let v=xg(a.slice(0,o),!1);if(v){let g;switch(d){case"SubdivObject":{console.warn("Turning subdiv object into mesh"),g=new zr(v,l[0].material);break}default:{g=new zr(v,l[0].material);break}}g.castShadow=l[0].castShadow,g.receiveShadow=l[0].receiveShadow,t.add(g);let w=S=>{h=0;for(let _ of S)_.children&&w(_.children),_ instanceof xa&&(Array.isArray(_.material)||i[_.material.uuid]&&i[_.material.uuid][yb(_)]&&i[_.material.uuid][yb(_)].length>1||(c[h++]=_));for(let _=0;_<h;_++)t.attach(c[_])};for(let S=0;S<u;S++){let _=l[S];w(_.children),n[s++]=_}}}for(let d=0;d<s;d++)n[d].removeFromParent()}var iNe=Hp(ghe(),1),rNe=new Pe;function nNe(e){let t="The Spline Runtime only accepts .splinecode files that are generated from Spline export panel.";e.endsWith(".spline")?console.warn(t+" The .spline files are only meant to be used by the Editor."):e.endsWith(".splinecode")||console.warn(t)}function PW(e){let t=new Gs(0,0,0,1);try{t.setStyle(e)}catch(i){console.error(i)}finally{return t}}var sNe=class{constructor(e,{renderOnDemand:t,renderMode:i="auto",wasmPath:r}={}){this._viewportMode=1,this._viewportWidth=window.innerWidth,this._viewportHeight=window.innerHeight,this._proxyObjectCache=new Map,this._variablesCache=new Map,this._isPaused=!1,this._renderRequested=!1,this._skipRender=!1,this.time=performance.now(),this.dt=0,this.currentTAAFrame=0,this.disposed=!1,this._requestRenderAutoMode=()=>{this._skipRender=!1},this.requestRender=()=>{this._renderRequested=!0},this.render=n=>{if(this.time=n,this._lastTime&&(this.dt=this.time-this._lastTime),this._lastTime=this.time,this._perfs?.start(),!this._renderer){this._perfs?.end();return}if(!this._isPaused&&(this.renderMode==="manual"&&!this._renderRequested||this.renderMode==="auto"&&this._skipRender)){this._perfs?.end();return}if(this._renderRequested=!1,this._skipRender=!0,this._controls&&(this._skipRender=this._controls.update(this.dt)??!1),this._eventManager&&(this._eventManager.handlers?.Start.hasVideoAction||this._eventManager.handlers?.Basic.hasVideoAction||this._eventManager.handlers?.Conditional.hasVideoAction)&&(this._skipRender=!1),this._animationControls?.update(this.dt),this._skipRender?(this.currentTAAFrame++,this.currentTAAFrame<32?this._skipRender=!1:this.currentTAAFrame=0):this.currentTAAFrame=0,this._scene?.traverseVisibleEntity(s=>{s.type==="ParticleSystem"&&(s.update(this.dt),this._skipRender=!1)}),this._scene&&this._scene.activeCamera!==this._camera&&(this._camera=this._scene.activeCamera),this._eventManager?.isEnabled&&((this._eventManager.handlers?.Follow).onAnimationFrameDamping(),(this._eventManager.handlers?.LookAt).onAnimationFrameDamping(),(this._eventManager.handlers?.DragDrop).onAnimationFrameDamping()),this._scene&&this._camera){if(this._scene.pathConstraints.applyConstraints(this._scene),this._renderer.sceneTransitionTimeRemaining>0){this._renderer.sceneTransitionTimeRemaining-=this.dt;let s=1-this._renderer.sceneTransitionTimeRemaining/this._renderer.sceneTransitionDuration;this._renderer.pipeline.sceneTransitionPass.uniforms.mixRatio.value=s,this._skipRender=!1}else this._renderer.pipeline.sceneTransitionFromTexture=null;this._renderer.renderSplineScene(this._scene,this._camera)}this.canvas.dispatchEvent(this._renderedEvent),this._perfs?.end()},this._resize=n=>{if(this._renderer){if(this._viewportMode===1&&this._frameView&&(this._frameView.frameSize=rNe.set(this._viewportWidth,this._viewportHeight)),n){let s=this._viewportWidth,a=this._viewportHeight;this._renderer.setSize(s-1,a-1,!1),this._renderer.setSize(s,a,!1)}else this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1);if(this._camera=this._scene?.activeCamera,this._scene?.updateViewPlaneSize(this._frameView?.frameSize?.x??this._viewportWidth,this._frameView?.frameSize?.y??this._viewportHeight,this._frameView?.enableResponsive??!1),this._camera){let s=Object.values(this._data?.frames??{})[0].preset??"fullscreen";this._frameView?.setCamera(this._camera),this._frameView?.updateCamera(s!=="fullscreen"),this._camera.cameraType==="PerspectiveCamera"&&(this._camera.aspect=this._viewportWidth/this._viewportHeight),this._camera.updateProjectionMatrix()}this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect()),this._requestRenderAutoMode()}},this._debouncedResize=Zb(this._resize,10),this._onScroll=n=>{this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect())},this.canvas=e,this.renderMode=t?"auto":i,r&&(this._wasmPath=FAe(r,"/")),this._renderedEvent=new CustomEvent("rendered",{bubbles:!0}),Object.defineProperty(this._renderedEvent,"target",{writable:!1,value:this}),window.location.search.includes("perfs")&&(this._perfs=new ZBe({x:10,y:10})),JAe(e)}async load(e,t,i){nNe(e),this.disposed=!1;let r=await(await fetch(e,i)).arrayBuffer();await this.start(r,{variables:t})}async start(e,{interactive:t=!0,variables:i}={}){if(this.disposed)return;let r=await PBe(e);this._data=r;let n=DBe(r);r.version&&(0,iNe.default)(r.version,"1.12.5")>0&&console.warn("Your .splinecode file is more recent than the library. Please upgrade @splinetool/runtime to the latest version."),this._wasmPath&&this.setUIWasmUrl(`${this._wasmPath}/ui.wasm`),await Promise.all([n.length&&SW(this._wasmPath),oH(r)&&t3e(this._wasmPath),aRe(r)&&ZPe(this._wasmPath),r_.physicsEnabled(r.scene.objects)&&rEe(),rH(r)&&kDe(),BH(r)&&fze(),ODe(r)&&LDe(),TH(r)&&tOe(),dBe(r)&&tEe(this._wasmPath)].filter(Boolean)),n.length&&await MW(n),this._eventManager?.deactivate(),this._controls?.deactivate(),this._scene?.dispose();let s=new KBe(r);if(s.resetPersonalCameraFromDocumentData(),this._scene=s.scene,this._sharedAssetsManager=s.sharedAssets,this._camera=this._scene.activeCamera,window.location.search.includes("merge-geometries")){let l=performance.now();tNe(r,s.scene);let u=performance.now();console.log("Merged geometries in ",u-l," ms")}oH(r)&&this._scene.traverse(l=>{wd(l)&&l.recomputeBoolean()}),this._sharedAssetsManager.setRequestRender(()=>{this._requestRenderAutoMode(),this._scene?.traverse(l=>{l instanceof jl&&l.pendingMediaLoad&&l.update()})}),this._scene?.traverse(l=>{l.type==="ParticleSystem"&&(l.wakeUp(),l.data.autoPlay?l.start():l.stop())});let a=Object.keys(r.shared.fonts).map(l=>this._sharedAssetsManager.getFont(l).loadingPromise);if(Promise.all(a).then(()=>{s.scene.markNeedsUpdateRendererDirty(),this._requestRenderAutoMode()}),rH(r)&&_Be(r)&&await Promise.all(a),TH(r)){let l=[];this._scene.traverseEntity(u=>{(u instanceof ka||u instanceof Ns)&&u.uiCanvas&&l.push(u.uiCanvas)}),await Promise.all(l.map(u=>u.promise))}if(this._scene.rewriteEventsBeforeGoToPlayMode(),OB(this._scene.activePage,this._sharedAssetsManager),!this._renderer){this._renderer=new VLe({canvas:this.canvas,antialias:!1,alpha:!0,stencil:!1,depth:!1,powerPreference:"high-performance"}),this._renderer.hdTransmission=r.scene.publish.hdTransmission===!0;let l=()=>/Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),u=this._getPixelRatio(l()?r.scene.publish.settings.web.pixelRatioMobile:r.scene.publish.settings.web.pixelRatioDesktop);if(this._renderer.setPixelRatio(u),this._renderer.pipeline.enableUIOverlay(),this._renderer.pipeline.addEventListener("smaaloaded",this._requestRenderAutoMode),r.shared.images.SplineWatermark){let c=this._sharedAssetsManager.getImage("SplineWatermark");await c.loadPromise;let h=c.getTexture(1001);this._renderer.pipeline.setWatermark(h)}}BH(r)&&this._scene.initializeSplatViewer(),r.scene.blueNoiseTextureData!==void 0&&this._renderer.pipeline.updateBlueNoiseTexture(r.scene.blueNoiseTextureData);let o=Object.values(r.frames)[0];if(this._frameView?this._frameView.setCamera(this._camera):(o.preset==="fullscreen"?(this._viewportMode=1,this.canvas.style.display="block",this.canvas.parentElement&&(this._viewportWidth=this.canvas.parentElement.clientWidth||300,this.canvas.style.width="100%"),this.canvas.parentElement&&(this._viewportHeight=this.canvas.parentElement.clientHeight||150,this.canvas.style.height="100%")):(this._viewportMode=2,this._viewportWidth=o.size[0],this._viewportHeight=o.size[1],this.canvas.style.width=`${this._viewportWidth}px`,this.canvas.style.height=`${this._viewportHeight}px`),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._frameView=new YBe(this._renderer,this._camera,new Pe(this._viewportWidth,this._viewportHeight),new Pe(window.innerWidth,window.innerHeight)),this._frameView.enableResponsive=(o.allowResponsive??!1)&&o.preset==="fullscreen"),t){let l=new wke(this._renderer,this.data.scene.publish,this._scene,()=>this._scene.activeCamera,this._sharedAssetsManager,this._requestRenderAutoMode,!0,o);this._scene.updateMatrixWorld(!0),this._controls=new SBe(l),this._animationControls=new ABe(this._scene,this._requestRenderAutoMode),this._eventManager=new XBe(r.scene.publish,this._controls,this._animationControls,l,r.shared.variables),this._eventManager.activate(),this._controls.activate(this._eventManager)}this._resize(),this._scene.activePage.data.postprocessing.depthOfField.enabled&&Promise.all(this._sharedAssetsManager.getImageLoadPromises()).then(()=>{this._resize(!0)}),i!==void 0&&this.setVariables(i),this.dt===0&&(this.render(performance.now()),setTimeout(()=>{this._renderer?.setAnimationLoop(this.render)},0)),this._resizeObserverTimeout=setTimeout(()=>{!this._resizeObserver&&this.canvas.parentElement&&(this._resizeObserver=new ResizeObserver(()=>{this._viewportWidth=this.canvas.clientWidth,this._viewportHeight=this.canvas.clientHeight,this._debouncedResize()}),this._resizeObserver.observe(this.canvas.parentElement))},300),document.addEventListener("scroll",this._onScroll)}setVariables(e){if(this._data!==void 0){let t=Object.entries(e);for(let[i,r]of t)this.setVariable(i,r)}}setVariable(e,t){let i=this._getVariableByName(e);if(i&&!("dynamicVariableType"in i.data)){let r=t;typeof i.data.value=="number"?r=typeof t=="number"?t:typeof t=="boolean"?t===!0?1:0:parseFloat(t):typeof i.data.value=="boolean"?r=typeof t=="number"?!!t:typeof t=="boolean"?t:t.toLocaleLowerCase()==="false"?!1:!!t:typeof i.data.value!="string"&&i.data.value.textValue!==void 0&&(r=t.toString());let n=typeof r=="string"?{textValue:r}:r;this._sharedAssetsManager?.updateVariable(i.id,n),this.requestRender(),this._requestRenderAutoMode()}else i===void 0?console.warn(`No variable named ${e} was found in your Spline file. Make sure to create it from Spline editor.`):"dynamicVariableType"in i.data&&console.warn(`Dynamic variables like ${e} cannot be updated from code.`)}getVariables(){let e={};return this._data&&this._data.shared.variables.forEach(t=>{e[t.data.name]===void 0&&(e[t.data.name]=this._getVariableValue(this._sharedAssetsManager.getVariable(t.id)))}),e}getVariable(e){let t=this._getVariableByName(e);if(t){let i=this._sharedAssetsManager.getVariable(t.id);return this._getVariableValue(i)}}_getVariableValue(e){return typeof e!="string"&&va.isTextValue(e)?va.getDisplayedValue(e):e}_getVariableByName(e){if(this._data){if(this._variablesCache.has(e))return this._variablesCache.get(e);let t=this._data.shared.variables.find(i=>i.data.name===e);return t&&this._variablesCache.set(e,t),t}}_getPixelRatio(e){switch(e){case 0:return window.devicePixelRatio;case 1:return 1;case 2:return 2}}findObjectById(e){let t=this._scene?.getObjectByProperty("uuid",e);return this._createProxyObject(t)}findObjectByName(e){let t=this._scene?.getObjectByName(e);return this._createProxyObject(t)}getAllObjects(){let e=[];return this._scene?.traverseEntity(t=>{if(t.uuid!==Xx&&!this._scene.isInvisibleObjects(t)&&!(t instanceof Ns)){let i=this._createProxyObject(t);i&&e.push(i)}}),e}getSplineEvents(){return(this._eventManager?.handlers?.Spline).splineEvents}emitEvent(e,t){(this.findObjectById(t)||this.findObjectByName(t))?.emitEvent(e)}emitEventReverse(e,t){(this.findObjectById(t)||this.findObjectByName(t))?.emitEventReverse(e)}addEventListener(e,t){this.canvas.addEventListener(e,t)}removeEventListener(e,t){this.canvas.removeEventListener(e,t)}setZoom(e){this._controls?.orbitControls instanceof aZ&&this._controls?.orbitControls.setZoom(e)}get eventManager(){return this._eventManager}get controls(){return this._controls}setSize(e,t){this._viewportWidth=e,this._viewportHeight=t,this._viewportMode=2,this._resize()}setBackgroundColor(e){let t=PW(e);this._scene?.activePage.setBackgroundColor(t),this._requestRenderAutoMode()}dispose(){this.disposed=!0,this._eventManager?.deactivate(),this._scene?.dispose(),this._sharedAssetsManager?.dispose(),this._proxyObjectCache.forEach(e=>{J5.unsubscribe(e)}),this._variablesCache.clear(),this._renderer?.setAnimationLoop(null),this._renderer?.dispose(),this._renderer=void 0,this._sharedAssetsManager?.dispose(),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=void 0),this._resizeObserverTimeout!==void 0&&clearTimeout(this._resizeObserverTimeout),this.canvas.style.width="",this.canvas.style.height="",this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height"),this._frameView&&(this._frameView=void 0),this._controls?.deactivate(),this.dt=0,$Ae(this.canvas),document.removeEventListener("scroll",this._onScroll)}get isStopped(){return this._isPaused}stop(){this._isPaused||(this._renderer?.setAnimationLoop(null),this._isPaused=!0,this._eventManager?.pause(),this._controls?.orbitControls&&(this._controls.orbitControls.enabled=!1))}play(){!this._isPaused||(this._isPaused=!1,this._eventManager?.resume(),this._controls?.orbitControls&&(this._controls.orbitControls.enabled=!0),this._renderer?.setAnimationLoop(this.render))}setGlobalEvents(e){this._eventManager?.updateUseWindowEvents(e)}get data(){return this._data}_createProxyObject(e){if(!this._scene||e==null)return;if(this._proxyObjectCache.has(e.uuid))return this._proxyObjectCache.get(e.uuid);let t;e.traverseAncestors(o=>{o instanceof Ns&&(t=o.name)});let i=this._sharedAssetsManager,r={shared:i,scene:this._scene},n=o=>{if(o===null||o==="Base State")return null;if(o&&e.data.states){let l=e.data.states.find(u=>u.data.name===o);return l?l.id:void 0}},s={name:e.name,uuid:e.uuid,visible:e.visible,intensity:e.intensity,position:e.position,rotation:e.rotation,scale:e.scale,type:e.data.type,page:t,parentUuid:e.parent instanceof Ns||e instanceof RB?void 0:e.parent?.uuid,emitEvent(o){e.dispatchEvent({type:"userEvent",eventName:o})},emitEventReverse(o){e.dispatchEvent({type:"userEvent",eventName:o,reverse:!0})},hide(){e.visible&&(e.visible=!1,r.shared.requestRender())},show(){e.visible||(e.visible=!0,r.shared.requestRender())},get state(){let o=e.stateSelection;if(o!==null)return e.data.states.find(({id:l})=>l===o)?.data.name},set state(o){let l;if(o!==void 0){let u=typeof o=="string"?e.data.states.find(({id:c})=>c===o):e.data.states[o];if(u)l=u.id;else{let c=typeof o=="string"?n(o):void 0;c&&(l=c)}}e.changeSelectedState(l??null,r),e.currentState=l??null,e.dispatchEvent({type:"completeState",state:l??null}),r.shared.requestRender()},transition(o){let l=this,u,c=Og.timeline({autoplay:o.autoPlay??!0}),h={transition({from:d,to:p,duration:m,delay:v,...g}){let w=n(d);w===void 0&&(w=u);let S=n(p);u=S;let _=new wO(e,w,S,{state:S,repeat:0,delay:v??0,delayDirection:"start-once",direction:"normal",duration:m??1e3,...g,...g.easing===6?I2.defaultData:g.easing===5?L2.defaultData:{}},i,!1);return c.add({..._.params,begin:()=>{(d&&w||d==="Base State"&&!w)&&(l.state=w??void 0)},complete:()=>{l.state=S??void 0}},c.duration),this},play(){return c.play(),this},pause(){return c.pause(),this},reset(){return c.reset(),this},seek(d){return c.seek(d),this}};return h.transition(o),h},set color(o){let l=PW(o);if(nC.is(e)){e.color=l;return}else if(e.type!=="Mesh"||!("material"in e)||!(e instanceof Op))return;let u={r:l.r,g:l.g,b:l.b,a:l.a},c=Array.isArray(e.material)?e.material[0]:e.material,h=c.data.layers.find(d=>d.data.type==="color")?.id;h&&c.updateByOp({type:0,path:["layers",h],props:{color:{...u}}},c.data,r)}},a=J5(s,(o,l)=>{typeof e[o]!="object"&&Object.getOwnPropertyDescriptor(e,o)?.writable&&(e[o]=l),this._requestRenderAutoMode(),e.updateMatrix()});return this._proxyObjectCache.set(e.uuid,a),a}setUIWasmUrl(e){zQ.skiaWasmUrl=e}pauseGameControls(){this._eventManager?.controlsManager.gameControl?.pause()}resumeGameControls(){this._eventManager?.controlsManager.gameControl?.resume()}async swapGeometry(e,t){let i;if(typeof t=="string")if(t.endsWith(".splinegeometry")){let l=await(await fetch(t)).arrayBuffer();i=new Uint8Array(l)}else throw new Error("Only .splinegeometry format is supported");else i=t;let r=D2.deserialize(i),n="data"in r&&r.data.draco!==void 0;n&&await SW(this._wasmPath);let s=this._scene?.getObjectByProperty("uuid",e)??this._scene?.getObjectByName(e);if(!s){console.warn(`Object ${e} not found`);return}if(s.data.type!=="Mesh"||!(s instanceof Op)){console.warn(`Object ${e} is not a mesh`);return}let a=s,o={...a.data,geometry:r};n&&await MW([o]),a.updateByOp({type:0,path:[],props:{geometry:o.geometry}},o,{shared:this._sharedAssetsManager,scene:this._scene},!1);for(let l of a.data.states){let u={...l.data};a.states||(a.states={}),a.states[l.id]=fp.patch(o,u)}return i}};function aNe(e){return t=>{e.forEach(i=>{typeof i=="function"?i(t):i!=null&&(i.current=t)})}}const oNe=[],lNe={width:"100%",height:"100%"},uNe=xe.forwardRef(function({className:e,children:t,debounceTime:i=300,ignoreDimensions:r=oNe,parentSizeStyles:n,enableDebounceLeadingCall:s=!0,resizeObserverPolyfill:a,...o},l){const u=xe.useRef(null),c=xe.useRef(0),[h,d]=xe.useState({width:0,height:0,top:0,left:0}),p=xe.useMemo(()=>{const m=Array.isArray(r)?r:[r];return DR(v=>{d(g=>Object.keys(g).filter(w=>g[w]!==v[w]).every(w=>m.includes(w))?g:v)},i,{leading:s})},[i,s,r]);return xe.useEffect(()=>{const m=a||window.ResizeObserver,v=new m(g=>{g.forEach(w=>{const{left:S,top:_,width:A,height:C}=w?.contentRect??{};c.current=window.requestAnimationFrame(()=>{p({width:A,height:C,top:_,left:S})})})});return u.current&&v.observe(u.current),()=>{window.cancelAnimationFrame(c.current),v.disconnect(),p.cancel()}},[p,a]),at.jsx("div",{style:{...lNe,...n},ref:aNe([l,u]),className:e,...o,children:t({...h,ref:u.current,resize:p})})}),lZ=xe.forwardRef(({scene:e,style:t,onSplineMouseDown:i,onSplineMouseUp:r,onSplineMouseHover:n,onSplineKeyDown:s,onSplineKeyUp:a,onSplineStart:o,onSplineLookAt:l,onSplineFollow:u,onSplineScroll:c,onLoad:h,renderOnDemand:d=!0,wasmPath:p,children:m,...v},g)=>{const w=xe.useRef(null),[S,_]=xe.useState(!0),[A,C]=xe.useState();if(A)throw A;return xe.useEffect(()=>{_(!0);let E;const I=[{name:"mouseDown",cb:i},{name:"mouseUp",cb:r},{name:"mouseHover",cb:n},{name:"keyDown",cb:s},{name:"keyUp",cb:a},{name:"start",cb:o},{name:"lookAt",cb:l},{name:"follow",cb:u},{name:"scroll",cb:c}];if(w.current){E=new sNe(w.current,{renderOnDemand:d,wasmPath:p});async function T(){await E.load(e);for(let D of I)D.cb&&E.addEventListener(D.name,D.cb);_(!1),h?.(E)}T().catch(D=>{C(D)})}return()=>{for(let T of I)T.cb&&E.removeEventListener(T.name,T.cb);E.dispose()}},[e]),at.jsx(uNe,{ref:g,parentSizeStyles:{overflow:"hidden",...t},debounceTime:50,...v,children:()=>at.jsxs(at.Fragment,{children:[S&&m,at.jsx("canvas",{ref:w,style:{display:S?"none":"block"}})]})})}),cNe=Object.freeze(Object.defineProperty({__proto__:null,default:lZ},Symbol.toStringTag,{value:"Module"}));v$.lazy(()=>Vd(()=>Promise.resolve().then(()=>cNe),void 0));const hNe=()=>at.jsxs("main",{className:`flex lg:mt-20 flex-col lg:flex-row
     items-center justify-between min-h-[calc(90vh-6rem)]`,children:[at.jsxs("div",{"data-aos":"fade-right","data-aos-offset":"300","data-aos-easing":"ease-in-sine",className:"max-w-xl ml-[5%] z-10 mt-[90%] md:mt-[60%] lg:mt-0",children:[at.jsx("div",{className:`relative w-[95%] sm:w-48 h-10 
      bg-gradient-to-r from-[#656565] to-[#e99b63]
       shadow-[0_0_15px_rgba(255,255,255,0.4)] rounded-full`,children:at.jsx("div",{className:`absolute inset-[3px] bg-black rounded-full
         flex items-center justify-center gap-1`,children:at.jsx("i",{class:"bx bx-diamond",children:at.jsx("span",{className:"-",children:"Introduction"})})})}),at.jsxs("h1",{className:`text-3xl sm:text-4xl md:text-5xl lg:text-6xl
         font-bold tracking-wide my-8`,children:["Miftah Faridl ",at.jsx("br",{})," Al Faruqi"]}),at.jsx("p",{className:`text-base sm:text-lg tracking-wider text-secondary 
        max-w-[25rem] lg:max-w-[30rem]`,children:"I bring a strong passion for full-stack web development and a commitment to technical excellence."}),at.jsxs("div",{className:"flex gap-4 mt-12",children:[at.jsxs("a",{className:`border border-[#2a2a2a] py-2 sm:py-3 px-4
          sm:px-5 rounded-full sm:text-lg text-sm font-semibold tracking-wider 
          transition-all duration-300 hover:bg-[#1a1a1a]`,href:"#Contact",children:["Documentation ",at.jsx("i",{class:"bx bx-link-external"})]}),at.jsxs("a",{className:`border border-[#2a2a2a] py-2 sm:py-3 px-8
          sm:px-10 rounded-full sm:text-lg text-sm font-semibold tracking-wider 
          transition-all bg-gray-300 text-black duration-300 hover:bg-[#1a1a1a]`,href:"#about",children:["GetStarted ",at.jsx("i",{class:"bx bx-link-external"})]})]})]}),at.jsx(lZ,{"data-aos":"fade-zoom-in","data-aos-easing":"ease-in-back","data-aos-delay":"300","data-aos-offset":"0","data-aos-duration":"3000",className:"absolute lg:top-0 top-[-20%] bottom-0 lg:left-[45%] sm:left-[-2rem] h-full max-w-[800px] h-[600px]",scene:"https://prod.spline.design/P1fz1L7XWghQtDuu/scene.splinecode"})]}),dNe=()=>{const e=()=>{const t=document.getElementById("mobileMenu");t.classList.contains("hidden")?t.classList.remove("hidden"):t.classList.add("hidden")};return at.jsxs("header",{className:`flex justify-between
   items-center py-4 px-4 lg:px-20`,children:[at.jsx("h1",{"data-aos":"fade-down","data-aos-easing":"linear","data-aos-duration":"1500",className:`text-2xl md:text-4xl 
        lg:text-4xl font-light m-0`,children:"Portofolio"}),at.jsxs("nav",{className:"hidden md:flex items-center gap-12",children:[at.jsx("a",{"data-aos":"fade-down","data-aos-easing":"linear","data-aos-duration":"1000",className:"text-base tracking-wider transition-colors hover:text-gray-300 z-50",href:"#",children:"Profile"}),at.jsx("a",{"data-aos":"fade-down","data-aos-easing":"linear","data-aos-duration":"1500",className:"text-base tracking-wider transition-colors hover:text-gray-300 z-50",href:"#",children:"Experience"}),at.jsx("a",{"data-aos":"fade-down","data-aos-easing":"linear","data-aos-duration":"2000",className:"text-base tracking-wider transition-colors hover:text-gray-300 z-50",href:"#",children:"Project"}),at.jsx("a",{"data-aos":"fade-down","data-aos-easing":"linear","data-aos-duration":"2500",className:"text-base tracking-wider transition-colors hover:text-gray-300 z-50",href:"#",children:"Contact"})]}),at.jsx("button",{className:`hidden md:block bg-[#a7a7a7] text-black py-3 px-8 
      rounded-full border-none font-medium transition-all duration-500 hover:bg-white cursor-pointer z-50`,children:"Contact"}),at.jsx("button",{onClick:e,className:"md:hidden text-3xl p-2 z-50",children:at.jsx("i",{class:"bx bx-menu"})}),at.jsx("div",{id:"mobileMenu",className:`hidden fixed top-16 bottom-0 right-0
       left-0 p-5 md:hidden z-40 bg-black bg-opacity-70 bg-black bg-opacity-70 backdrop-blur- md`,children:at.jsxs("nav",{className:"flex flex-col gap-6 items-center",children:[at.jsx("a",{className:"text-base tracking-wider transition-colors hover:text-gray-300 z-50",href:"#",children:"Profile"}),at.jsx("a",{className:"text-base tracking-wider transition-colors hover:text-gray-300 z-50",href:"#",children:"Experience"}),at.jsx("a",{className:"text-base tracking-wider transition-colors hover:text-gray-300 z-50",href:"#",children:"Project"}),at.jsx("a",{className:"text-base tracking-wider transition-colors hover:text-gray-300 z-50",href:"#",children:"Contact"})]})})]})},uZ=xe.createContext({});function fNe(e){const t=xe.useRef(null);return t.current===null&&(t.current=e()),t.current}const kB=typeof window<"u",pNe=kB?xe.useLayoutEffect:xe.useEffect,BB=xe.createContext(null);function NB(e,t){e.indexOf(t)===-1&&e.push(t)}function FB(e,t){const i=e.indexOf(t);i>-1&&e.splice(i,1)}const kd=(e,t,i)=>i>t?t:i<e?e:i;let UB=()=>{};const Bd={},cZ=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e);function hZ(e){return typeof e=="object"&&e!==null}const dZ=e=>/^0[^.\s]+$/u.test(e);function VB(e){let t;return()=>(t===void 0&&(t=e()),t)}const Xl=e=>e,mNe=(e,t)=>i=>t(e(i)),tS=(...e)=>e.reduce(mNe),h_=(e,t,i)=>{const r=t-e;return r===0?1:(i-e)/r};class jB{constructor(){this.subscriptions=[]}add(t){return NB(this.subscriptions,t),()=>FB(this.subscriptions,t)}notify(t,i,r){const n=this.subscriptions.length;if(n)if(n===1)this.subscriptions[0](t,i,r);else for(let s=0;s<n;s++){const a=this.subscriptions[s];a&&a(t,i,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Yc=e=>e*1e3,Hl=e=>e/1e3;function fZ(e,t){return t?e*(1e3/t):0}const pZ=(e,t,i)=>(((1-3*i+3*t)*e+(3*i-6*t))*e+3*t)*e,gNe=1e-7,vNe=12;function yNe(e,t,i,r,n){let s,a,o=0;do a=t+(i-t)/2,s=pZ(a,r,n)-e,s>0?i=a:t=a;while(Math.abs(s)>gNe&&++o<vNe);return a}function iS(e,t,i,r){if(e===t&&i===r)return Xl;const n=s=>yNe(s,0,1,e,i);return s=>s===0||s===1?s:pZ(n(s),t,r)}const mZ=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,gZ=e=>t=>1-e(1-t),vZ=iS(.33,1.53,.69,.99),HB=gZ(vZ),yZ=mZ(HB),xZ=e=>(e*=2)<1?.5*HB(e):.5*(2-Math.pow(2,-10*(e-1))),WB=e=>1-Math.sin(Math.acos(e)),wZ=gZ(WB),bZ=mZ(WB),xNe=iS(.42,0,1,1),wNe=iS(0,0,.58,1),_Z=iS(.42,0,.58,1),bNe=e=>Array.isArray(e)&&typeof e[0]!="number",SZ=e=>Array.isArray(e)&&typeof e[0]=="number",_Ne={linear:Xl,easeIn:xNe,easeInOut:_Z,easeOut:wNe,circIn:WB,circInOut:bZ,circOut:wZ,backIn:HB,backInOut:yZ,backOut:vZ,anticipate:xZ},SNe=e=>typeof e=="string",DW=e=>{if(SZ(e)){UB(e.length===4);const[t,i,r,n]=e;return iS(t,i,r,n)}else if(SNe(e))return _Ne[e];return e},mE=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function MNe(e,t){let i=new Set,r=new Set,n=!1,s=!1;const a=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1};function l(c){a.has(c)&&(u.schedule(c),e()),c(o)}const u={schedule:(c,h=!1,d=!1)=>{const m=d&&n?i:r;return h&&a.add(c),m.has(c)||m.add(c),c},cancel:c=>{r.delete(c),a.delete(c)},process:c=>{if(o=c,n){s=!0;return}n=!0,[i,r]=[r,i],i.forEach(l),i.clear(),n=!1,s&&(s=!1,u.process(c))}};return u}const ANe=40;function MZ(e,t){let i=!1,r=!0;const n={delta:0,timestamp:0,isProcessing:!1},s=()=>i=!0,a=mE.reduce((_,A)=>(_[A]=MNe(s),_),{}),{setup:o,read:l,resolveKeyframes:u,preUpdate:c,update:h,preRender:d,render:p,postRender:m}=a,v=()=>{const _=Bd.useManualTiming?n.timestamp:performance.now();i=!1,Bd.useManualTiming||(n.delta=r?1e3/60:Math.max(Math.min(_-n.timestamp,ANe),1)),n.timestamp=_,n.isProcessing=!0,o.process(n),l.process(n),u.process(n),c.process(n),h.process(n),d.process(n),p.process(n),m.process(n),n.isProcessing=!1,i&&t&&(r=!1,e(v))},g=()=>{i=!0,r=!0,n.isProcessing||e(v)};return{schedule:mE.reduce((_,A)=>{const C=a[A];return _[A]=(E,I=!1,T=!1)=>(i||g(),C.schedule(E,I,T)),_},{}),cancel:_=>{for(let A=0;A<mE.length;A++)a[mE[A]].cancel(_)},state:n,steps:a}}const{schedule:en,cancel:kp,state:da,steps:fR}=MZ(typeof requestAnimationFrame<"u"?requestAnimationFrame:Xl,!0);let YE;function ENe(){YE=void 0}const Vo={now:()=>(YE===void 0&&Vo.set(da.isProcessing||Bd.useManualTiming?da.timestamp:performance.now()),YE),set:e=>{YE=e,queueMicrotask(ENe)}},AZ=e=>t=>typeof t=="string"&&t.startsWith(e),GB=AZ("--"),CNe=AZ("var(--"),qB=e=>CNe(e)?TNe.test(e.split("/*")[0].trim()):!1,TNe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Zx={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},d_={...Zx,transform:e=>kd(0,1,e)},gE={...Zx,default:1},xb=e=>Math.round(e*1e5)/1e5,XB=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function PNe(e){return e==null}const DNe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,YB=(e,t)=>i=>!!(typeof i=="string"&&DNe.test(i)&&i.startsWith(e)||t&&!PNe(i)&&Object.prototype.hasOwnProperty.call(i,t)),EZ=(e,t,i)=>r=>{if(typeof r!="string")return r;const[n,s,a,o]=r.match(XB);return{[e]:parseFloat(n),[t]:parseFloat(s),[i]:parseFloat(a),alpha:o!==void 0?parseFloat(o):1}},RNe=e=>kd(0,255,e),pR={...Zx,transform:e=>Math.round(RNe(e))},_g={test:YB("rgb","red"),parse:EZ("red","green","blue"),transform:({red:e,green:t,blue:i,alpha:r=1})=>"rgba("+pR.transform(e)+", "+pR.transform(t)+", "+pR.transform(i)+", "+xb(d_.transform(r))+")"};function INe(e){let t="",i="",r="",n="";return e.length>5?(t=e.substring(1,3),i=e.substring(3,5),r=e.substring(5,7),n=e.substring(7,9)):(t=e.substring(1,2),i=e.substring(2,3),r=e.substring(3,4),n=e.substring(4,5),t+=t,i+=i,r+=r,n+=n),{red:parseInt(t,16),green:parseInt(i,16),blue:parseInt(r,16),alpha:n?parseInt(n,16)/255:1}}const EO={test:YB("#"),parse:INe,transform:_g.transform},rS=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),Kf=rS("deg"),Qc=rS("%"),Ai=rS("px"),LNe=rS("vh"),ONe=rS("vw"),RW={...Qc,parse:e=>Qc.parse(e)/100,transform:e=>Qc.transform(e*100)},Oy={test:YB("hsl","hue"),parse:EZ("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:i,alpha:r=1})=>"hsla("+Math.round(e)+", "+Qc.transform(xb(t))+", "+Qc.transform(xb(i))+", "+xb(d_.transform(r))+")"},$n={test:e=>_g.test(e)||EO.test(e)||Oy.test(e),parse:e=>_g.test(e)?_g.parse(e):Oy.test(e)?Oy.parse(e):EO.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?_g.transform(e):Oy.transform(e),getAnimatableNone:e=>{const t=$n.parse(e);return t.alpha=0,$n.transform(t)}},zNe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function kNe(e){return isNaN(e)&&typeof e=="string"&&(e.match(XB)?.length||0)+(e.match(zNe)?.length||0)>0}const CZ="number",TZ="color",BNe="var",NNe="var(",IW="${}",FNe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function f_(e){const t=e.toString(),i=[],r={color:[],number:[],var:[]},n=[];let s=0;const o=t.replace(FNe,l=>($n.test(l)?(r.color.push(s),n.push(TZ),i.push($n.parse(l))):l.startsWith(NNe)?(r.var.push(s),n.push(BNe),i.push(l)):(r.number.push(s),n.push(CZ),i.push(parseFloat(l))),++s,IW)).split(IW);return{values:i,split:o,indexes:r,types:n}}function PZ(e){return f_(e).values}function DZ(e){const{split:t,types:i}=f_(e),r=t.length;return n=>{let s="";for(let a=0;a<r;a++)if(s+=t[a],n[a]!==void 0){const o=i[a];o===CZ?s+=xb(n[a]):o===TZ?s+=$n.transform(n[a]):s+=n[a]}return s}}const UNe=e=>typeof e=="number"?0:$n.test(e)?$n.getAnimatableNone(e):e;function VNe(e){const t=PZ(e);return DZ(e)(t.map(UNe))}const Bp={test:kNe,parse:PZ,createTransformer:DZ,getAnimatableNone:VNe};function mR(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*(2/3-i)*6:e}function jNe({hue:e,saturation:t,lightness:i,alpha:r}){e/=360,t/=100,i/=100;let n=0,s=0,a=0;if(!t)n=s=a=i;else{const o=i<.5?i*(1+t):i+t-i*t,l=2*i-o;n=mR(l,o,e+1/3),s=mR(l,o,e),a=mR(l,o,e-1/3)}return{red:Math.round(n*255),green:Math.round(s*255),blue:Math.round(a*255),alpha:r}}function dC(e,t){return i=>i>0?t:e}const cn=(e,t,i)=>e+(t-e)*i,gR=(e,t,i)=>{const r=e*e,n=i*(t*t-r)+r;return n<0?0:Math.sqrt(n)},HNe=[EO,_g,Oy],WNe=e=>HNe.find(t=>t.test(e));function LW(e){const t=WNe(e);if(!t)return!1;let i=t.parse(e);return t===Oy&&(i=jNe(i)),i}const OW=(e,t)=>{const i=LW(e),r=LW(t);if(!i||!r)return dC(e,t);const n={...i};return s=>(n.red=gR(i.red,r.red,s),n.green=gR(i.green,r.green,s),n.blue=gR(i.blue,r.blue,s),n.alpha=cn(i.alpha,r.alpha,s),_g.transform(n))},CO=new Set(["none","hidden"]);function GNe(e,t){return CO.has(e)?i=>i<=0?e:t:i=>i>=1?t:e}function qNe(e,t){return i=>cn(e,t,i)}function QB(e){return typeof e=="number"?qNe:typeof e=="string"?qB(e)?dC:$n.test(e)?OW:QNe:Array.isArray(e)?RZ:typeof e=="object"?$n.test(e)?OW:XNe:dC}function RZ(e,t){const i=[...e],r=i.length,n=e.map((s,a)=>QB(s)(s,t[a]));return s=>{for(let a=0;a<r;a++)i[a]=n[a](s);return i}}function XNe(e,t){const i={...e,...t},r={};for(const n in i)e[n]!==void 0&&t[n]!==void 0&&(r[n]=QB(e[n])(e[n],t[n]));return n=>{for(const s in r)i[s]=r[s](n);return i}}function YNe(e,t){const i=[],r={color:0,var:0,number:0};for(let n=0;n<t.values.length;n++){const s=t.types[n],a=e.indexes[s][r[s]],o=e.values[a]??0;i[n]=o,r[s]++}return i}const QNe=(e,t)=>{const i=Bp.createTransformer(t),r=f_(e),n=f_(t);return r.indexes.var.length===n.indexes.var.length&&r.indexes.color.length===n.indexes.color.length&&r.indexes.number.length>=n.indexes.number.length?CO.has(e)&&!n.values.length||CO.has(t)&&!r.values.length?GNe(e,t):tS(RZ(YNe(r,n),n.values),i):dC(e,t)};function IZ(e,t,i){return typeof e=="number"&&typeof t=="number"&&typeof i=="number"?cn(e,t,i):QB(e)(e,t)}const KNe=e=>{const t=({timestamp:i})=>e(i);return{start:(i=!0)=>en.update(t,i),stop:()=>kp(t),now:()=>da.isProcessing?da.timestamp:Vo.now()}},LZ=(e,t,i=10)=>{let r="";const n=Math.max(Math.round(t/i),2);for(let s=0;s<n;s++)r+=Math.round(e(s/(n-1))*1e4)/1e4+", ";return`linear(${r.substring(0,r.length-2)})`},fC=2e4;function KB(e){let t=0;const i=50;let r=e.next(t);for(;!r.done&&t<fC;)t+=i,r=e.next(t);return t>=fC?1/0:t}function ZNe(e,t=100,i){const r=i({...e,keyframes:[0,t]}),n=Math.min(KB(r),fC);return{type:"keyframes",ease:s=>r.next(n*s).value/t,duration:Hl(n)}}const JNe=5;function OZ(e,t,i){const r=Math.max(t-JNe,0);return fZ(i-e(r),t-r)}const yn={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},vR=.001;function $Ne({duration:e=yn.duration,bounce:t=yn.bounce,velocity:i=yn.velocity,mass:r=yn.mass}){let n,s,a=1-t;a=kd(yn.minDamping,yn.maxDamping,a),e=kd(yn.minDuration,yn.maxDuration,Hl(e)),a<1?(n=u=>{const c=u*a,h=c*e,d=c-i,p=TO(u,a),m=Math.exp(-h);return vR-d/p*m},s=u=>{const h=u*a*e,d=h*i+i,p=Math.pow(a,2)*Math.pow(u,2)*e,m=Math.exp(-h),v=TO(Math.pow(u,2),a);return(-n(u)+vR>0?-1:1)*((d-p)*m)/v}):(n=u=>{const c=Math.exp(-u*e),h=(u-i)*e+1;return-vR+c*h},s=u=>{const c=Math.exp(-u*e),h=(i-u)*(e*e);return c*h});const o=5/e,l=tFe(n,s,o);if(e=Yc(e),isNaN(l))return{stiffness:yn.stiffness,damping:yn.damping,duration:e};{const u=Math.pow(l,2)*r;return{stiffness:u,damping:a*2*Math.sqrt(r*u),duration:e}}}const eFe=12;function tFe(e,t,i){let r=i;for(let n=1;n<eFe;n++)r=r-e(r)/t(r);return r}function TO(e,t){return e*Math.sqrt(1-t*t)}const iFe=["duration","bounce"],rFe=["stiffness","damping","mass"];function zW(e,t){return t.some(i=>e[i]!==void 0)}function nFe(e){let t={velocity:yn.velocity,stiffness:yn.stiffness,damping:yn.damping,mass:yn.mass,isResolvedFromDuration:!1,...e};if(!zW(e,rFe)&&zW(e,iFe))if(e.visualDuration){const i=e.visualDuration,r=2*Math.PI/(i*1.2),n=r*r,s=2*kd(.05,1,1-(e.bounce||0))*Math.sqrt(n);t={...t,mass:yn.mass,stiffness:n,damping:s}}else{const i=$Ne(e);t={...t,...i,mass:yn.mass},t.isResolvedFromDuration=!0}return t}function pC(e=yn.visualDuration,t=yn.bounce){const i=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:r,restDelta:n}=i;const s=i.keyframes[0],a=i.keyframes[i.keyframes.length-1],o={done:!1,value:s},{stiffness:l,damping:u,mass:c,duration:h,velocity:d,isResolvedFromDuration:p}=nFe({...i,velocity:-Hl(i.velocity||0)}),m=d||0,v=u/(2*Math.sqrt(l*c)),g=a-s,w=Hl(Math.sqrt(l/c)),S=Math.abs(g)<5;r||(r=S?yn.restSpeed.granular:yn.restSpeed.default),n||(n=S?yn.restDelta.granular:yn.restDelta.default);let _;if(v<1){const C=TO(w,v);_=E=>{const I=Math.exp(-v*w*E);return a-I*((m+v*w*g)/C*Math.sin(C*E)+g*Math.cos(C*E))}}else if(v===1)_=C=>a-Math.exp(-w*C)*(g+(m+w*g)*C);else{const C=w*Math.sqrt(v*v-1);_=E=>{const I=Math.exp(-v*w*E),T=Math.min(C*E,300);return a-I*((m+v*w*g)*Math.sinh(T)+C*g*Math.cosh(T))/C}}const A={calculatedDuration:p&&h||null,next:C=>{const E=_(C);if(p)o.done=C>=h;else{let I=C===0?m:0;v<1&&(I=C===0?Yc(m):OZ(_,C,E));const T=Math.abs(I)<=r,D=Math.abs(a-E)<=n;o.done=T&&D}return o.value=o.done?a:E,o},toString:()=>{const C=Math.min(KB(A),fC),E=LZ(I=>A.next(C*I).value,C,30);return C+"ms "+E},toTransition:()=>{}};return A}pC.applyToOptions=e=>{const t=ZNe(e,100,pC);return e.ease=t.ease,e.duration=Yc(t.duration),e.type="keyframes",e};function PO({keyframes:e,velocity:t=0,power:i=.8,timeConstant:r=325,bounceDamping:n=10,bounceStiffness:s=500,modifyTarget:a,min:o,max:l,restDelta:u=.5,restSpeed:c}){const h=e[0],d={done:!1,value:h},p=T=>o!==void 0&&T<o||l!==void 0&&T>l,m=T=>o===void 0?l:l===void 0||Math.abs(o-T)<Math.abs(l-T)?o:l;let v=i*t;const g=h+v,w=a===void 0?g:a(g);w!==g&&(v=w-h);const S=T=>-v*Math.exp(-T/r),_=T=>w+S(T),A=T=>{const D=S(T),L=_(T);d.done=Math.abs(D)<=u,d.value=d.done?w:L};let C,E;const I=T=>{p(d.value)&&(C=T,E=pC({keyframes:[d.value,m(d.value)],velocity:OZ(_,T,d.value),damping:n,stiffness:s,restDelta:u,restSpeed:c}))};return I(0),{calculatedDuration:null,next:T=>{let D=!1;return!E&&C===void 0&&(D=!0,A(T),I(T)),C!==void 0&&T>=C?E.next(T-C):(!D&&A(T),d)}}}function sFe(e,t,i){const r=[],n=i||Bd.mix||IZ,s=e.length-1;for(let a=0;a<s;a++){let o=n(e[a],e[a+1]);if(t){const l=Array.isArray(t)?t[a]||Xl:t;o=tS(l,o)}r.push(o)}return r}function aFe(e,t,{clamp:i=!0,ease:r,mixer:n}={}){const s=e.length;if(UB(s===t.length),s===1)return()=>t[0];if(s===2&&t[0]===t[1])return()=>t[1];const a=e[0]===e[1];e[0]>e[s-1]&&(e=[...e].reverse(),t=[...t].reverse());const o=sFe(t,r,n),l=o.length,u=c=>{if(a&&c<e[0])return t[0];let h=0;if(l>1)for(;h<e.length-2&&!(c<e[h+1]);h++);const d=h_(e[h],e[h+1],c);return o[h](d)};return i?c=>u(kd(e[0],e[s-1],c)):u}function oFe(e,t){const i=e[e.length-1];for(let r=1;r<=t;r++){const n=h_(0,t,r);e.push(cn(i,1,n))}}function lFe(e){const t=[0];return oFe(t,e.length-1),t}function uFe(e,t){return e.map(i=>i*t)}function cFe(e,t){return e.map(()=>t||_Z).splice(0,e.length-1)}function wb({duration:e=300,keyframes:t,times:i,ease:r="easeInOut"}){const n=bNe(r)?r.map(DW):DW(r),s={done:!1,value:t[0]},a=uFe(i&&i.length===t.length?i:lFe(t),e),o=aFe(a,t,{ease:Array.isArray(n)?n:cFe(t,n)});return{calculatedDuration:e,next:l=>(s.value=o(l),s.done=l>=e,s)}}const hFe=e=>e!==null;function ZB(e,{repeat:t,repeatType:i="loop"},r,n=1){const s=e.filter(hFe),o=n<0||t&&i!=="loop"&&t%2===1?0:s.length-1;return!o||r===void 0?s[o]:r}const dFe={decay:PO,inertia:PO,tween:wb,keyframes:wb,spring:pC};function zZ(e){typeof e.type=="string"&&(e.type=dFe[e.type])}class JB{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(t=>{this.resolve=t})}notifyFinished(){this.resolve()}then(t,i){return this.finished.then(t,i)}}const fFe=e=>e/100;class $B extends JB{constructor(t){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:i}=this.options;i&&i.updatedAt!==Vo.now()&&this.tick(Vo.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=t,this.initAnimation(),this.play(),t.autoplay===!1&&this.pause()}initAnimation(){const{options:t}=this;zZ(t);const{type:i=wb,repeat:r=0,repeatDelay:n=0,repeatType:s,velocity:a=0}=t;let{keyframes:o}=t;const l=i||wb;l!==wb&&typeof o[0]!="number"&&(this.mixKeyframes=tS(fFe,IZ(o[0],o[1])),o=[0,100]);const u=l({...t,keyframes:o});s==="mirror"&&(this.mirroredGenerator=l({...t,keyframes:[...o].reverse(),velocity:-a})),u.calculatedDuration===null&&(u.calculatedDuration=KB(u));const{calculatedDuration:c}=u;this.calculatedDuration=c,this.resolvedDuration=c+n,this.totalDuration=this.resolvedDuration*(r+1)-n,this.generator=u}updateTime(t){const i=Math.round(t-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=i}tick(t,i=!1){const{generator:r,totalDuration:n,mixKeyframes:s,mirroredGenerator:a,resolvedDuration:o,calculatedDuration:l}=this;if(this.startTime===null)return r.next(0);const{delay:u=0,keyframes:c,repeat:h,repeatType:d,repeatDelay:p,type:m,onUpdate:v,finalKeyframe:g}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-n/this.speed,this.startTime)),i?this.currentTime=t:this.updateTime(t);const w=this.currentTime-u*(this.playbackSpeed>=0?1:-1),S=this.playbackSpeed>=0?w<0:w>n;this.currentTime=Math.max(w,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=n);let _=this.currentTime,A=r;if(h){const T=Math.min(this.currentTime,n)/o;let D=Math.floor(T),L=T%1;!L&&T>=1&&(L=1),L===1&&D--,D=Math.min(D,h+1),!!(D%2)&&(d==="reverse"?(L=1-L,p&&(L-=p/o)):d==="mirror"&&(A=a)),_=kd(0,1,L)*o}const C=S?{done:!1,value:c[0]}:A.next(_);s&&(C.value=s(C.value));let{done:E}=C;!S&&l!==null&&(E=this.playbackSpeed>=0?this.currentTime>=n:this.currentTime<=0);const I=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&E);return I&&m!==PO&&(C.value=ZB(c,this.options,g,this.speed)),v&&v(C.value),I&&this.finish(),C}then(t,i){return this.finished.then(t,i)}get duration(){return Hl(this.calculatedDuration)}get iterationDuration(){const{delay:t=0}=this.options||{};return this.duration+Hl(t)}get time(){return Hl(this.currentTime)}set time(t){t=Yc(t),this.currentTime=t,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(t){this.updateTime(Vo.now());const i=this.playbackSpeed!==t;this.playbackSpeed=t,i&&(this.time=Hl(this.currentTime))}play(){if(this.isStopped)return;const{driver:t=KNe,startTime:i}=this.options;this.driver||(this.driver=t(n=>this.tick(n))),this.options.onPlay?.();const r=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=r):this.holdTime!==null?this.startTime=r-this.holdTime:this.startTime||(this.startTime=i??r),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Vo.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}attachTimeline(t){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),t.observe(this)}}function pFe(e){for(let t=1;t<e.length;t++)e[t]??(e[t]=e[t-1])}const Sg=e=>e*180/Math.PI,DO=e=>{const t=Sg(Math.atan2(e[1],e[0]));return RO(t)},mFe={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:DO,rotateZ:DO,skewX:e=>Sg(Math.atan(e[1])),skewY:e=>Sg(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},RO=e=>(e=e%360,e<0&&(e+=360),e),kW=DO,BW=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),NW=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),gFe={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:BW,scaleY:NW,scale:e=>(BW(e)+NW(e))/2,rotateX:e=>RO(Sg(Math.atan2(e[6],e[5]))),rotateY:e=>RO(Sg(Math.atan2(-e[2],e[0]))),rotateZ:kW,rotate:kW,skewX:e=>Sg(Math.atan(e[4])),skewY:e=>Sg(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function IO(e){return e.includes("scale")?1:0}function LO(e,t){if(!e||e==="none")return IO(t);const i=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let r,n;if(i)r=gFe,n=i;else{const o=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);r=mFe,n=o}if(!n)return IO(t);const s=r[t],a=n[1].split(",").map(yFe);return typeof s=="function"?s(a):a[s]}const vFe=(e,t)=>{const{transform:i="none"}=getComputedStyle(e);return LO(i,t)};function yFe(e){return parseFloat(e.trim())}const Jx=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],$x=new Set(Jx),FW=e=>e===Zx||e===Ai,xFe=new Set(["x","y","z"]),wFe=Jx.filter(e=>!xFe.has(e));function bFe(e){const t=[];return wFe.forEach(i=>{const r=e.getValue(i);r!==void 0&&(t.push([i,r.get()]),r.set(i.startsWith("scale")?1:0))}),t}const kg={width:({x:e},{paddingLeft:t="0",paddingRight:i="0"})=>e.max-e.min-parseFloat(t)-parseFloat(i),height:({y:e},{paddingTop:t="0",paddingBottom:i="0"})=>e.max-e.min-parseFloat(t)-parseFloat(i),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:(e,{transform:t})=>LO(t,"x"),y:(e,{transform:t})=>LO(t,"y")};kg.translateX=kg.x;kg.translateY=kg.y;const Bg=new Set;let OO=!1,zO=!1,kO=!1;function kZ(){if(zO){const e=Array.from(Bg).filter(r=>r.needsMeasurement),t=new Set(e.map(r=>r.element)),i=new Map;t.forEach(r=>{const n=bFe(r);n.length&&(i.set(r,n),r.render())}),e.forEach(r=>r.measureInitialState()),t.forEach(r=>{r.render();const n=i.get(r);n&&n.forEach(([s,a])=>{r.getValue(s)?.set(a)})}),e.forEach(r=>r.measureEndState()),e.forEach(r=>{r.suspendedScrollY!==void 0&&window.scrollTo(0,r.suspendedScrollY)})}zO=!1,OO=!1,Bg.forEach(e=>e.complete(kO)),Bg.clear()}function BZ(){Bg.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(zO=!0)})}function _Fe(){kO=!0,BZ(),kZ(),kO=!1}class eN{constructor(t,i,r,n,s,a=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...t],this.onComplete=i,this.name=r,this.motionValue=n,this.element=s,this.isAsync=a}scheduleResolve(){this.state="scheduled",this.isAsync?(Bg.add(this),OO||(OO=!0,en.read(BZ),en.resolveKeyframes(kZ))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:i,element:r,motionValue:n}=this;if(t[0]===null){const s=n?.get(),a=t[t.length-1];if(s!==void 0)t[0]=s;else if(r&&i){const o=r.readValue(i,a);o!=null&&(t[0]=o)}t[0]===void 0&&(t[0]=a),n&&s===void 0&&n.set(t[0])}pFe(t)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(t=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,t),Bg.delete(this)}cancel(){this.state==="scheduled"&&(Bg.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const SFe=e=>e.startsWith("--");function MFe(e,t,i){SFe(t)?e.style.setProperty(t,i):e.style[t]=i}const AFe=VB(()=>window.ScrollTimeline!==void 0),EFe={};function CFe(e,t){const i=VB(e);return()=>EFe[t]??i()}const NZ=CFe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Kw=([e,t,i,r])=>`cubic-bezier(${e}, ${t}, ${i}, ${r})`,UW={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Kw([0,.65,.55,1]),circOut:Kw([.55,0,1,.45]),backIn:Kw([.31,.01,.66,-.59]),backOut:Kw([.33,1.53,.69,.99])};function FZ(e,t){if(e)return typeof e=="function"?NZ()?LZ(e,t):"ease-out":SZ(e)?Kw(e):Array.isArray(e)?e.map(i=>FZ(i,t)||UW.easeOut):UW[e]}function TFe(e,t,i,{delay:r=0,duration:n=300,repeat:s=0,repeatType:a="loop",ease:o="easeOut",times:l}={},u=void 0){const c={[t]:i};l&&(c.offset=l);const h=FZ(o,n);Array.isArray(h)&&(c.easing=h);const d={delay:r,duration:n,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:s+1,direction:a==="reverse"?"alternate":"normal"};return u&&(d.pseudoElement=u),e.animate(c,d)}function UZ(e){return typeof e=="function"&&"applyToOptions"in e}function PFe({type:e,...t}){return UZ(e)&&NZ()?e.applyToOptions(t):(t.duration??(t.duration=300),t.ease??(t.ease="easeOut"),t)}class DFe extends JB{constructor(t){if(super(),this.finishedTime=null,this.isStopped=!1,!t)return;const{element:i,name:r,keyframes:n,pseudoElement:s,allowFlatten:a=!1,finalKeyframe:o,onComplete:l}=t;this.isPseudoElement=!!s,this.allowFlatten=a,this.options=t,UB(typeof t.type!="string");const u=PFe(t);this.animation=TFe(i,r,n,u,s),u.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!s){const c=ZB(n,this.options,o,this.speed);this.updateMotionValue?this.updateMotionValue(c):MFe(i,r,c),this.animation.cancel()}l?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:t}=this;t==="idle"||t==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const t=this.animation.effect?.getComputedTiming?.().duration||0;return Hl(Number(t))}get iterationDuration(){const{delay:t=0}=this.options||{};return this.duration+Hl(t)}get time(){return Hl(Number(this.animation.currentTime)||0)}set time(t){this.finishedTime=null,this.animation.currentTime=Yc(t)}get speed(){return this.animation.playbackRate}set speed(t){t<0&&(this.finishedTime=null),this.animation.playbackRate=t}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(t){this.animation.startTime=t}attachTimeline({timeline:t,observe:i}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,t&&AFe()?(this.animation.timeline=t,Xl):i(this)}}const VZ={anticipate:xZ,backInOut:yZ,circInOut:bZ};function RFe(e){return e in VZ}function IFe(e){typeof e.ease=="string"&&RFe(e.ease)&&(e.ease=VZ[e.ease])}const VW=10;class LFe extends DFe{constructor(t){IFe(t),zZ(t),super(t),t.startTime&&(this.startTime=t.startTime),this.options=t}updateMotionValue(t){const{motionValue:i,onUpdate:r,onComplete:n,element:s,...a}=this.options;if(!i)return;if(t!==void 0){i.set(t);return}const o=new $B({...a,autoplay:!1}),l=Yc(this.finishedTime??this.time);i.setWithVelocity(o.sample(l-VW).value,o.sample(l).value,VW),o.stop()}}const jW=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(Bp.test(e)||e==="0")&&!e.startsWith("url("));function OFe(e){const t=e[0];if(e.length===1)return!0;for(let i=0;i<e.length;i++)if(e[i]!==t)return!0}function zFe(e,t,i,r){const n=e[0];if(n===null)return!1;if(t==="display"||t==="visibility")return!0;const s=e[e.length-1],a=jW(n,t),o=jW(s,t);return!a||!o?!1:OFe(e)||(i==="spring"||UZ(i))&&r}function BO(e){e.duration=0,e.type="keyframes"}const kFe=new Set(["opacity","clipPath","filter","transform"]),BFe=VB(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function NFe(e){const{motionValue:t,name:i,repeatDelay:r,repeatType:n,damping:s,type:a}=e;if(!(t?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:l,transformTemplate:u}=t.owner.getProps();return BFe()&&i&&kFe.has(i)&&(i!=="transform"||!u)&&!l&&!r&&n!=="mirror"&&s!==0&&a!=="inertia"}const FFe=40;class UFe extends JB{constructor({autoplay:t=!0,delay:i=0,type:r="keyframes",repeat:n=0,repeatDelay:s=0,repeatType:a="loop",keyframes:o,name:l,motionValue:u,element:c,...h}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=Vo.now();const d={autoplay:t,delay:i,type:r,repeat:n,repeatDelay:s,repeatType:a,name:l,motionValue:u,element:c,...h},p=c?.KeyframeResolver||eN;this.keyframeResolver=new p(o,(m,v,g)=>this.onKeyframesResolved(m,v,d,!g),l,u,c),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(t,i,r,n){this.keyframeResolver=void 0;const{name:s,type:a,velocity:o,delay:l,isHandoff:u,onUpdate:c}=r;this.resolvedAt=Vo.now(),zFe(t,s,a,o)||((Bd.instantAnimations||!l)&&c?.(ZB(t,r,i)),t[0]=t[t.length-1],BO(r),r.repeat=0);const d={startTime:n?this.resolvedAt?this.resolvedAt-this.createdAt>FFe?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:i,...r,keyframes:t},p=!u&&NFe(d)?new LFe({...d,element:d.motionValue.owner.current}):new $B(d);p.finished.then(()=>this.notifyFinished()).catch(Xl),this.pendingTimeline&&(this.stopTimeline=p.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=p}get finished(){return this._animation?this.animation.finished:this._finished}then(t,i){return this.finished.finally(t).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),_Fe()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(t){this.animation.time=t}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(t){this.animation.speed=t}get startTime(){return this.animation.startTime}attachTimeline(t){return this._animation?this.stopTimeline=this.animation.attachTimeline(t):this.pendingTimeline=t,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const VFe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function jFe(e){const t=VFe.exec(e);if(!t)return[,];const[,i,r,n]=t;return[`--${i??r}`,n]}function jZ(e,t,i=1){const[r,n]=jFe(e);if(!r)return;const s=window.getComputedStyle(t).getPropertyValue(r);if(s){const a=s.trim();return cZ(a)?parseFloat(a):a}return qB(n)?jZ(n,t,i+1):n}function tN(e,t){return e?.[t]??e?.default??e}const HZ=new Set(["width","height","top","left","right","bottom",...Jx]),HFe={test:e=>e==="auto",parse:e=>e},WZ=e=>t=>t.test(e),GZ=[Zx,Ai,Qc,Kf,ONe,LNe,HFe],HW=e=>GZ.find(WZ(e));function WFe(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||dZ(e):!0}const GFe=new Set(["brightness","contrast","saturate","opacity"]);function qFe(e){const[t,i]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[r]=i.match(XB)||[];if(!r)return e;const n=i.replace(r,"");let s=GFe.has(t)?1:0;return r!==i&&(s*=100),t+"("+s+n+")"}const XFe=/\b([a-z-]*)\(.*?\)/gu,NO={...Bp,getAnimatableNone:e=>{const t=e.match(XFe);return t?t.map(qFe).join(" "):e}},WW={...Zx,transform:Math.round},YFe={rotate:Kf,rotateX:Kf,rotateY:Kf,rotateZ:Kf,scale:gE,scaleX:gE,scaleY:gE,scaleZ:gE,skew:Kf,skewX:Kf,skewY:Kf,distance:Ai,translateX:Ai,translateY:Ai,translateZ:Ai,x:Ai,y:Ai,z:Ai,perspective:Ai,transformPerspective:Ai,opacity:d_,originX:RW,originY:RW,originZ:Ai},iN={borderWidth:Ai,borderTopWidth:Ai,borderRightWidth:Ai,borderBottomWidth:Ai,borderLeftWidth:Ai,borderRadius:Ai,radius:Ai,borderTopLeftRadius:Ai,borderTopRightRadius:Ai,borderBottomRightRadius:Ai,borderBottomLeftRadius:Ai,width:Ai,maxWidth:Ai,height:Ai,maxHeight:Ai,top:Ai,right:Ai,bottom:Ai,left:Ai,padding:Ai,paddingTop:Ai,paddingRight:Ai,paddingBottom:Ai,paddingLeft:Ai,margin:Ai,marginTop:Ai,marginRight:Ai,marginBottom:Ai,marginLeft:Ai,backgroundPositionX:Ai,backgroundPositionY:Ai,...YFe,zIndex:WW,fillOpacity:d_,strokeOpacity:d_,numOctaves:WW},QFe={...iN,color:$n,backgroundColor:$n,outlineColor:$n,fill:$n,stroke:$n,borderColor:$n,borderTopColor:$n,borderRightColor:$n,borderBottomColor:$n,borderLeftColor:$n,filter:NO,WebkitFilter:NO},qZ=e=>QFe[e];function XZ(e,t){let i=qZ(e);return i!==NO&&(i=Bp),i.getAnimatableNone?i.getAnimatableNone(t):void 0}const KFe=new Set(["auto","none","0"]);function ZFe(e,t,i){let r=0,n;for(;r<e.length&&!n;){const s=e[r];typeof s=="string"&&!KFe.has(s)&&f_(s).values.length&&(n=e[r]),r++}if(n&&i)for(const s of t)e[s]=XZ(i,n)}class JFe extends eN{constructor(t,i,r,n,s){super(t,i,r,n,s,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:i,name:r}=this;if(!i||!i.current)return;super.readKeyframes();for(let l=0;l<t.length;l++){let u=t[l];if(typeof u=="string"&&(u=u.trim(),qB(u))){const c=jZ(u,i.current);c!==void 0&&(t[l]=c),l===t.length-1&&(this.finalKeyframe=u)}}if(this.resolveNoneKeyframes(),!HZ.has(r)||t.length!==2)return;const[n,s]=t,a=HW(n),o=HW(s);if(a!==o)if(FW(a)&&FW(o))for(let l=0;l<t.length;l++){const u=t[l];typeof u=="string"&&(t[l]=parseFloat(u))}else kg[r]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:i}=this,r=[];for(let n=0;n<t.length;n++)(t[n]===null||WFe(t[n]))&&r.push(n);r.length&&ZFe(t,r,i)}measureInitialState(){const{element:t,unresolvedKeyframes:i,name:r}=this;if(!t||!t.current)return;r==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=kg[r](t.measureViewportBox(),window.getComputedStyle(t.current)),i[0]=this.measuredOrigin;const n=i[i.length-1];n!==void 0&&t.getValue(r,n).jump(n,!1)}measureEndState(){const{element:t,name:i,unresolvedKeyframes:r}=this;if(!t||!t.current)return;const n=t.getValue(i);n&&n.jump(this.measuredOrigin,!1);const s=r.length-1,a=r[s];r[s]=kg[i](t.measureViewportBox(),window.getComputedStyle(t.current)),a!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=a),this.removedTransforms?.length&&this.removedTransforms.forEach(([o,l])=>{t.getValue(o).set(l)}),this.resolveNoneKeyframes()}}function $Fe(e,t,i){if(e instanceof EventTarget)return[e];if(typeof e=="string"){let r=document;const n=i?.[e]??r.querySelectorAll(e);return n?Array.from(n):[]}return Array.from(e)}const YZ=(e,t)=>t&&typeof e=="number"?t.transform(e):e;function e4e(e){return hZ(e)&&"offsetHeight"in e}const GW=30,t4e=e=>!isNaN(parseFloat(e));class i4e{constructor(t,i={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=r=>{const n=Vo.now();if(this.updatedAt!==n&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(r),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const s of this.dependents)s.dirty()},this.hasAnimated=!1,this.setCurrent(t),this.owner=i.owner}setCurrent(t){this.current=t,this.updatedAt=Vo.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=t4e(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,i){this.events[t]||(this.events[t]=new jB);const r=this.events[t].add(i);return t==="change"?()=>{r(),en.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,i){this.passiveEffect=t,this.stopPassiveEffect=i}set(t){this.passiveEffect?this.passiveEffect(t,this.updateAndNotify):this.updateAndNotify(t)}setWithVelocity(t,i,r){this.set(i),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-r}jump(t,i=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,i&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(t){this.dependents||(this.dependents=new Set),this.dependents.add(t)}removeDependent(t){this.dependents&&this.dependents.delete(t)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=Vo.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>GW)return 0;const i=Math.min(this.updatedAt-this.prevUpdatedAt,GW);return fZ(parseFloat(this.current)-parseFloat(this.prevFrameValue),i)}start(t){return this.stop(),new Promise(i=>{this.hasAnimated=!0,this.animation=t(i),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function _x(e,t){return new i4e(e,t)}const{schedule:rN}=MZ(queueMicrotask,!1),Ru={x:!1,y:!1};function QZ(){return Ru.x||Ru.y}function r4e(e){return e==="x"||e==="y"?Ru[e]?null:(Ru[e]=!0,()=>{Ru[e]=!1}):Ru.x||Ru.y?null:(Ru.x=Ru.y=!0,()=>{Ru.x=Ru.y=!1})}function KZ(e,t){const i=$Fe(e),r=new AbortController,n={passive:!0,...t,signal:r.signal};return[i,n,()=>r.abort()]}function qW(e){return!(e.pointerType==="touch"||QZ())}function n4e(e,t,i={}){const[r,n,s]=KZ(e,i),a=o=>{if(!qW(o))return;const{target:l}=o,u=t(l,o);if(typeof u!="function"||!l)return;const c=h=>{qW(h)&&(u(h),l.removeEventListener("pointerleave",c))};l.addEventListener("pointerleave",c,n)};return r.forEach(o=>{o.addEventListener("pointerenter",a,n)}),s}const ZZ=(e,t)=>t?e===t?!0:ZZ(e,t.parentElement):!1,nN=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,s4e=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function a4e(e){return s4e.has(e.tagName)||e.tabIndex!==-1}const QE=new WeakSet;function XW(e){return t=>{t.key==="Enter"&&e(t)}}function yR(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const o4e=(e,t)=>{const i=e.currentTarget;if(!i)return;const r=XW(()=>{if(QE.has(i))return;yR(i,"down");const n=XW(()=>{yR(i,"up")}),s=()=>yR(i,"cancel");i.addEventListener("keyup",n,t),i.addEventListener("blur",s,t)});i.addEventListener("keydown",r,t),i.addEventListener("blur",()=>i.removeEventListener("keydown",r),t)};function YW(e){return nN(e)&&!QZ()}function l4e(e,t,i={}){const[r,n,s]=KZ(e,i),a=o=>{const l=o.currentTarget;if(!YW(o))return;QE.add(l);const u=t(l,o),c=(p,m)=>{window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",d),QE.has(l)&&QE.delete(l),YW(p)&&typeof u=="function"&&u(p,{success:m})},h=p=>{c(p,l===window||l===document||i.useGlobalTarget||ZZ(l,p.target))},d=p=>{c(p,!1)};window.addEventListener("pointerup",h,n),window.addEventListener("pointercancel",d,n)};return r.forEach(o=>{(i.useGlobalTarget?window:o).addEventListener("pointerdown",a,n),e4e(o)&&(o.addEventListener("focus",u=>o4e(u,n)),!a4e(o)&&!o.hasAttribute("tabindex")&&(o.tabIndex=0))}),s}function JZ(e){return hZ(e)&&"ownerSVGElement"in e}function u4e(e){return JZ(e)&&e.tagName==="svg"}const Na=e=>!!(e&&e.getVelocity),c4e=[...GZ,$n,Bp],h4e=e=>c4e.find(WZ(e)),$Z=xe.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});function d4e(e=!0){const t=xe.useContext(BB);if(t===null)return[!0,null];const{isPresent:i,onExitComplete:r,register:n}=t,s=xe.useId();xe.useEffect(()=>{if(e)return n(s)},[e]);const a=xe.useCallback(()=>e&&r&&r(s),[s,r,e]);return!i&&r?[!1,a]:[!0]}const eJ=xe.createContext({strict:!1}),QW={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Sx={};for(const e in QW)Sx[e]={isEnabled:t=>QW[e].some(i=>!!t[i])};function f4e(e){for(const t in e)Sx[t]={...Sx[t],...e[t]}}const p4e=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function mC(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||p4e.has(e)}let tJ=e=>!mC(e);function m4e(e){typeof e=="function"&&(tJ=t=>t.startsWith("on")?!mC(t):e(t))}try{m4e(require("@emotion/is-prop-valid").default)}catch{}function g4e(e,t,i){const r={};for(const n in e)n==="values"&&typeof e.values=="object"||(tJ(n)||i===!0&&mC(n)||!t&&!mC(n)||e.draggable&&n.startsWith("onDrag"))&&(r[n]=e[n]);return r}const vT=xe.createContext({});function yT(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}function p_(e){return typeof e=="string"||Array.isArray(e)}const sN=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],aN=["initial",...sN];function xT(e){return yT(e.animate)||aN.some(t=>p_(e[t]))}function iJ(e){return!!(xT(e)||e.variants)}function v4e(e,t){if(xT(e)){const{initial:i,animate:r}=e;return{initial:i===!1||p_(i)?i:void 0,animate:p_(r)?r:void 0}}return e.inherit!==!1?t:{}}function y4e(e){const{initial:t,animate:i}=v4e(e,xe.useContext(vT));return xe.useMemo(()=>({initial:t,animate:i}),[KW(t),KW(i)])}function KW(e){return Array.isArray(e)?e.join(" "):e}const m_={};function x4e(e){for(const t in e)m_[t]=e[t],GB(t)&&(m_[t].isCSSVariable=!0)}function rJ(e,{layout:t,layoutId:i}){return $x.has(e)||e.startsWith("origin")||(t||i!==void 0)&&(!!m_[e]||e==="opacity")}const w4e={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},b4e=Jx.length;function _4e(e,t,i){let r="",n=!0;for(let s=0;s<b4e;s++){const a=Jx[s],o=e[a];if(o===void 0)continue;let l=!0;if(typeof o=="number"?l=o===(a.startsWith("scale")?1:0):l=parseFloat(o)===0,!l||i){const u=YZ(o,iN[a]);if(!l){n=!1;const c=w4e[a]||a;r+=`${c}(${u}) `}i&&(t[a]=u)}}return r=r.trim(),i?r=i(t,n?"":r):n&&(r="none"),r}function oN(e,t,i){const{style:r,vars:n,transformOrigin:s}=e;let a=!1,o=!1;for(const l in t){const u=t[l];if($x.has(l)){a=!0;continue}else if(GB(l)){n[l]=u;continue}else{const c=YZ(u,iN[l]);l.startsWith("origin")?(o=!0,s[l]=c):r[l]=c}}if(t.transform||(a||i?r.transform=_4e(t,e.transform,i):r.transform&&(r.transform="none")),o){const{originX:l="50%",originY:u="50%",originZ:c=0}=s;r.transformOrigin=`${l} ${u} ${c}`}}const lN=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function nJ(e,t,i){for(const r in t)!Na(t[r])&&!rJ(r,i)&&(e[r]=t[r])}function S4e({transformTemplate:e},t){return xe.useMemo(()=>{const i=lN();return oN(i,t,e),Object.assign({},i.vars,i.style)},[t])}function M4e(e,t){const i=e.style||{},r={};return nJ(r,i,e),Object.assign(r,S4e(e,t)),r}function A4e(e,t){const i={},r=M4e(e,t);return e.drag&&e.dragListener!==!1&&(i.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(i.tabIndex=0),i.style=r,i}const E4e={offset:"stroke-dashoffset",array:"stroke-dasharray"},C4e={offset:"strokeDashoffset",array:"strokeDasharray"};function T4e(e,t,i=1,r=0,n=!0){e.pathLength=1;const s=n?E4e:C4e;e[s.offset]=Ai.transform(-r);const a=Ai.transform(t),o=Ai.transform(i);e[s.array]=`${a} ${o}`}function sJ(e,{attrX:t,attrY:i,attrScale:r,pathLength:n,pathSpacing:s=1,pathOffset:a=0,...o},l,u,c){if(oN(e,o,u),l){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:h,style:d}=e;h.transform&&(d.transform=h.transform,delete h.transform),(d.transform||h.transformOrigin)&&(d.transformOrigin=h.transformOrigin??"50% 50%",delete h.transformOrigin),d.transform&&(d.transformBox=c?.transformBox??"fill-box",delete h.transformBox),t!==void 0&&(h.x=t),i!==void 0&&(h.y=i),r!==void 0&&(h.scale=r),n!==void 0&&T4e(h,n,s,a,!1)}const aJ=()=>({...lN(),attrs:{}}),oJ=e=>typeof e=="string"&&e.toLowerCase()==="svg";function P4e(e,t,i,r){const n=xe.useMemo(()=>{const s=aJ();return sJ(s,t,oJ(r),e.transformTemplate,e.style),{...s.attrs,style:{...s.style}}},[t]);if(e.style){const s={};nJ(s,e.style,e),n.style={...s,...n.style}}return n}const D4e=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function uN(e){return typeof e!="string"||e.includes("-")?!1:!!(D4e.indexOf(e)>-1||/[A-Z]/u.test(e))}function R4e(e,t,i,{latestValues:r},n,s=!1){const o=(uN(e)?P4e:A4e)(t,r,n,e),l=g4e(t,typeof e=="string",s),u=e!==xe.Fragment?{...l,...o,ref:i}:{},{children:c}=t,h=xe.useMemo(()=>Na(c)?c.get():c,[c]);return xe.createElement(e,{...u,children:h})}function ZW(e){const t=[{},{}];return e?.values.forEach((i,r)=>{t[0][r]=i.get(),t[1][r]=i.getVelocity()}),t}function cN(e,t,i,r){if(typeof t=="function"){const[n,s]=ZW(r);t=t(i!==void 0?i:e.custom,n,s)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[n,s]=ZW(r);t=t(i!==void 0?i:e.custom,n,s)}return t}function KE(e){return Na(e)?e.get():e}function I4e({scrapeMotionValuesFromProps:e,createRenderState:t},i,r,n){return{latestValues:L4e(i,r,n,e),renderState:t()}}function L4e(e,t,i,r){const n={},s=r(e,{});for(const d in s)n[d]=KE(s[d]);let{initial:a,animate:o}=e;const l=xT(e),u=iJ(e);t&&u&&!l&&e.inherit!==!1&&(a===void 0&&(a=t.initial),o===void 0&&(o=t.animate));let c=i?i.initial===!1:!1;c=c||a===!1;const h=c?o:a;if(h&&typeof h!="boolean"&&!yT(h)){const d=Array.isArray(h)?h:[h];for(let p=0;p<d.length;p++){const m=cN(e,d[p]);if(m){const{transitionEnd:v,transition:g,...w}=m;for(const S in w){let _=w[S];if(Array.isArray(_)){const A=c?_.length-1:0;_=_[A]}_!==null&&(n[S]=_)}for(const S in v)n[S]=v[S]}}}return n}const lJ=e=>(t,i)=>{const r=xe.useContext(vT),n=xe.useContext(BB),s=()=>I4e(e,t,r,n);return i?s():fNe(s)};function hN(e,t,i){const{style:r}=e,n={};for(const s in r)(Na(r[s])||t.style&&Na(t.style[s])||rJ(s,e)||i?.getValue(s)?.liveStyle!==void 0)&&(n[s]=r[s]);return n}const O4e=lJ({scrapeMotionValuesFromProps:hN,createRenderState:lN});function uJ(e,t,i){const r=hN(e,t,i);for(const n in e)if(Na(e[n])||Na(t[n])){const s=Jx.indexOf(n)!==-1?"attr"+n.charAt(0).toUpperCase()+n.substring(1):n;r[s]=e[n]}return r}const z4e=lJ({scrapeMotionValuesFromProps:uJ,createRenderState:aJ}),k4e=Symbol.for("motionComponentSymbol");function zy(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function B4e(e,t,i){return xe.useCallback(r=>{r&&e.onMount&&e.onMount(r),t&&(r?t.mount(r):t.unmount()),i&&(typeof i=="function"?i(r):zy(i)&&(i.current=r))},[t])}const dN=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),N4e="framerAppearId",cJ="data-"+dN(N4e),hJ=xe.createContext({});function F4e(e,t,i,r,n){const{visualElement:s}=xe.useContext(vT),a=xe.useContext(eJ),o=xe.useContext(BB),l=xe.useContext($Z).reducedMotion,u=xe.useRef(null);r=r||a.renderer,!u.current&&r&&(u.current=r(e,{visualState:t,parent:s,props:i,presenceContext:o,blockInitialAnimation:o?o.initial===!1:!1,reducedMotionConfig:l}));const c=u.current,h=xe.useContext(hJ);c&&!c.projection&&n&&(c.type==="html"||c.type==="svg")&&U4e(u.current,i,n,h);const d=xe.useRef(!1);xe.useInsertionEffect(()=>{c&&d.current&&c.update(i,o)});const p=i[cJ],m=xe.useRef(!!p&&!window.MotionHandoffIsComplete?.(p)&&window.MotionHasOptimisedAnimation?.(p));return pNe(()=>{c&&(d.current=!0,window.MotionIsMounted=!0,c.updateFeatures(),c.scheduleRenderMicrotask(),m.current&&c.animationState&&c.animationState.animateChanges())}),xe.useEffect(()=>{c&&(!m.current&&c.animationState&&c.animationState.animateChanges(),m.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(p)}),m.current=!1),c.enteringChildren=void 0)}),c}function U4e(e,t,i,r){const{layoutId:n,layout:s,drag:a,dragConstraints:o,layoutScroll:l,layoutRoot:u,layoutCrossfade:c}=t;e.projection=new i(e.latestValues,t["data-framer-portal-id"]?void 0:dJ(e.parent)),e.projection.setOptions({layoutId:n,layout:s,alwaysMeasureLayout:!!a||o&&zy(o),visualElement:e,animationType:typeof s=="string"?s:"both",initialPromotionConfig:r,crossfade:c,layoutScroll:l,layoutRoot:u})}function dJ(e){if(e)return e.options.allowProjection!==!1?e.projection:dJ(e.parent)}function xR(e,{forwardMotionProps:t=!1}={},i,r){i&&f4e(i);const n=uN(e)?z4e:O4e;function s(o,l){let u;const c={...xe.useContext($Z),...o,layoutId:V4e(o)},{isStatic:h}=c,d=y4e(o),p=n(o,h);if(!h&&kB){j4e();const m=H4e(c);u=m.MeasureLayout,d.visualElement=F4e(e,p,c,r,m.ProjectionNode)}return at.jsxs(vT.Provider,{value:d,children:[u&&d.visualElement?at.jsx(u,{visualElement:d.visualElement,...c}):null,R4e(e,o,B4e(p,d.visualElement,l),p,h,t)]})}s.displayName=`motion.${typeof e=="string"?e:`create(${e.displayName??e.name??""})`}`;const a=xe.forwardRef(s);return a[k4e]=e,a}function V4e({layoutId:e}){const t=xe.useContext(uZ).id;return t&&e!==void 0?t+"-"+e:e}function j4e(e,t){xe.useContext(eJ).strict}function H4e(e){const{drag:t,layout:i}=Sx;if(!t&&!i)return{};const r={...t,...i};return{MeasureLayout:t?.isEnabled(e)||i?.isEnabled(e)?r.MeasureLayout:void 0,ProjectionNode:r.ProjectionNode}}function W4e(e,t){if(typeof Proxy>"u")return xR;const i=new Map,r=(s,a)=>xR(s,a,e,t),n=(s,a)=>r(s,a);return new Proxy(n,{get:(s,a)=>a==="create"?r:(i.has(a)||i.set(a,xR(a,void 0,e,t)),i.get(a))})}function fJ({top:e,left:t,right:i,bottom:r}){return{x:{min:t,max:i},y:{min:e,max:r}}}function G4e({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function q4e(e,t){if(!t)return e;const i=t({x:e.left,y:e.top}),r=t({x:e.right,y:e.bottom});return{top:i.y,left:i.x,bottom:r.y,right:r.x}}function wR(e){return e===void 0||e===1}function FO({scale:e,scaleX:t,scaleY:i}){return!wR(e)||!wR(t)||!wR(i)}function $m(e){return FO(e)||pJ(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function pJ(e){return JW(e.x)||JW(e.y)}function JW(e){return e&&e!=="0%"}function gC(e,t,i){const r=e-i,n=t*r;return i+n}function $W(e,t,i,r,n){return n!==void 0&&(e=gC(e,n,r)),gC(e,i,r)+t}function UO(e,t=0,i=1,r,n){e.min=$W(e.min,t,i,r,n),e.max=$W(e.max,t,i,r,n)}function mJ(e,{x:t,y:i}){UO(e.x,t.translate,t.scale,t.originPoint),UO(e.y,i.translate,i.scale,i.originPoint)}const eG=.999999999999,tG=1.0000000000001;function X4e(e,t,i,r=!1){const n=i.length;if(!n)return;t.x=t.y=1;let s,a;for(let o=0;o<n;o++){s=i[o],a=s.projectionDelta;const{visualElement:l}=s.options;l&&l.props.style&&l.props.style.display==="contents"||(r&&s.options.layoutScroll&&s.scroll&&s!==s.root&&By(e,{x:-s.scroll.offset.x,y:-s.scroll.offset.y}),a&&(t.x*=a.x.scale,t.y*=a.y.scale,mJ(e,a)),r&&$m(s.latestValues)&&By(e,s.latestValues))}t.x<tG&&t.x>eG&&(t.x=1),t.y<tG&&t.y>eG&&(t.y=1)}function ky(e,t){e.min=e.min+t,e.max=e.max+t}function iG(e,t,i,r,n=.5){const s=cn(e.min,e.max,n);UO(e,t,i,s,r)}function By(e,t){iG(e.x,t.x,t.scaleX,t.scale,t.originX),iG(e.y,t.y,t.scaleY,t.scale,t.originY)}function gJ(e,t){return fJ(q4e(e.getBoundingClientRect(),t))}function Y4e(e,t,i){const r=gJ(e,i),{scroll:n}=t;return n&&(ky(r.x,n.offset.x),ky(r.y,n.offset.y)),r}const rG=()=>({translate:0,scale:1,origin:0,originPoint:0}),Ny=()=>({x:rG(),y:rG()}),nG=()=>({min:0,max:0}),ys=()=>({x:nG(),y:nG()}),VO={current:null},vJ={current:!1};function Q4e(){if(vJ.current=!0,!!kB)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>VO.current=e.matches;e.addEventListener("change",t),t()}else VO.current=!1}const K4e=new WeakMap;function Z4e(e,t,i){for(const r in t){const n=t[r],s=i[r];if(Na(n))e.addValue(r,n);else if(Na(s))e.addValue(r,_x(n,{owner:e}));else if(s!==n)if(e.hasValue(r)){const a=e.getValue(r);a.liveStyle===!0?a.jump(n):a.hasAnimated||a.set(n)}else{const a=e.getStaticValue(r);e.addValue(r,_x(a!==void 0?a:n,{owner:e}))}}for(const r in i)t[r]===void 0&&e.removeValue(r);return t}const sG=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class J4e{scrapeMotionValuesFromProps(t,i,r){return{}}constructor({parent:t,props:i,presenceContext:r,reducedMotionConfig:n,blockInitialAnimation:s,visualState:a},o={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=eN,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const d=Vo.now();this.renderScheduledAt<d&&(this.renderScheduledAt=d,en.render(this.render,!1,!0))};const{latestValues:l,renderState:u}=a;this.latestValues=l,this.baseTarget={...l},this.initialValues=i.initial?{...l}:{},this.renderState=u,this.parent=t,this.props=i,this.presenceContext=r,this.depth=t?t.depth+1:0,this.reducedMotionConfig=n,this.options=o,this.blockInitialAnimation=!!s,this.isControllingVariants=xT(i),this.isVariantNode=iJ(i),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:c,...h}=this.scrapeMotionValuesFromProps(i,{},this);for(const d in h){const p=h[d];l[d]!==void 0&&Na(p)&&p.set(l[d])}}mount(t){this.current=t,K4e.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((i,r)=>this.bindToMotionValue(r,i)),vJ.current||Q4e(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:VO.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),kp(this.notifyUpdate),kp(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const i=this.features[t];i&&(i.unmount(),i.isMounted=!1)}this.current=null}addChild(t){this.children.add(t),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(t)}removeChild(t){this.children.delete(t),this.enteringChildren&&this.enteringChildren.delete(t)}bindToMotionValue(t,i){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const r=$x.has(t);r&&this.onBindTransform&&this.onBindTransform();const n=i.on("change",a=>{this.latestValues[t]=a,this.props.onUpdate&&en.preRender(this.notifyUpdate),r&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let s;window.MotionCheckAppearSync&&(s=window.MotionCheckAppearSync(this,t,i)),this.valueSubscriptions.set(t,()=>{n(),s&&s(),i.owner&&i.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in Sx){const i=Sx[t];if(!i)continue;const{isEnabled:r,Feature:n}=i;if(!this.features[t]&&n&&r(this.props)&&(this.features[t]=new n(this)),this.features[t]){const s=this.features[t];s.isMounted?s.update():(s.mount(),s.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):ys()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,i){this.latestValues[t]=i}update(t,i){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=i;for(let r=0;r<sG.length;r++){const n=sG[r];this.propEventSubscriptions[n]&&(this.propEventSubscriptions[n](),delete this.propEventSubscriptions[n]);const s="on"+n,a=t[s];a&&(this.propEventSubscriptions[n]=this.on(n,a))}this.prevMotionValues=Z4e(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const i=this.getClosestVariantNode();if(i)return i.variantChildren&&i.variantChildren.add(t),()=>i.variantChildren.delete(t)}addValue(t,i){const r=this.values.get(t);i!==r&&(r&&this.removeValue(t),this.bindToMotionValue(t,i),this.values.set(t,i),this.latestValues[t]=i.get())}removeValue(t){this.values.delete(t);const i=this.valueSubscriptions.get(t);i&&(i(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,i){if(this.props.values&&this.props.values[t])return this.props.values[t];let r=this.values.get(t);return r===void 0&&i!==void 0&&(r=_x(i===null?void 0:i,{owner:this}),this.addValue(t,r)),r}readValue(t,i){let r=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:this.getBaseTargetFromProps(this.props,t)??this.readValueFromInstance(this.current,t,this.options);return r!=null&&(typeof r=="string"&&(cZ(r)||dZ(r))?r=parseFloat(r):!h4e(r)&&Bp.test(i)&&(r=XZ(t,i)),this.setBaseTarget(t,Na(r)?r.get():r)),Na(r)?r.get():r}setBaseTarget(t,i){this.baseTarget[t]=i}getBaseTarget(t){const{initial:i}=this.props;let r;if(typeof i=="string"||typeof i=="object"){const s=cN(this.props,i,this.presenceContext?.custom);s&&(r=s[t])}if(i&&r!==void 0)return r;const n=this.getBaseTargetFromProps(this.props,t);return n!==void 0&&!Na(n)?n:this.initialValues[t]!==void 0&&r===void 0?void 0:this.baseTarget[t]}on(t,i){return this.events[t]||(this.events[t]=new jB),this.events[t].add(i)}notify(t,...i){this.events[t]&&this.events[t].notify(...i)}scheduleRenderMicrotask(){rN.render(this.render)}}class yJ extends J4e{constructor(){super(...arguments),this.KeyframeResolver=JFe}sortInstanceNodePosition(t,i){return t.compareDocumentPosition(i)&2?1:-1}getBaseTargetFromProps(t,i){return t.style?t.style[i]:void 0}removeValueFromRenderState(t,{vars:i,style:r}){delete i[t],delete r[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;Na(t)&&(this.childSubscription=t.on("change",i=>{this.current&&(this.current.textContent=`${i}`)}))}}function xJ(e,{style:t,vars:i},r,n){const s=e.style;let a;for(a in t)s[a]=t[a];n?.applyProjectionStyles(s,r);for(a in i)s.setProperty(a,i[a])}function $4e(e){return window.getComputedStyle(e)}class eUe extends yJ{constructor(){super(...arguments),this.type="html",this.renderInstance=xJ}readValueFromInstance(t,i){if($x.has(i))return this.projection?.isProjecting?IO(i):vFe(t,i);{const r=$4e(t),n=(GB(i)?r.getPropertyValue(i):r[i])||0;return typeof n=="string"?n.trim():n}}measureInstanceViewportBox(t,{transformPagePoint:i}){return gJ(t,i)}build(t,i,r){oN(t,i,r.transformTemplate)}scrapeMotionValuesFromProps(t,i,r){return hN(t,i,r)}}const wJ=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function tUe(e,t,i,r){xJ(e,t,void 0,r);for(const n in t.attrs)e.setAttribute(wJ.has(n)?n:dN(n),t.attrs[n])}class iUe extends yJ{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=ys}getBaseTargetFromProps(t,i){return t[i]}readValueFromInstance(t,i){if($x.has(i)){const r=qZ(i);return r&&r.default||0}return i=wJ.has(i)?i:dN(i),t.getAttribute(i)}scrapeMotionValuesFromProps(t,i,r){return uJ(t,i,r)}build(t,i,r){sJ(t,i,this.isSVGTag,r.transformTemplate,r.style)}renderInstance(t,i,r,n){tUe(t,i,r,n)}mount(t){this.isSVGTag=oJ(t.tagName),super.mount(t)}}const rUe=(e,t)=>uN(e)?new iUe(t):new eUe(t,{allowProjection:e!==xe.Fragment});function $y(e,t,i){const r=e.getProps();return cN(r,t,i!==void 0?i:r.custom,e)}const jO=e=>Array.isArray(e);function nUe(e,t,i){e.hasValue(t)?e.getValue(t).set(i):e.addValue(t,_x(i))}function sUe(e){return jO(e)?e[e.length-1]||0:e}function aUe(e,t){const i=$y(e,t);let{transitionEnd:r={},transition:n={},...s}=i||{};s={...s,...r};for(const a in s){const o=sUe(s[a]);nUe(e,a,o)}}function oUe(e){return!!(Na(e)&&e.add)}function HO(e,t){const i=e.getValue("willChange");if(oUe(i))return i.add(t);if(!i&&Bd.WillChange){const r=new Bd.WillChange("auto");e.addValue("willChange",r),r.add(t)}}function bJ(e){return e.props[cJ]}const lUe=e=>e!==null;function uUe(e,{repeat:t,repeatType:i="loop"},r){const n=e.filter(lUe),s=t&&i!=="loop"&&t%2===1?0:n.length-1;return n[s]}const cUe={type:"spring",stiffness:500,damping:25,restSpeed:10},hUe=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),dUe={type:"keyframes",duration:.8},fUe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},pUe=(e,{keyframes:t})=>t.length>2?dUe:$x.has(e)?e.startsWith("scale")?hUe(t[1]):cUe:fUe;function mUe({when:e,delay:t,delayChildren:i,staggerChildren:r,staggerDirection:n,repeat:s,repeatType:a,repeatDelay:o,from:l,elapsed:u,...c}){return!!Object.keys(c).length}const fN=(e,t,i,r={},n,s)=>a=>{const o=tN(r,e)||{},l=o.delay||r.delay||0;let{elapsed:u=0}=r;u=u-Yc(l);const c={keyframes:Array.isArray(i)?i:[null,i],ease:"easeOut",velocity:t.getVelocity(),...o,delay:-u,onUpdate:d=>{t.set(d),o.onUpdate&&o.onUpdate(d)},onComplete:()=>{a(),o.onComplete&&o.onComplete()},name:e,motionValue:t,element:s?void 0:n};mUe(o)||Object.assign(c,pUe(e,c)),c.duration&&(c.duration=Yc(c.duration)),c.repeatDelay&&(c.repeatDelay=Yc(c.repeatDelay)),c.from!==void 0&&(c.keyframes[0]=c.from);let h=!1;if((c.type===!1||c.duration===0&&!c.repeatDelay)&&(BO(c),c.delay===0&&(h=!0)),(Bd.instantAnimations||Bd.skipAnimations)&&(h=!0,BO(c),c.delay=0),c.allowFlatten=!o.type&&!o.ease,h&&!s&&t.get()!==void 0){const d=uUe(c.keyframes,o);if(d!==void 0){en.update(()=>{c.onUpdate(d),c.onComplete()});return}}return o.isSync?new $B(c):new UFe(c)};function gUe({protectedKeys:e,needsAnimating:t},i){const r=e.hasOwnProperty(i)&&t[i]!==!0;return t[i]=!1,r}function _J(e,t,{delay:i=0,transitionOverride:r,type:n}={}){let{transition:s=e.getDefaultTransition(),transitionEnd:a,...o}=t;r&&(s=r);const l=[],u=n&&e.animationState&&e.animationState.getState()[n];for(const c in o){const h=e.getValue(c,e.latestValues[c]??null),d=o[c];if(d===void 0||u&&gUe(u,c))continue;const p={delay:i,...tN(s||{},c)},m=h.get();if(m!==void 0&&!h.isAnimating&&!Array.isArray(d)&&d===m&&!p.velocity)continue;let v=!1;if(window.MotionHandoffAnimation){const w=bJ(e);if(w){const S=window.MotionHandoffAnimation(w,c,en);S!==null&&(p.startTime=S,v=!0)}}HO(e,c),h.start(fN(c,h,d,e.shouldReduceMotion&&HZ.has(c)?{type:!1}:p,e,v));const g=h.animation;g&&l.push(g)}return a&&Promise.all(l).then(()=>{en.update(()=>{a&&aUe(e,a)})}),l}function SJ(e,t,i,r=0,n=1){const s=Array.from(e).sort((u,c)=>u.sortNodePosition(c)).indexOf(t),a=e.size,o=(a-1)*r;return typeof i=="function"?i(s,a):n===1?s*r:o-s*r}function WO(e,t,i={}){const r=$y(e,t,i.type==="exit"?e.presenceContext?.custom:void 0);let{transition:n=e.getDefaultTransition()||{}}=r||{};i.transitionOverride&&(n=i.transitionOverride);const s=r?()=>Promise.all(_J(e,r,i)):()=>Promise.resolve(),a=e.variantChildren&&e.variantChildren.size?(l=0)=>{const{delayChildren:u=0,staggerChildren:c,staggerDirection:h}=n;return vUe(e,t,l,u,c,h,i)}:()=>Promise.resolve(),{when:o}=n;if(o){const[l,u]=o==="beforeChildren"?[s,a]:[a,s];return l().then(()=>u())}else return Promise.all([s(),a(i.delay)])}function vUe(e,t,i=0,r=0,n=0,s=1,a){const o=[];for(const l of e.variantChildren)l.notify("AnimationStart",t),o.push(WO(l,t,{...a,delay:i+(typeof r=="function"?0:r)+SJ(e.variantChildren,l,r,n,s)}).then(()=>l.notify("AnimationComplete",t)));return Promise.all(o)}function yUe(e,t,i={}){e.notify("AnimationStart",t);let r;if(Array.isArray(t)){const n=t.map(s=>WO(e,s,i));r=Promise.all(n)}else if(typeof t=="string")r=WO(e,t,i);else{const n=typeof t=="function"?$y(e,t,i.custom):t;r=Promise.all(_J(e,n,i))}return r.then(()=>{e.notify("AnimationComplete",t)})}function MJ(e,t){if(!Array.isArray(t))return!1;const i=t.length;if(i!==e.length)return!1;for(let r=0;r<i;r++)if(t[r]!==e[r])return!1;return!0}const xUe=aN.length;function AJ(e){if(!e)return;if(!e.isControllingVariants){const i=e.parent?AJ(e.parent)||{}:{};return e.props.initial!==void 0&&(i.initial=e.props.initial),i}const t={};for(let i=0;i<xUe;i++){const r=aN[i],n=e.props[r];(p_(n)||n===!1)&&(t[r]=n)}return t}const wUe=[...sN].reverse(),bUe=sN.length;function _Ue(e){return t=>Promise.all(t.map(({animation:i,options:r})=>yUe(e,i,r)))}function SUe(e){let t=_Ue(e),i=aG(),r=!0;const n=l=>(u,c)=>{const h=$y(e,c,l==="exit"?e.presenceContext?.custom:void 0);if(h){const{transition:d,transitionEnd:p,...m}=h;u={...u,...m,...p}}return u};function s(l){t=l(e)}function a(l){const{props:u}=e,c=AJ(e.parent)||{},h=[],d=new Set;let p={},m=1/0;for(let g=0;g<bUe;g++){const w=wUe[g],S=i[w],_=u[w]!==void 0?u[w]:c[w],A=p_(_),C=w===l?S.isActive:null;C===!1&&(m=g);let E=_===c[w]&&_!==u[w]&&A;if(E&&r&&e.manuallyAnimateOnMount&&(E=!1),S.protectedKeys={...p},!S.isActive&&C===null||!_&&!S.prevProp||yT(_)||typeof _=="boolean")continue;const I=MUe(S.prevProp,_);let T=I||w===l&&S.isActive&&!E&&A||g>m&&A,D=!1;const L=Array.isArray(_)?_:[_];let z=L.reduce(n(w),{});C===!1&&(z={});const{prevResolvedValues:G={}}=S,V={...G,...z},j=K=>{T=!0,d.has(K)&&(D=!0,d.delete(K)),S.needsAnimating[K]=!0;const B=e.getValue(K);B&&(B.liveStyle=!1)};for(const K in V){const B=z[K],Z=G[K];if(p.hasOwnProperty(K))continue;let F=!1;jO(B)&&jO(Z)?F=!MJ(B,Z):F=B!==Z,F?B!=null?j(K):d.add(K):B!==void 0&&d.has(K)?j(K):S.protectedKeys[K]=!0}S.prevProp=_,S.prevResolvedValues=z,S.isActive&&(p={...p,...z}),r&&e.blockInitialAnimation&&(T=!1);const J=E&&I;T&&(!J||D)&&h.push(...L.map(K=>{const B={type:w};if(typeof K=="string"&&r&&!J&&e.manuallyAnimateOnMount&&e.parent){const{parent:Z}=e,F=$y(Z,K);if(Z.enteringChildren&&F){const{delayChildren:X}=F.transition||{};B.delay=SJ(Z.enteringChildren,e,X)}}return{animation:K,options:B}}))}if(d.size){const g={};if(typeof u.initial!="boolean"){const w=$y(e,Array.isArray(u.initial)?u.initial[0]:u.initial);w&&w.transition&&(g.transition=w.transition)}d.forEach(w=>{const S=e.getBaseTarget(w),_=e.getValue(w);_&&(_.liveStyle=!0),g[w]=S??null}),h.push({animation:g})}let v=!!h.length;return r&&(u.initial===!1||u.initial===u.animate)&&!e.manuallyAnimateOnMount&&(v=!1),r=!1,v?t(h):Promise.resolve()}function o(l,u){if(i[l].isActive===u)return Promise.resolve();e.variantChildren?.forEach(h=>h.animationState?.setActive(l,u)),i[l].isActive=u;const c=a(l);for(const h in i)i[h].protectedKeys={};return c}return{animateChanges:a,setActive:o,setAnimateFunction:s,getState:()=>i,reset:()=>{i=aG()}}}function MUe(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!MJ(t,e):!1}function Gm(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function aG(){return{animate:Gm(!0),whileInView:Gm(),whileHover:Gm(),whileTap:Gm(),whileDrag:Gm(),whileFocus:Gm(),exit:Gm()}}class Xp{constructor(t){this.isMounted=!1,this.node=t}update(){}}class AUe extends Xp{constructor(t){super(t),t.animationState||(t.animationState=SUe(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();yT(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:i}=this.node.prevProps||{};t!==i&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let EUe=0;class CUe extends Xp{constructor(){super(...arguments),this.id=EUe++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:i}=this.node.presenceContext,{isPresent:r}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===r)return;const n=this.node.animationState.setActive("exit",!t);i&&!t&&n.then(()=>{i(this.id)})}mount(){const{register:t,onExitComplete:i}=this.node.presenceContext||{};i&&i(this.id),t&&(this.unmount=t(this.id))}unmount(){}}const TUe={animation:{Feature:AUe},exit:{Feature:CUe}};function g_(e,t,i,r={passive:!0}){return e.addEventListener(t,i,r),()=>e.removeEventListener(t,i)}function nS(e){return{point:{x:e.pageX,y:e.pageY}}}const PUe=e=>t=>nN(t)&&e(t,nS(t));function bb(e,t,i,r){return g_(e,t,PUe(i),r)}const EJ=1e-4,DUe=1-EJ,RUe=1+EJ,CJ=.01,IUe=0-CJ,LUe=0+CJ;function uo(e){return e.max-e.min}function OUe(e,t,i){return Math.abs(e-t)<=i}function oG(e,t,i,r=.5){e.origin=r,e.originPoint=cn(t.min,t.max,e.origin),e.scale=uo(i)/uo(t),e.translate=cn(i.min,i.max,e.origin)-e.originPoint,(e.scale>=DUe&&e.scale<=RUe||isNaN(e.scale))&&(e.scale=1),(e.translate>=IUe&&e.translate<=LUe||isNaN(e.translate))&&(e.translate=0)}function _b(e,t,i,r){oG(e.x,t.x,i.x,r?r.originX:void 0),oG(e.y,t.y,i.y,r?r.originY:void 0)}function lG(e,t,i){e.min=i.min+t.min,e.max=e.min+uo(t)}function zUe(e,t,i){lG(e.x,t.x,i.x),lG(e.y,t.y,i.y)}function uG(e,t,i){e.min=t.min-i.min,e.max=e.min+uo(t)}function vC(e,t,i){uG(e.x,t.x,i.x),uG(e.y,t.y,i.y)}function Ll(e){return[e("x"),e("y")]}const TJ=({current:e})=>e?e.ownerDocument.defaultView:null,cG=(e,t)=>Math.abs(e-t);function kUe(e,t){const i=cG(e.x,t.x),r=cG(e.y,t.y);return Math.sqrt(i**2+r**2)}class PJ{constructor(t,i,{transformPagePoint:r,contextWindow:n=window,dragSnapToOrigin:s=!1,distanceThreshold:a=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const d=_R(this.lastMoveEventInfo,this.history),p=this.startEvent!==null,m=kUe(d.offset,{x:0,y:0})>=this.distanceThreshold;if(!p&&!m)return;const{point:v}=d,{timestamp:g}=da;this.history.push({...v,timestamp:g});const{onStart:w,onMove:S}=this.handlers;p||(w&&w(this.lastMoveEvent,d),this.startEvent=this.lastMoveEvent),S&&S(this.lastMoveEvent,d)},this.handlePointerMove=(d,p)=>{this.lastMoveEvent=d,this.lastMoveEventInfo=bR(p,this.transformPagePoint),en.update(this.updatePoint,!0)},this.handlePointerUp=(d,p)=>{this.end();const{onEnd:m,onSessionEnd:v,resumeAnimation:g}=this.handlers;if(this.dragSnapToOrigin&&g&&g(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const w=_R(d.type==="pointercancel"?this.lastMoveEventInfo:bR(p,this.transformPagePoint),this.history);this.startEvent&&m&&m(d,w),v&&v(d,w)},!nN(t))return;this.dragSnapToOrigin=s,this.handlers=i,this.transformPagePoint=r,this.distanceThreshold=a,this.contextWindow=n||window;const o=nS(t),l=bR(o,this.transformPagePoint),{point:u}=l,{timestamp:c}=da;this.history=[{...u,timestamp:c}];const{onSessionStart:h}=i;h&&h(t,_R(l,this.history)),this.removeListeners=tS(bb(this.contextWindow,"pointermove",this.handlePointerMove),bb(this.contextWindow,"pointerup",this.handlePointerUp),bb(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),kp(this.updatePoint)}}function bR(e,t){return t?{point:t(e.point)}:e}function hG(e,t){return{x:e.x-t.x,y:e.y-t.y}}function _R({point:e},t){return{point:e,delta:hG(e,DJ(t)),offset:hG(e,BUe(t)),velocity:NUe(t,.1)}}function BUe(e){return e[0]}function DJ(e){return e[e.length-1]}function NUe(e,t){if(e.length<2)return{x:0,y:0};let i=e.length-1,r=null;const n=DJ(e);for(;i>=0&&(r=e[i],!(n.timestamp-r.timestamp>Yc(t)));)i--;if(!r)return{x:0,y:0};const s=Hl(n.timestamp-r.timestamp);if(s===0)return{x:0,y:0};const a={x:(n.x-r.x)/s,y:(n.y-r.y)/s};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function FUe(e,{min:t,max:i},r){return t!==void 0&&e<t?e=r?cn(t,e,r.min):Math.max(e,t):i!==void 0&&e>i&&(e=r?cn(i,e,r.max):Math.min(e,i)),e}function dG(e,t,i){return{min:t!==void 0?e.min+t:void 0,max:i!==void 0?e.max+i-(e.max-e.min):void 0}}function UUe(e,{top:t,left:i,bottom:r,right:n}){return{x:dG(e.x,i,n),y:dG(e.y,t,r)}}function fG(e,t){let i=t.min-e.min,r=t.max-e.max;return t.max-t.min<e.max-e.min&&([i,r]=[r,i]),{min:i,max:r}}function VUe(e,t){return{x:fG(e.x,t.x),y:fG(e.y,t.y)}}function jUe(e,t){let i=.5;const r=uo(e),n=uo(t);return n>r?i=h_(t.min,t.max-r,e.min):r>n&&(i=h_(e.min,e.max-n,t.min)),kd(0,1,i)}function HUe(e,t){const i={};return t.min!==void 0&&(i.min=t.min-e.min),t.max!==void 0&&(i.max=t.max-e.min),i}const GO=.35;function WUe(e=GO){return e===!1?e=0:e===!0&&(e=GO),{x:pG(e,"left","right"),y:pG(e,"top","bottom")}}function pG(e,t,i){return{min:mG(e,t),max:mG(e,i)}}function mG(e,t){return typeof e=="number"?e:e[t]||0}const GUe=new WeakMap;class qUe{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=ys(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=t}start(t,{snapToCursor:i=!1,distanceThreshold:r}={}){const{presenceContext:n}=this.visualElement;if(n&&n.isPresent===!1)return;const s=h=>{const{dragSnapToOrigin:d}=this.getProps();d?this.pauseAnimation():this.stopAnimation(),i&&this.snapToCursor(nS(h).point)},a=(h,d)=>{const{drag:p,dragPropagation:m,onDragStart:v}=this.getProps();if(p&&!m&&(this.openDragLock&&this.openDragLock(),this.openDragLock=r4e(p),!this.openDragLock))return;this.latestPointerEvent=h,this.latestPanInfo=d,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Ll(w=>{let S=this.getAxisMotionValue(w).get()||0;if(Qc.test(S)){const{projection:_}=this.visualElement;if(_&&_.layout){const A=_.layout.layoutBox[w];A&&(S=uo(A)*(parseFloat(S)/100))}}this.originPoint[w]=S}),v&&en.postRender(()=>v(h,d)),HO(this.visualElement,"transform");const{animationState:g}=this.visualElement;g&&g.setActive("whileDrag",!0)},o=(h,d)=>{this.latestPointerEvent=h,this.latestPanInfo=d;const{dragPropagation:p,dragDirectionLock:m,onDirectionLock:v,onDrag:g}=this.getProps();if(!p&&!this.openDragLock)return;const{offset:w}=d;if(m&&this.currentDirection===null){this.currentDirection=XUe(w),this.currentDirection!==null&&v&&v(this.currentDirection);return}this.updateAxis("x",d.point,w),this.updateAxis("y",d.point,w),this.visualElement.render(),g&&g(h,d)},l=(h,d)=>{this.latestPointerEvent=h,this.latestPanInfo=d,this.stop(h,d),this.latestPointerEvent=null,this.latestPanInfo=null},u=()=>Ll(h=>this.getAnimationState(h)==="paused"&&this.getAxisMotionValue(h).animation?.play()),{dragSnapToOrigin:c}=this.getProps();this.panSession=new PJ(t,{onSessionStart:s,onStart:a,onMove:o,onSessionEnd:l,resumeAnimation:u},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:c,distanceThreshold:r,contextWindow:TJ(this.visualElement)})}stop(t,i){const r=t||this.latestPointerEvent,n=i||this.latestPanInfo,s=this.isDragging;if(this.cancel(),!s||!n||!r)return;const{velocity:a}=n;this.startAnimation(a);const{onDragEnd:o}=this.getProps();o&&en.postRender(()=>o(r,n))}cancel(){this.isDragging=!1;const{projection:t,animationState:i}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:r}=this.getProps();!r&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),i&&i.setActive("whileDrag",!1)}updateAxis(t,i,r){const{drag:n}=this.getProps();if(!r||!vE(t,n,this.currentDirection))return;const s=this.getAxisMotionValue(t);let a=this.originPoint[t]+r[t];this.constraints&&this.constraints[t]&&(a=FUe(a,this.constraints[t],this.elastic[t])),s.set(a)}resolveConstraints(){const{dragConstraints:t,dragElastic:i}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,n=this.constraints;t&&zy(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&r?this.constraints=UUe(r.layoutBox,t):this.constraints=!1,this.elastic=WUe(i),n!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&Ll(s=>{this.constraints!==!1&&this.getAxisMotionValue(s)&&(this.constraints[s]=HUe(r.layoutBox[s],this.constraints[s]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:i}=this.getProps();if(!t||!zy(t))return!1;const r=t.current,{projection:n}=this.visualElement;if(!n||!n.layout)return!1;const s=Y4e(r,n.root,this.visualElement.getTransformPagePoint());let a=VUe(n.layout.layoutBox,s);if(i){const o=i(G4e(a));this.hasMutatedConstraints=!!o,o&&(a=fJ(o))}return a}startAnimation(t){const{drag:i,dragMomentum:r,dragElastic:n,dragTransition:s,dragSnapToOrigin:a,onDragTransitionEnd:o}=this.getProps(),l=this.constraints||{},u=Ll(c=>{if(!vE(c,i,this.currentDirection))return;let h=l&&l[c]||{};a&&(h={min:0,max:0});const d=n?200:1e6,p=n?40:1e7,m={type:"inertia",velocity:r?t[c]:0,bounceStiffness:d,bounceDamping:p,timeConstant:750,restDelta:1,restSpeed:10,...s,...h};return this.startAxisValueAnimation(c,m)});return Promise.all(u).then(o)}startAxisValueAnimation(t,i){const r=this.getAxisMotionValue(t);return HO(this.visualElement,t),r.start(fN(t,r,0,i,this.visualElement,!1))}stopAnimation(){Ll(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Ll(t=>this.getAxisMotionValue(t).animation?.pause())}getAnimationState(t){return this.getAxisMotionValue(t).animation?.state}getAxisMotionValue(t){const i=`_drag${t.toUpperCase()}`,r=this.visualElement.getProps(),n=r[i];return n||this.visualElement.getValue(t,(r.initial?r.initial[t]:void 0)||0)}snapToCursor(t){Ll(i=>{const{drag:r}=this.getProps();if(!vE(i,r,this.currentDirection))return;const{projection:n}=this.visualElement,s=this.getAxisMotionValue(i);if(n&&n.layout){const{min:a,max:o}=n.layout.layoutBox[i];s.set(t[i]-cn(a,o,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:i}=this.getProps(),{projection:r}=this.visualElement;if(!zy(i)||!r||!this.constraints)return;this.stopAnimation();const n={x:0,y:0};Ll(a=>{const o=this.getAxisMotionValue(a);if(o&&this.constraints!==!1){const l=o.get();n[a]=jUe({min:l,max:l},this.constraints[a])}});const{transformTemplate:s}=this.visualElement.getProps();this.visualElement.current.style.transform=s?s({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),Ll(a=>{if(!vE(a,t,null))return;const o=this.getAxisMotionValue(a),{min:l,max:u}=this.constraints[a];o.set(cn(l,u,n[a]))})}addListeners(){if(!this.visualElement.current)return;GUe.set(this.visualElement,this);const t=this.visualElement.current,i=bb(t,"pointerdown",l=>{const{drag:u,dragListener:c=!0}=this.getProps();u&&c&&this.start(l)}),r=()=>{const{dragConstraints:l}=this.getProps();zy(l)&&l.current&&(this.constraints=this.resolveRefConstraints())},{projection:n}=this.visualElement,s=n.addEventListener("measure",r);n&&!n.layout&&(n.root&&n.root.updateScroll(),n.updateLayout()),en.read(r);const a=g_(window,"resize",()=>this.scalePositionWithinConstraints()),o=n.addEventListener("didUpdate",(({delta:l,hasLayoutChanged:u})=>{this.isDragging&&u&&(Ll(c=>{const h=this.getAxisMotionValue(c);h&&(this.originPoint[c]+=l[c].translate,h.set(h.get()+l[c].translate))}),this.visualElement.render())}));return()=>{a(),i(),s(),o&&o()}}getProps(){const t=this.visualElement.getProps(),{drag:i=!1,dragDirectionLock:r=!1,dragPropagation:n=!1,dragConstraints:s=!1,dragElastic:a=GO,dragMomentum:o=!0}=t;return{...t,drag:i,dragDirectionLock:r,dragPropagation:n,dragConstraints:s,dragElastic:a,dragMomentum:o}}}function vE(e,t,i){return(t===!0||t===e)&&(i===null||i===e)}function XUe(e,t=10){let i=null;return Math.abs(e.y)>t?i="y":Math.abs(e.x)>t&&(i="x"),i}class YUe extends Xp{constructor(t){super(t),this.removeGroupControls=Xl,this.removeListeners=Xl,this.controls=new qUe(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Xl}unmount(){this.removeGroupControls(),this.removeListeners()}}const gG=e=>(t,i)=>{e&&en.postRender(()=>e(t,i))};class QUe extends Xp{constructor(){super(...arguments),this.removePointerDownListener=Xl}onPointerDown(t){this.session=new PJ(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:TJ(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:i,onPan:r,onPanEnd:n}=this.node.getProps();return{onSessionStart:gG(t),onStart:gG(i),onMove:r,onEnd:(s,a)=>{delete this.session,n&&en.postRender(()=>n(s,a))}}}mount(){this.removePointerDownListener=bb(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const ZE={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function vG(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const zw={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(Ai.test(e))e=parseFloat(e);else return e;const i=vG(e,t.target.x),r=vG(e,t.target.y);return`${i}% ${r}%`}},KUe={correct:(e,{treeScale:t,projectionDelta:i})=>{const r=e,n=Bp.parse(e);if(n.length>5)return r;const s=Bp.createTransformer(e),a=typeof n[0]!="number"?1:0,o=i.x.scale*t.x,l=i.y.scale*t.y;n[0+a]/=o,n[1+a]/=l;const u=cn(o,l,.5);return typeof n[2+a]=="number"&&(n[2+a]/=u),typeof n[3+a]=="number"&&(n[3+a]/=u),s(n)}};let SR=!1;class ZUe extends xe.Component{componentDidMount(){const{visualElement:t,layoutGroup:i,switchLayoutGroup:r,layoutId:n}=this.props,{projection:s}=t;x4e(JUe),s&&(i.group&&i.group.add(s),r&&r.register&&n&&r.register(s),SR&&s.root.didUpdate(),s.addEventListener("animationComplete",()=>{this.safeToRemove()}),s.setOptions({...s.options,onExitComplete:()=>this.safeToRemove()})),ZE.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:i,visualElement:r,drag:n,isPresent:s}=this.props,{projection:a}=r;return a&&(a.isPresent=s,SR=!0,n||t.layoutDependency!==i||i===void 0||t.isPresent!==s?a.willUpdate():this.safeToRemove(),t.isPresent!==s&&(s?a.promote():a.relegate()||en.postRender(()=>{const o=a.getStack();(!o||!o.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),rN.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:i,switchLayoutGroup:r}=this.props,{projection:n}=t;SR=!0,n&&(n.scheduleCheckAfterUnmount(),i&&i.group&&i.group.remove(n),r&&r.deregister&&r.deregister(n))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function RJ(e){const[t,i]=d4e(),r=xe.useContext(uZ);return at.jsx(ZUe,{...e,layoutGroup:r,switchLayoutGroup:xe.useContext(hJ),isPresent:t,safeToRemove:i})}const JUe={borderRadius:{...zw,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:zw,borderTopRightRadius:zw,borderBottomLeftRadius:zw,borderBottomRightRadius:zw,boxShadow:KUe};function $Ue(e,t,i){const r=Na(e)?e:_x(e);return r.start(fN("",r,t,i)),r.animation}const e5e=(e,t)=>e.depth-t.depth;class t5e{constructor(){this.children=[],this.isDirty=!1}add(t){NB(this.children,t),this.isDirty=!0}remove(t){FB(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(e5e),this.isDirty=!1,this.children.forEach(t)}}function i5e(e,t){const i=Vo.now(),r=({timestamp:n})=>{const s=n-i;s>=t&&(kp(r),e(s-t))};return en.setup(r,!0),()=>kp(r)}const IJ=["TopLeft","TopRight","BottomLeft","BottomRight"],r5e=IJ.length,yG=e=>typeof e=="string"?parseFloat(e):e,xG=e=>typeof e=="number"||Ai.test(e);function n5e(e,t,i,r,n,s){n?(e.opacity=cn(0,i.opacity??1,s5e(r)),e.opacityExit=cn(t.opacity??1,0,a5e(r))):s&&(e.opacity=cn(t.opacity??1,i.opacity??1,r));for(let a=0;a<r5e;a++){const o=`border${IJ[a]}Radius`;let l=wG(t,o),u=wG(i,o);if(l===void 0&&u===void 0)continue;l||(l=0),u||(u=0),l===0||u===0||xG(l)===xG(u)?(e[o]=Math.max(cn(yG(l),yG(u),r),0),(Qc.test(u)||Qc.test(l))&&(e[o]+="%")):e[o]=u}(t.rotate||i.rotate)&&(e.rotate=cn(t.rotate||0,i.rotate||0,r))}function wG(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const s5e=LJ(0,.5,wZ),a5e=LJ(.5,.95,Xl);function LJ(e,t,i){return r=>r<e?0:r>t?1:i(h_(e,t,r))}function bG(e,t){e.min=t.min,e.max=t.max}function Du(e,t){bG(e.x,t.x),bG(e.y,t.y)}function _G(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function SG(e,t,i,r,n){return e-=t,e=gC(e,1/i,r),n!==void 0&&(e=gC(e,1/n,r)),e}function o5e(e,t=0,i=1,r=.5,n,s=e,a=e){if(Qc.test(t)&&(t=parseFloat(t),t=cn(a.min,a.max,t/100)-a.min),typeof t!="number")return;let o=cn(s.min,s.max,r);e===s&&(o-=t),e.min=SG(e.min,t,i,o,n),e.max=SG(e.max,t,i,o,n)}function MG(e,t,[i,r,n],s,a){o5e(e,t[i],t[r],t[n],t.scale,s,a)}const l5e=["x","scaleX","originX"],u5e=["y","scaleY","originY"];function AG(e,t,i,r){MG(e.x,t,l5e,i?i.x:void 0,r?r.x:void 0),MG(e.y,t,u5e,i?i.y:void 0,r?r.y:void 0)}function EG(e){return e.translate===0&&e.scale===1}function OJ(e){return EG(e.x)&&EG(e.y)}function CG(e,t){return e.min===t.min&&e.max===t.max}function c5e(e,t){return CG(e.x,t.x)&&CG(e.y,t.y)}function TG(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function zJ(e,t){return TG(e.x,t.x)&&TG(e.y,t.y)}function PG(e){return uo(e.x)/uo(e.y)}function DG(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class h5e{constructor(){this.members=[]}add(t){NB(this.members,t),t.scheduleRender()}remove(t){if(FB(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const i=this.members[this.members.length-1];i&&this.promote(i)}}relegate(t){const i=this.members.findIndex(n=>t===n);if(i===0)return!1;let r;for(let n=i;n>=0;n--){const s=this.members[n];if(s.isPresent!==!1){r=s;break}}return r?(this.promote(r),!0):!1}promote(t,i){const r=this.lead;if(t!==r&&(this.prevLead=r,this.lead=t,t.show(),r)){r.instance&&r.scheduleRender(),t.scheduleRender(),t.resumeFrom=r,i&&(t.resumeFrom.preserveOpacity=!0),r.snapshot&&(t.snapshot=r.snapshot,t.snapshot.latestValues=r.animationValues||r.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:n}=t.options;n===!1&&r.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:i,resumingFrom:r}=t;i.onExitComplete&&i.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function d5e(e,t,i){let r="";const n=e.x.translate/t.x,s=e.y.translate/t.y,a=i?.z||0;if((n||s||a)&&(r=`translate3d(${n}px, ${s}px, ${a}px) `),(t.x!==1||t.y!==1)&&(r+=`scale(${1/t.x}, ${1/t.y}) `),i){const{transformPerspective:u,rotate:c,rotateX:h,rotateY:d,skewX:p,skewY:m}=i;u&&(r=`perspective(${u}px) ${r}`),c&&(r+=`rotate(${c}deg) `),h&&(r+=`rotateX(${h}deg) `),d&&(r+=`rotateY(${d}deg) `),p&&(r+=`skewX(${p}deg) `),m&&(r+=`skewY(${m}deg) `)}const o=e.x.scale*t.x,l=e.y.scale*t.y;return(o!==1||l!==1)&&(r+=`scale(${o}, ${l})`),r||"none"}const MR=["","X","Y","Z"],f5e=1e3;let p5e=0;function AR(e,t,i,r){const{latestValues:n}=t;n[e]&&(i[e]=n[e],t.setStaticValue(e,0),r&&(r[e]=0))}function kJ(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const i=bJ(t);if(window.MotionHasOptimisedAnimation(i,"transform")){const{layout:n,layoutId:s}=e.options;window.MotionCancelOptimisedAnimation(i,"transform",en,!(n||s))}const{parent:r}=e;r&&!r.hasCheckedOptimisedAppear&&kJ(r)}function BJ({attachResizeListener:e,defaultParent:t,measureScroll:i,checkIsScrollRoot:r,resetTransform:n}){return class{constructor(a={},o=t?.()){this.id=p5e++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(v5e),this.nodes.forEach(b5e),this.nodes.forEach(_5e),this.nodes.forEach(y5e)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=o?o.root||o:this,this.path=o?[...o.path,o]:[],this.parent=o,this.depth=o?o.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new t5e)}addEventListener(a,o){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new jB),this.eventHandlers.get(a).add(o)}notifyListeners(a,...o){const l=this.eventHandlers.get(a);l&&l.notify(...o)}hasListeners(a){return this.eventHandlers.has(a)}mount(a){if(this.instance)return;this.isSVG=JZ(a)&&!u4e(a),this.instance=a;const{layoutId:o,layout:l,visualElement:u}=this.options;if(u&&!u.current&&u.mount(a),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(l||o)&&(this.isLayoutDirty=!0),e){let c,h=0;const d=()=>this.root.updateBlockedByResize=!1;en.read(()=>{h=window.innerWidth}),e(a,()=>{const p=window.innerWidth;p!==h&&(h=p,this.root.updateBlockedByResize=!0,c&&c(),c=i5e(d,250),ZE.hasAnimatedSinceResize&&(ZE.hasAnimatedSinceResize=!1,this.nodes.forEach(LG)))})}o&&this.root.registerSharedNode(o,this),this.options.animate!==!1&&u&&(o||l)&&this.addEventListener("didUpdate",({delta:c,hasLayoutChanged:h,hasRelativeLayoutChanged:d,layout:p})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const m=this.options.transition||u.getDefaultTransition()||C5e,{onLayoutAnimationStart:v,onLayoutAnimationComplete:g}=u.getProps(),w=!this.targetLayout||!zJ(this.targetLayout,p),S=!h&&d;if(this.options.layoutRoot||this.resumeFrom||S||h&&(w||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const _={...tN(m,"layout"),onPlay:v,onComplete:g};(u.shouldReduceMotion||this.options.layoutRoot)&&(_.delay=0,_.type=!1),this.startAnimation(_),this.setAnimationOrigin(c,S)}else h||LG(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=p})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),kp(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(S5e),this.animationId++)}getTransformTemplate(){const{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&kJ(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let c=0;c<this.path.length;c++){const h=this.path[c];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:o,layout:l}=this.options;if(o===void 0&&!l)return;const u=this.getTransformTemplate();this.prevTransformTemplateValue=u?u(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(RG);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(IG);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(w5e),this.nodes.forEach(m5e),this.nodes.forEach(g5e)):this.nodes.forEach(IG),this.clearAllSnapshots();const o=Vo.now();da.delta=kd(0,1e3/60,o-da.timestamp),da.timestamp=o,da.isProcessing=!0,fR.update.process(da),fR.preRender.process(da),fR.render.process(da),da.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,rN.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(x5e),this.sharedNodes.forEach(M5e)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,en.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){en.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!uo(this.snapshot.measuredBox.x)&&!uo(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const a=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=ys(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:o}=this.options;o&&o.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let o=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(o=!1),o&&this.instance){const l=r(this.instance);this.scroll={animationId:this.root.animationId,phase:a,isRoot:l,offset:i(this.instance),wasRoot:this.scroll?this.scroll.isRoot:l}}}resetTransform(){if(!n)return;const a=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,o=this.projectionDelta&&!OJ(this.projectionDelta),l=this.getTransformTemplate(),u=l?l(this.latestValues,""):void 0,c=u!==this.prevTransformTemplateValue;a&&this.instance&&(o||$m(this.latestValues)||c)&&(n(this.instance,u),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){const o=this.measurePageBox();let l=this.removeElementScroll(o);return a&&(l=this.removeTransform(l)),T5e(l),{animationId:this.root.animationId,measuredBox:o,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:a}=this.options;if(!a)return ys();const o=a.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(P5e))){const{scroll:u}=this.root;u&&(ky(o.x,u.offset.x),ky(o.y,u.offset.y))}return o}removeElementScroll(a){const o=ys();if(Du(o,a),this.scroll?.wasRoot)return o;for(let l=0;l<this.path.length;l++){const u=this.path[l],{scroll:c,options:h}=u;u!==this.root&&c&&h.layoutScroll&&(c.wasRoot&&Du(o,a),ky(o.x,c.offset.x),ky(o.y,c.offset.y))}return o}applyTransform(a,o=!1){const l=ys();Du(l,a);for(let u=0;u<this.path.length;u++){const c=this.path[u];!o&&c.options.layoutScroll&&c.scroll&&c!==c.root&&By(l,{x:-c.scroll.offset.x,y:-c.scroll.offset.y}),$m(c.latestValues)&&By(l,c.latestValues)}return $m(this.latestValues)&&By(l,this.latestValues),l}removeTransform(a){const o=ys();Du(o,a);for(let l=0;l<this.path.length;l++){const u=this.path[l];if(!u.instance||!$m(u.latestValues))continue;FO(u.latestValues)&&u.updateSnapshot();const c=ys(),h=u.measurePageBox();Du(c,h),AG(o,u.latestValues,u.snapshot?u.snapshot.layoutBox:void 0,c)}return $m(this.latestValues)&&AG(o,this.latestValues),o}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:a.crossfade!==void 0?a.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==da.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){const o=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=o.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=o.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=o.isSharedProjectionDirty);const l=!!this.resumingFrom||this!==o;if(!(a||l&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:c,layoutId:h}=this.options;if(!this.layout||!(c||h))return;this.resolvedRelativeTargetAt=da.timestamp;const d=this.getClosestProjectingParent();d&&this.linkedParentVersion!==d.layoutVersion&&!d.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(d&&d.layout?this.createRelativeTarget(d,this.layout.layoutBox,d.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=ys(),this.targetWithTransforms=ys()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),zUe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Du(this.target,this.layout.layoutBox),mJ(this.target,this.targetDelta)):Du(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,d&&!!d.resumingFrom==!!this.resumingFrom&&!d.options.layoutScroll&&d.target&&this.animationProgress!==1?this.createRelativeTarget(d,this.target,d.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||FO(this.parent.latestValues)||pJ(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(a,o,l){this.relativeParent=a,this.linkedParentVersion=a.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ys(),this.relativeTargetOrigin=ys(),vC(this.relativeTargetOrigin,o,l),Du(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){const a=this.getLead(),o=!!this.resumingFrom||this!==a;let l=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(l=!1),o&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(l=!1),this.resolvedRelativeTargetAt===da.timestamp&&(l=!1),l)return;const{layout:u,layoutId:c}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||c))return;Du(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,d=this.treeScale.y;X4e(this.layoutCorrected,this.treeScale,this.path,o),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox,a.targetWithTransforms=ys());const{target:p}=a;if(!p){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(_G(this.prevProjectionDelta.x,this.projectionDelta.x),_G(this.prevProjectionDelta.y,this.projectionDelta.y)),_b(this.projectionDelta,this.layoutCorrected,p,this.latestValues),(this.treeScale.x!==h||this.treeScale.y!==d||!DG(this.projectionDelta.x,this.prevProjectionDelta.x)||!DG(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",p))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){if(this.options.visualElement?.scheduleRender(),a){const o=this.getStack();o&&o.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Ny(),this.projectionDelta=Ny(),this.projectionDeltaWithTransform=Ny()}setAnimationOrigin(a,o=!1){const l=this.snapshot,u=l?l.latestValues:{},c={...this.latestValues},h=Ny();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!o;const d=ys(),p=l?l.source:void 0,m=this.layout?this.layout.source:void 0,v=p!==m,g=this.getStack(),w=!g||g.members.length<=1,S=!!(v&&!w&&this.options.crossfade===!0&&!this.path.some(E5e));this.animationProgress=0;let _;this.mixTargetDelta=A=>{const C=A/1e3;OG(h.x,a.x,C),OG(h.y,a.y,C),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(vC(d,this.layout.layoutBox,this.relativeParent.layout.layoutBox),A5e(this.relativeTarget,this.relativeTargetOrigin,d,C),_&&c5e(this.relativeTarget,_)&&(this.isProjectionDirty=!1),_||(_=ys()),Du(_,this.relativeTarget)),v&&(this.animationValues=c,n5e(c,u,this.latestValues,C,S,w)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=C},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(a){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(kp(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=en.update(()=>{ZE.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=_x(0)),this.currentAnimation=$Ue(this.motionValue,[0,1e3],{...a,velocity:0,isSync:!0,onUpdate:o=>{this.mixTargetDelta(o),a.onUpdate&&a.onUpdate(o)},onStop:()=>{},onComplete:()=>{a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(f5e),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const a=this.getLead();let{targetWithTransforms:o,target:l,layout:u,latestValues:c}=a;if(!(!o||!l||!u)){if(this!==a&&this.layout&&u&&NJ(this.options.animationType,this.layout.layoutBox,u.layoutBox)){l=this.target||ys();const h=uo(this.layout.layoutBox.x);l.x.min=a.target.x.min,l.x.max=l.x.min+h;const d=uo(this.layout.layoutBox.y);l.y.min=a.target.y.min,l.y.max=l.y.min+d}Du(o,l),By(o,c),_b(this.projectionDeltaWithTransform,this.layoutCorrected,o,c)}}registerSharedNode(a,o){this.sharedNodes.has(a)||this.sharedNodes.set(a,new h5e),this.sharedNodes.get(a).add(o);const u=o.options.initialPromotionConfig;o.promote({transition:u?u.transition:void 0,preserveFollowOpacity:u&&u.shouldPreserveFollowOpacity?u.shouldPreserveFollowOpacity(o):void 0})}isLead(){const a=this.getStack();return a?a.lead===this:!0}getLead(){const{layoutId:a}=this.options;return a?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:a}=this.options;return a?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:o,preserveFollowOpacity:l}={}){const u=this.getStack();u&&u.promote(this,l),a&&(this.projectionDelta=void 0,this.needsReset=!0),o&&this.setOptions({transition:o})}relegate(){const a=this.getStack();return a?a.relegate(this):!1}resetSkewAndRotation(){const{visualElement:a}=this.options;if(!a)return;let o=!1;const{latestValues:l}=a;if((l.z||l.rotate||l.rotateX||l.rotateY||l.rotateZ||l.skewX||l.skewY)&&(o=!0),!o)return;const u={};l.z&&AR("z",a,u,this.animationValues);for(let c=0;c<MR.length;c++)AR(`rotate${MR[c]}`,a,u,this.animationValues),AR(`skew${MR[c]}`,a,u,this.animationValues);a.render();for(const c in u)a.setStaticValue(c,u[c]),this.animationValues&&(this.animationValues[c]=u[c]);a.scheduleRender()}applyProjectionStyles(a,o){if(!this.instance||this.isSVG)return;if(!this.isVisible){a.visibility="hidden";return}const l=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,a.visibility="",a.opacity="",a.pointerEvents=KE(o?.pointerEvents)||"",a.transform=l?l(this.latestValues,""):"none";return}const u=this.getLead();if(!this.projectionDelta||!this.layout||!u.target){this.options.layoutId&&(a.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,a.pointerEvents=KE(o?.pointerEvents)||""),this.hasProjected&&!$m(this.latestValues)&&(a.transform=l?l({},""):"none",this.hasProjected=!1);return}a.visibility="";const c=u.animationValues||u.latestValues;this.applyTransformsToTarget();let h=d5e(this.projectionDeltaWithTransform,this.treeScale,c);l&&(h=l(c,h)),a.transform=h;const{x:d,y:p}=this.projectionDelta;a.transformOrigin=`${d.origin*100}% ${p.origin*100}% 0`,u.animationValues?a.opacity=u===this?c.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:c.opacityExit:a.opacity=u===this?c.opacity!==void 0?c.opacity:"":c.opacityExit!==void 0?c.opacityExit:0;for(const m in m_){if(c[m]===void 0)continue;const{correct:v,applyTo:g,isCSSVariable:w}=m_[m],S=h==="none"?c[m]:v(c[m],u);if(g){const _=g.length;for(let A=0;A<_;A++)a[g[A]]=S}else w?this.options.visualElement.renderState.vars[m]=S:a[m]=S}this.options.layoutId&&(a.pointerEvents=u===this?KE(o?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>a.currentAnimation?.stop()),this.root.nodes.forEach(RG),this.root.sharedNodes.clear()}}}function m5e(e){e.updateLayout()}function g5e(e){const t=e.resumeFrom?.snapshot||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){const{layoutBox:i,measuredBox:r}=e.layout,{animationType:n}=e.options,s=t.source!==e.layout.source;n==="size"?Ll(c=>{const h=s?t.measuredBox[c]:t.layoutBox[c],d=uo(h);h.min=i[c].min,h.max=h.min+d}):NJ(n,t.layoutBox,i)&&Ll(c=>{const h=s?t.measuredBox[c]:t.layoutBox[c],d=uo(i[c]);h.max=h.min+d,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[c].max=e.relativeTarget[c].min+d)});const a=Ny();_b(a,i,t.layoutBox);const o=Ny();s?_b(o,e.applyTransform(r,!0),t.measuredBox):_b(o,i,t.layoutBox);const l=!OJ(a);let u=!1;if(!e.resumeFrom){const c=e.getClosestProjectingParent();if(c&&!c.resumeFrom){const{snapshot:h,layout:d}=c;if(h&&d){const p=ys();vC(p,t.layoutBox,h.layoutBox);const m=ys();vC(m,i,d.layoutBox),zJ(p,m)||(u=!0),c.options.layoutRoot&&(e.relativeTarget=m,e.relativeTargetOrigin=p,e.relativeParent=c)}}}e.notifyListeners("didUpdate",{layout:i,snapshot:t,delta:o,layoutDelta:a,hasLayoutChanged:l,hasRelativeLayoutChanged:u})}else if(e.isLead()){const{onExitComplete:i}=e.options;i&&i()}e.options.transition=void 0}function v5e(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function y5e(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function x5e(e){e.clearSnapshot()}function RG(e){e.clearMeasurements()}function IG(e){e.isLayoutDirty=!1}function w5e(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function LG(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function b5e(e){e.resolveTargetDelta()}function _5e(e){e.calcProjection()}function S5e(e){e.resetSkewAndRotation()}function M5e(e){e.removeLeadSnapshot()}function OG(e,t,i){e.translate=cn(t.translate,0,i),e.scale=cn(t.scale,1,i),e.origin=t.origin,e.originPoint=t.originPoint}function zG(e,t,i,r){e.min=cn(t.min,i.min,r),e.max=cn(t.max,i.max,r)}function A5e(e,t,i,r){zG(e.x,t.x,i.x,r),zG(e.y,t.y,i.y,r)}function E5e(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const C5e={duration:.45,ease:[.4,0,.1,1]},kG=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),BG=kG("applewebkit/")&&!kG("chrome/")?Math.round:Xl;function NG(e){e.min=BG(e.min),e.max=BG(e.max)}function T5e(e){NG(e.x),NG(e.y)}function NJ(e,t,i){return e==="position"||e==="preserve-aspect"&&!OUe(PG(t),PG(i),.2)}function P5e(e){return e!==e.root&&e.scroll?.wasRoot}const D5e=BJ({attachResizeListener:(e,t)=>g_(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),ER={current:void 0},FJ=BJ({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!ER.current){const e=new D5e({});e.mount(window),e.setOptions({layoutScroll:!0}),ER.current=e}return ER.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),R5e={pan:{Feature:QUe},drag:{Feature:YUe,ProjectionNode:FJ,MeasureLayout:RJ}};function FG(e,t,i){const{props:r}=e;e.animationState&&r.whileHover&&e.animationState.setActive("whileHover",i==="Start");const n="onHover"+i,s=r[n];s&&en.postRender(()=>s(t,nS(t)))}class I5e extends Xp{mount(){const{current:t}=this.node;t&&(this.unmount=n4e(t,(i,r)=>(FG(this.node,r,"Start"),n=>FG(this.node,n,"End"))))}unmount(){}}class L5e extends Xp{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=tS(g_(this.node.current,"focus",()=>this.onFocus()),g_(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function UG(e,t,i){const{props:r}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&r.whileTap&&e.animationState.setActive("whileTap",i==="Start");const n="onTap"+(i==="End"?"":i),s=r[n];s&&en.postRender(()=>s(t,nS(t)))}class O5e extends Xp{mount(){const{current:t}=this.node;t&&(this.unmount=l4e(t,(i,r)=>(UG(this.node,r,"Start"),(n,{success:s})=>UG(this.node,n,s?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const qO=new WeakMap,CR=new WeakMap,z5e=e=>{const t=qO.get(e.target);t&&t(e)},k5e=e=>{e.forEach(z5e)};function B5e({root:e,...t}){const i=e||document;CR.has(i)||CR.set(i,{});const r=CR.get(i),n=JSON.stringify(t);return r[n]||(r[n]=new IntersectionObserver(k5e,{root:e,...t})),r[n]}function N5e(e,t,i){const r=B5e(t);return qO.set(e,i),r.observe(e),()=>{qO.delete(e),r.unobserve(e)}}const F5e={some:0,all:1};class U5e extends Xp{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:i,margin:r,amount:n="some",once:s}=t,a={root:i?i.current:void 0,rootMargin:r,threshold:typeof n=="number"?n:F5e[n]},o=l=>{const{isIntersecting:u}=l;if(this.isInView===u||(this.isInView=u,s&&!u&&this.hasEnteredView))return;u&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",u);const{onViewportEnter:c,onViewportLeave:h}=this.node.getProps(),d=u?c:h;d&&d(l)};return N5e(this.node.current,a,o)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:i}=this.node;["amount","margin","root"].some(V5e(t,i))&&this.startObserver()}unmount(){}}function V5e({viewport:e={}},{viewport:t={}}={}){return i=>e[i]!==t[i]}const j5e={inView:{Feature:U5e},tap:{Feature:O5e},focus:{Feature:L5e},hover:{Feature:I5e}},H5e={layout:{ProjectionNode:FJ,MeasureLayout:RJ}},W5e={...TUe,...j5e,...R5e,...H5e},Np=W4e(W5e,rUe),Jg={padding:"sm:px-16 px-6 sm:py-16 py-10",sectionHeadText:"text-white font-black md:text-[50px] sm:text-[40px] xs:text-[35px] text-[30px]",sectionSubText:"sm:text-[18px] text-[14px] text-secondary uppercase tracking-wider"},pN=e=>({hidden:{y:-50,opacity:0},show:{y:0,opacity:1,transition:{type:"spring",duration:1.25,delay:e}}}),wT=(e,t,i,r)=>({hidden:{x:e==="left"?100:e==="right"?-100:0,y:e==="up"?100:e==="down"?-100:0,opacity:0},show:{x:0,y:0,opacity:1,transition:{type:t,delay:i,duration:r,ease:"easeOut"}}}),G5e=(e,t)=>({hidden:{},show:{transition:{staggerChildren:e,delayChildren:t||0}}}),bT=(e,t)=>function(){return at.jsxs(Np.section,{variants:G5e(),initial:"hidden",whileInView:"show",viewport:{once:!0,amount:.25},className:`${Jg.padding} max-w-7xl mx-auto relative z-0`,children:[at.jsx("span",{className:"hash-span",id:t,children:""}),at.jsx(e,{})]})},q5e="/my-portofolio/assets/backend-hTXvHAtb.png",X5e="/my-portofolio/assets/creator-B3dXWOt8.png",Y5e="/my-portofolio/assets/web-08ko_qNY.png",Q5e="/my-portofolio/assets/github-BUfx7uqA.png",K5e="/my-portofolio/assets/css-DlZE0Yf0.png",Z5e="/my-portofolio/assets/figma-V-jssYD-.png",J5e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPAAAADwCAYAAAA+VemSAAAACXBIWXMAAAsTAAALEwEAmpwYAAANG0lEQVR4nO2dX6xcRR2AD9QYgpYElEDv3fltqdUSHtSISNWIiIE09vbuzMKa+GBq4p/4hoIGEx/qSxOiL1T62Adj4kN90gegSXnQxAdCIiYkloQKSKKQpo3c7szeikrXzPZCW3r39uzdc2bOzPm+5Jc0t7t7dn4z386cc+bMFAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQFs415cdVqtHrJZjzqgTToudhFEn/N/8//nXxP6eAHAJIy13Oi3HnZFxqdBy3L+HJAJEZLy/e5016og1cr60vGvh3+Pf6z+DSgQIzGhZLVgjz80q7hUia/XC6mCHUIEAgfDCWS2vzCvvJRK/zrkxQILyIjFA4vIiMUDi8iIxQOLyIjFA4vIiMUDi8iIxQOLyIjFA4vIiMUDi8iIxQOLyIjFA4vIiMUDi8iIxQOLyIjFA4vIiMbSe1OVFYmgtuciLxNBKnJE/xJaucomNeu1cr7s9dm4Baie3HpieGFoHEgMkDhIDJA4SAyQOEgMkDhIDNASn5YDV8vis70NigMg4LT++eFsFibnFBMngjPzoynujSIzE0Hhsv/vo9AkOSIzE0Fj8vrtXn6WExEgMjcMa9cPyUw2RGImhMVijfjD7fGEkRmKIjtXq4c1P+kdiJIZojLR8z+9wP9+TO0iMxBAcp+W788qLxDyKCBFwRr5TlbxIjMQQENeTb1st71QpLxIjMSQ2bJ4qsVE/m/V7+SVs/FI2l/8YqDeslmecVof9ebYPp9Uhq9VTTqtTdZahwlywPA80v+etSmJn5EVn5Aln5DPjorhm2mvHB4prR8uLd1stB61Wb8YWFYmhVlxPfSuUvPNcnd4M46Vt1zsjjzmj3oot6/RcqNfP9WVHiHxAZjit9oeWN7TEntGgs2i1PB9bViSGynB9+WYseecZTs/ZGx+NLesGueCcGMphtfq6NfLfRjTcgD3xeFBssUY9HbvM03PBcBqugjUyaIq8MSRe2Ss3Oi0vxy4zEsPMDI081DR5Y0g87KkvxS4vEkOyw+ZpMdTdfqhqndxHbkCZp/6gcU4MKfS8lzTYf9t9t90SqtZGpnNX7DIjMVwV36tZrf7T/MYqvwtdnc7IycbnRXNhq7WMTNekIK+PkVbfD50fp9UvY5e73I+b4hZT2xhp1bNavR278ZUWeHnx7tA5clqWYpcbieEKRj21LyV5fQwHt94cuipX9nV2xi43EsNlONPZY7U6F7uxzRrjwR0fDF2Vp5d3bY1d7pkl1pwTZ4vrd7/mr+bGbmSbEnhp2/Wh8+VnZsUu96YkNpwTZ4fT6oEUe953Y7W3oELn7MyenTfELvemJdb0xNmQurwTgXX386Hz5h/ji13uuSQ29MTJY42632pZjd2Y5m6MWj0S42Jf7HIjcYuxPflqDvJeEFh+Hzx/Wv0idrmRuKXYfvcr1sgoduOpTmD1dsiplH5ZnhRmYrmy+WM4nQ621703J3nfC61+GvJ2W/TyInH7GPbli06Ljd1Y6gl11hnZFiKPq4MdYrW8Er/M1Ybl6nRzmTzHmq28a6HVb0Llc70la3MIy3C6eZztyRecUcPYjSNIA9Tq4VB5pSeG2mmTvBcElv9Z3flGqKZFTwy1MTLd3WvnhtHFCiqx3yVCq59stIh7lSAxVI7fhcAZ+VdsmaKGlj8Ol+WOEM2L4TRUvORLc3cUCH6PWKtfj3Tnc3U3MXpimJvRg+qzyLu+zGVz6Iz81hn1Vy/krPlHYtg0rtf9tDNyJnav19Qoncc59x5iOA0zg7zVC4zEst4pCRuqVY0z2z9Fz1uPwEgsSFwn9sHFTzojp2MPT3MWGIkFietg2O/e3vSNqHMRGIkFiZE3bYGRWJC4Cs4ub99ltXojdo/WRoGRWJAYedMWGIkFiTfV8+qFT1gj/4zdk6UaVQqMxILEM8nbX/w48jZLYCQWJEbedHvgeR+CX2/apb+2Mdl/WKvDfuNyH06rQ1arp5xWp2KPYlyN+cgSvweP1fKP2JWSQ5TNechG69/jjLzojDzhnyDb6BHI8YHiWr+Rm9VysOm3Dy0SF8Vqf3s3x2VbchQ49DRDv52MM/JYkx9csW2edom86Qkco9GOBp1Fq+X52LK6huSjEZzbJ7f5gsdOfm5RNv+pDR/XeuOjsfPrGpKPqIyW1QLD5rQFjiLxl4sPOC3HY8vqNsiHb9tFzoz3d6+zRp6Lnexco2w9pDp8XNkrNzotL8fOs5uejz/H2Ao2GNaoI7GTnHOUrYdKG23gntjvvBE7z27jfBwpcn0g32p5J3aCc47SdVF1ow3cE0/uIzcg3269XBg5P9JyZ5EbTT5/ySVK10Utx+/sKYIuahg/31NDy/EiJ1LfLDqVKFsfNRz7ZKg1qt/FGvVq7HxvFFndWrL97qOxE9qGKFsfVR/XGvXzelvQOmXQ6lDsfDdtU/basFqOxU5oG6JsfVR93FFP7au3Ba1TBi1LsfO9Ufg2X+SC0+ql2AltQ5SujwyGi34OvWtAzqeGVi8VudCmzcdiRvn6qPa4p5d3bS0C44/pGpDz6aGGRS4gcN4CjwfFliIw/pguuqRtEZghdN4C33/Lh4rAJNADnyhygYtYeQvMObDkfRHLX1KP/4uYf5StjxqOvbfeFpTiVWiVz22ktVUZoic19yhbH5UfW6tD9bag9cqgnoyd79ZM5PAwlTJfgf2sqCIwjZ6JpTObSunxE7z9RO/oyc04ytZFHcf285OLQDR5LrTN9WEGD48T5iuwf0KoCESzn0ZSeT5O6OGB/nwFXut97qt/w7vOPbEldW19oN/Dkjr5CuyfSloZdG6qq+34z3ZG/hZbVNfWJXXeZXWwQ6yWV2InPbcom/96v4d61q9fVcfMK2vU07Fz7NaJdq5Muc6q/UQOAk/iaJVDySavSmnbtCLl+6EnrrYxlc17oIb9F7/2d87rQts29rzvB4nzFHgSWqzf++jMnp03zNou/PzqJu/MYJH3IgynMxX4YmN/0+93NDLd3X7/ow33RjLd3U3fG8m2edg8DSTOV+DLQqtTk4tRl+9OeHjtb43fndAi73QYTrdA4ITDMmy+OkiMwLFFdcg7H0hMDxxbWEfPi8ShG1rZjMcWIqWwDJvpiRE4vogOeePAcJoeGHkTB4kZQtPzJg4Scw7MsDlxkJiLWJzzJg4ScxWaC1aJw7TL99/qkHesVk+VzZ9/LZuty8X8MT0yPEh8YQE1a+RXK1p9bNb8+ff497Z9oUGLvPFos8RWq7/bXvfeeXPoP8N/VuzyIG9LaeM58eQB90H31qpyOFza9lGn1Z/alUPFw/hNoU09sV/p4tTg5g9XnUP/mf6zW5LD13iet2G0QWL/kPtqb0HVlUP/2U1+kB55Myf34fTQyEN159AaGWQrr2bY3Hiy7YkD7reT4z5WlmFzOuTYE1uj7g+VP6fVA1nlTtPzJkdmPfHJcVFcEyp3/lj+mFnIa7hglSwZ9cRPhM6d3/M3eXk1PW/y5CDxsCcPhs6bv2AWu9zIC1kMp4f97u2hq9IfM3a5NxuWYXN+pNwTn9ULHwmdr8nsrBTl1QybsyXVnriO3f6uhj9mcvIaLlhlT4o9sd8nKHSeTi/v2pqUvJqetzWk1hPH2AFvZV9nZzLyGnre1pGYxHtD58dpWWpAuZEXMhhOa3UodD06o56MXu6rhGXYDClI7B+4D11T1qhXY5cbeSGb4fTIdO4KVZ3+WI2Wl3NeSK0ntlqeCVVrVsux5uaBq82QqsRG7qu78ob9zj2xy4m8kKXE/rzUz5Cqq3pXBp2bmvoUEj0vZCGxM+rZOmZmjQfFFmvU0/HLh7yQ/4Wto+OlbddXVdH+s/xnNqBcVwQXrCDLntivILna396dt3pHg87iZJnaJpaRC1aQs8ROi7VaHj+zZ+cNs5bLz692Rh5zRr0VvRzICy0eTk+Wm7VaDo5Md/f4QHHttHL4//Ov8a9t8vKxDJuhdRK/F1qdmlyM0uqw7519TP594W+non8/5IVYNHo4nUFwzgu1g8TIC4mDxPS8kDhIzLAZEgeJOeeFxEFiLlhB4iAxV5shcZCYW0WQOEjMfV5IHCRmkgYkDhIzwwoSB4mZHgmJ03aJmdsMydNWiZEXsqFtEiMvZEdbJEZeyJbcJUZeyJ5cJUZeaA25SYy80DpykRh5obWkLjHyQutJVWLkBUhUYuQFSFRi5AVIVGLkBUhUYuQFSFRi5AVIVGLkBUhUYuQFSFRi5AVIVGLkBUhUYuQFSFRi5AVIVGLkBUhUYuQFCMxoWS1YI89VIO8L/geBCgQIzHh/9zpr1BFr5PzM4ho579/rP4OKA4jISMudTsvx0gJrOe7fQ6UBNIhzfdlhtXrEajnmjDrhtNhJGHXC/83/n39N7O8JAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFCE4v/t8177cNMPugAAAABJRU5ErkJggg==",$5e="/my-portofolio/assets/html-BlhLRGzY.png",eVe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPAAAADwCAYAAAA+VemSAAAACXBIWXMAAAsTAAALEwEAmpwYAAAOgElEQVR4nO2dCdCVZRXHz8Pnwi4groElmijuK6m4YCqJpZmJqJla40qGWjgYZZQL5p4GJZlboKKTGzoouWSAiQsuqONY42Q1LVrZYlpZnebcy51B6uO7977LeZ/7/H4z/wGGmfve5zznf577vu+ziAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAtIW+JIqIQafkgKSGd8ARMVAMjIEpBBQCZQQmCSgEceeApIZ3wBExUAyMgSkEFAJlBCYJKARx54CkhnfAETFQDIyBKQQUAmUEJgkoBHHngKSGd8ARMVAMjIEpBBQCZQQmCSgEceeApIZ3wBExUAyMgSkEFAJlBCYJKARx54CkhnfAETFQDIyBKQQUAmUEJgkoBHHngKSGd8ARMVAMjIEpBBQCZQQmCSgEceeApIZ3wBExUAyMgSkEFAJlBCYJKARx54CkhnfAETFQDIyBKQQUAmUEJgkoBHHngKSGd8ARMVAMjIEpBBQCZQQmCSgEceeApIZ3wBExUAyMgSkEFAJlBCYJKARx54CkhnfAETFQDIyBKQQUAmUEJgkoBHHngKSGd8ARMVAMjIEpBBQCZQQmCSgEceeApIZ3wBExUAyMgSkEFAJlBCYJKARx54CkhnfAETFQDIyBKQQUAmUEJgkoBHHngKSGd8ARMVAMjIEpBBQCZQQmCSgEceeApIZ3wBExUAyMgSkEFAJlBCYJKARx54CkhnfAETFQDIyBKQQUAmUEJgkoBHHngKSGd8ARMVAMjIEpBBQCZQQmCSgEceeApIZ3wBExUAyMgSkEFAJlBCYJKARx54CkhnfAETFQDIyBKQQUAmUEJgkoBHHngKSGd8ARMVAMjIEpBBQCZQQmCSgEceeApIZ3wBExUAyMgSkEFAJlBCYJKARx54CkhnfAETFQDIyBKQQUAmUEJgkoBHHngKSGd8ARMVAMjIEpBBQCZQQmCSgEceeApIZ3wBExUAyMgSkEFAJlBCYJKARx54CkhnfAETFQDIyB/Sp+yKQJHwmlft+3l4kumiN62dmixx8WdJ9dg246LOjggUH79A4aQv3v79sg6Oab1P//pAlBL50iev9s0b8tq3bBkdTwDnjsisHA7zwj+v1viB62f9C+vbN9395rBx03JuhV00TfXFrF/kgM74DHriob+A8/EZ16YtChg7N9x+40oF/QyccGfXVhlfojMbwDHruqaOB3l4teMkV00IBijLuq1loz6PRJov94rgr9kRjeAY9dVTPwy/eJ7rZtOcZdVVtvHvSp2737IzG8DRC7qmTghdeWN+p2p769g94zEwNj4AqYMyYDz7tcdI0uX/PKCtn3mP01r/5IDG8DxK4qGPjumdUxr6yQvY6aezEGxsAVMGmVDWz3vAP7+xtWunnltGRu2f2RGN4GiF2eBranvttu4W9UWY3WHxL0tYcwMAaugFmrZuDzJ2e/fhkaN6a82WaSGt4GiF1eBv79Y6L9+/qbs1ndcCEGxsAVMGxVDDztZH9TtqIh64Ra0Sm+PxLD2wCxy8PANtNqw6H+pmxWgwcGvWZ6Wf2RGN4GiF0eBr732/nd+24/MugVU0WfuUP09cX11Ub259J5oldPE917l/oroXY//9hDgr6xpMz+SAxvA8QuDwNPOjq7cfv1qd+X/ufFnq9nr4J22LK1z990WKgtPyy/PxLD2wCxy8PANuc46/vZR29qfR3xxPE9f3ZXV9Azjwv61tNe/ZEY3gaIXWUb+O/PSs0kWa553ufba+u/losefuDqf44/eZt3fySGtwFiV9kGfnF+tmvarht/far99trIOmqz//3MGWeK/vP5KvRHYngHPHaVbeAHr8t2zQP2yD6pwh54NeZejx0d9JUFVeqPxPAOeOwq28C2cCHL9T57eD6zor46SfTa85p7CKal9kdieAc8dpVt4NuvzHZN28ius/sjMbwDHrvKNnDWd8AH7omBOwpvA8Susg38yA2S+f2v7VLZuf2RGN4Bj11lG9geGGW95qxzO7k/EsM74LGrbAPb6NmrV7Zrrjso6E/v79T+SAzvgMeusg1s2nJEtmuaRgwPtd08Oq8/EsM74LHLw8C2QCDrdU22Fc+NM6r3Kkgz9UdieAc8dnkY+KaL8t2Jw1YcPXZzp/RHYngHPHZ5GNiOTFlzjfwM3JAdZLZgduz9kRjeAY9dHgY2fXI1iwqyasetgt5yaTXmNmvL/ZEY3gGPXV4GtuWARRm4ITti1FYu/XZRTP2RGN4Bj11eBjbZrKqiTWxae62gnz406LN3xtAfieEd8NjlaeDn75LayYBlmHjl1UwPfLe6T64lNbwDHrs8DWz6+uk+e0NvNzLozZeI/vsF/z54b38khnfAY5e3gc1AB+9TvoEbsu19bruiSv2RGN4Bj13eBja9uVRqI6KXiUWCfvhD/mcDY+AKGCI2VcHApt8tzr7ZXVZ1dQX94gm+q50kNbwNELuqYmDTHx+X2mQMTxOLBN1qRNAnnDa3k9TwNkDsqpKBGycW2iiYdcVSVq3RFfSCM8p/Wi2p4W2A2FU1Azf0w+9JbSKG92h81MGhthUuBsbA7maNycAmO0zshMP8R+OD9irvvlhSw9sAsavKBl55G9j9Rvua+JCxobYxPAbGwO6mjc3ADc2fJbrLNn4mPuv44tsqqeFtgNgVk4EbWjRH9KP7Zjt1sB2FEGq7ahbbH4nhbYDYFaOBG3ruzvo9sh12VpaJN14/29EuPfdHYngbIHbFbOCVZ3JdeY7o+zcux8TnnlZcmyU1vJMndnWCgRt6d7norZeJ7jSqWAMP7B/0z08U1R+J4Z00sauTDLyyFl4rtfnNRZn4m18qqj8SwztRYlenGrghO+93/93zN/Do7Yppt6SGd4LErk43cEN3Xi26wbr5GbhXr6C/frSI/kgM78SIXakY2GR7Y+21c34mnnd5Ef2RGN5JEbtSMrDpradF99gxHwN/4YT82y6p4Z0QMcvm96ZmYNNrD0ntlMOsbT94HwyMgR0T+fXF1TSwLWIouu02LTJr27f5IAbGwE0m3M8flNrWqLboPa8kthP+sibxkQeFXN/jXnhGfXRcOq9YAy+Zm73t6w3BwBi4h0Sz0wVmnCnat3c9aU6ekF/S3Ped7El83Mfz+T7L737vQoVRmxW7DtemQ2Zte78+GBgD93CavW3vsuqE+rtn5pPENtplTeJTJ4bMo+75k6W2+fqqn33OScXeX2e9D+7qwsAYuJvXHXYEZ3erbQYPDPri/OwJvOdO2e8Dp3wm28buq5v2aNva2ESMIsxra3vt87O0vX9fDIyBV9kjeda5UjNoT8lj281kOaX+hXvy2VDdFhG0c1tgG7o3cyrDpsOCvrEkfwO/ujB7+zdaDwNj4BUJZXsS79riYvWhg4P+6Mb2Rp8xOYy+pjuuau3adj6RnR7YyjXGjs7/fvjqadkNvN1IDJy8gf+0VPRzx9Tvp9qd0jfp6FA7c7eZxH17mdQ2asvDvCZbk9vsqDt9UvvnAo/fO799qexzNt8ke9uPGIeBkzbw3ItFNxyaj5HsKfVJE0LtyfJfnnzvdWxr1JfvE71iqtR+kuZlXrumPYTqqZ3LfiC6fQ4nL9i+WLYBfNa4n35MddcFS2p4m7Bd/eyB7A9RVie7jx4xPOjwDetGK+Ia9hCsmbbuvkN+17T7zgWz24u5/QyffGx+3+XB6/LPC0kNbyNmkY2YRRm4DH3l1OYMvHiO5L5/1d671I8JbWanSNss/pZLpfZuOa/r9+1dzHtqSQ1vE2aRLUfLY06ul1o5DGzi+OJ+adi9qE12ue4CqW06d89M0RtnSO1khUP3C7ruoPyvO3E864GTN7Al9mVn+5yPm1X287yVY0dsAYFtReP9vfPSw9cXU9QlNbxH0awyE4wb45+QrcoKT6tttZ+x3t87D+00qrXihYE72MCm3/xYdP0h/onZrGwktddf7bT1xCP8v38VH17pCklqeJsvz3nPZe5vnEUXndV+O+09dB6vlLw0oeD1z5Ia3sbLU3d9q9hXS3nIJkBkffpqvzi2+IB/W1rVsA3yXc6JgTvMwCZ7elr2kSHNymZR5bVO95cP5zuppGj171vOod+SGt6GK0L2sKdPQZMvsuiqafkvKLCn2d7tkh5kSx3vb3PyCAZO0MAmq/Z2Do938jY07eRi7v1spZFNyvBun3SjQQPaWzCCgRMegRv61SP5rNnNIvs5bxMiimynzaf+8intL+goStuPDPrSveX2uaSGt8nKWCN8zfTm1gjnLZvBZBuil9XWx28t/lyjZrTWmkGnnljslj4YOBEDr7xLx6c+Vl8+WMaoa69L7Jplt9PmNl9/gc+9ca9eQT9xQNBXFvj1s6SGt7HKlu2kYdvt/L89pLLKfsIeMra1Oc5FydYP28O8Mu6P1xkQ9JQjQ23JpXe7JTW8A+4l2zvZTsjbd7f63lFZRh3bCcS2uPnFw/7t6u5p9SVT6mbOa7KLvdO1bXptR5F3ctooIA9JangHvAqyA65tIf9XJ4kefmDQnbcOtamZNrJYstpobffQm2xUX8NrezmbYefPqm/u7v39W5GZbdGc+t5hpx1VPx1hhy1DbWMEa2OjmA3oV//3ZsNDbfsgWz1kC/Bvv7K+Ftu7HdqNJDW8A46IgWJgDEwhoBAoIzBJQCGIOwckNbwDjoiBYmAMTCGgECgjMElAIYg7ByQ1vAOOiIFiYAxMIaAQKCMwSUAhiDsHJDW8A46IgWJgDEwhoBAoIzBJQCGIOwckNbwDjoiBYmAMTCGgECgjMElAIYg7ByQ1vAOOiIFiYAxMIaAQKCMwSUAhiDsHJDW8A46IgWJgDEwhoBBoiiMwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEg+/BceiofdqS/+vQAAAABJRU5ErkJggg==",tVe="/my-portofolio/assets/nodejs-BctxLIqp.png",iVe="/my-portofolio/assets/reactjs-LYxsbuPE.png",rVe="/my-portofolio/assets/redux-BgiCOxBH.png",nVe="/my-portofolio/assets/tailwind-CLR6e3yI.png",sVe="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20fill='none'%20stroke-linecap='square'%20stroke-miterlimit='10'%20version='1.1'%20viewBox='0%200%20226.77%20226.77'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20transform='translate(8.964%204.2527)'%20fill-rule='evenodd'%20stroke='%23000'%20stroke-linecap='butt'%20stroke-linejoin='round'%20stroke-width='4'%3e%3cpath%20d='m63.02%20200.61-43.213-174.94%20173.23%2049.874z'/%3e%3cpath%20d='m106.39%2050.612%2021.591%2087.496-86.567-24.945z'/%3e%3cpath%20d='m84.91%20125.03-10.724-43.465%2043.008%2012.346z'/%3e%3cpath%20d='m63.458%2038.153%2010.724%2043.465-43.008-12.346z'/%3e%3cpath%20d='m149.47%2062.93%2010.724%2043.465-43.008-12.346z'/%3e%3cpath%20d='m84.915%20125.06%2010.724%2043.465-43.008-12.346z'/%3e%3c/g%3e%3c/svg%3e",aVe="/my-portofolio/assets/anteraja-CPrFIhnY.png",oVe="/my-portofolio/assets/satuhikmah-Bsc1lQV6.png",lVe="/my-portofolio/assets/jakarta-B76KAUwZ.png",uVe="/my-portofolio/assets/kominfo-DzKdicyP.png",cVe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALAAAAB3CAYAAACjWspSAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAADlNJREFUeNrsXb1647gVxThTpEqULt3QXbqh6xSmunSWHyCfpCewVbhIJatK4UL2E4j6UqWyXG5lukm7nCcw9wlGu1W6BFe8HEEUAQIgSJH0Pd/HHa8tEfw5ODj34o8xAoFAIBAIBGN8okfQAdwtPf7fOT9G/BjwI8bjhT3MNkRgQtvJ+zMStwhbfjzx45GTefvRHs8ZMaT1mAvkTfAQMcDPvHOy3xKBCW1DgP9uuMKe7w7G4AhRfUUiLzmJX/kxIAtBaIuF+I7kBIswy/0Nfg+qe5OzGOCPFwcEf5hFRGDCKQj8jMHbdqe8RT43JfIKP6cCEBuIvObniclCEJrAU87rHgNI/TC75j9NS87lo2L/zEkPnnlCCkxoQoVfBS885WQNS7IWHpI1sxVf8PtewTcSPGdEBCbURWCP7VNpYCGGVhbgbumjXx6x47Tc4843dywVRwTuDolBQV8FLzu0Jps8+OucGv+OmNER/OenhP31b5/QCvyZH7/nv/vJ8lz/5UfEz/dvtBV/EXz2hP9+YH1uUmCCgR8eFqnl3/+5HqAH3qn1v/4x3mqo+yrnkaupPGUhCBJcs31+d6743AotxzsntKc8Y1oJLhh0lhxmLN7RNxOBCY6QKuIC/y8oIhgqbkb0QQnR9+dNU3FiZ8lgVwnuliMiMMElQuHncdEHOIljgYyeQQV53FmHvcoDiZ/bmjMmAndXhbM0mlQdOYlDJOKb4fmjHIlTS9JCEhOBu4v1D3VV+9RrTuR7i0oSS0gcEIEJLrApsxGowlEFpS8i8XObAjsicHdtRMLSgTlKG+GgnFjiiQdEYEJTNsIFia+F33g7EhOBCQ5sRKaMNzUrPqi9mGIL2jADhHriuo67JXRYZNmBc7QWdZb3nLMsF6ccW0wK3H0shJ/nDZQ3PcpMkIUgVAzmQvy/Se1prjQHLQ6c93mZ90RgQhXMBFWsP82VrkUhpvFucMwyEZhQWRWz8QuDBioNE8qcE4EJVVVxJhCqbhVOcv57corcMBG4X/gi/NxEZuAxF9BNiMCEKgh+kLeJgehpGYdemAhMsELafGe2Yd1gyWJZXtODfYjA/VNfllPFulU4Yofrtc2JwAQbXOG/Ue29ccdYHFSkBlNqROD+ILMPb42XnC60chIVJgL3j8CnGpfwJPzcWEqNCNyfAC7DqabBh7myb4nABFP1PR3SlJqowjdNqDARuG+QLQsFZEoXRakTYsfGoAkVJgL3z04Ekr+sMENQ5/Sj446NmlWYCNwPlC0dBUqYEXdc87WIKbXaVZgI3A/bEOdIk4eY1hrVmqdNc9CNqTARuH8q7OfUt2gt4LrHLDw1pcJE4P4gU+FLjQxFvXnaNJAMD1qAmlb1IQL3B1kPXJAjp0joqMEMwYIdr+rzfTf9yGHlIQL3B5sDhS32xC+CMt7UrMLghWe532YzN77vZlM78OJE4H4FcnGBx/VzNmORI1Od1wSV5RyJHB/ZmHT94VWVikQE7hey4MmTzBROcrOYb2sfOQblwZKtD7MLgcxJAZGt8tO0sEnfcLgFQXygwA+zT/gZIG226xEMvxye4Dp9bAFE4oY7ghvMJiEF7h/EhUf8Qo+cqvBUCPomjV8lWJ50RXhxywS4jleTZQGIwP3zwkDOYa6ZTthhD1k2izkj8fJkq02m13EuVDAfSaxVqchC9NtOBEiSSPEZIMpqR6BUEU95vZNdZdpnTo43OCcCExQknuEeGae8Fg9JPPrhix9mUyIwoYw4IyTOdSt2st9XKqUSE4EJ+cxARuJtQ2VmywEE+JuvgoUQNywv3OScCEwoItSSpRt/JzXaBCDsDdOfTVLo0YnABBmJM0+cOD63aA1kAAsDLQCU/Q3Jm5CFILShcoDyilObsj3v4HhRZkyIwISWkFjsLQRYb1NAHRmEU0BckJuxCvsxkwITTqXCRV54Y+q7icCEU/th2PUovzDLEyfxPRGY0AUSeyyb8n+IdHPFEjUmAhPaQmSY4jQvUOOhKsAjAhPaROJsrt6NQGQliYnAhC4QWUpiInDN+O3pTwfe7g8336NTlItIePlJx4g8RzLHSOKtPoH3gztUmDrpbkzTKqplj9ZFgzlaSFjIZ8Jq6UULiojeDogMs4Q3nFRbR4QdYzDklXw8Kzu0KZuXBZwoGsMQ8/PNasxWJHkSfy75alAQHeYBL8rFGFKdgR1hi4kbYDTtaXx8gM8NjhX/LtzXwkYdscIsNcvNv9cl//4jlm1CZF+DF+4A3ct3y3Mk8Yql05B2ONN40GUYO6hhHmvDGrf25AUCvRqSSAS0Pu/8PPcGZQ748Ywv1atw+dA8/8zP1e7nD6qbTj5NxOlPZQT+qlUbq0/NHmmqRhvJu2INrUYukhcrjKulUuH9vbaexCmRD2Ytu1Bg5uBBjlkHwV/4LSvfnTJBzwk2YYM/J7YWSSCvr1luxPT2zRh0hsQCPmvUTB1cWvtgE/sAQWUbprvsiaRa2QaucybLOuD3AyHg22h64FXJ81pgcJYUlDfCa/YUJIbzX3SFwGeOCDyqMC3bRL0HLXp2E8X17FI+qpQZBE38ANLChMVsxRqdgG2kyGxc8PPdF1UELC9EcqqU3uflTPpC4LqIaGsf2kTgK8Xfrk2ieiSXzueXCvJChYk1y5qy/UqVRZh3n8Dme95eNZB9aJM/kz2fTR2dBaiKshZxoUPeHMQVfI5aXlT7XirwxqGNKHpIEes2vtV0Xtmq6tC7Zhx/YCULux5Yf7ZQuxeFXRgxs86GseT8nkRtLiUtRSCN6k16CdPeQK/Q06ZLIOngSw3qq2qpqmzsDTvN3xq2MJ0h8ECRnoklD/RKm8By+7DB83gG9zFXeMNHw/N4kshelygjTriZi+5hzfhibXtSsB38WhPJPUNHiW9hTVpvIRLFQzOxESOJ0iVGlSqdxbp15Ms9RVahqHLIrnHp+D1dyiqoA4JFHYk5jAlc/NCOt1GyzUaMFWoSGz7QjbQZ1K1Q6iU9Y8MXP8FOjroDRhfq+M2iQndagTMSJ9aqp7YPgF8Nr+jFQYXypDakuFV4KTkfDJR5xg6EKv53wNT55qqILZS/4wSuno2wsQ8i+fMVauPARvgmTSx2CsQa9/lesWNA1TL86oADCeswzgybrUQzeChTvasSokQWSrmpGE1/tWhiVblU0RPDkMl3ySDzKqgcKHZqgLsDBU4E1YutbESqzoHLaLqkSR9oLprhmQY5GEANNYkE54fBMqYDZgLL5t8F/L4R2IWNGBVWDP1BOr7El1e1EbLzRiUKlpE4NiAkjL9dVfXHDWDQTQLrb7JhEzxdaVSE2PKhRlY2Qt5trkVKIDE/YJDMzKBZnzDDQewEfQXWq3mmOdhUlUel9sF+ceUXafOtrpS+YYWQERk6TWBkmW7nyW5IJvpjn+hYv4V4q2gjqtoHwBcLSwNQ9e1fGtxvGYm3OLHx3KACZP64bSSOukpgE+9jYiOuHDwkT9EibJUVqmYFzkf3/Bga+GObGREB++A4qxx9qoOnSw378OKYPCob4RXYGo/JB/C4SFNF6I91U27PZAyay0KU2wi1Am4NRnlVvRbZNQQWLYsNkUN2uKGftIXJdXyoKvIfq14XjnQzsYy9JPCbVFH2OdgrQ7LZNZtqGzE28L+uK1bmj2FNg7Dko1V7D91YMgcdJW0j8NbiZV9Z2Ie6KpRfEFgGkpahtk4CnNITa1bSuGYCmw5i6gSBL41uqDx4srEPVR6eno1IU2teE+pbgEWJF/6h2grhGJRYAB1cqvz7R7EQKjWVjY8tezj2A1XSQUGxRvPciP+VkMOkksSGvt6FJduwDsAlgTc6iuKEJHo9hWuNFzZuKLCsSxxM/HJRAKdagPDlYxE4tRGRI8KXYVDh/INdBSgfk1wrSpr+xKC1CiqMcrup6f10UoFNau2m9r141TbCVzS9TSnPRNcy4IAhlY2YW1SgW4V9CB3P6WucwLbR7cYx0atCZiM8iX1ITOyD7UB17G2bGz6fpxIVXjkqf1sSYHaCwHbD6NSqZ0p0FykcWdM7llTStSF5s4Hqt7pDI/F7ryr7gJ0e+aAvZOrZExOcwuRpKO+r4h0/dWmQ++cazrkuUfBI0z6oPuNr+W3I5d4tE3acKpO95NDgPufCuSDLAnPg4JrehGsTlx8IsOJ4JedVrZE2LSH/LmWJC2a/5QivUz50e99XePewrtqrYTZmKLQKy5yAfcNrhpWHIhx6Cmm/WTYb25TAuuq6rNk+mLQQcD06M4S1F0FRLPMU4GG7ttijKr2GL/FR434mrHzZ16J3e+3gvdgGlAlalyVeyxorJJxvy+87ZvtNX7QXuC7KNOjYiKRF0a1uf/7a8GW77qUKdfaXwM+ENTyn6SkDN+xmj7Dl/UVY7yJBIt8Wtcp1bfa9kb54FxvCuPHBeVsTGTzsWBhhVvV+4KVcY/eybvlTpje6zQTZNCePtQtZXHVTJDJ1EXjtQOXcIG01yki2sFQNUM1zJNPG4sVAueeGvXJiUHeO53AlCmA73ltI5Ce0DaFuEDesSBoInoYVMwux4joSC7J40tbCQH0VZAqFVdd9VjzGAO7pFwyWKlsQbPIhsLnHIAia2i+Ke33DaxgzdRf0BLMaISvePWnG6pvwKc4rDFEYEszOJPyaDiYIfIyNDu+W/1P89fwEtubkwN67JSvP+S8qZiZqxdkHIO9EaR0+IHmzjIbGTBHT1T0bx6eekxeauXdJcwcB5QUjiBvW3BZkJsI2X/tZj8kLTaOsx2kX+RN19166YCZ13Hby9kOB00VJ0gmYqeL6GKSorMOwauDWc0UeYdAUE4FPG6AVYdqFTcMJFMQV2QYib8/w+YPcZ4zkjemVE4HbBkh0jxTEfSLV7S/6kUbbB2+BQNz4o+Z4CQRCR/B/AQYAVK1c2ILBw1kAAAAASUVORK5CYII=",hVe="/my-portofolio/assets/aws-DYVkrVN6.png",dVe="/my-portofolio/assets/postgree-BrsT7sQy.png",fVe="/my-portofolio/assets/java-U9_Pqr8n.png",pVe="/my-portofolio/assets/angular-CvhGd5ym.png",mVe="/my-portofolio/assets/satuhikmah-web-D-6UqzbX.png",gVe="/my-portofolio/assets/anteraja-web-HM5I47Hb.png",vVe="/my-portofolio/assets/movie-web--x2jzRsq.png",yVe=[{title:"Frontend Developer",icon:Y5e},{title:"Backend Developer",icon:q5e},{title:"Canva",icon:X5e}],xVe=[{name:"HTML 5",icon:$5e},{name:"CSS 3",icon:K5e},{name:"JavaScript",icon:eVe},{name:"Java",icon:fVe},{name:"React JS",icon:iVe},{name:"Redux Toolkit",icon:rVe},{name:"Angular",icon:pVe},{name:"Tailwind CSS",icon:nVe},{name:"Node JS",icon:tVe},{name:"MySQL",icon:cVe},{name:"AWS",icon:hVe},{name:"Postgree",icon:dVe},{name:"Three JS",icon:sVe},{name:"git",icon:J5e},{name:"figma",icon:Z5e}],wVe=[{title:"Software Development",company_name:"AnterAja",icon:aVe,iconBg:"#383E56",date:"Jul 2025 - Present",points:["Implemented website design according to provided UI/UX specifications, ensuring responsive and user-friendly interfaces.","Developed and maintained backend unit tests in Spring Boot using JUnit and Mockito to ensure code reliability and improve overall system quality."]},{title:"Web Developer",company_name:"SatuHikmah",icon:oVe,iconBg:"#E6DEDD",date:"Sep 2025 - Present",points:["Responsible for maintaining and redesigning the organizations website to improve its functionality, user experience, and visual consistency."]},{title:"Web Developer",company_name:"Kominfo",icon:uVe,iconBg:"#383E56",date:"Jan 2023 - Feb 2023",points:["Developed and enhanced a website by adding features using the CodeIgniter framework included designing, coding, and integrating new functionalities while optimizing for performance and user experience. Collaborated with the team to troubleshoot, test, and refine features. Gained hands-on experience in PHP-based web development and strengthened problem-solving and coding skills ."]},{title:"Internship",company_name:"Jakarta City Government",icon:lVe,iconBg:"#E6DEDD",date:"Jan 2019 - Mar 2019",points:["Assisting the City Government in monitoring spatial planning and land utilization using Google Maps, along with generating reports."]}],bVe=[{name:"SatuHikmah",description:"Developed and deployed a highly responsive community platform (satuhikmah.id) designed to promote self-development and career programs for Muslim youth. The project involved translating a complete, pre-existing design from Figma intofunctional code, ensuring pixel-perfect accuracy and consistency. This platform features clear, user-friendly navigation forflagship spiritual programs (e.g., Kembara Hikmah) and digital products.",tags:[{name:"react",color:"blue-text-gradient"},{name:"tailwind",color:"pink-text-gradient"}],image:mVe,source_code_link:"https://github.com/"},{name:"Real-Time Movie & TV Dashboard",description:"Developed a Real-Time Movie & TV Dashboard using React.js for the frontend, powered by Appwrite as the backend service, and integrating the TMDB API for data fetching. The platform features dynamic, real-time trending views and arobust universal search function that allows users to explore movies and TV shows instantly. Implemented RESTful APIconsumption and utilized Appwrite for seamless user management (Authentication/Database) and data persistence.",tags:[{name:"react",color:"blue-text-gradient"},{name:"restapi",color:"green-text-gradient"},{name:"tailwind",color:"pink-text-gradient"}],image:vVe,source_code_link:"https://github.com/"},{name:"AnterAja Website",description:"Contributed as a Frontend Developer to the main Anteraja corporate website, focusing on the implementation of several new content pages into the production environment. This project involved accurately translating visual designsprovided in Figma into fully functional Angular components, utilizing the Bootstrap framework for styling and ensuring a responsiveand consistent user experience across all devices. This contribution enriched the user journey by supporting thedisplay of new corporate information and services.",tags:[{name:"angular",color:"blue-text-gradient"},{name:"bootstrap",color:"green-text-gradient"},{name:"css",color:"pink-text-gradient"}],image:gVe,source_code_link:"https://github.com/"}],VG=(e,t,i,r)=>{e.style.transition=`${t} ${i}ms ${r}`},ld=(e,t,i)=>Math.min(Math.max(e,t),i);class _Ve{constructor(t,i){this.glareAngle=0,this.glareOpacity=0,this.calculateGlareSize=a=>{const{width:o,height:l}=a,u=Math.sqrt(o**2+l**2);return{width:u,height:u}},this.setSize=a=>{const o=this.calculateGlareSize(a);this.glareEl.style.width=`${o.width}px`,this.glareEl.style.height=`${o.height}px`},this.update=(a,o,l,u)=>{this.updateAngle(a,o.glareReverse),this.updateOpacity(a,o,l,u)},this.updateAngle=(a,o)=>{const{xPercentage:l,yPercentage:u}=a,c=180/Math.PI,h=l?Math.atan2(u,-l)*c:0;this.glareAngle=h-(o?180:0)},this.updateOpacity=(a,o,l,u)=>{const{xPercentage:c,yPercentage:h}=a,{glarePosition:d,glareReverse:p,glareMaxOpacity:m}=o,v=l?-1:1,g=u?-1:1,w=p?-1:1;let S=0;switch(d){case"top":S=-c*v*w;break;case"right":S=h*g*w;break;case"bottom":case void 0:S=c*v*w;break;case"left":S=-h*g*w;break;case"all":S=Math.hypot(c,h)}const _=ld(S,0,100);this.glareOpacity=_*m/100},this.render=a=>{const{glareColor:o}=a;this.glareEl.style.transform=`rotate(${this.glareAngle}deg) translate(-50%, -50%)`,this.glareEl.style.opacity=this.glareOpacity.toString(),this.glareEl.style.background=`linear-gradient(0deg, rgba(255,255,255,0) 0%, ${o} 100%)`},this.glareWrapperEl=document.createElement("div"),this.glareEl=document.createElement("div"),this.glareWrapperEl.appendChild(this.glareEl),this.glareWrapperEl.className="glare-wrapper",this.glareEl.className="glare";const r={position:"absolute",top:"0",left:"0",width:"100%",height:"100%",overflow:"hidden",borderRadius:i,WebkitMaskImage:"-webkit-radial-gradient(white, black)",pointerEvents:"none"},n=this.calculateGlareSize(t),s={position:"absolute",top:"50%",left:"50%",transformOrigin:"0% 0%",pointerEvents:"none",width:`${n.width}px`,height:`${n.height}px`};Object.assign(this.glareWrapperEl.style,r),Object.assign(this.glareEl.style,s)}}class SVe{constructor(){this.tiltAngleX=0,this.tiltAngleY=0,this.tiltAngleXPercentage=0,this.tiltAngleYPercentage=0,this.update=(t,i)=>{this.updateTilt(t,i),this.updateTiltManualInput(t,i),this.updateTiltReverse(i),this.updateTiltLimits(i)},this.updateTilt=(t,i)=>{const{xPercentage:r,yPercentage:n}=t,{tiltMaxAngleX:s,tiltMaxAngleY:a}=i;this.tiltAngleX=r*s/100,this.tiltAngleY=n*a/100*-1},this.updateTiltManualInput=(t,i)=>{const{tiltAngleXManual:r,tiltAngleYManual:n,tiltMaxAngleX:s,tiltMaxAngleY:a}=i;(r!==null||n!==null)&&(this.tiltAngleX=r!==null?r:0,this.tiltAngleY=n!==null?n:0,t.xPercentage=100*this.tiltAngleX/s,t.yPercentage=100*this.tiltAngleY/a)},this.updateTiltReverse=t=>{const i=t.tiltReverse?-1:1;this.tiltAngleX=i*this.tiltAngleX,this.tiltAngleY=i*this.tiltAngleY},this.updateTiltLimits=t=>{const{tiltAxis:i}=t;this.tiltAngleX=ld(this.tiltAngleX,-90,90),this.tiltAngleY=ld(this.tiltAngleY,-90,90),i&&(this.tiltAngleX=i==="x"?this.tiltAngleX:0,this.tiltAngleY=i==="y"?this.tiltAngleY:0)},this.updateTiltAnglesPercentage=t=>{const{tiltMaxAngleX:i,tiltMaxAngleY:r}=t;this.tiltAngleXPercentage=this.tiltAngleX/i*100,this.tiltAngleYPercentage=this.tiltAngleY/r*100},this.render=t=>{t.style.transform+=`rotateX(${this.tiltAngleX}deg) rotateY(${this.tiltAngleY}deg) `}}}const MVe={scale:1,perspective:1e3,flipVertically:!1,flipHorizontally:!1,reset:!0,transitionEasing:"cubic-bezier(.03,.98,.52,.99)",transitionSpeed:400,trackOnWindow:!1,gyroscope:!1,tiltEnable:!0,tiltReverse:!1,tiltAngleXInitial:0,tiltAngleYInitial:0,tiltMaxAngleX:20,tiltMaxAngleY:20,tiltAxis:void 0,tiltAngleXManual:null,tiltAngleYManual:null,glareEnable:!1,glareMaxOpacity:.7,glareColor:"#ffffff",glarePosition:"bottom",glareReverse:!1,glareBorderRadius:"0"};class mN extends xe.PureComponent{constructor(){super(...arguments),this.wrapperEl={node:null,size:{width:0,height:0,left:0,top:0},clientPosition:{x:null,y:null,xPercentage:0,yPercentage:0},updateAnimationId:null,scale:1},this.tilt=null,this.glare=null,this.addDeviceOrientationEventListener=async()=>{if(!window.DeviceOrientationEvent)return;const t=DeviceOrientationEvent.requestPermission;typeof t=="function"?await t()==="granted"&&window.addEventListener("deviceorientation",this.onMove):window.addEventListener("deviceorientation",this.onMove)},this.setSize=()=>{this.setWrapperElSize(),this.glare&&this.glare.setSize(this.wrapperEl.size)},this.mainLoop=t=>{this.wrapperEl.updateAnimationId!==null&&cancelAnimationFrame(this.wrapperEl.updateAnimationId),this.processInput(t),this.update(t.type),this.wrapperEl.updateAnimationId=requestAnimationFrame(this.renderFrame)},this.onEnter=t=>{const{onEnter:i}=this.props;this.setSize(),this.wrapperEl.node.style.willChange="transform",this.setTransitions(),i&&i({event:t})},this.onMove=t=>{this.mainLoop(t),this.emitOnMove(t)},this.onLeave=t=>{const{onLeave:i}=this.props;if(this.setTransitions(),i&&i({event:t}),this.props.reset){const r=new CustomEvent("autoreset");this.onMove(r)}},this.processInput=t=>{const{scale:i}=this.props;switch(t.type){case"mousemove":this.wrapperEl.clientPosition.x=t.pageX,this.wrapperEl.clientPosition.y=t.pageY,this.wrapperEl.scale=i;break;case"touchmove":this.wrapperEl.clientPosition.x=t.touches[0].pageX,this.wrapperEl.clientPosition.y=t.touches[0].pageY,this.wrapperEl.scale=i;break;case"deviceorientation":this.processInputDeviceOrientation(t),this.wrapperEl.scale=i;break;case"autoreset":{const{tiltAngleXInitial:r,tiltAngleYInitial:n,tiltMaxAngleX:s,tiltMaxAngleY:a}=this.props,o=n/a*100;this.wrapperEl.clientPosition.xPercentage=ld(r/s*100,-100,100),this.wrapperEl.clientPosition.yPercentage=ld(o,-100,100),this.wrapperEl.scale=1;break}}},this.processInputDeviceOrientation=t=>{if(!t.gamma||!t.beta||!this.props.gyroscope)return;const{tiltMaxAngleX:i,tiltMaxAngleY:r}=this.props,n=t.gamma;this.wrapperEl.clientPosition.xPercentage=t.beta/i*100,this.wrapperEl.clientPosition.yPercentage=n/r*100,this.wrapperEl.clientPosition.xPercentage=ld(this.wrapperEl.clientPosition.xPercentage,-100,100),this.wrapperEl.clientPosition.yPercentage=ld(this.wrapperEl.clientPosition.yPercentage,-100,100)},this.update=t=>{const{tiltEnable:i,flipVertically:r,flipHorizontally:n}=this.props;t!=="autoreset"&&t!=="deviceorientation"&&t!=="propChange"&&this.updateClientInput(),i&&this.tilt.update(this.wrapperEl.clientPosition,this.props),this.updateFlip(),this.tilt.updateTiltAnglesPercentage(this.props),this.glare&&this.glare.update(this.wrapperEl.clientPosition,this.props,r,n)},this.updateClientInput=()=>{const{trackOnWindow:t}=this.props;let i,r;if(t){const{x:n,y:s}=this.wrapperEl.clientPosition;i=s/window.innerHeight*200-100,r=n/window.innerWidth*200-100}else{const{size:{width:n,height:s,left:a,top:o},clientPosition:{x:l,y:u}}=this.wrapperEl;i=(u-o)/s*200-100,r=(l-a)/n*200-100}this.wrapperEl.clientPosition.xPercentage=ld(i,-100,100),this.wrapperEl.clientPosition.yPercentage=ld(r,-100,100)},this.updateFlip=()=>{const{flipVertically:t,flipHorizontally:i}=this.props;t&&(this.tilt.tiltAngleX+=180,this.tilt.tiltAngleY*=-1),i&&(this.tilt.tiltAngleY+=180)},this.renderFrame=()=>{this.resetWrapperElTransform(),this.renderPerspective(),this.tilt.render(this.wrapperEl.node),this.renderScale(),this.glare&&this.glare.render(this.props)}}componentDidMount(){if(this.tilt=new SVe,this.initGlare(),this.setSize(),this.addEventListeners(),typeof CustomEvent>"u")return;const t=new CustomEvent("autoreset");this.mainLoop(t);const i=new CustomEvent("initial");this.emitOnMove(i)}componentWillUnmount(){this.wrapperEl.updateAnimationId!==null&&cancelAnimationFrame(this.wrapperEl.updateAnimationId),this.removeEventListeners()}componentDidUpdate(){const t=new CustomEvent("propChange");this.mainLoop(t),this.emitOnMove(t)}addEventListeners(){const{trackOnWindow:t,gyroscope:i}=this.props;window.addEventListener("resize",this.setSize),t&&(window.addEventListener("mouseenter",this.onEnter),window.addEventListener("mousemove",this.onMove),window.addEventListener("mouseout",this.onLeave),window.addEventListener("touchstart",this.onEnter),window.addEventListener("touchmove",this.onMove),window.addEventListener("touchend",this.onLeave)),i&&this.addDeviceOrientationEventListener()}removeEventListeners(){const{trackOnWindow:t,gyroscope:i}=this.props;window.removeEventListener("resize",this.setSize),t&&(window.removeEventListener("mouseenter",this.onEnter),window.removeEventListener("mousemove",this.onMove),window.removeEventListener("mouseout",this.onLeave),window.removeEventListener("touchstart",this.onEnter),window.removeEventListener("touchmove",this.onMove),window.removeEventListener("touchend",this.onLeave)),i&&window.DeviceOrientationEvent&&window.removeEventListener("deviceorientation",this.onMove)}setWrapperElSize(){const t=this.wrapperEl.node.getBoundingClientRect();this.wrapperEl.size.width=this.wrapperEl.node.offsetWidth,this.wrapperEl.size.height=this.wrapperEl.node.offsetHeight,this.wrapperEl.size.left=t.left+window.scrollX,this.wrapperEl.size.top=t.top+window.scrollY}initGlare(){const{glareEnable:t,glareBorderRadius:i}=this.props;t&&(this.glare=new _Ve(this.wrapperEl.size,i),this.wrapperEl.node.appendChild(this.glare.glareWrapperEl))}emitOnMove(t){const{onMove:i}=this.props;if(!i)return;let r=0,n=0;this.glare&&(r=this.glare.glareAngle,n=this.glare.glareOpacity),i({tiltAngleX:this.tilt.tiltAngleX,tiltAngleY:this.tilt.tiltAngleY,tiltAngleXPercentage:this.tilt.tiltAngleXPercentage,tiltAngleYPercentage:this.tilt.tiltAngleYPercentage,glareAngle:r,glareOpacity:n,event:t})}resetWrapperElTransform(){this.wrapperEl.node.style.transform=""}renderPerspective(){const{perspective:t}=this.props;this.wrapperEl.node.style.transform+=`perspective(${t}px) `}renderScale(){const{scale:t}=this.wrapperEl;this.wrapperEl.node.style.transform+=`scale3d(${t},${t},${t})`}setTransitions(){const{transitionSpeed:t,transitionEasing:i}=this.props;VG(this.wrapperEl.node,"all",t,i),this.glare&&VG(this.glare.glareEl,"opacity",t,i)}render(){const{children:t,className:i,style:r}=this.props;return at.jsx("div",{ref:n=>{this.wrapperEl.node=n},onMouseEnter:this.onEnter,onMouseMove:this.onMove,onMouseLeave:this.onLeave,onTouchStart:this.onEnter,onTouchMove:this.onMove,onTouchEnd:this.onLeave,className:i,style:r,children:t})}}mN.defaultProps=MVe;const AVe=({index:e,title:t,icon:i})=>at.jsx(mN,{className:"xs:w-[250px] w-full",children:at.jsx(Np.div,{variants:wT("right","spring",.5,e),className:"w-full green-pink-gradient p-[1px] rounded-[20px] shadow-card",children:at.jsxs("div",{options:{max:45,scale:1,speed:450},className:`bg-tertiary rounded-[20px] py-5 px-12 min-h-[280px] flex 
          justify-evenly items-center flex-col`,children:[at.jsx("img",{src:i,alt:t,className:"w-16 h-16 object-contain"}),at.jsx("h3",{className:"text-white text-[20px] font-bold text-center",children:t})]})})}),EVe=()=>at.jsxs(at.Fragment,{children:[at.jsxs(Np.div,{variants:pN(),className:"mt-20",children:[at.jsx("p",{className:Jg.sectionSubText,children:"Introduction"}),at.jsx("h2",{className:Jg.sectionHeadText,children:"Overview"})]}),at.jsx(Np.p,{variants:wT("","",.1,1),className:"mt-4 text-secondary text-[17px] max-w-3xl leading-[30px]",children:"I am a web developer with strong skills in full-stack development, specializing in React for building interactive frontends and Node.js/Spring for scalable backend systems. My experienceincluding intensive training through the Dicoding Full-Stack Bootcamphas equipped me to deliver clean, efficient, and reliable solutions. I am committed to continuous growth and ready to contribute effectively to modern web projects"}),at.jsx("div",{className:"mt-20 flex flex-wrap gap-10 justify-center",children:yVe.map((e,t)=>at.jsx(AVe,{index:t,...e},e.title))})]}),CVe=bT(EVe,"about"),TVe=()=>at.jsx("div",{className:"flex flex-row flex-wrap justify-center gap-10",children:xVe.map(e=>at.jsx("div",{className:"w-28 h-28",children:at.jsx(ehe,{icon:e.icon})},e.name))}),PVe=bT(TVe,"");var kw={},TR={exports:{}};var jG;function UJ(){return jG||(jG=1,(function(e){(function(){var t={}.hasOwnProperty;function i(){for(var s="",a=0;a<arguments.length;a++){var o=arguments[a];o&&(s=n(s,r(o)))}return s}function r(s){if(typeof s=="string"||typeof s=="number")return s;if(typeof s!="object")return"";if(Array.isArray(s))return i.apply(null,s);if(s.toString!==Object.prototype.toString&&!s.toString.toString().includes("[native code]"))return s.toString();var a="";for(var o in s)t.call(s,o)&&s[o]&&(a=n(a,o));return a}function n(s,a){return a?s?s+" "+a:s+a:s}e.exports?(i.default=i,e.exports=i):window.classNames=i})()})(TR)),TR.exports}var HG;function DVe(){if(HG)return kw;HG=1,kw.__esModule=!0,kw.default=void 0;var e=r(Mx()),t=r(j7()),i=r(UJ());function r(a){return a&&a.__esModule?a:{default:a}}const n=({animate:a=!0,className:o="",layout:l="2-columns",lineColor:u="#FFF",children:c})=>(typeof window=="object"&&document.documentElement.style.setProperty("--line-color",u),e.default.createElement("div",{className:(0,i.default)(o,"vertical-timeline",{"vertical-timeline--animate":a,"vertical-timeline--two-columns":l==="2-columns","vertical-timeline--one-column-left":l==="1-column"||l==="1-column-left","vertical-timeline--one-column-right":l==="1-column-right"})},c));n.propTypes={children:t.default.oneOfType([t.default.arrayOf(t.default.node),t.default.node]).isRequired,className:t.default.string,animate:t.default.bool,layout:t.default.oneOf(["1-column-left","1-column","2-columns","1-column-right"]),lineColor:t.default.string};var s=n;return kw.default=s,kw}var Bw={};function XO(){return XO=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},XO.apply(this,arguments)}function RVe(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,YO(e,t)}function YO(e,t){return YO=Object.setPrototypeOf||function(r,n){return r.__proto__=n,r},YO(e,t)}function IVe(e,t){if(e==null)return{};var i={},r=Object.keys(e),n,s;for(s=0;s<r.length;s++)n=r[s],!(t.indexOf(n)>=0)&&(i[n]=e[n]);return i}var QO=new Map,yE=new WeakMap,WG=0,VJ=void 0;function LVe(e){VJ=e}function OVe(e){return e?(yE.has(e)||(WG+=1,yE.set(e,WG.toString())),yE.get(e)):"0"}function zVe(e){return Object.keys(e).sort().filter(function(t){return e[t]!==void 0}).map(function(t){return t+"_"+(t==="root"?OVe(e.root):e[t])}).toString()}function kVe(e){var t=zVe(e),i=QO.get(t);if(!i){var r=new Map,n,s=new IntersectionObserver(function(a){a.forEach(function(o){var l,u=o.isIntersecting&&n.some(function(c){return o.intersectionRatio>=c});e.trackVisibility&&typeof o.isVisible>"u"&&(o.isVisible=u),(l=r.get(o.target))==null||l.forEach(function(c){c(u,o)})})},e);n=s.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),i={id:t,observer:s,elements:r},QO.set(t,i)}return i}function gN(e,t,i,r){if(i===void 0&&(i={}),r===void 0&&(r=VJ),typeof window.IntersectionObserver>"u"&&r!==void 0){var n=e.getBoundingClientRect();return t(r,{isIntersecting:r,target:e,intersectionRatio:typeof i.threshold=="number"?i.threshold:0,time:0,boundingClientRect:n,intersectionRect:n,rootBounds:n}),function(){}}var s=kVe(i),a=s.id,o=s.observer,l=s.elements,u=l.get(e)||[];return l.has(e)||l.set(e,u),u.push(t),o.observe(e),function(){u.splice(u.indexOf(t),1),u.length===0&&(l.delete(e),o.unobserve(e)),l.size===0&&(o.disconnect(),QO.delete(a))}}var BVe=["children","as","triggerOnce","threshold","root","rootMargin","onChange","skip","trackVisibility","delay","initialInView","fallbackInView"];function GG(e){return typeof e.children!="function"}var yC=(function(e){RVe(t,e);function t(r){var n;return n=e.call(this,r)||this,n.node=null,n._unobserveCb=null,n.handleNode=function(s){n.node&&(n.unobserve(),!s&&!n.props.triggerOnce&&!n.props.skip&&n.setState({inView:!!n.props.initialInView,entry:void 0})),n.node=s||null,n.observeNode()},n.handleChange=function(s,a){s&&n.props.triggerOnce&&n.unobserve(),GG(n.props)||n.setState({inView:s,entry:a}),n.props.onChange&&n.props.onChange(s,a)},n.state={inView:!!r.initialInView,entry:void 0},n}var i=t.prototype;return i.componentDidUpdate=function(n){(n.rootMargin!==this.props.rootMargin||n.root!==this.props.root||n.threshold!==this.props.threshold||n.skip!==this.props.skip||n.trackVisibility!==this.props.trackVisibility||n.delay!==this.props.delay)&&(this.unobserve(),this.observeNode())},i.componentWillUnmount=function(){this.unobserve(),this.node=null},i.observeNode=function(){if(!(!this.node||this.props.skip)){var n=this.props,s=n.threshold,a=n.root,o=n.rootMargin,l=n.trackVisibility,u=n.delay,c=n.fallbackInView;this._unobserveCb=gN(this.node,this.handleChange,{threshold:s,root:a,rootMargin:o,trackVisibility:l,delay:u},c)}},i.unobserve=function(){this._unobserveCb&&(this._unobserveCb(),this._unobserveCb=null)},i.render=function(){if(!GG(this.props)){var n=this.state,s=n.inView,a=n.entry;return this.props.children({inView:s,entry:a,ref:this.handleNode})}var o=this.props,l=o.children,u=o.as,c=IVe(o,BVe);return xe.createElement(u||"div",XO({ref:this.handleNode},c),l)},t})(xe.Component);yC.displayName="InView";yC.defaultProps={threshold:0,triggerOnce:!1,initialInView:!1};function NVe(e){var t=e===void 0?{}:e,i=t.threshold,r=t.delay,n=t.trackVisibility,s=t.rootMargin,a=t.root,o=t.triggerOnce,l=t.skip,u=t.initialInView,c=t.fallbackInView,h=xe.useRef(),d=xe.useState({inView:!!u}),p=d[0],m=d[1],v=xe.useCallback(function(w){h.current!==void 0&&(h.current(),h.current=void 0),!l&&w&&(h.current=gN(w,function(S,_){m({inView:S,entry:_}),_.isIntersecting&&o&&h.current&&(h.current(),h.current=void 0)},{root:a,rootMargin:s,threshold:i,trackVisibility:n,delay:r},c))},[Array.isArray(i)?i.toString():i,a,s,o,l,n,c,r]);xe.useEffect(function(){!h.current&&p.entry&&!o&&!l&&m({inView:!!u})});var g=[v,p.inView,p.entry];return g.ref=g[0],g.inView=g[1],g.entry=g[2],g}const FVe=Object.freeze(Object.defineProperty({__proto__:null,InView:yC,default:yC,defaultFallbackInView:LVe,observe:gN,useInView:NVe},Symbol.toStringTag,{value:"Module"})),UVe=f$(FVe);var qG;function VVe(){if(qG)return Bw;qG=1,Bw.__esModule=!0,Bw.default=void 0;var e=n(Mx()),t=n(j7()),i=n(UJ()),r=UVe;function n(o){return o&&o.__esModule?o:{default:o}}const s=({children:o="",className:l="",contentArrowStyle:u=null,contentStyle:c=null,date:h="",dateClassName:d="",icon:p=null,iconClassName:m="",iconOnClick:v=null,onTimelineElementClick:g=null,iconStyle:w=null,id:S="",position:_="",style:A=null,textClassName:C="",intersectionObserverProps:E={rootMargin:"0px 0px -40px 0px",triggerOnce:!0},visible:I=!1,shadowSize:T="small"})=>e.default.createElement(r.InView,E,({inView:D,ref:L})=>e.default.createElement("div",{ref:L,id:S,className:(0,i.default)(l,"vertical-timeline-element",{"vertical-timeline-element--left":_==="left","vertical-timeline-element--right":_==="right","vertical-timeline-element--no-children":o===""}),style:A},e.default.createElement(e.default.Fragment,null,e.default.createElement("span",{style:w,onClick:v,className:(0,i.default)(m,"vertical-timeline-element-icon",`shadow-size-${T}`,{"bounce-in":D||I,"is-hidden":!(D||I)})},p),e.default.createElement("div",{style:c,onClick:g,className:(0,i.default)(C,"vertical-timeline-element-content",{"bounce-in":D||I,"is-hidden":!(D||I)})},e.default.createElement("div",{style:u,className:"vertical-timeline-element-content-arrow"}),o,e.default.createElement("span",{className:(0,i.default)(d,"vertical-timeline-element-date")},h)))));s.propTypes={children:t.default.oneOfType([t.default.arrayOf(t.default.node),t.default.node]),className:t.default.string,contentArrowStyle:t.default.shape({}),contentStyle:t.default.shape({}),date:t.default.node,dateClassName:t.default.string,icon:t.default.element,iconClassName:t.default.string,iconStyle:t.default.shape({}),iconOnClick:t.default.func,onTimelineElementClick:t.default.func,id:t.default.string,position:t.default.string,style:t.default.shape({}),textClassName:t.default.string,visible:t.default.bool,shadowSize:t.default.string,intersectionObserverProps:t.default.shape({root:t.default.object,rootMargin:t.default.string,threshold:t.default.number,triggerOnce:t.default.bool})};var a=s;return Bw.default=a,Bw}var PR,XG;function jVe(){return XG||(XG=1,PR={VerticalTimeline:DVe().default,VerticalTimelineElement:VVe().default}),PR}var jJ=jVe();const HVe=({experience:e})=>at.jsx(jJ.VerticalTimelineElement,{contentStyle:{background:"#1d1836",color:"#fff"},contentArrowStyle:{borderRight:"7px solid #232631"},date:e.date,iconStyle:{background:e.iconBg},icon:at.jsx("div",{className:"flex justify-center items-center w-full h-full",children:at.jsx("img",{src:e.icon,alt:e.company_name,className:"w-[60%] h-[60%] object-contain"})}),children:at.jsxs("div",{children:[at.jsx("h3",{className:"text-white text-[24px]",children:e.title}),at.jsx("p",{className:"text-secondary text-[16px] font-semibold",style:{margin:0},children:e.company_name}),at.jsx("ul",{className:"mt-5 list-disc ml-5 space-y-2 ",children:e.points.map((t,i)=>at.jsx("li",{className:"text-white text-[14px] pl-1 tracking-wider",children:t},`experience-point-${i}`))})]})}),WVe=()=>at.jsxs(at.Fragment,{children:[at.jsxs(Np.div,{variants:pN(),className:"mt-20",children:[at.jsx("p",{className:Jg.sectionSubText,children:"What I have done so far"}),at.jsx("h2",{className:Jg.sectionHeadText,children:"Work Experience"})]}),at.jsx("div",{className:"mt-20 flex flex-col",children:at.jsx(jJ.VerticalTimeline,{children:wVe.map((e,t)=>at.jsx(HVe,{experience:e},t))})})]}),GVe=bT(WVe,"experience"),qVe=({index:e,name:t,description:i,tags:r,image:n,source_code_link:s})=>at.jsx(Np.div,{variants:wT("up","spring",e*.5,.75),children:at.jsxs(mN,{options:{max:45,scale:1,speed:450},className:"bg-tertiary p-5 rounded-2xl sm:w-[360px] w-full",children:[at.jsxs("div",{className:"relative w-full h-[230px]",children:[at.jsx("img",{src:n,alt:t,className:"w-full h-full object-cover rounded-2xl"}),at.jsx("div",{className:"absolute inset-0 flex justify-end m-3 card-img_hover",children:at.jsx("div",{onClick:()=>window.open(s,"blank"),className:"black-gradient w-10 h-10 rounded-full flex justify-center items-center cursor-pointer",children:at.jsx("img",{src:Q5e,alt:"github",className:"w-1/2 h-1/2 object-contain"})})})]}),at.jsxs("div",{className:"mt-5",children:[at.jsx("h3",{className:"text-white font-bold text-[24px]",children:t}),at.jsx("p",{className:"mt-2 text-secondary text-[14px]",children:i})]}),at.jsx("div",{className:"mt-4 flex flex-wrap gap-2",children:r.map(a=>at.jsxs("p",{className:`text-[14px] ${a.color}`,children:["#",a.name]},a.name))})]})}),XVe=()=>at.jsxs(at.Fragment,{children:[at.jsxs(Np.div,{variants:pN,children:[at.jsx("p",{className:Jg.sectionSubText,children:"My work"}),at.jsx("h2",{className:Jg.sectionHeadText,children:"Projects"})]}),at.jsx("div",{className:"w-full flex",children:at.jsx(Np.p,{variants:wT("","",.1,1),className:"mt-3 text-secondary text-[17px] max-w-3xl leading-[30px]",children:"Throughout my career journey, I have had the opportunity to be involved in various web and backend development projects. This section highlights the practical application of my technical skills, ranging from developing a responsive community platform to implementing strict code quality testing. These projects demonstrate my ability to translate designs into functional code, integrate third-party APIs, and ensure code quality through Unit Testing."})}),at.jsx("div",{className:"mt-20 flex flex-wrap gap-7",children:bVe.map((e,t)=>at.jsx(qVe,{index:t,...e},`project-${t}`))})]}),YVe=bT(XVe,""),QVe=()=>at.jsx("div",{}),KVe=()=>at.jsx("div",{}),ZVe=()=>(xe.useEffect(()=>{X$.init({duration:1e3,once:!0})}),at.jsx(ote,{children:at.jsxs("main",{className:"z-0",children:[at.jsxs("main",{children:[at.jsx("img",{className:"absolute top-0 right-0 opacity-60 -z-10",src:"/gradient.png",alt:"Gradient Img"}),at.jsx("div",{className:`h-0 w-[40rem] absolute top-[20%] right-[-5%]
      shadow-[0_0_900px_20px_#e99b63] -rotate-[30deg] -z-10`}),at.jsx(dNe,{}),at.jsx(hNe,{})]}),at.jsx(CVe,{}),at.jsx(GVe,{}),at.jsx(PVe,{}),at.jsx(YVe,{}),at.jsx(QVe,{}),at.jsxs("div",{className:"relative z-0",children:[at.jsx(KVe,{}),at.jsx(the,{})]})]})}));YG.createRoot(document.getElementById("root")).render(at.jsx(xe.StrictMode,{children:at.jsx(ZVe,{})}));export{ap as c,xC as g};
